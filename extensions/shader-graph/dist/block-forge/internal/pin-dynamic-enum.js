'use strict';
Object.defineProperty(exports, "__esModule", { value: true });
const pin_1 = require("../pin");
const enum_1 = require("../enum");
class DynamicEnumPinAction extends pin_1.PinAction {
    exec(params) {
        const $pin = params.forge.getPinElement(this.detail.blockName, 'input', this.detail.index);
        if ($pin) {
            // @ts-ignore
            const pin = $pin.__pin;
            pin.details.value = this.detail.target;
            pin.onUpdate();
        }
    }
    revertAction() {
        return new DynamicEnumPinAction(this.pin, {
            source: this.detail.target,
            target: this.detail.source,
        });
    }
}
/**
 * Enum
 * 枚举类型的引脚
 */
class DynamicEnumPin extends pin_1.Pin {
    constructor() {
        super(...arguments);
        this.color = '#451359';
        this.line = 'normal';
        this.details = {
            type: '',
            value: undefined,
        };
        this.style = `
        .pin-dynamic-enum {
            flex: 1;
        }
        .jump {
            margin-left: 2px;
        }
        .jump:hover {
            color: white;
        }
    `;
        this.contentSlot = `<ui-select class="pin-dynamic-enum" ref="enum"></ui-select>`;
        // contentSlot = /*html*/`<ui-select class="pin-dynamic-enum" ref="enum"></ui-select><ui-icon class="jump" ref="jump" value="link"></ui-icon>`;
        this.childrenSlot = [];
        this.index = -1;
        this.enumList = [];
        this.optionList = [];
    }
    onInit() {
        if (this.desc.details?.type) {
            (0, enum_1.removeEnumObserver)(this.desc.details?.type);
            (0, enum_1.addEnumObserver)(this.desc.details?.type, () => {
                this.sync();
            });
        }
        const $enum = this.refs.enum;
        $enum.addEventListener('confirm', () => {
            this.index = parseInt($enum.value);
            const item = this.enumList[this.index];
            const action = new DynamicEnumPinAction(this, {
                source: this.details.value,
                target: item.name,
            });
            this.exec(action);
        });
    }
    sync() {
        this.enumList = (0, enum_1.getDynamicEnumByType)(this.details.type);
        const $enum = this.refs.enum;
        this.optionList.forEach(option => $enum.removeChild(option));
        this.optionList.length = 0;
        for (let i = 0; i < this.enumList.length; i++) {
            const item = this.enumList[i];
            const option = document.createElement('option');
            option.innerText = item.name;
            option.setAttribute('value', item.value + '');
            $enum.appendChild(option);
            this.optionList.push(option);
            if (this.details.value && item.name === this.details.value) {
                this.index = i;
                $enum.value = this.index + '';
            }
            if (this.index === i && this.details.value !== item.value) {
                this.details.value = item.name;
            }
        }
        if (this.index === -1 && !this.details.value && this.desc) {
            for (let i = 0; i < this.enumList.length; i++) {
                const item = this.enumList[i];
                if (item.name === this.desc.details?.defaultValue) {
                    this.index = i;
                    this.details.value = item.name;
                    break;
                }
            }
            const $enum = this.refs.enum;
            $enum.value = this.index + '';
        }
    }
    onUpdate() {
        const $enum = this.refs.enum;
        this.details.type = this.desc.details?.type;
        this.sync();
    }
}
DynamicEnumPin.type = 'dynamicEnum';
(0, pin_1.declarePin)(DynamicEnumPin);
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoicGluLWR5bmFtaWMtZW51bS5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9ibG9jay1mb3JnZS9pbnRlcm5hbC9waW4tZHluYW1pYy1lbnVtLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiJBQUFBLFlBQVksQ0FBQzs7QUFHYixnQ0FBb0Q7QUFDcEQsa0NBQThGO0FBUTlGLE1BQU0sb0JBQXFCLFNBQVEsZUFHakM7SUFFRSxJQUFJLENBQUMsTUFFSjtRQUNHLE1BQU0sSUFBSSxHQUFHLE1BQU0sQ0FBQyxLQUFLLENBQUMsYUFBYSxDQUFDLElBQUksQ0FBQyxNQUFNLENBQUMsU0FBUyxFQUFFLE9BQU8sRUFBRSxJQUFJLENBQUMsTUFBTSxDQUFDLEtBQUssQ0FBQyxDQUFDO1FBQzNGLElBQUksSUFBSSxFQUFFO1lBQ04sYUFBYTtZQUNiLE1BQU0sR0FBRyxHQUFHLElBQUksQ0FBQyxLQUF1QixDQUFDO1lBQ3pDLEdBQUcsQ0FBQyxPQUFPLENBQUMsS0FBSyxHQUFHLElBQUksQ0FBQyxNQUFNLENBQUMsTUFBTSxDQUFDO1lBQ3ZDLEdBQUcsQ0FBQyxRQUFRLEVBQUUsQ0FBQztTQUNsQjtJQUNMLENBQUM7SUFFRCxZQUFZO1FBQ1IsT0FBTyxJQUFJLG9CQUFvQixDQUFDLElBQUksQ0FBQyxHQUFHLEVBQUU7WUFDdEMsTUFBTSxFQUFFLElBQUksQ0FBQyxNQUFNLENBQUMsTUFBTTtZQUMxQixNQUFNLEVBQUUsSUFBSSxDQUFDLE1BQU0sQ0FBQyxNQUFNO1NBQzdCLENBQUMsQ0FBQztJQUNQLENBQUM7Q0FDSjtBQUVEOzs7R0FHRztBQUNILE1BQU0sY0FBZSxTQUFRLFNBQXlCO0lBQXREOztRQUdJLFVBQUssR0FBRyxTQUFTLENBQUM7UUFDbEIsU0FBSSxHQUFHLFFBQVEsQ0FBQztRQUNoQixZQUFPLEdBQXlCO1lBQzVCLElBQUksRUFBRSxFQUFFO1lBQ1IsS0FBSyxFQUFFLFNBQVM7U0FDbkIsQ0FBQztRQUVGLFVBQUssR0FBRzs7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QUFDLGNBQWMsQ0FBQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiJ3VzZSBzdHJpY3QnO1xuXG5pbXBvcnQgdHlwZSB7IEhUTUxHcmFwaEZvcmdlRWxlbWVudCB9IGZyb20gJy4uL2ZvcmdlJztcbmltcG9ydCB7IFBpbiwgZGVjbGFyZVBpbiwgUGluQWN0aW9uIH0gZnJvbSAnLi4vcGluJztcbmltcG9ydCB7IGdldER5bmFtaWNFbnVtQnlUeXBlLCBhZGRFbnVtT2JzZXJ2ZXIsIEVudW1UeXBlLCByZW1vdmVFbnVtT2JzZXJ2ZXIgfSBmcm9tICcuLi9lbnVtJztcbmltcG9ydCB7IElQaW5EZXNjcmlwdGlvbiwgUGluRGF0YSB9IGZyb20gJy4uL2ludGVyZmFjZSc7XG5cbnR5cGUgRHluYW1pY0VudW1QaW5EZXRhaWwgPSB7XG4gICAgdmFsdWU6IGFueTtcbiAgICB0eXBlOiBzdHJpbmc7XG59XG5cbmNsYXNzIER5bmFtaWNFbnVtUGluQWN0aW9uIGV4dGVuZHMgUGluQWN0aW9uPHtcbiAgICBzb3VyY2U6IHN0cmluZyxcbiAgICB0YXJnZXQ6IHN0cmluZyxcbn0+IHtcblxuICAgIGV4ZWMocGFyYW1zOiB7XG4gICAgICAgIGZvcmdlOiBIVE1MR3JhcGhGb3JnZUVsZW1lbnRcbiAgICB9KSB7XG4gICAgICAgIGNvbnN0ICRwaW4gPSBwYXJhbXMuZm9yZ2UuZ2V0UGluRWxlbWVudCh0aGlzLmRldGFpbC5ibG9ja05hbWUsICdpbnB1dCcsIHRoaXMuZGV0YWlsLmluZGV4KTtcbiAgICAgICAgaWYgKCRwaW4pIHtcbiAgICAgICAgICAgIC8vIEB0cy1pZ25vcmVcbiAgICAgICAgICAgIGNvbnN0IHBpbiA9ICRwaW4uX19waW4gYXMgRHluYW1pY0VudW1QaW47XG4gICAgICAgICAgICBwaW4uZGV0YWlscy52YWx1ZSA9IHRoaXMuZGV0YWlsLnRhcmdldDtcbiAgICAgICAgICAgIHBpbi5vblVwZGF0ZSgpO1xuICAgICAgICB9XG4gICAgfVxuXG4gICAgcmV2ZXJ0QWN0aW9uKCkge1xuICAgICAgICByZXR1cm4gbmV3IER5bmFtaWNFbnVtUGluQWN0aW9uKHRoaXMucGluLCB7XG4gICAgICAgICAgICBzb3VyY2U6IHRoaXMuZGV0YWlsLnRhcmdldCxcbiAgICAgICAgICAgIHRhcmdldDogdGhpcy5kZXRhaWwuc291cmNlLFxuICAgICAgICB9KTtcbiAgICB9XG59XG5cbi8qKlxuICogRW51bVxuICog5p6a5Li+57G75Z6L55qE5byV6ISaXG4gKi9cbmNsYXNzIER5bmFtaWNFbnVtUGluIGV4dGVuZHMgUGluPER5bmFtaWNFbnVtUGluRGV0YWlsPiB7XG4gICAgc3RhdGljIHR5cGUgPSAnZHluYW1pY0VudW0nO1xuXG4gICAgY29sb3IgPSAnIzQ1MTM1OSc7XG4gICAgbGluZSA9ICdub3JtYWwnO1xuICAgIGRldGFpbHM6IER5bmFtaWNFbnVtUGluRGV0YWlsID0ge1xuICAgICAgICB0eXBlOiAnJyxcbiAgICAgICAgdmFsdWU6IHVuZGVmaW5lZCxcbiAgICB9O1xuXG4gICAgc3R5bGUgPSBgXG4gICAgICAgIC5waW4tZHluYW1pYy1lbnVtIHtcbiAgICAgICAgICAgIGZsZXg6IDE7XG4gICAgICAgIH1cbiAgICAgICAgLmp1bXAge1xuICAgICAgICAgICAgbWFyZ2luLWxlZnQ6IDJweDtcbiAgICAgICAgfVxuICAgICAgICAuanVtcDpob3ZlciB7XG4gICAgICAgICAgICBjb2xvcjogd2hpdGU7XG4gICAgICAgIH1cbiAgICBgO1xuXG4gICAgY29udGVudFNsb3QgPSAvKmh0bWwqL2A8dWktc2VsZWN0IGNsYXNzPVwicGluLWR5bmFtaWMtZW51bVwiIHJlZj1cImVudW1cIj48L3VpLXNlbGVjdD5gO1xuICAgIC8vIGNvbnRlbnRTbG90ID0gLypodG1sKi9gPHVpLXNlbGVjdCBjbGFzcz1cInBpbi1keW5hbWljLWVudW1cIiByZWY9XCJlbnVtXCI+PC91aS1zZWxlY3Q+PHVpLWljb24gY2xhc3M9XCJqdW1wXCIgcmVmPVwianVtcFwiIHZhbHVlPVwibGlua1wiPjwvdWktaWNvbj5gO1xuICAgIGNoaWxkcmVuU2xvdCA9IFtdO1xuXG4gICAgcHJpdmF0ZSBpbmRleCA9IC0xO1xuICAgIHByaXZhdGUgZW51bUxpc3Q6IEVudW1UeXBlW10gPSBbXTtcbiAgICBwcml2YXRlIG9wdGlvbkxpc3Q6IEhUTUxFbGVtZW50W10gPSBbXTtcblxuICAgIG9uSW5pdCgpIHtcbiAgICAgICAgaWYgKHRoaXMuZGVzYy5kZXRhaWxzPy50eXBlKSB7XG4gICAgICAgICAgICByZW1vdmVFbnVtT2JzZXJ2ZXIodGhpcy5kZXNjLmRldGFpbHM/LnR5cGUpO1xuICAgICAgICAgICAgYWRkRW51bU9ic2VydmVyKHRoaXMuZGVzYy5kZXRhaWxzPy50eXBlLCAoKSA9PiB7XG4gICAgICAgICAgICAgICAgdGhpcy5zeW5jKCk7XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfVxuICAgICAgICBjb25zdCAkZW51bSA9IHRoaXMucmVmcy5lbnVtIGFzIEhUTUxJbnB1dEVsZW1lbnQ7XG4gICAgICAgICRlbnVtLmFkZEV2ZW50TGlzdGVuZXIoJ2NvbmZpcm0nLCAoKSA9PiB7XG4gICAgICAgICAgICB0aGlzLmluZGV4ID0gcGFyc2VJbnQoJGVudW0udmFsdWUpO1xuICAgICAgICAgICAgY29uc3QgaXRlbSA9IHRoaXMuZW51bUxpc3RbdGhpcy5pbmRleF07XG5cbiAgICAgICAgICAgIGNvbnN0IGFjdGlvbiA9IG5ldyBEeW5hbWljRW51bVBpbkFjdGlvbih0aGlzLCB7XG4gICAgICAgICAgICAgICAgc291cmNlOiB0aGlzLmRldGFpbHMudmFsdWUsXG4gICAgICAgICAgICAgICAgdGFyZ2V0OiBpdGVtLm5hbWUsXG4gICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIHRoaXMuZXhlYyhhY3Rpb24pO1xuICAgICAgICB9KTtcbiAgICB9XG5cbiAgICBwcml2YXRlIHN5bmMoKSB7XG4gICAgICAgIHRoaXMuZW51bUxpc3QgPSBnZXREeW5hbWljRW51bUJ5VHlwZSh0aGlzLmRldGFpbHMudHlwZSk7XG4gICAgICAgIGNvbnN0ICRlbnVtID0gdGhpcy5yZWZzLmVudW0gYXMgSFRNTElucHV0RWxlbWVudDtcbiAgICAgICAgdGhpcy5vcHRpb25MaXN0LmZvckVhY2gob3B0aW9uID0+ICRlbnVtLnJlbW92ZUNoaWxkKG9wdGlvbikpO1xuICAgICAgICB0aGlzLm9wdGlvbkxpc3QubGVuZ3RoID0gMDtcblxuICAgICAgICBmb3IgKGxldCBpID0gMDsgaSA8IHRoaXMuZW51bUxpc3QubGVuZ3RoOyBpKyspIHtcbiAgICAgICAgICAgIGNvbnN0IGl0ZW0gPSB0aGlzLmVudW1MaXN0W2ldO1xuICAgICAgICAgICAgY29uc3Qgb3B0aW9uID0gZG9jdW1lbnQuY3JlYXRlRWxlbWVudCgnb3B0aW9uJyk7XG4gICAgICAgICAgICBvcHRpb24uaW5uZXJUZXh0ID0gaXRlbS5uYW1lO1xuICAgICAgICAgICAgb3B0aW9uLnNldEF0dHJpYnV0ZSgndmFsdWUnLCBpdGVtLnZhbHVlICsgJycpO1xuICAgICAgICAgICAgJGVudW0uYXBwZW5kQ2hpbGQob3B0aW9uKTtcbiAgICAgICAgICAgIHRoaXMub3B0aW9uTGlzdC5wdXNoKG9wdGlvbik7XG5cbiAgICAgICAgICAgIGlmICh0aGlzLmRldGFpbHMudmFsdWUgJiYgaXRlbS5uYW1lID09PSB0aGlzLmRldGFpbHMudmFsdWUpIHtcbiAgICAgICAgICAgICAgICB0aGlzLmluZGV4ID0gaTtcbiAgICAgICAgICAgICAgICAkZW51bS52YWx1ZSA9IHRoaXMuaW5kZXggKyAnJztcbiAgICAgICAgICAgIH1cblxuICAgICAgICAgICAgaWYgKHRoaXMuaW5kZXggPT09IGkgJiYgdGhpcy5kZXRhaWxzLnZhbHVlICE9PSBpdGVtLnZhbHVlKSB7XG4gICAgICAgICAgICAgICAgdGhpcy5kZXRhaWxzLnZhbHVlID0gaXRlbS5uYW1lO1xuICAgICAgICAgICAgfVxuICAgICAgICB9XG4gICAgICAgIGlmICh0aGlzLmluZGV4ID09PSAtMSAmJiAhdGhpcy5kZXRhaWxzLnZhbHVlICYmIHRoaXMuZGVzYykge1xuICAgICAgICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCB0aGlzLmVudW1MaXN0Lmxlbmd0aDsgaSsrKSB7XG4gICAgICAgICAgICAgICAgY29uc3QgaXRlbTogRW51bVR5cGUgPSB0aGlzLmVudW1MaXN0W2ldO1xuICAgICAgICAgICAgICAgIGlmIChpdGVtLm5hbWUgPT09IHRoaXMuZGVzYy5kZXRhaWxzPy5kZWZhdWx0VmFsdWUpIHtcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5pbmRleCA9IGk7XG4gICAgICAgICAgICAgICAgICAgIHRoaXMuZGV0YWlscy52YWx1ZSA9IGl0ZW0ubmFtZTtcbiAgICAgICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgfVxuICAgICAgICAgICAgY29uc3QgJGVudW0gPSB0aGlzLnJlZnMuZW51bSBhcyBIVE1MSW5wdXRFbGVtZW50O1xuICAgICAgICAgICAgJGVudW0udmFsdWUgPSB0aGlzLmluZGV4ICsgJyc7XG4gICAgICAgIH1cbiAgICB9XG5cbiAgICBvblVwZGF0ZSgpIHtcbiAgICAgICAgY29uc3QgJGVudW0gPSB0aGlzLnJlZnMuZW51bSBhcyBIVE1MSW5wdXRFbGVtZW50O1xuICAgICAgICB0aGlzLmRldGFpbHMudHlwZSA9IHRoaXMuZGVzYy5kZXRhaWxzPy50eXBlO1xuXG4gICAgICAgIHRoaXMuc3luYygpO1xuICAgIH1cbn1cbmRlY2xhcmVQaW4oRHluYW1pY0VudW1QaW4pO1xuIl19