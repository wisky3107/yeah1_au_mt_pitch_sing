System.register("chunks:///main.js",["cc","./rollupPluginModLoBabelHelpers-2a4540ca.js"],(function(){var t,e,i,n,o,r,a,s,l,c,u,h,p,d,f,g,m,v,y,b,_,S,w,T,C,E,P,A,M,O,I,x,R,L,N,F,D,k,z,V,B,H,U,G,W,Z,Y,q,j,K,X,Q,J,$,tt,et,it,nt,ot,rt,at,st,lt,ct,ut,ht,pt,dt,ft,gt,mt,vt,yt,bt,_t,St,wt,Tt,Ct,Et,Pt,At,Mt,Ot,It,xt,Rt,Lt,Nt,Ft,Dt;return{setters:[function(Mt){t=Mt.cclegacy,e=Mt._decorator,i=Mt.SpriteFrame,n=Mt.math,o=Mt.randomRangeInt,r=Mt.Component,a=Mt.resources,s=Mt.Asset,l=Mt.Prefab,c=Mt.Node,u=Mt.assetManager,h=Mt.SpriteAtlas,p=Mt.Texture2D,d=Mt.ImageAsset,f=Mt.Sprite,g=Mt.Vec3,m=Mt.v3,v=Mt.tween,y=Mt.Label,b=Mt.UIOpacity,_=Mt.easing,S=Mt.sys,w=Mt.native,T=Mt.log,C=Mt.error,E=Mt.instantiate,P=Mt.find,A=Mt.isValid,M=Mt.director,O=Mt.game,I=Mt.AudioSource,x=Mt.AudioClip,R=Mt.Enum,L=Mt.KeyCode,N=Mt.Button,F=Mt.EventHandler,D=Mt.input,k=Mt.Input,z=Mt.Toggle,V=Mt.NodeEventType,B=Mt.UITransform,H=Mt.rect,U=Mt.CCBoolean,G=Mt.CCInteger,W=Mt.v2,Z=Mt.screen,Y=Mt.Widget,q=Mt.view,j=Mt.Slider,K=Mt.Vec2,X=Mt.Color,Q=Mt.EventTouch,J=Mt.macro,$=Mt.Layout,tt=Mt.Size,et=Mt.NodePool,it=Mt.Animation,nt=Mt.AnimationClip,ot=Mt.Game,rt=Mt.CCFloat,at=Mt.Tween,st=Mt.TextAsset,lt=Mt.SkeletalAnimation,ct=Mt.ParticleSystem2D,ut=Mt.ProgressBar,ht=Mt.MeshRenderer,pt=Mt.ScrollView,dt=Mt.animation,ft=Mt.ParticleSystem,gt=Mt.random,mt=Mt.randomRange,vt=Mt.SkinnedMeshRenderer,yt=Mt.JsonAsset,bt=Mt.Camera,_t=Mt.ToggleContainer,St=Mt.Quat,wt=Mt.PhysicsSystem,Tt=Mt.EditBox,Ct=Mt.ValueType,Et=Mt.TextureCube,Pt=Mt.Vec4,At=Mt.Material},function(t){Mt=t._,Ot=t.a,It=t.b,xt=t.c,Rt=t.d,Lt=t.e,Nt=t.f,Ft=t.g,Dt=t.h}],execute:function(){var kt,zt;t._RF.push({},"a3605ZRcydAsqLfvt2I7n/+","CSVLoader",void 0),t._RF.pop(),t._RF.push({},"f3654C79/FGx7RDXCjGKZLE","ClientEvent",void 0);var Vt,Bt=e.ccclass,Ht=(e.property,Bt("clientEvent")(((zt=function(){function t(){}return t.on=function(e,i,n){var o={handler:i,target:n},r=t._handlers[e];r||(r=[],t._handlers[e]=r);for(var a=0;a<r.length;a++)if(!r[a])return r[a]=o,a;return r.push(o),r.length},t.off=function(e,i,n){var o=t._handlers[e];if(o)for(var r=0;r<o.length;r++){var a=o[r];if(a.handler===i&&(!n||n===a.target)){o.splice(r,1);break}}},t.dispatchEvent=function(e){for(var i=arguments.length,n=new Array(i>1?i-1:0),o=1;o<i;o++)n[o-1]=arguments[o];var r,a=t._handlers[e],s=[];for(r=1;r<arguments.length;r++)s.push(arguments[r]);if(a)for(r=0;r<a.length;r++){var l=a[r];l.handler&&l.handler.apply(l.target,s)}},t}())._handlers={},kt=zt))||kt);t._RF.pop(),t._RF.push({},"bebeaAU60hJjpSfuLpkpTPQ","ComponentPool",void 0);var Ut,Gt,Wt,Zt,Yt,qt,jt,Kt,Xt,Qt,Jt,$t,te=e.ccclass,ee=(e.property,te("ComponentPool")(Vt=function(){function t(t,e){this.pool=void 0,this.factory=void 0,this.parentNode=void 0,this.pool=[],this.factory=t,this.parentNode=e}var e=t.prototype;return e.init=function(t){for(var e=0;e<t;e++){var i=this.factory();i.node.parent=this.parentNode,this.put(i)}},e.get=function(){if(this.pool.length>0){var t=this.pool.pop();return t.node.active=!0,t}var e=this.factory();return e.node.parent=this.parentNode,e},e.put=function(t){t.node.active=!1,t.node.parent=this.parentNode,this.pool.push(t)},e.putAll=function(t){var e=this;t.forEach((function(t){return e.put(t)}))},e.clear=function(){this.pool.forEach((function(t){t.node.destroy()})),this.pool=[]},t}())||Vt);t._RF.pop(),t._RF.push({},"449f63urB5BrqfvzhGei/dM","ImageLoader",void 0);var ie,ne,oe,re,ae,se,le,ce=e.ccclass,ue=e.property,he=(Ut=ce("ImageLoader"),Gt=ue([i]),Wt=ue([i]),Zt=ue(i),Yt=ue(i),Ut((($t=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,It(e,"preloadSpriteFrames",Kt,xt(e)),It(e,"avatarSpriteframe",Xt,xt(e)),It(e,"sfDiamonds",Qt,xt(e)),It(e,"sfCoins",Jt,xt(e)),e.spriteFrameMap=new Map,e}Ot(e,t);var i=e.prototype;return i.onLoad=function(){e.instance=this,this.initSpriteFrames()},i.initSpriteFrames=function(){var t=this;this.preloadSpriteFrames.forEach((function(e){t.spriteFrameMap.set(e.name,e)}))},i.getSpriteFrame=function(t){return this.spriteFrameMap.has(t)?this.spriteFrameMap.get(t):(console.error("Unknown sprite"+t),null)},i.getAvatar=function(t){var e=(Number(t)%1e3).toString(),i=function(t){try{var i;return parseInt(null!=(i=e[e.length-t])?i:"0")}catch(t){return 0}};try{var o=i(1),r=i(2),a=n.clamp(o+r,0,this.avatarSpriteframe.length-1);return this.avatarSpriteframe[a]}catch(t){return null}},i.getRandomCapyImage=function(){return this.avatarSpriteframe[o(0,this.avatarSpriteframe.length)]},e}(r)).instance=null,Kt=Mt((jt=$t).prototype,"preloadSpriteFrames",[Gt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Xt=Mt(jt.prototype,"avatarSpriteframe",[Wt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Qt=Mt(jt.prototype,"sfDiamonds",[Zt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Jt=Mt(jt.prototype,"sfCoins",[Yt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),qt=jt))||qt);function pe(t,e){return void 0===e&&(e=1),new Promise((function(i,n){a.load(t,(function(t,o){if(t)return console.error("Error loading asset:",t),void n(t);if(!(o instanceof s)){var r=new Error("Invalid asset type loaded");return console.error(r.message,o),void n(r)}var a=o.nativeUrl,l=new XMLHttpRequest;l.open("GET",a,!0),l.responseType="arraybuffer",l.onload=function(){if(200===l.status){var t=l.response,o=new Uint8Array(t);try{var r=new Midi(o.buffer);console.log("MIDI file loaded successfully:",r),e>=0&&r.tracks&&r.tracks.length>e?i(r.tracks[e]):i(r)}catch(t){console.error("Error parsing MIDI data:",t),n(t)}}else{var a=new Error("Error loading binary data: "+l.statusText);console.error(a.message),n(a)}},l.onerror=function(t){n(new Error("Network error during MIDI file loading"))},l.send()}))}))}function de(t,e){return void 0===e&&(e=1),new Promise((function(i,n){var o=new XMLHttpRequest;o.open("GET",t,!0),o.responseType="arraybuffer",o.onload=function(){if(200===o.status){var t=o.response,r=new Uint8Array(t);try{if("undefined"!=typeof window&&window.Midi){var a=new window.Midi(r.buffer);console.log("MIDI file loaded successfully:",a);var s=a.tracks&&a.tracks.length>e?a.tracks[e]:null;i(s||a)}else n(new Error("Midi parser not available"))}catch(t){console.error("Error parsing MIDI data:",t),n(t)}}else n(new Error("Error loading binary data: "+o.statusText))},o.onerror=function(){n(new Error("Network error during MIDI file loading"))},o.send()}))}t._RF.pop(),t._RF.push({},"1b61cY0MSxGRrqa3QwVp8IO","MidiReader",void 0),t._RF.pop(),t._RF.push({},"6de52PO/FFI4qh57HrWi8RF","ObjectPoolData",void 0);var fe=e.ccclass,ge=e.property;ie=fe("ObjectPoolData"),ne=ge(l),oe=ge(c),ie((se=Mt((ae=function(){It(this,"prefab",se,this),It(this,"container",le,this)}).prototype,"prefab",[ne],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),le=Mt(ae.prototype,"container",[oe],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),re=ae));t._RF.pop(),t._RF.push({},"5f860beWrBGtbckv8i95YZU","Constants",void 0);var me={EVENT_NAME:{GAME_INITED:"GAME_INITED_DONE",USERDATA_UPDATED:"USERDATA_UPDATED",USERCOIN_UPDATED:"USERCOIN_UPDATED"},RESOURCE_PATH:{GAME_MAIN_PATH:"prefab/Game"},SOUND_FILES:{SFX_PATH:"sounds/sfx/"},CAMERA_CONFIG:{MIN_SIZE:200},CAMERA_ZOOM_THRESHOLD:500,AUTO_TIME:3,STORAGE_KEY:{BGM_VOLUME:"BGM_VOLUME",SFX_VOLUME:"SFX_VOLUME",USER_MODIFIER:"USER_MODIFIER"},EFFECT:{MOVING_UI_OBJECT:"moving",UI_COINS:"coins",UI_TURNS:"turns",LEVLEUP_SMALL:"levelup_small",LEVLEUP_BIG:"levelup_big",CONFETTI:"confetti",TEXT:"text"},GAME:{PHYSIC_GRAVITY:18},VIEW:{TOPHUB:"ViewTopHub"}},ve={API:"",LOG:!0};t._RF.pop(),t._RF.push({},"ad288/O58VDkJlgQZZZjRwu","assetRemoteUtil",void 0);var ye,be=function(){function t(){}return t.loadBundle=function(t,e){u.loadBundle(t,null,(function(t,i){if(t)return console.error(t),void e(t,null);e(null,i)}))},t.loadAltas=function(t,e,i){this.loadBundle(t,(function(t,n){t?null==i||i(t,null):n.load(e,h,(function(t,e){if(t)return console.error(t),void(null==i||i(t,null));null==i||i(null,e)}))}))},t.loadRemoteImage=function(){var t=Rt(Lt().mark((function t(e){var n,o,r,a,s,l;return Lt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,e="https://cors-anywhere.herokuapp.com/"+e,t.next=4,fetch(e);case 4:if((n=t.sent).ok){t.next=7;break}throw new Error("HTTP error! Status: "+n.status);case 7:return t.next=9,n.blob();case 9:return o=t.sent,(r=new Image).crossOrigin="Anonymous",a=new Promise((function(t,e){r.onload=function(){return t(r)},r.onerror=function(){return e(new Error("Failed to load image element"))}})),r.src=URL.createObjectURL(o),t.next=16,a;case 16:return(s=new p).image=new d(r),(l=new i).texture=s,t.abrupt("return",l);case 23:throw t.prev=23,t.t0=t.catch(0),new Error("Failed to load remote image: "+t.t0.message);case 26:case"end":return t.stop()}}),t,null,[[0,23]])})));return function(e){return t.apply(this,arguments)}}(),t.fetchImage=function(){var t=Rt(Lt().mark((function t(e){var i,n,o;return Lt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e){t.next=2;break}throw new Error("Failed to fetch image: URL is null or empty.");case 2:return t.prev=2,t.next=5,fetch(e);case 5:return i=t.sent,t.t0=Uint8Array,t.next=9,i.arrayBuffer();case 9:return t.t1=t.sent,n=new t.t0(t.t1),o=this.bufferToBase64(n),t.abrupt("return",this.convertBase64ToSpriteFrame(o));case 15:throw t.prev=15,t.t2=t.catch(2),new Error("Failed to get SpriteFrame: "+t.t2.message);case 18:case"end":return t.stop()}}),t,this,[[2,15]])})));return function(e){return t.apply(this,arguments)}}(),t.bufferToBase64=function(t){var e=Array.from(t).map((function(t){return String.fromCharCode(t)})).join("");return btoa(e)},t.convertBase64ToSpriteFrame=function(){var t=Rt(Lt().mark((function t(e){return Lt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t,n){var o=new Image;o.onload=function(){var e=new p;e.image=new d(o);var n=new i;n.texture=e,t(n),URL.revokeObjectURL(o.src)},o.onerror=function(){n(new Error("Failed to load base64 image")),URL.revokeObjectURL(o.src)},o.src="data:image/png;base64,"+e})));case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),t.loadAndListenAvatar=function(t,e){var i=this;if(this.spriteFrameMap.has(t))null==e||e(this.spriteFrameMap.get(t));else if(this.spriteCallbacks.has(t)||this.spriteCallbacks.set(t,[]),this.spriteCallbacks.get(t).push(e),!(this.loadingSprites.indexOf(t)>=0)){this.loadingSprites.push(t);var n=function(e){i.spriteFrameMap.set(t,e),i.spriteCallbacks.get(t).forEach((function(t){return t(e)})),i.spriteCallbacks.set(t,[]),i.loadingSprites=i.loadingSprites.filter((function(e){return e!==t})),i.spriteFrameMap.size>100&&(i.spriteFrameMap.clear(),ve.LOG&&console.log("SpriteFrameMap cache cleared due to exceeding 100 records.")),ve.LOG&&console.log("Total loaded avatar: ",i.spriteFrameMap.size)};this.fetchImage(t).then((function(t){n(t)})).catch((function(t){n(null)}))}},t.removeListenAvatar=function(t,e){0!=this.spriteCallbacks.has(t)&&this.spriteCallbacks.set(t,this.spriteCallbacks.get(t).filter((function(t){return t!=e})))},t}();be.spriteFrameMap=new Map,be.loadingSprites=[],be.spriteCallbacks=new Map,be.loadedImages=[],be.loadedTextures=[],t._RF.pop(),t._RF.push({},"03f5c6o2sJBCL/VJkJmJTZA","UIAvatar",void 0);var _e,Se=e.ccclass,we=(e.property,e.requireComponent),Te=Se("UIAvatar")(ye=we(f)(ye=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).sprite=null,e.data=null,e.url=null,e.id=null,e.loadAvatarFunction=null,e}Ot(e,t);var i=e.prototype;return i.onLoad=function(){this.sprite=this.getComponent(f)},i.onDisable=function(){this.loadAvatarFunction&&be.removeListenAvatar(this.url,this.loadAvatarFunction)},i.setData=function(t,e){this.sprite&&(this.sprite.spriteFrame=he.instance.getAvatar(this.id),this.id=e,this.url=t,this.loadAvatarFunction=this.onLoadedAvatar.bind(this),be.loadAndListenAvatar(t,this.loadAvatarFunction))},i.onLoadedAvatar=function(t){this.sprite.spriteFrame=null!=t?t:he.instance.getAvatar(this.id),this.loadAvatarFunction=null},i.clear=function(){this.sprite.spriteFrame=null},e}(r))||ye)||ye;t._RF.pop(),t._RF.push({},"60a69bp1SlI3LOxXGNq+M1o","UICashAnimation",void 0);var Ce,Ee,Pe=e.ccclass;e.property,Pe("UICashAnimation")(_e=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).posY=[],e.sprites=[],e.tweens=[],e}Ot(e,t);var i=e.prototype;return i.init=function(){var t=this;this.sprites=this.getComponentsInChildren(f),this.sprites.forEach((function(e){t.posY.push(e.node.position.y),t.tweens.push(null)}))},i.setVisible=function(t,e,i,n){var o=this;if(void 0===n&&(n=-1),this.sprites.length<=0&&this.init(),n=n<0?this.sprites.length:Math.min(this.sprites.length,n),t){this.sprites.forEach((function(t){return t.node.position=g.ZERO}));for(var r=e/n,a=function(){var t,a=s*r,l=s;if(o.sprites[l].node.active=!0,e<=0)return o.sprites[l].node.position=m(0,o.posY[l]),1;null==(t=o.tweens[l])||t.stop(),o.tweens[l]=v(o.sprites[l].node).to(a,{position:m(0,o.posY[l])}).call((function(){l==n-1&&(null==i||i())})).start()},s=0;s<n;s++)a()}else for(var l=function(){var t,n=c;if(e<=0)return o.sprites[n].node.active=!1,1;null==(t=o.tweens[n])||t.stop(),o.tweens[n]=v(o.sprites[n].node).to(e,{position:g.ZERO}).call((function(){o.sprites[n].node.active=!1,n==o.sprites.length-1&&(null==i||i())})).start()},c=0;c<this.sprites.length;c++)l()},e}(r));t._RF.pop(),t._RF.push({},"f17deAL74VOroYmPuGafWvU","Utils",void 0),Number.prototype.clamp=function(t,e){return Math.min(Math.max(this.valueOf(),t),e)},Number.prototype.pingPong=function(t,e){var i=e-t,n=(this.valueOf()-t)/i,o=Math.floor(n),r=n-o;return o%2==0?t+i*r:e-i*r},Number.prototype.randomInt=function(t,e){return Math.floor(Math.random()*(e-t)+t)},Array.prototype.shuffle=function(){for(var t=this.length-1;t>0;t--){var e=Math.floor(Math.random()*(t+1)),i=[this[e],this[t]];this[t]=i[0],this[e]=i[1]}return this},Array.prototype.distinct=function(){return this.filter((function(t,e,i){return i.findIndex((function(e){return e.id===t.id}))===e}))},Array.prototype.randomElement=function(){return this.length<=0?null:this[Math.floor(Math.random()*this.length)]};var Ae,Me=e.ccclass,Oe=(e.property,Me("util")(((Ee=function(){function t(){}return t.formatNumber=function(t,e,i){if(void 0===e&&(e=0),void 0===i&&(i=2),!t)return"0";for(var n=["","K","M","B","T","Qa","Qi","Sx","Sp","Oc","No","Dc","Ud","Dd","Td","Qua","Qui","Sx","Sp","Oc","No","Vi","Dv","Tv","Qaa","Qaq","Qap","Qaop","Qit"],o=0;t>=1e3&&(t/=1e3,!(++o>=n.length-1)););return 0==o?this.toFixed(t,e):""+this.toFixed(t,i).replace(".",",")+n[o]},t.toFixed=function(t,e){return t.toFixed(e).replace(/(\.\d*?[1-9])0+$|\.0*$/,"$1")},t.commaNumber=function(t){return t?t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","):"0"},t.mapAbbreviationToWord=function(t){return{"":" ",K:"Thousand",M:"Million",B:"Billion",T:"Trillion",Qa:"Quadrillion",Qi:"Quintillion",Sx:"Sextillion",Sp:"Septillion",Oc:"Octillion",No:"Nonillion",Dc:"Decillion",Ud:"Undecillion",Dd:"Duodecillion",Td:"Tredecillion",Qua:"Quattuordecillion",Qui:"Quindecillion",Vi:"Sexdecillion",Dv:"Septendecillion",Tv:"Octodecillion",Qaa:"Novemdecillion",Qaq:"Vigintillion",Qap:"Unvigintillion",Qaop:"Duovigintillion",Qit:"Tresvigintillion"}[t]||""},t.getTokenParam=function(){return this.getUrlkeyValue("tk")},t.getRefreshTokenParam=function(){return this.getUrlkeyValue("rtk")},t.getDeviceKeyParam=function(){return this.getUrlkeyValue("dk")},t.getIdPasswordUrl=function(){return{username:this.getUrlkeyValue("username"),password:this.getUrlkeyValue("password")}},t.WaitFor=function(t,e){t()?e():setTimeout(this.WaitFor.bind(null,t,e),100)},t.loadScript=function(t,e){var i=document.createElement("script");i.type="text/javascript",i.src=t,e&&(i.onload=e),document.head.appendChild(i)},t.clone=function(t){if(null===t||"object"!=typeof t)return t;var e={};for(var i in t.constructor===Array&&(e=[]),t)t.hasOwnProperty(i)&&(e[i]=this.clone(t[i]));return e},t.objectToArray=function(t){var e=[];for(var i in t)t.hasOwnProperty(i)&&e.push(t[i]);return e},t.arrayToObject=function(t,e){var i={};for(var n in t)t.hasOwnProperty(n)&&t[n][e]&&(i[t[n][e]]=t[n]);return i},t.getWeightRandIndex=function(t,e){for(var i=Math.floor(Math.random()*e),n=0,o=0;o<t.length&&!(i<(n+=t[o]));o++);return o},t.getRandomNFromM=function(t,e){for(var i=[],n=0,o=0;o<e&&!(o>=t+1);){n=this.getRandomInt(0,t);for(var r=0,a=0;a<o;a++)if(i[a]===n){r=1;break}0===r&&(i[o]=n,o++)}return i},t.getRandomInt=function(t,e){var i=Math.random()*(e-t+1)+t;return Math.floor(i)},t.getStringLength=function(t){for(var e=t,i=0,n=0,o=e.length;n<o;n++){i+=e.charCodeAt(n)<=255?1:2}return Math.ceil(i/2)},t.isEmptyObject=function(t){var e=!0;if(t&&t.constructor===Object){for(var i in t)if(t.hasOwnProperty(i)){e=!1;break}}else e=!1;return e},t.isNewDay=function(t){var e=new Date(t),i=new Date,n=e.getYear(),o=e.getMonth(),r=e.getDate(),a=i.getYear(),s=i.getMonth(),l=i.getDate();return a>n||(s>o||l>r)},t.getPropertyCount=function(t){var e,i=0;for(e in t)t.hasOwnProperty(e)&&i++;return i},t.difference=function(t,e){var i=[];if(t.constructor!==Array||e.constructor!==Array)return i;for(var n=t.length,o=0;o<n;o++)-1===e.indexOf(t[o])&&i.push(t[o]);return i},t._stringToArray=function(t){var e,i="\\ufe0e\\ufe0f",n="\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff",o=RegExp("[\\u200d\\ud800-\\udfff"+n+i+"]"),r="\\ud83c[\\udffb-\\udfff]",a="[\\ufe0e\\ufe0f]?",s="["+n+"]",l="(?:"+s+"|"+r+")"+"?",c="[\\ud800-\\udfff]",u="[^\\ud800-\\udfff]",h="(?:\\ud83c[\\udde6-\\uddff]){2}",p="[\\ud800-\\udbff][\\udc00-\\udfff]",d=a+l+("(?:\\u200d(?:"+[u,h,p].join("|")+")"+a+l+")*"),f="(?:"+[u+s+"?",s,h,p,c].join("|")+")",g=RegExp(r+"(?="+r+")|"+f+d,"g");return e=t,o.test(e)?function(t){return t.match(g)||[]}(t):function(t){return t.split("")}(t)},t.simulationUUID=function(){function t(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return t()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t()},t.trim=function(t){return t.replace(/(^\s*)|(\s*$)/g,"")},t.isNowValid=function(t,e){var i=new Date(t),n=new Date(e),o=!1;if(i.getDate()+""!="NaN"&&n.getDate()+""!="NaN"){var r=new Date;o=r<n&&r>i}return o},t.getDeltaDays=function(t,e){t=new Date(t),e=new Date(e);var i=t.getFullYear(),n=t.getMonth()+1,o=t.getDate(),r=e.getFullYear(),a=e.getMonth()+1,s=e.getDate();t=new Date(i+"/"+n+"/"+o+" GMT+0800").getTime();var l=(e=new Date(r+"/"+a+"/"+s+" GMT+0800").getTime())-t;return Math.floor(l/864e5)},t.getUserTimezone=function(){var t=(new Date).getTimezoneOffset(),e=Math.abs(t/60),i=Math.abs(t%60);return"GMT"+(t>0?"-":"+")+String(e)+String(i)},t.getMin=function(t){var e=null;if(t.constructor===Array)for(var i=t.length,n=0;n<i;n++)e=0===n?Number(t[0]):e>Number(t[n])?Number(t[n]):e;return e},t.formatTwoDigits=function(t){return(Array(2).join(0)+t).slice(-2)},t.getRemainingTime=function(t,e){if(!e)return{string:"",isZero:!0,remainSeconds:0};var i=1e3,n=6e4,o=36e5,r=864e5,a=e.getTime()-t.getTime(),s=Math.floor(a/r),l=Math.floor(a%r/o),c=Math.floor(a%o/n),u=Math.floor(a%n/i),h=a<=0,p=function(t){return t<10?"0"+t:t+""},d=(s>0?p(s)+":":"")+p(l)+":"+p(c)+":"+p(u);return s<=0&&l<=0&&c<=0&&u<=10&&(d=p(u)),{string:d,isZero:h,remainSeconds:a/i}},t.formatDate=function(t,e){e.includes("MMMM")?e=e.replace("MMMM",["January","February","March","April","May","June","July","August","September","October","November","December"][t.getMonth()]):e.includes("MMM")&&(e=e.replace("MMM",["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][t.getMonth()]));var i={"Y+":t.getFullYear(),"M+":t.getMonth()+1,"d+":t.getDate(),"h+":t.getHours(),"m+":t.getMinutes(),"s+":t.getSeconds(),"q+":Math.floor((t.getMonth()+3)/3),S:t.getMilliseconds()};for(var n in/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(t.getFullYear()+"").substr(4-RegExp.$1.length))),i)new RegExp("("+n+")").test(e)&&(e=e.replace(RegExp.$1,1===RegExp.$1.length?i[n].toString():("00"+i[n]).substr((""+i[n]).length)));return e},t.getDay=function(){var t=new Date;return t.getFullYear()+"-"+(t.getMonth()+1)+"-"+t.getDate()},t.formatName=function(t,e){e=e||6;var i=this._stringToArray(t),n="";if(i.length>e){for(var o=0;o<e;o++)n+=i[o];n+="..."}else n=t;return n},t.formatMoney=function(t){for(var e=["","K","M","G","T","P","E","Z","Y","B","N","D"],i="",n=0;n<e.length;n++){if(!(t>=1e4)){i=Math.floor(t).toLocaleString()+e[n];break}t/=1e3}return""===i&&(i=Math.floor(t)+"U"),i.replace(/\B(?=(\d{3})+(?!\d))/g,",")},t.formatValue=function(t){for(var e=[],i="",n=0;n<26;n++)e.push(String.fromCharCode(97+n));for(var o=0;o<e.length;o++){if(!(t>=1e4)){i=Math.floor(t)+e[o];break}t/=1e3}return i},t.formatTimeForSecond=function(t,e){void 0===e&&(e=!1);var i="",n=t%60,o=Math.floor(t/60);o=o<0?0:o;var r=Math.floor(o/60),a=o%60;return r>0?(i+=r>9?r.toString():"0"+r,i+=":"):i+="00:",i+=a>9?a.toString():"0"+a,e||(i+=":",i+=n>9?n.toString():"0"+n),i},t.formatTimeForMillisecond=function(t){var e=Math.floor(t/1e3%60),i=Math.floor(t/1e3/60%60);return{hour:Math.floor(t/1e3/60/60),minute:i,second:e}},t.rand=function(t){for(var e=this.clone(t),i=e.length-1;i>=0;i--){var n=Math.floor(Math.random()*(i+1)),o=e[n];e[n]=e[i],e[i]=o}return e},t.getOffsetMimutes=function(t,e){var i=e-t;return Math.floor(i%36e5/6e4)},t.formatNumToFixed=function(t,e){return void 0===e&&(e=0),Number(t.toFixed(e))},t.lerp=function(t,e,i){void 0===i&&(i=.25);var n=e;return t>e?n=e+(t-e)*i:t<e&&(n=e-(e-t)*i),n},t.decrypt=function(t){var e=6;t.length%2==0&&(e=7);for(var i="",n=0;n<t.length-e;n+=2)i+=t[n+1],i+=t[n];return i+=t.slice(t.length-e+1),i=this._base64Decode(i)},t.encrypt=function(t){var e=this._base64encode(t),i=6;e.length%2==0&&(i=7);for(var n="",o=0;o<(e.length-i+1)/2;o++)n+=e[2*o+1],n+=e[2*o];return n+=e.slice(e.length-i+1)},t._base64encode=function(t){var e,i,n,o,r,a,s,l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",c="",u=0;for(t=this._utf8Encode(t);u<t.length;)o=(e=t.charCodeAt(u++))>>2,r=(3&e)<<4|(i=t.charCodeAt(u++))>>4,a=(15&i)<<2|(n=t.charCodeAt(u++))>>6,s=63&n,isNaN(i)?a=s=64:isNaN(n)&&(s=64),c=c+l.charAt(o)+l.charAt(r)+l.charAt(a)+l.charAt(s);return c},t._utf8Encode=function(t){t=t.replace(/\r\n/g,"\n");for(var e="",i=0;i<t.length;i++){var n=t.charCodeAt(i);n<128?e+=String.fromCharCode(n):n>127&&n<2048?(e+=String.fromCharCode(n>>6|192),e+=String.fromCharCode(63&n|128)):(e+=String.fromCharCode(n>>12|224),e+=String.fromCharCode(n>>6&63|128),e+=String.fromCharCode(63&n|128))}return e},t._utf8Decode=function(t){for(var e="",i=0,n=0,o=0,r=0;i<t.length;)(n=t.charCodeAt(i))<128?(e+=String.fromCharCode(n),i++):n>191&&n<224?(o=t.charCodeAt(i+1),e+=String.fromCharCode((31&n)<<6|63&o),i+=2):(o=t.charCodeAt(i+1),r=t.charCodeAt(i+2),e+=String.fromCharCode((15&n)<<12|(63&o)<<6|63&r),i+=3);return e},t._base64Decode=function(t){var e,i,n,o,r,a,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",l="",c=0;for(t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");c<t.length;)e=s.indexOf(t.charAt(c++))<<2|(o=s.indexOf(t.charAt(c++)))>>4,i=(15&o)<<4|(r=s.indexOf(t.charAt(c++)))>>2,n=(3&r)<<6|(a=s.indexOf(t.charAt(c++))),l+=String.fromCharCode(e),64!=r&&(l+=String.fromCharCode(i)),64!=a&&(l+=String.fromCharCode(n));return l=this._utf8Decode(l)},t.checkIsLowPhone=function(){if(window.wx){var t=-1,e=window.wx.getSystemInfoSync();if(e.system.indexOf("iOS")>=0){for(var i=e.model,n=["iPhone1,1","iPhone1,2","iPhone2,1","iPhone3,1","iPhone3,3","iPhone4,1","iPhone5,1","iPhone5,2","iPhone5,3","iPhone5,4","iPhone6,1","iPhone6,2"],o=["iPhone6,2","iPhone7,1","iPhone7,2","iPhone8,1","iPhone8,2","iPhone8,4"],r=["iPhone9,1","iPhone9,2","iPhone9,3","iPhone9,4","iPhone10,1","iPhone10,2","iPhone10,3","iPhone10,4","iPhone10,5","iPhone10,6"],a=["iPhone11,2","iPhone11,4","iPhone11,6","iPhone11,8","iPhone12,1","iPhone12,3","iPhone12,5","iPhone12,8"],s=0;s<n.length;s++)i.indexOf(n[s])>=0&&(t=5);for(var l=0;l<o.length;l++)i.indexOf(o[l])>=0&&(t=10);for(var c=0;c<r.length;c++)i.indexOf(r[c])>=0&&(t=20);for(var u=0;u<a.length;u++)i.indexOf(a[u])>=0&&(t=30)}else t=e.benchmarkLevel;return t<22}return!1},t.truncateString=function(t,e,i,n){return void 0===e&&(e=15),void 0===i&&(i=5),void 0===n&&(n=5),t.length<=e?t:t.slice(0,i)+"..."+t.slice(-n)},t.getVectorString=function(t){return t.x.toFixed(2)+"-"+t.y.toFixed(2)},t.getCoorKey=function(t,e){return t+"_"+e},t}()).getUrlkeyValue=function(t){var e=window.location.href,i=new URL(e);return i.searchParams.has(t)?i.searchParams.get(t):""},Ee.getAngle=function(t){return t<0?360+t%360:t>360?t%360:t},Ee.getPointText=function(t,e){return e<=0?t+"":t+"(<color=green>"+e+"</color>)"},Ee.getGuildShortName=function(t){var e=t.split(" "),i="";return e.forEach((function(t){return i+=t[0]})),i.toUpperCase()},Ee.capitalizeWords=function(t){return t.toLowerCase().replace(/\b\w/g,(function(t){return t.toUpperCase()}))},Ce=Ee))||Ce);t._RF.pop(),t._RF.push({},"d3e939wqpFGLblmd/OMduC5","UITimer",void 0);var Ie,xe,Re,Le,Ne,Fe=e.ccclass,De=(e.property,e.requireComponent);Fe("UITimer")(Ae=De(y)(Ae=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).label=null,e.endTime=0,e.callback=null,e.scheduleCountingDown=-1,e}Ot(e,t);var i=e.prototype;return i.onLoad=function(){this.label=this.getComponent(y)},i.onEnable=function(){this.endTime>0&&this.startCountingDown(this.endTime,this.callback)},i.onDisable=function(){this.stopCountingEventDown()},i.startCountingDown=function(t,e){var i=this;this.endTime=t,this.callback=e;var n=t-Date.now();if(n<=0)null==e||e();else{var o=Math.round(n/1e3)+1;this.stopCountingEventDown(),function t(){if(--o<0)null==e||e();else{var n=Oe.formatTimeForSecond(o);i.label&&(i.label.string=n),i.scheduleCountingDown=setTimeout((function(){t()}),1e3)}}()}},i.stopCountingEventDown=function(){clearTimeout(this.scheduleCountingDown)},e}(r))||Ae);t._RF.pop(),t._RF.push({},"c5c0fR4sOtBf6AVBLMy1WNE","VisiblePanel",void 0);var ke=e.ccclass,ze=e.property,Ve=(Ie=ke("VisiblePanel"),xe=ze({type:c,group:"VisiblePanel"}),Ie((Ne=Mt((Le=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,It(e,"indicator",Ne,xt(e)),e.opMain=null,e.onVisibleChanged=void 0,e.tweenOpacity=null,e}Ot(e,t);var i=e.prototype;return i.setPanelVisible=function(t,e,i){var n,o=this;void 0===e&&(e=.35),void 0===i&&(i=!0),this.opMain||(this.opMain=this.getComponent(b),null==this.opMain&&(this.opMain=this.addComponent(b))),e<=0&&(this.opMain.opacity=t?255:0),t&&i&&(this.node.active=!0,this.indicator&&(this.indicator.active=!0)),this.opMain.opacity=t?0:255,null==(n=this.tweenOpacity)||n.stop(),this.tweenOpacity=v(this.opMain).to(e,{opacity:t?255:0}).call((function(){!t&&i&&(o.node.active=!1,o.indicator&&(o.indicator.active=!1)),o.visibleChanged(t)})).start()},i.visibleChanged=function(t){var e;null==(e=this.onVisibleChanged)||e.call(this,t)},e}(r)).prototype,"indicator",[xe],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Re=Le))||Re);t._RF.pop(),t._RF.push({},"6cbe82sbBRJZ5dw448hn0pZ","Defines",void 0);var Be=function(t){return t[t.NONE=0]="NONE",t[t.TOUCH=1]="TOUCH",t[t.DRAG=2]="DRAG",t[t.ZOOM=3]="ZOOM",t[t.SWIPE=4]="SWIPE",t[t.HOVER=5]="HOVER",t[t.DOUBLE_TOUCH=6]="DOUBLE_TOUCH",t[t.END_INTERACTED=7]="END_INTERACTED",t}({}),He=function(t){return t[t.NONE=0]="NONE",t[t.HIDE=1]="HIDE",t[t.SHOW=2]="SHOW",t}({});t._RF.pop(),t._RF.push({},"996b7qdfwFAPbtK5uluV2M2","easing",void 0);var Ue,Ge,We=function(t){return t[t.Linear=0]="Linear",t[t.SineIn=1]="SineIn",t[t.SineOut=2]="SineOut",t[t.SineInOut=3]="SineInOut",t[t.QuadIn=4]="QuadIn",t[t.QuadOut=5]="QuadOut",t[t.QuadInOut=6]="QuadInOut",t[t.CubicIn=7]="CubicIn",t[t.CubicOut=8]="CubicOut",t[t.CubicInOut=9]="CubicInOut",t[t.QuartIn=10]="QuartIn",t[t.QuartOut=11]="QuartOut",t[t.QuartInOut=12]="QuartInOut",t[t.QuintIn=13]="QuintIn",t[t.QuintOut=14]="QuintOut",t[t.QuintInOut=15]="QuintInOut",t[t.ExpoIn=16]="ExpoIn",t[t.ExpoOut=17]="ExpoOut",t[t.ExpoInOut=18]="ExpoInOut",t[t.CircIn=19]="CircIn",t[t.CircOut=20]="CircOut",t[t.CircInOut=21]="CircInOut",t[t.ElasticIn=22]="ElasticIn",t[t.ElasticOut=23]="ElasticOut",t[t.ElasticInOut=24]="ElasticInOut",t[t.BackIn=25]="BackIn",t[t.BackOut=26]="BackOut",t[t.BackInOut=27]="BackInOut",t[t.BounceIn=28]="BounceIn",t[t.BounceOut=29]="BounceOut",t[t.BounceInOut=30]="BounceInOut",t}({});function Ze(t){var e;return((e={})[We.Linear]=_.linear,e[We.SineIn]=_.sineIn,e[We.SineOut]=_.sineOut,e[We.SineInOut]=_.sineInOut,e[We.QuadIn]=_.quadIn,e[We.QuadOut]=_.quadOut,e[We.QuadInOut]=_.quadInOut,e[We.CubicIn]=_.cubicIn,e[We.CubicOut]=_.cubicOut,e[We.CubicInOut]=_.cubicInOut,e[We.QuartIn]=_.quartIn,e[We.QuartOut]=_.quartOut,e[We.QuartInOut]=_.quartInOut,e[We.QuintIn]=_.quintIn,e[We.QuintOut]=_.quintOut,e[We.QuintInOut]=_.quintInOut,e[We.ExpoIn]=_.expoIn,e[We.ExpoOut]=_.expoOut,e[We.ExpoInOut]=_.expoInOut,e[We.CircIn]=_.circIn,e[We.CircOut]=_.circOut,e[We.CircInOut]=_.circInOut,e[We.ElasticIn]=_.elasticIn,e[We.ElasticOut]=_.elasticOut,e[We.ElasticInOut]=_.elasticInOut,e[We.BackIn]=_.backIn,e[We.BackOut]=_.backOut,e[We.BackInOut]=_.backInOut,e[We.BounceIn]=_.bounceIn,e[We.BounceOut]=_.bounceOut,e[We.BounceInOut]=_.bounceInOut,e)[t]}t._RF.pop(),t._RF.push({},"5e557ZxbcNFsbXuz8xq4hnD","storageManager",void 0);var Ye,qe,je=e.ccclass,Ke=(e.property,je("StorageManager")(((Ge=function(){function t(){this._jsonData={},this._path=null,this.KEY_CONFIG="coindfo",this._markSave=!1,this._saveTimer=-1}var e=t.prototype;return e.start=function(){var t;(this._jsonData={userId:""},this._path=this._getConfigPath(),S.isNative)?t=w.fileUtils.getValueMapFromFile(this._path)[this.KEY_CONFIG]:t=S.localStorage.getItem(this.KEY_CONFIG);if(t&&t.length){t.startsWith("@")&&(t=t.substring(1),t=Oe.decrypt(t));try{var e=JSON.parse(t);this._jsonData=e}catch(t){}}},e.setConfigDataWithoutSave=function(t,e){var i=this._jsonData.userId;this._jsonData[i]?this._jsonData[i][t]=e:console.error("no account can not save")},e.setConfigData=function(t,e){this.setConfigDataWithoutSave(t,e),this._markSave=!0},e.getConfigData=function(t){var e=this._jsonData.userId;if(this._jsonData[e]){var i=this._jsonData[e][t];return i||""}return T("no account can not load"),""},e.removeGlobalData=function(t){delete this._jsonData[t]},e.setGlobalData=function(t,e){this._jsonData[t]=e,this.save()},e.getGlobalData=function(t){return this._jsonData[t]},e.setUserId=function(t){this._jsonData.userId=t,this._jsonData[t]||(this._jsonData[t]={}),this.save()},e.getUserId=function(){return this._jsonData.userId},e.scheduleSave=function(){this._markSave&&this.save()},e.markModified=function(){this._markSave=!0},e.save=function(){var t=JSON.stringify(this._jsonData),e="@"+Oe.encrypt(t);if(this._markSave=!1,S.isNative){var i={};i[this.KEY_CONFIG]=e,w.fileUtils.writeValueMapToFile(i,this._getConfigPath())}else{S.localStorage.setItem(this.KEY_CONFIG,e)}},e._getConfigPath=function(){var t=S.platform,e="";return t===S.OS.WINDOWS?e="src/conf":t===S.OS.LINUX?e="./conf":S.isNative?(e=w.fileUtils.getWritablePath(),e+="conf"):e="src/conf",e},Nt(t,null,[{key:"instance",get:function(){return this._instance||(this._instance=new t,this._instance.start()),this._instance}}]),t}())._instance=void 0,Ue=Ge))||Ue);t._RF.pop(),t._RF.push({},"f11da56ne5J4oRL4Avag26V","resourceUtil",void 0);var Xe,Qe,Je=(0,e.ccclass)("resourceUtil")(((qe=function(){function t(){}return t.loadRes=function(t,e,i){var n=this;void 0===i&&(i=function(){}),this.resLoadedMap.has(t)?i&&i(null,this.resLoadedMap.get(t)):a.load(t,(function(e,o){return e?(C(e.message||e),void i(e,o)):o?(n.resLoadedMap.set(t,o),void(i&&i(null,o))):(C("res not found"),void i("res not found",o))}))},t.loadResNoCache=function(t,e,i){var n=this;void 0===i&&(i=function(){}),a.load(t,(function(e,o){if(e)return C(e.message||e),void i(e,o);n.resLoadedMap.set(t,o),i&&i(null,o)}))},t.loadEffectRes=function(t){var e=this;return new Promise((function(i,n){e.loadRes("prefab/effect/"+t,l,(function(e,o){if(e)return console.error("effect load failed",t),void(n&&n());i&&i(o)}))}))},t.loadModelResArr=function(t,e,i,n){var o=e.map((function(e){return t+"/"+e}));a.load(o,l,i,n)},t.loadResArr=function(t,e,i){a.load(t,l,e,i)},t.loadSpriteFrameRes=function(t){var e=this;return new Promise((function(n,o){e.loadRes(t,i,(function(e,r){if(e)return console.error("spriteFrame load failed!",t,e),void(o&&o());var a=new p;a.image=r;var s=new i;s.texture=a,n&&n(s)}))}))},t.getMap=function(t,e){var i="map";i+=t>=100?t:t>=10?"0"+t:"00"+t,this.loadRes("map/config/"+i,null,(function(t,i){if(t)e(t,i);else{var n="";if(i._file){window.LZString&&(n=window.LZString.decompressFromEncodedURIComponent(i._file));var o=JSON.parse(n);e(null,o)}else if(i.text){window.LZString&&(n=window.LZString.decompressFromEncodedURIComponent(i.text));o=JSON.parse(n);e(null,o)}else i.json?e(null,i.json):e("failed")}}))},t.getMapObj=function(t,e,i,n){for(var o=[],r=0;r<e.length;r++)o.push("map/"+t+"/"+e[r]);a.load(o,l,i,n)},t.getUIPrefabRes=function(t,e){this.loadRes("prefab/ui/"+t,l,e)},t.createUI=function(t,e,i,n){void 0===n&&(n="Canvas/Popup"),this.getUIPrefabRes(t,(function(t,o){if(!t){var r=E(o);r.setPosition(0,0,0),i||(i=P(n))||((i=P("Canvas"))||(i=P("/Canvas")),i||console.error("Canvas node not found in the scene")),i?(i.addChild(r),e&&e(null,r)):e&&e(null,r)}}))},t.preloadUI=function(t,e){this.getUIPrefabRes(t,(function(t,i){if(t)e&&e(t,null);else{var n=E(i);e&&e(null,n)}}))},t.getJsonData=function(t,e){this.loadRes("datas/"+t,null,(function(t,i){t?C(t.message||t):i.json?e(t,i.json):e("failed!!!")}))},t.getTextData=function(t,e){this.loadRes("datas/"+t,null,(function(t,i){if(t)C(t.message||t);else{var n=i.text;e(t,n)}}))},t.setSpriteFrame=function(t,e,i){a.load(t,(function(t,n){if(t)return C(t.message||t),void i(t,n);e&&A(e)&&(e.spriteFrame=n,null==i||i(null))}))},t.setSpriteFrameFromAtlas=function(t,e,i,n){a.load(t,h,(function(o,r){if(o)return console.error("set sprite frame form atlas failed! err:",t,o),void(null==n||n(o));if(i&&A(i)){var a=r.getSpriteFrame(e);i.spriteFrame=a,null==n||n(null)}}))},t.setSpriteFrameFromAutoAtlas=function(t,e,n,o){a.load(t+"/"+e,i,(function(e,i){if(e)return console.error("set sprite frame form atlas failed! err:",t,e),void(null==o||o(e));n&&A(n)&&(n.spriteFrame=i,null==o||o(null))}))},t.loadAndConvertSpriteFrame=function(t,e,n){this.loadRes(t,i,(function(o,r){if(o)return console.error("set sprite frame failed! err:",t,o),void(null==n||n(o));var a=new p;a.image=r;var s=new i;s.texture=a,s&&A(s)&&(e.spriteFrame=s,null==n||n(null))}))},t.setSpriteFrameRenderer=function(t,e,n){this.loadRes(t,i,(function(o,r){if(o)return console.error("set sprite frame failed! err:",t,o),void(null==n||n(o));var a=new p;a.image=r;var s=new i;s.texture=a,s&&A(s)&&(e.spriteFrame=s,null==n||n(null))}))},t.loadAllResources=function(t,e){a.loadDir(t,(function(t,i){t?console.error("Error loading resources: ",t):e(i)}))},t.loadAllSprites=function(t,e){a.loadDir(t,(function(t,n){if(t)console.error("Error loading resources: ",t);else{var o=n.filter((function(t){return t instanceof i}));e(o)}}))},t}()).resLoadedMap=new Map,Ye=qe))||Ye;t._RF.pop(),t._RF.push({},"d7ecda770NLF4OP1Afz5O5u","audioManager",void 0);var $e,ti,ei,ii,ni,oi,ri,ai,si,li,ci,ui,hi,pi,di,fi,gi,mi,vi,yi,bi,_i,Si,wi,Ti,Ci,Ei,Pi,Ai,Mi,Oi,Ii,xi,Ri,Li,Ni,Fi,Di,ki,zi,Vi,Bi,Hi,Ui,Gi,Wi,Zi,Yi=e.ccclass,qi=(e.property,Yi("AudioManager")(((Qe=function(){function t(){this.audioMap=new Map,this._persistRootNode=null,this._audioSources=[],this.dictWeaponSoundIndex={},this.bgmVolume=.8,this.sfxVolume=1,this.audios={},this.arrSound=[],this.BGM_VOLUME=.35,this.SFX_VOLUME=.75,this.asMusic=null,this.curGetSFXSourceIndex=0,this.tweenFadeMusic=null,this.init()}var e=t.prototype;return e.init=function(){if(!this._persistRootNode){this._persistRootNode=new c("audio"),M.getScene().addChild(this._persistRootNode),O.addPersistRootNode(this._persistRootNode),this.asMusic=this._persistRootNode.addComponent(I);for(var t=0;t<15;t++)this._audioSources.push(this._persistRootNode.addComponent(I));this.bgmVolume=this.getAudioSetting(!0),this.sfxVolume=this.getAudioSetting(!1),this.audioMap.clear()}},e.getAudioSetting=function(t){var e,i,n;t?e=null!=(i=Ke.instance.getGlobalData(me.STORAGE_KEY.BGM_VOLUME))?i:this.BGM_VOLUME:e=null!=(n=Ke.instance.getGlobalData(me.STORAGE_KEY.SFX_VOLUME))?n:this.SFX_VOLUME;return e},e.setBGMProgress=function(t){this.bgmVolume=t*this.BGM_VOLUME,Ke.instance.setGlobalData(me.STORAGE_KEY.BGM_VOLUME,this.bgmVolume)},e.setSFXProgress=function(t){this.sfxVolume=t*this.SFX_VOLUME,Ke.instance.setGlobalData(me.STORAGE_KEY.SFX_VOLUME,this.sfxVolume)},e.getSound=function(t){return this.audioMap.has(t)?this.audioMap.get(t):null},e.playMusic=function(t,e){var i=this,n=this.asMusic,o="sounds/bgm/"+t;return Je.loadRes(o,x,(function(o,r){if(o)ve.LOG&&console.error(o);else{if(!r)return null;var a={source:n,isMusic:!0};i.audios[t]=a,n.stop(),n.clip=r,n.volume=i.bgmVolume,n.loop=e,n.play()}})),n},e.setMusicFade=function(t,e,i){var n,o=this;void 0===e&&(e=.5),void 0===i&&(i=null);var r=t?0:1,a=t?1:0,s=a-r,l={value:r};null==(n=this.tweenFadeMusic)||n.stop(),this.tweenFadeMusic=v(l).to(e,{value:a},{easing:_.linear,progress:function(t,e,i,n){var a;return a=r+n*s,o.asMusic&&o.bgmVolume&&(o.asMusic.volume=o.bgmVolume*a),0}}).call((function(){return null==i?void 0:i()})).start()},e.dimAllSounds=function(){this._audioSources.forEach((function(t){t.volume=0}))},e.playSound=function(t,e){var i=this;if(void 0===e&&(e=1),this.sfxVolume){this.curGetSFXSourceIndex=++this.curGetSFXSourceIndex%this._audioSources.length;var n=this._audioSources[this.curGetSFXSourceIndex],o="sounds/sfx/"+t;return Je.loadRes(o,x,(function(t,o){t?ve.LOG&&console.error(t):o&&(n.stop(),n.clip=o,n.currentTime=0,n.volume=i.sfxVolume*e,n.play())})),n}},e.stop=function(t){if(this.audios.hasOwnProperty(t)){var e=this.audios[t];e.source.stop(),e.source.volume=0}},e.stopAll=function(){for(var t in this.audios)if(this.audios.hasOwnProperty(t)){var e=this.audios[t];e.source.stop(),e.source.clip=null}this.asMusic.stop(),this.asMusic.clip=null},e.getMusicVolume=function(){return this.bgmVolume},e.setMusic=function(t){var e=t*this.BGM_VOLUME;Ke.instance.setGlobalData(me.STORAGE_KEY.BGM_VOLUME,e),this.bgmVolume=e,this.asMusic.volume=this.bgmVolume},e.pauseAll=function(){for(var t in ve.LOG&&console.log("pause all music!!!"),this.audios){if(this.audios.hasOwnProperty(t))this.audios[t].source.pause()}},e.resumeAll=function(){for(var t in this.audios){if(this.audios.hasOwnProperty(t))this.audios[t].source.play()}},e.setSound=function(t){var e=t*this.SFX_VOLUME;for(var i in Ke.instance.setGlobalData(me.STORAGE_KEY.SFX_VOLUME,e),this.sfxVolume=e,this.audios){if(this.audios.hasOwnProperty(i)&&!this.audios[i].isMusic)this.audios[i].source.volume=this.sfxVolume}for(var n=0;n<this.arrSound.length;n++){this.arrSound[n].source.volume=this.sfxVolume}},e.stopSingleSound=function(t){this.audios.hasOwnProperty(t)&&!this.audios[t].isMusic&&this.audios[t].source.stop()},Nt(t,[{key:"bgmProgress",get:function(){return this.bgmVolume/this.BGM_VOLUME}},{key:"sfxProgress",get:function(){return this.sfxVolume/this.SFX_VOLUME}}]),t}()).instance=void 0,Xe=Qe))||Xe);t._RF.pop(),t._RF.push({},"0ade8jDYZpLPZyun6PIe4u6","AnimationPanel",void 0);var ji,Ki,Xi,Qi=e.ccclass,Ji=e.property,$i=($e=Qi("AnimationPanel"),ti=Ji({group:{name:"Animation Settings",id:"animation"},tooltip:"Enable to customize animation settings"}),ei=Ji({type:R(He),group:{name:"Animation Settings",id:"animation"},tooltip:"Initial state of the panel",visible:function(){return this.isShowPopupsetting}}),ii=Ji({type:g,group:{name:"Animation Settings",id:"animation"},tooltip:"Initial position of the panel",visible:function(){return this.isShowPopupsetting}}),ni=Ji({group:{name:"Show Animation",id:"show"},tooltip:"Starting X position for show animation",visible:function(){return this.isShowPopupsetting}}),oi=Ji({group:{name:"Show Animation",id:"show"},tooltip:"Starting Y position for show animation",visible:function(){return this.isShowPopupsetting}}),ri=Ji({group:{name:"Show Animation",id:"show"},tooltip:"Starting scale for show animation",visible:function(){return this.isShowPopupsetting}}),ai=Ji({type:R(We),group:{name:"Show Animation",id:"show"},tooltip:"Easing function for show animation",visible:function(){return this.isShowPopupsetting}}),si=Ji({group:{name:"Hide Animation",id:"hide"},tooltip:"Ending X position for hide animation",visible:function(){return this.isShowPopupsetting}}),li=Ji({group:{name:"Hide Animation",id:"hide"},tooltip:"Ending Y position for hide animation",visible:function(){return this.isShowPopupsetting}}),ci=Ji({group:{name:"Hide Animation",id:"hide"},tooltip:"Ending scale for hide animation",visible:function(){return this.isShowPopupsetting}}),ui=Ji({type:R(We),group:{name:"Hide Animation",id:"hide"},tooltip:"Easing function for hide animation",visible:function(){return this.isShowPopupsetting}}),hi=Ji({group:{name:"Additional Settings",id:"additional"},tooltip:"Duration of show animation in seconds",visible:function(){return this.isShowPopupsetting}}),pi=Ji({group:{name:"Additional Settings",id:"additional"},tooltip:"Duration of hide animation in seconds",visible:function(){return this.isShowPopupsetting}}),di=Ji({group:{name:"Additional Settings",id:"additional"},tooltip:"Enable rotation animation",visible:function(){return this.isShowPopupsetting}}),fi=Ji({group:{name:"Additional Settings",id:"additional"},tooltip:"Starting rotation for show animation (in degrees)",visible:function(){return this.isShowPopupsetting&&this.enableRotation}}),gi=Ji({group:{name:"Additional Settings",id:"additional"},tooltip:"Ending rotation for hide animation (in degrees)",visible:function(){return this.isShowPopupsetting&&this.enableRotation}}),mi=Ji({group:{name:"Additional Settings",id:"additional"},tooltip:"Enable opacity animation",visible:function(){return this.isShowPopupsetting}}),vi=Ji({group:{name:"Additional Settings",id:"additional"},tooltip:"Starting opacity for show animation (0-255)",visible:function(){return this.isShowPopupsetting&&this.enableOpacity}}),yi=Ji({group:{name:"Additional Settings",id:"additional"},tooltip:"Ending opacity for hide animation (0-255)",visible:function(){return this.isShowPopupsetting&&this.enableOpacity}}),bi=Ji({type:Ve,group:{name:"Background Settings",id:"background"},tooltip:"Background panel that dims when this panel is shown",visible:function(){return this.isShowPopupsetting}}),_i=Ji({group:{name:"Background Settings",id:"background"},tooltip:"Duration of background dim animation in seconds",visible:function(){return this.isShowPopupsetting}}),Si=Ji({group:{name:"Audio Settings",id:"audio"},tooltip:"Sound effect to play when panel is shown"}),$e((Ci=Mt((Ti=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,It(e,"isShowPopupsetting",Ci,xt(e)),It(e,"beginType",Ei,xt(e)),It(e,"beginPosition",Pi,xt(e)),It(e,"showFromPosX",Ai,xt(e)),It(e,"showFromPosY",Mi,xt(e)),It(e,"showFromScale",Oi,xt(e)),It(e,"showEasingType",Ii,xt(e)),It(e,"hideToPosX",xi,xt(e)),It(e,"hideToPosY",Ri,xt(e)),It(e,"hideToScale",Li,xt(e)),It(e,"hideEasingType",Ni,xt(e)),It(e,"showDuration",Fi,xt(e)),It(e,"hideDuration",Di,xt(e)),It(e,"enableRotation",ki,xt(e)),It(e,"showFromRotation",zi,xt(e)),It(e,"hideToRotation",Vi,xt(e)),It(e,"enableOpacity",Bi,xt(e)),It(e,"showFromOpacity",Hi,xt(e)),It(e,"hideToOpacity",Ui,xt(e)),It(e,"dimNode",Gi,xt(e)),It(e,"dimDuration",Wi,xt(e)),It(e,"shownAudioName",Zi,xt(e)),e.opMain=null,e.visibleIndex=-1,e.visibleTween=null,e.scheduleDim=null,e}Ot(e,t);var i=e.prototype;return i.onLoad=function(){var t,e;switch(this.node.setPosition(this.beginPosition),this.beginType){case He.NONE:this.visibleIndex=-1;break;case He.HIDE:this.visibleIndex=0,this.setPanelVisible(!1,0),null==(t=this.dimNode)||t.setPanelVisible(!1,0);break;case He.SHOW:this.visibleIndex=1,this.setPanelVisible(!0,0),null==(e=this.dimNode)||e.setPanelVisible(!0,0)}},i.setAnimVisible=function(t,e,i){void 0===e&&(e=null),void 0===i&&(i=.35),this.visibleIndex!=(t?1:0)?(this.visibleIndex=t?1:0,t?this.showAnimation(e,i):this.hideAnimation(e,i)):null==e||e()},i.showAnimation=function(t,e){var i;this.node.active=!0,this.node.position=m(this.showFromPosX,this.showFromPosY,0),this.node.setScale(m(this.showFromScale,this.showFromScale,this.showFromScale)),this.enableRotation&&this.node.setRotationFromEuler(0,0,this.showFromRotation),this.enableOpacity&&(this.opMain=this.getComponent(b)||this.addComponent(b),this.opMain.opacity=this.showFromOpacity),null==(i=this.visibleTween)||i.stop(),this.visibleTween=v(this.node),this.visibleTween.to(e,{position:g.ZERO},{easing:this.getEasingShowAnim()}),this.visibleTween.to(e,{scale:g.ONE},{easing:this.getEasingShowAnim()}),this.enableRotation&&this.visibleTween.to(e,{eulerAngles:new g(0,0,0)},{easing:this.getEasingShowAnim()}),this.enableOpacity&&v(this.opMain).to(e,{opacity:255},{easing:this.getEasingShowAnim()}).start(),this.visibleTween.call((function(){return null==t?void 0:t()})).start(),this.setDimBackground(!0,e,this.dimDuration)},i.hideAnimation=function(t,e){var i,n=this;null==(i=this.visibleTween)||i.stop(),this.visibleTween=v(this.node),this.visibleTween.to(e,{position:m(this.hideToPosX,this.hideToPosY,0)},{easing:this.getEasingHideAnim()}),this.visibleTween.to(e,{scale:m(this.hideToScale,this.hideToScale,this.hideToScale)},{easing:this.getEasingHideAnim()}),this.enableRotation&&this.visibleTween.to(e,{eulerAngles:new g(0,0,this.hideToRotation)},{easing:this.getEasingHideAnim()}),this.enableOpacity&&v(this.opMain).to(e,{opacity:this.hideToOpacity},{easing:this.getEasingHideAnim()}).start(),this.visibleTween.call((function(){n.node.active=!1,null==t||t()})).start(),this.setDimBackground(!1,0,this.dimDuration)},i.getEasingShowAnim=function(){return Ze(this.showEasingType)},i.getEasingHideAnim=function(){return Ze(this.hideEasingType)},i.setDimBackground=function(t,e,i){var n=this;void 0===i&&(i=.2),null!=this.dimNode&&(null!=this.scheduleDim&&this.unschedule(this.scheduleDim),this.scheduleDim=this.scheduleOnce((function(){return n.dimNode.setPanelVisible(t,i)}),e))},i.show=function(t,e){var i=this;this.shownAudioName&&1!=this.visibleIndex&&qi.instance.playSound(this.shownAudioName),this.setAnimVisible(!0,(function(){i.shown(),null==e||e()}),this.showDuration)},i.doShow=function(){this.show(null,void 0)},i.doHide=function(){this.hide(void 0)},i.hide=function(t){var e=this;this.setAnimVisible(!1,(function(){e.hided(),null==t||t()}),this.hideDuration)},i.shown=function(){},i.hided=function(){},i.onKeyDown=function(t){0!=this.isEscable&&t.keyCode===L.ESCAPE&&this.doHide()},i.onTouch_Close=function(){this.doHide()},Nt(e,[{key:"isShowing",get:function(){return 1==this.visibleIndex}},{key:"isEscable",get:function(){return!1}}]),e}(Ve)).prototype,"isShowPopupsetting",[ti],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Ei=Mt(Ti.prototype,"beginType",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return He.NONE}}),Pi=Mt(Ti.prototype,"beginPosition",[ii],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return m(0,0,0)}}),Ai=Mt(Ti.prototype,"showFromPosX",[ni],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-1080}}),Mi=Mt(Ti.prototype,"showFromPosY",[oi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Oi=Mt(Ti.prototype,"showFromScale",[ri],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),Ii=Mt(Ti.prototype,"showEasingType",[ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return We.BackOut}}),xi=Mt(Ti.prototype,"hideToPosX",[si],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1080}}),Ri=Mt(Ti.prototype,"hideToPosY",[li],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Li=Mt(Ti.prototype,"hideToScale",[ci],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Ni=Mt(Ti.prototype,"hideEasingType",[ui],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return We.BackIn}}),Fi=Mt(Ti.prototype,"showDuration",[hi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.35}}),Di=Mt(Ti.prototype,"hideDuration",[pi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.25}}),ki=Mt(Ti.prototype,"enableRotation",[di],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),zi=Mt(Ti.prototype,"showFromRotation",[fi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-45}}),Vi=Mt(Ti.prototype,"hideToRotation",[gi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 45}}),Bi=Mt(Ti.prototype,"enableOpacity",[mi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Hi=Mt(Ti.prototype,"showFromOpacity",[vi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Ui=Mt(Ti.prototype,"hideToOpacity",[yi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Gi=Mt(Ti.prototype,"dimNode",[bi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Wi=Mt(Ti.prototype,"dimDuration",[_i],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.2}}),Zi=Mt(Ti.prototype,"shownAudioName",[Si],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),wi=Ti))||wi);t._RF.pop(),t._RF.push({},"9bf359IqNNOdo7v0PQCju2a","ButtonAutoSound",void 0);var tn,en,nn,on,rn,an=e.ccclass,sn=e.property;an("ButtonAutoSound")((Xi=Mt((Ki=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,It(e,"audioName",Xi,xt(e)),e}Ot(e,t);var i=e.prototype;return i.onLoad=function(){var t=this.getComponent(N);if(t){var e=new F;e.target=this.node,e.component="ButtonAutoSound",e.handler="onButtonClicked",t.clickEvents.push(e)}},i.onButtonClicked=function(){var t;null==(t=qi.instance)||t.playSound(this.audioName)},e}(r)).prototype,"audioName",[sn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"A_Click_Menu"}}),ji=Ki));t._RF.pop(),t._RF.push({},"e01eb+jQTRNdbPwrEVkkCRc","HotKey",void 0);var ln,cn=e.ccclass,un=e.property,hn=(tn=cn("Hotkey"),en=un({type:[R(L)]}),tn((rn=Mt((on=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,It(e,"keys",rn,xt(e)),e.keyMap=new Map,e}Ot(e,t);var i=e.prototype;return i.onLoad=function(){var t=this;this.keys.forEach((function(e){return t.keyMap.set(e,!1)}))},i.getKeyString=function(){try{var t=L[this.keys[0]];if(t.length<=2)return t;var e=t.split("_");return e[e.length-1]}catch(t){return""}},i.onEnable=function(){D.on(k.EventType.KEY_DOWN,this.onKeyDown,this),D.on(k.EventType.KEY_UP,this.onKeyUp,this)},i.onDisable=function(){D.off(k.EventType.KEY_DOWN,this.onKeyDown,this),D.off(k.EventType.KEY_UP,this.onKeyUp,this)},i.onKeyDown=function(t){this.keyMap.has(t.keyCode)&&(this.keyMap.set(t.keyCode,!0),this.isKeyCombinationPressed()&&this.trigger())},i.onKeyUp=function(t){this.keyMap.has(t.keyCode)&&this.keyMap.set(t.keyCode,!1)},i.isKeyCombinationPressed=function(){var t=!0;return this.keyMap.forEach((function(e,i){e||(t=!1)})),t},i.trigger=function(){},e}(r)).prototype,"keys",[en],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),nn=on))||nn);t._RF.pop(),t._RF.push({},"099f7MZV3JPrp3nEUGlRKH5","ButtonHotKey",void 0);var pn,dn,fn=e.ccclass,gn=(e.property,fn("ButtonHotKey")(ln=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).button=null,e}Ot(e,t);var i=e.prototype;return i.onLoad=function(){t.prototype.onLoad.call(this),this.button=this.getComponent(N)},i.trigger=function(){t.prototype.trigger.call(this),this.button&&this.button.clickEvents.forEach((function(t){t.emit(null)}))},e}(hn))||ln);t._RF.pop(),t._RF.push({},"2d53e8mnhxHI4l+waizfjCg","EscHotkey",void 0);var mn,vn=e.ccclass;e.property,vn("EscHotkey")(((dn=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).index=0,e}Ot(e,t);var i=e.prototype;return i.onLoad=function(){this.keys=[L.ESCAPE],t.prototype.onLoad.call(this)},i.onEnable=function(){e.escIndex+=1,this.index=e.escIndex,t.prototype.onEnable.call(this)},i.onDisable=function(){e.escIndex-=1,this.index=-1,t.prototype.onDisable.call(this)},i.trigger=function(){e.escIndex<0||this.index==e.escIndex&&t.prototype.trigger.call(this)},e}(gn)).escIndex=-1,pn=dn));t._RF.pop(),t._RF.push({},"37345Pr89dKxKXe+sjSuW5N","ToggleHotKey",void 0);var yn,bn,_n,Sn,wn,Tn,Cn,En=e.ccclass;e.property,En("ToggleHotKey")(mn=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).toggle=null,e}Ot(e,t);var i=e.prototype;return i.onLoad=function(){t.prototype.onLoad.call(this),this.toggle=this.getComponent(z)},i.trigger=function(){t.prototype.trigger.call(this),this.toggle&&(this.toggle.isChecked=!this.toggle.isChecked,this.toggle.checkEvents.forEach((function(t){t.emit(null)})))},e}(hn));t._RF.pop(),t._RF.push({},"3d20epSqOJE7Yu882uRz4oI","UIHotkeyLabel",void 0);var Pn,An,Mn,On,In,xn=e.ccclass,Rn=e.property;yn=xn("UIHotkeyLabel"),bn=Rn(c),_n=Rn(y),yn((Tn=Mt((wn=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,It(e,"nodeMain",Tn,xt(e)),It(e,"lbMain",Cn,xt(e)),e.hotkey=null,e}Ot(e,t);var i=e.prototype;return i.onLoad=function(){this.hotkey=this.node.getComponent(hn),this.hotkey?(this.lbMain.string=this.hotkey.getKeyString(),Ht.on(me.EVENT_NAME.HOTKEY_STATE_CHANGED,this.updateHotKeyState,this),this.updateHotKeyState()):console.error("UIHotkeylabel the hotkey is null")},i.onDestroy=function(){Ht.off(me.EVENT_NAME.HOTKEY_STATE_CHANGED,this.updateHotKeyState,this)},i.updateHotKeyState=function(){var t,e=null!=(t=Ke.instance.getGlobalData(me.STORAGE_KEY.HOTKEY))&&t;this.nodeMain.active=e},e}(r)).prototype,"nodeMain",[bn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Cn=Mt(wn.prototype,"lbMain",[_n],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Sn=wn));t._RF.pop(),t._RF.push({},"05db20FCuhNgIZ/Of1+Usnv","InteractableItem",void 0);var Ln,Nn=e.ccclass,Fn=e.property;Pn=Nn("InteractableItem"),An=Fn(c),Pn((In=Mt((On=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,It(e,"nodeTouch",In,xt(e)),e.onSelected=null,e.onStart=null,e.onDrag=null,e.onHover=null,e.onEndInteracted=null,e.isInteracting=!1,e.passThroughNode=null,e.dragCount=0,e.interactNode=null,e.transform=null,e}Ot(e,t);var i=e.prototype;return i.setInteractable=function(t,e){var i;void 0===e&&(e=null),this.passThroughNode=e;var n=null!=(i=this.nodeTouch)?i:this.node;t?(n.on(V.TOUCH_END,this.onTouchEnd,this),n.on(V.TOUCH_START,this.onTouchStart,this),n.on(V.TOUCH_MOVE,this.onTouchMove,this),n.on(V.MOUSE_ENTER,this.onMouseHover,this),n.on(V.MOUSE_LEAVE,this.onMouseLeave,this)):(n.off(V.TOUCH_END,this.onTouchEnd,this),n.off(V.TOUCH_START,this.onTouchStart,this),n.off(V.TOUCH_MOVE,this.onTouchMove,this),n.off(V.MOUSE_ENTER,this.onMouseHover,this),n.off(V.MOUSE_LEAVE,this.onMouseLeave,this))},i.getTransform=function(){var t;null==this.transform&&(this.interactNode=null!=(t=this.nodeTouch)?t:this.node,this.transform=this.interactNode.getComponent(B));return this.transform},i.isContainsPosition=function(t){var e=this.getTransform().contentSize;return H(this.interactNode.position.x-e.width/2,this.interactNode.position.y-e.height/2,e.width,e.height).contains(t)},i.onTouchEnd=function(t){var e,i;this.dragCount<=4&&(null==(i=this.onSelected)||i.call(this,this));this.dragCount=0,this.isInteracting=!1,this.checkPassThroughNode(V.TOUCH_END,t),null==(e=this.onEndInteracted)||e.call(this,this)},i.onTouchStart=function(t){var e;this.dragCount=0,this.isInteracting=!0,this.checkPassThroughNode(V.TOUCH_START,t),null==(e=this.onStart)||e.call(this,this)},i.onTouchMove=function(t){var e;(this.dragCount++,this.checkPassThroughNode(V.TOUCH_MOVE,t),this.dragCount>=4)&&(null==(e=this.onDrag)||e.call(this,this))},i.onMouseHover=function(t){var e;this.checkPassThroughNode(V.MOUSE_ENTER,t),null==(e=this.onHover)||e.call(this,this)},i.onMouseLeave=function(t){var e;this.checkPassThroughNode(V.MOUSE_ENTER,t),this.isInteracting=!1,null==(e=this.onEndInteracted)||e.call(this,this)},i.checkPassThroughNode=function(t,e){this.passThroughNode&&this.passThroughNode.emit(t,e)},e}(r)).prototype,"nodeTouch",[An],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Mn=On));t._RF.pop(),t._RF.push({},"63b2flj0OJDBKxMBXVQtrFG","PageViewBaseItem",void 0);var Dn,kn=e.ccclass,zn=(e.property,kn("PageViewBaseItem")(Ln=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).onSelected=void 0,e}Ot(e,t);var i=e.prototype;return i.init=function(t,e){this.onSelected=e},i.onTouch_Main=function(){var t;null==(t=this.onSelected)||t.call(this,this)},e}(r))||Ln);t._RF.pop(),t._RF.push({},"1049b+/UgpATrtKU8hoqIHQ","PageViewBasePage",void 0);var Vn,Bn,Hn,Un,Gn,Wn,Zn,Yn=e.ccclass,qn=(e.property,Yn("PageViewBasePage")(Dn=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).items=[],e.itemData=[],e.onSelectItem=void 0,e.onCreatedItem=void 0,e}Ot(e,t);var i=e.prototype;return i.onLoad=function(){this.getChilds()},i.getChildNumber=function(){return this.items.length>0&&this.items.length,this.getChilds(),this.items.length},i.getChilds=function(){this.items.length>0||(this.items=this.getComponentsInChildren(zn))},i.init=function(t){var e=this;this.getChilds(),this.itemData=t;for(var i=0;i<this.items.length;i++){var n=this.items[i],o=i<t.length;if(n.node.active=o,o){var r,a=t[i];n.init(a,(function(t){null==e.onSelectItem||e.onSelectItem(t)})),null==(r=this.onCreatedItem)||r.call(this,n)}}},e}(r))||Dn);t._RF.pop(),t._RF.push({},"fe2875NRMFPRoZfEkgoBxVz","PageViewBase",void 0);var jn,Kn=e.ccclass,Xn=e.property;Vn=Kn("PageViewBase"),Bn=Xn(c),Hn=Xn(l),Vn((Wn=Mt((Gn=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,It(e,"content",Wn,xt(e)),It(e,"prefabPageView",Zn,xt(e)),e.onSelectedItem=void 0,e.onCreatedItem=void 0,e.itemPerPage=0,e.firstPage=null,e.pages=[],e.items=[],e}Ot(e,t);var i=e.prototype;return i.init=function(t){t.length<=0||(this.items=t,this.createFristPage(),this.createPages(),this.setPageData())},i.createPages=function(){for(var t=Math.ceil(this.items.length/this.itemPerPage),e=this.pages.length;e<t;e++)this.createPage()},i.setPageData=function(){var t=this;if(!(this.pages.length<=0)){for(var e=0,i=0,n=function(e,i){e.node.active=!0,e.onSelectItem=t.onPageSelectItem.bind(t),e.onCreatedItem=t.onPageCreateItem.bind(t),e.init(i)},o=0;o<this.items.length;o+=this.itemPerPage){var r=this.items.slice(o,o+this.itemPerPage);n(this.pages[e],r),i=o+r.length,e++}if(i<this.items.length-1){var a=this.items.slice(i,this.items.length);n(this.pages[e],a)}for(var s=++e;s<this.pages.length;s++)this.pages[s].node.active=!1}},i.createFristPage=function(){var t;null==this.firstPage&&(this.firstPage=this.createPage(),this.itemPerPage=null==(t=this.firstPage)?void 0:t.getChildNumber())},i.createPage=function(){var t=E(this.prefabPageView);t.parent=this.content;var e=t.getComponent(qn);return this.pages.push(e),e},i.onPageCreateItem=function(t){var e;null==(e=this.onCreatedItem)||e.call(this,t)},i.onPageSelectItem=function(t){var e;null==(e=this.onSelectedItem)||e.call(this,t)},e}(r)).prototype,"content",[Bn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Zn=Mt(Gn.prototype,"prefabPageView",[Hn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Un=Gn));t._RF.pop(),t._RF.push({},"cf006zT+RZGvahsGniqfbWl","PersistentNode",void 0);var Qn=e.ccclass;e.property,Qn("PersistentNode")(jn=function(t){function e(){return t.apply(this,arguments)||this}return Ot(e,t),e.prototype.onLoad=function(){M.addPersistRootNode(this.node)},e}(r));t._RF.pop(),t._RF.push({},"508dcnFkVtIbZwwhiY9QURR","PopupDefine",void 0);var Jn,$n,to="PopupMessage",eo="PopupLoading";t._RF.pop(),t._RF.push({},"c34cbKAQZdEpJrFv/VJuh+B","uiManager",void 0);var io,no=e.ccclass,oo=(e.property,function(t){return t.LAYER_1="GlobalCanvas/Layer1",t.LAYER_2="GlobalCanvas/Layer2",t.LAYER_3="GlobalCanvas/Layer3",t.LAYER_4="GlobalCanvas/Layer4",t}({})),ro=no("UIManager")((($n=function(){function t(){this.preloadPrefabNames=[eo,to],this._dictSharedPanel={},this._dictLoading={},this._arrPopupDialog=[],this.layerNodeMap=new Map,this.blockNode=null,this.delayTimeoutDefine=0,this.popupLoading=null,this.popupLoadingData=null,this.preloadUIs()}var e=t.prototype;return e.preloadUIs=function(){var t=this;this.preloadPrefabNames.forEach((function(e){t.preloadDialog(e,null)}))},e.isDialogVisible=function(t){if(!this._dictSharedPanel.hasOwnProperty(t))return!1;var e=this._dictSharedPanel[t];return A(e)&&e.active&&A(e.parent)},e.getLayerNode=function(t){if(this.layerNodeMap.has(t)){var e=this.layerNodeMap.get(t);if(A(e))return e}var i=P(t);if(!i){i=new c;var n=t.split("/");i.name=n[n.length-1],i.parent=P("Game/Canvas")}return this.layerNodeMap.set(t,i),i},e.showDialog=function(t,e,i,n,o){var r=this;if(void 0===n&&(n=-1),void 0===o&&(o=oo.LAYER_1),!this._dictLoading[t]){var a=t.lastIndexOf("/"),s=t.slice(a+1);if(e||(e=[]),this._dictSharedPanel.hasOwnProperty(t)){var l=this._dictSharedPanel[t];if(A(l)&&A(l.parent))try{l.parent=this.getLayerNode(o),l.active=!0;var c=l.getComponent(s),u=l.getComponent(s.charAt(0).toUpperCase()+s.slice(1));if(c&&c.show)c.show.apply(c,e),i&&i(c);else{if(!u||!u.show)throw""+s;u.show.apply(u,e),i&&i(u)}return}catch(t){return void this.showMessage({message:"Error while showing dialog",title:"Error"})}}this.setLoading(!0,.5),this._dictLoading[t]=!0,Je.createUI(t,(function(o,a){if(r.setLoading(!1),!o){var l=!1;r._dictLoading[t]||(l=!0),r._dictLoading[t]=!1,n>=0&&a.setSiblingIndex(n),r._dictSharedPanel[t]=a;var c=a.getComponent(s),u=a.getComponent(s.charAt(0).toUpperCase()+s.slice(1));if(c&&c.show)c.show.apply(c,e),i&&i(c);else{if(!u||!u.show)throw""+s;u.show.apply(u,e),i&&i(u)}l&&r.hideDialog(t)}}),null,o)}},e.preloadDialog=function(t,e){var i=this;this._dictLoading[t]=!0,Je.preloadUI(t,(function(n,o){n?null==e||e(n):(i._dictLoading[t]=!1,i._dictSharedPanel[t]=o,o.parent=null,null==e||e(null))}))},e.hideDialog=function(t,e){if(this._dictSharedPanel.hasOwnProperty(t)){var i=this._dictSharedPanel[t];if(i&&A(i)){var n=i.getComponent("animationUI");n?n.close((function(){i.parent=null,e&&"function"==typeof e&&e()})):(i.parent=null,e&&"function"==typeof e&&e())}else e&&"function"==typeof e&&e()}this._dictLoading[t]=!1},e.hidePopup=function(t,e){if(this._dictSharedPanel.hasOwnProperty(t)){var i=this._dictSharedPanel[t];if(i&&A(i)){var n=i.getComponent(so);n?n.hide((function(){i.parent=null,e&&"function"==typeof e&&e()})):(i.parent=null,e&&"function"==typeof e&&e())}else e&&"function"==typeof e&&e()}this._dictLoading[t]=!1},e.pushToPopupSeq=function(t,e,i){var n={panelPath:t,scriptName:e,param:i,isShow:!1};this._arrPopupDialog.push(n),this._checkPopupSeq()},e.insertToPopupSeq=function(t,e,i){var n={panelPath:e,param:i,isShow:!1};this._arrPopupDialog.splice(t,0,n)},e.shiftFromPopupSeq=function(t){var e=this;this.hideDialog(t,(function(){e._arrPopupDialog[0]&&e._arrPopupDialog[0].panelPath===t&&(e._arrPopupDialog.shift(),e._checkPopupSeq())}))},e._checkPopupSeq=function(){if(this._arrPopupDialog.length>0){var t=this._arrPopupDialog[0];t.isShow||(this.showDialog(t.panelPath,t.param),this._arrPopupDialog[0].isShow=!0)}},e.showMessage=function(t){this.showDialog(to,[t],(function(t){}),9999,oo.LAYER_4)},e.setBlock=function(t){this.blockNode||(this.blockNode=P("GlobalCanvas/Block")),this.blockNode.active=t,this.blockNode.setSiblingIndex(999)},e.setLoading=function(t,e,i){var n=this;if(void 0===e&&(e=2),void 0===i&&(i=null),clearTimeout(this.delayTimeoutDefine),t){if(this.setBlock(!0),this.popupLoadingData=i,this.popupLoading)return void this.popupLoading.setLoadingDetail(i);this.delayTimeoutDefine=setTimeout((function(){n.showLoading()}),1e3*e)}else clearTimeout(this.delayTimeoutDefine),this.setBlock(!1),this.hidePopup(eo),this.popupLoading=null,this.popupLoadingData=null},e.showLoading=function(){var t=this;this.showDialog(eo,[this.popupLoadingData],(function(e){t.popupLoading=e}),1,oo.LAYER_3)},t}()).instance=void 0,Jn=$n))||Jn;t._RF.pop(),t._RF.push({},"60806q+/XRP8Yh7Fpwhr+Nd","PopupBase",void 0);var ao,so=(0,e.ccclass)("PopupBase")(io=function(t){function e(){return t.apply(this,arguments)||this}return Ot(e,t),e.prototype.doUImanagerHide=function(){var t=this;this.hide((function(){ro.instance.hideDialog(t.node.name)}))},e}($i))||io;t._RF.pop(),t._RF.push({},"24d73F5z1hKK5U8r6924kDc","ScrollViewBaseItem",void 0);var lo,co=e.ccclass,uo=(e.property,co("ScrollViewBaseItem")(ao=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).onSelected=void 0,e}Ot(e,t);var i=e.prototype;return i.init=function(t,e){this.onSelected=e},i.onTouch_Main=function(){var t;null==(t=this.onSelected)||t.call(this,this)},e}(r))||ao);t._RF.pop(),t._RF.push({},"4fd8fTpdO9H04vVXP8RzKRM","ScrollViewBaseLine",void 0);var ho,po,fo,go,mo,vo,yo,bo=(0,e.ccclass)("ScrollViewBaseLine")(lo=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).items=[],e.itemData=[],e.onSelectItem=void 0,e.onCreatedItem=void 0,e}Ot(e,t);var i=e.prototype;return i.onLoad=function(){this.getChilds()},i.getChildNumber=function(){return this.items.length>0&&this.items.length,this.getChilds(),this.items.length},i.getChilds=function(){this.items.length>0||(this.items=this.getComponentsInChildren(uo))},i.init=function(t){var e=this;this.getChilds(),this.itemData=t;for(var i=0;i<this.items.length;i++){var n=this.items[i],o=i<t.length;if(o&&(o=null!=t[0]),n.node.active=o,o){var r,a=t[i];n.init(a,(function(t){null==e.onSelectItem||e.onSelectItem(t)})),null==(r=this.onCreatedItem)||r.call(this,n)}}},e}(r))||lo;t._RF.pop(),t._RF.push({},"c6578BkEldD6Ymz3t6pB6h0","ScrollViewBase",void 0);var _o,So,wo,To,Co=e.ccclass,Eo=e.property;ho=Co("ScrollViewBase"),po=Eo(c),fo=Eo(l),ho((vo=Mt((mo=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,It(e,"content",vo,xt(e)),It(e,"prefabLine",yo,xt(e)),e.onSelectedItem=void 0,e.onCreatedItem=void 0,e.itemPerLine=0,e.firstLine=null,e.lines=[],e.items=[],e}Ot(e,t);var i=e.prototype;return i.init=function(t){t.length<=0||(this.items=t,this.createFristLine(),this.createLines(),this.setLineData())},i.createLines=function(){for(var t=Math.ceil(this.items.length/this.itemPerLine),e=this.lines.length;e<t;e++)this.createLine()},i.setLineData=function(){var t=this;if(!(this.lines.length<=0)){for(var e=0,i=0,n=function(e,i){e.node.active=!0,e.onSelectItem=t.onLineSelectItem.bind(t),e.onCreatedItem=t.onLineCreateItem.bind(t),e.init(i)},o=0;o<this.items.length;o+=this.itemPerLine){var r=this.items.slice(o,o+this.itemPerLine);n(this.lines[e],r),i=o+r.length,e++}if(i<this.items.length-1){var a=this.items.slice(i,this.items.length);n(this.lines[e],a)}for(var s=++e;s<this.lines.length;s++)this.lines[s].node.active=!1}},i.createFristLine=function(){var t;null==this.firstLine&&(this.firstLine=this.createLine(),this.itemPerLine=null==(t=this.firstLine)?void 0:t.getChildNumber())},i.createLine=function(){var t=E(this.prefabLine);t.parent=this.content;var e=t.getComponent(bo);return this.lines.push(e),e},i.onLineCreateItem=function(t){var e;null==(e=this.onCreatedItem)||e.call(this,t)},i.onLineSelectItem=function(t){var e;null==(e=this.onSelectedItem)||e.call(this,t)},e}(r)).prototype,"content",[po],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),yo=Mt(mo.prototype,"prefabLine",[fo],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),go=mo));t._RF.pop(),t._RF.push({},"36cdeVcYgBP746cVQn6km3N","ToggleAutoSound",void 0);var Po,Ao,Mo,Oo,Io,xo=e.ccclass,Ro=e.property;xo("ToggleAutoSound")((wo=Mt((So=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,It(e,"onAudioName",wo,xt(e)),It(e,"offAudioName",To,xt(e)),e.toggle=null,e}Ot(e,t);var i=e.prototype;return i.onLoad=function(){if(this.toggle=this.getComponent(z),this.toggle){var t=new F;t.target=this.node,t.component="ToggleAutoSound",t.handler="onToggleChanged",this.toggle.checkEvents.push(t)}},i.onToggleChanged=function(){this.toggle&&qi.instance.playSound(this.toggle.isChecked?this.onAudioName:this.offAudioName)},e}(r)).prototype,"onAudioName",[Ro],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"sfx_lobby_ui_01"}}),To=Mt(So.prototype,"offAudioName",[Ro],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"sfx_lobby_ui_01_Low"}}),_o=So));t._RF.pop(),t._RF.push({},"ade5btidtpL5YVAIw3v0u9e","UIAutoVersion",void 0);var Lo=e.ccclass,No=e.property;Po=Lo("UIAutoVersion"),Ao=No(y),Po((Io=Mt((Oo=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,It(e,"lbVersion",Io,xt(e)),e}Ot(e,t);var i=e.prototype;return i.start=function(){},i.onFocusInEditor=function(){},e}(r)).prototype,"lbVersion",[Ao],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Mo=Oo));t._RF.pop(),t._RF.push({},"e2cc7nhdnVFF5CMWYmDA7HF","UserManager",void 0);var Fo=function(){function t(){this.userdata=null,t.instance=this}return t.prototype.setUserData=function(t){this.userdata=t},Nt(t,[{key:"id",get:function(){var t;return null!=(t=this.userdata.id)?t:""}},{key:"coins",get:function(){var t,e;return null!=(t=null==(e=this.userdata)?void 0:e.coin)?t:0}}]),t}();Fo.instance=null;var Do,ko,zo,Vo,Bo,Ho;new Fo;t._RF.pop(),t._RF.push({},"f56b3kOhzpA5qPzFsat65CR","UICoins",void 0);var Uo,Go=e.ccclass,Wo=e.property,Zo=(Do=Go("UICoins"),ko=Wo(c),Do(((Ho=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,It(e,"nodeIcon",Bo,xt(e)),e.labelMain=null,e.showCoins={value:0},e.tweenMain=null,e.tweenNodeCoin=null,e}Ot(e,t);var i=e.prototype;return i.onEnable=function(){null==this.labelMain&&(this.labelMain=this.getComponent(y)),Ht.on(me.EVENT_NAME.USERCOIN_UPDATED,this.updateData,this),e.uistacks.push(this)},i.onDisable=function(){var t,i=this;Ht.off(me.EVENT_NAME.USERCOIN_UPDATED,this.updateData,this),e.uistacks=e.uistacks.filter((function(t){return t!=i})),null==(t=this.tweenMain)||t.stop(),this.tweenMain=null},i.updateData=function(){var t,e=this,i=Fo.instance.coins;null==(t=this.tweenMain)||t.stop(),this.tweenMain=v(this.showCoins).to(.35,{value:i}).call((function(){var t;e.tweenMain=null,e.labelMain.string=Oe.formatNumber(Math.round(null==(t=e.showCoins)?void 0:t.value))})).start()},i.update=function(t){var e;if(null!=this.tweenMain){var i=Oe.formatNumber(Math.round(null==(e=this.showCoins)?void 0:e.value));this.labelMain.string!=i&&(this.labelMain.string=i)}},i.doSpriteEffect=function(){var t;this.nodeIcon&&(this.nodeIcon.scale=m(1.1,1.1),null==(t=this.tweenNodeCoin)||t.stop(),this.tweenNodeCoin=v(this.nodeIcon).to(.15,{scale:g.ONE},{easing:_.backIn}).start())},Nt(e,null,[{key:"position",get:function(){try{return this.uistacks[this.uistacks.length-1].node.worldPosition}catch(t){return new g(0,0,0)}}},{key:"iconPosition",get:function(){try{return this.uistacks[this.uistacks.length-1].nodeIcon.worldPosition}catch(t){return new g(0,0,0)}}},{key:"current",get:function(){try{return this.uistacks[this.uistacks.length-1]}catch(t){return null}}}]),e}(r)).uistacks=[],Bo=Mt((Vo=Ho).prototype,"nodeIcon",[ko],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),zo=Vo))||zo);t._RF.pop(),t._RF.push({},"4bf9dim3D5ES4wXF3TDJfmM","UINumberLabel",void 0);var Yo,qo,jo,Ko,Xo,Qo,Jo,$o=(0,e.ccclass)("UINumberLabel")(Uo=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).showValue={value:0},e.tweenMain=null,e.isReformatNumber=!1,e.decimalNumberCount=0,e.format="",e}Ot(e,t);var i=e.prototype;return i.getNumber=function(t){return this.isReformatNumber?Oe.formatNumber(this.showValue.value,this.decimalNumberCount,this.decimalNumberCount):Oe.toFixed(t,3)},i.getString=function(t){var e=this.getNumber(t);return this.format?this.format.replace("value",e):e},i.onDisable=function(){this.stop()},i.setNumber=function(t,e,i,n,o,r){var a,s=this;if(void 0===e&&(e=.35),void 0===i&&(i=!0),void 0===n&&(n=null),void 0===o&&(o=""),void 0===r&&(r=2),this.isReformatNumber=i,this.decimalNumberCount=r,this.format=o,null==(a=this.tweenMain)||a.stop(),e<=0)return this.showValue.value=e,void(this.string=this.getString(this.showValue.value));this.tweenMain=v(this.showValue).to(e,{value:t}).call((function(){s.tweenMain=null,s.string=s.getString(s.showValue.value),null==n||n()})).start()},i.stop=function(){var t;null==(t=this.tweenMain)||t.stop(),this.tweenMain=null},i.update=function(t){if(null!=this.tweenMain){var e=this.getString(this.showValue.value);this.string!=e&&(this.string=e)}},e}(y))||Uo;t._RF.pop(),t._RF.push({},"64605hgPdJFkLm/270UV/jD","UICountdownNumber",void 0);var tr,er,ir,nr,or,rr=e.ccclass,ar=e.property;Yo=rr("UICountdownNumber"),qo=ar(f),jo=ar(U),Yo((Qo=Mt((Xo=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,It(e,"sprtProgress",Qo,xt(e)),It(e,"isProgressSpriteRevert",Jo,xt(e)),e.startValue=0,e.onRoundNumberCallback=null,e.lastRoundNumberCall=0,e}Ot(e,t);var i=e.prototype;return i.startCountdownFrom=function(t,e,i,n){void 0===e&&(e=null),void 0===i&&(i=""),void 0===n&&(n=null),this.startValue=t,this.onRoundNumberCallback=n,this.lastRoundNumberCall=0,this.showValue.value=t,this.setNumber(0,t,!0,e,i,0)},i.update=function(e){if(t.prototype.update.call(this,e),this.sprtProgress){var i=n.clamp(this.showValue.value/this.startValue,0,1);this.isProgressSpriteRevert&&(i=1-i),this.sprtProgress.fillRange=i}this.checkCallRoundNumber()},i.checkCallRoundNumber=function(){var t,e=Math.round(this.showValue.value);e!=this.lastRoundNumberCall&&(this.lastRoundNumberCall=e,null==(t=this.onRoundNumberCallback)||t.call(this,this.lastRoundNumberCall))},e}($o)).prototype,"sprtProgress",[qo],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Jo=Mt(Xo.prototype,"isProgressSpriteRevert",[jo],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Ko=Xo));t._RF.pop(),t._RF.push({},"0c915T7nLRFS43XBQpOPZlf","UIFastToggle",void 0);var sr,lr,cr,ur,hr,pr=e.ccclass,dr=e.property;tr=pr("UIFastToggle"),er=dr([c]),tr((or=Mt((nr=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,It(e,"nodes",or,xt(e)),e}Ot(e,t);var i=e.prototype;return i.onLoad=function(){var t=new F;t.target=this.node,t.component="UIFastToggle",t.handler="updateNodesState",this.checkEvents.push(t),this.updateNodesState()},i.updateNodesState=function(){var t=this;this.nodes.forEach((function(e){return e.active=t.isChecked}))},e}(z)).prototype,"nodes",[er],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),ir=nr));t._RF.pop(),t._RF.push({},"4a84fL/AtlOh5ZYcK3uvEF8","UIName",void 0);var fr,gr,mr,vr,yr,br,_r,Sr,wr,Tr,Cr,Er=e.ccclass,Pr=e.property,Ar=(sr=Er("UIName"),lr=Pr(G),sr((hr=Mt((ur=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,It(e,"limitChar",hr,xt(e)),e}return Ot(e,t),e.prototype.setName=function(t){var e=Math.round((this.limitChar-3)/2);this.string=Oe.truncateString(t,this.limitChar,e,e)},e}(y)).prototype,"limitChar",[lr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 15}}),cr=ur))||cr);t._RF.pop(),t._RF.push({},"5a859+X7W5OBYSIMvu0QJVW","UIItemUser",void 0);var Mr,Or,Ir,xr,Rr,Lr,Nr,Fr,Dr,kr,zr,Vr=e.ccclass,Br=e.property;fr=Vr("UIItemUser"),gr=Br({type:Ar,group:{name:"User Info",id:"1"}}),mr=Br({type:Ar,group:{name:"User Info",id:"1"}}),vr=Br({type:Zo,group:{name:"User Info",id:"1"}}),yr=Br({type:Te,group:{name:"User Info",id:"1"}}),fr((Sr=Mt((_r=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,It(e,"lbUserName",Sr,xt(e)),It(e,"lbUserUserName",wr,xt(e)),It(e,"lbCoins",Tr,xt(e)),It(e,"avatarUser",Cr,xt(e)),e}Ot(e,t);var i=e.prototype;return i.setUserData=function(t){var e,i,n,o,r,a,s,l,c,u;if(!t)return null==(l=this.lbUserName)||l.setName(""),null==(c=this.lbUserUserName)||c.setName(""),void(null==(u=this.avatarUser)||u.setData(null,null));null==(e=this.lbUserName)||e.setName((null!=(i=null==t?void 0:t.first_name)?i:"")+" "+(null!=(n=null==t?void 0:t.last_name)?n:"")),null==(o=this.lbUserUserName)||o.setName("@"+(null!=(r=null==t?void 0:t.username)?r:"")),null==(a=this.lbCoins)||a.updateData(),null==(s=this.avatarUser)||s.setData(t.photo_url,"")},i.setFechtingData=function(t){void 0===t&&(t="loading..."),this.lbUserName&&this.lbUserName.setName(t),this.lbUserUserName&&this.lbUserUserName.setName(t),this.avatarUser&&this.avatarUser.setData("","")},i.setNullAvatar=function(){this.avatarUser&&this.avatarUser.clear()},e}(r)).prototype,"lbUserName",[gr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),wr=Mt(_r.prototype,"lbUserUserName",[mr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Tr=Mt(_r.prototype,"lbCoins",[vr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Cr=Mt(_r.prototype,"avatarUser",[yr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),br=_r));t._RF.pop(),t._RF.push({},"63144Dta6NLH4Ot5UmPJL47","UINumberByImages",void 0);var Hr,Ur=e.ccclass,Gr=e.property;Mr=Ur("UINumberByImages"),Or=Gr([i]),Ir=Gr([f]),xr=Gr([f]),Rr=Gr(c),Mr((Fr=Mt((Nr=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,It(e,"spriteframeNumbers",Fr,xt(e)),It(e,"spriteNumbers",Dr,xt(e)),It(e,"spriteDecimals",kr,xt(e)),It(e,"nodeDot",zr,xt(e)),e.charMap=new Map,e}Ot(e,t);var i=e.prototype;return i.onLoad=function(){var t=this;this.spriteframeNumbers.forEach((function(e){return t.charMap.set(e.name,e)}))},i.getChar=function(t){return this.charMap.get(t)},i.setNumber=function(t){this.setNumberString(Oe.toFixed(t,5))},i.setNumberString=function(t){var e,i,n=t.split(".");this.nodeDot.active=n.length>1;for(var o=null!=(e=n[0])?e:"",r=0;r<this.spriteNumbers.length;r++){var a=o[r];this.spriteNumbers[r].node.active=!!a,a&&(this.spriteNumbers[r].spriteFrame=this.getChar(a))}for(var s=null!=(i=n[1])?i:"",l=0;l<this.spriteDecimals.length;l++){var c=s[l];this.spriteDecimals[l].node.active=!!c,c&&(this.spriteDecimals[l].spriteFrame=this.getChar(c))}},e}(r)).prototype,"spriteframeNumbers",[Or],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Dr=Mt(Nr.prototype,"spriteNumbers",[Ir],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),kr=Mt(Nr.prototype,"spriteDecimals",[xr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),zr=Mt(Nr.prototype,"nodeDot",[Rr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Lr=Nr));t._RF.pop(),t._RF.push({},"3d366e1pk5BN6GTDW/fi9nd","UINumberLabelComponent",void 0);var Wr,Zr,Yr,qr,jr=e.ccclass,Kr=(e.property,e.requireComponent);jr("UINumberLabelComponent")(Hr=Kr(y)(Hr=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).showValue={value:0},e.tweenMain=null,e.isReformatNumber=!1,e.decimalNumberCount=0,e.format="",e.label=null,e}Ot(e,t);var i=e.prototype;return i.onLoad=function(){this.label=this.node.getComponent(y)},i.getNumber=function(t){return this.isReformatNumber?Oe.formatNumber(this.showValue.value,this.decimalNumberCount,this.decimalNumberCount):Oe.toFixed(t,3)},i.getString=function(t){var e=this.getNumber(t);return this.format?this.format.replace("value",e):e},i.onDisable=function(){this.stop()},i.setNumber=function(t,e,i,n,o,r){var a,s=this;if(void 0===e&&(e=.35),void 0===i&&(i=!0),void 0===n&&(n=null),void 0===o&&(o=""),void 0===r&&(r=2),this.isReformatNumber=i,this.decimalNumberCount=r,this.format=o,null==(a=this.tweenMain)||a.stop(),e<=0)return this.showValue.value=e,void(this.label.string=this.getString(this.showValue.value));this.tweenMain=v(this.showValue).to(e,{value:t}).call((function(){s.tweenMain=null,s.label.string=s.getString(s.showValue.value),null==n||n()})).start()},i.stop=function(){var t;null==(t=this.tweenMain)||t.stop(),this.tweenMain=null},i.update=function(t){if(null!=this.tweenMain){var e=this.getString(this.showValue.value);this.label.string!=e&&(this.label.string=e)}},e}(r))||Hr);t._RF.pop(),t._RF.push({},"35e18W5KnNNt7BMewSFb2bH","UIScaler",void 0);var Xr,Qr,Jr,$r,ta,ea,ia,na=e.ccclass,oa=e.property;na("UIScaler")((Yr=Mt((Zr=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,It(e,"maxValue",Yr,xt(e)),It(e,"minValue",qr,xt(e)),e}return Ot(e,t),e.prototype.onLoad=function(){var t=W(1080,1920),e=t.x/t.y,i=Z.windowSize.width/Z.windowSize.height,o=n.clamp(i/e,this.minValue,this.maxValue);this.node.setScale(m(o,o,o))},e}(r)).prototype,"maxValue",[oa],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),qr=Mt(Zr.prototype,"minValue",[oa],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),Wr=Zr));t._RF.pop(),t._RF.push({},"30045XZ1HVFj77RL4VxNUVU","UIScreenScaler",void 0);var ra,aa,sa,la,ca,ua,ha,pa,da,fa=e.ccclass,ga=e.property;Xr=fa("UIScreenScaler"),Qr=ga(c),Xr((ta=Mt(($r=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,It(e,"targetNode",ta,xt(e)),It(e,"designWidth",ea,xt(e)),It(e,"designHeight",ia,xt(e)),e.widget=null,e.transform=null,e}Ot(e,t);var i=e.prototype;return i.onLoad=function(){this.targetNode||(this.targetNode=this.node),this.widget=this.targetNode.getComponent(Y),this.transform=this.targetNode.getComponent(B),q.on("design-resolution-changed",this.onScreenResize,this),q.on("canvas-resize",this.onScreenResize,this),this.onScreenResize()},i.onDestroy=function(){q.off("design-resolution-changed",this.onScreenResize,this),q.off("canvas-resize",this.onScreenResize,this)},i.onScreenResize=function(){var t=q.getVisibleSize();if(S.platform===S.Platform.MOBILE_BROWSER)this.widget.isAlignLeft=!0,this.widget.isAlignRight=!0,this.widget.isAlignTop=!0,this.widget.isAlignBottom=!0,this.widget.left=0,this.widget.right=0,this.widget.top=0,this.widget.bottom=0;else{var e=9/16;if(t.width/t.height>e){var i=t.height*e,n=(t.width-i)/2;this.widget.isAlignLeft=!0,this.widget.isAlignRight=!0,this.widget.isAlignTop=!0,this.widget.isAlignBottom=!0,this.widget.left=n,this.widget.right=n,this.widget.top=0,this.widget.bottom=0}else this.widget.isAlignLeft=!0,this.widget.isAlignRight=!0,this.widget.isAlignTop=!0,this.widget.isAlignBottom=!0,this.widget.left=0,this.widget.right=0,this.widget.top=0,this.widget.bottom=0}this.widget.updateAlignment()},e}(r)).prototype,"targetNode",[Qr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ea=Mt($r.prototype,"designWidth",[ga],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1080}}),ia=Mt($r.prototype,"designHeight",[ga],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1920}}),Jr=$r));t._RF.pop(),t._RF.push({},"23aff/dfqZMeJFuAqFaQ5p2","UISlider",void 0);var ma,va,ya,ba,_a,Sa,wa,Ta=e.ccclass,Ca=e.property,Ea=(ra=Ta("UISlider"),aa=Ca(f),sa=Ca([c]),la=Ca([c]),ra((ha=Mt((ua=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,It(e,"spriteFiller",ha,xt(e)),It(e,"objectsOff",pa,xt(e)),It(e,"objectsOn",da,xt(e)),e}Ot(e,t);var i=e.prototype;return i.start=function(){this.node.on("slide",this.onSliderChange,this),this.onSliderChange()},i.onSliderChange=function(){var t=this.progress;this.updateSpriteFiller(t),this.updateObjects(t)},i.updateSpriteFiller=function(t){this.spriteFiller&&this.spriteFiller.node.setScale(t,1,1)},i.updateObjects=function(t){for(var e,i=0===t,n=Ft(this.objectsOff);!(e=n()).done;){e.value.active=i}for(var o,r=Ft(this.objectsOn);!(o=r()).done;){o.value.active=!i}},e}(j)).prototype,"spriteFiller",[aa],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),pa=Mt(ua.prototype,"objectsOff",[sa],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),da=Mt(ua.prototype,"objectsOn",[la],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),ca=ua))||ca);t._RF.pop(),t._RF.push({},"92959RjXUxD97yy1ukHjcyM","UISliderRectSize",void 0);var Pa,Aa,Ma,Oa,Ia,xa,Ra,La,Na,Fa,Da,ka,za,Va,Ba,Ha=e.ccclass,Ua=e.property;ma=Ha("UISliderRectSize"),va=Ua(B),ya=Ua(B),ma((Sa=Mt((_a=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,It(e,"transSlider",Sa,xt(e)),It(e,"transMain",wa,xt(e)),e.originalWidth=0,e}Ot(e,t);var i=e.prototype;return i.start=function(){this.originalWidth=this.transSlider.width,t.prototype.start.call(this)},i.updateSpriteFiller=function(t){this.transMain.width=t*this.originalWidth},e}(Ea)).prototype,"transSlider",[va],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),wa=Mt(_a.prototype,"transMain",[ya],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ba=_a));t._RF.pop(),t._RF.push({},"59a6c9CvhtC0L3ZWOHqwOyc","UIToggleGroups",void 0);var Ga,Wa,Za,Ya,qa,ja,Ka,Xa,Qa,Ja,$a,ts,es,is,ns,os=e.ccclass,rs=e.property,as=(Pa=os("ToggleData"),Aa=rs(z),Ma=rs([Ve]),Pa((xa=Mt((Ia=function(){function t(){It(this,"toggle",xa,this),It(this,"visibleViews",Ra,this)}return t.prototype.updateVisible=function(){var t=this;this.visibleViews.forEach((function(e){return null==e?void 0:e.setPanelVisible(t.toggle.isChecked,.25,!0)}))},t}()).prototype,"toggle",[Aa],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ra=Mt(Ia.prototype,"visibleViews",[Ma],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Oa=Ia))||Oa);La=os("UIToggleGroups"),Na=rs([as]),Fa=rs(z),La((za=Mt((ka=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,It(e,"data",za,xt(e)),It(e,"default",Va,xt(e)),It(e,"isAllowOffAll",Ba,xt(e)),e.activeToggle=null,e}Ot(e,t);var i=e.prototype;return i.onLoad=function(){this.init()},i.init=function(){var t=this;this.data.forEach((function(e){var i=new F;i.target=t.node,i.component="UIToggleGroups",i.handler="onToggleChanged",e.toggle.checkEvents.push(i)})),this.default&&(this.default.isChecked=!0,this.onToggleChanged(this.default))},i.onToggleChanged=function(t){this.isAllowOffAll,this.activeToggle!=t&&(t.isChecked&&(this.activeToggle=t,this.activeToggle.interactable=!1),ve.LOG&&console.log("onToggleChanged"+t),t.isChecked&&this.data.forEach((function(e){e.toggle!=t&&(e.toggle.isChecked=!1,e.toggle.interactable=!0),e.updateVisible()})))},i.updateToggles=function(){this.data.forEach((function(t){t.updateVisible()}))},e}(r)).prototype,"data",[Na],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Va=Mt(ka.prototype,"default",[Fa],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ba=Mt(ka.prototype,"isAllowOffAll",[rs],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Da=ka));t._RF.pop(),t._RF.push({},"e1a51NjaFRBkoSdI6zruA8N","UIViewDrawer",void 0);var ss,ls,cs,us,hs,ps=e.ccclass,ds=e.property,fs=function(t){return t[t.HORIZONTAL=0]="HORIZONTAL",t[t.VERTICAL=1]="VERTICAL",t}({});Ga=ps("UIViewDrawer"),Wa=ds({type:R(He)}),Za=ds({type:R(fs)}),Ya=ds(g),qa=ds(c),ja=ds([c]),Ga((Qa=Mt((Xa=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,It(e,"beginType",Qa,xt(e)),It(e,"direction",Ja,xt(e)),It(e,"beginPosition",$a,xt(e)),It(e,"drawerIndicator",ts,xt(e)),It(e,"nodeVisibles",es,xt(e)),It(e,"hidePosX",is,xt(e)),It(e,"showPosX",ns,xt(e)),e.visibleIndex=-1,e}Ot(e,t);var i=e.prototype;return i.setPosition=function(t,e){switch(this.direction){case fs.HORIZONTAL:t.x=e;break;case fs.VERTICAL:t.y=e}return t},i.addPosition=function(t,e){switch(this.direction){case fs.HORIZONTAL:t.x+=e;break;case fs.VERTICAL:t.y+=e}return t},i.onLoad=function(){switch(this.beginType){case He.NONE:break;case He.HIDE:this.nodeVisibles.forEach((function(t){return t.active=!1}));var t=this.beginPosition.clone();this.setPosition(t,this.hidePosX),this.node.setPosition(t),this.drawerIndicator&&(this.drawerIndicator.angle=0),this.visibleIndex=0;break;case He.SHOW:this.node.setPosition(this.beginPosition),this.nodeVisibles.forEach((function(t){return t.active=!0})),this.drawerIndicator&&(this.drawerIndicator.angle=180),this.visibleIndex=1}},i.setDrawerVisible=function(t,e,i){var n=this;if(void 0===e&&(e=null),void 0===i&&(i=.2),this.visibleIndex!=(t?1:0)){this.visibleIndex=t?1:0,t&&this.nodeVisibles.forEach((function(t){return t.active=!0}));var o=this.node.position.clone();this.setPosition(o,t?this.showPosX:this.hidePosX),v(this.node).stop(),v(this.node).to(i,{position:o},{easing:_.quartOut}).call((function(){0==t&&n.nodeVisibles.forEach((function(t){return t.active=!1})),null==e||e()})).start();var r=t?180:0;this.drawerIndicator&&(v(this.drawerIndicator).stop(),v(this.drawerIndicator).to(i,{angle:r},{easing:_.backOut}).start())}},i.show=function(t,e){var i=this;void 0===e&&(e=null),this.setDrawerVisible(!0,(function(){i.shown(),null==e||e()})),qi.instance.playSound(me.SOUND_FILES.SLIDE_IN)},i.doShow=function(){this.show(null)},i.doHide=function(){this.hide()},i.hide=function(t){var e=this;void 0===t&&(t=null),this.setDrawerVisible(!1,(function(){e.hided(),null==t||t()})),qi.instance.playSound(me.SOUND_FILES.SLIDE_OUT)},i.shown=function(){},i.hided=function(){},i.onTouch_ShowHide=function(){1==this.visibleIndex?this.doHide():this.doShow()},Nt(e,[{key:"isShowing",get:function(){return 1==this.visibleIndex}}]),e}(r)).prototype,"beginType",[Wa],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return He.HIDE}}),Ja=Mt(Xa.prototype,"direction",[Za],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return fs.HORIZONTAL}}),$a=Mt(Xa.prototype,"beginPosition",[Ya],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return m(0,0,0)}}),ts=Mt(Xa.prototype,"drawerIndicator",[qa],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),es=Mt(Xa.prototype,"nodeVisibles",[ja],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),is=Mt(Xa.prototype,"hidePosX",[ds],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),ns=Mt(Xa.prototype,"showPosX",[ds],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Ka=Xa));t._RF.pop(),t._RF.push({},"6cc02rpxS1ESpwuMymGkGQL","UserInteractHandler",void 0);var gs=e.ccclass,ms=e.property,vs=function(){this.type=Be.NONE,this.data=null};ss=gs("TouchController"),ls=ms(c),ss((hs=Mt((us=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,It(e,"listenerNode",hs,xt(e)),e.listeners={},e.initialDistance=null,e.startTouchPos=null,e.isTouchMoveTrigger=!1,e.lastDragPos=null,e}Ot(e,t);var i=e.prototype;return i.onLoad=function(){this.initInteracting()},i.onDestroy=function(){},i.addListener=function(t,e){this.listeners[t]||(this.listeners[t]=[]),this.listeners[t].push(e)},i.removeListener=function(t,e){if(this.listeners[t]){var i=this.listeners[t].indexOf(e);i>-1&&this.listeners[t].splice(i,1)}},i.dispatchEvent=function(t){this.listeners[t.type]&&this.listeners[t.type].forEach((function(e){return e(t.data)}))},i.resetValues=function(){this.startTouchPos=null,this.initialDistance=null,this.lastDragPos=null},i.initInteracting=function(){var t=this;this.listenerNode.on(V.MOUSE_WHEEL,(function(e){var i=new vs;i.type=Be.ZOOM,i.data=-e.getScrollY()/10,t.dispatchEvent(i)}),this),this.listenerNode.on(V.TOUCH_START,this.onTouchStart,this),this.listenerNode.on(V.TOUCH_MOVE,this.onTouchMove,this),this.listenerNode.on(V.TOUCH_END,this.onTouchEnd,this),this.listenerNode.on(V.TOUCH_CANCEL,this.onTouchEnd,this),this.listenerNode.on(V.MOUSE_ENTER,this.onHoverBackground,this)},i.onHoverBackground=function(t){var e=new vs;e.type=Be.HOVER,this.dispatchEvent(e)},i.onTouchStart=function(t){2===t.getTouches().length&&(this.initialDistance=this.getDistanceBetweenTouches(t)),1===t.getTouches().length&&(this.startTouchPos=t.getTouches()[0].getLocation()),this.isTouchMoveTrigger=!1},i.onTouchMove=function(t){if(2===t.getTouches().length){var e=this.getDistanceBetweenTouches(t)-this.initialDistance,i=new vs;i.type=Be.ZOOM;i.data=-.01*e,this.dispatchEvent(i),this.isTouchMoveTrigger=!0}else if(1===t.getTouches().length){var n=t.getTouches()[0].getLocation(),o=new vs;o.type=Be.DRAG,o.data={start:null==this.lastDragPos?this.startTouchPos:this.lastDragPos,current:n},this.dispatchEvent(o),this.isTouchMoveTrigger=!0,this.lastDragPos=n.clone()}},i.onTouchEnd=function(t){if(t.getTouches().length<2&&(this.initialDistance=null,this.lastDragPos=null,0==this.isTouchMoveTrigger)){var e=new vs;e.type=Be.TOUCH,e.data=this.startTouchPos,this.dispatchEvent(e)}if(0===t.getTouches().length&&this.startTouchPos){var i=t.getTouches()[0].getLocation();if(K.distance(i,this.startTouchPos)>100){var n=new vs;n.type=Be.SWIPE,n.data={start:this.startTouchPos,end:i},this.dispatchEvent(n)}}var o=new vs;o.type=Be.END_INTERACTED,this.dispatchEvent(o),this.startTouchPos=null},i.getDistanceBetweenTouches=function(t){var e=t.getTouches(),i=e[0].getLocation(),n=e[1].getLocation();return K.distance(i,n)},e}(r)).prototype,"listenerNode",[ls],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),cs=us));t._RF.pop(),t._RF.push({},"f34a2opKdlGHZC9qbc+L0O/","enum",void 0);var ys=function(t){return t[t.Vertical=0]="Vertical",t[t.Horizontal=1]="Horizontal",t}({}),bs=function(t){return t[t.Unrestricted=0]="Unrestricted",t[t.Elastic=1]="Elastic",t[t.Clamped=2]="Clamped",t}({}),_s=function(t){return t[t.Start=0]="Start",t[t.End=1]="End",t}({}),Ss=function(t){return t[t.Auto=0]="Auto",t[t.Header=1]="Header",t[t.Footer=2]="Footer",t[t.Center=3]="Center",t}({}),ws=function(t){return t[t.Lowest=0]="Lowest",t[t.Medium=1]="Medium",t[t.Highest=2]="Highest",t}({}),Ts=function(t){return t[t.Auto=0]="Auto",t[t.Wrap=1]="Wrap",t[t.Nowrap=2]="Nowrap",t}({}),Cs=function(t){return t[t.Auto=0]="Auto",t[t.AlwaysAllow=1]="AlwaysAllow",t[t.Disabled=2]="Disabled",t}({}),Es=function(t){return t[t.Header=0]="Header",t[t.Footer=1]="Footer",t}({}),Ps=function(t){return t[t.UpperLeft=0]="UpperLeft",t[t.UpperCenter=1]="UpperCenter",t[t.UpperRight=2]="UpperRight",t[t.MiddleLeft=3]="MiddleLeft",t[t.MiddleCenter=4]="MiddleCenter",t[t.MiddleRight=5]="MiddleRight",t[t.LowerLeft=6]="LowerLeft",t[t.LowerCenter=7]="LowerCenter",t[t.LowerRight=8]="LowerRight",t}({}),As=function(t){return t[t.Up=0]="Up",t[t.Down=1]="Down",t[t.Left=2]="Left",t[t.Right=3]="Right",t[t.None=4]="None",t}({}),Ms=function(t){return t[t.Top_To_Bottom=0]="Top_To_Bottom",t[t.Bottom_To_Top=1]="Bottom_To_Top",t[t.Left_To_Right=2]="Left_To_Right",t[t.Right_To_Left=3]="Right_To_Left",t}({}),Os=function(t){return t[t.Both=0]="Both",t[t.Header=1]="Header",t[t.Footer=2]="Footer",t}({}),Is=function(t){return t[t.Auto=0]="Auto",t[t.Header=1]="Header",t[t.Footer=2]="Footer",t}({}),xs=function(t){return t[t.Normal=0]="Normal",t[t.Button=1]="Button",t}({}),Rs=function(t){return t[t.None=0]="None",t[t.ColorTint=1]="ColorTint",t[t.SpriteSwap=2]="SpriteSwap",t[t.Scale=3]="Scale",t}({}),Ls=function(t){return t.IDLE="IDLE",t.PULL="PULL",t.WAIT="WAIT",t.RELEASE="RELEASE",t}({}),Ns=function(t){return t.CREATED="ADAPTER:HOLDER:CREATED",t.VISIBLE="ADAPTER:HOLDER:VISIBLE",t.DISABLE="ADAPTER:HOLDER:DISABLE",t}({}),Fs=function(t){return t.VISIBLE="ADAPTER:VIEW:VISIBLE",t.DISABLE="ADAPTER::VIEW:DISABLE",t}({});R(ys),R(bs),R(_s),R(Ss),R(Es),R(Ms),R(Ps),R(Cs),R(xs),R(Rs),t._RF.pop(),t._RF.push({},"745449vUL5G0oNZ/T6pUfiN","Group",void 0);var Ds=function(){function t(t){this._adapter=void 0,this._index=-1,this._models=[],this._size={x:0,y:0},this._oldSize={x:0,y:0},this._anchorPoint={x:.5,y:.5},this._position={x:0,y:0},this._oldPosition={x:0,y:0},this._totalMinSize={x:0,y:0},this._totalPreferredSize={x:0,y:0},this._totalFlexibleSize={x:0,y:0},this._isFixed=!1,this._fixedIndex=-1,this._adapter=t,this.internal_reset()}var e=t.prototype;return e.findModelIndex=function(t){return this.models.findIndex((function(e){return e.index==t}))},e.internal_reset=function(){this._models=[],this._size={x:0,y:0},this._oldSize={x:0,y:0},this._anchorPoint={x:.5,y:.5},this._position={x:0,y:0},this._oldPosition={x:0,y:0},this._totalMinSize={x:0,y:0},this._totalPreferredSize={x:0,y:0},this._totalFlexibleSize={x:0,y:0},this._isFixed=!1,this._fixedIndex=-1,this._setAnchorPoint()},e.internal_setPosition=function(t){var e=this.adapter.mainAxis;this.oldPosition[e]=this.position[e],this.position[e]=t},e.internal_setIndex=function(t){this._index=t},e.internal_insert=function(t,e,i){e.internal_reset();var n=this.models;if(this.internal_reset(),this._fixedIndex=t.fixedIndex,!i)for(var o=0;o<n.length;o++){var r=n[o];if(!(r.index<t.modelIndex))break;if(!this._insertHandler(r,e))return t.modelIndex=r.index,t.fixedIndex=this.isFixed?this.index:t.fixedIndex,!0}for(var a=t.modelIndex;a<this.adapter.modelManager.length;a++){var s=this.adapter.modelManager.get(a);if(!this._insertHandler(s,e))return t.modelIndex=s.index,t.fixedIndex=this.isFixed?this.index:t.fixedIndex,s.index}return!1},e.internal_includes=function(t){for(var e,i=this,n=function(){var e=t[o];if(-1!=i.models.findIndex((function(t){return t.data==e})))return{v:!0}},o=0;o<t.length;o++)if(e=n())return e.v;return!1},e._insertHandler=function(t,e){if(e.internal_isWrap(t,this))return e.internal_reset(),!1;e.internal_push(t),t.element.fixed&&(this._isFixed=!0,this._fixedIndex=-1);var i=this.adapter.mainAxis,n=this.adapter.crossAxis;return(!t.element.ignoreLayout||t.element.ignoreLayout&&t.element.placeholder)&&(this.size[i]=Math.max(this.size[i],t.size[i]*t.scale[i])),this.size[n]=this.adapter.crossAxisSize,this.oldSize[i]=this.size[i],this.oldSize[n]=this.size[n],this.models.push(t),!0},e._setAnchorPoint=function(){switch(this.adapter.viewManager.stretchDirection){case Ss.Center:this.anchorPoint[this.adapter.mainAxis]=.5;break;case Ss.Header:this.anchorPoint[this.adapter.mainAxis]=1-this.adapter.mainAxisAnchorPoint;break;default:this.anchorPoint[this.adapter.mainAxis]=this.adapter.mainAxisAnchorPoint}},Nt(t,[{key:"adapter",get:function(){return this._adapter}},{key:"index",get:function(){return this._index}},{key:"models",get:function(){return this._models}},{key:"size",get:function(){return this._size}},{key:"oldSize",get:function(){return this._oldSize}},{key:"anchorPoint",get:function(){return this._anchorPoint}},{key:"position",get:function(){return this._position}},{key:"oldPosition",get:function(){return this._oldPosition}},{key:"totalMinSize",get:function(){return this._totalMinSize}},{key:"totalPreferredSize",get:function(){return this._totalPreferredSize}},{key:"totalFlexibleSize",get:function(){return this._totalFlexibleSize}},{key:"isFixed",get:function(){return this._isFixed}},{key:"fixedIndex",get:function(){return this._fixedIndex}}]),t}();t._RF.pop(),t._RF.push({},"9951cDVtORNYrBREEqRMzYS","helper",void 0);var ks,zs=function(){function t(){}return t.smoothStep=function(t,e,i){return e*(i=-2*(i=this.clamp01(i))*i*i+3*i*i)+t*(1-i)},t.smoothDamp=function(t,e,i,n,o,r){var a=2/(n=Math.max(1e-4,n)),s=a*r,l=1/(1+s+.48*s*s+.235*s*s*s),c=t-e,u=e,h=o*n,p=(i+a*(c=this.clamp(c,0-h,h)))*r;i=(i-a*p)*l;var d=(e=t-c)+(c+p)*l;return u-t>0==d>u&&(i=((d=u)-u)/r),{velocity:i,position:d}},t.clamp01=function(t){return this.clamp(t,0,1)},t.clamp=function(t,e,i){return void 0===e&&(e=0),void 0===i&&(i=1),Math.min(Math.max(t,e),i)},t.sign=function(t){return t>=0?1:-1},t.lerp=function(t,e,i){return t+(e-t)*this.clamp01(i)},t.approximately=function(t,e){return Math.abs(e-t)<Math.max(1e-4*Math.max(Math.abs(t),Math.abs(e)),8*this.Epsilon)},t.round=function(t,e){return Math.round(t*Math.pow(10,e))/Math.pow(10,e)},t.pingpang=function(t){var e=t;e=Math.abs(t);var i=Math.trunc(e);return i%2==0?e-=i:e=1-(e-i),e},t.isNumber=function(t){return"number"==typeof t&&!isNaN(t)},t.progress=function(t,e,i,n){return t+(e-t)*n},t.getGuid=function(){var t=(new Date).getTime();return window.performance&&"function"==typeof window.performance.now&&(t+=performance.now()),"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var i=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"==e?i:3&i|8).toString(16)}))},t}();zs.Epsilon=1401298e-51,zs.Infinity=1/0,t._RF.pop(),t._RF.push({},"2be49b5ffhLSZVXKWyATSqt","Manager",void 0);var Vs,Bs,Hs=e.ccclass,Us=(e.property,Hs("Manager")(ks=function(){function t(){this._inited=!1,this._eventMap=new Map,this._adapter=null}var e=t.prototype;return e.internal_create=function(t){this._adapter=t},e.internal_init=function(){this._inited||(this._inited=!0,this.onInit())},e.on=function(t,e,i,n){void 0===n&&(n=!1),this._eventMap.has(t)||this._eventMap.set(t,[]);var o=this._eventMap.get(t);null!=o&&o.find((function(t){return t.target==i&&t.callback==e}))||o.push({callback:e,target:i,once:n})},e.off=function(t,e,i){if(this._eventMap.has(t)){var n=this._eventMap.get(t),o=null==n?void 0:n.findIndex((function(t){return t.callback==e&&t.target==i}));-1!=o&&n.splice(o,1)}},e.emit=function(t){if(this._eventMap.has(t)){for(var e=this._eventMap.get(t),i=arguments.length,n=new Array(i>1?i-1:0),o=1;o<i;o++)n[o-1]=arguments[o];for(var r=0;r<e.length;r++){var a,s=e[r];(a=s.callback).call.apply(a,[s.target].concat(n)),s.once&&(e.splice(r,1),r--)}}},Nt(t,[{key:"adapter",get:function(){return this._adapter}}]),t}())||ks);t._RF.pop(),t._RF.push({},"36ea76OAA9IiJKehmGOQ6xW","ModelManager",void 0);var Gs,Ws=e.ccclass,Zs=(e.property,function(t){return t[t.ON_CLEAR=0]="ON_CLEAR",t[t.ON_INSERT=1]="ON_INSERT",t[t.ON_REMOVE=2]="ON_REMOVE",t[t.ON_MOVE=3]="ON_MOVE",t[t.ON_UPDATE=4]="ON_UPDATE",t[t.ON_CHANGE_BEFORE=5]="ON_CHANGE_BEFORE",t}(Zs||{})),Ys=Ws("ModelManager")(((Bs=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this)._modelList=[],e._length=0,e}Ot(e,t);var i=e.prototype;return i.onInit=function(){},i.insert=function(){var t=Rt(Lt().mark((function t(e,i){var n;return Lt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:void 0===i&&(i=this.length),n=this._toArray(e),i=zs.clamp(i,0,this.length),this.emit(Zs.ON_CHANGE_BEFORE),this._insertHandler(n,i),this._length=this._modelList.length,n.length>0&&this.emit(Zs.ON_INSERT,i);case 7:case"end":return t.stop()}}),t,this)})));return function(e,i){return t.apply(this,arguments)}}(),i._insertHandler=function(t,e){var i=this,n=e;this._length=this._modelList.length;for(var o=[],r=function(t,e){return(p=i._getNewModel(t)).index=e,i._modelList.push(p),p},a=function(t){var e=i.get(n);if(e)o.push(i._copyModel(e,{})),e.data=t,e.index=n,i._initModel(e);else{var a=r(t,n);i._initModel(a)}n++},s=0,l=t.length;s<l;s++)a(t[s]);for(var c=0;c<o.length;c++){var u=o[c],h=n+c;if(this.get(h)){var p=this.get(h);o.push(this._copyModel(p,{})),this._copyModel(u,p)}else{var d=r(u.data,h);this._copyModel(u,d)}}},i.remove=function(t,e){if(void 0===e&&(e=1),0!=e&&!(t<0||t>=this.length)){var i=this.length;this.emit(Zs.ON_CHANGE_BEFORE);for(var n=t;n<this.length;n++){var o=this.get(n),r=this.get(n+e);if(!r){i=n;break}this._copyModel(r,o),o.index=n}this._modelList.splice(i,this.length),this._length=this._modelList.length,this.emit(Zs.ON_REMOVE,t)}},i.move=function(t,e,i){var n=this;if(!(t<0||e<=0)){this.emit(Zs.ON_CHANGE_BEFORE);var o=this._modelList.map((function(t){return n._copyModel(t,{})})),r=o.splice(t,e);o.splice.apply(o,[i,0].concat(r));for(var a=0;a<o.length;a++)this._copyModel(o[a],this._modelList[a]);var s=Math.min(t,i);this.emit(Zs.ON_MOVE,s)}},i.update=function(){this.emit(Zs.ON_UPDATE)},i.clear=function(){this._modelList.length=0,this._length=0,this.emit(Zs.ON_CLEAR)},i.has=function(t){return!!this._modelList[t]},i.get=function(t){return isNaN(t)?null:this._modelList[t]},i.slice=function(t,e){return 0==this.length?[]:this._modelList.slice(t,e)},i._toArray=function(t){return t?t instanceof Array?t:[t]:[]},i._getNewModel=function(t){return{data:t,index:-1,code:null,size:{x:0,y:0},layoutSize:{x:0,y:0},scale:{x:0,y:0},position:{x:0,y:0},anchorPoint:{x:0,y:0},element:{wrapBeforeMode:Ts.Wrap,wrapAfterMode:Ts.Nowrap,ignoreLayout:!1,placeholder:!1,minSize:{x:0,y:0},preferredSize:{x:0,y:0},flexibleSize:{x:0,y:0},layer:ws.Lowest,fixed:!1,fixedOffset:0,fixedSpacing:null,update:function(){}},isValid:!0,update:function(){}}},i._initModel=function(t){var e=this.adapter.getPrefab(t.data);if(!e)throw Error("预制体不能为空");if(e instanceof c){var i=e.getComponent(B);t.code=e.uuid,t.size={x:i.width,y:i.height},t.scale={x:i.node.scale.x,y:i.node.scale.y},t.anchorPoint={x:i.anchorPoint.x,y:i.anchorPoint.y}}else{var n=e.data.getComponent(B);t.code=e.data._prefab.fileId,t.size={x:n.width,y:n.height},t.scale={x:n.node.scale.x,y:n.node.scale.y},t.anchorPoint={x:n.anchorPoint.x,y:n.anchorPoint.y}}t.layoutSize={x:0,y:0},t.position={x:0,y:0},t.element={wrapBeforeMode:Ts.Wrap,wrapAfterMode:Ts.Nowrap,ignoreLayout:!1,placeholder:!1,minSize:{x:0,y:0},preferredSize:{x:0,y:0},flexibleSize:{x:0,y:0},layer:ws.Lowest,fixed:!1,fixedOffset:0,fixedSpacing:null,update:function(){}},this.adapter.initElement(t.element,t.data)},i._copyModel=function(t,e){t.element.update=function(){};return function t(e,i){for(var n in e){var o=e[n];"data"!=n?"index"!=n&&(null!=o&&"object"==typeof o?(i[n]={},t(o,i[n])):i[n]=o):i[n]=o}}(t,e),e},Nt(e,[{key:"length",get:function(){return this._length}},{key:"modelList",get:function(){return this._modelList}}]),e}(Us)).Event=Zs,Vs=Bs))||Vs;t._RF.pop(),t._RF.push({},"e143cqYQS9Lga09ceG48Qky","Holder",void 0);var qs=e.ccclass,js=(e.property,qs("Holder")(Gs=function(){function t(t,e,i){this._node=void 0,this._transform=void 0,this._code=void 0,this._adapter=void 0,this._model=void 0,this._view=void 0,this._fixedIndex=-1,this._oldData=null,this._oldElement=null,this._isCallCreated=!1,this._isLayout=!1,this._node=t,this._code=e,this._adapter=i,this._transform=this.node.getComponent(B)}var e=t.prototype;return e.internal_visible=function(t,e,i){var n=this;this._view=t,this._model=e,this._oldElement=Object.assign({},e.element),this._model.element.update=this._updateElement.bind(this),this._oldData=this.data,i&&(this.node.active=!0,this._isCallCreated||(this._isCallCreated=!0,this.onCreated()),this.element.fixed&&(this._fixedIndex=this.view.group.models.findIndex((function(t){return t.index==n.model.index}))),this.transform.setContentSize(this.model.size.x,this.model.size.y),this.node.setScale(this.model.scale.x,this.model.scale.y),this._register(),this.onVisible(),this._model.update=this._updateHandler.bind(this))},e._updateElement=function(){this._oldElement.layer!=this.element.layer&&(this.node.parent=this.adapter.scrollManager.getLayerNode(this.element.layer),this._oldElement.layer=this.element.layer),(this._oldElement.wrapAfterMode!=this.element.wrapAfterMode||this._oldElement.wrapBeforeMode!=this.element.wrapBeforeMode||this._oldElement.ignoreLayout!=this.element.ignoreLayout||this.element.ignoreLayout&&this._oldElement.placeholder!=this.element.placeholder)&&(this.adapter.viewManager.internal_updateVisibleView(this.model.index),this._oldElement.wrapAfterMode=this.element.wrapAfterMode,this._oldElement.wrapBeforeMode=this.element.wrapBeforeMode,this._oldElement.ignoreLayout=this.element.ignoreLayout,this._oldElement.placeholder=this.element.placeholder)},e._updateHandler=function(){this._model.update=function(){},this.onVisible(),this._model.update=this._updateHandler.bind(this)},e.internal_disable=function(){this.adapter.scrollManager.internal_disableTouchTarget(this.node),this.onDisable(),this._unregister(),this._model.update=function(){},this._model.element.update=function(){},this._view=null,this._model=null,this._fixedIndex=-1,this._isLayout=!1,this._oldData=null,this.node.active=!1},e.internal_layout=function(){var t={x:this.model.size.x,y:this.model.size.y};this.adapter.layoutManager.isControlMainAxisSize&&(t[this.adapter.mainAxis]=this.model.layoutSize[this.adapter.mainAxis]),this.adapter.layoutManager.isControlCrossAxisSize&&(t[this.adapter.crossAxis]=this.model.layoutSize[this.adapter.crossAxis]),this._isLayout=!0,this.transform.setContentSize(t.x,t.y),this._isLayout=!1,this.node.setPosition(this.model.position.x,this.model.position.y)},e._register=function(){this.node.on(c.EventType.SIZE_CHANGED,this._onSizeChanged,this),this.node.on(c.EventType.TRANSFORM_CHANGED,this._onScaleChanged,this),this.node.on(c.EventType.ANCHOR_CHANGED,this._onAnchorPointChanged,this),this._adapter.modelManager.on(Ys.Event.ON_UPDATE,this._updateHandler,this)},e._unregister=function(){this.node.off(c.EventType.SIZE_CHANGED,this._onSizeChanged,this),this.node.off(c.EventType.TRANSFORM_CHANGED,this._onScaleChanged,this),this.node.off(c.EventType.ANCHOR_CHANGED,this._onAnchorPointChanged,this),this._adapter.modelManager.off(Ys.Event.ON_UPDATE,this._updateHandler,this)},e._onSizeChanged=function(){if(!this._isLayout){var t=zs.approximately(this.model.size[this.adapter.mainAxis],this.transform.contentSize[this.adapter.mainAxis]),e=zs.approximately(this.model.size[this.adapter.crossAxis],this.transform.contentSize[this.adapter.crossAxis]);this.model.size.x=this.transform.width,this.model.size.y=this.transform.height,t&&e||this.view.internal_holderChanged(t)}},e._onScaleChanged=function(t){if(t==c.TransformBit.SCALE&&(this.adapter.layoutManager.controlScaleWidth||this.adapter.layoutManager.controlScaleHeight)){var e=zs.approximately(this.model.scale[this.adapter.mainAxis],this.node.scale[this.adapter.mainAxis]),i=zs.approximately(this.model.scale[this.adapter.crossAxis],this.node.scale[this.adapter.crossAxis]);this.model.scale.x=this.node.scale.x,this.model.scale.y=this.node.scale.y,e&&i||this.view.internal_holderChanged(e)}},e._onAnchorPointChanged=function(){var t=zs.approximately(this.model.anchorPoint[this.adapter.mainAxis],this.transform.anchorPoint[this.adapter.mainAxis]),e=zs.approximately(this.model.anchorPoint[this.adapter.crossAxis],this.transform.anchorPoint[this.adapter.crossAxis]);this.model.anchorPoint.x=this.transform.anchorPoint.x,this.model.anchorPoint.y=this.transform.anchorPoint.y,t&&e||this.view.internal_holderChanged(t)},Nt(t,[{key:"node",get:function(){return this._node}},{key:"transform",get:function(){return this._transform}},{key:"code",get:function(){return this._code}},{key:"adapter",get:function(){return this._adapter}},{key:"model",get:function(){return this._model}},{key:"view",get:function(){return this._view}},{key:"data",get:function(){return this._model&&this._model.data}},{key:"fixedIndex",get:function(){return this._fixedIndex}},{key:"oldData",get:function(){return this._oldData}},{key:"element",get:function(){return this._model&&this._model.element}},{key:"index",get:function(){return this._model&&this._model.index}}]),t}())||Gs);t._RF.pop(),t._RF.push({},"a66bdQHmTxEUris3Jx+UGmB","debug",void 0);var Ks,Xs,Qs,Js,$s,tl,el,il,nl,ol,rl,al,sl,ll,cl,ul,hl,pl,dl,fl,gl,ml,vl,yl,bl;new X(238,124,55,255),new X(88,175,64,50),new X(56,120,94,255);t._RF.pop(),t._RF.push({},"9a8caWSYQZLqr6N7OEAXSa7","LayoutManager",void 0);var _l,Sl=e.ccclass,wl=e.property,Tl=function(t){return t[t.ON_LAYOUT_COMPLATED=0]="ON_LAYOUT_COMPLATED",t[t.ON_CHANGED_LAYOUT_STATE=1]="ON_CHANGED_LAYOUT_STATE",t}(Tl||{}),Cl=(Ks=Sl("LayoutManager"),Xs=wl({type:Ps}),Qs=wl({type:Ps,tooltip:"布局元素的对齐方式"}),Js=wl({tooltip:"元素交叉轴布局的间距"}),$s=wl({tooltip:"反转布局"}),tl=wl({tooltip:"延迟布局，开启后会统一在下一帧布局，建议开启"}),el=wl({group:{id:"0",name:"forceExpand"},tooltip:"是否强制布局元素宽度扩展以填充额外的可用空间"}),il=wl({group:{id:"0",name:"forceExpand"},tooltip:"是否强制布局元素高度扩展以填充额外的可用空间"}),nl=wl({group:{id:"0",name:"controlSize"},tooltip:"如果设置为 false，布局只会影响元素的位置，而不会影响宽度，在这种情况下你可以设置元素的宽度\n如果设置为 true，元素的宽度将由布局根据它们各自的 IElement.minSize、IElement.preferredSize、IElement.flexibleSize自动设置。如果元素的宽度应根据可用空间的大小而变化，应开启此功能。在这种情况下不能直接设置每个元素的宽度，但可以通过控制每个元素的IElement.minSize、IElement.preferredSize、IElement.flexibleSize来进行控制"}),ol=wl({group:{id:"0",name:"controlSize"},tooltip:"如果设置为 false，布局只会影响元素的位置，而不会影响高度，在这种情况下你可以设置元素的高度\n如果设置为 true，元素的高度将由布局根据它们各自的 IElement.minSize、IElement.preferredSize、IElement.flexibleSize自动设置。如果元素的高度应根据可用空间的大小而变化，应开启此功能。在这种情况下不能直接设置每个元素的高度，但可以通过控制每个元素的IElement.minSize、IElement.preferredSize、IElement.flexibleSize来进行控制"}),rl=wl({group:{id:"0",name:"controlScale"},tooltip:"是否使用 x 缩放计算宽度"}),al=wl({group:{id:"0",name:"controlScale"},tooltip:"是否使用 y 缩放计算高度"}),Ks(((bl=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,It(e,"_childAlignment",cl,xt(e)),It(e,"_spacing",ul,xt(e)),It(e,"_reverseArrangement",hl,xt(e)),It(e,"delayLayout",pl,xt(e)),It(e,"_forceExpandWidth",dl,xt(e)),It(e,"_forceExpandHeight",fl,xt(e)),It(e,"_controlSizeWidth",gl,xt(e)),It(e,"_controlSizeHeight",ml,xt(e)),It(e,"_controlScaleWidth",vl,xt(e)),It(e,"_controlScaleHeight",yl,xt(e)),e._isDirty=!1,e._layoutQueue=[],e}Ot(e,t);var i=e.prototype;return i.onInit=function(){},i.layout=function(t){t&&(this.delayLayout?(this.unLayout(t.index),this._layoutQueue.push(t),this._isDirty=!0):(this._layoutHandler(t),this.emit(Tl.ON_LAYOUT_COMPLATED,[t.index])))},i.unLayout=function(t){-1!=(t=this._layoutQueue.findIndex((function(e){return e.index==t})))&&this._layoutQueue.splice(t,1)},i._layoutHandler=function(t){this._calcAlongAxis(t,ys.Horizontal,this.adapter.isHorizontal),this._setChildrenAlongAxis(t,ys.Horizontal,this.adapter.isHorizontal),this._calcAlongAxis(t,ys.Vertical,this.adapter.isHorizontal),this._setChildrenAlongAxis(t,ys.Vertical,this.adapter.isHorizontal)},i._calcAlongAxis=function(t,e,i){for(var n=e==ys.Horizontal?this.horizontal:this.vertical,o=this._getControlSize(e),r=this._getControlScale(e),a=this._getForceExpandSize(e),s=n,l=n,c=0,u=i!=(e==ys.Vertical),h=this._getLayoutList(t.models),p=0;p<h.length;p++){var d=h[p],f=this._getChildSizes(d,e,o,a),g=f.min,m=f.preferred,v=f.flexible;if(r){var y=d.scale[this._getAxis(e)];g*=y,m*=y,v*=y}u?(s=Math.max(g+n,s),l=Math.max(m+n,l),c=Math.max(v,c)):(s+=g+this.spacing,l+=m+this.spacing,c+=v)}!u&&h.length>0&&(s-=this.spacing,l-=this.spacing),l=Math.max(s,l),this._setLayoutInputForAxis(t,s,l,c,e)},i._getControlSize=function(t){return t==ys.Horizontal?this.controlSizeWidth:this.controlSizeHeight},i._getControlScale=function(t){return t==ys.Horizontal?this.controlScaleWidth:this.controlScaleHeight},i._getForceExpandSize=function(t){return t==ys.Horizontal?this.forceExpandWidth:this.forceExpandHeight},i._setChildrenAlongAxis=function(t,e,i){var n=t.size[this._getAxis(e)],o=this._getControlSize(e),r=this._getControlScale(e),a=this._getForceExpandSize(e),s=this._getAlignmentOnAxis(e),l=this._getLayoutList(t.models),c=i!=(e==ys.Vertical),u=this.reverseArrangement?l.length-1:0,h=this.reverseArrangement?0:l.length,p=this.reverseArrangement?-1:1,d=this._getAxis(e);if(c)for(var f=n-(e==ys.Horizontal?this.horizontal:this.vertical),g=u;this.reverseArrangement?g>=h:g<h;g+=p){var m=l[g],v=this._getChildSizes(m,e,o,a),y=v.min,b=v.preferred,_=v.flexible,S=r?m.scale[d]:1,w=zs.clamp(f,y,_>0?n:b),T=this._getStartOffset(t,e,w*S);if(o)this._setChildAlongAxisWithScale(t,m,e,T,S,w);else{var C=(w-m.size[d])*s;C*=S,this._setChildAlongAxisWithScale(t,m,e,T+C,S)}}else{var E=e==ys.Horizontal?this.left:this.top,P=0,A=n-this._getTotalPreferredSize(t,e);A>0&&(0==this._getTotalFlexibleSize(t,e)?E=this._getStartOffset(t,e,this._getTotalPreferredSize(t,e)-(e==ys.Horizontal?this.horizontal:this.vertical)):this._getTotalFlexibleSize(t,e)>0&&(P=A/this._getTotalFlexibleSize(t,e)));var M=0;this._getTotalMinSize(t,e)!=this._getTotalPreferredSize(t,e)&&(M=zs.clamp01((n-this._getTotalMinSize(t,e))/(this._getTotalPreferredSize(t,e)-this._getTotalMinSize(t,e))));for(g=u;this.reverseArrangement?g>=h:g<h;g+=p){var O=l[g],I=this._getChildSizes(O,e,o,a),x=(y=I.min,b=I.preferred,_=I.flexible,r?O.scale[d]:1),R=zs.lerp(y,b,M);if(R+=_*P,o)this._setChildAlongAxisWithScale(t,O,e,E,x,R);else{C=(R-O.size[d])*s;this._setChildAlongAxisWithScale(t,O,e,E+C,x)}E+=R*x+this.spacing}}},i._setChildAlongAxisWithScale=function(t,e,i,n,o,r){if(null!=e){var a=this._getAxis(i),s=0;isNaN(r)?s=e.size[a]:(e.layoutSize[a]=r,s=r);var l={x:e.position.x,y:e.position.y},c=0;i==ys.Horizontal?(c=n+s*e.anchorPoint[a]*o,c-=t.size[a]*t.anchorPoint[a],c+=t.position[a]):(c=-n-s*(1-e.anchorPoint[a])*o,c+=t.size[a]*(1-t.anchorPoint[a]),c+=t.position[a]),l[a]=c,e.position=l}},i._getStartOffset=function(t,e,i){var n=i+(e==ys.Horizontal?this.horizontal:this.vertical),o=t.size[this._getAxis(e)]-n,r=this._getAlignmentOnAxis(e);return(e==ys.Horizontal?this.left:this.top)+o*r},i._setLayoutInputForAxis=function(t,e,i,n,o){var r=this._getAxis(o);t.totalMinSize[r]=e,t.totalPreferredSize[r]=i,t.totalFlexibleSize[r]=n},i._getAxis=function(t){return t==ys.Horizontal?"x":"y"},i._getMinSize=function(t,e){return t.minSize[this._getAxis(e)]},i._getPreferredSize=function(t,e){var i=this._getAxis(e);return Math.max(t.minSize[i],t.preferredSize[i])},i._getFlexibleSize=function(t,e){return t.flexibleSize[this._getAxis(e)]},i._getTotalMinSize=function(t,e){return t.totalMinSize[this._getAxis(e)]},i._getTotalPreferredSize=function(t,e){return t.totalPreferredSize[this._getAxis(e)]},i._getTotalFlexibleSize=function(t,e){return t.totalFlexibleSize[this._getAxis(e)]},i._getChildSizes=function(t,e,i,n){var o,r,a;return i?(o=this._getMinSize(t.element,e),r=this._getPreferredSize(t.element,e),a=this._getFlexibleSize(t.element,e)):(r=o=t.size[this._getAxis(e)],a=0),n&&(a=Math.max(a,1)),{min:o,preferred:r,flexible:a}},i._getAlignmentOnAxis=function(t){return t==ys.Horizontal?this.adapter.layoutManager.childAlignment%3*.5:.5*Math.floor(this.adapter.layoutManager.childAlignment/3)},i._getLayoutList=function(t){for(var e=[],i=0;i<t.length;i++){var n=t[i];n.element.ignoreLayout||e.push(n)}return e},i.internal_lateUpdate=function(t){if(this._isDirty){this._isDirty=!1;for(var e=[];this._layoutQueue.length>0;){var i=this._layoutQueue.shift();this._layoutHandler(i),e.push(i.index)}e.length>0&&this.emit(Tl.ON_LAYOUT_COMPLATED,e)}},Nt(e,[{key:"childAlignment",get:function(){return this._childAlignment},set:function(t){t!=this._childAlignment&&(this._childAlignment=t,this.emit(Tl.ON_CHANGED_LAYOUT_STATE))}},{key:"spacing",get:function(){return this._spacing},set:function(t){t!=this._spacing&&(this._spacing=t,this.emit(Tl.ON_CHANGED_LAYOUT_STATE))}},{key:"reverseArrangement",get:function(){return this._reverseArrangement},set:function(t){t!=this._reverseArrangement&&(this._reverseArrangement=t,this.emit(Tl.ON_CHANGED_LAYOUT_STATE))}},{key:"forceExpandWidth",get:function(){return this._forceExpandWidth},set:function(t){t!=this._forceExpandWidth&&(this._forceExpandWidth=t,this.emit(Tl.ON_CHANGED_LAYOUT_STATE))}},{key:"forceExpandHeight",get:function(){return this._forceExpandHeight},set:function(t){t!=this._forceExpandHeight&&(this._forceExpandHeight=t,this.emit(Tl.ON_CHANGED_LAYOUT_STATE))}},{key:"controlSizeWidth",get:function(){return this._controlSizeWidth},set:function(t){t!=this._controlSizeWidth&&(this._controlSizeWidth=t,this.emit(Tl.ON_CHANGED_LAYOUT_STATE))}},{key:"controlSizeHeight",get:function(){return this._controlSizeHeight},set:function(t){t!=this._controlSizeHeight&&(this._controlSizeHeight=t,this.emit(Tl.ON_CHANGED_LAYOUT_STATE))}},{key:"controlScaleWidth",get:function(){return this._controlScaleWidth},set:function(t){t!=this._controlScaleWidth&&(this._controlScaleWidth=t,this.emit(Tl.ON_CHANGED_LAYOUT_STATE))}},{key:"controlScaleHeight",get:function(){return this._controlScaleHeight},set:function(t){t!=this._controlScaleHeight&&(this._controlScaleHeight=t,this.emit(Tl.ON_CHANGED_LAYOUT_STATE))}},{key:"top",get:function(){return this.adapter.isVertical?0:this.adapter.viewManager.top}},{key:"bottom",get:function(){return this.adapter.isVertical?0:this.adapter.viewManager.bottom}},{key:"left",get:function(){return this.adapter.isHorizontal?0:this.adapter.viewManager.left}},{key:"right",get:function(){return this.adapter.isHorizontal?0:this.adapter.viewManager.right}},{key:"horizontal",get:function(){return this.left+this.right}},{key:"vertical",get:function(){return this.top+this.bottom}},{key:"isControlMainAxisSize",get:function(){return this.adapter.isHorizontal&&this.controlSizeWidth||this.adapter.isVertical&&this.controlSizeHeight}},{key:"isControlCrossAxisSize",get:function(){return this.adapter.isHorizontal&&this.controlSizeHeight||this.adapter.isVertical&&this.controlSizeWidth}},{key:"isControlCrossAxisScale",get:function(){return this.adapter.isHorizontal&&this.controlScaleHeight||this.adapter.isVertical&&this.controlScaleWidth}}]),e}(Us)).Event=Tl,cl=Mt((ll=bl).prototype,"_childAlignment",[Xs],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Ps.UpperLeft}}),Mt(ll.prototype,"childAlignment",[Qs],Object.getOwnPropertyDescriptor(ll.prototype,"childAlignment"),ll.prototype),ul=Mt(ll.prototype,"_spacing",[wl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Mt(ll.prototype,"spacing",[Js],Object.getOwnPropertyDescriptor(ll.prototype,"spacing"),ll.prototype),hl=Mt(ll.prototype,"_reverseArrangement",[wl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Mt(ll.prototype,"reverseArrangement",[$s],Object.getOwnPropertyDescriptor(ll.prototype,"reverseArrangement"),ll.prototype),pl=Mt(ll.prototype,"delayLayout",[tl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),dl=Mt(ll.prototype,"_forceExpandWidth",[wl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Mt(ll.prototype,"forceExpandWidth",[el],Object.getOwnPropertyDescriptor(ll.prototype,"forceExpandWidth"),ll.prototype),fl=Mt(ll.prototype,"_forceExpandHeight",[wl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Mt(ll.prototype,"forceExpandHeight",[il],Object.getOwnPropertyDescriptor(ll.prototype,"forceExpandHeight"),ll.prototype),gl=Mt(ll.prototype,"_controlSizeWidth",[wl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Mt(ll.prototype,"controlSizeWidth",[nl],Object.getOwnPropertyDescriptor(ll.prototype,"controlSizeWidth"),ll.prototype),ml=Mt(ll.prototype,"_controlSizeHeight",[wl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Mt(ll.prototype,"controlSizeHeight",[ol],Object.getOwnPropertyDescriptor(ll.prototype,"controlSizeHeight"),ll.prototype),vl=Mt(ll.prototype,"_controlScaleWidth",[wl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Mt(ll.prototype,"controlScaleWidth",[rl],Object.getOwnPropertyDescriptor(ll.prototype,"controlScaleWidth"),ll.prototype),yl=Mt(ll.prototype,"_controlScaleHeight",[wl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Mt(ll.prototype,"controlScaleHeight",[al],Object.getOwnPropertyDescriptor(ll.prototype,"controlScaleHeight"),ll.prototype),sl=ll))||sl);t._RF.pop(),t._RF.push({},"2de05BThzdKpKfaXzu3wLES","View",void 0);var El,Pl,Al,Ml,Ol,Il,xl,Rl,Ll,Nl,Fl,Dl,kl,zl,Vl,Bl,Hl,Ul,Gl,Wl,Zl,Yl,ql,jl,Kl,Xl,Ql,Jl,$l,tc,ec,ic,nc,oc,rc,ac=e.ccclass,sc=(e.property,ac("View")(_l=function(){function t(t){this.__debug_graphics=void 0,this._adapter=void 0,this._total=0,this._innerSize=0,this._group=null,this._holderList=[],this._tempHolderList=[],this._isOverflowFixed=void 0,this._adapter=t,this.internal_reset(),this.__createDebug()}var e=t.prototype;return e.__createDebug=function(){},e.__drawDebug=function(){if(this.__debug_graphics&&this.group){this.__debug_graphics.clear();var t=this.adapter.mainAxis,e=this.adapter.crossAxis,i={x:0,y:0},n={x:this.group.size.x,y:this.group.size.y},o={x:this.group.anchorPoint.x,y:this.group.anchorPoint.y};i[t]=this.group.position[t]-n[t]*o[t],i[t]+=1.5,i[e]=this.group.position[e]-n[e]*(1-o[e]),i[e]+=1.5,n[t]-=3,n[e]-=3,this.__debug_graphics.roundRect(i.x,i.y,n.x,n.y,2),this.__debug_graphics.stroke()}},e.getFixedHolders=function(){if(!this.group.isFixed)return[];for(var t=[],e=this.holderList.length,i=0;i<e;i++){var n=this.holderList[i];n.model.element.fixed&&t.push(n)}return t},e.internal_isWrap=function(t,e){var i=!1,n=e&&e.models[e.models.length-1];if(n)switch(t.element.wrapBeforeMode){case Ts.Wrap:i=!0;break;case Ts.Nowrap:i=n.element.wrapAfterMode==Ts.Wrap;break;case Ts.Auto:(i=n.element.wrapAfterMode==Ts.Wrap)||(i=this._calculateInnerSize(t,e))}return i},e.internal_reset=function(){this._group=null,this._innerSize=0,this._total=0,this._holderList.length=0,this._isOverflowFixed=!0,this._tempHolderList.length=0,this.__debug_graphics&&this.__debug_graphics.clear()},e.internal_push=function(t){this._total++;var e=this.adapter.crossAxis;(!t.element.ignoreLayout||t.element.ignoreLayout&&t.element.placeholder)&&(0!=this._innerSize&&(this._innerSize+=this.adapter.layoutManager.spacing),this._innerSize+=t.size[e])},e.internal_recycleHolders=function(t){for(var e=0;e<this._holderList.length;e++){var i=this._holderList[e];i.internal_disable(),t(i)}this._holderList.length=0},e.internal_preVisible=function(t,e){return this._group=t,this._createHolders(e),this},e.internal_visible=function(){this.register();for(var t=0;t<this._tempHolderList.length;t++){var e=this._tempHolderList[t],i=e.holder,n=e.model,o=e.isNew;i.internal_visible(this,n,o)}this._tempHolderList.length=0,this.adapter.layoutManager.layout(this.group),this.onVisible()},e.internal_disable=function(){this.adapter.layoutManager.unLayout(this.index),this.unregister(),this.onDisable(),this.internal_reset()},e.internal_holderChanged=function(t){var e=!0,i=this.adapter.mainAxis,n=this.group.size[i];if(!t){for(var o=0,r=0;r<this.group.models.length;r++){var a=this.group.models[r],s=a.size[i];(this.adapter.isVertical&&this.adapter.layoutManager.controlScaleHeight||this.adapter.isHorizontal&&this.adapter.layoutManager.controlScaleWidth)&&(s*=a.scale[i]),o=Math.max(o,s)}zs.approximately(this.group.size[i],o)||(this.group.oldSize[i]=this.group.size[i],this.group.size[i]=o,e=!1)}e?this.adapter.layoutManager.layout(this.group):this.adapter.viewManager.internal_viewChanged(this,n)},e.register=function(){this.adapter.viewManager.on(Uc.Event.ON_SCROLL,this._onScroll,this),this.adapter.viewManager.on(Uc.Event.ON_LATEUPDATE,this._onLateUpdate,this),this.adapter.layoutManager.on(Cl.Event.ON_LAYOUT_COMPLATED,this._onLayoutComplated,this),this.adapter.layoutManager.on(Cl.Event.ON_CHANGED_LAYOUT_STATE,this._onChangedLayoutState,this)},e.unregister=function(){this.adapter.viewManager.off(Uc.Event.ON_SCROLL,this._onScroll,this),this.adapter.viewManager.off(Uc.Event.ON_LATEUPDATE,this._onLateUpdate,this),this.adapter.layoutManager.off(Cl.Event.ON_LAYOUT_COMPLATED,this._onLayoutComplated,this),this.adapter.layoutManager.off(Cl.Event.ON_CHANGED_LAYOUT_STATE,this._onChangedLayoutState,this)},e._createHolders=function(t){var e=this.adapter.mainAxis;this._tempHolderList.length=0;for(var i=0;i<this.group.models.length;i++){var n=this.group.models[i],o=!1,r=t&&t(n);r||(r=this.adapter.viewManager.internal_getHolder(n),o=!0),n.position[e]=this.group.position[e],this._holderList.push(r),this._tempHolderList.push({holder:r,model:n,isNew:o})}},e._calculateInnerSize=function(t,e){if(0==this._total)return!1;var i=t.size[this.adapter.crossAxis];return this._innerSize+i+this.adapter.layoutManager.spacing>e.size[this.adapter.crossAxis]},e._onLayoutComplated=function(t){if(-1!=t.indexOf(this.index)){for(var e=0;e<this.holderList.length;e++){this.holderList[e].internal_layout()}this.group.isFixed&&this._calcFixedPosition()}},e._calcFixedPosition=function(){for(var t=this._holderList.length,e=this.adapter.mainAxis,i=0;i<t;i++){var n=this._holderList[i];if(n.element.fixed){var o={x:n.model.position.x,y:n.model.position.y},r=0,a=this._getModelBoundary(n.model);if(this._isNeedFixed(a)){o[e]-=a;var s=this.adapter.viewManager.getNextFixedHolders(this.index);r=this._getRelativeNextHolderOffset(n,s)}o[e]+=r*this.adapter.multiplier,o[e]!=n.node.position[e]&&n.node.setPosition(o.x,o.y)}}},e._onChangedLayoutState=function(){this.adapter.layoutManager.layout(this.group)},e._onScroll=function(){this.group.isFixed&&0!=this._holderList.length&&this._calcFixedPosition()},e._onLateUpdate=function(t){},e._isNeedFixed=function(t){return 1==this.adapter.multiplier?t>=0:t<=0},e._getModelBoundary=function(t){var e=zs.isNumber(t.element.fixedOffset)?t.element.fixedOffset:0;return 1==this.adapter.multiplier?this._getModelHeaderBoundary(t)+e:this._getModelFooterBoundary(t)-e},e._getModelHeaderBoundary=function(t){var e=this.adapter.mainAxis;return t.position[e]+t.size[e]*(1-t.anchorPoint[e])*t.scale[e]+this.adapter.scrollManager.contentPosition},e._getModelFooterBoundary=function(t){var e=this.adapter.mainAxis;return t.position[e]-t.size[e]*t.anchorPoint[e]*t.scale[e]+this.adapter.scrollManager.contentPosition},e._getModelSizeWithSpacing=function(t){var e=this.adapter.mainAxis,i=zs.isNumber(t.element.fixedOffset)?t.element.fixedOffset:0,n=zs.isNumber(t.element.fixedSpacing)?t.element.fixedSpacing:this.adapter.viewManager.spacing;return t.size[e]*t.scale[e]+i+n},e._getReatureRelativeBoundary=function(t,e){var i=1==this.adapter.multiplier?this._getModelHeaderBoundary(t):this._getModelFooterBoundary(t),n=1==this.adapter.multiplier?i+e:e-i;return Math.min(n,e)},e._getRelativeNextHolderOffset=function(t,e){for(var i=e.length,n=this.adapter.crossAxis,o=this._getModelSizeWithSpacing(t.model),r=0,a=0;a<i;a++){var s=e[a],l=this._getReatureRelativeBoundary(s.model,o),c=t.model.scale[n]==s.model.scale[n],u=t.model.size[n]==s.model.size[n];if(t.fixedIndex==s.fixedIndex&&c&&u){r=l>0?l:0;break}l>0&&(r=Math.max(r,l))}return r},Nt(t,[{key:"isOverflowFixed",get:function(){return this._isOverflowFixed}},{key:"adapter",get:function(){return this._adapter}},{key:"group",get:function(){return this._group}},{key:"holderList",get:function(){return this._holderList}},{key:"index",get:function(){return this.group?this.group.index:-1}}]),t}())||_l);t._RF.pop(),t._RF.push({},"f2204qKI49MuZnaH/naH4DF","ViewManager",void 0);var lc,uc,hc,pc,dc,fc,gc,mc,vc,yc,bc,_c,Sc,wc,Tc,Cc,Ec,Pc,Ac,Mc,Oc,Ic,xc,Rc,Lc,Nc,Fc,Dc,kc,zc,Vc=e.ccclass,Bc=e.property,Hc=function(t){return t[t.ON_SCROLL=0]="ON_SCROLL",t[t.ON_LATEUPDATE=1]="ON_LATEUPDATE",t[t.ON_CLEARVIEWS=2]="ON_CLEARVIEWS",t[t.ON_UPDATE_VIEWS=3]="ON_UPDATE_VIEWS",t[t.ON_CHANGED_VIRTUALSIZE=4]="ON_CHANGED_VIRTUALSIZE",t[t.ON_MAGNETIC=5]="ON_MAGNETIC",t[t.ON_CHANGED_OVERFLOWHEADER=6]="ON_CHANGED_OVERFLOWHEADER",t[t.ON_RESET_ALL_STATE=7]="ON_RESET_ALL_STATE",t[t.ON_CHANGED_SPACING=8]="ON_CHANGED_SPACING",t}(Hc||{}),Uc=(El=Vc("ViewManager"),Pl=Bc({type:_s}),Al=Bc({type:_s,tooltip:"主轴方向的排列方式\n        Start: 从上到下、从左到右\n        End: 从下到上、从右到左"}),Ml=Bc({type:Ss,tooltip:"当元素的尺寸、缩放改变时，受影响的其他元素应该如何计算新的位置\n        Auto: 以可视区域中心为起点，所有其他元素向两边延伸\n        Center: 以当前变化的元素为起点，所有其他元素向两边延伸\n        Header: 以当前变化的元素和它头部的所有元素向头部延伸\n        Footer: 以当前变化的元素和它尾部的所有元素向尾部延伸"}),Ol=Bc({range:[0,1],slide:!0,step:.01,tooltip:"当元素移动到可视区域外偏移多少时才进行回收\n        比如元素的尺寸为100，当元素超出可视范围 100+100*0.3 时就会被回收\n        没有特殊需求时，默认值即可"}),Il=Bc({range:[0,1],slide:!0,step:.01,tooltip:"此值会影响填充元素的时机\n        没有特殊需求时，默认值即可"}),xl=Bc({tooltip:"主轴方向元素的间隙"}),Rl=Bc({group:{id:"padding",name:"padding"}}),Ll=Bc({group:{id:"padding",name:"padding"}}),Nl=Bc({group:{id:"padding",name:"padding"}}),Fl=Bc({group:{id:"padding",name:"padding"}}),Dl=Bc({tooltip:"磁性停靠\n        开启后，会在增加数据时，根据设置进行自动滚动到顶部或底部"}),kl=Bc({type:Es,visible:function(){return this.magnetic},tooltip:"停靠的方向"}),zl=Bc({visible:function(){return this.magnetic},tooltip:"停靠动画的时长"}),Vl=Bc({visible:function(){return this.magnetic},tooltip:"默认情况下，仅当添加数据时才会触发停靠\n        当开启时，元素的尺寸改变时,也会否触发停靠"}),Bl=Bc({tooltip:"头部循环"}),Hl=Bc({tooltip:"尾部循环"}),El(((rc=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,It(e,"_arrangeAxis",Wl,xt(e)),It(e,"stretchDirection",Zl,xt(e)),It(e,"overflowOffset",Yl,xt(e)),It(e,"enterOffset",ql,xt(e)),It(e,"_spacing",jl,xt(e)),It(e,"left",Kl,xt(e)),It(e,"right",Xl,xt(e)),It(e,"top",Ql,xt(e)),It(e,"bottom",Jl,xt(e)),It(e,"magnetic",$l,xt(e)),It(e,"magneticDirection",tc,xt(e)),It(e,"magneticDuration",ec,xt(e)),It(e,"magneticSizeChanges",ic,xt(e)),It(e,"loopHeader",nc,xt(e)),It(e,"loopFooter",oc,xt(e)),e._groupLength=0,e._cacheGroups=[],e._groups=[],e._disableViews=[],e._visibleViews=[],e._fixedViews=[],e._disableHolders=[],e._isFill=!1,e._headerIndex=-1,e._footerIndex=-1,e._virtualSize=0,e._overflowHeader=0,e._cacheHeadeDatas=[],e._cacheHeadePosition=void 0,e}Ot(e,t);var i=e.prototype;return i.onInit=function(){this.adapter.modelManager.on(Ys.Event.ON_CHANGE_BEFORE,this._onModelChangeBefore,this),this.adapter.modelManager.on(Ys.Event.ON_INSERT,this._updateGroups,this),this.adapter.modelManager.on(Ys.Event.ON_REMOVE,this._updateGroups,this),this.adapter.modelManager.on(Ys.Event.ON_MOVE,this._updateGroups,this),this.adapter.modelManager.on(Ys.Event.ON_CLEAR,this._onClearModel,this),this.adapter.scrollManager.on(ru.Event.ON_SCROLL,this._onScroll,this),this.adapter.scrollManager.on(ru.Event.ON_VIEW_SIZE_CHANGED,this._resetAllState,this),this.adapter.scrollManager.on(ru.Event.ON_CHANGED_ORIENTATION,this._resetAllState,this)},i._clearAll=function(){for(var t,e=0,i=this._visibleViews.length;e<i;e++)this._recycleViewToDisableViews(this._visibleViews[e]);(t=this._cacheGroups).push.apply(t,this._groups),this._clearFixedViews(),this._visibleViews.length=0,this._groups.length=0,this.virtualSize=0,this.overflowHeader=0},i._onClearModel=function(){this._clearAll(),this.emit(Hc.ON_CLEARVIEWS)},i._resetAllState=function(){this._clearAll(),this.internal_updateVisibleView(0),this.emit(Hc.ON_RESET_ALL_STATE)},i._onModelChangeBefore=function(){if(this.header&&this.virtualSize>this.adapter.mainAxisSize){var t=this.getVisibleIndexByGroupIndex(0);if(-1!=t){var e=this._visibleViews[t];this._cacheHeadeDatas=e.group.models.map((function(t){return t.data})),this._cacheHeadePosition={x:e.group.position.x,y:e.group.position.y}}else this._cacheHeadeDatas=this.header.group.models.map((function(t){return t.data})),this._cacheHeadePosition={x:this.header.group.position.x,y:this.header.group.position.y}}},i._updateGroups=function(t){var e,i=this,n=this._getViewFromDisibleViews(null),o=this.getGroupIndexByModelIndex(t);-1==o&&(o=this._groupLength-1);var r=null,a=!1,s={modelIndex:t,fixedIndex:-1},l=this._groups[o-1];for(l&&(s.fixedIndex=l.fixedIndex);;){(r=this._groups[o])||((r=this._getGroupFromCache()).internal_setIndex(this._groups.length),this._groups.push(r),o=this._groups.length);var c=r.internal_insert(s,n,a);if(o++,a=!0,!c)break}var u=this._groups.splice(o,this._groups.length);(e=this._cacheGroups).push.apply(e,u),this._groupLength=this._groups.length;var h=-1,p=0;this._cacheHeadeDatas.length>0&&(h=this._groups.findIndex((function(t){return t.internal_includes(i._cacheHeadeDatas)})));var d=this._groups[h];d&&(p+=d.size[this.adapter.mainAxis]+this.spacing,d.internal_setPosition(this._cacheHeadePosition[this.adapter.mainAxis]));for(var f=h-1;f>=0;f--){var g=this._groups[f];this._calcMainAxisPosition(g,d,Es.Header),p+=g.size[this.adapter.mainAxis]+this.spacing,d=g}d=this._groups[h];for(var m=h+1;m<this.groupLength;m++){g=this._groups[m];this._calcMainAxisPosition(g,d,Es.Footer),p+=g.size[this.adapter.mainAxis]+this.spacing,d=g}p-=this.spacing,this._virtualSize=Math.max(0,p),this._resetOverflowHeader(this._groups[0]),n.internal_reset(),this._disableViews.push(n),this.updateVisibles(h),this._cacheHeadeDatas=[],this._cacheHeadePosition=null},i.updateVisibles=function(t){var e=[];t=Math.max(0,t);for(var i=function(t){var i=e.findIndex((function(e){return e.oldData==t.data}));return-1!=i?e.splice(i,1)[0]:null},n=0;n<this._visibleViews.length;n++){var o=this._visibleViews[n];e=e.concat(o.holderList),o.internal_reset()}for(var r=this.adapter.mainAxisSize,a=0,s=this.visibleLength,l=t,c=this._groups.length;l<c;l++){var u=this._groups[l];if(this.getVisibleMainAxisSize()>=r&&s<=0)break;(p=this._visibleViews[a++])||(p=this._getViewFromDisibleViews(u.index),this._visibleViews.push(p)),p.internal_preVisible(u,i),s--}for(var h=this._visibleViews.length-1;h>=0;h--){var p;if((p=this._visibleViews[h]).holderList.length>0)break;this._disableFromVisibleViews(h)}for(var d=0,f=e.length;d<f;d++){var g=e[d];g.internal_disable(),this._disableHolders.push(g)}for(var m=0;m<this.visibleLength;m++)this._visibleViews[m].internal_visible();this._forceFill(),this._calcMagnetic(),this.emit(Hc.ON_UPDATE_VIEWS)},i._getGroupFromCache=function(){var t=this._cacheGroups.pop();return t||(t=new Ds(this.adapter)),t.internal_reset(),t},i._calcMagnetic=function(){if(this.magnetic&&this.header){var t=!1;0==this.adapter.scrollManager.velocity&&(this.magneticDirection==Es.Footer?this.footer.index==this._groupLength-1&&(this.adapter.scrollManager.scrollToFooter(this.magneticDuration),t=!0):0==this.header.index&&(this.adapter.scrollManager.scrollToHeader(this.magneticDuration),t=!0)),this.emit(Hc.ON_MAGNETIC,t)}},i._calcMainAxisPosition=function(t,e,i){if(t)if(e){var n,o,r=this.adapter.mainAxis,a=this.adapter.multiplier,s=i==Es.Footer?1:-1;i==Es.Footer?(n=1==a?e.anchorPoint[r]:1-e.anchorPoint[r],o=1==a?1-t.anchorPoint[r]:t.anchorPoint[r]):(n=1==a?1-e.anchorPoint[r]:e.anchorPoint[r],o=1==a?t.anchorPoint[r]:1-t.anchorPoint[r]);var l=e.position[r];l-=e.size[r]*n*s*a,l-=this.spacing*a*s,l-=t.size[r]*o*s*a,t.internal_setPosition(l)}else t.internal_setPosition(this._getMainAxisHeaderPosition(t))},i._getMainAxisHeaderPosition=function(t){var e=0,i=0;return this.adapter.isVertical?(e=this.adapter.isArrangeAxisStart?-this.top:this.bottom,i=this.adapter.isArrangeAxisStart?1-t.anchorPoint[this.adapter.mainAxis]:t.anchorPoint[this.adapter.mainAxis]):(e=this.adapter.isArrangeAxisStart?this.left:-this.right,i=this.adapter.isArrangeAxisStart?t.anchorPoint[this.adapter.mainAxis]:1-t.anchorPoint[this.adapter.mainAxis]),e-=i*t.size[this.adapter.mainAxis]*this.adapter.multiplier},i._getViewFromDisibleViews=function(t){var e=null;if(null!=t){var i=this._fixedViews.findIndex((function(e){return e.index==t}));if(-1!=i){var n=this._fixedViews.splice(i,1)[0];this._recycleViewToDisableViews(n)}}return e||(e=this._disableViews.pop()),e||(e=this.adapter.getView()),e},i._getHolderFromDisableHolders=function(t){var e=this._disableHolders.findIndex((function(e){return e.code==t.code}));if(-1!=e)return this._disableHolders.splice(e,1)[0]},i._disableFromVisibleViews=function(t){var e=-1;e=t instanceof sc?this._visibleViews.findIndex((function(e){return e.index==t.index})):t,this._recycleViewToDisableViews(this._visibleViews[e]),this._visibleViews.splice(e,1)},i._recycleViewToDisableViews=function(t){var e=this;t&&(t.internal_recycleHolders((function(t){return e._disableHolders.push(t)})),t.internal_disable(),this._disableViews.push(t))},i._clearFixedViews=function(){for(var t=0,e=this._fixedViews.length;t<e;t++){var i=this._fixedViews[t];this._recycleViewToDisableViews(i)}this._fixedViews.length=0},i._checkHeaderInvisible=function(){this.header&&(this.loopFooter||this.footer.index!=this.groupLength-1)&&this._isOverflowHeader(this.header.group)&&(this._disableFromVisibleViews(0),this._checkHeaderInvisible())},i._checkFooterInvisible=function(){this.footer&&(this.loopHeader||0!=this.header.index)&&this._isOverflowFooter(this.footer.group)&&(this._disableFromVisibleViews(this._visibleViews.length-1),this._checkFooterInvisible())},i._isOverflowHeader=function(t,e){void 0===e&&(e=this.overflowOffset);var i=this.internal_getGroupFooterBoundary(t);return e*=t.size[this.adapter.mainAxis],1==this.adapter.multiplier?i>=e:i<=-e},i._isOverflowFooter=function(t,e){void 0===e&&(e=this.overflowOffset);var i=this.internal_getGroupHeaderBoundary(t);return e*=t.size[this.adapter.mainAxis],1==this.adapter.multiplier?i+this.adapter.mainAxisSize<=-e:i-this.adapter.mainAxisSize>=e},i._isEnterFooter=function(t){if(!t)return!1;var e=this.internal_getGroupFooterBoundary(t),i=this.enterOffset*t.size[this.adapter.mainAxis];return 1==this.adapter.multiplier?e+this.adapter.mainAxisSize+i>=0:e-this.adapter.mainAxisSize-i<=0},i._isEnterHeader=function(t){if(!t)return!1;var e=this.internal_getGroupHeaderBoundary(t),i=this.overflowOffset*t.size[this.adapter.mainAxis];return 1==this.adapter.multiplier?e-i<=0:e+i>=0},i._fillHeader=function(){var t=this._groups[this._headerIndex];if(this._isEnterHeader(t)){var e=this._accumTargetSizeTowardsHeader(t.index,this.internal_getInitHeaderSize(t)),i=e.index,n=e.size,o=this._groups[i];if(o&&-1==this.getVisibleIndexByGroupIndex(i)){var r=this.internal_convertSizeToHeaderPosition(n,o);o.internal_setPosition(r);var a=this._getViewFromDisibleViews(o.index);this._visibleViews.unshift(a),a.internal_preVisible(o).internal_visible(),0==a.index&&this._resetOverflowHeader(a.group),this._headerIndex=o.index,this._fillHeader()}}},i._fillFooter=function(){var t=this._groups[this._footerIndex];if(this._isEnterFooter(t)){var e=this._accumTargetSizeTowardsFooter(t.index,this.internal_getInitFooterSize(t)),i=e.index,n=e.size,o=this._groups[i];if(o&&-1==this.getVisibleIndexByGroupIndex(i)){var r=this.internal_convertSizeToFooterPosition(n,o);o.internal_setPosition(r);var a=this._getViewFromDisibleViews(o.index);this._visibleViews.push(a),a.internal_preVisible(o).internal_visible(),0==a.index&&this._resetOverflowHeader(a.group),this._footerIndex=o.index,this._fillFooter()}}},i._fillFixedView=function(){if(this.header&&(-1!=this.header.group.fixedIndex||this.header.group.isFixed))for(var t=this.header.index,e=this.adapter.mainAxis,i=this.internal_getInitHeaderSize(this.header.group),n=t-1;n>=0;n--){var o=this._groups[n];if(!o)return void console.error("_fillFixedView错误 找不到group",n);if(i+=o.size[e]+this.spacing,o.isFixed){var r=this.internal_convertSizeToHeaderPosition(i,o);if(-1!=this._fixedViews.findIndex((function(t){return t.index==o.index}))){zs.approximately(r,o.position[e])||(o.internal_setPosition(r),this.adapter.layoutManager.layout(o));break}this._clearFixedViews();r=this.internal_convertSizeToHeaderPosition(i,o);o.internal_setPosition(r);var a=this._getViewFromDisibleViews(o.index);a.internal_preVisible(o).internal_visible(),this._fixedViews.push(a);break}}},i._accumTargetSizeTowardsHeader=function(t,e){for(var i=this._groups.length;;){if(0==t&&this.loopHeader&&(t=i),0==t)return{index:t,size:e};if(t--,!this._groups[t])return{index:t,size:e};if((e+=this.internal_accumulationSize(t))>=0)return{index:t,size:e}}},i._accumTargetSizeTowardsFooter=function(t,e){for(var i=this._groups.length;;){if(t==i-1&&this.loopFooter&&(t=-1),t==i-1)return{index:t,size:e};if(t++,!this._groups[t])return{index:t,size:e};if((e+=this.internal_accumulationSize(t))>=0)return{index:t,size:e}}},i._fillFooterHandle=function(){this._checkHeaderInvisible(),this._fillFooter()},i._fillHeaderHandle=function(){this._checkFooterInvisible(),this._fillHeader()},i._forceFill=function(){this._updateHeaderFooterIndex(),this._fillHeaderHandle(),this._fillFooterHandle()},i._updateHeaderFooterIndex=function(){this._headerIndex=this.header?this.header.index:0,this._footerIndex=this.footer?this.footer.index:0},i._onScroll=function(t){if(0!=this._groups.length){switch(this._updateHeaderFooterIndex(),t){case As.Up:case As.Left:this.adapter.isArrangeAxisStart?this._fillFooterHandle():this._fillHeaderHandle();break;case As.Down:case As.Right:this.adapter.isArrangeAxisStart?this._fillHeaderHandle():this._fillFooterHandle()}this._fillFixedView(),this.emit(Hc.ON_SCROLL)}},i._stretchToHeader=function(t,e){for(var i=this._visibleViews[t],n=e;n>=0;n--){var o=this._visibleViews[n];i?(this._calcMainAxisPosition(o.group,i.group,Es.Header),this.adapter.layoutManager.layout(o.group)):this.getVisibleMainAxisSize()<this.adapter.mainAxisSize&&this._calcMainAxisPosition(o.group,null,Es.Header),i=o}},i._stretchToFooter=function(t,e){for(var i=this._visibleViews[t],n=e;n<this._visibleViews.length;n++){var o=this._visibleViews[n];i?(this._calcMainAxisPosition(o.group,i.group,Es.Footer),this.adapter.layoutManager.layout(o.group)):this.getVisibleMainAxisSize()<this.adapter.mainAxisSize&&this._calcMainAxisPosition(o.group,null,Es.Footer),i=o}},i._resetOverflowHeader=function(t){if(!t)return this.overflowHeader=0;var e=this.adapter.mainAxis,i=t.anchorPoint[e];i=1==this.adapter.multiplier?1-i:i;var n=t.position[e];n+=t.size[e]*i*this.adapter.multiplier,this.overflowHeader=n},i._calcOverflowHeader=function(t,e,i){var n=this.getVisibleIndexByGroupIndex(0);if(-1!=n){var o=this._visibleViews[n];return this._resetOverflowHeader(o.group)}var r=this.adapter.mainAxis,a=t.anchorPoint[r];a=1==this.adapter.multiplier?1-a:a;var s=t.oldSize[r],l=t.size[r],c=this.adapter.multiplier;switch(this.stretchDirection){case Ss.Header:var u=t.oldPosition[r]+s*a*c;(h=1==c?this.overflowHeader>=u:this.overflowHeader<=u)&&(this.overflowHeader+=(l-s)*c);break;case Ss.Footer:u=t.oldPosition[r]+s*a*c;(h=1==c?this.overflowHeader>=u:this.overflowHeader<=u)||(this.overflowHeader-=(l-s)*c);break;case Ss.Center:u=t.oldPosition[r]+s*a*c;(h=1==c?this.overflowHeader>=u:this.overflowHeader<=u)?this.overflowHeader+=.5*(l-s)*c:this.overflowHeader-=.5*(l-s)*c;break;case Ss.Auto:u=t.oldPosition[r]+s*a*c;var h=1==c?this.overflowHeader>=u:this.overflowHeader<=u;e<=i&&(u=t.oldPosition[r]+s*a*c,h=-1==c?this.overflowHeader>=u:this.overflowHeader<=u),h&&(e<=i?this.overflowHeader-=(l-s)*c:this.overflowHeader+=(l-s)*c)}},i.internal_lateUpdate=function(t){this._isFill&&(this._isFill=!1,this._forceFill()),this.emit(Hc.ON_LATEUPDATE,t)},i.internal_viewChanged=function(t,e){var i=t.group.size[this.adapter.mainAxis]-e;this.virtualSize+=i;var n=this.getVisibleIndexByGroupIndex(t.index),o=-1;if(this.getVisibleMainAxisSize()<this.adapter.mainAxisSize||this.stretchDirection==Ss.Footer){var r=n-1;this._visibleViews[r]||this.adapter.layoutManager.layout(t.group),this._stretchToFooter(r,n)}else if(this.stretchDirection==Ss.Header){var a=n+1;this._visibleViews[a]||this.adapter.layoutManager.layout(t.group),this._stretchToHeader(a,n)}else if(this.stretchDirection==Ss.Center)this.adapter.layoutManager.layout(t.group),this._stretchToHeader(n,n-1),this._stretchToFooter(n,n+1);else{if(-1==(o=this.adapter.centerManager.getCenterVisibleIndex()))throw Error("找不到中心索引"+t.index);var s=this._visibleViews[o];this.adapter.layoutManager.layout(s.group),this._stretchToHeader(o,o-1),this._stretchToFooter(o,o+1)}this._calcOverflowHeader(t.group,o,n),this.magneticSizeChanges&&this._calcMagnetic(),this._isFill=!0,this.emit(Hc.ON_CHANGED_VIRTUALSIZE)},i.internal_getHolder=function(t){var e=this._getHolderFromDisableHolders(t);if(!e){var i=this.adapter.getPrefab(t.data),n=E(i);e=this.adapter.getHolder(n,t.code)}return e.node.parent=this.adapter.scrollManager.getLayerNode(t.element.layer),e},i.internal_updateVisibleView=function(t){this._onModelChangeBefore(),this._updateGroups(t)},i.internal_getGroupFooterBoundary=function(t){if(!t)return 0;var e=t.anchorPoint[this.adapter.mainAxis];e=1==this.adapter.multiplier?e:1-e;var i=t.position[this.adapter.mainAxis];return i-=t.size[this.adapter.mainAxis]*e*this.adapter.multiplier,i+=this.adapter.scrollManager.contentPosition},i.internal_getGroupHeaderBoundary=function(t){if(!t)return 0;var e=t.anchorPoint[this.adapter.mainAxis];return e=1==this.adapter.multiplier?1-e:e,t.position[this.adapter.mainAxis]+this.adapter.scrollManager.contentPosition+e*t.size[this.adapter.mainAxis]*this.adapter.multiplier},i.internal_getInitHeaderSize=function(t){if(!t)return 0;var e=t.anchorPoint[this.adapter.mainAxis];e=1==this.adapter.multiplier?1-e:e;var i=-t.position[this.adapter.mainAxis]*this.adapter.multiplier;return i-=t.size[this.adapter.mainAxis]*e,i-=this.adapter.scrollManager.contentPosition*this.adapter.multiplier,i=this.adapter.mainAxisSize-i},i.internal_getInitFooterSize=function(t){if(!t)return 0;var e=t.anchorPoint[this.adapter.mainAxis];e=1==this.adapter.multiplier?e:1-e;var i=-t.position[this.adapter.mainAxis]*this.adapter.multiplier;return i+=t.size[this.adapter.mainAxis]*e,i-=this.adapter.scrollManager.contentPosition*this.adapter.multiplier},i.internal_accumulationSize=function(t){var e=this._groups[t];return e?e.size[this.adapter.mainAxis]+this.spacing:0},i.internal_convertSizeToFooterPosition=function(t,e){var i=e.anchorPoint[this.adapter.mainAxis];i=1==this.adapter.multiplier?i:1-i;var n=e.size[this.adapter.mainAxis]*i,o=-this.adapter.scrollManager.contentPosition;return o-=this.adapter.multiplier*t-this.adapter.multiplier*n},i.internal_convertSizeToHeaderPosition=function(t,e){var i=e.anchorPoint[this.adapter.mainAxis];i=1==this.adapter.multiplier?1-i:i;var n=e.size[this.adapter.mainAxis]*i,o=this.adapter.multiplier*t-this.adapter.multiplier*n;return o-=this.adapter.multiplier*this.adapter.mainAxisSize,o-=this.adapter.scrollManager.contentPosition},i.getGroup=function(t){return this._groups[t]},i.getVisibleView=function(t){return this._visibleViews[t]},i.getVisibleMainAxisSize=function(){if(0==this._visibleViews.length)return 0;for(var t=0,e=this.adapter.mainAxis,i=0,n=this._visibleViews.length;i<n;i++){var o=this._visibleViews[i];o.group&&(t+=o.group.size[e]+this.spacing)}return t-=this.spacing},i.getGroupIndexByModelIndex=function(t){for(var e=0,i=this._groups.length;e<i;e++){if(-1!=this._groups[e].findModelIndex(t))return e}return-1},i.getVisibleIndexByGroupIndex=function(t){return this._visibleViews.findIndex((function(e){return e.index==t}))},i.getNextFixedHolders=function(t){for(var e=[],i=this.getVisibleIndexByGroupIndex(t)+1,n=this._visibleViews.length;i<n;i++){var o=this._visibleViews[i];if(o.index!=t&&o.group.isFixed){e=o.getFixedHolders();break}}return e},i.getMagneticOffset=function(){if(!this.magnetic)return 0;var t=this.adapter.isHorizontal?-this.adapter.multiplier:this.adapter.multiplier;return this.magneticDirection==Es.Footer?this.footer?Math.max(0,this.adapter.mainAxisSize-this.adapter.mainAxisPadding-this.getVisibleMainAxisSize())*t:this.adapter.mainAxisSize*t:0},Nt(e,[{key:"arrangeAxis",get:function(){return this._arrangeAxis},set:function(t){t!=this._arrangeAxis&&(this._arrangeAxis=t,this._resetAllState())}},{key:"spacing",get:function(){return this._spacing},set:function(t){t!=this._spacing&&(this._spacing=t,this._resetAllState())}},{key:"header",get:function(){return this._visibleViews[0]}},{key:"footer",get:function(){return this._visibleViews[this._visibleViews.length-1]}},{key:"overflowHeader",get:function(){return this._overflowHeader},set:function(t){t!=this._overflowHeader&&(this._overflowHeader=t,this.emit(Hc.ON_CHANGED_OVERFLOWHEADER,t))}},{key:"virtualSize",get:function(){return this._virtualSize},set:function(t){t!=this._virtualSize&&(this._virtualSize=t,this.emit(Hc.ON_CHANGED_VIRTUALSIZE))}},{key:"groupLength",get:function(){return this._groupLength}},{key:"visibleLength",get:function(){return this._visibleViews.length}},{key:"min",get:function(){return this.header?this.adapter.isArrangeAxisStart?this.internal_getGroupFooterBoundary(this.footer.group):this.internal_getGroupHeaderBoundary(this.header.group):0}},{key:"max",get:function(){return this.header?this.adapter.isArrangeAxisStart?this.internal_getGroupHeaderBoundary(this.header.group):this.internal_getGroupFooterBoundary(this.footer.group):0}}]),e}(Us)).Event=Hc,Wl=Mt((Gl=rc).prototype,"_arrangeAxis",[Pl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return _s.Start}}),Mt(Gl.prototype,"arrangeAxis",[Al],Object.getOwnPropertyDescriptor(Gl.prototype,"arrangeAxis"),Gl.prototype),Zl=Mt(Gl.prototype,"stretchDirection",[Ml],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Ss.Auto}}),Yl=Mt(Gl.prototype,"overflowOffset",[Ol],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.3}}),ql=Mt(Gl.prototype,"enterOffset",[Il],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),jl=Mt(Gl.prototype,"_spacing",[Bc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Mt(Gl.prototype,"spacing",[xl],Object.getOwnPropertyDescriptor(Gl.prototype,"spacing"),Gl.prototype),Kl=Mt(Gl.prototype,"left",[Rl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Xl=Mt(Gl.prototype,"right",[Ll],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Ql=Mt(Gl.prototype,"top",[Nl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Jl=Mt(Gl.prototype,"bottom",[Fl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),$l=Mt(Gl.prototype,"magnetic",[Dl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),tc=Mt(Gl.prototype,"magneticDirection",[kl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Es.Header}}),ec=Mt(Gl.prototype,"magneticDuration",[zl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),ic=Mt(Gl.prototype,"magneticSizeChanges",[Vl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),nc=Mt(Gl.prototype,"loopHeader",[Bl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),oc=Mt(Gl.prototype,"loopFooter",[Hl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Ul=Gl))||Ul);t._RF.pop(),t._RF.push({},"38125A9jl5DlJflB6yBKrYI","ScrollManager",void 0);var Gc,Wc,Zc,Yc,qc,jc,Kc,Xc,Qc,Jc,$c,tu=e.ccclass,eu=e.property,iu=new g,nu="__ADAPTER__",ou=function(t){return t[t.ON_SCROLL=0]="ON_SCROLL",t[t.ON_UPDATE_PERCENTAGE=1]="ON_UPDATE_PERCENTAGE",t[t.ON_VIEW_SIZE_CHANGED=2]="ON_VIEW_SIZE_CHANGED",t[t.ON_ABOUT_TO_STOP=3]="ON_ABOUT_TO_STOP",t[t.ON_SCROLL_START=4]="ON_SCROLL_START",t[t.ON_SCROLL_END=5]="ON_SCROLL_END",t[t.ON_SCROLL_CANCEL=6]="ON_SCROLL_CANCEL",t[t.ON_CHANGED_ORIENTATION=7]="ON_CHANGED_ORIENTATION",t[t.ON_SCROLL_TO_GROUPINDEX_BEFOR=8]="ON_SCROLL_TO_GROUPINDEX_BEFOR",t[t.ON_SCROLL_TO_GROUPINDEX_AFTER=9]="ON_SCROLL_TO_GROUPINDEX_AFTER",t[t.ON_SCROLL_TO_MODELINDEX_BEFOR=10]="ON_SCROLL_TO_MODELINDEX_BEFOR",t[t.ON_SCROLL_TO_MODELINDEX_AFTER=11]="ON_SCROLL_TO_MODELINDEX_AFTER",t}(ou||{}),ru=(lc=tu("ScrollManager"),uc=eu(B),hc=eu(B),pc=eu(B),dc=eu(B),fc=eu({type:ys}),gc=eu({type:ys}),mc=eu({type:Cs,tooltip:"Auto: 当内容撑满可视区域或开启ReleaseManager时允许拖动\n        AlwaysAllow: 任何情况下都可以拖动，即使没有任何元素\n        Disabled: 任何情况下都禁用拖动\n        "}),vc=eu({type:bs}),yc=eu({range:[0,1],slide:!0,step:.001,visible:function(){return this.movementType==bs.Elastic}}),bc=eu({range:[0,1],slide:!0,step:.001,visible:function(){return this.inertia}}),_c=eu({tooltip:"当滚动速度小于这个值时，会发送ON_ABOUT_TO_STOP广播"}),Sc=eu({tooltip:"取消子节点的Button点击事件"}),wc=eu({range:[0,.5],slide:!0,step:.001,visible:function(){return this.inertia},tooltip:"嵌套时，当子元素的ScrollView拖动方向和当前拖动方向相同时，使用当前阈值进行计算由谁来处理拖动\n        无特殊需求时，默认值即可"}),Tc=eu({range:[.5,1],slide:!0,step:.001,visible:function(){return this.inertia},tooltip:"嵌套时，当子元素的ScrollView拖动方向和当前拖动方向相同时，使用当前阈值进行计算由谁来处理拖动\n        无特殊需求时，默认值即可"}),lc(((zc=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,It(e,"_view",Pc,xt(e)),It(e,"_content",Ac,xt(e)),It(e,"_orientation",Mc,xt(e)),It(e,"touchMode",Oc,xt(e)),It(e,"movementType",Ic,xt(e)),It(e,"elasticity",xc,xt(e)),It(e,"inertia",Rc,xt(e)),It(e,"decelerationRate",Lc,xt(e)),It(e,"aboutToStopVelocity",Nc,xt(e)),It(e,"cancelInnerEvents",Fc,xt(e)),It(e,"nestedMinThreshold",Dc,xt(e)),It(e,"nestedMaxThreshold",kc,xt(e)),e.__debug_graphics=void 0,e._boundaryOffset=0,e._viewWidget=null,e._parentAdapter=void 0,e._layerLowest=void 0,e._layerMedium=void 0,e._layerHighest=void 0,e._percentage=0,e._velocity=0,e._dragging=!1,e._scrolling=!1,e._isCanceledEvent=!1,e._contentStartPosition=new g,e._prevContentPosition=new g,e._nestedDirection=Os.Both,e._parentTouch=!1,e._stopCheckNested=!1,e._scrollHandlePercentage=null,e._scrollHandlePosition=null,e._isEmitAboutToStop=!1,e._isMyEventAndMoved=!1,e._scrollDirection=As.None,e._laseScrollDirection=As.None,e._touchEvent=null,e.test=!1,e}Ot(e,t);var i=e.prototype;return i.onInit=function(){var t=this;this._initView(),this._initContent(),this._parentAdapter=this.adapter.getParentAdapter(this.adapter.node.parent),this.view.node[nu]=!0,this.adapter.viewManager.on(Uc.Event.ON_UPDATE_VIEWS,this._onUpdateViews,this),this.adapter.viewManager.on(Uc.Event.ON_CHANGED_VIRTUALSIZE,this._onChangedVirtualSize,this),this.adapter.viewManager.on(Uc.Event.ON_CHANGED_OVERFLOWHEADER,this._onChangedOverflowHeader,this),this.adapter.viewManager.on(Uc.Event.ON_RESET_ALL_STATE,this._onResetAllState,this),this.adapter.viewManager.on(Uc.Event.ON_CLEARVIEWS,this._onResetAllState,this),this.adapter.node.on(c.EventType.SIZE_CHANGED,this._onAdapterSizeChanged,this),this.view.node.on(c.EventType.SIZE_CHANGED,this._onViewSizeChanged,this),this._registerTouchEvent(),this.__createDebug(),this.view.scheduleOnce((function(){t._updatePercentage()}))},i._initView=function(){if(!this.view)throw Error("ScrollManager view 参数为空！");var t={x:.5,y:.5};t[this.adapter.mainAxis]=this.adapter.mainAxisAnchorPoint,this.view.setAnchorPoint(t.x,t.y);var e=this.view.getComponent(Y);e||((e=this.view.addComponent(Y)).isAlignLeft=e.isAlignRight=e.isAlignTop=e.isAlignBottom=!0,e.left=e.right=e.top=e.bottom=0),e.updateAlignment(),this._viewWidget=e},i.__createDebug=function(){},i.__drawDebug=function(){if(this.__debug_graphics){this.__debug_graphics.clear();var t=this.adapter.mainAxis,e=this.adapter.crossAxis,i=this.adapter.multiplier,n={x:0,y:0},o={x:0,y:0};o[t]=this.adapter.viewManager.virtualSize,o[e]=this.adapter.crossAxisSize,n[t]=this.contentPosition-o[t]*this.content.anchorPoint[t]*i,n[t]+=this.adapter.viewManager.overflowHeader,n[e]-=o[e]*this.view.anchorPoint[e],this.__debug_graphics.fillRect(n.x,n.y,o.x,o.y),this.__debug_graphics.stroke()}},i._initContent=function(){if(!this.content)throw Error("ScrollManager content 参数为空！");this.content.setAnchorPoint(this.view.anchorPoint);var t={x:0,y:0};t[this.adapter.crossAxis]=this.view.contentSize[this.adapter.crossAxis],this.content.setContentSize(t.x,t.y),this._layerLowest||(this._layerLowest=new c("_layerLowest"),this._layerMedium=new c("_layerMedium"),this._layerHighest=new c("_layerHighest"),this.content.node.addChild(this._layerLowest),this.content.node.addChild(this._layerMedium),this.content.node.addChild(this._layerHighest)),this._updateContentPosition({x:0,y:0})},i._registerTouchEvent=function(){this.view.node.on(c.EventType.TOUCH_START,this._onTouchStart,this,!0),this.view.node.on(c.EventType.TOUCH_END,this._onTouchEnd,this,!0),this.view.node.on(c.EventType.TOUCH_CANCEL,this._onTouchCancel,this,!0),this.view.node.on(c.EventType.TOUCH_MOVE,this._onTouchMove,this,!0)},i._bubbleToParent=function(t){this._parentAdapter&&this._parentAdapter.scrollManager.view.node.dispatchEvent(t)},i._emitCancelEvent=function(t){if(!this._isCanceledEvent){var e=t.getUILocation();e.subtract(t.getUIStartLocation()),this.cancelInnerEvents&&e.length()>7&&t.target!==this.view.node&&(this._simulateEvent(t,c.EventType.MOUSE_LEAVE),this._simulateEvent(t,c.EventType.TOUCH_CANCEL),this._isCanceledEvent=!0)}},i._simulateEvent=function(t,e,i){if(void 0===i&&(i=!0),t){var n=new Q(t.getTouches(),t.bubbles),o=t.target;n.type=e,n.touch=t.touch,n.simulate=i,o.dispatchEvent(n)}},i._onUpdateViews=function(){this._velocity=0,this._updatePercentage()},i._onChangedVirtualSize=function(){this._updatePercentage(),null!=this._scrollHandlePosition&&null!=this._scrollHandlePosition.change&&this._scrollHandlePosition.change()},i._onChangedOverflowHeader=function(t){this.__drawDebug()},i._onResetAllState=function(){this._velocity=0,this._scrolling=!1,this._dragging=!1,this._isMyEventAndMoved=!1,this._scrollDirection=As.None,this._percentage=0,this._isEmitAboutToStop=!1,this._boundaryOffset=0,this._isCanceledEvent=!1,this._parentTouch=!1,this._stopCheckNested=!1,this._scrollDirection=As.None,this._touchEvent=null,this.stopScroll(),this._initView(),this._initContent()},i._onAdapterSizeChanged=function(){this._viewWidget.updateAlignment()},i._onViewSizeChanged=function(){this.emit(ou.ON_VIEW_SIZE_CHANGED)},i._isMyEvent=function(t,e){return t.eventPhase==Q.AT_TARGET||!e||e[0]==this.view.node&&!t.target[nu]},i._onTouchStart=function(t){this._velocity=0,this._dragging=!0,this._isMyEventAndMoved=!1,this._isCanceledEvent=!1,this._parentTouch=!1,this._stopCheckNested=!1,this._isEmitAboutToStop=!1,this._scrollDirection=As.None,this._contentStartPosition.set(this.content.node.position),this._touchEvent=t,this.stopScroll(),this._calcNestedDirection(),this.emit(ou.ON_SCROLL_START)},i._onTouchEnd=function(t,e){this._dragging=!1,this._touchEvent=null,this.emit(ou.ON_SCROLL_END,t)},i._onTouchCancel=function(t,e){t.simulate||(this._dragging=!1,this._touchEvent=null,this.emit(ou.ON_SCROLL_CANCEL,t))},i._onTouchMove=function(t,e){if(this._isMyEvent(t,e)){if(this._emitCancelEvent(t),this._parentTouch||!this.canTouch)return this._bubbleToParent(t);if(this._touchEvent){var i=this.adapter.mainAxis,n=t.getUILocation(),o=t.getUIStartLocation(),r=n.subtract(o);if(!r.equals2f(0,0)){var a={x:0,y:0};a[i]=this._contentStartPosition[i]+r[i];var s=a[i]-this.contentPosition,l=this.calcOffset(s),c=this.adapter.isHorizontal?-1:1;a[i]+=c*l,this.movementType==bs.Elastic&&0!=l&&(a[i]-=c*this._rubberDelta(l,this.adapter.mainAxisSize)),this._checkNested(t,a,this._parentAdapter),this._parentTouch?this._bubbleToParent(t):(this._isMyEventAndMoved=!0,this._updateContentPosition(a))}}}},i._calcNestedDirection=function(){this._parentAdapter&&(this.percentage<=this.nestedMinThreshold&&!this.adapter.viewManager.loopHeader?this._nestedDirection=1==this.adapter.multiplier?Os.Footer:Os.Header:this.percentage>=this.nestedMaxThreshold&&!this.adapter.viewManager.loopFooter?this._nestedDirection=1==this.adapter.multiplier?Os.Header:Os.Footer:this._nestedDirection=Os.Both)},i._checkNested=function(t,e,i){if(i&&!this._stopCheckNested){if(this.orientation==i.scrollManager.orientation){var n=e[this.adapter.mainAxis]-this._contentStartPosition[this.adapter.mainAxis];if(Math.abs(n)<=.1)return;this._nestedDirection==Os.Footer?n<0&&(this._parentTouch=!0):this._nestedDirection==Os.Header&&n>0&&(this._parentTouch=!0)}else{var o=0,r=0;if(t instanceof Q){var a=t.getUIStartLocation(),s=t.getUILocation();o=Math.abs(a.x-s.x),r=Math.abs(a.y-s.y)}else o=Math.abs(t.getScrollX()),r=Math.abs(t.getScrollY());if(o==r)return;o>r?this.adapter.isVertical&&(this._parentTouch=!0):r>o&&this.adapter.isHorizontal&&(this._parentTouch=!0)}if(!this._parentTouch&&i.scrollManager.parentAdapter)return this._checkNested(t,e,i.scrollManager.parentAdapter);this._stopCheckNested=!0}},i._updateContentPosition=function(t,e){void 0===e&&(e=!0),this._updateScrollDirection(t),this.content.node.setPosition(t.x,t.y),this.emit(ou.ON_SCROLL,this._scrollDirection),e?this._updatePercentage():this.__drawDebug()},i._updatePrevContentPosition=function(){this._prevContentPosition.set(this.content.node.position)},i._calcPercentage=function(t,e){var i=this.internal_getHiddenSize(),n=this.adapter.viewManager.loopHeader,o=this.adapter.viewManager.loopFooter,r=this.adapter.multiplier,a=this.adapter.viewManager.overflowHeader,s=t*r;if(this.adapter.isHorizontal?s-=e*r:s+=e*r,o)s+=(a+(i+=this.adapter.viewManager.spacing)*r)*r,this.adapter.centerManager.enabled?s+=this.adapter.centerManager.getContainerOffset():s+=this.adapter.paddingHeader,s+=1,s%=i;else if(n){s+=this.adapter.mainAxisSize-1,this.adapter.centerManager.enabled?s-=this.adapter.centerManager.getContainerOffset():s-=this.adapter.paddingFooter,s+=(a+i*r)*r,t*-r>a*r&&(s+=this.adapter.viewManager.spacing),s%=i}else s+=a*r,this.adapter.centerManager.enabled?s+=this.adapter.centerManager.getContainerOffset():s+=this.adapter.paddingHeader,s>i&&(s=i);return s/i},i._updatePercentage=function(){var t=this.calcOffset();this.adapter.viewManager.virtualSize<=this.adapter.mainAxisSize?this._percentage=0:this._percentage=this._calcPercentage(this.contentPosition,t),this.emit(ou.ON_UPDATE_PERCENTAGE,this._percentage,t),this.__drawDebug()},i.internal_disableTouchTarget=function(t){if(this._touchEvent&&this._touchEvent.target==t){var e=this._touchEvent;this._simulateEvent(e,c.EventType.TOUCH_CANCEL,!1),this._simulateEvent(e,c.EventType.MOUSE_LEAVE,!1),this._touchEvent=null}},i.internal_getHiddenSize=function(){var t=this.adapter.viewManager.loopHeader,e=this.adapter.viewManager.loopFooter,i=this.adapter.viewManager.virtualSize;return t||e||this.adapter.centerManager.enabled||(i-=this.adapter.mainAxisSize,i+=this.adapter.mainAxisPadding),i},i._getContentMinBoundaryOffset=function(t,e){return!this.adapter.viewManager.header||!this.adapter.centerManager.enabled&&this.adapter.viewManager.virtualSize<=this.adapter.mainAxisSize?this.adapter.isHorizontal?e+this._defaultMax+t:e+this._defaultMin+t:this.adapter.viewManager.min+t},i._getContentMaxBoundaryOffset=function(t,e){return!this.adapter.viewManager.header||!this.adapter.centerManager.enabled&&this.adapter.viewManager.virtualSize<=this.adapter.mainAxisSize?this.adapter.isHorizontal?e+this._defaultMin+t:e+this._defaultMax+t:this.adapter.viewManager.max+t},i._getMaxBoundaryOffset=function(t){var e=this._viewMax;return this.adapter.isHorizontal?this.adapter.isArrangeAxisStart?t:e+t:this.adapter.isArrangeAxisStart?-t:e-t},i._getMinBoundaryOffset=function(t){var e=this._viewMin;return this.adapter.isHorizontal?this.adapter.isArrangeAxisStart?e+t:t:this.adapter.isArrangeAxisStart?e-t:-t},i._rubberDelta=function(t,e){return(1-1/(.55*Math.abs(t)/e+1))*e*Math.sign(t)},i._calcElastic=function(t,e,i){var n=this.adapter.mainAxis,o=this.elasticity;this._scrolling&&(o*=3);var r=this.adapter.isHorizontal?-1:1,a=zs.smoothDamp(this.contentPosition,this.contentPosition+r*e,this._velocity,o,zs.Infinity,t),s=a.velocity,l=a.position;Math.abs(s)<1&&(s=0),this._velocity=s,i[n]=l},i._calcInertia=function(t,e){this._velocity*=Math.pow(this.decelerationRate,t),Math.abs(this._velocity)<1&&(this._velocity=0),e[this.adapter.mainAxis]+=this._velocity*t},i._calcClamped=function(t){var e=this.adapter.mainAxis,i=t[e]-this.contentPosition,n=this.calcOffset(i);this.adapter.isHorizontal?t[e]-=n:t[e]+=n},i._updateScrollDirection=function(t){var e=t[this.adapter.mainAxis]-this.contentPosition;0!=e?(this.adapter.isHorizontal?this._scrollDirection=e>0?As.Right:As.Left:this._scrollDirection=e>0?As.Up:As.Down,this._laseScrollDirection=this._scrollDirection):this._scrollDirection=As.None},i.internal_setContentPosition=function(t,e){void 0===e&&(e=!0);var i={x:0,y:0};i[this.adapter.mainAxis]=t,this._updateContentPosition(i,e)},i.internal_lateUpdate=function(t){this.test||(this._autoScrolling(t),this._scrollHandler(t,this._scrollHandlePosition,this._scrollPositionHandler.bind(this)),this._scrollHandler(t,this._scrollHandlePercentage,this._scrollPercentageHandler.bind(this)))},i._autoScrolling=function(t){var e=this.calcOffset();if(this._boundaryOffset=e,this._dragging||0==e&&0==this._velocity||(this.content.node.getPosition(iu),this.movementType==bs.Elastic&&0!=e?this._calcElastic(t,e,iu):this.inertia?this._calcInertia(t,iu):this._velocity=0,this.movementType==bs.Clamped&&this._calcClamped(iu),this._updateContentPosition(iu)),this._dragging&&this.inertia){var i=(this.contentPosition-this._prevContentPosition[this.adapter.mainAxis])/t;this._velocity=zs.lerp(this._velocity,i,10*t)}this._prevContentPosition.equals(this.content.node.position)||this._updatePrevContentPosition(),!this._isEmitAboutToStop&&!this._dragging&&Math.abs(this._velocity)<=this.aboutToStopVelocity&&(this._scrollHandlePercentage||this._scrollHandlePosition||(this.emit(ou.ON_ABOUT_TO_STOP,this._velocity),this._isEmitAboutToStop=!0)),this._scrolling=!1},i._scrollHandler=function(t,e,i){if(null!=e){e.deltaTime+=t;var n=e.deltaTime/(e.duration>J.FLT_EPSILON?e.duration:J.FLT_EPSILON);n=zs.clamp01(n);var o=_.quintOut(n);e.current=zs.progress(e.from,e.to,e.current,o),i(e,n)}},i._scrollPercentageHandler=function(t,e){var i=this.percentage;if(this.setPercentage(t.current),1==e||i==this.percentage){var n=!0;this._scrollHandlePercentage.stop&&(n=this._scrollHandlePercentage.stop()),n&&(this._scrollHandlePercentage=null)}},i._scrollPositionHandler=function(t,e){var i={x:0,y:0};i[this.adapter.mainAxis]=t.current,this._setAutoScroll(i),(1==e||Math.abs(this.contentPosition-t.to)<=1e-4)&&(this._scrollHandlePosition.stop&&this._scrollHandlePosition.stop(),this._scrollHandlePosition=null)},i._setAutoScroll=function(t){var e=this,i=function(t){e._updateContentPosition(t),e._updatePrevContentPosition(),e._velocity=0};i(t);var n=this.calcOffset();if(0!=n){var o=this.adapter.isHorizontal?-1:1;return t[this.adapter.mainAxis]+=n*o,i(t),!1}return!0},i._scrollToPosition=function(t,e,i){var n=this;if(!this.canAutoScroll)return!1;var o=e();return!(null==o||Math.abs(this.contentPosition-o)<J.FLT_EPSILON)&&(this._scrollHandlePercentage=null,this._scrollHandlePosition={current:0,from:this.contentPosition,to:o,deltaTime:0,duration:Math.max(0,t),change:function(){o=e(),n._scrollHandlePosition.to=o},stop:function(){i()}},!0)},i.getLayerNode=function(t){switch(t){case ws.Medium:return this._layerMedium;case ws.Highest:return this._layerHighest;default:return this._layerLowest}},i.scrollToModelIndex=function(t,e,i){var n=this,o=this.adapter.viewManager.getGroupIndexByModelIndex(e);if(-1!=o){var r=!1;this._scrollToPosition(t,(function(){var t=n.adapter.centerManager.getPositionByGroupIndex(o,i,r);return r=!0,t}),(function(){n.emit(ou.ON_SCROLL_TO_MODELINDEX_AFTER,e)}))&&this.emit(ou.ON_SCROLL_TO_MODELINDEX_BEFOR,e)}},i.scrollToGroupIndex=function(t,e,i){var n=this,o=!1;this._scrollToPosition(t,(function(){var t=n.adapter.centerManager.getPositionByGroupIndex(e,i,o);return o=!0,t}),(function(){n.emit(ou.ON_SCROLL_TO_GROUPINDEX_AFTER,e)}))&&this.emit(ou.ON_SCROLL_TO_GROUPINDEX_BEFOR,e)},i.scrollToHeader=function(t){this.scrollToGroupIndex(t,0)},i.scrollToFooter=function(t){this.scrollToGroupIndex(t,this.adapter.viewManager.groupLength-1)},i.scrollToPercentage=function(t,e){if(!this.canAutoScroll)return!1;Math.abs(this._percentage-e)<.001||(e=zs.clamp01(e),t=Math.max(0,t),this._scrollHandlePercentage=null,this._scrollHandlePercentage={deltaTime:0,duration:t,current:0,from:this._percentage,to:e})},i.stopVelocity=function(){this._velocity=0},i.setVelocity=function(t){this._velocity=t},i.stopScroll=function(){this._scrollHandlePosition=null,this._scrollHandlePercentage=null,this.stopVelocity()},i.setPercentage=function(t){for(var e=this.internal_getHiddenSize(),i={x:0,y:0},n=0,o=null;n<100;){n++;var r=this._percentage-t;if(null!=o&&this._percentage===o)break;if(Math.abs(r)<J.FLT_EPSILON)break;o=this._percentage;var a=this.contentPosition-r*this.adapter.multiplier*e;if(i[this.adapter.mainAxis]=a,!this._setAutoScroll(i))break}100==n&&console.warn("Số vòng lặp đã đạt đến giá trị tối đa. Cố gắng không sửa đổi kích thước thường xuyên trong quá trình cuộn.")},i.calcOffset=function(t,e){void 0===t&&(t=0),void 0===e&&(e=this.contentPosition);var i=0;if(this.movementType==bs.Unrestricted)return i;var n=this._getContentMaxBoundaryOffset(t,e),o=this._getContentMinBoundaryOffset(t,e),r=this._getMaxBoundaryOffset(n),a=this._getMinBoundaryOffset(o);!this.adapter.centerManager.enabled&&this.adapter.viewManager.virtualSize>this.adapter.mainAxisSize&&(this.adapter.isVertical?(r-=this.adapter.viewManager.top,a+=this.adapter.viewManager.bottom):(r-=this.adapter.viewManager.left,a+=this.adapter.viewManager.right));var s=0,l=0;if(this.adapter.centerManager.enabled&&this.adapter.viewManager.groupLength>0)l=this.adapter.centerManager.max,s=this.adapter.centerManager.min;else{var c=this.adapter.viewManager.getMagneticOffset();r-=c,a-=c}return this.adapter.releaseManager.enabled&&(l=Math.max(l,this.adapter.releaseManager.max),s=Math.max(s,this.adapter.releaseManager.min)),r-=l,(a+=s)<-.001?i=a:r>.001&&(i=r),i},Nt(e,[{key:"view",get:function(){return this._view},set:function(t){this._view=t}},{key:"content",get:function(){return this._content},set:function(t){this._content=t}},{key:"orientation",get:function(){return this._orientation},set:function(t){t!=this._orientation&&(this._orientation=t,this.emit(ou.ON_CHANGED_ORIENTATION))}},{key:"_viewMin",get:function(){return-this.adapter.mainAxisSize}},{key:"_viewMax",get:function(){return this.adapter.mainAxisSize}},{key:"_defaultMin",get:function(){return 1==this.adapter.multiplier?-this.adapter.mainAxisSize:0}},{key:"_defaultMax",get:function(){return 1==this.adapter.multiplier?0:this.adapter.mainAxisSize}},{key:"isMyEventAndMoved",get:function(){return this._isMyEventAndMoved}},{key:"velocity",get:function(){return this._velocity}},{key:"scrollDirection",get:function(){return this._scrollDirection}},{key:"laseScrollDirection",get:function(){return this._laseScrollDirection}},{key:"percentage",get:function(){return this._percentage}},{key:"dragging",get:function(){return this._dragging}},{key:"boundaryOffset",get:function(){return this._boundaryOffset}},{key:"parentAdapter",get:function(){return this._parentAdapter}},{key:"canAutoScroll",get:function(){return!this.dragging&&this.adapter.viewManager.virtualSize>this.adapter.mainAxisSize}},{key:"canTouch",get:function(){return this.touchMode==Cs.AlwaysAllow||this.touchMode!=Cs.Disabled&&(!!this.adapter.centerManager.enabled||(!!this.adapter.releaseManager.enabled||this.adapter.viewManager.virtualSize>this.adapter.mainAxisSize))}},{key:"contentPosition",get:function(){return this.content.node.position[this.adapter.mainAxis]}}]),e}(Us)).Event=ou,Pc=Mt((Ec=zc).prototype,"_view",[uc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Mt(Ec.prototype,"view",[hc],Object.getOwnPropertyDescriptor(Ec.prototype,"view"),Ec.prototype),Ac=Mt(Ec.prototype,"_content",[pc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Mt(Ec.prototype,"content",[dc],Object.getOwnPropertyDescriptor(Ec.prototype,"content"),Ec.prototype),Mc=Mt(Ec.prototype,"_orientation",[fc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return ys.Vertical}}),Mt(Ec.prototype,"orientation",[gc],Object.getOwnPropertyDescriptor(Ec.prototype,"orientation"),Ec.prototype),Oc=Mt(Ec.prototype,"touchMode",[mc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Cs.Auto}}),Ic=Mt(Ec.prototype,"movementType",[vc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return bs.Elastic}}),xc=Mt(Ec.prototype,"elasticity",[yc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.1}}),Rc=Mt(Ec.prototype,"inertia",[eu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Lc=Mt(Ec.prototype,"decelerationRate",[bc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.135}}),Nc=Mt(Ec.prototype,"aboutToStopVelocity",[_c],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 100}}),Fc=Mt(Ec.prototype,"cancelInnerEvents",[Sc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Dc=Mt(Ec.prototype,"nestedMinThreshold",[wc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.001}}),kc=Mt(Ec.prototype,"nestedMaxThreshold",[Tc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.999}}),Cc=Ec))||Cc);t._RF.pop(),t._RF.push({},"e5ff40NmxhKAaD04pv29iQm","CenterManager",void 0);var au,su,lu,cu,uu,hu,pu,du,fu,gu,mu,vu,yu,bu,_u=e.ccclass,Su=e.property,wu=(Gc=_u("CenterManager"),Wc=Su("boolean"),Zc=Su({visible:function(){return this.enabled},tooltip:"自动居中动画的时长"}),Yc=Su({range:[0,1],slide:!0,step:.1,tooltip:"容器(view)的锚点,当滚动停止时,元素锚点位置会和容器锚点位置重合"}),qc=Su({range:[0,1],slide:!0,step:.1,tooltip:"元素(item)的锚点位置,当滚动停止时,元素锚点位置会和容器锚点位置重合"}),Gc((Xc=Mt((Kc=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,It(e,"_enabled",Xc,xt(e)),It(e,"duration",Qc,xt(e)),It(e,"containerAnchorPoint",Jc,xt(e)),It(e,"elementAnchorPoint",$c,xt(e)),e}Ot(e,t);var i=e.prototype;return i.getContainerOffset=function(t){void 0===t&&(t=this.containerAnchorPoint);var e=0;return e=this.adapter.isHorizontal?-1==this.adapter.multiplier?t:1-t:1==this.adapter.multiplier?t:1-t,this.adapter.mainAxisSize*e},i.getElementOffset=function(t){void 0===t&&(t=this.elementAnchorPoint);return this.adapter.isHorizontal?-1==this.adapter.multiplier?t:1-t:1==this.adapter.multiplier?t:1-t},i.onInit=function(){this.adapter.scrollManager.on(ru.Event.ON_ABOUT_TO_STOP,this._onAboutToStop,this),this.adapter.viewManager.on(Uc.Event.ON_UPDATE_VIEWS,this.scrollToCenter,this,!0)},i._onAboutToStop=function(){this.scrollToCenter()},i.scrollToCenter=function(t){if(void 0===t&&(t=this.duration),this.enabled){var e=this.getCenterVisibleIndex();if(-1!=e){var i=this.adapter.viewManager.getVisibleView(e);this.adapter.scrollManager.scrollToGroupIndex(t,i.index)}}},i.getCenterVisibleIndex=function(t,e){void 0===t&&(t=this.containerAnchorPoint),void 0===e&&(e=this.elementAnchorPoint);for(var i=this.adapter.mainAxis,n=this.getContainerOffset(t),o=-1,r=Number.MAX_SAFE_INTEGER,a=0;a<this.adapter.viewManager.visibleLength;a++){var s=this.adapter.viewManager.getVisibleView(a);if(!s||!s.group)break;var l={x:s.group.position.x,y:s.group.position.y};l[i]-=this.adapter.multiplier*s.group.size[i]*e;var c=this.adapter.scrollManager.content.convertToWorldSpaceAR(m(l.x,l.y)),u=this.adapter.scrollManager.view.convertToNodeSpaceAR(c),h=Math.abs(u[i]+this.adapter.multiplier*n);h<r&&(r=h,o=a)}return o},i.getPositionByGroupIndex=function(t,e,i){void 0===e&&(e=Is.Auto),void 0===i&&(i=!1);var n=this.adapter.viewManager.getGroup(t);if(!n)return null;var o=null;if(e==Is.Header&&this.adapter.viewManager.loopHeader)i&&(o=this._checkExists(t)),null==o&&(o=this._alwaysHeader(t,n));else if(e==Is.Footer&&this.adapter.viewManager.loopFooter)i&&(o=this._checkExists(t)),null==o&&(o=this._alwaysFooter(t,n));else if(null==(o=this._checkExists(t))){var r=this.adapter.viewManager.header,a=this.adapter.viewManager.footer;r?t>a.index?o=this._calcTargetFooter(a.group,a.index+1,t,n):t<r.index&&(o=this._calcTargetHeader(r.group,r.index-1,t,n)):o={position:n.position[this.adapter.mainAxis],size:n.size[this.adapter.mainAxis],anchor:n.anchorPoint[this.adapter.mainAxis]}}return this._convertTargetToPosition(o)},i._convertTargetToPosition=function(t){var e=null;if(t){var i=this.adapter.multiplier,n=-1==i?t.anchor:1-t.anchor;e=-t.position,e-=this.getContainerOffset()*i,e-=t.size*n*i,e+=t.size*this.getElementOffset()*i}return e},i._checkExists=function(t){var e=this.adapter.viewManager.getVisibleIndexByGroupIndex(t);if(-1!=e){var i=this.adapter.viewManager.getVisibleView(e);return{position:i.group.position[this.adapter.mainAxis],size:i.group.size[this.adapter.mainAxis],anchor:i.group.anchorPoint[this.adapter.mainAxis]}}return null},i._calcTargetFooter=function(t,e,i,n){for(var o=this.adapter.viewManager.internal_getInitFooterSize(t),r=e;r<=i;r++)o+=this.adapter.viewManager.internal_accumulationSize(r);return{position:this.adapter.viewManager.internal_convertSizeToFooterPosition(o,n),size:n.size[this.adapter.mainAxis],anchor:n.anchorPoint[this.adapter.mainAxis]}},i._calcTargetHeader=function(t,e,i,n){for(var o=this.adapter.viewManager.internal_getInitHeaderSize(t),r=e;r>=i;r--)o+=this.adapter.viewManager.internal_accumulationSize(r);return{position:this.adapter.viewManager.internal_convertSizeToHeaderPosition(o,n),size:n.size[this.adapter.mainAxis],anchor:n.anchorPoint[this.adapter.mainAxis]}},i._alwaysHeader=function(t,e){var i=0,n=t,o=this.adapter.viewManager.header;return o&&(i=this.adapter.viewManager.internal_getInitHeaderSize(o.group),n=o.index),t!=n&&(i=this._calcSizeToHeader(n,t,i)),{position:this.adapter.viewManager.internal_convertSizeToHeaderPosition(i,e),size:e.size[this.adapter.mainAxis],anchor:e.anchorPoint[this.adapter.mainAxis]}},i._alwaysFooter=function(t,e){var i=0,n=t,o=this.adapter.viewManager.footer;return o&&(i=this.adapter.viewManager.internal_getInitFooterSize(o.group),n=o.index),t!=n&&(i=this._calcSizeToFooter(n,t,i)),{position:this.adapter.viewManager.internal_convertSizeToFooterPosition(i,e),size:e.size[this.adapter.mainAxis],anchor:e.anchorPoint[this.adapter.mainAxis]}},i._calcSizeToHeader=function(t,e,i){for(;;){if(--t<0){if(!this.adapter.viewManager.loopHeader)return i;t=this.adapter.viewManager.groupLength-1}if(i+=this.adapter.viewManager.internal_accumulationSize(t),e==t)return i}},i._calcSizeToFooter=function(t,e,i){for(;;){if(++t>=this.adapter.viewManager.groupLength){if(!this.adapter.viewManager.loopFooter)return i;t=0}if(i+=this.adapter.viewManager.internal_accumulationSize(t),t==e)return i}},Nt(e,[{key:"enabled",get:function(){return this._enabled},set:function(t){t!=this._enabled&&(this._enabled=t)}},{key:"max",get:function(){var t=this.getContainerOffset(this.containerAnchorPoint);return this.adapter.isArrangeAxisStart?t:this.adapter.mainAxisSize-t}},{key:"min",get:function(){var t=this.getContainerOffset(this.containerAnchorPoint);return this.adapter.isArrangeAxisStart?this.adapter.mainAxisSize-t:t}}]),e}(Us)).prototype,"_enabled",[Su],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Mt(Kc.prototype,"enabled",[Wc],Object.getOwnPropertyDescriptor(Kc.prototype,"enabled"),Kc.prototype),Qc=Mt(Kc.prototype,"duration",[Zc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),Jc=Mt(Kc.prototype,"containerAnchorPoint",[Yc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),$c=Mt(Kc.prototype,"elementAnchorPoint",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),jc=Kc))||jc);t._RF.pop(),t._RF.push({},"e3a2d9kCydCzZKVh5E8qZ8J","PageViewManager",void 0);var Tu,Cu,Eu,Pu,Au,Mu,Ou,Iu,xu,Ru,Lu,Nu,Fu,Du,ku=e.ccclass,zu=e.property,Vu=function(t){return t[t.ON_PAGE_LENGTH_CHANGED=0]="ON_PAGE_LENGTH_CHANGED",t[t.ON_SCROLL_PAGE_BEFOR=1]="ON_SCROLL_PAGE_BEFOR",t[t.ON_SCROLL_PAGE_END=2]="ON_SCROLL_PAGE_END",t}(Vu||{}),Bu=(au=ku("PageViewManager"),su=zu("boolean"),lu=zu({range:[0,1],slide:!0,step:.01,visible:function(){return this.enabled},tooltip:"滚动临界值，默认单位百分比，当拖拽超出该数值时，松开会自动滚动下一页，小于时则还原"}),cu=zu({range:[0,1],slide:!0,step:.01,visible:function(){return this.enabled},tooltip:"设置 PageView PageTurning 事件的发送时机"}),uu=zu({visible:function(){return this.enabled},tooltip:"快速滑动翻页临界值\n        当用户快速滑动时，会根据滑动开始和结束的距离与时间计算出一个速度值\n        该值与此临界值相比较，如果大于临界值，则进行自动翻页"}),hu=zu({visible:function(){return this.enabled},tooltip:"每个页面翻页时所需时间。单位：秒"}),au(((bu=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,It(e,"_enabled",fu,xt(e)),It(e,"scrollThreshold",gu,xt(e)),It(e,"pageTurningEventTiming",mu,xt(e)),It(e,"autoPageTurningThreshold",vu,xt(e)),It(e,"pageTurningSpeed",yu,xt(e)),e._currentIndex=0,e}Ot(e,t);var i=e.prototype;return i.onInit=function(){this._register()},i._register=function(){this.adapter&&this.enabled&&(this.adapter.scrollManager.on(ru.Event.ON_SCROLL_END,this._handleReleaseLogic,this),this.adapter.scrollManager.on(ru.Event.ON_SCROLL_CANCEL,this._handleReleaseLogic,this),this.adapter.scrollManager.on(ru.Event.ON_SCROLL_TO_GROUPINDEX_BEFOR,this._onScrollToIndex,this),this.adapter.viewManager.on(Uc.Event.ON_UPDATE_VIEWS,this._onUpdateViews,this,!0))},i._unregister=function(){this.adapter&&!this.enabled&&(this.adapter.scrollManager.off(ru.Event.ON_SCROLL_END,this._handleReleaseLogic,this),this.adapter.scrollManager.off(ru.Event.ON_SCROLL_CANCEL,this._handleReleaseLogic,this),this.adapter.scrollManager.off(ru.Event.ON_SCROLL_TO_GROUPINDEX_BEFOR,this._onScrollToIndex,this),this.adapter.viewManager.off(Uc.Event.ON_UPDATE_VIEWS,this._onUpdateViews,this))},i.scrollToPage=function(t,e,i){e<0||e>=this.length||e==this.currentIndex&&0!=this.adapter.scrollManager.calcOffset()||(this.adapter.scrollManager.scrollToGroupIndex(t,e,i),this.emit(Vu.ON_SCROLL_PAGE_BEFOR,e))},i.scrollToPrevPage=function(t,e){void 0===t&&(t=this.pageTurningSpeed),void 0===e&&(e=Is.Header),0!=this._currentIndex?this.scrollToPage(t,this._currentIndex-1,e):this.adapter.viewManager.loopHeader&&this.scrollToPage(t,this.length-1,e)},i.scrollToNextPage=function(t,e){void 0===t&&(t=this.pageTurningSpeed),void 0===e&&(e=Is.Footer),this._currentIndex>=this.length-1?this.adapter.viewManager.loopFooter&&this.scrollToPage(t,0,e):this.scrollToPage(t,this._currentIndex+1,e)},i._onUpdateViews=function(){this.emit(Vu.ON_PAGE_LENGTH_CHANGED),this._currentIndex=0,this.scrollToPage(this.pageTurningSpeed,this._currentIndex)},i._onScrollToIndex=function(t){this._currentIndex=t,this.emit(Vu.ON_SCROLL_PAGE_END,t)},i._handleReleaseLogic=function(t){if(this._enabled&&this.adapter.scrollManager.isMyEventAndMoved){var e=t.getUIStartLocation()[this.adapter.mainAxis]-t.getUILocation()[this.adapter.mainAxis],i=this._getNextIndex(e);this._isScrollable(e)||this._isQuicklyScrollable(this.adapter.scrollManager.velocity)?this.scrollToPage(this.pageTurningSpeed,i):this.scrollToPage(this.pageTurningSpeed,this._currentIndex)}},i._getNextIndex=function(t){var e=this._currentIndex;return this.adapter.isHorizontal?this.adapter.isArrangeAxisStart?t>0?e++:t<0&&e--:(t<0&&e++,t>0&&e--):this.adapter.isArrangeAxisStart?t<0?e++:t>0&&e--:t>0?e++:t<0&&e--,e>=this.length&&this.adapter.viewManager.loopFooter?e=0:e<0&&this.adapter.viewManager.loopHeader&&(e=this.length-1),(e<0||e>=this.length)&&(e=this._currentIndex),e},i._isScrollable=function(t){return Math.abs(t)>=this.adapter.mainAxisSize*this.scrollThreshold},i._isQuicklyScrollable=function(t){return Math.abs(t)>this.autoPageTurningThreshold},Nt(e,[{key:"enabled",get:function(){return this._enabled},set:function(t){t!=this._enabled&&(this._enabled=t,this._enabled?this._register():this._unregister())}},{key:"currentIndex",get:function(){return this._currentIndex}},{key:"length",get:function(){return this.adapter.viewManager.groupLength}}]),e}(Us)).Event=Vu,fu=Mt((du=bu).prototype,"_enabled",[zu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Mt(du.prototype,"enabled",[su],Object.getOwnPropertyDescriptor(du.prototype,"enabled"),du.prototype),gu=Mt(du.prototype,"scrollThreshold",[lu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),mu=Mt(du.prototype,"pageTurningEventTiming",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.1}}),vu=Mt(du.prototype,"autoPageTurningThreshold",[uu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 100}}),yu=Mt(du.prototype,"pageTurningSpeed",[hu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.3}}),pu=du))||pu);t._RF.pop(),t._RF.push({},"797a5chXbhC64OnuHlVCMHV","ReleaseManager",void 0);var Hu,Uu,Gu,Wu,Zu,Yu,qu,ju,Ku,Xu,Qu,Ju,$u,th,eh,ih=e.ccclass,nh=e.property,oh=function(t){return t[t.ON_PULL_UP=0]="ON_PULL_UP",t[t.ON_PULL_DOWN=1]="ON_PULL_DOWN",t[t.ON_PULL_LEFT=2]="ON_PULL_LEFT",t[t.ON_PULL_RIGHT=3]="ON_PULL_RIGHT",t}(oh||{}),rh=(Tu=ih("ReleaseManager"),Cu=nh("boolean"),Eu=nh({range:[0,1],slide:!0,step:.01,visible:function(){return this.enabled},tooltip:"根据此阈值来切换state状态"}),Pu=nh({range:[0,1],slide:!0,step:.01,visible:function(){return this.enabled},tooltip:"根据此阈值来切换state状态"}),Au=nh({range:[0,1],slide:!0,step:.01,visible:function(){return this.enabled},tooltip:"根据此阈值来切换state状态"}),Mu=nh({range:[0,1],slide:!0,step:.01,visible:function(){return this.enabled},tooltip:"根据此阈值来切换state状态"}),Tu(((Du=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,It(e,"_enabled",xu,xt(e)),It(e,"left",Ru,xt(e)),It(e,"right",Lu,xt(e)),It(e,"top",Nu,xt(e)),It(e,"bottom",Fu,xt(e)),e._pullUp=void 0,e._pullDown=void 0,e._pullLeft=void 0,e._pullRight=void 0,e}Ot(e,t);var i=e.prototype;return i.onInit=function(){this.enabled&&(this._pullUp=new ah(this,oh.ON_PULL_UP,this.bottom),this._pullDown=new ah(this,oh.ON_PULL_DOWN,this.top),this._pullLeft=new ah(this,oh.ON_PULL_LEFT,this.right),this._pullRight=new ah(this,oh.ON_PULL_RIGHT,this.left),this.adapter.scrollManager.on(ru.Event.ON_SCROLL_START,this.onScrollStart,this),this.adapter.scrollManager.on(ru.Event.ON_SCROLL_END,this.onScrollEnd,this),this.adapter.scrollManager.on(ru.Event.ON_SCROLL_CANCEL,this.onScrollEnd,this),this.checkLoop())},i.checkLoop=function(){this.adapter.isHorizontal?this.adapter.isArrangeAxisStart?(this.left>0&&(this.adapter.viewManager.loopHeader=!1),this.right>0&&(this.adapter.viewManager.loopFooter=!1)):(this.left>0&&(this.adapter.viewManager.loopFooter=!1),this.right>0&&(this.adapter.viewManager.loopHeader=!1)):this.adapter.isArrangeAxisStart?(this.top>0&&(this.adapter.viewManager.loopHeader=!1),this.bottom>0&&(this.adapter.viewManager.loopFooter=!1)):(this.top>0&&(this.adapter.viewManager.loopFooter=!1),this.bottom>0&&(this.adapter.viewManager.loopHeader=!1))},i.onScrollStart=function(){this.adapter.isHorizontal?(this.left>0&&this._pullRight._setState(Ls.IDLE),this.right>0&&this._pullLeft._setState(Ls.IDLE)):(this.top>0&&this._pullDown._setState(Ls.IDLE),this.bottom>0&&this._pullUp._setState(Ls.IDLE))},i.onScrollEnd=function(){this.adapter.isHorizontal?(this.left>0&&this._pullRight._setState(Ls.RELEASE),this.right>0&&this._pullLeft._setState(Ls.RELEASE)):(this.top>0&&this._pullDown._setState(Ls.RELEASE),this.bottom>0&&this._pullUp._setState(Ls.RELEASE))},i.internal_lateUpdate=function(t){if(this.enabled){var e=this.adapter.scrollManager.boundaryOffset;this.adapter.scrollManager.dragging||(e=0),this.adapter.isHorizontal?(this.left>0&&this._pullRight._set(Math.max(-e,0),e<0),this.right>0&&this._pullLeft._set(Math.max(e,0),e>0)):(this.top>0&&this._pullDown._set(Math.max(e,0),e>0),this.bottom>0&&this._pullUp._set(Math.max(-e,0),e<0))}},Nt(e,[{key:"enabled",get:function(){return this._enabled},set:function(t){t!=this._enabled&&(this._enabled=t)}},{key:"max",get:function(){return this.enabled?this.adapter.isHorizontal?this._pullLeft?this._pullLeft.expand:0:this._pullDown?this._pullDown.expand:0:0}},{key:"min",get:function(){return this.enabled?this.adapter.isHorizontal?this._pullRight?this._pullRight.expand:0:this._pullUp?this._pullUp.expand:0:0}}]),e}(Us)).Event=oh,xu=Mt((Iu=Du).prototype,"_enabled",[nh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Mt(Iu.prototype,"enabled",[Cu],Object.getOwnPropertyDescriptor(Iu.prototype,"enabled"),Iu.prototype),Ru=Mt(Iu.prototype,"left",[Eu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Lu=Mt(Iu.prototype,"right",[Pu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Nu=Mt(Iu.prototype,"top",[Au],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Fu=Mt(Iu.prototype,"bottom",[Mu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Ou=Iu))||Ou),ah=function(){function t(t,e,i){this._expand=0,this._progress=0,this._offset=0,this._state=void 0,this._defaultPercentage=void 0,this._manager=void 0,this._event=void 0,this._stop=void 0,this._defaultPercentage=i,this._manager=t,this._event=e}var e=t.prototype;return e._set=function(t,e){e&&(this._stop=!1),this._stop||(this._offset=t,this._progress=t/(this._defaultPercentage*this._manager.adapter.mainAxisSize),this._stop=this._offset<=.1,this._setState(Ls.PULL),this._manager.emit(this._event,this))},e._setState=function(t){this._state!=Ls.WAIT&&(t==Ls.PULL&&this._state==Ls.RELEASE||(this._state=t))},e.wait=function(t){void 0===t&&(t=this._defaultPercentage*this._manager.adapter.mainAxisSize),this._expand=t,this._state=Ls.WAIT},e.release=function(){this._expand=0,this._state=Ls.IDLE,this.offset<=.1&&(this._offset=0,this._progress=0,this._manager.emit(this._event,this))},Nt(t,[{key:"expand",get:function(){return this._expand}},{key:"progress",get:function(){return this._progress}},{key:"offset",get:function(){return this._offset}},{key:"state",get:function(){return this._state}}]),t}();t._RF.pop(),t._RF.push({},"4f9c5h5sDhP/78kLerCTNfA","ScrollAdapter",void 0);var sh,lh,ch,uh,hh,ph,dh,fh,gh,mh,vh,yh=e.ccclass,bh=e.property,_h=(Hu=yh("ScrollAdapter"),Uu=bh(ru),Gu=bh(Uc),Wu=bh(Cl),Zu=bh(Bu),Yu=bh(rh),qu=bh(wu),Hu((Xu=Mt((Ku=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,It(e,"scrollManager",Xu,xt(e)),It(e,"viewManager",Qu,xt(e)),It(e,"layoutManager",Ju,xt(e)),It(e,"pageViewManager",$u,xt(e)),It(e,"releaseManager",th,xt(e)),It(e,"centerManager",eh,xt(e)),e.modelManager=new Ys,e}Ot(e,t);var i=e.prototype;return i.initElement=function(t,e){},i.getView=function(){return new Sh(this)},i.getHolder=function(t,e){return new wh(t,e,this)},i.getParentAdapter=function(t){if(null!=t){var e=t.getComponent("ScrollAdapter");return e||this.getParentAdapter(t.parent)}},i.__preload=function(){this.scrollManager.internal_create(this),this.viewManager.internal_create(this),this.modelManager.internal_create(this),this.releaseManager.internal_create(this),this.layoutManager.internal_create(this),this.pageViewManager.internal_create(this),this.centerManager.internal_create(this),this.viewManager.internal_init(),this.releaseManager.internal_init(),this.layoutManager.internal_init(),this.pageViewManager.internal_init(),this.centerManager.internal_init(),this.scrollManager.internal_init(),this.modelManager.internal_init()},i.lateUpdate=function(t){this.scrollManager.internal_lateUpdate(t),this.viewManager.internal_lateUpdate(t),this.layoutManager.internal_lateUpdate(t),this.releaseManager.internal_lateUpdate(t)},Nt(e,[{key:"isVertical",get:function(){return this.scrollManager.orientation==ys.Vertical}},{key:"isHorizontal",get:function(){return this.scrollManager.orientation==ys.Horizontal}},{key:"isArrangeAxisStart",get:function(){return this.viewManager.arrangeAxis==_s.Start}},{key:"mainAxis",get:function(){return this.isVertical?"y":"x"}},{key:"crossAxis",get:function(){return this.isVertical?"x":"y"}},{key:"mainAxisAnchorPoint",get:function(){var t=this.isVertical?1:0;return this.isArrangeAxisStart?t:1-t}},{key:"mainAxisSize",get:function(){return this.scrollManager.view.contentSize[this.mainAxis]}},{key:"crossAxisSize",get:function(){return this.scrollManager.view.contentSize[this.crossAxis]}},{key:"multiplier",get:function(){var t=this.isVertical?-1:1;return this.isArrangeAxisStart?-t:t}},{key:"paddingHeader",get:function(){return this.isHorizontal?this.isArrangeAxisStart?this.viewManager.left:this.viewManager.right:this.isArrangeAxisStart?this.viewManager.top:this.viewManager.bottom}},{key:"paddingFooter",get:function(){return this.isHorizontal?this.isArrangeAxisStart?this.viewManager.right:this.viewManager.left:this.isArrangeAxisStart?this.viewManager.bottom:this.viewManager.top}},{key:"mainAxisPadding",get:function(){return this.isHorizontal?this.viewManager.left+this.viewManager.right:this.viewManager.top+this.viewManager.bottom}}]),e}(r)).prototype,"scrollManager",[Uu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new ru}}),Qu=Mt(Ku.prototype,"viewManager",[Gu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Uc}}),Ju=Mt(Ku.prototype,"layoutManager",[Wu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Cl}}),$u=Mt(Ku.prototype,"pageViewManager",[Zu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Bu}}),th=Mt(Ku.prototype,"releaseManager",[Yu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new rh}}),eh=Mt(Ku.prototype,"centerManager",[qu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new wu}}),ju=Ku))||ju),Sh=function(t){function e(){return t.apply(this,arguments)||this}Ot(e,t);var i=e.prototype;return i.onVisible=function(){this.adapter.node.emit(Fs.VISIBLE,this)},i.onDisable=function(){this.adapter.node.emit(Fs.DISABLE,this)},e}(sc),wh=function(t){function e(){return t.apply(this,arguments)||this}Ot(e,t);var i=e.prototype;return i.onCreated=function(){this.node.emit(Ns.CREATED,this)},i.onVisible=function(){this.node.emit(Ns.VISIBLE,this)},i.onDisable=function(){this.node.emit(Ns.DISABLE,this)},e}(js);t._RF.pop(),t._RF.push({},"518d6bEinVOEZVOae09QC8Z","Indicator",void 0);var Th,Ch,Eh,Ph,Ah,Mh,Oh,Ih,xh,Rh,Lh,Nh,Fh,Dh,kh,zh,Vh,Bh,Hh,Uh,Gh,Wh,Zh,Yh,qh,jh,Kh,Xh,Qh,Jh,$h,tp,ep,ip,np,op,rp,ap,sp,lp,cp=e.ccclass,up=e.property;sh=cp("Indicator"),lh=up(_h),ch=up({type:i}),uh=up({type:xs}),sh((dh=Mt((ph=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,It(e,"adapter",dh,xt(e)),It(e,"spriteFrame",fh,xt(e)),It(e,"indicatorMode",gh,xt(e)),It(e,"cellSize",mh,xt(e)),It(e,"spacing",vh,xt(e)),e._indicators=[],e._layout=null,e._color=new X,e}Ot(e,t);var i=e.prototype;return i.__preload=function(){this.adapter&&(this.adapter.pageViewManager.on(Bu.Event.ON_PAGE_LENGTH_CHANGED,this._onPageLengthChanged,this),this.adapter.pageViewManager.on(Bu.Event.ON_SCROLL_PAGE_END,this._onScrollPageEnd,this))},i._onScrollPageEnd=function(){this.changedState()},i._onPageLengthChanged=function(){if(this.adapter){var t=this._indicators,e=this.adapter.viewManager.groupLength;if(e!==t.length){var i=0;if(e>t.length)for(i=0;i<e;++i)t[i]||(t[i]=this._createIndicator(i));else for(i=t.length-e;i>0;--i){var n=t[i-1];this.node.removeChild(n.node),t.splice(i-1,1)}this.layout&&this.layout.enabledInHierarchy&&this.layout.updateLayout(),this.changedState()}}},i._createIndicator=function(t){var e=new c;e.layer=this.node.layer;var i=e.addComponent(f);i.spriteFrame=this.spriteFrame,i.sizeMode=f.SizeMode.CUSTOM,e.parent=this.node;var n=e.getComponent(B);if(n.setContentSize(this.cellSize),this.indicatorMode==xs.Button){var o=e.getComponent(N)||e.addComponent(N),r=new F;r.component="Indicator",r.handler="_click",r.target=this.node,r.customEventData=t,o.clickEvents.push(r)}return n},i._click=function(t,e){this.adapter.pageViewManager.scrollToPage(this.adapter.pageViewManager.pageTurningSpeed,e)},i.changedState=function(){var t=this._indicators;if(0!==t.length&&this.adapter){var e=this.adapter.pageViewManager.currentIndex;if(!(e>=t.length)){for(var i=0;i<t.length;++i){var n=t[i].getComponent(f);this._color.set(n.color),this._color.a=127.5,n.color=this._color}if(t[e]){var o=t[e].getComponent(f);this._color.set(o.color),this._color.a=255,o.color=this._color}}}},Nt(e,[{key:"layout",get:function(){return null==this._layout&&(this._layout=this.getComponent($)||this.addComponent($),this.adapter.isHorizontal?(this._layout.type=$.Type.HORIZONTAL,this._layout.spacingX=this.spacing):(this._layout.type=$.Type.VERTICAL,this._layout.spacingY=this.spacing),this._layout.resizeMode=$.ResizeMode.CONTAINER),this._layout}}]),e}(r)).prototype,"adapter",[lh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),fh=Mt(ph.prototype,"spriteFrame",[ch],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),gh=Mt(ph.prototype,"indicatorMode",[uh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return xs.Normal}}),mh=Mt(ph.prototype,"cellSize",[up],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new tt(10,10)}}),vh=Mt(ph.prototype,"spacing",[up],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 10}}),hh=ph));t._RF.pop(),t._RF.push({},"67fa5ko0UJAJpbCzgGfagdw","Scrollbar",void 0);var hp,pp,dp=e.ccclass,fp=e.property,gp=new X;Th=dp("Scrollbar"),Ch=fp(_h),Eh=fp(f),Ph=fp({type:Ms,tooltip:"滚动方向"}),Ah=fp({tooltip:"开启后会允许用户滑动进度条"}),Mh=fp({range:[0,1],slide:!0,step:.001,visible:function(){return this.interactable},tooltip:"可拖拽的最小限制，默认=0不限制,仅当你开启了循环,并且你的item会实时修改主轴尺寸时,那么你应该适当限制拖拽区域"}),Oh=fp({range:[0,1],slide:!0,step:.001,visible:function(){return this.interactable},tooltip:"可拖拽的最大限制，默认=1不限制,仅当你开启了循环,并且你的item会实时修改主轴尺寸时,那么你应该适当限制拖拽区域"}),Ih=fp({type:Rs}),xh=fp({type:Rs,visible:function(){return this.interactable}}),Rh=fp({type:f,visible:function(){return this.transition!=Rs.None&&this.interactable}}),Lh=fp({type:i,visible:function(){return this.transition==Rs.SpriteSwap&&this.interactable}}),Nh=fp({type:i,visible:function(){return this.transition==Rs.SpriteSwap&&this.interactable}}),Fh=fp({visible:function(){return this.transition==Rs.ColorTint&&this.interactable}}),Dh=fp({visible:function(){return this.transition==Rs.ColorTint&&this.interactable}}),kh=fp({visible:function(){return this.transition==Rs.Scale&&this.interactable}}),zh=fp({visible:function(){return this.transition==Rs.Scale&&this.interactable}}),Vh=fp({visible:function(){return this.transition==Rs.Scale||this.transition==Rs.ColorTint&&this.interactable}}),Bh=fp({range:[0,11],slide:!0,step:1,tooltip:"用于进度的步数。值为 < 2 将禁用"}),Hh=fp({tooltip:"开启后会在滚动条无更新时自动隐藏"}),Uh=fp({visible:function(){return this.enableAutoHide},tooltip:"自动隐藏滚动条的时间"}),Th((Zh=Mt((Wh=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,It(e,"adapter",Zh,xt(e)),It(e,"handle",Yh,xt(e)),It(e,"direction",qh,xt(e)),It(e,"interactable",jh,xt(e)),It(e,"dragMinLimit",Kh,xt(e)),It(e,"dragMaxLimit",Xh,xt(e)),It(e,"_transition",Qh,xt(e)),It(e,"targetGraphic",Jh,xt(e)),It(e,"hoverSprite",$h,xt(e)),It(e,"pressedSprite",tp,xt(e)),It(e,"hoverColor",ep,xt(e)),It(e,"pressedColor",ip,xt(e)),It(e,"hoverScale",np,xt(e)),It(e,"pressedScale",op,xt(e)),It(e,"transitionDuration",rp,xt(e)),It(e,"numberOfSteps",ap,xt(e)),It(e,"enableAutoHide",sp,xt(e)),It(e,"autoHideTime",lp,xt(e)),e._transitionInfo=void 0,e._targetEnter=void 0,e._targetStart=void 0,e._isDirty=!1,e._transform=void 0,e._handleTransform=void 0,e._size=0,e._value=-1,e._pointerEvent=void 0,e._offset=void 0,e._isHide=void 0,e._opacity=255,e._autoHideRemainingTime=void 0,e._rawTargetScale=void 0,e._rawTargetFrame=void 0,e._rawTargetColor=void 0,e}Ot(e,t);var i=e.prototype;return i.__preload=function(){this.transform.setAnchorPoint(.5,.5),this.handleTransform.setAnchorPoint(.5,.5),this.handle.node.setPosition(0,0),this.adapter&&(this.adapter.scrollManager.on(ru.Event.ON_UPDATE_PERCENTAGE,this._onUpdateScrollbar,this),this._updateVisuals()),this.targetGraphic&&(this._rawTargetScale=this.targetGraphic.node.getScale().clone(),this._rawTargetFrame=this.targetGraphic.spriteFrame,this._rawTargetColor=this.targetGraphic.color.clone()),this._openAutoHide(!0)},i.onEnable=function(){var t=this.node.getComponent(f);t&&(this._opacity=t.color.a),this.adapter&&(this.node[nu]=!0,this.node.on(c.EventType.TOUCH_START,this._onTouchStart,this),this.node.on(c.EventType.TOUCH_MOVE,this._onTouchMove,this),this.node.on(c.EventType.TOUCH_END,this._onTouchEnd,this),this.node.on(c.EventType.TOUCH_CANCEL,this._onTouchEnd,this),this.node.on(c.EventType.MOUSE_ENTER,this._mouseEnter,this),this.node.on(c.EventType.MOUSE_LEAVE,this._mouseLeave,this),this.targetGraphic&&(this.targetGraphic.node.on(c.EventType.MOUSE_ENTER,this._targetMouseEnter,this),this.targetGraphic.node.on(c.EventType.MOUSE_LEAVE,this._targetMouseLeave,this)))},i.onDisable=function(){this.node.off(c.EventType.TOUCH_START,this._onTouchStart,this),this.node.off(c.EventType.TOUCH_MOVE,this._onTouchMove,this),this.node.off(c.EventType.TOUCH_END,this._onTouchEnd,this),this.node.off(c.EventType.TOUCH_CANCEL,this._onTouchEnd,this),this.node.off(c.EventType.MOUSE_ENTER,this._mouseEnter,this),this.node.off(c.EventType.MOUSE_LEAVE,this._mouseLeave,this),this.targetGraphic&&(this.targetGraphic.node.off(c.EventType.MOUSE_ENTER,this._targetMouseEnter,this),this.targetGraphic.node.off(c.EventType.MOUSE_LEAVE,this._targetMouseLeave,this))},i._targetMouseEnter=function(){switch(this._targetEnter=!0,this._openAutoHide(!1),this.transition){case Rs.Scale:this._transitionScale(this._targetStart?this.pressedScale:this.hoverScale);break;case Rs.SpriteSwap:this._transitionSprite(this._targetStart?this.pressedSprite:this.hoverSprite);break;case Rs.ColorTint:this._transitionColor(this._targetStart?this.pressedColor:this.hoverColor)}},i._targetMouseLeave=function(){switch(this._targetEnter=!1,this._openAutoHide(!0),this.transition){case Rs.Scale:this._transitionScale(this._targetStart?this.pressedScale:this._rawTargetScale);break;case Rs.SpriteSwap:this._transitionSprite(this._targetStart?this.pressedSprite:this._rawTargetFrame);break;case Rs.ColorTint:this._transitionColor(this._targetStart?this.pressedColor:this._rawTargetColor)}},i._transitionScale=function(t){t&&this.targetGraphic&&(this._transitionInfo={time:0,from:this.targetGraphic.node.getScale().clone(),to:t})},i._transitionColor=function(t){t&&this.targetGraphic&&(this._transitionInfo={time:0,from:this.targetGraphic.color,to:t})},i._transitionSprite=function(t){t&&this.targetGraphic&&(this.targetGraphic.spriteFrame=t)},i._mouseEnter=function(t){this.interactable&&this._openAutoHide(!1)},i._mouseLeave=function(t){this.interactable&&this._openAutoHide(!0)},i._openAutoHide=function(t){this.enableAutoHide&&(this._autoHideRemainingTime=this.autoHideTime,this._isHide=t,t||this._setOpacity(this._opacity))},i._onTouchStart=function(t){if(this.interactable&&1!=this.size&&0!=this.size){this._openAutoHide(!1),this._pointerEvent=null,this._targetStart=!0;var e=t.getUIStartLocation();if(this._offset=this.handleTransform.convertToNodeSpaceAR(m(e.x,e.y)),Math.abs(this._offset[this.xy])>.5*this.handleTransform[this.wh]){this._offset=null,this._pointerEvent=t;var i=this._calcPercentage(t);this._setPercentage(i)}this.transition==Rs.Scale?this._transitionScale(this.pressedScale):this.transition==Rs.SpriteSwap?this._transitionSprite(this.pressedSprite):this.transition==Rs.ColorTint&&this._transitionColor(this.pressedColor)}},i._onTouchMove=function(t){if(this.interactable&&1!=this.size&&0!=this.size&&this._offset){var e=this._calcPercentage(t,this._offset[this.xy]);this._setPercentage(e)}},i._onTouchEnd=function(t){if(this.interactable&&1!=this.size&&0!=this.size){switch(this._offset=null,this._pointerEvent=null,this._targetStart=!1,this.transition){case Rs.Scale:this._transitionScale(this._targetEnter?this.hoverScale:this._rawTargetScale);break;case Rs.SpriteSwap:this._transitionSprite(this._targetEnter?this.hoverSprite:this._rawTargetFrame);break;case Rs.ColorTint:this._transitionColor(this._targetEnter?this.hoverColor:this._rawTargetColor)}this.adapter.centerManager.scrollToCenter()}},i._setPercentage=function(t){this.adapter.scrollManager.stopScroll(),this.adapter.scrollManager.setPercentage(t)},i._calcPercentage=function(t,e){void 0===e&&(e=0);var i=(this.axis==ys.Horizontal?this.transform.width:this.transform.height)*(1-this.size),n=t.getUILocation(),o=this.transform.convertToNodeSpaceAR(m(n.x,n.y))[this.xy]-e-.5*-this.transform[this.wh];o-=.5*this.handleTransform[this.wh];var r=this.adapter.scrollManager.percentage;switch(this.direction){case Ms.Right_To_Left:case Ms.Top_To_Bottom:r=zs.clamp(1-o/i,this.dragMinLimit,this.dragMaxLimit);break;case Ms.Left_To_Right:case Ms.Bottom_To_Top:r=zs.clamp(o/i,this.dragMinLimit,this.dragMaxLimit)}return this.getSteps(r)},i._onUpdateScrollbar=function(t,e){var i=0,n=0;this.adapter.viewManager.virtualSize>0&&(i=this.adapter.viewManager.virtualSize>=this.adapter.mainAxisSize?zs.clamp01((this.adapter.mainAxisSize-Math.abs(e))/this.adapter.viewManager.virtualSize):1),n=t,this.size=i,this.numberOfSteps>1&&(n=Math.round(n*(this.numberOfSteps-1))/(this.numberOfSteps-1),n=zs.clamp01(n)),this.value=n,this._autoHideRemainingTime=this.autoHideTime,this._setOpacity(this._opacity)},i._updateVisuals=function(){if(this.handleTransform&&this.adapter){var t={x:0,y:0},e={x:0,y:0},i=this.adapter.mainAxis,n=zs.clamp01(this.value)*(1-this.size);t[i]=n,e[i]=n+this.size;var o=this.transform.contentSize[this.wh]-e[i]*this.transform.contentSize[this.wh],r=t[i]*this.transform.contentSize[this.wh],a=this.handle.node.getPosition();switch(this.direction){case Ms.Bottom_To_Top:case Ms.Left_To_Right:a[this.xy]=.5*(r-o);break;case Ms.Top_To_Bottom:case Ms.Right_To_Left:a[this.xy]=.5*(o-r)}this.handleTransform[this.wh]=this.transform.contentSize[this.wh]-o-r,this.handle.node.setPosition(a)}},i.update=function(t){this._clearDirty(),this._autoHide(t),this._tranitionHandler(t)},i._clearDirty=function(){if(this._isDirty&&(this._isDirty=!1,this._updateVisuals(),this._pointerEvent)){var t=this._pointerEvent.getUILocation();this._offset=this.handleTransform.convertToNodeSpaceAR(m(t.x,t.y)),this._pointerEvent=null}},i._autoHide=function(t){if(this.enableAutoHide&&this._isHide&&!(this._autoHideRemainingTime<=0)&&(this._autoHideRemainingTime-=t,this._autoHideRemainingTime<=this.autoHideTime)){this._autoHideRemainingTime=Math.max(0,this._autoHideRemainingTime);var e=this._opacity*(this._autoHideRemainingTime/this.autoHideTime);this._setOpacity(e)}},i._tranitionHandler=function(t){var e=this.targetGraphic;if(this.transition!=Rs.None&&e&&this._transitionInfo){this._transitionInfo.time+=t;var i=1;if(this.transitionDuration>0&&(i=this._transitionInfo.time/this.transitionDuration),i>=1&&(i=1),this.transition==Rs.Scale){this._transitionInfo.current=e.node.getScale();var n=this._transitionInfo.from,o=this._transitionInfo.to;this._transitionInfo.current.x=zs.lerp(n.x,o.x,i),this._transitionInfo.current.y=zs.lerp(n.y,o.y,i),e.node.setScale(this._transitionInfo.current)}else if(this.transition==Rs.ColorTint){var r=this._transitionInfo.from,a=this._transitionInfo.to;X.lerp(gp,r,a,i),e.color=gp}1===i&&(this._transitionInfo=null)}},i._setOpacity=function(t){if(this.handle){var e=function(e){e&&(gp.set(e.color),gp.a=t,e.color=gp)};e(this.node.getComponent(f)),e(this.handle.getComponent(f))}},i.getSteps=function(t){return this.numberOfSteps>1&&(t=Math.round(t*(this.numberOfSteps-1))/(this.numberOfSteps-1),t=zs.clamp(t,this.dragMinLimit,this.dragMaxLimit)),t},Nt(e,[{key:"transition",get:function(){return this._transition},set:function(t){t!=this._transition&&(this._transition=t,t!=Rs.None&&(this.targetGraphic||(this.targetGraphic=this.handle)))}},{key:"size",get:function(){return this._size},set:function(t){t!=this._size&&(this._size=zs.clamp(t,.01,1),this._isDirty=!0)}},{key:"value",get:function(){return this._value},set:function(t){t!=this._value&&(this._value=this.getSteps(t),this._isDirty=!0)}},{key:"stepSize",get:function(){return this.numberOfSteps>1?1/(this.numberOfSteps-1):.1}},{key:"transform",get:function(){return this._transform||(this._transform=this.node.getComponent(B)),this._transform}},{key:"handleTransform",get:function(){return this.handle?(this._handleTransform||(this._handleTransform=this.handle.node.getComponent(B)),this._handleTransform):null}},{key:"xy",get:function(){return this.axis==ys.Horizontal?"x":"y"}},{key:"wh",get:function(){return this.axis==ys.Horizontal?"width":"height"}},{key:"axis",get:function(){return this.direction==Ms.Left_To_Right||this.direction==Ms.Right_To_Left?ys.Horizontal:ys.Vertical}}]),e}(r)).prototype,"adapter",[Ch],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Yh=Mt(Wh.prototype,"handle",[Eh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),qh=Mt(Wh.prototype,"direction",[Ph],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Ms.Top_To_Bottom}}),jh=Mt(Wh.prototype,"interactable",[Ah],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Kh=Mt(Wh.prototype,"dragMinLimit",[Mh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Xh=Mt(Wh.prototype,"dragMaxLimit",[Oh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),Qh=Mt(Wh.prototype,"_transition",[Ih],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Rs.None}}),Mt(Wh.prototype,"transition",[xh],Object.getOwnPropertyDescriptor(Wh.prototype,"transition"),Wh.prototype),Jh=Mt(Wh.prototype,"targetGraphic",[Rh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),$h=Mt(Wh.prototype,"hoverSprite",[Lh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),tp=Mt(Wh.prototype,"pressedSprite",[Nh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ep=Mt(Wh.prototype,"hoverColor",[Fh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return X.WHITE.clone()}}),ip=Mt(Wh.prototype,"pressedColor",[Dh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new X(211,211,211,255)}}),np=Mt(Wh.prototype,"hoverScale",[kh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new K(1,1)}}),op=Mt(Wh.prototype,"pressedScale",[zh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new K(1.2,1.2)}}),rp=Mt(Wh.prototype,"transitionDuration",[Vh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.2}}),ap=Mt(Wh.prototype,"numberOfSteps",[Bh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),sp=Mt(Wh.prototype,"enableAutoHide",[Hh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),lp=Mt(Wh.prototype,"autoHideTime",[Uh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),Gh=Wh));t._RF.pop(),t._RF.push({},"40680UcTm9G/ZhjtPkyAjKr","interface",void 0),t._RF.pop(),t._RF.push({},"0a2997sehVGrL8shCrZiUoV","index",void 0),t._RF.pop(),t._RF.push({},"60302ameClCGbCam2xkotxy","csvManager",void 0);var mp,vp,yp=e.ccclass,bp=(e.property,[",",";","\t","|","^"]),_p=["\r\n","\r","\n"],Sp=function(t,e,i,n){return i instanceof Array?"number"===i[e]?Number(n[e]):"boolean"===i[e]?"true"===n[e]||"t"===n[e]||"1"===n[e]:n[e]:isNaN(Number(t))?"false"==t||"true"==t||"t"==t||"f"==t?"true"===n[e]||"t"===n[e]||"1"===n[e]:n[e]:Number(n[e])},wp={STANDARD_DECODE_OPTS:{skip:0,limit:!1,header:!1,cast:!1,comment:""},STANDARD_ENCODE_OPTS:{delimiter:bp[0],newline:_p[0],skip:0,limit:!1,header:!1},quoteMark:'"',doubleQuoteMark:'""',quoteRegex:/"/g,assign:function(){for(var t=Array.prototype.slice.call(arguments),e=t[0],i=t.slice(1),n=0,o=i.length;n<o;n++)for(var r in i[n])e[r]=i[n][r];return e},map:function(t,e){for(var i=[],n=0,o=t.length;n<o;n++)i[n]=e(t[n],n);return i},getType:function(t){return Object.prototype.toString.call(t).slice(8,-1)},getLimit:function(t,e){return!1===t?e:t},buildObjectConstructor:function(t,e,i){return function(n){var o=new Object,r=function(t,e){return o[t]=e};return i?t.forEach((function(t,o){r(t,Sp(e[o],o,i,n))})):t.forEach((function(t,i){r(t,Sp(e[i],i,null,n))})),o}},buildArrayConstructor:function(t,e,i){return function(n){var o=new Array(e.length),r=function(t,e){return o[t]=e};return i?t.forEach((function(t,o){r(t,Sp(e[o],o,i,n))})):t.forEach((function(t,i){r(t,Sp(e[i],i,null,n))})),o}},frequency:function(t,e,i){void 0===i&&(i=!1);for(var n=0,o=0,r=this.getLimit(i,t.length);o<r&&-1!==(o=t.indexOf(e,o));)o+=1,n++;return n},mostFrequent:function(t,e,i){for(var n,o=e.length-1;o>=0;o--)this.frequency(t,e[o],i)>0&&(n=e[o]);return n||e[0]},unsafeParse:function(t,e,i){var n,o,r=t.split(e.newline);function a(t){var i=t.shift();if(i.indexOf('"')>=0){for(var n=0,o=0,r=0;t.length>0&&(-1!==(n=i.indexOf('"',o))||r%2!=0);)-1!==n?(o=n+1,r++):i=i+e.newline+t.shift();var a,s=[],l=0,c=0,u=0,h=i.length;for(var p in i)if(i.hasOwnProperty(p)){var d=parseInt(p),f=i[p];0===d&&'"'===f&&(l++,c=1),'"'===f&&(l++,i[d-1]===e.delimiter&&c===d&&c++),'"'===f&&l%2==0&&(i[d+1]!==e.delimiter&&d+1!==h||(u=d,a=i.substring(c,u),s.push(a),u=c=u+2)),f===e.delimiter&&l%2==0&&((u=d)>c?(a=i.substring(c,u),s.push(a),u=c=u+1):u===c&&(s.push(""),u=c=u+1))}return(u=h)>=c&&(a=i.substring(c,u),s.push(a)),s}return i.split(e.delimiter)}for(e.skip>0&&r.splice(e.skip),e.header?(!0===e.header?(e.comment=a(r),e.cast=a(r),n=a(r)):"Array"===this.getType(e.header)&&(n=e.header),o=this.buildObjectConstructor(n,r[0].split(e.delimiter),e.cast)):o=this.buildArrayConstructor(n,r[0].split(e.delimiter),e.cast);r.length>0;){var s=a(r);s.length>1&&i(o(s),n[0])}return!0},safeParse:function(t,e,i){e.delimiter;var n=e.newline,o=t.split(n);return e.skip>0&&o.splice(e.skip),!0},encodeCells:function(t,e,i){for(var n=t.slice(0),o=0,r=n.length;o<r;o++)-1!==n[o].indexOf(this.quoteMark)&&(n[o]=n[o].replace(this.quoteRegex,this.doubleQuoteMark)),-1===n[o].indexOf(e)&&-1===n[o].indexOf(i)||(n[o]=this.quoteMark+n[o]+this.quoteMark);return n.join(e)},encodeArrays:function(t,e,i){var n=e.delimiter,o=e.newline;e.header&&"Array"===this.getType(e.header)&&i(this.encodeCells(e.header,n,o));for(var r=0,a=this.getLimit(e.limit,t.length);r<a;r++)i(this.encodeCells(t[r],n,o));return!0},encodeObjects:function(t,e,i){var n,o,r=e.delimiter,a=e.newline;for(var s in n=[],o=[],t[0])n.push(s),o.push(t[0][s]);!0===e.header?i(this.encodeCells(n,r,a)):"Array"===this.getType(e.header)&&i(this.encodeCells(e.header,r,a)),i(this.encodeCells(o,r));for(var l=1,c=this.getLimit(e.limit,t.length);l<c;l++){o=[];for(var u=0,h=n.length;u<h;u++)o.push(t[l][n[u]]);i(this.encodeCells(o,r,a))}return!0},parse:function(t,e,i){var n;if("Function"===this.getType(e)?(i=e,e={}):"Function"!==this.getType(i)?i=(n=[]).push.bind(n):n=[],e=this.assign({},this.STANDARD_DECODE_OPTS,e),this.opts=e,!e.delimiter||!e.newline){var o=Math.min(48,Math.floor(t.length/20),t.length);e.delimiter=e.delimiter||this.mostFrequent(t,bp,o),e.newline=e.newline||this.mostFrequent(t,_p,o)}return this.unsafeParse(t,e,i)&&(!(n.length>0)||n)},encode:function(t,e,i){var n;return"Function"===this.getType(e)?(i=e,e={}):"Function"!==this.getType(i)&&(i=(n=[]).push.bind(n)),(e=this.assign({},this.STANDARD_ENCODE_OPTS,e)).skip>0&&(t=t.slice(e.skip)),("Array"===this.getType(t[0])?this.encodeArrays:this.encodeObjects)(t,e,i)&&(!(n.length>0)||n.join(e.newline))}},Tp=yp("CSVManager")(((pp=function(){function t(){this._csvTables={},this._csvTableForArr={},this._tableCast={},this._tableComment={}}var e=t.prototype;return e.addTable=function(t,e,i){if(!this._csvTables[t]||i){var n={},o=[];wp.parse(e,{header:!0},(function(t,e){n[t[e]]=t,o.push(t)})),this._tableCast[t]=wp.opts.cast,this._tableComment[t]=wp.opts.comment,this._csvTables[t]=n,this._csvTableForArr[t]=o}},e.getTableArr=function(t){return this._csvTableForArr[t]},e.getTable=function(t){return this._csvTables[t]},e.queryOne=function(t,e,i){var n=this.getTable(t);if(!n)return null;if(!e)return n[i];for(var o in n)if(n.hasOwnProperty(o)&&n[o][e]===i)return n[o]},e.queryByID=function(t,e){return this.queryOne(t,null,e)},e.queryAll=function(t,e,i){var n=this.getTable(t);if(!n||!e)return null;var o={};for(var r in n)n.hasOwnProperty(r)&&n[r][e]===i&&(o[r]=n[r]);return o},e.queryIn=function(t,e,i){var n=this.getTable(t);if(!n||!e)return null;for(var o={},r=Object.keys(n),a=r.length,s=0;s<a;s++){var l=n[r[s]];i.indexOf(l[e])>-1&&(o[r[s]]=l)}return o},e.queryByCondition=function(t,e){if(e.constructor!==Object)return null;var i=this.getTable(t);if(!i)return null;for(var n={},o=Object.keys(i),r=o.length,a=Object.keys(e),s=a.length,l=0;l<r;l++){for(var c=i[o[l]],u=!0,h=0;h<s;h++){var p=a[h];u=u&&e[p]===c[p]&&!n[o[l]]}u&&(n[o[l]]=c)}return n},e.queryOneByCondition=function(t,e){if(e.constructor!==Object)return null;var i=this.getTable(t);if(!i)return null;var n=Object.keys(e),o=n.length;for(var r in i){for(var a=i[r],s=!0,l=0;l<o;l++){var c=n[l];s=s&&e[c]===a[c]}if(s)return a}return null},Nt(t,null,[{key:"instance",get:function(){return this._instance||(this._instance=new t),this._instance}}]),t}())._instance=void 0,hp=pp))||hp;t._RF.pop(),t._RF.push({},"aca4damK49DYqlWPDNwTrSS","localConfig",void 0);var Cp,Ep,Pp=e.ccclass;e.property,Pp("LocalConfig")(((vp=function(){function t(){this._csvManager=new Tp,this._callback=new Function,this._currentLoad=0,this._cntLoad=0}var e=t.prototype;return e.loadConfig=function(t){this._callback=t,this._loadCSV()},e._loadCSV=function(){var t=this;a.loadDir("datas",(function(e,i){if(!e){var n=i.filter((function(t){return".md"!==t._native}));t._cntLoad=n.length,n.length?n.forEach((function(e,i,n){Je.getTextData(e.name,(function(i){t._csvManager.addTable(e.name,i),t._tryToCallbackOnFinished()}))})):t._tryToCallbackOnFinished()}}))},e.queryOne=function(t,e,i){return this._csvManager.queryOne(t,e,i)},e.queryByID=function(t,e){return this._csvManager.queryByID(t,e)},e.getTable=function(t){return this._csvManager.getTable(t)},e.getTableArr=function(t){return this._csvManager.getTableArr(t)},e.queryAll=function(t,e,i){return this._csvManager.queryAll(t,e,i)},e.queryIn=function(t,e,i){return this._csvManager.queryIn(t,e,i)},e.queryByCondition=function(t,e){return this._csvManager.queryByCondition(t,e)},e._tryToCallbackOnFinished=function(){this._callback&&(this._currentLoad++,this._currentLoad>=this._cntLoad&&this._callback())},Nt(t,null,[{key:"instance",get:function(){return this._instance||(this._instance=new t),this._instance}}]),t}())._instance=void 0,mp=vp));t._RF.pop(),t._RF.push({},"6743cVJ1/1Ha68y/dyVx1hh","lodash",void 0);var Ap,Mp;(0,e.ccclass)("lodash")(((Ep=function(){function t(){}return t.find=function(e,i){var n;if(Array.isArray(e)||(e=t._toArray(e)),(n=e.filter(i)).length)return n[0]},t.forEach=function(e,i){Array.isArray(e)?e.forEach(i):t._toArrayKey(e).forEach((function(t,n,o){var r=t.key,a=t.value;i(a,r,e)}))},t.cloneDeep=function(e){if(null===e||"object"!=typeof e)return e;var i={};for(var n in e.constructor===Array&&(i=[]),e)e.hasOwnProperty(n)&&(i[n]=t.cloneDeep(e[n]));return i},t.map=function(e,i){Array.isArray(e)||(e=t._toArray(e));var n=[];return e.forEach((function(t,e,o){n.push(i(t,e,o))})),n},t._toArrayKey=function(t){var e=[];for(var i in t)t.hasOwnProperty(i)&&e.push({key:i,value:t[i]});return e},t._toArray=function(t){var e=[];for(var i in t)t.hasOwnProperty(i)&&e.push(t[i]);return e},t.filter=function(e,i){return Array.isArray(e)||(e=t._toArray(e)),e.filter(i)},t.isEqual=function(e,i){if(!(e instanceof Object)||!(i instanceof Object))return e===i;if(Object.keys(e).length!==Object.keys(i).length)return!1;for(var n in e){var o=e[n]instanceof Object,r=i[n]instanceof Object;if(o&&r)return t.isEqual(e[n],i[n]);if(e[n]!==i[n])return!1}return!0},t.pullAllWith=function(t,e,i){return e.forEach((function(e){t.filter((function(t){return i(t,e)})).forEach((function(e){var i=t.indexOf(e);-1!==t.indexOf(e)&&t.splice(i,1)}))})),t},t.now=function(){return Date.now()},t.pullAll=function(t,e){return e.forEach((function(e){var i=t.indexOf(e);-1!==t.indexOf(e)&&t.splice(i,1)})),t},t.forEachRight=function(e,i){Array.isArray(e)||(e=t._toArray(e));for(var n=e.length-1;n>=0;n--){if(!i(e[n]))break}},t.startsWith=function(t,e,i){return(t=t.substr(i)).startsWith(e)},t.endsWith=function(t,e,i){return(t=t.substr(i)).endsWith(e)},t.remove=function(e,i){var n=[],o=[];return e.forEach((function(t,e){i(t)&&(n.push(t),o.push(e))})),t._basePullAt(e,o),n},t._basePullAt=function(t,e){for(var i,n=t?e.length:0,o=n-1;n--;){var r=e[n];n!==o&&r===i||(i=r,Array.prototype.splice.call(t,r,1))}return t},t.findIndex=function(t,e,i){var n;if(t=t.slice(i),"function"==typeof e){for(n=0;n<t.length;n++)if(e(t[n]))return n}else if(Array.isArray(e))for(n=0;n<t.length;n++){var o=e[0],r=!0;if(e.length>1&&(r=e[1]),t[n][o]===r)return n}else for(n=0;n<t.length;n++)if(t[n]===e)return n;return-1},t.concat=function(){var t=arguments.length;if(!t)return[];for(var e=arguments[0],i=1;i<t;)e=e.concat(arguments[i]),i++;return e},t.isNumber=function(t){return"number"==typeof t},t.indexOf=function(t,e,i){return(t=t.slice(i)).indexOf(e)},t.join=function(t,e){if(null===t)return"";var i="";return t.forEach((function(t){i+=t+e})),i.substr(0,i.length-1)},t.split=function(t,e,i){return t.split(e,i)},t.max=function(t){if(t&&t.length){for(var e,i=0;i<t.length;i++)0===i?e=t[0]:e<t[i]&&(e=t[i]);return e}},t.drop=function(t,e){return(null===t?0:t.length)?t.slice(e):[]},t.flattenDeep=function(e){return e.reduce((function(e,i){return e.concat(Array.isArray(i)?t.flattenDeep(i):i)}),[])},t.uniq=function(t){var e=[];return t.forEach((function(t){-1===e.indexOf(t)&&e.push(t)})),e},t.isNaN=function(e){return t.isNumber(e)&&e!==+e},t.chunk=function(t,e){if(!(null===t?0:t.length)||e<1)return[];for(var i=[];t.length>e;)i.push(t.slice(0,e)),t=t.slice(e);return i.push(t),i},t.toFinite=function(t){var e=1/0;return t?(t=Number(t))===e||t===-1/0?17976931348623157e292*(t<0?-1:1):t==t?t:0:0===t?t:0},t.isObject=function(t){var e=typeof t;return null!==t&&("object"===e||"function"===e)},t.isLength=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=t.MAX_SAFE_INTEGER},t._isArrayLike=function(e){return null!==e&&t.isLength(e.length)},t.maxBy=function(t,e){if(t&&t.length){for(var i,n,o=0;o<t.length;o++)0===o?(i=e(t[0]),n=t[0]):i<t[o]&&(i=t[o],n=t[o]);return n}},t.minBy=function(t,e){if(t&&t.length){for(var i,n,o=0;o<t.length;o++)0===o?(i=e(t[0]),n=t[0]):i>t[o]&&(i=e(t[o]),n=t[o]);return n}},t.sumBy=function(t,e){var i=0;for(var n in t)i+=e(t[n]);return i},t.countBy=function(t,e){var i={};for(var n in t){var o=e(n);i.hasOwnProperty(o)?i[o]+=1:i[o]=1}return i},t}()).MAX_SAFE_INTEGER=9007199254740991,Cp=Ep));t._RF.pop(),t._RF.push({},"411ad/aVKtGja0EX2BBJnVT","poolManager",void 0);var Op=e.ccclass,Ip=(e.property,Op("PoolManager")(((Mp=function(){function t(){this._dictPool={},this._dictPrefab={}}var e=t.prototype;return e.getNode=function(t,e){var i=t.name;t.position||(i=t.data.name),this._dictPrefab[i]=t;var n=null;if(this._dictPool.hasOwnProperty(i)){var o=this._dictPool[i];n=o.size()>0?o.get():E(t)}else{var r=new et;this._dictPool[i]=r,n=E(t)}return n.parent=e,n.active=!0,n.name=i,n},e.putNode=function(t){if(t){var e=t.name,i=null;this._dictPool.hasOwnProperty(e)?i=this._dictPool[e]:(i=new et,this._dictPool[e]=i),i.put(t)}},e.clearPool=function(t){this._dictPool.hasOwnProperty(t)&&this._dictPool[t].clear()},e.preloadPool=function(t,e){var i=t.name;t.position||(i=t.data.name);var n=null;this._dictPool.hasOwnProperty(i)?n=this._dictPool[i]:(n=new et,this._dictPool[i]=n);for(var o=0;o<e;o++){var r=E(t);n.put(r)}},Nt(t,null,[{key:"instance",get:function(){return this._instance||(this._instance=new t),this._instance}}]),t}())._instance=void 0,Ap=Mp))||Ap);t._RF.pop(),t._RF.push({},"a4ed0rV6NNLHYnS0I+Yctb7","SceneDefine",void 0);var xp,Rp,Lp,Np,Fp,Dp="Home";t._RF.pop(),t._RF.push({},"f75e0dYk2hItL6AtoKH1J3L","SocketEventDefines",void 0),t._RF.pop(),t._RF.push({},"97270evPX5NaoJ6I7QVNd3F","DynamicSkeletonAnimation",void 0);var kp=e.ccclass,zp=e.property;xp=kp("DynamicAnimationClip"),Rp=zp({type:it}),xp((Fp=Mt((Np=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,It(e,"animationComponent",Fp,xt(e)),e}return Ot(e,t),e.prototype.start=function(){var t=this;a.load("3d/animation_clips/your_animation_clip",nt,(function(e,i){e?console.error("Failed to load animation clip:",e):i?t.animationComponent?(t.animationComponent.addClip(i),t.animationComponent.play("your_animation_clip")):console.error("Animation component is not assigned in the editor."):console.warn("Animation clip not found at the specified path.")}))},e}(r)).prototype,"animationComponent",[Rp],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Lp=Np));t._RF.pop(),t._RF.push({},"bc1d75XEItMOZF3HZi0EoA3","APIFakeData",void 0),t._RF.pop(),t._RF.push({},"3b325m3/clNb7s376jIQ9MJ","APIManager",void 0);var Vp=function(){function t(){var t=this;this.baseURL=void 0,this.timeout=void 0,this.MAX_RETAKE_TOKEN=5,this.retakeTokenTimesThisSession=0,this.retakeToken=null,this.onFailedCallback=null,this.isLog=!0,this.log=function(e){t.isLog&&ve.LOG&&console.log("[API] : ",e)},this.baseURL="",this.timeout=3e4}var e=t.prototype;return e.setBaseURL=function(t){this.baseURL=t},e.setTimeout=function(t){this.timeout=t},e.request=function(){var t=Rt(Lt().mark((function t(e,i,n,o,r){var a,s,l,c,u,h,p,d;return Lt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return void 0===r&&(r=null),a=null,s=!1,l=null,r||(r=Hp),t.prev=5,t.next=8,this.fetchWithRetry(e,i);case 8:if((c=t.sent).ok){t.next=11;break}throw{message:"Network response was not ok",statusCode:777};case 11:return t.next=13,c.json();case 13:a=t.sent,this.log("data:"+a),(l=a).statusCode&&200!=l.statusCode&&(s=!0,this.log("Server response ERROR:"+l.message),o(l),null==(u=this.onFailedCallback)||u.call(this,l)),t.next=25;break;case 19:t.prev=19,t.t0=t.catch(5),s=!0,this.log("ERROR:"+t.t0),o(t.t0),null==(h=this.onFailedCallback)||h.call(this,t.t0);case 25:if(!s){try{p=Bp.AES.decrypt(l.data,r),d=p.toString(Bp.enc.Utf8),l.data=JSON.parse(d)}catch(t){this.log("resData: ERROR"+t)}n(l)}case 26:case"end":return t.stop()}}),t,this,[[5,19]])})));return function(e,i,n,o,r){return t.apply(this,arguments)}}(),e.fetchWithRetry=function(){var t=Rt(Lt().mark((function t(e,i,n){var o,r,a;return Lt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:void 0===n&&(n=3),o=0;case 2:if(!(o<n)){t.next=28;break}return t.prev=3,r=this.baseURL+e,this.log("fetch "+r),t.next=8,this.timeoutPromise(fetch(r,i));case 8:if(401!=(a=t.sent).status||!this.retakeToken){t.next=16;break}if(this.log("try get new token"),!(++this.retakeTokenTimesThisSession<=this.MAX_RETAKE_TOKEN)){t.next=16;break}return t.next=14,this.retakeToken();case 14:t.sent&&(i.headers=Gp());case 16:if(!a.ok){t.next=18;break}return t.abrupt("return",a);case 18:t.next=24;break;case 20:if(t.prev=20,t.t0=t.catch(3),o!==n-1){t.next=24;break}throw t.t0;case 24:o++,this.log("retry attemptes:"+o),t.next=2;break;case 28:throw{message:"All retries failed",statusCode:666};case 29:case"end":return t.stop()}}),t,this,[[3,20]])})));return function(e,i,n){return t.apply(this,arguments)}}(),e.timeoutPromise=function(t){var e=this;return new Promise((function(i,n){var o=setTimeout((function(){return n(new Error("Request timed out"))}),e.timeout);t.then((function(t){clearTimeout(o),i(t)}),(function(t){clearTimeout(o),n(t)}))}))},t}(),Bp=window.CryptoJS,Hp="",Up=new Vp;Up.onFailedCallback=function(t){},setInterval((function(){return}),3e5);var Gp=function(){return{Authorization:"Bearer ","Content-Type":"application/json"}};t._RF.pop(),t._RF.push({},"399f2AVXt9B5ozV4m+hAt4r","GameManager",void 0);var Wp,Zp,Yp,qp,jp,Kp,Xp,Qp,Jp,$p,td,ed,id,nd,od,rd,ad,sd,ld,cd,ud,hd=function(){function t(){this.userInfo=null,this.isNeedToReload=!1,this.isShouldSync=!0,this.initGameEvents()}var e=t.prototype;return e.initGameEvents=function(){O.on(ot.EVENT_HIDE,(function(){ve.LOG&&console.log("GameManager: on game hided")}))},e.setUserInfo=function(t){this.userInfo=t,this.isNeedToReload=!1,this.isShouldSync=!0},t}();hd.instance=null,hd.instance=new hd,t._RF.pop(),t._RF.push({},"2863714705FO4J9mAWwN/3b","UserModel",void 0),t._RF.pop(),t._RF.push({},"9be2aMianZDILhLauesx1FQ","SongData",void 0),t._RF.pop(),t._RF.push({},"3407dOpf11DQZytuXaeEQcr","AuditionNoteVisual",void 0);var pd,dd,fd,gd,md,vd,yd,bd,_d,Sd,wd,Td,Cd,Ed,Pd=e.ccclass,Ad=e.property,Md=(Wp=Pd("AuditionNoteVisual"),Zp=Ad(f),Yp=Ad(f),qp=Ad(b),jp=Ad(X),Kp=Ad(X),Xp=Ad(X),Qp=Ad(X),Jp=Ad(X),Wp((ed=Mt((td=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,It(e,"noteSprite",ed,xt(e)),It(e,"glowSprite",id,xt(e)),It(e,"opacity",nd,xt(e)),It(e,"pulseSpeed",od,xt(e)),It(e,"pulseIntensity",rd,xt(e)),It(e,"leftNoteColor",ad,xt(e)),It(e,"rightNoteColor",sd,xt(e)),It(e,"perfectColor",ld,xt(e)),It(e,"goodColor",cd,xt(e)),It(e,"missColor",ud,xt(e)),e.hitAnimDuration=.2,e.missAnimDuration=.4,e.appearAnimDuration=.05,e.activeTweens=[],e.originalScale=new g(1,1,1),e.isHit=!1,e}Ot(e,t);var i=e.prototype;return i.onLoad=function(){this.node&&(this.originalScale=this.node.getScale().clone()),this.opacity||(this.opacity=this.getComponent(b),this.opacity||(this.opacity=this.addComponent(b)))},i.initialize=function(){this.isHit=!1,this.node.setScale(this.originalScale),this.node.setRotation(0,0,0,1),this.opacity&&(this.opacity.opacity=255)},i.playAppearAnimation=function(){var t=this;if(this.node){this.stopAllTweens(),this.node.setScale(0,0,1);var e=v(this.node).to(this.appearAnimDuration,{scale:this.originalScale},{easing:"backOut"}).call((function(){t.startPulseAnimation()})).start();this.activeTweens.push(e)}},i.startPulseAnimation=function(){if(this.node&&!this.isHit){this.stopAllTweens();var t=v(this.node).to(this.pulseSpeed/2,{scale:new g(this.originalScale.x*(1+this.pulseIntensity),this.originalScale.y*(1+this.pulseIntensity),this.originalScale.z)},{easing:"sineInOut"}).to(this.pulseSpeed/2,{scale:this.originalScale},{easing:"sineInOut"}).union().repeatForever().start();this.activeTweens.push(t)}},i.stopAllTweens=function(){this.activeTweens.forEach((function(t){return t.stop()})),this.activeTweens=[]},i.showHitEffect=function(){if(this.node){this.isHit=!0,this.stopAllTweens();var t=new g(1.5*this.originalScale.x,1.5*this.originalScale.y,this.originalScale.z),e=v(this.node).to(this.hitAnimDuration/3,{scale:t},{easing:"quadOut"}).to(2*this.hitAnimDuration/3,{scale:this.originalScale},{easing:"quadIn"}).start();if(this.activeTweens.push(e),this.opacity){var i=v(this.opacity).to(this.hitAnimDuration,{opacity:50}).start();this.activeTweens.push(i)}}},i.showMissEffect=function(){var t=this;if(this.node){this.isHit=!0,this.stopAllTweens(),this.glowSprite&&(this.glowSprite.color=this.missColor,this.glowSprite.node.active=!0);var e=new g(this.node.position.x,this.node.position.y-50,this.node.position.z),i=v(this.node).to(this.missAnimDuration,{position:e,scale:new g(.7*this.originalScale.x,.7*this.originalScale.y,this.originalScale.z)},{easing:"quadIn"}).call((function(){t.node.active=!1})).start();if(this.activeTweens.push(i),this.opacity){var n=v(this.opacity).to(this.missAnimDuration,{opacity:0}).start();this.activeTweens.push(n)}}},i.reset=function(){this.stopAllTweens(),this.node.setScale(this.originalScale),this.node.setRotation(0,0,0,1),this.opacity&&(this.opacity.opacity=255),this.glowSprite&&(this.glowSprite.node.active=!1),this.isHit=!1},e}(r)).prototype,"noteSprite",[Zp],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),id=Mt(td.prototype,"glowSprite",[Yp],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),nd=Mt(td.prototype,"opacity",[qp],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),od=Mt(td.prototype,"pulseSpeed",[Ad],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),rd=Mt(td.prototype,"pulseIntensity",[Ad],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.2}}),ad=Mt(td.prototype,"leftNoteColor",[jp],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new X(79,195,247)}}),sd=Mt(td.prototype,"rightNoteColor",[Kp],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new X(255,112,67)}}),ld=Mt(td.prototype,"perfectColor",[Xp],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new X(120,255,120)}}),cd=Mt(td.prototype,"goodColor",[Qp],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new X(255,193,7)}}),ud=Mt(td.prototype,"missColor",[Jp],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new X(211,47,47)}}),$p=td))||$p);t._RF.pop(),t._RF.push({},"d703e2K9thB05Xmm4wf/DzN","AuditionAudioManager",void 0);var Od,Id,xd,Rd,Ld,Nd,Fd,Dd,kd,zd,Vd=e.ccclass,Bd=e.property,Hd=(pd=Vd("AuditionAudioManager"),dd=Bd(I),fd=Bd(I),gd=Bd({range:[0,1]}),md=Bd({range:[0,1]}),pd(((Ed=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,It(e,"musicFolder",bd,xt(e)),It(e,"musicSource",_d,xt(e)),It(e,"sfxSource",Sd,xt(e)),It(e,"audioOffset",wd,xt(e)),It(e,"musicVolume",Td,xt(e)),It(e,"sfxVolume",Cd,xt(e)),e.soundEffects=new Map,e.startTime=0,e.isPaused=!1,e.pauseTime=0,e}Ot(e,t);var i=e.prototype;return i.onLoad=function(){null===e._instance?(e._instance=this,this.musicSource||(this.musicSource=this.node.addComponent(I),this.musicSource.loop=!0,this.musicSource.volume=this.musicVolume),this.sfxSource||(this.sfxSource=this.node.addComponent(I),this.sfxSource.loop=!1,this.sfxSource.volume=this.sfxVolume),this.loadSoundEffects()):this.node.destroy()},i.loadSoundEffects=function(){var t=this;["good","miss","s_ready","s_go"].forEach((function(e){Je.loadRes("audition/audio/sfx/"+e,x,(function(i,n){i?console.error("Failed to load sound effect: "+e,i):(t.soundEffects.set(e,n),console.log("Sound effect loaded: "+e))}))}));for(var e=function(){var e=1===i?"perfect":"perfect"+i;Je.loadRes("audition/audio/sfx/"+e,x,(function(i,n){i?console.error("Failed to load perfect sound effect: "+e,i):(t.soundEffects.set(e,n),console.log("Perfect sound effect loaded: "+e))}))},i=1;i<=5;i++)e()},i.loadSong=function(t){var e=this;return new Promise((function(i,n){console.log("Loading song: "+t);var o=e.musicFolder+t;Je.loadRes(o,x,(function(t,r){if(t)return console.error("Failed to load song: "+o,t),void n(t);e.musicSource.clip=r,console.log("Song loaded: "+o),i()}))}))},i.playSong=function(t){void 0===t&&(t=0),this.musicSource.clip?(this.musicSource.currentTime=t/1e3,this.startTime=Date.now()-t,this.isPaused=!1,this.musicSource.play(),console.log("Playing song from "+t+"ms")):console.error("No song loaded")},i.pauseSong=function(){this.musicSource.playing&&(this.musicSource.pause(),this.isPaused=!0,this.pauseTime=this.getCurrentTime(),console.log("Song paused at "+this.pauseTime+"ms"))},i.resumeSong=function(){this.isPaused&&(this.musicSource.play(),this.startTime=Date.now()-this.pauseTime,this.isPaused=!1,console.log("Song resumed from "+this.pauseTime+"ms"))},i.stopSong=function(){this.musicSource.stop(),this.isPaused=!1,console.log("Song stopped")},i.getCurrentTime=function(){return this.isPaused?this.pauseTime:1e3*this.musicSource.currentTime},i.getDuration=function(){return 1e3*this.musicSource.clip.getDuration()},i.playSound=function(t){var e=this.soundEffects.get(t);e?this.sfxSource.playOneShot(e):console.warn("Sound effect not found: "+t)},i.setMusicVolume=function(t){this.musicVolume=Math.max(0,Math.min(1,t)),this.musicSource.volume=this.musicVolume},i.setSfxVolume=function(t){this.sfxVolume=Math.max(0,Math.min(1,t)),this.sfxSource.volume=this.sfxVolume},i.getMusicVolume=function(){return this.musicVolume},i.getSfxVolume=function(){return this.sfxVolume},i.setAudioOffset=function(t){this.audioOffset=t,console.log("Audio offset set to "+t+"ms")},i.getAudioOffset=function(){return this.audioOffset},i.calibrateAudioOffset=function(){console.log("Audio calibration initiated"),this.audioOffset=-50,console.log("Audio calibrated with offset: "+this.audioOffset+"ms")},Nt(e,null,[{key:"instance",get:function(){return this._instance}}]),e}(r))._instance=null,bd=Mt((yd=Ed).prototype,"musicFolder",[Bd],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"audition/music/"}}),_d=Mt(yd.prototype,"musicSource",[dd],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Sd=Mt(yd.prototype,"sfxSource",[fd],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),wd=Mt(yd.prototype,"audioOffset",[Bd],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Td=Mt(yd.prototype,"musicVolume",[gd],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.7}}),Cd=Mt(yd.prototype,"sfxVolume",[md],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),vd=yd))||vd);t._RF.pop(),t._RF.push({},"3e57c37p+BC+q4zA+47ifrI","AuditionInputHandler",void 0);var Ud,Gd,Wd,Zd,Yd,qd,jd,Kd,Xd,Qd=e.ccclass,Jd=e.property,$d=function(t){return t[t.LEFT=0]="LEFT",t[t.RIGHT=1]="RIGHT",t[t.SPACE=2]="SPACE",t}({}),tf=(Od=Qd("AuditionInputHandler"),Id=Jd(c),xd=Jd(c),Rd=Jd(c),Od(((zd=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,It(e,"leftInputArea",Fd,xt(e)),It(e,"rightInputArea",Dd,xt(e)),It(e,"spaceInputArea",kd,xt(e)),e.isInputEnabled=!0,e.inputCallbacks=new Map,e.lastInputTime=new Map,e.inputDebounceTime=100,e}Ot(e,t);var i=e.prototype;return i.onLoad=function(){null===e._instance?(e._instance=this,this.initialize()):this.node.destroy()},i.initialize=function(){this.inputCallbacks.set($d.LEFT,[]),this.inputCallbacks.set($d.RIGHT,[]),this.inputCallbacks.set($d.SPACE,[]),this.lastInputTime.set($d.LEFT,0),this.lastInputTime.set($d.RIGHT,0),this.lastInputTime.set($d.SPACE,0),this.registerTouchEvents(),this.registerKeyboardEvents(),console.log("Audition Input Handler initialized")},i.registerTouchEvents=function(){var t=this;this.leftInputArea&&this.leftInputArea.on(k.EventType.TOUCH_START,(function(e){t.isInputEnabled&&t.handleInput($d.LEFT)})),this.rightInputArea&&this.rightInputArea.on(k.EventType.TOUCH_START,(function(e){t.isInputEnabled&&t.handleInput($d.RIGHT)})),this.spaceInputArea&&this.spaceInputArea.on(k.EventType.TOUCH_START,(function(e){t.isInputEnabled&&t.handleInput($d.SPACE)}))},i.registerKeyboardEvents=function(){var t=this;D.on(k.EventType.KEY_DOWN,(function(e){if(t.isInputEnabled)switch(e.keyCode){case L.ARROW_LEFT:case L.KEY_A:t.handleInput($d.LEFT);break;case L.ARROW_RIGHT:case L.KEY_D:t.handleInput($d.RIGHT);break;case L.SPACE:t.handleInput($d.SPACE)}}))},i.handleInput=function(t){var e=Date.now(),i=this.lastInputTime.get(t);if(!(e-i<this.inputDebounceTime)){this.lastInputTime.set(t,e);var n=this.inputCallbacks.get(t);n&&n.forEach((function(t){return t(e)})),console.log("Input detected: "+$d[t])}},i.registerInputCallback=function(t,e){var i=this.inputCallbacks.get(t);i&&i.push(e)},i.unregisterInputCallback=function(t,e){var i=this.inputCallbacks.get(t);if(i){var n=i.indexOf(e);-1!==n&&i.splice(n,1)}},i.setInputEnabled=function(t){this.isInputEnabled=t,console.log("Input "+(t?"enabled":"disabled"))},i.getInputEnabled=function(){return this.isInputEnabled},i.setInputDebounceTime=function(t){this.inputDebounceTime=t},i.getInputDebounceTime=function(){return this.inputDebounceTime},i.simulateInput=function(t,e){this.lastInputTime.set(t,e);var i=this.inputCallbacks.get(t);i&&i.forEach((function(t){return t(e)})),console.log("Simulated input: "+$d[t])},Nt(e,null,[{key:"instance",get:function(){return this._instance}}]),e}(r))._instance=null,Fd=Mt((Nd=zd).prototype,"leftInputArea",[Id],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Dd=Mt(Nd.prototype,"rightInputArea",[xd],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),kd=Mt(Nd.prototype,"spaceInputArea",[Rd],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ld=Nd))||Ld);t._RF.pop(),t._RF.push({},"dcf6eWvaXRMR72esUo9n+2S","AuditionNotePool",void 0);var ef,nf,of,rf,af,sf=e.ccclass,lf=e.property,cf=function(t){return t[t.LEFT=0]="LEFT",t[t.RIGHT=1]="RIGHT",t}({}),uf=(Ud=sf("AuditionNotePool"),Gd=lf(l),Wd=lf(l),Ud((qd=Mt((Yd=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,It(e,"leftNotePrefab",qd,xt(e)),It(e,"rightNotePrefab",jd,xt(e)),It(e,"initialPoolSize",Kd,xt(e)),It(e,"expandPoolAmount",Xd,xt(e)),e.leftNotePool=[],e.rightNotePool=[],e.activeNotes=new Map,e.nextNoteId=0,e}Ot(e,t);var i=e.prototype;return i.onLoad=function(){this.initializePools()},i.initializePools=function(){this.leftNotePrefab&&this.createPool(cf.LEFT,this.initialPoolSize),this.rightNotePrefab&&this.createPool(cf.RIGHT,this.initialPoolSize)},i.createPool=function(t,e){var i=this.getPoolForType(t),n=this.getPrefabForType(t);if(n){for(var o=0;o<e;o++){var r=E(n);r.parent=this.node,r.active=!1,i.push(r)}console.log("Created pool for note type "+t+" with "+e+" notes")}else console.error("No prefab defined for note type: "+t)},i.getNote=function(t){var e=this.getPoolForType(t);0===e.length&&this.expandPool(t);var i=e.pop();if(!i)return console.error("Failed to get note of type "+t+" from pool"),null;i.active=!0;var n=this.nextNoteId++;return this.activeNotes.set(n,i),{id:n,node:i}},i.recycleNote=function(t){var e=this.activeNotes.get(t);if(e){e.active=!1,e.setPosition(0,0,0),e.setScale(1,1,1);var i=this.getNoteTypeFromNode(e);this.getPoolForType(i).push(e),this.activeNotes.delete(t)}else console.warn("Note with ID "+t+" not found in active notes")},i.recycleAllNotes=function(){var t=this;Array.from(this.activeNotes.keys()).forEach((function(e){return t.recycleNote(e)}))},i.expandPool=function(t){console.log("Expanding pool for note type "+t+" with "+this.expandPoolAmount+" more notes"),this.createPool(t,this.expandPoolAmount)},i.getPoolForType=function(t){switch(t){case cf.LEFT:return this.leftNotePool;case cf.RIGHT:return this.rightNotePool;default:return console.error("Unknown note type: "+t),null}},i.getPrefabForType=function(t){switch(t){case cf.LEFT:return this.leftNotePrefab;case cf.RIGHT:return this.rightNotePrefab;default:return console.error("Unknown note type: "+t),null}},i.getNoteTypeFromNode=function(t){return t.name.toLowerCase().includes("left")?cf.LEFT:cf.RIGHT},i.getActiveNoteCount=function(){return this.activeNotes.size},i.getAvailableNoteCount=function(t){var e=this.getPoolForType(t);return e?e.length:0},e}(r)).prototype,"leftNotePrefab",[Gd],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),jd=Mt(Yd.prototype,"rightNotePrefab",[Wd],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Kd=Mt(Yd.prototype,"initialPoolSize",[lf],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 20}}),Xd=Mt(Yd.prototype,"expandPoolAmount",[lf],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 10}}),Zd=Yd))||Zd);t._RF.pop(),t._RF.push({},"b06301HH+lNDJwPFjxXjoas","AuditionNote",void 0);var hf,pf,df,ff,gf,mf,vf,yf,bf,_f,Sf,wf,Tf,Cf,Ef,Pf,Af,Mf,Of,If,xf,Rf,Lf,Nf,Ff,Df,kf,zf,Vf,Bf,Hf,Uf,Gf,Wf=e.ccclass,Zf=e.property,Yf=(ef=Wf("AuditionNote"),nf=Zf(Md),ef((af=Mt((rf=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,It(e,"noteVisual",af,xt(e)),e.noteType=cf.LEFT,e.beatTime=0,e.targetY=0,e.startY=0,e.isMoving=!1,e.noteId=-1,e}Ot(e,t);var i=e.prototype;return i.initialize=function(t,e,i){switch(this.noteType=t,this.beatTime=e,this.noteId=i,this.noteVisual?this.noteVisual.initialize():console.warn("Note visual component is not assigned!"),this.noteType){case cf.LEFT:this.node.name="LeftNote";break;case cf.RIGHT:this.node.name="RightNote"}},i.playHitEffect=function(t){this.isMoving=!1,this.noteVisual&&this.noteVisual.showHitEffect(t)},i.playMissEffect=function(){this.isMoving=!1,this.noteVisual&&this.noteVisual.showMissEffect()},i.reset=function(){this.isMoving=!1,this.noteVisual&&this.noteVisual.reset(),this.node.active=!0},i.matchesInput=function(t){return this.noteType===t},i.getNoteId=function(){return this.noteId},i.getNoteType=function(){return this.noteType},e}(r)).prototype,"noteVisual",[nf],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),of=rf))||of);t._RF.pop(),t._RF.push({},"e8f01vW2ehGAbebHt2Bdk2+","AuditionBeatSystem",void 0);var qf,jf=e.ccclass,Kf=e.property,Xf=function(t){return t[t.PERFECT=0]="PERFECT",t[t.GOOD=1]="GOOD",t[t.MISS=2]="MISS",t}({}),Qf=function(t){return t.OFF="off",t.LEVEL="lv",t.FINISH="finish",t}({}),Jf=(hf=jf("AuditionBeatSystem"),pf=Kf({type:c,group:{name:"Visual Elements",id:"visual"}}),df=Kf({type:c,group:{name:"Visual Elements",id:"visual"}}),ff=Kf({type:c,group:{name:"Visual Elements",id:"visual"}}),gf=Kf({type:c,group:{name:"Visual Elements",id:"visual"}}),mf=Kf({type:f,group:{name:"Visual Elements",id:"visual"}}),vf=Kf({type:b,group:{name:"Visual Elements",id:"visual"}}),yf=Kf({type:y,group:{name:"Visual Elements",id:"visual"}}),bf=Kf({group:{name:"Beat Settings",id:"beat"}}),_f=Kf({group:{name:"Beat Settings",id:"beat"}}),Sf=Kf({group:{name:"Timing Windows",id:"timing"}}),wf=Kf({group:{name:"Timing Windows",id:"timing"}}),Tf=Kf({group:{name:"Timing Windows",id:"timing"}}),Cf=Kf({type:uf,group:{name:"Note Settings",id:"notes"}}),Ef=Kf({type:c,group:{name:"Note Settings",id:"notes"}}),Pf=Kf({type:rt,group:{name:"Note Settings",id:"notes"}}),hf((Of=Mt((Mf=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,It(e,"movingBeatNote",Of,xt(e)),It(e,"targetZone",If,xt(e)),It(e,"startNode",xf,xt(e)),It(e,"endNode",Rf,xt(e)),It(e,"heartBeatSprite",Lf,xt(e)),It(e,"opacityGameplay",Nf,xt(e)),It(e,"levelLabel",Ff,xt(e)),It(e,"bpm",Df,xt(e)),It(e,"beatsPerLoop",kf,xt(e)),It(e,"perfectWindow",zf,xt(e)),It(e,"goodWindow",Vf,xt(e)),It(e,"missWindow",Bf,xt(e)),It(e,"notePool",Hf,xt(e)),It(e,"nodeContainer",Uf,xt(e)),It(e,"nodeDistance",Gf,xt(e)),e.isPlaying=!1,e.timingWindows=new Map,e.currentLoop=0,e.lastBeatTime=0,e.songDuration=0,e.isAutoPlay=!1,e.scoringCallback=null,e.readyCallback=null,e.levelChangedCallback=null,e.startX=-500,e.endX=500,e.targetX=0,e.noteSpeed=0,e.noteDelay=0,e.currentLevel=0,e.currentLevelLoop=0,e.requiredNotes=0,e.currentNotes=0,e.isInDelay=!1,e.delayLoops=0,e.levelSequences=[],e.currentSequenceIndex=0,e.penaltyPatternLoops=0,e.activeNoteIds=[],e.noteSequence=[],e.currentSequenceNotes=[],e}Ot(e,t);var i=e.prototype;return i.onLoad=function(){this.timingWindows.set(Xf.PERFECT,this.perfectWindow),this.timingWindows.set(Xf.GOOD,this.goodWindow),this.timingWindows.set(Xf.MISS,this.missWindow),this.startX=this.startNode.position.x,this.endX=this.endNode.position.x,this.targetX=this.targetZone.position.x,this.updateSpeed(),this.movingBeatNote?(this.movingBeatNote.position=new g(this.startX,this.startNode.position.y,this.startNode.position.z),this.heartBeatSprite&&(this.heartBeatSprite.node.scale=new g(1,1,1))):console.error("No note assigned to AuditionBeatSystem!")},i.updateSpeed=function(){var t=this.endX-this.startX,e=6e4/this.bpm/1e3*this.beatsPerLoop;this.noteSpeed=t/e;var i=this.endX-this.targetX;this.noteDelay=i/t*e},i.getCurrentTime=function(){return Hd.instance.getCurrentTime()},i.update=function(t){if(this.isPlaying&&this.movingBeatNote&&Hd.instance){var e=this.getCurrentTime(),i=6e4/this.bpm,n=i*this.beatsPerLoop;e-this.lastBeatTime>=n+this.missWindow&&(this.lastBeatTime=Math.round(e/n)*n,this.currentLoop++,this.updateLevelSystem()),this.updateBeatNoteMoving(e),this.updateHeartBeatEffect(e,i,n),this.handleAutoPlay()}},i.initializeLevelSequences=function(){this.levelSequences=[{type:Qf.OFF,loop:3,notes:0},{type:Qf.LEVEL,loop:1,notes:1},{type:Qf.LEVEL,loop:1,notes:2},{type:Qf.LEVEL,loop:1,notes:3},{type:Qf.LEVEL,loop:1,notes:4},{type:Qf.LEVEL,loop:1,notes:5},{type:Qf.LEVEL,loop:4,notes:6,delay:1},{type:Qf.LEVEL,loop:4,notes:7,delay:1},{type:Qf.LEVEL,loop:4,notes:8,delay:1},{type:Qf.LEVEL,loop:4,notes:9,delay:1},{type:Qf.FINISH,loop:1,notes:9}]},i.startBeatSystem=function(t,e,i){var n=this;if(this.movingBeatNote){this.bpm=t,this.updateSpeed(),this.isPlaying=!0,this.songDuration=e,this.initializeLevelSequences(),this.currentSequenceIndex=0,this.currentLevel=0,this.currentNotes=0,this.penaltyPatternLoops=0,this.activeNoteIds=[],this.noteSequence=[];var o=Hd.instance;this.lastBeatTime=o?o.getCurrentTime():Date.now(),this.currentLoop=0;var r=tf.instance;r&&(r.registerInputCallback($d.SPACE,(function(t){return n.evaluateInput(t)})),r.registerInputCallback($d.LEFT,(function(t){return n.handleNoteInput(cf.LEFT,t)})),r.registerInputCallback($d.RIGHT,(function(t){return n.handleNoteInput(cf.RIGHT,t)}))),console.log("Beat system started with level sequences"),this.isInDelay=!1,this.delayLoops=0,this.currentLevelLoop=0,this.updateGameplayInteractableVisualize();var a=6e4/this.bpm/1e3*this.beatsPerLoop*4,s=Math.max(0,a-1);this.scheduleOnce((function(){n.readyCallback&&(n.readyCallback(),n.readyCallback=null)}),s)}},i.updateLevelSystem=function(){var t=this;if(this.noteSequence.length>0&&this.handleMiss(),this.clearLastNotes(),this.isInDelay)return this.delayLoops--,void(this.delayLoops<=0&&(this.isInDelay=!1));var e=function(e){t.isInPenalty&&t.penaltyPatternLoops--,t.startNextPattern(),e.delay&&(t.delayLoops=e.delay,t.isInDelay=!0)},i=this.levelSequences[this.currentSequenceIndex];if(this.currentLevelLoop>=i.loop){this.currentSequenceIndex++,this.currentSequenceIndex>=this.levelSequences.length&&(this.currentSequenceIndex=0,this.penaltyPatternLoops=0);var n=this.levelSequences[this.currentSequenceIndex];n.type===Qf.OFF?(this.delayLoops=n.loop,this.currentLevelLoop=n.loop,this.isInDelay=!0):n.type===Qf.LEVEL?(this.currentLevel=n.notes,this.currentLevelLoop=1,this.updateLevelTextNormal(this.currentLevel),this.levelChangedCallback&&this.levelChangedCallback(this.currentLevel,n.type),e(n)):n.type===Qf.FINISH&&(this.currentLevelLoop=1,e(n),this.updateLevelTextFinish())}else this.currentLevelLoop++,i.type===Qf.LEVEL&&e(i)},i.startNextPattern=function(){var t=this.levelSequences[this.currentSequenceIndex];this.requiredNotes=t.notes,this.currentNotes=0,this.noteSequence=[],this.currentSequenceNotes=[];for(var e=-this.nodeDistance*this.requiredNotes/2+this.nodeDistance/2,i=0;i<this.requiredNotes;i++){var n=Math.random()<.5?cf.LEFT:cf.RIGHT;this.noteSequence.push(n);var o=this.notePool.getNote(n),r=o.id,a=o.node;if(a.parent=this.nodeContainer,a){this.activeNoteIds.push(r);var s=a.getComponent(Yf);s.initialize(n,this.lastBeatTime,r),this.currentSequenceNotes.push(s),a.setPosition(new g(e+i*this.nodeDistance,0,0))}}this.updateGameplayInteractableVisualize()},i.updateLevelTextNormal=function(t){this.levelLabel&&(this.levelLabel.string="Level "+t.toString(),this.levelLabel.shadowColor=t<=3?new X(0,0,0,255):t<=6?new X(0,0,128,255):t<=9?new X(128,0,128,255):new X(178,34,34,255)),this.levelLabel&&(at.stopAllByTarget(this.levelLabel.node),this.levelLabel.node.setScale(new g(1.5,1.5,1)),v(this.levelLabel.node).to(.3,{scale:new g(1,1,1)},{easing:"bounceOut"}).start())},i.updateLevelTextFinish=function(){this.levelLabel&&(this.levelLabel.string="Finish Move",this.levelLabel.shadowColor=new X(255,165,0,255),at.stopAllByTarget(this.levelLabel.node),this.levelLabel.node.setScale(new g(1,1,1)),v(this.levelLabel.node).to(.5,{scale:new g(1.2,1.2,1)}).to(.5,{scale:new g(1,1,1)}).union().repeatForever().start())},i.handleNoteInput=function(t,e){this.isPlaying&&!this.isInPenalty&&(this.currentNotes>=this.noteSequence.length||(this.currentNotes<this.noteSequence.length&&this.noteSequence[this.currentNotes]===t?(this.currentSequenceNotes[this.currentNotes].playHitEffect(Xf.PERFECT),this.currentNotes++):(this.currentNotes=0,this.currentSequenceNotes.forEach((function(t){return t.reset()})))))},i.evaluateInput=function(t){if(this.isPlaying&&!this.isInPenalty&&(0!=this.noteSequence.length&&Hd.instance)){var e,i=this.getCurrentTime(),n=6e4/this.bpm*this.beatsPerLoop,o=(i-this.lastBeatTime)/n,r=Math.abs(1-o);e=r<=this.timingWindows.get(Xf.PERFECT)/n?Xf.PERFECT:r<=this.timingWindows.get(Xf.GOOD)/n?Xf.GOOD:Xf.MISS,this.isMiss()||e==Xf.MISS?this.handleMiss():this.handleScored(e)}},i.handleAutoPlay=function(){if(this.isAutoPlay&&this.isPlaying&&!this.isInPenalty){var t=this.getCurrentTime(),e=6e4/this.bpm*this.beatsPerLoop,i=(t-this.lastBeatTime)/e,n=Math.abs(1-i);if(this.noteSequence.length>0&&this.currentNotes<this.noteSequence.length){var o=tf.instance;if(o){var r=this.noteSequence[this.currentNotes];r===cf.LEFT?o.simulateInput($d.LEFT,t):r===cf.RIGHT&&o.simulateInput($d.RIGHT,t)}}if(n<=this.timingWindows.get(Xf.PERFECT)/e){var a=tf.instance;a&&a.simulateInput($d.SPACE,t)}}},i.clearLastNotes=function(){var t=this;this.activeNoteIds.forEach((function(e){return t.notePool.recycleNote(e)})),this.activeNoteIds=[],this.noteSequence=[],this.currentNotes=0},i.handleMiss=function(){this.isInPenalty||(this.penaltyPatternLoops=2,this.scoringCallback&&this.scoringCallback(Xf.MISS),this.updateGameplayInteractableVisualize())},i.handleScored=function(t){this.clearLastNotes(),this.scoringCallback&&this.scoringCallback(t)},i.isMiss=function(){return this.currentNotes<this.requiredNotes},i.updateBeatNoteMoving=function(t){var e=(t-this.lastBeatTime)/1e3-this.noteDelay,i=this.startX;i=e>0?this.startX+this.noteSpeed*e:this.endX+this.noteSpeed*e,this.movingBeatNote.position=new g(i,this.movingBeatNote.position.y,this.movingBeatNote.position.z)},i.updateHeartBeatEffect=function(t,e,i){if(this.heartBeatSprite){var n=t-this.lastBeatTime,o=t%e,r=n>i-.5*e&&n<i+.5*e?Math.max(1,2*(1-o/e)):1;this.heartBeatSprite.node.setScale(new g(r,1,1));var a=Math.max(.5,1-o/e),s=this.heartBeatSprite.color.clone();s.a=255*a,this.heartBeatSprite.color=s}},i.updateGameplayInteractableVisualize=function(){if(this.opacityGameplay){var t=!this.isInPenalty&&this.isPlaying;this.opacityGameplay.opacity=t?255:50}},i.stopBeatSystem=function(){var t=this;this.isPlaying=!1,this.isAutoPlay=!1;var e=tf.instance;e&&(e.unregisterInputCallback($d.SPACE,(function(e){return t.evaluateInput(e)})),e.unregisterInputCallback($d.LEFT,(function(e){return t.handleNoteInput(cf.LEFT,e)})),e.unregisterInputCallback($d.RIGHT,(function(e){return t.handleNoteInput(cf.RIGHT,e)}))),console.log("Beat system stopped")},i.setScoreCallback=function(t){this.scoringCallback=t},i.setReadyCallback=function(t){this.readyCallback=t},i.setLevelChangedCallback=function(t){this.levelChangedCallback=t},i.getBPM=function(){return this.bpm},i.setBPM=function(t){this.bpm=Math.max(60,Math.min(200,t)),console.log("BPM set to "+this.bpm)},i.getBeatsPerLoop=function(){return this.beatsPerLoop},i.setBeatsPerLoop=function(t){this.beatsPerLoop=Math.max(1,Math.min(8,t)),console.log("Beats per loop set to "+this.beatsPerLoop)},i.setAutoPlay=function(t){this.isAutoPlay=t,console.log("Auto-play "+(t?"enabled":"disabled"))},i.isAutoPlayEnabled=function(){return this.isAutoPlay},Nt(e,[{key:"isInPenalty",get:function(){return this.penaltyPatternLoops>0}}]),e}(r)).prototype,"movingBeatNote",[pf],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),If=Mt(Mf.prototype,"targetZone",[df],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),xf=Mt(Mf.prototype,"startNode",[ff],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Rf=Mt(Mf.prototype,"endNode",[gf],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Lf=Mt(Mf.prototype,"heartBeatSprite",[mf],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Nf=Mt(Mf.prototype,"opacityGameplay",[vf],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ff=Mt(Mf.prototype,"levelLabel",[yf],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Df=Mt(Mf.prototype,"bpm",[bf],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 120}}),kf=Mt(Mf.prototype,"beatsPerLoop",[_f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 4}}),zf=Mt(Mf.prototype,"perfectWindow",[Sf],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 50}}),Vf=Mt(Mf.prototype,"goodWindow",[wf],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 100}}),Bf=Mt(Mf.prototype,"missWindow",[Tf],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 200}}),Hf=Mt(Mf.prototype,"notePool",[Cf],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Uf=Mt(Mf.prototype,"nodeContainer",[Ef],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Gf=Mt(Mf.prototype,"nodeDistance",[Pf],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 65}}),Af=Mf))||Af);t._RF.pop(),t._RF.push({},"b36e0MayvRDhqtAvXGvTrjp","AuditionBeatmap",void 0);var $f,tg,eg=e.ccclass;e.property,eg("AuditionBeatmap")(qf=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).currentBeatmap=null,e}Ot(e,t);var i=e.prototype;return i.generateBeatmap=function(t,e,i,n){var o=this;return new Promise((function(r){for(var a=[],s=6e4/e*n,l=1e3,c=i-2e3;l<c;)a.push({time:l,type:2}),l+=s;var u={songId:t,bpm:e,offset:0,notes:a,difficulty:2,creator:"System",version:"1.0"};o.currentBeatmap=u,console.log("Beatmap generated successfully: "+u.songId),r(u)}))},i.getCurrentBeatmap=function(){return this.currentBeatmap},i.getNotesInTimeRange=function(t,e){return this.currentBeatmap&&this.currentBeatmap.notes?this.currentBeatmap.notes.filter((function(i){return i.time>=t&&i.time<=e})):[]},i.getNotesToSpawn=function(t,e){return this.getNotesInTimeRange(t,t+e)},i.getTotalNoteCount=function(){var t;return(null==(t=this.currentBeatmap)||null==(t=t.notes)?void 0:t.length)||0},e.getNoteTypeFromBeatNote=function(t){return cf.SPACE},e}(r));t._RF.pop(),t._RF.push({},"5d9e2TkgsBGdK4Et+YVimdr","AuditionCharacterAnimationData",void 0);var ig,ng,og,rg,ag,sg,lg,cg,ug,hg,pg=e.ccclass,dg=(e.property,function(t){return t.FIRST_STAND="first_stand",t.LAST_STAND="last_stand",t.BOY_START="boy_start",t.GIRL_START="girl_start",t.DANCE_START="dance_start",t.DANCE_END="dance_end",t.BOY_WIN="boy_win",t.BOY_LOSE="boy_lose",t.GIRL_WIN="girl_win",t.GIRL_LOSE="girl_lose",t.END1="end1",t.END2="end2",t.END3="end3",t.END4="end4",t.MISS="miss",t}({})),fg=pg("AuditionCharacterAnimationData")(((tg=function(){function t(){}return t.initialize=function(){this.specialStates.clear(),this.danceStates.clear(),this.currentSequence=[],this.initializeSpecialStates()},t.initializeSpecialStates=function(){this.specialStates.set(dg.FIRST_STAND,{speed:1,motion:"first_stand",transitions:[{srcState:"first_stand",destState:"boy_start",transitionDuration:.2,transitionOffset:0,exitTime:.9}],isLooping:!1}),this.specialStates.set(dg.LAST_STAND,{speed:1,motion:"last_stand",transitions:[],isLooping:!0}),this.specialStates.set(dg.BOY_START,{speed:1,motion:"boy_start",transitions:[{srcState:"boy_start",destState:"dance_start",transitionDuration:.2,transitionOffset:0,exitTime:.9}],isLooping:!1}),this.specialStates.set(dg.GIRL_START,{speed:1,motion:"girl_start",transitions:[{srcState:"girl_start",destState:"dance_start",transitionDuration:.2,transitionOffset:0,exitTime:.9}],isLooping:!1}),this.specialStates.set(dg.DANCE_START,{speed:1,motion:"dance_start",transitions:[{srcState:"dance_start",destState:"default_dance",transitionDuration:.2,transitionOffset:0,exitTime:.9}],isLooping:!1}),this.specialStates.set(dg.DANCE_END,{speed:1,motion:"dance_end",transitions:[],isLooping:!1}),this.specialStates.set(dg.BOY_WIN,{speed:1,motion:"boy_win",transitions:[{srcState:"boy_win",destState:"last_stand",transitionDuration:.2,transitionOffset:0,exitTime:.9}],isLooping:!1}),this.specialStates.set(dg.BOY_LOSE,{speed:1,motion:"boy_lose",transitions:[{srcState:"boy_lose",destState:"last_stand",transitionDuration:.2,transitionOffset:0,exitTime:.9}],isLooping:!1}),this.specialStates.set(dg.GIRL_WIN,{speed:1,motion:"girl_win",transitions:[{srcState:"girl_win",destState:"last_stand",transitionDuration:.2,transitionOffset:0,exitTime:.9}],isLooping:!1}),this.specialStates.set(dg.GIRL_LOSE,{speed:1,motion:"girl_lose",transitions:[{srcState:"girl_lose",destState:"last_stand",transitionDuration:.2,transitionOffset:0,exitTime:.9}],isLooping:!1}),this.specialStates.set(dg.MISS,{speed:1,motion:"miss",transitions:[],isLooping:!1})},t.loadDanceData=function(t){var e=this;return new Promise((function(i,n){Je.loadRes("audition/dances/"+t,st,(function(t,o){if(t)return console.error("Failed to load dance data:",t),void n(t);e.parseDanceData(o.text),i()}))}))},t.parseDanceData=function(t){var e=this,i=t.split("\n"),n="",o=[];this.beginDanceState="";for(var r=0;r<i.length;r++){var a=i[r].trim();if(a)if(a.startsWith("DefaultState:"))this.defaultState=a.split(":")[1].trim();else if(a.startsWith("[")&&a.endsWith("]")){var s=Array.from(this.specialStates.keys()).some((function(t){return e.specialStates.get(t).motion===n}));n&&!s&&(this.saveState(n,o),o=[]),n=a.slice(1,-1).trim()}else if(n){var l=Array.from(this.specialStates.keys()).some((function(t){return e.specialStates.get(t).motion===n}));if(a.startsWith("Speed:")){var c=parseFloat(a.split(":")[1].trim());l?this.updateSpecialStateSpeed(n,c):this.updateStateSpeed(n,c)}else if(a.startsWith("Motion:")){var u=a.split(":")[1].trim();l?this.updateSpecialStateMotion(n,u):(this.updateStateMotion(n,u),this.beginDanceState||this.specialStates.has(u)||(this.beginDanceState=n))}else if(a.startsWith("Transition:")){var h=this.parseTransition(i,r);h&&(l?this.updateSpecialStateTransitions(n,h):o.push(h))}else if(a.startsWith("IsLooping:")){var p="true"===a.split(":")[1].trim().toLowerCase();l?this.updateSpecialStateLooping(n,p):this.updateStateLooping(n,p)}else if(a.startsWith("NextState:")){var d=a.split(":")[1].trim();l||this.updateStateNext(n,d)}}}this.buildDanceSequence(),console.log("Loaded "+this.danceStates.size+" dance states")},t.buildDanceSequence=function(){this.currentSequence=[];for(var t=this.defaultState;t;){this.currentSequence.push(t);var e=this.danceStates.get(t);if(!e||!e.nextState)break;t=e.nextState}},t.getAllDanceStates=function(){return Array.from(this.danceStates.values())},t.parseTransition=function(t,e){for(var i={srcState:"",destState:"",transitionDuration:0,transitionOffset:0,exitTime:0},n=e+1;n<t.length&&t[n].startsWith("\t");){var o=t[n].trim();if(o.startsWith("SrcState:"))i.srcState=o.split(":")[1].trim();else if(o.startsWith("DestState:"))i.destState=o.split(":")[1].trim();else if(o.startsWith("TransitionDuration:"))i.transitionDuration=parseFloat(o.split(":")[1].trim());else if(o.startsWith("TransitionOffset:"))i.transitionOffset=parseFloat(o.split(":")[1].trim());else if(o.startsWith("ExitTime:"))i.exitTime=parseFloat(o.split(":")[1].trim());else if(o.startsWith("Condition:")){var r=o.split(":")[1].trim();i.condition=this.parseCondition(r)}n++}return i},t.parseCondition=function(t){return new Function("combo","accuracy","return "+t)},t.saveState=function(t,e){var i=this.danceStates.get(t)||{speed:1,motion:t,transitions:[],isLooping:!1};i.transitions=e,this.danceStates.set(t,i)},t.updateStateSpeed=function(t,e){var i=this.danceStates.get(t)||{speed:1,motion:t,transitions:[],isLooping:!1};i.speed=e,this.danceStates.set(t,i)},t.updateStateMotion=function(t,e){var i=this.danceStates.get(t)||{speed:1,motion:t,transitions:[],isLooping:!1};i.motion=e,this.danceStates.set(t,i)},t.updateStateLooping=function(t,e){var i=this.danceStates.get(t)||{speed:1,motion:t,transitions:[],isLooping:!1};i.isLooping=e,this.danceStates.set(t,i)},t.updateStateNext=function(t,e){var i=this.danceStates.get(t)||{speed:1,motion:t,transitions:[],isLooping:!1};i.nextState=e,this.danceStates.set(t,i)},t.getDanceState=function(t){return this.danceStates.get(t)||null},t.getDefaultState=function(){return this.defaultState},t.getBeginDanceState=function(){return this.beginDanceState},t.getSpecialState=function(t){return this.specialStates.get(t)||null},t.getDanceSequence=function(){return[].concat(this.currentSequence)},t.getAllAnimationNames=function(){var t=Array.from(this.danceStates.keys()),e=Array.from(this.specialStates.values()).map((function(t){return t.motion}));return t.concat(e)},t.updateSpecialStateSpeed=function(t,e){for(var i,n=Ft(this.specialStates.entries());!(i=n()).done;){var o=i.value,r=o[0],a=o[1];if(a.motion===t){a.speed=e,this.specialStates.set(r,a);break}}},t.updateSpecialStateMotion=function(t,e){for(var i,n=Ft(this.specialStates.entries());!(i=n()).done;){var o=i.value,r=o[0],a=o[1];if(a.motion===t){a.motion=e,this.specialStates.set(r,a);break}}},t.updateSpecialStateTransitions=function(t,e){for(var i,n=Ft(this.specialStates.entries());!(i=n()).done;){var o=i.value,r=o[0],a=o[1];if(a.motion===t){a.transitions.push(e),this.specialStates.set(r,a);break}}},t.updateSpecialStateLooping=function(t,e){for(var i,n=Ft(this.specialStates.entries());!(i=n()).done;){var o=i.value,r=o[0],a=o[1];if(a.motion===t){a.isLooping=e,this.specialStates.set(r,a);break}}},t}()).specialStates=new Map,tg.danceStates=new Map,tg.defaultState="",tg.beginDanceState="",tg.currentSequence=[],$f=tg))||$f;t._RF.pop(),t._RF.push({},"1e7b6TmLYNOJqHH2ZZSRUXY","AuditionCharacterAnimation",void 0);var gg,mg,vg,yg,bg,_g,Sg,wg,Tg,Cg,Eg,Pg,Ag=e.ccclass,Mg=e.property,Og=(ig=Ag("AuditionCharacterAnimation"),ng=Mg(c),og=Mg(it),ig((sg=Mt((ag=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,It(e,"character",sg,xt(e)),It(e,"animationController",lg,xt(e)),It(e,"transitionDuration",cg,xt(e)),It(e,"comboThreshold",ug,xt(e)),It(e,"inputHistorySize",hg,xt(e)),e.currentCombo=0,e.inputHistory=[],e.isMale=!0,e.animMap=new Map,e.animNames=[],e.allDanceStates=[],e.currentDanceIndex=0,e.musicSpeed=1,e}Ot(e,t);var i=e.prototype;return i.loadDanceData=function(t){var e=this;return!this.animationController&&this.character&&(this.animationController=this.character.getComponent(it)),new Promise((function(i,n){fg.initialize();var o=t+"_Dance";fg.loadDanceData(o).then((function(){return e.animNames=fg.getAllAnimationNames(),console.log("Animation names to be loaded:"),e.animNames.forEach((function(t,e){console.log(e+1+". "+t)})),console.log("Loading "+e.animNames.length+" dance animations for song: "+t),e.loadDanceAnims(e.animNames)})).then((function(t){console.log("Successfully loaded "+t.length+" dance animations"),e.setClips(t,e.animNames),e.allDanceStates=fg.getAllDanceStates(),e.currentDanceIndex=-1,e.playSpecialAnimation(dg.FIRST_STAND),i("success")})).catch((function(t){console.error("Failed to load dance: "+t),n(t)}))}))},i.setClips=function(t,e){for(var i=0;i<t.length;i++){var n=t[i],o=e[i];this.animationController.createState(n,o)}},i.testLoadDanceAnim=function(){this.loadDanceAnim("Breakdance")},i.loadDanceAnims=function(){var t=Rt(Lt().mark((function t(e){var i,n,o,r,a;return Lt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:for(i=[],n=Ft(e);!(o=n()).done;)r=o.value,i.push(this.loadDanceAnim(r));return t.prev=2,t.next=5,Promise.all(i);case 5:return a=t.sent,t.abrupt("return",a);case 9:throw t.prev=9,t.t0=t.catch(2),console.error("Failed to load multiple dance animations:",t.t0),t.t0;case 13:case"end":return t.stop()}}),t,this,[[2,9]])})));return function(e){return t.apply(this,arguments)}}(),i.loadDanceAnim=function(){var t=Rt(Lt().mark((function t(e){var i=this;return Lt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t,n){Je.loadRes("audition/anims/"+e,l,(function(o,r){if(o)return console.error("Failed to load character as  nimation prefab:",o),void n(o);try{var a=E(r),s=a.getComponent(lt);if(!s)return console.error("No SkeletalAnimation component found in prefab: "+e),a.destroy(),void n(new Error("Missing SkeletalAnimation component"));var l=s.defaultClip;if(!l)return console.error("No animation clips found in prefab: "+e),a.destroy(),void n(new Error("No animation clips found"));a.destroy(),console.log("Successfully loaded and setup animation prefab: "+e),l.name=e,i.animMap.set(e,l),t(l)}catch(t){console.error("Error processing animation prefab:",t),n(t)}}))})));case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),i.setGender=function(t){this.isMale=t},i.reactToInput=function(t,e){if(console.log("reactToInput: "+t+" "+e),this.currentCombo=e,this.recordInput(t),t===Xf.MISS)return this.playMissAnimation(),void this.nextDanceState();this.playNextDanceState()},i.nextDanceState=function(){this.currentDanceIndex=++this.currentDanceIndex%this.allDanceStates.length},i.playNextDanceState=function(){this.nextDanceState();var t=this.allDanceStates[this.currentDanceIndex].transitions[0].srcState;this.playAnimation(t,this.allDanceStates[this.currentDanceIndex],1)},i.playSpecialAnimation=function(t,e){var i=fg.getSpecialState(t);i?this.playAnimation(i.motion,i,i.speed,e):console.error("Special animation state not found: "+t)},i.playMissAnimation=function(){var t=fg.getSpecialState(dg.MISS);this.playAnimation(t.motion,t,t.speed)},i.setMusicSpeed=function(t){this.musicSpeed=t/100},i.playAnimation=function(t,e,i,n){if(void 0===i&&(i=1),this.animationController){var o=this.animationController.getState(t);if(o){if(o.speed=i*this.musicSpeed,e&&e.transitions&&e.transitions.length>0){var r=e.transitions[0].exitTime||.95;this.animationController.crossFade(t,r)}else this.animationController.crossFade(t,.3);n&&o.on("finished",n,this)}else console.error("Animation state not found: "+t)}},i.recordInput=function(t){this.inputHistory.push({accuracyRating:t,timestamp:Date.now()}),this.inputHistory.length>this.inputHistorySize&&this.inputHistory.shift()},i.endDanceSequence=function(t){var e,i=this;e=this.isMale?t?dg.END2:dg.END1:t?dg.END4:dg.END3,this.playSpecialAnimation(e,(function(){i.playSpecialAnimation(dg.LAST_STAND)}))},i.resetToIdle=function(){this.currentCombo=0,this.inputHistory=[],this.playSpecialAnimation(dg.FIRST_STAND)},e}(r)).prototype,"character",[ng],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),lg=Mt(ag.prototype,"animationController",[og],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),cg=Mt(ag.prototype,"transitionDuration",[Mg],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.2}}),ug=Mt(ag.prototype,"comboThreshold",[Mg],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 10}}),hg=Mt(ag.prototype,"inputHistorySize",[Mg],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 20}}),rg=ag))||rg);t._RF.pop(),t._RF.push({},"2ce00HNOcFEMZsuE2WXEEkB","AuditionScoringSystem",void 0);var Ig,xg,Rg,Lg,Ng,Fg,Dg,kg,zg,Vg,Bg,Hg,Ug,Gg,Wg,Zg,Yg,qg,jg,Kg,Xg,Qg,Jg,$g,tm,em,im,nm,om,rm,am,sm,lm,cm,um,hm,pm,dm,fm,gm,mm,vm,ym=e.ccclass,bm=e.property,_m=ym("AuditionScoringSystem")((vg=Mt((mg=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,It(e,"perfectScore",vg,xt(e)),It(e,"goodScore",yg,xt(e)),It(e,"missScore",bg,xt(e)),It(e,"comboMultiplierIncrement",_g,xt(e)),It(e,"maxComboMultiplier",Sg,xt(e)),It(e,"comboBreakPenalty",wg,xt(e)),It(e,"patternComplexityMultiplier",Tg,xt(e)),It(e,"consecutivePatternBonus",Cg,xt(e)),It(e,"finishMoveMultiplier",Eg,xt(e)),It(e,"patternSkipPenalty",Pg,xt(e)),e.patternsCompleted=0,e.consecutivePatterns=0,e.finishMovesCompleted=0,e.patternsSkipped=0,e.totalScore=0,e.currentCombo=0,e.maxCombo=0,e.patternMultiplier=1,e.accuracyStats={perfect:0,good:0,miss:0,total:0},e.onScoreUpdateCallback=null,e.onComboUpdateCallback=null,e.onPatternMultiplierUpdateCallback=null,e}Ot(e,t);var i=e.prototype;return i.reset=function(){this.totalScore=0,this.currentCombo=0,this.maxCombo=0,this.patternMultiplier=1,this.patternsCompleted=0,this.consecutivePatterns=0,this.finishMovesCompleted=0,this.patternsSkipped=0,this.accuracyStats={perfect:0,good:0,miss:0,total:0},this.onScoreUpdateCallback&&this.onScoreUpdateCallback(this.totalScore),this.onComboUpdateCallback&&this.onComboUpdateCallback(this.currentCombo),this.onPatternMultiplierUpdateCallback&&this.onPatternMultiplierUpdateCallback(this.patternMultiplier),console.log("Scoring system reset")},i.processNoteResult=function(t,e){this.accuracyStats.total++;var i=0;switch(t){case Xf.PERFECT:this.accuracyStats.perfect++,i=this.perfectScore,this.updateCombo(!0);var n=1===this.currentCombo?"perfect":"perfect"+Math.min(this.currentCombo,5);Hd.instance.playSound(n);break;case Xf.GOOD:this.accuracyStats.good++,i=this.goodScore,this.updateCombo(!1),Hd.instance.playSound("good");break;case Xf.MISS:this.accuracyStats.miss++,i=this.missScore,this.updateCombo(!1),Hd.instance.playSound("miss")}var o=1+Math.min(this.maxComboMultiplier-1,this.comboMultiplierIncrement*(this.currentCombo-1)),r=t===Xf.MISS?i:Math.floor(i*o);this.totalScore+=r,this.onScoreUpdateCallback&&this.onScoreUpdateCallback(this.totalScore),console.log("Note result: "+Xf[t]+", Score: "+this.totalScore+", Combo: "+this.currentCombo+", Points earned: "+r)},i.processPatternResult=function(t,e,i){if(t===Xf.MISS)return this.patternsSkipped++,this.consecutivePatterns=0,this.resetPatternMultiplier(),this.totalScore=Math.max(0,this.totalScore-this.patternSkipPenalty),void console.log("Pattern missed! Score: "+this.totalScore+", Skipped: "+this.patternsSkipped);var n=50*e;t===Xf.PERFECT&&(n*=1.5);var o=Math.floor(n*this.patternMultiplier);if(this.patternsCompleted++,this.consecutivePatterns++,i){this.finishMovesCompleted++;var r=Math.floor(o*(this.finishMoveMultiplier-1));this.totalScore+=o+r,console.log("Finish move completed! Base: "+o+", Bonus: "+r)}else if(this.totalScore+=o,this.consecutivePatterns>1){var a=this.consecutivePatternBonus*(this.consecutivePatterns-1);this.totalScore+=a,console.log("Consecutive pattern bonus: +"+a)}this.increasePatternMultiplier(),this.onScoreUpdateCallback&&this.onScoreUpdateCallback(this.totalScore),console.log("Pattern completed! Complexity: "+e+", Score added: "+o+", Total: "+this.totalScore+", Pattern multiplier: "+this.patternMultiplier.toFixed(1)+"x")},i.updateCombo=function(t){t?(this.currentCombo++,this.currentCombo>this.maxCombo&&(this.maxCombo=this.currentCombo)):(this.comboBreakPenalty>0&&(this.totalScore=Math.max(0,this.totalScore-this.comboBreakPenalty)),this.currentCombo=0),this.onComboUpdateCallback&&this.onComboUpdateCallback(this.currentCombo)},i.onScoreUpdate=function(t){this.onScoreUpdateCallback=t},i.onComboUpdate=function(t){this.onComboUpdateCallback=t},i.onPatternMultiplierUpdate=function(t){this.onPatternMultiplierUpdateCallback=t},i.increasePatternMultiplier=function(){this.patternMultiplier+=.1,this.onPatternMultiplierUpdateCallback&&this.onPatternMultiplierUpdateCallback(this.patternMultiplier)},i.resetPatternMultiplier=function(){this.patternMultiplier=1,this.onPatternMultiplierUpdateCallback&&this.onPatternMultiplierUpdateCallback(this.patternMultiplier)},i.handlePatternBreak=function(){this.consecutivePatterns=0,this.resetPatternMultiplier(),this.updateCombo(!1)},i.getScore=function(){return this.totalScore},i.getCombo=function(){return this.currentCombo},i.getMaxCombo=function(){return this.maxCombo},i.getAccuracyStats=function(){return Dt({},this.accuracyStats)},i.getAccuracyPercentage=function(){return 0===this.accuracyStats.total?0:(1*this.accuracyStats.perfect+.5*this.accuracyStats.good+0*this.accuracyStats.miss)/this.accuracyStats.total*100},i.getGrade=function(){var t=this.getAccuracyPercentage();return t>=95?"S":t>=90?"A":t>=80?"B":t>=70?"C":t>=60?"D":"F"},i.calculateExperiencePoints=function(){return Math.floor(this.totalScore/100)+Math.floor(this.getAccuracyPercentage()/10)+Math.floor(this.maxCombo/10)+2*this.patternsCompleted+10*this.finishMovesCompleted},i.getPatternStats=function(){return{completed:this.patternsCompleted,skipped:this.patternsSkipped,finishMoves:this.finishMovesCompleted}},e}(r)).prototype,"perfectScore",[bm],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 100}}),yg=Mt(mg.prototype,"goodScore",[bm],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 50}}),bg=Mt(mg.prototype,"missScore",[bm],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),_g=Mt(mg.prototype,"comboMultiplierIncrement",[bm],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.1}}),Sg=Mt(mg.prototype,"maxComboMultiplier",[bm],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 3}}),wg=Mt(mg.prototype,"comboBreakPenalty",[bm],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Tg=Mt(mg.prototype,"patternComplexityMultiplier",[bm],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.2}}),Cg=Mt(mg.prototype,"consecutivePatternBonus",[bm],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 50}}),Eg=Mt(mg.prototype,"finishMoveMultiplier",[bm],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 2}}),Pg=Mt(mg.prototype,"patternSkipPenalty",[bm],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 100}}),gg=mg))||gg;t._RF.pop(),t._RF.push({},"04144GbENxMebPIzsW6q1M6","AuditionUIManager",void 0);var Sm,wm,Tm,Cm,Em,Pm,Am,Mm,Om,Im,xm,Rm,Lm,Nm,Fm,Dm,km,zm,Vm,Bm,Hm,Um,Gm=e.ccclass,Wm=e.property,Zm=function(t){return t[t.MAIN_MENU=0]="MAIN_MENU",t[t.SONG_SELECTION=1]="SONG_SELECTION",t[t.GAMEPLAY=2]="GAMEPLAY",t[t.RESULTS=3]="RESULTS",t[t.SETTINGS=4]="SETTINGS",t}(Zm||{}),Ym=function(t){return t[t.PERFECT=0]="PERFECT",t[t.GREAT=1]="GREAT",t[t.COOL=2]="COOL",t[t.MISS=3]="MISS",t}({}),qm=(Ig=Gm("AuditionUIManager"),xg=Wm({type:c,group:{name:"UI Screens",id:"screens"}}),Rg=Wm({type:c,group:{name:"UI Screens",id:"screens"}}),Lg=Wm({type:c,group:{name:"UI Screens",id:"screens"}}),Ng=Wm({type:c,group:{name:"UI Screens",id:"screens"}}),Fg=Wm({type:c,group:{name:"UI Screens",id:"screens"}}),Dg=Wm({type:y,group:{name:"Gameplay UI",id:"gameplay"}}),kg=Wm({type:y,group:{name:"Gameplay UI",id:"gameplay"}}),zg=Wm({type:f,group:{name:"Gameplay UI",id:"gameplay"}}),Vg=Wm({type:it,group:{name:"Gameplay UI",id:"gameplay"}}),Bg=Wm({type:y,group:{name:"Results UI",id:"results"}}),Hg=Wm({type:y,group:{name:"Results UI",id:"results"}}),Ug=Wm({type:y,group:{name:"Results UI",id:"results"}}),Gg=Wm({type:y,group:{name:"Results UI",id:"results"}}),Wg=Wm({type:y,group:{name:"Song Info",id:"songInfo"}}),Zg=Wm({type:y,group:{name:"Song Info",id:"songInfo"}}),Yg=Wm({type:y,group:{name:"Song Info",id:"songInfo"}}),qg=Wm({type:[c],tooltip:"Feedback animation nodes in order: perfect, good, cool, miss"}),jg=Wm(ct),Kg=Wm({type:it,group:{name:"Feedback",id:"feedback"}}),Ig(((vm=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,It(e,"mainMenuScreen",Jg,xt(e)),It(e,"songSelectionScreen",$g,xt(e)),It(e,"gameplayScreen",tm,xt(e)),It(e,"resultsScreen",em,xt(e)),It(e,"settingsScreen",im,xt(e)),It(e,"scoreLabel",nm,xt(e)),It(e,"comboCountLabel",om,xt(e)),It(e,"progressBar",rm,xt(e)),It(e,"readyGoAnimation",am,xt(e)),It(e,"finalScoreLabel",sm,xt(e)),It(e,"accuracyLabel",lm,xt(e)),It(e,"maxComboLabel",cm,xt(e)),It(e,"gradeLabel",um,xt(e)),It(e,"songNameLabel",hm,xt(e)),It(e,"artistNameLabel",pm,xt(e)),It(e,"bpmLabel",dm,xt(e)),It(e,"feedbackNodes",fm,xt(e)),It(e,"particleSystemPerfectFragments",gm,xt(e)),It(e,"animScoreFeedBacks",mm,xt(e)),e.currentUIState=Zm.MAIN_MENU,e.feedbackTween=null,e.comboTween=null,e.feedbackAnimNames=["perfect","great","cool","miss"],e}Ot(e,t);var i=e.prototype;return i.onLoad=function(){null===e._instance?e._instance=this:this.node.destroy()},i.showMainMenu=function(){this.hideAllScreens(),this.mainMenuScreen&&(this.mainMenuScreen.active=!0,this.currentUIState=Zm.MAIN_MENU),console.log("Showing main menu")},i.showSongSelection=function(){this.hideAllScreens(),this.songSelectionScreen&&(this.songSelectionScreen.active=!0,this.currentUIState=Zm.SONG_SELECTION),console.log("Showing song selection")},i.showGameplay=function(t){this.hideAllScreens(),this.gameplayScreen&&(this.gameplayScreen.active=!0,this.currentUIState=Zm.GAMEPLAY),console.log("Showing gameplay"),this.songNameLabel&&(this.songNameLabel.string=t.title),this.artistNameLabel&&(this.artistNameLabel.string=t.artist),this.bpmLabel&&(this.bpmLabel.string=t.bpm.toString()+" BPM")},i.showResults=function(){this.hideAllScreens(),this.resultsScreen&&(this.resultsScreen.active=!0,this.currentUIState=Zm.RESULTS),console.log("Showing results")},i.showSettings=function(){this.hideAllScreens(),this.settingsScreen&&(this.settingsScreen.active=!0,this.currentUIState=Zm.SETTINGS),console.log("Showing settings")},i.hideAllScreens=function(){this.mainMenuScreen&&(this.mainMenuScreen.active=!1),this.songSelectionScreen&&(this.songSelectionScreen.active=!1),this.gameplayScreen&&(this.gameplayScreen.active=!1),this.resultsScreen&&(this.resultsScreen.active=!1),this.settingsScreen&&(this.settingsScreen.active=!1)},i.updateScore=function(t){this.scoreLabel&&(this.scoreLabel.string=this.formatNumberWithZeros(t,8))},i.updateCombo=function(t){this.comboCountLabel&&(this.comboCountLabel.string="x"+t.toString(),this.comboCountLabel.node.active=t>1)},i.updateProgress=function(t){this.progressBar&&(this.progressBar.fillRange=Math.max(0,Math.min(1,t)))},i.playReadyGoAnimation=function(){this.readyGoAnimation.node.active=!0,this.readyGoAnimation.play(),Hd.instance.playSound("s_ready"),this.scheduleOnce((function(){Hd.instance.playSound("s_go")}),1)},i.updateResults=function(t,e,i,n){this.finalScoreLabel&&(this.finalScoreLabel.string=this.formatNumberWithZeros(t,8)),this.accuracyLabel&&(this.accuracyLabel.string=e.toFixed(2)+"%"),this.maxComboLabel&&(this.maxComboLabel.string=""+i),this.gradeLabel&&(this.gradeLabel.string=n,this.setGradeColor(n))},i.setGradeColor=function(t){switch(t){case"S":this.gradeLabel.color=new X(255,215,0,255);break;case"A":this.gradeLabel.color=new X(0,191,255,255);break;case"B":this.gradeLabel.color=new X(50,205,50,255);break;case"C":this.gradeLabel.color=new X(255,165,0,255);break;case"D":this.gradeLabel.color=new X(255,69,0,255);break;case"F":this.gradeLabel.color=new X(128,128,128,255)}},i.formatNumberWithZeros=function(t,e){for(var i=t.toString();i.length<e;)i="0"+i;return i},i.getCurrentUIState=function(){return this.currentUIState},i.showFeedback=function(t){for(var e,i=Ft(this.feedbackNodes);!(e=i()).done;){e.value.active=!1}this.feedbackNodes[t]&&(this.feedbackNodes[t].active=!0);var n=this.feedbackAnimNames[t];this.animScoreFeedBacks.play(n)},Nt(e,[{key:"perfectAnimNode",get:function(){return this.feedbackNodes[0]}},{key:"goodNode",get:function(){return this.feedbackNodes[1]}},{key:"coolNode",get:function(){return this.feedbackNodes[2]}},{key:"missNode",get:function(){return this.feedbackNodes[3]}}],[{key:"instance",get:function(){return this._instance}}]),e}(r))._instance=null,Jg=Mt((Qg=vm).prototype,"mainMenuScreen",[xg],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),$g=Mt(Qg.prototype,"songSelectionScreen",[Rg],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),tm=Mt(Qg.prototype,"gameplayScreen",[Lg],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),em=Mt(Qg.prototype,"resultsScreen",[Ng],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),im=Mt(Qg.prototype,"settingsScreen",[Fg],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),nm=Mt(Qg.prototype,"scoreLabel",[Dg],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),om=Mt(Qg.prototype,"comboCountLabel",[kg],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),rm=Mt(Qg.prototype,"progressBar",[zg],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),am=Mt(Qg.prototype,"readyGoAnimation",[Vg],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),sm=Mt(Qg.prototype,"finalScoreLabel",[Bg],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),lm=Mt(Qg.prototype,"accuracyLabel",[Hg],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),cm=Mt(Qg.prototype,"maxComboLabel",[Ug],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),um=Mt(Qg.prototype,"gradeLabel",[Gg],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),hm=Mt(Qg.prototype,"songNameLabel",[Wg],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),pm=Mt(Qg.prototype,"artistNameLabel",[Zg],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),dm=Mt(Qg.prototype,"bpmLabel",[Yg],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),fm=Mt(Qg.prototype,"feedbackNodes",[qg],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),gm=Mt(Qg.prototype,"particleSystemPerfectFragments",[jg],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),mm=Mt(Qg.prototype,"animScoreFeedBacks",[Kg],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Xg=Qg))||Xg);t._RF.pop(),t._RF.push({},"88430rgcWxFCqXyHcVl7nDY","AuditionGameplayController",void 0);var jm,Km,Xm,Qm,Jm,$m,tv,ev,iv,nv,ov,rv,av,sv,lv,cv,uv,hv,pv,dv,fv,gv,mv,vv,yv,bv,_v,Sv,wv,Tv,Cv,Ev,Pv,Av,Mv,Ov,Iv,xv,Rv,Lv,Nv,Fv,Dv,kv=function(t){return t[t.INIT=0]="INIT",t[t.PLAYING=1]="PLAYING",t[t.PAUSED=2]="PAUSED",t[t.GAME_OVER=3]="GAME_OVER",t}(kv||{}),zv=e.ccclass,Vv=e.property,Bv=(Sm=zv("AuditionGameplayController"),wm=Vv(Jf),Tm=Vv(_m),Cm=Vv(Og),Em=Vv(N),Pm=Vv(c),Am=Vv(N),Mm=Vv(N),Om=Vv(N),Im=Vv(ut),Sm(((Um=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,It(e,"beatSystem",Lm,xt(e)),It(e,"scoringSystem",Nm,xt(e)),It(e,"characterAnimation",Fm,xt(e)),It(e,"pauseButton",Dm,xt(e)),It(e,"pauseMenu",km,xt(e)),It(e,"resumeButton",zm,xt(e)),It(e,"restartButton",Vm,xt(e)),It(e,"quitButton",Bm,xt(e)),It(e,"songProgressBar",Hm,xt(e)),e.gameState=kv.INIT,e.songStartTime=0,e.songDuration=0,e.notesProcessed=0,e.currentSong=null,e.availableSongs=[{id:"song0211",title:"삐딱하게 (Crooked)",artist:"G-Dragon",difficulty:3,bpm:130,audioPath:"song0211",previewStart:3e4,previewEnd:45e3},{id:"song0502",title:"Growl",artist:"EXO",difficulty:2,bpm:90,audioPath:"song0502",previewStart:25e3,previewEnd:4e4}],e}Ot(e,t);var i=e.prototype;return i.getAvailableSongs=function(){return this.availableSongs},i.getUnlockedSongs=function(){return this.availableSongs},i.getHighScore=function(t){return 0},i.isSongUnlocked=function(t){return!0},i.onLoad=function(){null===e._instance?e._instance=this:this.node.destroy()},i.start=function(){if(this.setupButtonEvents(),this.scoringSystem&&(this.scoringSystem.reset(),this.scoringSystem.onScoreUpdate(this.updateScoreDisplay.bind(this)),this.scoringSystem.onComboUpdate(this.updateComboDisplay.bind(this)),this.beatSystem.setScoreCallback(this.onScoringProcessed.bind(this))),this.characterAnimation&&this.characterAnimation.resetToIdle(),this.availableSongs&&this.availableSongs.length>0){var t=Math.floor(Math.random()*this.availableSongs.length),e=this.availableSongs[t];this.startSong(e.id),console.log("Starting random song: "+e.id)}else console.error("No available songs found")},i.startSong=function(t){this.gameState=kv.INIT,console.log("Starting song: "+t);var e=this.availableSongs.find((function(e){return e.id===t}));e?(this.currentSong=e,this.initGameplay(),qm.instance.showGameplay(this.currentSong)):console.error("Song with id "+t+" not found")},i.initGameplay=function(){var t=this,e=Hd.instance;e&&this.beatSystem?this.currentSong?Promise.all([e.loadSong(this.currentSong.audioPath),this.characterAnimation.loadDanceData(this.currentSong.id)]).then((function(i){i[0],i[1];return console.log("Song and dance data loaded successfully"),t.songDuration=e.getDuration(),t.characterAnimation.setMusicSpeed(t.currentSong.bpm),t.startGameplay(),t.songDuration})).catch((function(t){throw console.error("Failed to load song or dance data:",t),t})):console.error("No song selected"):console.error("Required components not found")},i.startGameplay=function(){this.beatSystem.setReadyCallback((function(){qm.instance.playReadyGoAnimation()})),this.songStartTime=Date.now(),Hd.instance.playSong(),this.beatSystem.startBeatSystem(this.currentSong.bpm,this.songDuration),this.gameState=kv.PLAYING,console.log("Gameplay started")},i.setupButtonEvents=function(){this.pauseButton&&this.pauseButton.node.on(N.EventType.CLICK,this.onPauseButtonClicked,this),this.resumeButton&&this.resumeButton.node.on(N.EventType.CLICK,this.onResumeButtonClicked,this),this.restartButton&&this.restartButton.node.on(N.EventType.CLICK,this.onRestartButtonClicked,this),this.quitButton&&this.quitButton.node.on(N.EventType.CLICK,this.onQuitButtonClicked,this),this.pauseMenu&&(this.pauseMenu.active=!1)},i.update=function(t){if(this.gameState===kv.PLAYING){this.updateProgressBar();var e=Hd.instance;e&&e.getCurrentTime()>=this.songDuration&&this.songStartTime>0&&this.endGameplay()}},i.updateProgressBar=function(){if(this.songProgressBar&&!(this.songDuration<=0)){var t=Hd.instance;if(t){var e=t.getCurrentTime(),i=.9*Math.min(1,e/this.songDuration);this.songProgressBar.progress=i+.1,qm.instance.updateProgress(i)}}},i.onScoringProcessed=function(t,e){var i;switch(this.notesProcessed++,this.scoringSystem.processNoteResult(t,e),this.characterAnimation.reactToInput(t,this.scoringSystem.getCombo()),t){case Xf.PERFECT:i=Ym.PERFECT;break;case Xf.GOOD:i=Ym.GREAT;break;case Xf.MISS:i=Ym.MISS;break;default:i=Ym.MISS}qm.instance.showFeedback(i)},i.updateScoreDisplay=function(t){qm.instance.updateScore(t)},i.updateComboDisplay=function(t){qm.instance.updateCombo(t)},i.endGameplay=function(){this.gameState=kv.GAME_OVER;var t=Hd.instance;t&&t.stopSong(),this.beatSystem.stopBeatSystem();var e=this.scoringSystem.getScore(),i=this.scoringSystem.getMaxCombo(),n=this.scoringSystem.getAccuracyPercentage(),o=this.scoringSystem.getGrade();this.scoringSystem.calculateExperiencePoints();qm.instance.showResults(),qm.instance.updateResults(e,n,i,o),console.log("Gameplay ended. Score: "+e+", Accuracy: "+n.toFixed(2)+"%, Max Combo: "+i+", Grade: "+o)},i.onPauseButtonClicked=function(){this.pauseGame()},i.onResumeButtonClicked=function(){this.resumeGame()},i.onRestartButtonClicked=function(){this.pauseMenu&&(this.pauseMenu.active=!1);var t=Hd.instance;t&&t.stopSong(),this.beatSystem.stopBeatSystem(),this.gameState=kv.INIT,M.loadScene(M.getScene().name)},i.onQuitButtonClicked=function(){var t=Hd.instance;t&&t.stopSong(),this.beatSystem.stopBeatSystem(),this.gameState=kv.INIT},i.pauseGame=function(){if(this.gameState===kv.PLAYING){this.gameState=kv.PAUSED;var t=Hd.instance;t&&t.pauseSong(),this.pauseMenu&&(this.pauseMenu.active=!0)}},i.resumeGame=function(){if(this.gameState===kv.PAUSED){this.gameState=kv.PLAYING;var t=Hd.instance;t&&t.resumeSong(),this.pauseMenu&&(this.pauseMenu.active=!1)}},i.onDestroy=function(){var t=Hd.instance;t&&t.stopSong(),this.beatSystem&&this.beatSystem.stopBeatSystem()},Nt(e,null,[{key:"instance",get:function(){return this._instance}}]),e}(r))._instance=null,Lm=Mt((Rm=Um).prototype,"beatSystem",[wm],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Nm=Mt(Rm.prototype,"scoringSystem",[Tm],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Fm=Mt(Rm.prototype,"characterAnimation",[Cm],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Dm=Mt(Rm.prototype,"pauseButton",[Em],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),km=Mt(Rm.prototype,"pauseMenu",[Pm],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),zm=Mt(Rm.prototype,"resumeButton",[Am],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Vm=Mt(Rm.prototype,"restartButton",[Mm],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Bm=Mt(Rm.prototype,"quitButton",[Om],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Hm=Mt(Rm.prototype,"songProgressBar",[Im],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),xm=Rm))||xm);t._RF.pop(),t._RF.push({},"13564WRJ8BHHoVT5R2hp2xb","AuditionGameplayUI",void 0);var Hv,Uv,Gv,Wv,Zv,Yv,qv,jv,Kv,Xv,Qv,Jv,$v,ty,ey,iy,ny,oy,ry,ay,sy=e.ccclass,ly=e.property;jm=sy("AuditionGameplayUI"),Km=ly(y),Xm=ly(y),Qm=ly(y),Jm=ly(c),$m=ly(y),tv=ly(c),ev=ly([c]),iv=ly(c),nv=ly(c),ov=ly(c),rv=ly(y),av=ly(c),sv=ly(c),lv=ly(c),cv=ly(X),uv=ly(X),hv=ly(X),pv=ly(X),dv=ly(X),fv=ly(X),jm((vv=Mt((mv=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,It(e,"scoreLabel",vv,xt(e)),It(e,"comboLabel",yv,xt(e)),It(e,"multiplierLabel",bv,xt(e)),It(e,"accuracyFeedbackNode",_v,xt(e)),It(e,"accuracyLabel",Sv,xt(e)),It(e,"patternDisplay",wv,xt(e)),It(e,"patternDots",Tv,xt(e)),It(e,"patternProgressBar",Cv,xt(e)),It(e,"syncPointIndicator",Ev,xt(e)),It(e,"finishMoveIndicator",Pv,xt(e)),It(e,"finishMoveLabel",Av,xt(e)),It(e,"leftButton",Mv,xt(e)),It(e,"rightButton",Ov,xt(e)),It(e,"spaceButton",Iv,xt(e)),It(e,"leftButtonColor",xv,xt(e)),It(e,"rightButtonColor",Rv,xt(e)),It(e,"spaceButtonColor",Lv,xt(e)),It(e,"perfectColor",Nv,xt(e)),It(e,"goodColor",Fv,xt(e)),It(e,"missColor",Dv,xt(e)),e.currentSequence=[],e.currentProgress=0,e.activeFeedbackAnimation=null,e}Ot(e,t);var i=e.prototype;return i.onLoad=function(){this.resetUI()},i.resetUI=function(){this.updateScore(0),this.updateCombo(0),this.updateMultiplier(1),this.accuracyFeedbackNode&&(this.accuracyFeedbackNode.active=!1),this.clearPatternDisplay(),this.finishMoveIndicator&&(this.finishMoveIndicator.active=!1),this.resetButtons()},i.updateScore=function(t){this.scoreLabel&&(this.scoreLabel.string=t.toString())},i.updateCombo=function(t){this.comboLabel&&(t>0?(this.comboLabel.node.active=!0,this.comboLabel.string="Combo: "+t,this.pulseNode(this.comboLabel.node)):this.comboLabel.node.active=!1)},i.updateMultiplier=function(t){this.multiplierLabel&&(this.multiplierLabel.string="x"+t.toFixed(1),this.multiplierLabel.color=t>2?this.perfectColor:t>1.5?this.goodColor:X.WHITE)},i.showAccuracyFeedback=function(t){var e=this;if(this.accuracyFeedbackNode&&this.accuracyLabel){var i,n;switch(this.activeFeedbackAnimation&&this.activeFeedbackAnimation.stop(),t){case Xf.PERFECT:i="PERFECT",n=this.perfectColor;break;case Xf.GOOD:i="GOOD",n=this.goodColor;break;case Xf.MISS:i="MISS",n=this.missColor}this.accuracyLabel.string=i,this.accuracyLabel.color=n,this.accuracyFeedbackNode.active=!0;var o=this.accuracyFeedbackNode.scale.clone();this.accuracyFeedbackNode.setScale(0,0,1);var r=this.accuracyFeedbackNode.getComponent(b)||this.accuracyFeedbackNode.addComponent(b);r.opacity=255,this.activeFeedbackAnimation=v(this.accuracyFeedbackNode).to(.2,{scale:new g(1.2,1.2,1)}).to(.1,{scale:o}).delay(.5).to(.3,{scale:new g(.8,.8,1)}).parallel(v(r).to(.3,{opacity:0})).call((function(){e.accuracyFeedbackNode.active=!1,e.accuracyFeedbackNode.setScale(o)})).start()}},i.updatePatternDisplay=function(t){var e=this;if(this.patternDisplay){if(this.patternDisplay.active=!0,this.currentSequence=t,this.currentProgress=0,this.patternDots.forEach((function(i,n){var o=i.getComponent(f);n<t.length?(o.color=e.getColorForInput(t[n]),i.active=!0):i.active=!1})),this.syncPointIndicator&&(this.syncPointIndicator.active=!0,t.length>0&&t.length<=this.patternDots.length)){var i=this.patternDots[t.length-1].position;this.syncPointIndicator.setPosition(i.x+60,i.y,i.z)}this.updatePatternProgress(0,t.length)}},i.updatePatternProgress=function(t,e){if(this.patternProgressBar){this.currentProgress=t;var i=e>0?t/e:0,n=this.patternProgressBar.getComponent(f);n&&(n.fillRange=i);for(var o=0;o<this.patternDots.length;o++)if(o<this.currentSequence.length){var r=this.patternDots[o].getComponent(f);r.color=o<t?this.perfectColor:this.getColorForInput(this.currentSequence[o])}if(t===e&&this.syncPointIndicator){var a=this.syncPointIndicator.getComponent(f);a&&(a.color=this.perfectColor,this.pulseNode(this.syncPointIndicator))}}},i.clearPatternDisplay=function(){this.currentSequence=[],this.currentProgress=0,this.patternDisplay&&(this.patternDisplay.active=!1),this.syncPointIndicator&&(this.syncPointIndicator.active=!1),this.patternDots.forEach((function(t){t.active=!1}))},i.showButtonPress=function(t,e){var i=null;switch(t){case $d.LEFT:i=this.leftButton;break;case $d.RIGHT:i=this.rightButton;break;case $d.SPACE:i=this.spaceButton}if(i){var n=i.getComponent(f);if(n){var o=n.color.clone();n.color=e?this.perfectColor:this.missColor;var r=i.scale.clone();v(i).to(.05,{scale:new g(.9*r.x,.9*r.y,r.z)}).to(.1,{scale:r}).call((function(){n.color=o})).start()}}},i.resetButtons=function(){if(this.leftButton){this.leftButton.setScale(1,1,1);var t=this.leftButton.getComponent(f);t&&(t.color=this.leftButtonColor)}if(this.rightButton){this.rightButton.setScale(1,1,1);var e=this.rightButton.getComponent(f);e&&(e.color=this.rightButtonColor)}if(this.spaceButton){this.spaceButton.setScale(1,1,1);var i=this.spaceButton.getComponent(f);i&&(i.color=this.spaceButtonColor)}},i.showFinishMoveEffect=function(){var t=this;if(this.finishMoveIndicator&&this.finishMoveLabel){this.finishMoveIndicator.active=!0,this.finishMoveLabel.string="FINISH MOVE!";var e=this.finishMoveIndicator.getComponent(it);e?e.play("finish_move_flash"):(this.pulseNode(this.finishMoveIndicator,1.5,.5),setTimeout((function(){t.finishMoveIndicator.active=!1}),3e3))}},i.getColorForInput=function(t){switch(t){case $d.LEFT:return this.leftButtonColor;case $d.RIGHT:return this.rightButtonColor;case $d.SPACE:return this.spaceButtonColor;default:return X.WHITE}},i.pulseNode=function(t,e,i){if(void 0===e&&(e=1.2),void 0===i&&(i=.3),t){var n=t.scale.clone();v(t).to(i/2,{scale:new g(n.x*e,n.y*e,n.z)}).to(i/2,{scale:n}).start()}},i.showPatternSkipEffect=function(){var t=this;if(this.patternDisplay){var e=this.patternDisplay.getComponent(b)||this.patternDisplay.addComponent(b);e.opacity=255;var i=this.patternDisplay.position.clone();v(this.patternDisplay).to(.1,{position:new g(i.x+20,i.y,i.z)}).to(.1,{position:new g(i.x-200,i.y,i.z)}).parallel(v(e).to(.2,{opacity:0})).call((function(){t.patternDisplay.setPosition(i),t.patternDisplay.active=!1})).start()}},i.showPatternCompleteEffect=function(t){var e=this;if(void 0===t&&(t=!1),this.patternDisplay){t&&this.showFinishMoveEffect();var i=this.patternDisplay.getComponent(b)||this.patternDisplay.addComponent(b);i.opacity=255,v(i).to(.5,{opacity:0}).call((function(){e.patternDisplay.active=!1})).start()}},e}(r)).prototype,"scoreLabel",[Km],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),yv=Mt(mv.prototype,"comboLabel",[Xm],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),bv=Mt(mv.prototype,"multiplierLabel",[Qm],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_v=Mt(mv.prototype,"accuracyFeedbackNode",[Jm],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Sv=Mt(mv.prototype,"accuracyLabel",[$m],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),wv=Mt(mv.prototype,"patternDisplay",[tv],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Tv=Mt(mv.prototype,"patternDots",[ev],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Cv=Mt(mv.prototype,"patternProgressBar",[iv],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ev=Mt(mv.prototype,"syncPointIndicator",[nv],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Pv=Mt(mv.prototype,"finishMoveIndicator",[ov],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Av=Mt(mv.prototype,"finishMoveLabel",[rv],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Mv=Mt(mv.prototype,"leftButton",[av],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ov=Mt(mv.prototype,"rightButton",[sv],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Iv=Mt(mv.prototype,"spaceButton",[lv],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),xv=Mt(mv.prototype,"leftButtonColor",[cv],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new X(79,195,247)}}),Rv=Mt(mv.prototype,"rightButtonColor",[uv],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new X(255,112,67)}}),Lv=Mt(mv.prototype,"spaceButtonColor",[hv],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new X(255,235,59)}}),Nv=Mt(mv.prototype,"perfectColor",[pv],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new X(120,255,120)}}),Fv=Mt(mv.prototype,"goodColor",[dv],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new X(255,193,7)}}),Dv=Mt(mv.prototype,"missColor",[fv],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new X(211,47,47)}}),gv=mv));t._RF.pop(),t._RF.push({},"89cd9G0+vdPI7ElDHJDudjd","AuditionMainMenuController",void 0);var cy,uy,hy,py,dy,fy=e.ccclass,gy=e.property;Hv=fy("AuditionMainMenuController"),Uv=gy(N),Gv=gy(N),Wv=gy(N),Zv=gy(N),Yv=gy(c),qv=gy(y),jv=gy(y),Hv((Qv=Mt((Xv=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,It(e,"playButton",Qv,xt(e)),It(e,"customizeButton",Jv,xt(e)),It(e,"optionsButton",$v,xt(e)),It(e,"exitButton",ty,xt(e)),It(e,"logoNode",ey,xt(e)),It(e,"playerLevelLabel",iy,xt(e)),It(e,"versionLabel",ny,xt(e)),It(e,"backgroundMusicPath",oy,xt(e)),It(e,"buttonSound",ry,xt(e)),It(e,"animateElements",ay,xt(e)),e}Ot(e,t);var i=e.prototype;return i.onLoad=function(){this.setupButtonEvents(),this.animateElements&&this.initializeAnimations(),this.versionLabel&&(this.versionLabel.string="v0.1.0 Alpha")},i.start=function(){this.playBackgroundMusic()},i.setupButtonEvents=function(){this.playButton&&this.playButton.node.on(N.EventType.CLICK,this.onPlayButtonClicked,this),this.customizeButton&&this.customizeButton.node.on(N.EventType.CLICK,this.onCustomizeButtonClicked,this),this.optionsButton&&this.optionsButton.node.on(N.EventType.CLICK,this.onOptionsButtonClicked,this),this.exitButton&&this.exitButton.node.on(N.EventType.CLICK,this.onExitButtonClicked,this)},i.initializeAnimations=function(){this.logoNode&&(this.logoNode.scale=new g(1.2,1.2,1),v(this.logoNode).to(2,{scale:new g(1.1,1.1,1)}).to(2,{scale:new g(1.2,1.2,1)}).union().repeatForever().start()),[this.playButton,this.customizeButton,this.optionsButton,this.exitButton].forEach((function(t,e){if(t){var i=t.node.scale.clone();t.node.on(c.EventType.MOUSE_ENTER,(function(){v(t.node).to(.2,{scale:new g(1.1*i.x,1.1*i.y,1)}).start()})),t.node.on(c.EventType.MOUSE_LEAVE,(function(){v(t.node).to(.2,{scale:i}).start()})),t.node.setPosition(t.node.position.x,t.node.position.y-50);var n=t.node.getComponent(b);n||(n=t.node.addComponent(b)),n.opacity=0,v(t.node).delay(.2+.1*e).to(.5,{position:new g(t.node.position.x,t.node.position.y+50,0)},{easing:"backOut"}).start(),v(n).delay(.2+.1*e).to(.5,{opacity:255}).start()}}))},i.playBackgroundMusic=function(){var t=Hd.instance;t&&t.loadSong(this.backgroundMusicPath).then((function(){t.playSong()})).catch((function(t){console.error("Failed to load menu music:",t)}))},i.onPlayButtonClicked=function(){Hd.instance.playSound(this.buttonSound)},i.onCustomizeButtonClicked=function(){Hd.instance.playSound(this.buttonSound),console.log("Customize button clicked - Feature coming soon")},i.onOptionsButtonClicked=function(){Hd.instance.playSound(this.buttonSound),console.log("Options button clicked - Feature coming soon")},i.onExitButtonClicked=function(){Hd.instance.playSound(this.buttonSound),console.log("Exit button clicked")},i.onDestroy=function(){var t=Hd.instance;t&&t.stopSong()},e}(r)).prototype,"playButton",[Uv],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Jv=Mt(Xv.prototype,"customizeButton",[Gv],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),$v=Mt(Xv.prototype,"optionsButton",[Wv],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ty=Mt(Xv.prototype,"exitButton",[Zv],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ey=Mt(Xv.prototype,"logoNode",[Yv],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),iy=Mt(Xv.prototype,"playerLevelLabel",[qv],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ny=Mt(Xv.prototype,"versionLabel",[jv],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),oy=Mt(Xv.prototype,"backgroundMusicPath",[gy],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"audition/audio/menu_music"}}),ry=Mt(Xv.prototype,"buttonSound",[gy],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"click"}}),ay=Mt(Xv.prototype,"animateElements",[gy],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Kv=Xv));t._RF.pop(),t._RF.push({},"9c847FTTeVHTLgt1NPmkCyR","AuditionRandomBackground",void 0);var my,vy,yy,by,_y,Sy,wy,Ty,Cy,Ey,Py,Ay,My,Oy,Iy,xy,Ry,Ly,Ny=e.ccclass,Fy=e.property;cy=Ny("AuditionRandomBackground"),uy=Fy([i]),cy((dy=Mt((py=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,It(e,"backgroundFrames",dy,xt(e)),e.meshRenderer=null,e}Ot(e,t);var i=e.prototype;return i.onLoad=function(){if(this.meshRenderer=this.getComponent(ht),this.meshRenderer){if(this.backgroundFrames.length>0){var t=o(0,this.backgroundFrames.length),e=this.backgroundFrames[t];this.meshRenderer.material&&this.meshRenderer.material.setProperty("mainTexture",e.texture)}}else console.error("MeshRenderer component not found on AuditionRandomBackground")},i.update=function(t){},e}(r)).prototype,"backgroundFrames",[uy],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),hy=py));t._RF.pop(),t._RF.push({},"2c315k/8UpN5rJQH/P/zdLe","AuditionResultsController",void 0);var Dy,ky,zy,Vy,By,Hy,Uy,Gy,Wy,Zy,Yy,qy,jy,Ky,Xy,Qy,Jy,$y=e.ccclass,tb=e.property;my=$y("AuditionResultsController"),vy=tb(N),yy=tb(N),by=tb(N),_y=tb(c),Sy=tb(c),wy=tb(y),my((Ey=Mt((Cy=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,It(e,"retryButton",Ey,xt(e)),It(e,"nextButton",Py,xt(e)),It(e,"mainMenuButton",Ay,xt(e)),It(e,"resultsContent",My,xt(e)),It(e,"expGainDisplay",Oy,xt(e)),It(e,"expGainLabel",Iy,xt(e)),It(e,"backgroundMusicPath",xy,xt(e)),It(e,"buttonClickSound",Ry,xt(e)),It(e,"resultsSound",Ly,xt(e)),e.isAnimatingResults=!1,e}Ot(e,t);var i=e.prototype;return i.onLoad=function(){if(qm.instance.showResults(),this.setupButtonEvents(),this.resultsContent){this.resultsContent.scale=new g(.8,.8,1);var t=this.resultsContent.getComponent(b);t||(t=this.resultsContent.addComponent(b)),t.opacity=0}this.expGainDisplay&&(this.expGainDisplay.active=!1)},i.start=function(){var t=this;this.playBackgroundMusic(),Hd.instance.playSound(this.resultsSound),this.scheduleOnce((function(){t.animateResults()}),.5)},i.setupButtonEvents=function(){this.retryButton&&(this.retryButton.node.on(N.EventType.CLICK,this.onRetryButtonClicked,this),this.retryButton.interactable=!1),this.nextButton&&(this.nextButton.node.on(N.EventType.CLICK,this.onNextButtonClicked,this),this.nextButton.interactable=!1),this.mainMenuButton&&(this.mainMenuButton.node.on(N.EventType.CLICK,this.onMainMenuButtonClicked,this),this.mainMenuButton.interactable=!1)},i.playBackgroundMusic=function(){var t=Hd.instance;t&&t.loadSong(this.backgroundMusicPath).then((function(){t.playSong()})).catch((function(t){console.error("Failed to load results music:",t)}))},i.animateResults=function(){var t=this;if(this.resultsContent){this.isAnimatingResults=!0,this.resultsContent.active=!0,v(this.resultsContent).to(.5,{scale:new g(1,1,1)}).start();var e=this.resultsContent.getComponent(b)||this.resultsContent.addComponent(b);e&&v(e).to(.5,{opacity:255}).call((function(){t.scheduleOnce((function(){t.showExperienceGain()}),1)})).start()}},i.showExperienceGain=function(){var t=this;if(this.expGainDisplay&&this.expGainLabel){this.expGainLabel&&(this.expGainLabel.string="+100 EXP"),this.expGainDisplay.active=!0,this.expGainDisplay.scale=new g(.5,.5,1),v(this.expGainDisplay).to(.3,{scale:new g(1.2,1.2,1)}).to(.2,{scale:new g(1,1,1)}).call((function(){t.enableButtons(),t.isAnimatingResults=!1})).start()}},i.enableButtons=function(){this.retryButton&&(this.retryButton.interactable=!0),this.nextButton&&(this.nextButton.interactable=!0),this.mainMenuButton&&(this.mainMenuButton.interactable=!0)},i.onRetryButtonClicked=function(){Hd.instance.playSound(this.buttonClickSound)},i.onNextButtonClicked=function(){Hd.instance.playSound(this.buttonClickSound)},i.onMainMenuButtonClicked=function(){Hd.instance.playSound(this.buttonClickSound)},i.onDestroy=function(){var t=Hd.instance;t&&t.stopSong()},e}(r)).prototype,"retryButton",[vy],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Py=Mt(Cy.prototype,"nextButton",[yy],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ay=Mt(Cy.prototype,"mainMenuButton",[by],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),My=Mt(Cy.prototype,"resultsContent",[_y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Oy=Mt(Cy.prototype,"expGainDisplay",[Sy],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Iy=Mt(Cy.prototype,"expGainLabel",[wy],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),xy=Mt(Cy.prototype,"backgroundMusicPath",[tb],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"audition/audio/results_music"}}),Ry=Mt(Cy.prototype,"buttonClickSound",[tb],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"click"}}),Ly=Mt(Cy.prototype,"resultsSound",[tb],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"results"}}),Ty=Cy));t._RF.pop(),t._RF.push({},"6a29cIl249M9qUzgX5Tgjl0","AuditionSongItemComponent",void 0);var eb,ib,nb,ob,rb,ab,sb,lb,cb,ub,hb,pb,db,fb,gb,mb,vb,yb,bb,_b,Sb,wb,Tb,Cb,Eb,Pb,Ab=e.ccclass,Mb=e.property;Dy=Ab("AuditionSongItemComponent"),ky=Mb(y),zy=Mb(y),Vy=Mb(y),By=Mb(y),Hy=Mb(f),Uy=Mb(N),Gy=Mb(c),Dy((Yy=Mt((Zy=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,It(e,"titleLabel",Yy,xt(e)),It(e,"artistLabel",qy,xt(e)),It(e,"difficultyLabel",jy,xt(e)),It(e,"highScoreLabel",Ky,xt(e)),It(e,"lockIcon",Xy,xt(e)),It(e,"selectButton",Qy,xt(e)),It(e,"selectedIndicator",Jy,xt(e)),e.songId="",e.unlocked=!1,e.onSelect=null,e}Ot(e,t);var i=e.prototype;return i.setup=function(t){if(this.songId=t.id,this.unlocked=t.unlocked,this.titleLabel&&(this.titleLabel.string=t.title),this.artistLabel&&(this.artistLabel.string=t.artist),this.difficultyLabel){for(var e="",i=0;i<t.difficulty;i++)e+="★";this.difficultyLabel.string=e}this.highScoreLabel&&(this.highScoreLabel.string=t.highScore>0?t.highScore.toString():"-"),this.lockIcon&&(this.lockIcon.node.active=!t.unlocked),this.selectButton&&(this.selectButton.interactable=t.unlocked,this.selectButton.node.on(N.EventType.CLICK,this.onButtonClicked,this)),this.selectedIndicator&&(this.selectedIndicator.active=!1)},i.onButtonClicked=function(){this.unlocked&&(this.onSelect&&this.onSelect(this.songId),this.selectedIndicator&&(this.selectedIndicator.active=!0))},i.setSelected=function(t){this.selectedIndicator&&(this.selectedIndicator.active=t)},e}(r)).prototype,"titleLabel",[ky],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),qy=Mt(Zy.prototype,"artistLabel",[zy],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),jy=Mt(Zy.prototype,"difficultyLabel",[Vy],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ky=Mt(Zy.prototype,"highScoreLabel",[By],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Xy=Mt(Zy.prototype,"lockIcon",[Hy],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Qy=Mt(Zy.prototype,"selectButton",[Uy],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Jy=Mt(Zy.prototype,"selectedIndicator",[Gy],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Wy=Zy));t._RF.pop(),t._RF.push({},"1e799boHRpGq74bdTFaeFfD","AuditionSongSelectionController",void 0);var Ob,Ib,xb,Rb,Lb,Nb=e.ccclass,Fb=e.property;eb=Nb("AuditionSongSelectionController"),ib=Fb(N),nb=Fb(pt),ob=Fb(c),rb=Fb(l),ab=Fb(y),sb=Fb(y),lb=Fb(y),cb=Fb(y),ub=Fb(y),hb=Fb(N),eb((fb=Mt((db=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,It(e,"backButton",fb,xt(e)),It(e,"songListScrollView",gb,xt(e)),It(e,"songListContent",mb,xt(e)),It(e,"songItemPrefab",vb,xt(e)),It(e,"songTitleLabel",yb,xt(e)),It(e,"artistLabel",bb,xt(e)),It(e,"difficultyLabel",_b,xt(e)),It(e,"bpmLabel",Sb,xt(e)),It(e,"highScoreLabel",wb,xt(e)),It(e,"playButton",Tb,xt(e)),It(e,"backgroundMusicPath",Cb,xt(e)),It(e,"previewVolume",Eb,xt(e)),It(e,"buttonSound",Pb,xt(e)),e.selectedSongId=null,e.previewTimer=null,e}Ot(e,t);var i=e.prototype;return i.onLoad=function(){qm.instance.showSongSelection(),this.setupButtonEvents(),this.playBackgroundMusic()},i.start=function(){this.populateSongList(),this.clearSongSelection()},i.setupButtonEvents=function(){this.backButton&&this.backButton.node.on(N.EventType.CLICK,this.onBackButtonClicked,this),this.playButton&&(this.playButton.node.on(N.EventType.CLICK,this.onPlayButtonClicked,this),this.playButton.interactable=!1)},i.playBackgroundMusic=function(){var t=Hd.instance;t&&t.loadSong(this.backgroundMusicPath).then((function(){t.playSong()})).catch((function(t){console.error("Failed to load selection music:",t)}))},i.populateSongList=function(){var t=this;this.songListContent&&this.songListContent.removeAllChildren();var e=Bv.instance;if(e){var i=e.getAvailableSongs();e.getUnlockedSongs();i.forEach((function(i){if(t.songItemPrefab){var n,o,r=E(t.songItemPrefab),a=null==(n=r.getChildByName("SongName"))?void 0:n.getComponent(y);a&&(a.string=i.title);var s=r.getChildByName("Difficulty");if(s)for(var l=s.children,c=0;c<l.length;c++)l[c].active=c<i.difficulty;var u=r.getChildByName("LockedIcon");u&&(u.active=!e.isSongUnlocked(i.id));var h=null==(o=r.getChildByName("HighScore"))?void 0:o.getComponent(y);if(h){var p=e.getHighScore(i.id);h.string=p>0?"High Score: "+p:""}var d=r.getComponent(N);if(d){var f=e.isSongUnlocked(i.id);d.interactable=f,f&&d.node.on(N.EventType.CLICK,(function(){t.onSongSelected(i.id)}))}t.songListContent.addChild(r)}}));var n=this.songListContent.getComponent($);n&&n.updateLayout()}},i.onSongSelected=function(t){Hd.instance.playSound(this.buttonSound),this.selectedSongId=t;var e=Bv.instance;if(e){var i=e.getAvailableSongs().find((function(e){return e.id===t}));if(i){if(this.songTitleLabel&&(this.songTitleLabel.string=i.title),this.artistLabel&&(this.artistLabel.string=i.artist),this.difficultyLabel&&(this.difficultyLabel.string="Difficulty: "+i.difficulty),this.bpmLabel&&(this.bpmLabel.string="BPM: "+i.bpm),this.highScoreLabel){var n=e.getHighScore(t);this.highScoreLabel.string=n>0?"High Score: "+n:"No records yet"}this.playButton&&(this.playButton.interactable=!0),this.playPreview(i)}}},i.playPreview=function(t){var e=this,i=Hd.instance;i&&(this.stopPreview(),i.loadSong(t.audioPath).then((function(){i.setMusicVolume(e.previewVolume),i.playSong(t.previewStart);var n=t.previewEnd-t.previewStart;e.previewTimer=setTimeout((function(){e.stopPreview(),e.playBackgroundMusic()}),n)})).catch((function(t){console.error("Failed to play song preview:",t)})))},i.stopPreview=function(){this.previewTimer&&(clearTimeout(this.previewTimer),this.previewTimer=null);var t=Hd.instance;t&&t.stopSong()},i.clearSongSelection=function(){this.selectedSongId=null,this.songTitleLabel&&(this.songTitleLabel.string="Select a Song"),this.artistLabel&&(this.artistLabel.string=""),this.difficultyLabel&&(this.difficultyLabel.string=""),this.bpmLabel&&(this.bpmLabel.string=""),this.highScoreLabel&&(this.highScoreLabel.string=""),this.playButton&&(this.playButton.interactable=!1)},i.onBackButtonClicked=function(){Hd.instance.playSound(this.buttonSound)},i.onPlayButtonClicked=function(){this.selectedSongId&&Hd.instance.playSound(this.buttonSound)},i.onDestroy=function(){this.stopPreview();var t=Hd.instance;t&&t.stopSong()},e}(r)).prototype,"backButton",[ib],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),gb=Mt(db.prototype,"songListScrollView",[nb],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),mb=Mt(db.prototype,"songListContent",[ob],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),vb=Mt(db.prototype,"songItemPrefab",[rb],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),yb=Mt(db.prototype,"songTitleLabel",[ab],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),bb=Mt(db.prototype,"artistLabel",[sb],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_b=Mt(db.prototype,"difficultyLabel",[lb],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Sb=Mt(db.prototype,"bpmLabel",[cb],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),wb=Mt(db.prototype,"highScoreLabel",[ub],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Tb=Mt(db.prototype,"playButton",[hb],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Cb=Mt(db.prototype,"backgroundMusicPath",[Fb],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"audition/audio/selection_music"}}),Eb=Mt(db.prototype,"previewVolume",[Fb],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),Pb=Mt(db.prototype,"buttonSound",[Fb],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"click"}}),pb=db));t._RF.pop(),t._RF.push({},"9470cSQRxtAIYqQT5Sm+ZX6","AnimationGraph",void 0);var Db,kb=e.ccclass,zb=e.property,Vb=(Ob=kb("AnimationGraph"),Ib=zb(U),Ob((Lb=Mt((Rb=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this)._graph=void 0,It(e,"isPose",Lb,xt(e)),e}Ot(e,t);var i=e.prototype;return i.start=function(){if(this._graph=this.getComponent(dt.AnimationController),void 0===this._graph||null===this._graph)throw new Error(this.node.name+" can not find AnimationController")},i.play=function(t,e){this.setValue(t,e)},i.setValue=function(t,e){var i;this.isPose?this._graph.setValue_experimental(t,e):null==(i=this._graph)||i.setValue(t,e)},i.setLayer=function(t,e){this._graph.setLayerWeight(t,e)},i.update=function(t){},e}(r)).prototype,"isPose",[Ib],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),xb=Rb))||xb);t._RF.pop(),t._RF.push({},"61dcf57FUBJ8oXIVFbL/HTv","AnimationGraphGroup",void 0);var Bb,Hb=e.ccclass;e.property,Hb("AnimationGraphGroup")(Db=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this)._groups=void 0,e.curActiveKey="",e}Ot(e,t);var i=e.prototype;return i.__preload=function(){if(this._groups=this.getComponentsInChildren(Vb),void 0===this._groups||null===this._groups)throw new Error(this.node.name+" node not find AnimationGraph")},i.play=function(t,e){if(this.curActiveKey!==t){this.curActiveKey=t;try{for(var i=0;i<this._groups.length;i++)this._groups[i].play(t,e)}catch(t){ve.LOG&&console.log(t)}}},i.setLayer=function(t,e){for(var i=0;i<this._groups.length;i++)this._groups[i].setLayer(t,e)},e}(r));t._RF.pop(),t._RF.push({},"2d25eUq/olFcqr07UVxslCs","AnimatorController",void 0);var Ub,Gb,Wb,Zb=e.ccclass;e.property,Zb("AnimatorController")(Bb=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this)._anim=Object.create(null),e._data=Object.create(null),e}Ot(e,t);var i=e.prototype;return i.init=function(t){this._data=t,this._anim=this.getComponent(lt)},i.play=function(t){var e=this._data[t];this._anim.play(e[0])},e}(r));t._RF.pop(),t._RF.push({},"4a695abDKBOU7c/73mimyQe","EffectBase",void 0);var Yb,qb,jb,Kb,Xb,Qb,Jb=e.ccclass,$b=e.property,t_=Jb("EffectBase")((Wb=Mt((Gb=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).define="",e.recycleMe=null,It(e,"sound",Wb,xt(e)),e}Ot(e,t);var i=e.prototype;return i.init=function(t,e,i){this.define=t,this.recycleMe=e,this.sound&&qi.instance.playSound(this.sound)},i.putToPool=function(){var t;null==this||null==(t=this.recycleMe)||t.call(this,this)},e}(r)).prototype,"sound",[$b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Ub=Gb))||Ub;t._RF.pop(),t._RF.push({},"f1faaHNgYdAgqUp6WWlyLaO","EffectController",void 0);var e_,i_,n_,o_,r_,a_,s_,l_,c_=e.ccclass,u_=e.property,h_=(Yb=c_("EffectController"),qb=u_(c),Yb(((Qb=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).preloadPrefabNames=[],It(e,"uiEffectContainer",Xb,xt(e)),e.effectPoolMap=new Map,e}Ot(e,t);var i=e.prototype;return i.onLoad=function(){e.instance=this,this.initPool(),this.preloadEffects()},i.onDestroy=function(){e.instance=null},i.start=function(){this.initPool()},i.preloadEffects=function(){var t=this;this.preloadPrefabNames.forEach((function(e){0==t.effectPoolMap.has(e)&&Je.loadEffectRes(e).then((function(i){t.effectPoolMap.set(e,t.createPool(i,t.uiEffectContainer,t_))})).catch((function(t){ve.LOG&&console.error(t,e)}))}))},i.initPool=function(){},i.createPool=function(t,e,i,n){if(void 0===n&&(n=1),!t||!e)return null;var o=new ee((function(){var e=E(t).getComponent(i);return e||(console.warn("Component of the specified class not found in prefab."),null)}),e);return o.init(n),o},i.putEffects=function(t,e){var i;null==(i=this.effectPoolMap.get(e))||i.putAll(t)},i.spawnResourceEffectAt=function(t,e,i,n,o){var r=this;void 0===i&&(i=null),void 0===n&&(n=null),void 0===o&&(o=function(){});var a=function(){var a,s=null==(a=r.effectPoolMap)||null==(a=a.get(e))?void 0:a.get(),l=e;null!=i&&(s.node.parent=i),s.node.setWorldPosition(t),setTimeout((function(){s.init(l,(function(t){var e;null==(e=r.effectPoolMap)||null==(e=e.get(l))||e.put(t)}),n),null==o||o(s)}))};0==this.effectPoolMap.has(e)?Je.loadEffectRes(e).then((function(t){r.effectPoolMap.set(e,r.createPool(t,r.uiEffectContainer,t_)),a()})).catch((function(t){ve.LOG&&console.error(t,e),null==o||o(null,"could not find the effect prefab")})):a()},e}(r)).instance=null,Xb=Mt((Kb=Qb).prototype,"uiEffectContainer",[qb],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),jb=Kb))||jb);t._RF.pop(),t._RF.push({},"b11edLPNrlIvrzI4yYh6uVF","EffectTime",void 0);var p_,d_,f_,g_,m_,v_,y_,b_=e.ccclass,__=e.property,S_=(e_=b_("EffectTime"),i_=__(ft),n_=__([ct]),e_((a_=Mt((r_=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,It(e,"delayKillTime",a_,xt(e)),It(e,"particleSystems",s_,xt(e)),It(e,"particleSystem2ds",l_,xt(e)),e}return Ot(e,t),e.prototype.init=function(e,i,n){var o,r,a=this;t.prototype.init.call(this,e,i,n),null==(o=this.particleSystems)||o.forEach((function(t){null==t||t.play()})),null==(r=this.particleSystem2ds)||r.forEach((function(t){t.resetSystem()})),this.scheduleOnce((function(){a.putToPool()}),this.delayKillTime)},e}(t_)).prototype,"delayKillTime",[__],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),s_=Mt(r_.prototype,"particleSystems",[i_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),l_=Mt(r_.prototype,"particleSystem2ds",[n_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),o_=r_))||o_);t._RF.pop(),t._RF.push({},"8ca3fmen/FAube9ooAPgxCz","EffectAnimation",void 0);var w_,T_,C_,E_,P_,A_,M_,O_,I_,x_=e.ccclass,R_=e.property;p_=x_("EffectAnimation"),d_=R_(it),p_((m_=Mt((g_=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,It(e,"animMain",m_,xt(e)),It(e,"animName",v_,xt(e)),It(e,"delay",y_,xt(e)),e}Ot(e,t);var i=e.prototype;return i.onLoad=function(){this.animMain.node.active=!1},i.init=function(e,i,n){var o=this;t.prototype.init.call(this,e,i,n),this.scheduleOnce((function(){o.animMain.play(o.animName)}),this.delay)},e}(S_)).prototype,"animMain",[d_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),v_=Mt(g_.prototype,"animName",[R_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),y_=Mt(g_.prototype,"delay",[R_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),f_=g_));t._RF.pop(),t._RF.push({},"4dd0e4qDG1PXZh+cEHXUaeh","EffectMovingObject",void 0);var L_,N_,F_,D_,k_,z_,V_=e.ccclass,B_=e.property,H_=(w_=V_("EffectMovingObject"),T_=B_(f),C_=B_(y),E_=B_(c),w_((M_=Mt((A_=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,It(e,"sprtMain",M_,xt(e)),It(e,"lbMain",O_,xt(e)),It(e,"nodeFollow",I_,xt(e)),e.data=null,e.movingValue={value:0},e.tweenValue=null,e.startPoint=null,e.endPoint=null,e.controlPoint1=null,e.controlPoint2=null,e.scaleTime=.05,e.holdTime=.15,e.movingTime=.23,e.finalScale=.5,e}Ot(e,t);var i=e.prototype;return i.onDisable=function(){var t;null==(t=this.tweenValue)||t.stop()},i.init=function(e,i,n){var r,a,s=this;t.prototype.init.call(this,e,i,n),this.data=n,this.movingValue.value=0;var l=function(t,e){void 0===e&&(e=1),s.lbMain&&(s.lbMain.string=null!=t?t:"",s.lbMain.node.scale=m(1.5*e,1.5*e),v(s.lbMain.node).to(.2,{scale:m(e,e)}).start())};this.sprtMain&&this.data.spriteFrame&&(this.sprtMain.spriteFrame=this.data.spriteFrame),this.startPoint=this.node.worldPosition.clone(),this.endPoint=this.data.destination.clone();var c=this.calculateControlPoints(this.startPoint,this.endPoint,o(100,250)*(gt()>=.5?1:-1));this.controlPoint1=c[0],this.controlPoint2=c[1],l(null!=(r=null==(a=this.data)?void 0:a.text)?r:""),this.data.text2&&this.scheduleOnce((function(){l(s.data.text2,1.5)}),this.scaleTime+this.holdTime/2),this.doEffectSpriteMain(),this.doEffectMoving()},i.getTotalTime=function(){return this.scaleTime+this.holdTime+this.movingTime},i.setActive=function(t){this.node.active=t,this.nodeFollow&&(this.nodeFollow.active=!1)},i.setParentForFollowNode=function(t){this.nodeFollow&&(this.nodeFollow.parent=t,this.nodeFollow.setSiblingIndex(99))},i.doEffectSpriteMain=function(){this.node.scale=g.ZERO,v(this.node).to(this.scaleTime,{scale:m(1.5,1.5,1.5)},{easing:_.backOut}).delay(this.holdTime).to(this.movingTime,{scale:m(this.finalScale,this.finalScale,this.finalScale)},{easing:_.quartIn}).start()},i.doEffectFade=function(){},i.doEffectMoving=function(){var t=this;this.tweenValue=v(this.movingValue).delay(this.scaleTime+this.holdTime).call((function(){t.nodeFollow&&(t.nodeFollow.active=!0)})).to(this.movingTime,{value:1},{easing:_.quartIn}).call((function(){t.movingValue.value=1,t.tweenValue=null,null==t.data.onEnd||t.data.onEnd(),t.putToPool()})).start()},i.update=function(t){this.updatePosition()},i.updatePosition=function(){this.tweenValue&&(this.node.worldPosition=this.cubicBezierPoint(this.startPoint,this.controlPoint1,this.controlPoint2,this.endPoint,this.movingValue.value),this.nodeFollow&&(this.nodeFollow.worldPosition=this.node.worldPosition))},i.cubicBezierPoint=function(t,e,i,n,o){var r=1-o,a=o*o,s=r*r,l=s*r,c=a*o,u=new g;return u.set(l*t.x+3*s*o*e.x+3*r*a*i.x+c*n.x,l*t.y+3*s*o*e.y+3*r*a*i.y+c*n.y,l*t.z+3*s*o*e.z+3*r*a*i.z+c*n.z),u},i.calculateControlPoints=function(t,e,i){var n=e.clone().subtract(t).normalize(),o=new g(-n.y,n.x);return[t.clone().add(o.clone().multiplyScalar(i)),e.clone().add(o.clone().multiplyScalar(i))]},e}(t_)).prototype,"sprtMain",[T_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),O_=Mt(A_.prototype,"lbMain",[C_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),I_=Mt(A_.prototype,"nodeFollow",[E_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),P_=A_))||P_);t._RF.pop(),t._RF.push({},"79538OeyiNCXKnP2hHWrfF9","EffectMultiMovingObject",void 0);var U_,G_,W_,Z_,Y_,q_=e.ccclass,j_=e.property;L_=q_("EffectMultiMovingObject"),N_=j_([H_]),L_((k_=Mt((D_=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,It(e,"childs",k_,xt(e)),It(e,"soundEachEmitterReached",z_,xt(e)),e.data=null,e.isInited=!1,e}return Ot(e,t),e.prototype.init=function(e,i,n){var o=this;t.prototype.init.call(this,e,i,n),this.data=n,n.randomDuration||(n.randomDuration=0),this.isInited||(this.isInited=!0,this.childs.length<=0&&(this.childs=this.node.getComponentsInChildren(H_),this.childs.forEach((function(t){return t.setParentForFollowNode(o.node)}))));for(var r=function(){var t=a<n.number,e=mt(.3,.65),i=mt(.1,.3),r=1-e-i;if(o.childs[a].setActive(t),t){var s=o.childs[a],l=mt(n.duration-n.randomDuration,n.duration+n.randomDuration);s.movingTime=e*l,s.scaleTime=i*l;var c=r*l;s.holdTime=0,n.spreadDistance<=0&&(s.movingTime+=c,s.movingTime+=s.scaleTime,s.scaleTime=0,c=0),s.finalScale=0,s.sprtMain&&(s.sprtMain.node.active=!0,o.data.isRandomRotation&&(s.sprtMain.node.angle=mt(0,360))),n.spriteFrame&&s.sprtMain&&(s.sprtMain.spriteFrame=n.spriteFrame),s.node.position=g.ZERO,v(s.node).to(c,{position:m(mt(-n.spreadDistance,n.spreadDistance),mt(-n.spreadDistance,n.spreadDistance))}).call((function(){s.init("",null,{onEnd:function(){s.sprtMain&&(s.sprtMain.node.active=!1),null==n.onEachObject||n.onEachObject(s),o.soundEachEmitterReached&&qi.instance.playSound(o.soundEachEmitterReached)},destination:n.end,spriteFrame:n.spriteFrame,text:"",text2:""})})).start()}},a=0;a<this.childs.length;a++)r();this.scheduleOnce((function(){null==n.onEnd||n.onEnd()}),n.duration+n.randomDuration),this.scheduleOnce((function(){o.putToPool()}),1.5*(n.duration+n.randomDuration))},e}(t_)).prototype,"childs",[N_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),z_=Mt(D_.prototype,"soundEachEmitterReached",[j_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),F_=D_));t._RF.pop(),t._RF.push({},"52b3dLzk9pE2JwkxnQV/APT","EffectParticle",void 0);var K_,X_=e.ccclass,Q_=e.property;U_=X_("EffectParticle"),G_=Q_(ft),U_((Y_=Mt((Z_=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,It(e,"particleSystems",Y_,xt(e)),e}Ot(e,t);var i=e.prototype;return i.init=function(e,i,n){var o;t.prototype.init.call(this,e,i,n),null==(o=this.particleSystems)||o.forEach((function(t){null==t||t.play()}))},i.stopParticle=function(t){var e,i=this;void 0===t&&(t=4),null==(e=this.particleSystems)||e.forEach((function(t){null==t||t.stopEmitting()})),this.scheduleOnce((function(){i.putToPool()}),t)},e}(t_)).prototype,"particleSystems",[G_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),W_=Z_));t._RF.pop(),t._RF.push({},"c2301FhRClBM7qSV+ZoQLbZ","EffectPoints",void 0);var J_,$_,tS,eS,iS,nS,oS,rS=e.ccclass;e.property,rS("EffectMovingObject")(K_=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).data=null,e.movingValue={value:0},e.tweenValue=null,e.startPoint=null,e.endPoint=null,e.controlPoint1=null,e.controlPoint2=null,e}Ot(e,t);var i=e.prototype;return i.onDisable=function(){var t;null==(t=this.tweenValue)||t.stop()},i.init=function(e,i,n){var o=this;t.prototype.init.call(this,e,i,n),this.data=n,this.startPoint=this.node.worldPosition.clone(),this.endPoint=this.data.destination.clone();var r=this.calculateControlPoints(this.startPoint,this.endPoint,500);this.controlPoint1=r[0],this.controlPoint2=r[1],this.node.scale=g.ZERO;v(this.node).to(.25,{scale:m(1.5,1.5,1.5)},{easing:_.backOut}).delay(.5).to(.75,{scale:m(.5,.5,.5)},{easing:_.quartIn}).start(),this.tweenValue=v(this.movingValue).delay(.75).to(.75,{value:1},{easing:_.quartIn}).call((function(){o.movingValue.value=1,o.tweenValue=null,null==o.data.onEnd||o.data.onEnd(),o.putToPool()})).start()},i.update=function(t){this.updatePosition()},i.updatePosition=function(){this.tweenValue&&(this.node.worldPosition=this.cubicBezierPoint(this.startPoint,this.controlPoint1,this.controlPoint2,this.endPoint,this.movingValue.value))},i.cubicBezierPoint=function(t,e,i,n,o){var r=1-o,a=o*o,s=r*r,l=s*r,c=a*o,u=new g;return u.set(l*t.x+3*s*o*e.x+3*r*a*i.x+c*n.x,l*t.y+3*s*o*e.y+3*r*a*i.y+c*n.y,l*t.z+3*s*o*e.z+3*r*a*i.z+c*n.z),u},i.calculateControlPoints=function(t,e,i){var n=e.clone().subtract(t).normalize(),o=new g(-n.y,n.x);return[t.clone().add(o.clone().multiplyScalar(i)),e.clone().add(o.clone().multiplyScalar(i))]},e}(t_));t._RF.pop(),t._RF.push({},"4bb4ddfy3ZF7IT9EWgZoUId","EffectText",void 0);var aS,sS,lS,cS,uS,hS,pS,dS=e.ccclass,fS=e.property;J_=dS("EffectText"),$_=fS(y),tS=fS(b),J_((nS=Mt((iS=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,It(e,"lbMain",nS,xt(e)),It(e,"opMain",oS,xt(e)),e}return Ot(e,t),e.prototype.init=function(e,i,n){t.prototype.init.call(this,e,i,n);var o=n.text,r=n.color,a=n.time,s=n.size,l=n.distance;this.lbMain.string=null!=o?o:"NULL",this.lbMain.color=null!=r?r:X.WHITE,this.lbMain.fontSize=null!=s?s:60,this.node.scale=m(1.2,1.2),this.opMain.opacity=255;var c=null!=a?a:.5,u=null!=l?l:100;v(this.node).to(c,{scale:g.ONE},{easing:_.quadIn}).start(),v(this.node).by(c,{worldPosition:m(0,u,0)},{easing:_.quadIn}).start(),v(this.opMain).to(c,{opacity:0},{easing:_.quartIn}).start()},e}(S_)).prototype,"lbMain",[$_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),oS=Mt(iS.prototype,"opMain",[tS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),eS=iS));t._RF.pop(),t._RF.push({},"6e75aYdfoVM5bOfW6DB+f+a","FacialEmotionController",void 0);var gS,mS,vS,yS,bS,_S,SS,wS,TS=e.ccclass,CS=e.property,ES=function(t){return t.NEUTRAL="neutral",t.HAPPY="happy",t.SAD="sad",t.ANGRY="angry",t.SURPRISED="surprised",t.FEAR="fear",t.DISGUST="disgust",t}({}),PS=(aS=TS("FacialEmotionController"),sS=CS({type:vt}),lS=CS({tooltip:"Define emotions with blend shape weights"}),aS((hS=Mt((uS=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,It(e,"faceRenderer",hS,xt(e)),It(e,"emotions",pS,xt(e)),e.currentEmotion=ES.NEUTRAL,e.isTransitioning=!1,e.transitionTime=0,e.transitionDuration=.5,e.fromWeights=new Map,e.toWeights=new Map,e.blendShapeNames=[],e.faceMaterial=null,e}Ot(e,t);var i=e.prototype;return i.start=function(){this.faceRenderer?(this.faceRenderer.material&&(this.faceMaterial=this.faceRenderer.material),this.blendShapeNames=this.getBlendShapeNames(),this.setEmotion(ES.NEUTRAL)):console.error("Face renderer not assigned!")},i.getBlendShapeNames=function(){return["eyeBrowUp","eyeBrowDown","eyeClose","mouthOpen","mouthSmile","mouthFrown"]},i.update=function(t){if(this.isTransitioning&&this.faceMaterial){this.transitionTime+=t;for(var e,i=Math.min(this.transitionTime/this.transitionDuration,1),n=Ft(this.blendShapeNames);!(e=n()).done;){var o=e.value,r=this.fromWeights.get(o)||0,a=this.toWeights.get(o)||0,s=this.lerp(r,a,this.easeInOutQuad(i));this.applyBlendShapeWeight(o,s)}this.transitionTime>=this.transitionDuration&&(this.isTransitioning=!1)}},i.applyBlendShapeWeight=function(t,e){if(this.faceMaterial){var i="blendShape_"+t;this.faceMaterial.setProperty(i,e)}},i.setEmotion=function(t,e){if(void 0===e&&(e=.5),this.faceMaterial){var i=this.emotions.find((function(e){return e.name===t}));if(i){if(e>0){this.fromWeights.clear();for(var n,o=Ft(this.blendShapeNames);!(n=o()).done;){var r=n.value,a=this.getCurrentBlendShapeWeight(r);this.fromWeights.set(r,a)}this.toWeights.clear();for(var s,l=Ft(i.blendShapes);!(s=l()).done;){var c=s.value;this.toWeights.set(c.name,c.weight)}this.isTransitioning=!0,this.transitionTime=0,this.transitionDuration=e}else{for(var u,h=Ft(this.blendShapeNames);!(u=h()).done;){var p=u.value;this.applyBlendShapeWeight(p,0)}for(var d,f=Ft(i.blendShapes);!(d=f()).done;){var g=d.value;this.applyBlendShapeWeight(g.name,g.weight)}}this.currentEmotion=t}else console.warn('Emotion "'+t+'" not found')}},i.getCurrentBlendShapeWeight=function(t){if(!this.faceMaterial)return 0;var e="blendShape_"+t;try{var i=this.faceMaterial.getProperty(e);return"number"==typeof i?i:0}catch(t){return 0}},i.getCurrentEmotion=function(){return this.currentEmotion},i.lerp=function(t,e,i){return t+(e-t)*i},i.easeInOutQuad=function(t){return t<.5?2*t*t:1-Math.pow(-2*t+2,2)/2},e}(r)).prototype,"faceRenderer",[sS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),pS=Mt(uS.prototype,"emotions",[lS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),cS=uS))||cS);t._RF.pop(),t._RF.push({},"72db6UNpkhFOa4J9jHDXQ/n","FacialEmotionDemo",void 0);var AS,MS,OS,IS,xS,RS,LS,NS,FS,DS,kS,zS,VS,BS,HS=e.ccclass,US=e.property;gS=HS("FacialEmotionDemo"),mS=US(PS),vS=US(c),gS((_S=Mt((bS=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,It(e,"faceController",_S,xt(e)),It(e,"emotionButtonsContainer",SS,xt(e)),It(e,"transitionDuration",wS,xt(e)),e.emotionButtons=new Map,e}Ot(e,t);var i=e.prototype;return i.start=function(){this.faceController?(this.emotionButtonsContainer&&this.setupEmotionButtons(),this.setEmotion(ES.NEUTRAL)):console.error("Face controller not assigned!")},i.setupEmotionButtons=function(){var t=this;if(this.emotionButtonsContainer)for(var e,i=this.emotionButtonsContainer.getComponentsInChildren(N),n=function(){var i=e.value,n=i.node.name.toLowerCase(),o=[ES.NEUTRAL,ES.HAPPY,ES.SAD,ES.ANGRY,ES.SURPRISED,ES.FEAR,ES.DISGUST].find((function(t){return n.includes(t.toLowerCase())}));if(o){t.emotionButtons.set(o,i);var r=new F;r.target=t.node,r.component="FacialEmotionDemo",r.handler="onEmotionButtonClicked",r.customEventData=o,i.clickEvents.push(r)}},o=Ft(i);!(e=o()).done;)n()},i.onEmotionButtonClicked=function(t,e){this.setEmotion(e)},i.setEmotion=function(t){this.faceController&&(console.log("Setting emotion: "+t),this.faceController.setEmotion(t,this.transitionDuration),this.updateButtonStates(t))},i.updateButtonStates=function(t){this.emotionButtons.forEach((function(e,i){e.interactable=i!==t;var n=i===t?1.2:1;e.node.setScale(new g(n,n,n))}))},i.triggerEmotionBasedOnEvent=function(t){switch(t){case"victory":this.setEmotion(ES.HAPPY);break;case"defeat":this.setEmotion(ES.SAD);break;case"damage":this.setEmotion(ES.ANGRY);break;case"surprise":this.setEmotion(ES.SURPRISED);break;case"scary":this.setEmotion(ES.FEAR);break;case"disgust":this.setEmotion(ES.DISGUST);break;default:this.setEmotion(ES.NEUTRAL)}},i.playEmotionSequence=function(){var t=this,e=[{emotion:ES.SURPRISED,duration:1},{emotion:ES.HAPPY,duration:2},{emotion:ES.NEUTRAL,duration:1}],i=0;e.forEach((function(e){t.scheduleOnce((function(){t.setEmotion(e.emotion)}),i),i+=e.duration}))},e}(r)).prototype,"faceController",[mS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),SS=Mt(bS.prototype,"emotionButtonsContainer",[vS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),wS=Mt(bS.prototype,"transitionDuration",[US],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),yS=bS));t._RF.pop(),t._RF.push({},"58916U7dudCXZ4FreIgnM5F","GameEnviromentSetter",void 0);var GS,WS=e.ccclass,ZS=e.property;AS=WS("GameEnviromentSetter"),MS=ZS(c),OS=ZS(f),IS=ZS(so),xS=ZS(y),AS((NS=Mt((LS=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,It(e,"API",NS,xt(e)),It(e,"LOG",FS,xt(e)),It(e,"FAKEDATA",DS,xt(e)),It(e,"sckContainer",kS,xt(e)),It(e,"sprtProcessBar",zS,xt(e)),It(e,"popupError",VS,xt(e)),It(e,"lbError",BS,xt(e)),e.sceneName=Dp,e.retryCount=0,e}Ot(e,t);var i=e.prototype;return i.onLoad=function(){var t;t={API:this.API,LOG:this.LOG},ve=t,this.init(),this.initGameProcess()},i.init=function(){var t;t=ve.API,Up.setBaseURL(t)},i.initGameProcess=function(){var t=this;Promise.all([this.step_ProcessData(),this.step_ProcessPreloadSceneAssets()]).then((function(e){t.loadGame()})).catch((function(e){t.showError(e)}))},i.retry=function(){++this.retryCount>3?this.lbError.string="Please try again later!":(this.popupError.doHide(),this.initGameProcess())},i.showError=function(t){this.lbError.string=t,this.popupError.doShow()},i.step_ProcessData=function(){var t=this;return new Promise((function(e,i){t.step_initManagers().then((function(t){e("success")})).catch((function(t){i(t)}))}))},i.step_initManagers=function(){return new Promise((function(t,e){qi.instance=new qi,ro.instance=new ro,h_.instance=new h_,t("success")}))},i.step_ProcessPreloadSceneAssets=function(){var t=this;return new Promise((function(e,i){M.preloadScene(t.sceneName,(function(e,i,n){t.sprtProcessBar&&(t.sprtProcessBar.fillRange=e/i*.95)}),(function(n,o){if(n)return ve.LOG&&console.error("Failed to preload scene "+t.sceneName+":",n),void i("Failed to load assets. Please retry. If retrying doesn't help, please clear the cache and try again.");e("loaded assets done")}))}))},i.loadGame=function(){var t=this;this.sprtProcessBar.fillRange=1,ve.LOG&&console.log("doneLoadAssets"),M.loadScene(this.sceneName,(function(){ve.LOG&&console.log("Scene "+t.sceneName+" loaded successfully")}))},i.onTouch_Retry=function(){this.retry()},e}(r)).prototype,"API",[ZS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),FS=Mt(LS.prototype,"LOG",[ZS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),DS=Mt(LS.prototype,"FAKEDATA",[ZS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),kS=Mt(LS.prototype,"sckContainer",[MS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),zS=Mt(LS.prototype,"sprtProcessBar",[OS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),VS=Mt(LS.prototype,"popupError",[IS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),BS=Mt(LS.prototype,"lbError",[xS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),RS=LS));t._RF.pop(),t._RF.push({},"7be4edEMP9G4o2PKnJZVUkm","HomeController",void 0);var YS,qS,jS=e.ccclass;e.property,jS("HomeController")(GS=function(t){function e(){return t.apply(this,arguments)||this}Ot(e,t);var i=e.prototype;return i.start=function(){console.log(window),ro.instance.showDialog(to)},i.update=function(t){},i.onTouch_Test=function(){},e}(r));t._RF.pop(),t._RF.push({},"3f1f3G1DxNPvqoVbgokQUjm","AudioManager",void 0);var KS=e.ccclass,XS=(e.property,KS("MagicTilesAudioManager")(((qS=function(){function t(){this.commonAudioManager=qi.instance,this._beatmapAudioSource=null,this._currentBeatmap=null,this._beatCallbacks=[],this._isBuffering=!1,this._playbackTimer=0,this.audioTimeEstimation=0,this.lastSystemTime=0,this._timeCheckCounter=0,this._timeCheckInterval=30,this.init()}var e=t.prototype;return e.init=function(){var t=new c("beatmap-audio");M.getScene().addChild(t),this._beatmapAudioSource=t.addComponent(I)},e.loadBeatmapAudioData=function(){var t=Rt(Lt().mark((function t(e,i,n){var o,r,a;return Lt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return void 0===n&&(n=1),this._isBuffering=!0,t.prev=2,t.next=5,Promise.all([this.loadAudioClip(e),pe(i,n)]);case 5:return o=t.sent,r=o[0],a=o[1],this._currentBeatmap={clip:r,trackInfo:a,totalDuration:r.getDuration(),currentTime:0,isPlaying:!1,isPaused:!1},this._beatmapAudioSource.clip=r,this._beatmapAudioSource.volume=1,this._isBuffering=!1,t.abrupt("return",this._currentBeatmap);case 15:return t.prev=15,t.t0=t.catch(2),console.error("Failed to load beatmap audio:",t.t0),this._isBuffering=!1,t.abrupt("return",null);case 20:case"end":return t.stop()}}),t,this,[[2,15]])})));return function(e,i,n){return t.apply(this,arguments)}}(),e.setCurrentBeatmap=function(t){this._currentBeatmap=t,this._beatmapAudioSource.clip=t.clip,this._beatmapAudioSource.volume=1,this._isBuffering=!1},e.loadAudioClip=function(t){return new Promise((function(e,i){Je.loadRes(t,x,(function(t,n){t?i(t):e(n)}))}))},e.playBeatmapAudio=function(t){void 0===t&&(t=0),this._currentBeatmap&&!this._isBuffering?(this._currentBeatmap.currentTime=t,this._currentBeatmap.isPlaying=!0,this._currentBeatmap.isPaused=!1,this._beatmapAudioSource.currentTime=t,this._beatmapAudioSource.play()):console.warn("No beatmap loaded or still buffering")},e.getEstimatedAudioTime=function(){var t=Date.now()/1e3;if(!this.lastSystemTime)return this.lastSystemTime=t,this.audioTimeEstimation=this._beatmapAudioSource.currentTime,this.audioTimeEstimation;var e=t-this.lastSystemTime;if(this.audioTimeEstimation+=e,this._timeCheckCounter++%this._timeCheckInterval==0){var i=this._beatmapAudioSource.currentTime;this.audioTimeEstimation=.95*this.audioTimeEstimation+.05*i}return this.lastSystemTime=t,this.audioTimeEstimation},e.getAudioTime=function(){return this._beatmapAudioSource.currentTime},e.pauseBeatmapAudio=function(){this._currentBeatmap&&this._currentBeatmap.isPlaying&&(this._beatmapAudioSource.pause(),this._currentBeatmap.isPaused=!0,this._currentBeatmap.isPlaying=!1)},e.resumeBeatmapAudio=function(){this._currentBeatmap&&this._currentBeatmap.isPaused&&(this._beatmapAudioSource.play(),this._currentBeatmap.isPaused=!1,this._currentBeatmap.isPlaying=!0)},e.stopBeatmapAudio=function(){this._currentBeatmap&&(this._beatmapAudioSource.stop(),this._currentBeatmap.isPlaying=!1,this._currentBeatmap.isPaused=!1,this._currentBeatmap.currentTime=0)},e.getCurrentTime=function(){return this._currentBeatmap?this._beatmapAudioSource.currentTime:0},e.getTotalDuration=function(){return this._currentBeatmap?this._currentBeatmap.totalDuration:0},e.onBeat=function(t){this._beatCallbacks.push(t)},e.offBeat=function(t){var e=this._beatCallbacks.indexOf(t);-1!==e&&this._beatCallbacks.splice(e,1)},e.startBeatTracking=function(){var t=this;if(this._currentBeatmap&&this._currentBeatmap.trackInfo.notes){this.stopBeatTracking();var e=this._currentBeatmap.trackInfo.notes,i=0;requestAnimationFrame((function n(){if(t._currentBeatmap&&t._currentBeatmap.isPlaying){for(var o=t._beatmapAudioSource.currentTime;i<e.length&&e[i].time<=o;)t._beatCallbacks.forEach((function(t){t(e[i])})),i++;requestAnimationFrame(n)}}))}},e.stopBeatTracking=function(){this._currentBeatmap&&(this._currentBeatmap.isPlaying=!1)},e.setMusicVolume=function(t){this._beatmapAudioSource.volume=t},e.getMusicVolume=function(){return this._beatmapAudioSource.volume},e.isBuffering=function(){return this._isBuffering},e.isPlaying=function(){return!!this._currentBeatmap&&this._currentBeatmap.isPlaying},e.isPaused=function(){return!!this._currentBeatmap&&this._currentBeatmap.isPaused},e.playSound=function(t,e){var i;return void 0===e&&(e=1),null==(i=this.commonAudioManager)?void 0:i.playSound(t,e)},e.createBeatmapAudioDataFromAssets=function(){var t=Rt(Lt().mark((function t(e,i){return Lt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this._isBuffering=!0,t.prev=1,this._currentBeatmap={clip:e,trackInfo:i,totalDuration:e.getDuration(),currentTime:0,isPlaying:!1,isPaused:!1},this._beatmapAudioSource.clip=e,this._beatmapAudioSource.volume=1,this._isBuffering=!1,t.abrupt("return",this._currentBeatmap);case 9:return t.prev=9,t.t0=t.catch(1),console.error("Failed to create beatmap audio from assets:",t.t0),this._isBuffering=!1,t.abrupt("return",null);case 14:case"end":return t.stop()}}),t,this,[[1,9]])})));return function(e,i){return t.apply(this,arguments)}}(),Nt(t,null,[{key:"instance",get:function(){return this._instance||(this._instance=new t),this._instance}}]),t}())._instance=null,YS=qS))||YS);t._RF.pop(),t._RF.push({},"12489oNGpZFfYaPjF1Ir4kw","MTDefines",void 0);var QS,JS,$S=function(t){return t[t.TAP=0]="TAP",t[t.HOLD=1]="HOLD",t[t.SLIDE=2]="SLIDE",t}({});t._RF.pop(),t._RF.push({},"f0997PWuMBCn4LtP5qegoPj","BeatmapManager",void 0);var tw,ew,iw=e.ccclass,nw=(e.property,iw("BeatmapManager")(((JS=function(){function t(){this.audioManager=XS.instance,this.beatmaps=new Map,this.activeBeatmap=null,this.beatmapDirectory="magic_tiles/beatmaps",this.maxLanes=4,this.init()}var e=t.prototype;return e.init=function(){console.log("BeatmapManager initialized")},e.loadBeatmapIndex=function(){var t=Rt(Lt().mark((function t(){var e;return Lt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,this.loadJsonAsset(this.beatmapDirectory+"/index");case 3:if((e=t.sent)&&Array.isArray(e)){t.next=6;break}throw new Error("Invalid beatmap index data");case 6:return t.abrupt("return",e);case 9:return t.prev=9,t.t0=t.catch(0),console.error("Failed to load beatmap index:",t.t0),t.abrupt("return",[]);case 13:case"end":return t.stop()}}),t,this,[[0,9]])})));return function(){return t.apply(this,arguments)}}(),e.loadBeatmapInfo=function(){var t=Rt(Lt().mark((function t(e){var i,n;return Lt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.beatmaps.has(e)){t.next=3;break}return this.activeBeatmap=this.beatmaps.get(e),t.abrupt("return",this.activeBeatmap);case 3:return t.prev=3,t.next=6,this.loadJsonAsset(this.beatmapDirectory+"/"+e);case 6:if(i=t.sent){t.next=9;break}throw new Error("Failed to load beatmap data for ID: "+e);case 9:return n=this.validateBeatmap(i),this.beatmaps.set(e,n),this.activeBeatmap=n,t.abrupt("return",n);case 15:return t.prev=15,t.t0=t.catch(3),console.error("Failed to load beatmap "+e+":",t.t0),t.abrupt("return",null);case 19:case"end":return t.stop()}}),t,this,[[3,15]])})));return function(e){return t.apply(this,arguments)}}(),e.validateBeatmap=function(t){if(!t.metadata)throw new Error("Invalid beatmap format: missing metadata or notes");for(var e=0,i=["id","title","artist","bpm","difficulty","difficultyName","audioPath","midiPath"];e<i.length;e++){var n=i[e];if(!t.metadata[n])throw new Error("Invalid beatmap metadata: missing "+n)}return{metadata:{id:t.metadata.id,title:t.metadata.title,artist:t.metadata.artist,bpm:t.metadata.bpm,difficulty:t.metadata.difficulty,difficultyName:t.metadata.difficultyName,level:t.metadata.level||1,preview:{start:t.metadata.previewStart||0,end:t.metadata.previewEnd||30},audioPath:t.metadata.audioPath,midiPath:t.metadata.midiPath,backgroundImage:t.metadata.backgroundImage||"",coverImage:t.metadata.coverImage||""},notes:[]}},e.updateNotes=function(t,e){if(this.beatmaps.has(t)){var i=this.beatmaps.get(t);return i.notes=this.convertNotes(e,i.notes),this.beatmaps.set(t,i),i}return null},e.convertNotes=function(t,e){void 0===e&&(e=[]);var i,n=t.length;if(e.length>=n){for(var o=0;o<n;o++){var r=t[o];e[o].midi=r.midi,e[o].time=r.time,e[o].lane=this.getLandById(r.midi),e[o].duration=r.duration,e[o].durationTicks=r.durationTicks,e[o].velocity=r.velocity,e[o].type=this.getNoteType(r)}e.length>n&&(e.length=n),i=e}else{i=new Array(n);for(var a=0;a<n;a++){var s=t[a];a<e.length?(i[a]=e[a],i[a].midi=s.midi,i[a].time=s.time,i[a].lane=this.getLandById(s.midi),i[a].duration=s.duration,i[a].durationTicks=s.durationTicks,i[a].velocity=s.velocity,i[a].type=this.getNoteType(s)):i[a]={midi:s.midi,time:s.time,lane:this.getLandById(s.midi),duration:s.duration,durationTicks:s.durationTicks,velocity:s.velocity,type:this.getNoteType(s)}}}i.sort((function(t,e){return t.time-e.time}));for(var l=0;l<i.length-1;l++){var c=i[l],u=i[l+1];u.time===c.time&&l+2<i.length&&(u=i[l+2]),c.type!==$S.HOLD&&(c.duration=Math.min(u.time-c.time,.23))}if(i.length>0){var h=i[i.length-1];h.type!==$S.HOLD&&h.duration<=0&&(h.duration=.2)}return i},e.getLandById=function(t){return t-96},e.getNoteType=function(t){return t.duration>.3?$S.HOLD:$S.TAP},e.loadJsonAsset=function(t){return new Promise((function(e,i){Je.loadRes(t,yt,(function(n,o){n?i(n):o?e(o.json):i(new Error("JSON asset not found at path: "+t))}))}))},e.loadBeatmapAudioData=function(){var t=Rt(Lt().mark((function t(){var e,i,n;return Lt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.activeBeatmap){t.next=3;break}return console.error("No active beatmap to load audio for"),t.abrupt("return",null);case 3:return t.prev=3,e=this.activeBeatmap.metadata,i=e.audioPath,n=e.midiPath,t.next=7,this.audioManager.loadBeatmapAudioData(i,n);case 7:return t.abrupt("return",t.sent);case 10:return t.prev=10,t.t0=t.catch(3),console.error("Failed to load beatmap audio:",t.t0),t.abrupt("return",null);case 14:case"end":return t.stop()}}),t,this,[[3,10]])})));return function(){return t.apply(this,arguments)}}(),e.getActiveBeatmap=function(){return this.activeBeatmap},e.getNotes=function(){return this.activeBeatmap?this.activeBeatmap.notes:[]},e.calculateDifficulty=function(t){var e=t.notes;if(!e.length)return 1;for(var i=e[e.length-1].time-e[0].time,n=e.length/(i||1),o=e.filter((function(t){return t.type!==$S.TAP})).length/e.length,r=0,a=1;a<e.length;a++)e[a].lane!==e[a-1].lane&&r++;for(var s=r/(e.length-1),l=0,c=1;c<e.length;c++){e[c].time-e[c-1].time<.3&&l++}var u=1+.5*n+2*o+2*s+3*(l/(e.length-1));return Math.min(Math.round(10*u)/10,10)},e.getBeatmapPreview=function(t){var e=this.beatmaps.get(t);if(!e)return[];var i=e.metadata.preview,n=i.start,o=i.end;return e.notes.filter((function(t){return t.time>=n&&t.time<=o}))},e.validateCustomBeatmap=function(t){try{return this.validateBeatmap(t)}catch(t){return console.error("Invalid custom beatmap format:",t),null}},e.addTempBeatmap=function(t,e){return this.beatmaps.set(t,e),this.activeBeatmap=e,e},Nt(t,null,[{key:"instance",get:function(){return this._instance||(this._instance=new t),this._instance}}]),t}())._instance=null,QS=JS))||QS);t._RF.pop(),t._RF.push({},"9ca9bpOcERGC7OMbq07ARhv","DataManagement",void 0);var ow,rw,aw,sw,lw,cw,uw,hw,pw,dw,fw,gw,mw,vw,yw,bw,_w,Sw,ww,Tw,Cw,Ew,Pw,Aw,Mw=e.ccclass;e.property,Mw("DataManager")(((ew=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).settings={musicVolume:.8,sfxVolume:1,noteSpeed:1,audioOffset:0,vibrationEnabled:!0,notificationEnabled:!0,autoPlayCount:5,language:"en",lastPlayedSongId:"",visualEffectsLevel:2},e.progress={level:1,exp:0,coins:0,gems:0,unlockedSongs:[],completedTutorials:[]},e.statistics={totalPlayCount:0,totalPlayTime:0,perfectCount:0,goodCount:0,okCount:0,missCount:0,maxCombo:0,averageAccuracy:0,songPlayCounts:{}},e.highScores={},e.onSettingsChangedCallback=null,e.onProgressChangedCallback=null,e.onCoinsChangedCallback=null,e.beatmapManager=null,e}Ot(e,t);var i=e.prototype;return i.onLoad=function(){null===e._instance?(e._instance=this,this.beatmapManager=nw.instance,this.loadAllData()):this.destroy()},i.loadAllData=function(){this.loadSettings(),this.loadProgress(),this.loadStatistics(),this.loadHighScores(),console.log("All player data loaded")},i.saveAllData=function(){this.saveSettings(),this.saveProgress(),this.saveStatistics(),this.saveHighScores(),console.log("All player data saved")},i.loadSettings=function(){var t=S.localStorage.getItem(e.SETTINGS_KEY);if(t)try{var i=JSON.parse(t);this.settings=Dt({},this.settings,i)}catch(t){console.error("Failed to parse settings data:",t)}},i.saveSettings=function(){try{var t=JSON.stringify(this.settings);S.localStorage.setItem(e.SETTINGS_KEY,t)}catch(t){console.error("Failed to save settings data:",t)}},i.loadProgress=function(){var t=S.localStorage.getItem(e.PROGRESS_KEY);if(t)try{var i=JSON.parse(t);this.progress=Dt({},this.progress,i)}catch(t){console.error("Failed to parse progress data:",t)}},i.saveProgress=function(){try{var t=JSON.stringify(this.progress);S.localStorage.setItem(e.PROGRESS_KEY,t)}catch(t){console.error("Failed to save progress data:",t)}},i.loadStatistics=function(){var t=S.localStorage.getItem(e.STATISTICS_KEY);if(t)try{var i=JSON.parse(t);this.statistics=Dt({},this.statistics,i)}catch(t){console.error("Failed to parse statistics data:",t)}},i.saveStatistics=function(){try{var t=JSON.stringify(this.statistics);S.localStorage.setItem(e.STATISTICS_KEY,t)}catch(t){console.error("Failed to save statistics data:",t)}},i.loadHighScores=function(){var t=S.localStorage.getItem(e.HIGH_SCORES_KEY);if(t)try{this.highScores=JSON.parse(t)}catch(t){console.error("Failed to parse high scores data:",t)}},i.saveHighScores=function(){try{var t=JSON.stringify(this.highScores);S.localStorage.setItem(e.HIGH_SCORES_KEY,t)}catch(t){console.error("Failed to save high scores data:",t)}},i.getSettings=function(){return Dt({},this.settings)},i.updateSettings=function(t){this.settings=Dt({},this.settings,t),this.saveSettings(),this.onSettingsChangedCallback&&this.onSettingsChangedCallback()},i.getProgress=function(){return Dt({},this.progress)},i.addExperience=function(t){if(!(t<=0)){this.progress.exp+=t;var e=Math.floor(Math.sqrt(this.progress.exp/100))+1,i=e>this.progress.level;if(i){var n=this.progress.level;this.progress.level=e,console.log("Player leveled up from "+n+" to "+e+"!")}return this.saveProgress(),this.onProgressChangedCallback&&this.onProgressChangedCallback(this.getProgress()),i}},i.updateCoins=function(t){return this.progress.coins+=t,this.progress.coins<0&&(this.progress.coins=0),this.saveProgress(),this.onCoinsChangedCallback&&this.onCoinsChangedCallback(this.progress.coins),this.progress.coins},i.updateGems=function(t){return this.progress.gems+=t,this.progress.gems<0&&(this.progress.gems=0),this.saveProgress(),this.progress.gems},i.isSongUnlocked=function(t){return this.progress.unlockedSongs.indexOf(t)>=0},i.unlockSong=function(t){return!this.isSongUnlocked(t)&&(this.progress.unlockedSongs.push(t),this.saveProgress(),!0)},i.getUnlockedSongs=function(){return[].concat(this.progress.unlockedSongs)},i.getStatistics=function(){return Dt({},this.statistics)},i.updateStatistics=function(t,e,i,n,o,r,a,s){this.statistics.songPlayCounts[t]||(this.statistics.songPlayCounts[t]=0),this.statistics.songPlayCounts[t]++,this.statistics.totalPlayCount++,this.statistics.totalPlayTime+=e,this.statistics.perfectCount+=i,this.statistics.goodCount+=n,this.statistics.okCount+=o,this.statistics.missCount+=r,a>this.statistics.maxCombo&&(this.statistics.maxCombo=a);var l=(this.statistics.totalPlayCount-1)/this.statistics.totalPlayCount,c=1/this.statistics.totalPlayCount;this.statistics.averageAccuracy=this.statistics.averageAccuracy*l+s*c,this.saveStatistics()},i.getSongPlayCount=function(t){return this.statistics.songPlayCounts[t]||0},i.getAllSongPlayCounts=function(){return Dt({},this.statistics.songPlayCounts)},i.getHighScore=function(t){return this.highScores[t]||null},i.submitScore=function(t,e,i,n,o,r,a,s){var l=this.getHighScore(t),c=!l||e>l.score;if(c){var u={score:e,accuracy:i,maxCombo:n,perfect:o,good:r,ok:a,miss:s,date:Date.now()};this.highScores[t]=u,this.saveHighScores()}return c},i.getAllHighScores=function(){return Dt({},this.highScores)},i.clearAllData=function(){S.localStorage.removeItem(e.SETTINGS_KEY),S.localStorage.removeItem(e.PROGRESS_KEY),S.localStorage.removeItem(e.STATISTICS_KEY),S.localStorage.removeItem(e.HIGH_SCORES_KEY),this.settings={musicVolume:.8,sfxVolume:1,noteSpeed:1,audioOffset:0,vibrationEnabled:!0,notificationEnabled:!0,autoPlayCount:5,language:"en",lastPlayedSongId:"",visualEffectsLevel:2},this.progress={level:1,exp:0,coins:0,gems:0,unlockedSongs:[],completedTutorials:[]},this.statistics={totalPlayCount:0,totalPlayTime:0,perfectCount:0,goodCount:0,okCount:0,missCount:0,maxCombo:0,averageAccuracy:0,songPlayCounts:{}},this.highScores={},console.log("All player data cleared")},i.onSettingsChanged=function(t){this.onSettingsChangedCallback=t},i.onProgressChanged=function(t){this.onProgressChangedCallback=t},i.onCoinsChanged=function(t){this.onCoinsChangedCallback=t},i.completeTutorial=function(t){this.progress.completedTutorials.indexOf(t)<0&&(this.progress.completedTutorials.push(t),this.saveProgress())},i.isTutorialCompleted=function(t){return this.progress.completedTutorials.indexOf(t)>=0},i.exportData=function(){var t={settings:this.settings,progress:this.progress,statistics:this.statistics,highScores:this.highScores};return JSON.stringify(t)},i.importData=function(t){try{var e=JSON.parse(t);return e.settings&&(this.settings=e.settings),e.progress&&(this.progress=e.progress),e.statistics&&(this.statistics=e.statistics),e.highScores&&(this.highScores=e.highScores),this.saveAllData(),!0}catch(t){return console.error("Failed to import data:",t),!1}},Nt(e,null,[{key:"instance",get:function(){return e._instance}}]),e}(r))._instance=null,ew.SETTINGS_KEY="magicTiles_settings",ew.PROGRESS_KEY="magicTiles_progress",ew.STATISTICS_KEY="magicTiles_statistics",ew.HIGH_SCORES_KEY="magicTiles_highScores",tw=ew));t._RF.pop(),t._RF.push({},"0693cAdL+JB3Jn4GXrhDvzS","Tile",void 0);var Ow,Iw,xw,Rw,Lw,Nw,Fw,Dw,kw,zw,Vw,Bw,Hw,Uw,Gw,Ww,Zw,Yw,qw,jw,Kw,Xw,Qw,Jw,$w,tT,eT,iT,nT,oT,rT,aT,sT,lT,cT,uT,hT,pT,dT,fT,gT=e.ccclass,mT=e.property,vT=function(t){return t[t.WAITING=0]="WAITING",t[t.ACTIVE=1]="ACTIVE",t[t.HOLDING=2]="HOLDING",t[t.HIT=3]="HIT",t[t.MISSED=4]="MISSED",t[t.EXPIRED=5]="EXPIRED",t}({}),yT=function(t){return t[t.PERFECT=0]="PERFECT",t[t.GREAT=1]="GREAT",t[t.COOL=2]="COOL",t[t.MISS=3]="MISS",t}({}),bT=(ow=gT("Tile"),rw=mT(f),aw=mT(B),sw=mT(b),lw=mT(c),cw=mT({type:c,group:{name:"Long Press"}}),uw=mT({type:c,group:{name:"Long Press"}}),hw=mT({type:B,group:{name:"Long Press"}}),ow(((Aw=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,It(e,"background",fw,xt(e)),It(e,"transform",gw,xt(e)),It(e,"opacity",mw,xt(e)),It(e,"bufferHeight",vw,xt(e)),It(e,"nodeBeginning",yw,xt(e)),It(e,"nodeLongPress",bw,xt(e)),It(e,"nodeHoldEffect",_w,xt(e)),It(e,"holdEffectTransform",Sw,xt(e)),It(e,"normalColor",ww,xt(e)),It(e,"holdColor",Tw,xt(e)),It(e,"slideColor",Cw,xt(e)),It(e,"hitColor",Ew,xt(e)),It(e,"missColor",Pw,xt(e)),e.noteData=null,e.status=vT.WAITING,e.startY=0,e.targetY=0,e.lane=0,e.scrollSpeed=0,e.spawnTime=0,e.hitTime=0,e.touchStartTime=0,e.touchEndTime=0,e.isTouching=!1,e.isLongPress=!1,e.isSliding=!1,e.moveTween=null,e.scaleTween=null,e.opacityTween=null,e.holdRating=yT.MISS,e.movementStartTime=0,e.movementDuration=0,e.movementStartY=0,e.movementTargetY=0,e.isMovementActive=!1,e.tempVec3=new g,e.updatePriority=0,e.frameCounter=0,e.holdRange=0,e}Ot(e,t);var i=e.prototype;return i.onLoad=function(){this.background||(this.background=this.getComponent(f)),this.transform||(this.transform=this.getComponent(B)),this.opacity||(this.opacity=this.getComponent(b)),this.nodeHoldEffect&&!this.holdEffectTransform&&(this.holdEffectTransform=this.nodeHoldEffect.getComponent(B))},i.init=function(t,e,i,n,o,r,a){this.noteData=t,this.lane=e,this.startY=i,this.targetY=n,this.scrollSpeed=r,this.status=vT.WAITING,this.holdRange=0,this.isTouching=!1,this.touchStartTime=0,this.touchEndTime=0,this.node.position=new g(0,i,0),this.moveTween&&(this.moveTween.stop(),this.moveTween=null),this.scaleTween&&(this.scaleTween.stop(),this.scaleTween=null),this.opacityTween&&(this.opacityTween.stop(),this.opacityTween=null),this.opacity.opacity=255;var s=t.duration*r;this.transform.contentSize=new tt(o,Math.max(s,a)),this.transform.node.position=new g(0,-this.bufferHeight,0),this.nodeBeginning.active=!1,t.type===$S.HOLD&&t.duration>0?(this.isLongPress=!0,this.setLongPressNodeActive(!0),this.nodeHoldEffect&&(this.nodeHoldEffect.active=!1),this.holdEffectTransform&&(this.holdEffectTransform.height=0)):(this.isLongPress=!1,this.setLongPressNodeActive(!1)),t.type===$S.SLIDE?this.isSliding=!0:this.isSliding=!1,this.node.active=!0},i.setBeginningNodeActive=function(t){this.nodeBeginning.active=t},i.setLongPressNodeActive=function(t){this.nodeLongPress.active=t},i.getTileHeight=function(){return this.transform.contentSize.height},i.setBufferHeight=function(t){this.bufferHeight=t,this.transform.node.position=new g(0,-this.bufferHeight,0)},i.startMovement=function(t,e){this.status=vT.ACTIVE,this.spawnTime=Date.now()/1e3;var i=this.targetY-(t*this.scrollSpeed-(this.startY-this.targetY));this.movementStartTime=e,this.movementDuration=t,this.movementStartY=this.node.position.y,this.movementTargetY=i,this.isMovementActive=!0,this.moveTween&&(this.moveTween.stop(),this.moveTween=null)},i.setUpdatePriority=function(t){this.updatePriority=t},i.update=function(t){this.updatePriority>0&&(this.frameCounter=(this.frameCounter+1)%(this.updatePriority+1),0!==this.frameCounter)||(this.isMovementActive&&this.updateTileMovement(),this.status===vT.HOLDING&&this.isLongPress&&this.nodeHoldEffect&&this.updateHoldEffect(t))},i.updateTileMovement=function(){var t=this.calculateCurrentTime()-this.movementStartTime,e=Math.min(1,t/this.movementDuration),i=this.movementStartY+(this.movementTargetY-this.movementStartY)*e;return this.tempVec3.set(0,i,0),this.node.position=this.tempVec3,e>=1&&(this.isMovementActive=!1),i},i.calculateCurrentTime=function(){return Date.now()/1e3-this.spawnTime+this.movementStartTime},i.tap=function(t){if(!this.noteData||this.status!==vT.ACTIVE)return yT.MISS;this.touchStartTime=t,this.isTouching=!0;var e,i=this.noteData.time,n=Math.abs(t-i),o=O.deltaTime,r=Math.min(Math.max(o/(1/60),1),3),a=.3*r,s=.5*r;return e=n<.1*r?yT.PERFECT:n<a?yT.GREAT:n<s?yT.COOL:yT.MISS,this.noteData.type===$S.TAP?this.completeHit(e):this.noteData.type===$S.HOLD&&this.triggerLongPress(e),e},i.release=function(t){if(!this.isTouching||!this.isLongPress||!this.noteData)return yT.MISS;if(this.touchEndTime=t,this.isTouching=!1,this.noteData.type===$S.HOLD){var e=this.noteData.duration,i=this.touchEndTime-this.touchStartTime,n=O.deltaTime,o=Math.min(Math.max(n/(1/60),1),2),r=yT.COOL,a=i/e,s=.8/o;return a>=.95/o?r=yT.PERFECT:a>=s&&(r=yT.GREAT),this.completeHit(r),r}return yT.MISS},i.completeHit=function(t){t!==yT.MISS?(this.status=vT.HIT,this.playHitAnimation()):this.miss()},i.triggerLongPress=function(t){if(t!==yT.MISS){if(this.status=vT.HOLDING,this.holdRating=t,this.holdRange=Math.abs(this.node.position.y-this.targetY),this.nodeHoldEffect&&(this.nodeHoldEffect.active=!0,this.holdEffectTransform)){var e=this.holdEffectTransform.contentSize;this.holdEffectTransform.contentSize=new tt(e.width,0)}this.background.color=this.holdColor}else this.miss()},i.playHitAnimation=function(){this.background.color=this.normalColor,this.opacity.opacity=100},i.miss=function(){var t=this;this.status=vT.MISSED,e.missCount++,this.background.color=this.missColor,this.opacityTween=v(this.opacity).to(.3,{opacity:100}).call((function(){t.node.active=!1})).start()},i.getNote=function(){return this.noteData},i.getStatus=function(){return this.status},i.getLane=function(){return this.lane},i.isLongPressType=function(){return this.isLongPress},i.isSlideType=function(){return this.isSliding},i.recycle=function(){this.moveTween&&(this.moveTween.stop(),this.moveTween=null),this.scaleTween&&(this.scaleTween.stop(),this.scaleTween=null),this.opacityTween&&(this.opacityTween.stop(),this.opacityTween=null),this.status=vT.WAITING,this.noteData=null,this.isTouching=!1,this.isLongPress=!1,this.isSliding=!1,this.holdRange=0,this.nodeHoldEffect&&(this.nodeHoldEffect.active=!1),this.isMovementActive=!1,this.node.active=!1},i.updateHoldEffect=function(t){if(this.isTouching){this.holdRange=Math.min(this.holdRange+this.scrollSpeed*t,this.transform.contentSize.height-this.bufferHeight),this.nodeHoldEffect.active||(this.nodeHoldEffect.active=!0);var e=this.nodeHoldEffect.position,i=this.holdRange+this.bufferHeight;if(this.nodeHoldEffect.position=new g(e.x,i,e.z),this.holdEffectTransform){var n=this.holdEffectTransform.contentSize;this.holdEffectTransform.contentSize=new tt(n.width,i)}}},e}(r)).missCount=0,fw=Mt((dw=Aw).prototype,"background",[rw],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),gw=Mt(dw.prototype,"transform",[aw],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),mw=Mt(dw.prototype,"opacity",[sw],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),vw=Mt(dw.prototype,"bufferHeight",[mT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 200}}),yw=Mt(dw.prototype,"nodeBeginning",[lw],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),bw=Mt(dw.prototype,"nodeLongPress",[cw],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_w=Mt(dw.prototype,"nodeHoldEffect",[uw],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Sw=Mt(dw.prototype,"holdEffectTransform",[hw],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ww=Mt(dw.prototype,"normalColor",[mT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new X(0,0,0,255)}}),Tw=Mt(dw.prototype,"holdColor",[mT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new X(50,50,200,255)}}),Cw=Mt(dw.prototype,"slideColor",[mT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new X(50,200,50,255)}}),Ew=Mt(dw.prototype,"hitColor",[mT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new X(200,200,200,255)}}),Pw=Mt(dw.prototype,"missColor",[mT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new X(200,50,50,255)}}),pw=dw))||pw);t._RF.pop(),t._RF.push({},"38482d0oyNDQos3rad3oDFt","FeedbackManager",void 0);var _T,ST,wT,TT,CT,ET,PT,AT,MT,OT,IT,xT,RT,LT,NT,FT,DT,kT,zT,VT,BT,HT,UT,GT,WT,ZT,YT,qT,jT,KT,XT,QT,JT,$T,tC,eC,iC,nC,oC,rC,aC,sC,lC,cC,uC,hC,pC,dC,fC,gC,mC,vC,yC=e.ccclass,bC=e.property,_C=function(t){return t[t.PERFECT=0]="PERFECT",t[t.GREAT=1]="GREAT",t[t.COOL=2]="COOL",t[t.MISS=3]="MISS",t}(_C||{}),SC=(Ow=yC("FeedbackManager"),Iw=bC(l),xw=bC(l),Rw=bC(l),Lw=bC(l),Nw=bC(it),Fw=bC({type:[c],tooltip:"Feedback animation nodes in order: perfect, good, cool, miss"}),Dw=bC(ct),kw=bC(y),zw=bC(l),Vw=bC(c),Bw=bC(bt),Hw=bC(c),Uw=bC([Number]),Gw=bC(l),Ww=bC(l),Ow((qw=Mt((Yw=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,It(e,"perfectPrefab",qw,xt(e)),It(e,"greatPrefab",jw,xt(e)),It(e,"coolPrefab",Kw,xt(e)),It(e,"missPrefab",Xw,xt(e)),It(e,"animScoreFeedBacks",Qw,xt(e)),It(e,"feedbackNodes",Jw,xt(e)),It(e,"particleSystemPerfectFragments",$w,xt(e)),It(e,"comboLabel",tT,xt(e)),It(e,"comboPopupPrefab",eT,xt(e)),It(e,"feedbackContainer",iT,xt(e)),It(e,"gameCamera",nT,xt(e)),It(e,"cameraShakeNode",oT,xt(e)),e.audioManager=null,It(e,"perfectSoundEffect",rT,xt(e)),It(e,"greatSoundEffect",aT,xt(e)),It(e,"coolSoundEffect",sT,xt(e)),It(e,"missSoundEffect",lT,xt(e)),It(e,"comboSoundEffect",cT,xt(e)),It(e,"comboMilestones",uT,xt(e)),e.lanePositions=[],It(e,"feedbackDuration",hT,xt(e)),It(e,"feedbackScaleMultiplier",pT,xt(e)),It(e,"scorePopupPrefab",dT,xt(e)),It(e,"messagePopupPrefab",fT,xt(e)),e.feedbackAnimNames=["perfect","great","cool","miss"],e._scorePopupPool=[],e._messagePopupPool=[],e._scorePopupTemplate=null,e._messagePopupTemplate=null,e._poolRoot=null,e.comboTween=null,e}Ot(e,t);var i=e.prototype;return i.onLoad=function(){this.audioManager=XS.instance,this.comboLabel&&(this.comboLabel.string="",this.comboLabel.node.active=!1),this.feedbackContainer||(this.feedbackContainer=new c("FeedbackContainer"),this.feedbackContainer.parent=this.node),this.perfectPrefab&&Ip.instance.preloadPool(this.perfectPrefab,10),this.greatPrefab&&Ip.instance.preloadPool(this.greatPrefab,10),this.coolPrefab&&Ip.instance.preloadPool(this.coolPrefab,10),this.missPrefab&&Ip.instance.preloadPool(this.missPrefab,5),this.comboPopupPrefab&&Ip.instance.preloadPool(this.comboPopupPrefab,3),this.scorePopupPrefab?Ip.instance.preloadPool(this.scorePopupPrefab,1):this.createScorePopupPrefab(),this.messagePopupPrefab?Ip.instance.preloadPool(this.messagePopupPrefab,1):this.createMessagePopupPrefab()},i.createScorePopupPrefab=function(){var t=new c("ScorePopup"),e=t.addComponent(y);e.fontSize=36,e.color=new X(255,255,100,255),t.addComponent(b),this._poolRoot||(this._poolRoot=new c("PoolContainer"),this._poolRoot.parent=this.node,this._poolRoot.active=!1),this._scorePopupPool||(this._scorePopupPool=[]);for(var i=0;i<10;i++){var n=E(t);n.parent=this._poolRoot,n.active=!1,this._scorePopupPool.push(n)}this._scorePopupTemplate=t,t.parent=this._poolRoot,t.active=!1},i.createMessagePopupPrefab=function(){var t=new c("Message"),e=t.addComponent(y);e.fontSize=48,e.color=new X(255,255,255,255),t.addComponent(b),this._poolRoot||(this._poolRoot=new c("PoolContainer"),this._poolRoot.parent=this.node,this._poolRoot.active=!1),this._messagePopupPool||(this._messagePopupPool=[]);for(var i=0;i<3;i++){var n=E(t);n.parent=this._poolRoot,n.active=!1,this._messagePopupPool.push(n)}this._messagePopupTemplate=t,t.parent=this._poolRoot,t.active=!1},i.getScorePopupFromPool=function(){var t;return(t=this._scorePopupPool.length>0?this._scorePopupPool.pop():E(this._scorePopupTemplate)).active=!0,t},i.putScorePopupToPool=function(t){t&&(t.active=!1,t.removeFromParent(),this._scorePopupPool.push(t))},i.getMessagePopupFromPool=function(){var t;return(t=this._messagePopupPool.length>0?this._messagePopupPool.pop():E(this._messagePopupTemplate)).active=!0,t},i.putMessagePopupToPool=function(t){t&&(t.active=!1,t.removeFromParent(),this._messagePopupPool.push(t))},i.setLanePositions=function(t){this.lanePositions=t},i.showRatingFeedback=function(t,e){var i=this.getLanePosition(t),n=null,o="";switch(e){case yT.PERFECT:n=this.perfectPrefab,o=this.perfectSoundEffect,this.showFeedback(_C.PERFECT),this.particleSystemPerfectFragments.resetSystem();break;case yT.GREAT:n=this.greatPrefab,o=this.greatSoundEffect,this.showFeedback(_C.GREAT);break;case yT.COOL:n=this.coolPrefab,o=this.coolSoundEffect,this.showFeedback(_C.COOL);break;case yT.MISS:n=this.missPrefab,o=this.missSoundEffect,this.showFeedback(_C.MISS)}o&&this.audioManager.playSound(o),n&&this.showFeedbackPrefab(n,i)},i.showFeedbackPrefab=function(t,e){var i=Ip.instance.getNode(t,this.feedbackContainer);i.position=e;var n=i.getComponent(b)||i.addComponent(b);n.opacity=255,i.scale=new g(1,1,1),v(i).to(.3*this.feedbackDuration,{scale:new g(this.feedbackScaleMultiplier,this.feedbackScaleMultiplier,1)}).to(.7*this.feedbackDuration,{position:new g(e.x,e.y+50,e.z)}).start(),v(n).delay(.3*this.feedbackDuration).to(.7*this.feedbackDuration,{opacity:0}).call((function(){Ip.instance.putNode(i)})).start()},i.updateCombo=function(t){this.comboLabel&&(t>1?(this.comboLabel.string="x"+t,this.comboLabel.node.active=!0,this.comboTween&&this.comboTween.stop(),this.comboLabel.node.scale=new g(0,0,0),this.comboTween=v(this.comboLabel.node).to(.1,{scale:new g(1.2,1.2,1)}).delay(.5).to(.35,{scale:g.ZERO},{easing:_.backIn}).start(),this.isComboMilestone(t)&&this.showComboMilestone(t)):(this.comboLabel.string="",this.comboLabel.node.active=!1))},i.isComboMilestone=function(t){return this.comboMilestones.indexOf(t)>=0},i.showComboMilestone=function(t){if(this.audioManager.playSound(this.comboSoundEffect),this.comboPopupPrefab){var e=Ip.instance.getNode(this.comboPopupPrefab,this.feedbackContainer);e.position=new g(0,0,0),e.scale=new g(1,1,1);var i=e.getComponentInChildren(y);i&&(i.string=t+" COMBO!"),v(e).to(.2,{scale:new g(1.5,1.5,1)}).to(.2,{scale:new g(1,1,1)}).delay(1).to(.3,{position:new g(0,100,0)}).call((function(){Ip.instance.putNode(e)})).start(),this.shakeCamera(.2,t/300)}},i.shakeCamera=function(t,e){if(void 0===e&&(e=.5),this.gameCamera||this.cameraShakeNode){if(this.cameraShakeNode){var i=this.cameraShakeNode.getComponent(it);if(i)return i.play(),void this.scheduleOnce((function(){i.stop()}),t)}for(var n=this.cameraShakeNode||this.gameCamera.node,o=n.position.clone(),r=10*e,a=Math.floor(t/.05),s=v(n),l=0;l<a;l++){var c=(2*Math.random()-1)*r,u=(2*Math.random()-1)*r;s=s.to(.05,{position:new g(o.x+c,o.y+u,o.z)})}s.to(.1,{position:o}).start()}},i.showScorePopup=function(t,e){var i=this;if(void 0===e&&(e=new g(0,0,0)),this.scorePopupPrefab){var n=Ip.instance.getNode(this.scorePopupPrefab,this.feedbackContainer);n.position=e;var o=n.getComponent(y);o&&(o.string="+"+t);var r=n.getComponent(b);r&&(r.opacity=255),v(n).to(.5,{position:new g(e.x,e.y+80,e.z)}).delay(.2).to(.3,{position:new g(e.x,e.y+120,e.z)}).call((function(){Ip.instance.putNode(n)})).start()}else if(this._scorePopupTemplate){var a=this.getScorePopupFromPool();a.parent=this.feedbackContainer,a.position=e;var s=a.getComponent(y);s&&(s.string="+"+t);var l=a.getComponent(b);l&&(l.opacity=255),v(a).to(.5,{position:new g(e.x,e.y+80,e.z)}).delay(.2).to(.3,{position:new g(e.x,e.y+120,e.z)}).call((function(){i.putScorePopupToPool(a)})).start()}else{var u=new c("ScorePopup");u.parent=this.feedbackContainer,u.position=e;var h=u.getComponent(y)||u.addComponent(y);h.string="+"+t,h.fontSize=36,h.color=new X(255,255,100,255),v(u).to(.5,{position:new g(e.x,e.y+80,e.z)}).delay(.2).to(.3,{position:new g(e.x,e.y+120,e.z)}).call((function(){u.removeFromParent(),u.destroy()})).start()}},i.getLanePosition=function(t){return t>=0&&t<this.lanePositions.length?this.lanePositions[t]:new g(0,0,0)},i.showMessage=function(t,e,i){var n=this;if(void 0===e&&(e=2),void 0===i&&(i=80),this.messagePopupPrefab){var o=Ip.instance.getNode(this.messagePopupPrefab,this.feedbackContainer);o.position=new g(0,0,0);var r=o.getComponent(y);r&&(r.string=t,r.fontSize=i,r.lineHeight=i);var a=o.getComponent(b);a&&(a.opacity=0,v(a).to(.3,{opacity:255}).delay(e-.6).to(.3,{opacity:0}).call((function(){Ip.instance.putNode(o)})).start())}else if(this._messagePopupTemplate){var s=this.getMessagePopupFromPool();s.parent=this.feedbackContainer,s.position=new g(0,0,0);var l=s.getComponent(y);l&&(l.string=t,l.fontSize=i,l.lineHeight=i);var u=s.getComponent(b);u&&(u.opacity=0,v(u).to(.3,{opacity:255}).delay(e-.6).to(.3,{opacity:0}).call((function(){n.putMessagePopupToPool(s)})).start())}else{var h=new c("Message");h.parent=this.feedbackContainer,h.position=new g(0,0,0);var p=h.getComponent(y)||h.addComponent(y);p.string=t,p.fontSize=i,p.color=new X(255,255,255,255);var d=h.getComponent(b)||h.addComponent(b);d.opacity=0,v(d).to(.3,{opacity:255}).delay(e-.6).to(.3,{opacity:0}).call((function(){h.removeFromParent(),h.destroy()})).start()}},i.playHapticFeedback=function(t){if(void 0===t&&(t=.5),"navigator"in globalThis&&"vibrate"in navigator){var e=Math.floor(10+90*t);navigator.vibrate(e)}},i.showFeedback=function(t){for(var e,i=Ft(this.feedbackNodes);!(e=i()).done;){e.value.active=!1}this.feedbackNodes[t]&&(this.feedbackNodes[t].active=!0);var n=this.feedbackAnimNames[t];this.animScoreFeedBacks.play(n)},i.showPerfect=function(){this.showFeedback(_C.PERFECT)},i.showGood=function(){this.showFeedback(_C.GREAT)},i.showCool=function(){this.showFeedback(_C.COOL)},i.showMiss=function(){this.showFeedback(_C.MISS)},i.onDestroy=function(){this._scorePopupPool&&(this._scorePopupPool.forEach((function(t){t&&t.isValid&&t.destroy()})),this._scorePopupPool=[]),this._messagePopupPool&&(this._messagePopupPool.forEach((function(t){t&&t.isValid&&t.destroy()})),this._messagePopupPool=[]),this._scorePopupTemplate&&this._scorePopupTemplate.isValid&&(this._scorePopupTemplate.destroy(),this._scorePopupTemplate=null),this._messagePopupTemplate&&this._messagePopupTemplate.isValid&&(this._messagePopupTemplate.destroy(),this._messagePopupTemplate=null),this._poolRoot&&this._poolRoot.isValid&&(this._poolRoot.destroy(),this._poolRoot=null)},Nt(e,[{key:"perfectAnimNode",get:function(){return this.feedbackNodes[0]}},{key:"goodNode",get:function(){return this.feedbackNodes[1]}},{key:"coolNode",get:function(){return this.feedbackNodes[2]}},{key:"missNode",get:function(){return this.feedbackNodes[3]}}]),e}(r)).prototype,"perfectPrefab",[Iw],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),jw=Mt(Yw.prototype,"greatPrefab",[xw],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Kw=Mt(Yw.prototype,"coolPrefab",[Rw],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Xw=Mt(Yw.prototype,"missPrefab",[Lw],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Qw=Mt(Yw.prototype,"animScoreFeedBacks",[Nw],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Jw=Mt(Yw.prototype,"feedbackNodes",[Fw],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),$w=Mt(Yw.prototype,"particleSystemPerfectFragments",[Dw],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),tT=Mt(Yw.prototype,"comboLabel",[kw],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),eT=Mt(Yw.prototype,"comboPopupPrefab",[zw],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),iT=Mt(Yw.prototype,"feedbackContainer",[Vw],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),nT=Mt(Yw.prototype,"gameCamera",[Bw],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),oT=Mt(Yw.prototype,"cameraShakeNode",[Hw],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),rT=Mt(Yw.prototype,"perfectSoundEffect",[bC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"perfect"}}),aT=Mt(Yw.prototype,"greatSoundEffect",[bC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"good"}}),sT=Mt(Yw.prototype,"coolSoundEffect",[bC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"ok"}}),lT=Mt(Yw.prototype,"missSoundEffect",[bC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"miss"}}),cT=Mt(Yw.prototype,"comboSoundEffect",[bC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"combo"}}),uT=Mt(Yw.prototype,"comboMilestones",[Uw],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[50,100,200,300,500]}}),hT=Mt(Yw.prototype,"feedbackDuration",[bC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.7}}),pT=Mt(Yw.prototype,"feedbackScaleMultiplier",[bC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1.5}}),dT=Mt(Yw.prototype,"scorePopupPrefab",[Gw],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),fT=Mt(Yw.prototype,"messagePopupPrefab",[Ww],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Zw=Yw))||Zw);t._RF.pop(),t._RF.push({},"974fdPppslMoKLXs565FEx6","MTUIManager",void 0);var wC,TC,CC,EC,PC,AC,MC,OC,IC,xC,RC,LC,NC,FC,DC,kC,zC=e.ccclass,VC=e.property,BC=function(t){return t[t.NONE=0]="NONE",t[t.MAIN_MENU=1]="MAIN_MENU",t[t.SONG_SELECT=2]="SONG_SELECT",t[t.GAMEPLAY=3]="GAMEPLAY",t[t.PAUSE_MENU=4]="PAUSE_MENU",t[t.RESULTS=5]="RESULTS",t[t.SETTINGS=6]="SETTINGS",t[t.TUTORIAL=7]="TUTORIAL",t[t.SHOP=8]="SHOP",t}({}),HC=(_T=zC("MTUIManager"),ST=VC(c),wT=VC(c),TT=VC(c),CT=VC(c),ET=VC(c),PT=VC(c),AT=VC(c),MT=VC(c),OT=VC(c),IT=VC(y),xT=VC(y),RT=VC(y),LT=VC(ut),NT=VC(f),FT=VC(y),DT=VC(y),kT=VC(y),zT=VC(y),VT=VC(y),BT=VC(y),HT=VC(y),UT=VC(y),GT=VC(y),_T(((vC=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,It(e,"mainMenuScreen",YT,xt(e)),It(e,"songSelectScreen",qT,xt(e)),It(e,"gameplayScreen",jT,xt(e)),It(e,"pauseMenuScreen",KT,xt(e)),It(e,"resultsScreen",XT,xt(e)),It(e,"settingsScreen",QT,xt(e)),It(e,"tutorialScreen",JT,xt(e)),It(e,"shopScreen",$T,xt(e)),It(e,"loadingScreen",tC,xt(e)),It(e,"scoreLabel",eC,xt(e)),It(e,"songTimeLabel",iC,xt(e)),It(e,"comboLabel",nC,xt(e)),It(e,"progressBar",oC,xt(e)),It(e,"healthBar",rC,xt(e)),It(e,"songTitleLabel",aC,xt(e)),It(e,"songArtistLabel",sC,xt(e)),It(e,"finalScoreLabel",lC,xt(e)),It(e,"accuracyLabel",cC,xt(e)),It(e,"maxComboLabel",uC,xt(e)),It(e,"perfectCountLabel",hC,xt(e)),It(e,"goodCountLabel",pC,xt(e)),It(e,"okCountLabel",dC,xt(e)),It(e,"missCountLabel",fC,xt(e)),It(e,"transitionDuration",gC,xt(e)),It(e,"popupScaleDuration",mC,xt(e)),e.currentUIState=BC.NONE,e.previousUIState=BC.NONE,e.isTransitioning=!1,e.audioManager=null,e.screenWidth=0,e.screenHeight=0,e.safeAreaTop=0,e.safeAreaBottom=0,e.isPortrait=!0,e}Ot(e,t);var i=e.prototype;return i.onLoad=function(){e._instance=this,this.audioManager=XS.instance,this.initializeUI(),q.on("design-resolution-changed",this.onScreenResize,this),q.on("canvas-resize",this.onScreenResize,this),this.onScreenResize()},i.onDestroy=function(){q.off("design-resolution-changed",this.onScreenResize,this),q.off("canvas-resize",this.onScreenResize,this),e._instance===this&&(e._instance=null)},i.initializeUI=function(){this.hideAllScreens(),this.changeUIState(BC.MAIN_MENU)},i.onScreenResize=function(){var t=q.getVisibleSize();if(this.screenWidth=t.width,this.screenHeight=t.height,this.isPortrait=this.screenHeight>this.screenWidth,S.platform===S.Platform.MOBILE_BROWSER||S.platform===S.Platform.IOS||S.platform===S.Platform.ANDROID){var e=S.getSafeAreaRect();this.safeAreaTop=e.y,this.safeAreaBottom=t.height-(e.y+e.height)}this.adjustLayoutForScreenSize()},i.adjustLayoutForScreenSize=function(){this.updateWidgetsInNode(this.node),this.isPortrait?this.applyPortraitLayout():this.applyLandscapeLayout()},i.applyPortraitLayout=function(){if(this.scoreLabel&&(this.scoreLabel.node.position=new g(0,.4*this.screenHeight,0)),this.comboLabel&&(this.comboLabel.node.position=new g(0,.3*this.screenHeight,0)),this.progressBar){var t=this.progressBar.getComponent(B);t&&(t.width=.8*this.screenWidth)}console.log("Applied portrait layout")},i.applyLandscapeLayout=function(){if(this.scoreLabel&&(this.scoreLabel.node.position=new g(.3*this.screenWidth,.4*this.screenHeight,0)),this.comboLabel&&(this.comboLabel.node.position=new g(.3*this.screenWidth,.3*this.screenHeight,0)),this.progressBar){var t=this.progressBar.getComponent(B);t&&(t.width=.6*this.screenWidth)}console.log("Applied landscape layout")},i.updateWidgetsInNode=function(t){var e=t.getComponent(Y);e&&e.updateAlignment();for(var i=0;i<t.children.length;i++)this.updateWidgetsInNode(t.children[i])},i.changeUIState=function(t){var e=this;if(!this.isTransitioning&&t!==this.currentUIState){this.isTransitioning=!0,this.previousUIState=this.currentUIState,this.currentUIState=t;var i=this.getScreenForState(this.previousUIState);if(i)v(i).to(this.transitionDuration/2,{scale:new g(.9,.9,1)}).call((function(){i.active=!1;var n=e.getScreenForState(t);n?(n.active=!0,n.scale=new g(.9,.9,1),v(n).to(e.transitionDuration/2,{scale:new g(1,1,1)}).call((function(){e.isTransitioning=!1,e.onUIStateChanged(t)})).start()):e.isTransitioning=!1})).start();else{var n=this.getScreenForState(t);n?(n.active=!0,n.scale=new g(.9,.9,1),v(n).to(this.transitionDuration/2,{scale:new g(1,1,1)}).call((function(){e.isTransitioning=!1,e.onUIStateChanged(t)})).start()):this.isTransitioning=!1}}},i.getScreenForState=function(t){switch(t){case BC.MAIN_MENU:return this.mainMenuScreen;case BC.SONG_SELECT:return this.songSelectScreen;case BC.GAMEPLAY:return this.gameplayScreen;case BC.PAUSE_MENU:return this.pauseMenuScreen;case BC.RESULTS:return this.resultsScreen;case BC.SETTINGS:return this.settingsScreen;case BC.TUTORIAL:return this.tutorialScreen;case BC.SHOP:return this.shopScreen;default:return null}},i.onUIStateChanged=function(t){switch(t){case BC.MAIN_MENU:this.audioManager.playSound("menu_music");break;case BC.SONG_SELECT:break;case BC.GAMEPLAY:this.updateGameplayUI();break;case BC.RESULTS:}},i.hideAllScreens=function(){this.mainMenuScreen&&(this.mainMenuScreen.active=!1),this.songSelectScreen&&(this.songSelectScreen.active=!1),this.gameplayScreen&&(this.gameplayScreen.active=!1),this.pauseMenuScreen&&(this.pauseMenuScreen.active=!1),this.resultsScreen&&(this.resultsScreen.active=!1),this.settingsScreen&&(this.settingsScreen.active=!1),this.tutorialScreen&&(this.tutorialScreen.active=!1),this.shopScreen&&(this.shopScreen.active=!1),this.loadingScreen&&(this.loadingScreen.active=!1)},i.showLoadingScreen=function(t){this.loadingScreen&&(this.loadingScreen.active=t)},i.updateGameplayUI=function(){},i.updateScoreDisplay=function(t){this.scoreLabel&&(this.scoreLabel.string=t.toLocaleString())},i.updateSongTimeDisplay=function(t){this.songTimeLabel&&(this.songTimeLabel.string=this.formatTime(t))},i.formatTime=function(t){var e=Math.floor(t/60),i=Math.floor(t%60);return e+":"+(i<10?"0"+i:i)},i.updateComboDisplay=function(t){this.comboLabel&&(t>1?(this.comboLabel.string=t+"x",this.comboLabel.node.active=!0,v(this.comboLabel.node).to(.1,{scale:new g(1.2,1.2,1)}).to(.1,{scale:new g(1,1,1)}).start()):(this.comboLabel.string="",this.comboLabel.node.active=!1))},i.updateProgressBar=function(t){this.progressBar&&(this.progressBar.progress=t)},i.updateHealthBar=function(t){},i.prepareResultsScreen=function(t,e,i,n){if(void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n={perfect:0,good:0,ok:0,miss:0}),this.resultsScreen){this.finalScoreLabel&&(this.finalScoreLabel.string=t.toLocaleString()),this.accuracyLabel&&(this.accuracyLabel.string=e.toFixed(2)+"%"),this.maxComboLabel&&(this.maxComboLabel.string=i+"x"),this.perfectCountLabel&&(this.perfectCountLabel.string=n.perfect.toString()),this.goodCountLabel&&(this.goodCountLabel.string=n.good.toString()),this.okCountLabel&&(this.okCountLabel.string=n.ok.toString()),this.missCountLabel&&(this.missCountLabel.string=n.miss.toString());var o=this.resultsScreen.getChildByName("HighScoreLabel");o&&(o.active=!1)}},i.showPopup=function(t,e,i){var n,o,r,a;void 0===e&&(e=""),void 0===i&&(i="OK");var s=this.node.getChildByName("PopupTemplate");if(s){var l=E(s);l.parent=this.node,l.active=!0;var c=null==(n=l.getChildByName("Title"))?void 0:n.getComponent(y),u=null==(o=l.getChildByName("Message"))?void 0:o.getComponent(y),h=null==(r=l.getChildByName("OkButton"))?void 0:r.getComponent(N),p=null==h||null==(a=h.node.getChildByName("Label"))?void 0:a.getComponent(y);if(c&&(c.string=e,c.node.active=e.length>0),u&&(u.string=t),p&&(p.string=i),h){var d=new F;d.target=l,d.component="UIManager",d.handler="onPopupButtonClicked",h.clickEvents.push(d)}return l.scale=new g(.8,.8,1),v(l).to(this.popupScaleDuration,{scale:new g(1,1,1)}).start(),l}},i.closePopup=function(t){v(t).to(this.popupScaleDuration,{scale:new g(.8,.8,1)}).call((function(){t.destroy()})).start()},i.onPopupButtonClicked=function(t,e){var i=t.target;if(i){var n=i.parent;n&&this.closePopup(n)}},i.navigateToMainMenu=function(){this.changeUIState(BC.MAIN_MENU)},i.navigateToSongSelect=function(){this.changeUIState(BC.SONG_SELECT)},i.navigateToSettings=function(){this.changeUIState(BC.SETTINGS)},i.navigateToTutorial=function(){this.changeUIState(BC.TUTORIAL)},i.navigateToShop=function(){this.changeUIState(BC.SHOP)},i.handleBackNavigation=function(){switch(this.currentUIState){case BC.SONG_SELECT:case BC.SETTINGS:case BC.TUTORIAL:case BC.SHOP:this.navigateToMainMenu();break;case BC.GAMEPLAY:case BC.PAUSE_MENU:break;case BC.RESULTS:this.navigateToSongSelect()}},Nt(e,null,[{key:"instance",get:function(){return e._instance?e._instance:null}}]),e}(r))._instance=null,YT=Mt((ZT=vC).prototype,"mainMenuScreen",[ST],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),qT=Mt(ZT.prototype,"songSelectScreen",[wT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),jT=Mt(ZT.prototype,"gameplayScreen",[TT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),KT=Mt(ZT.prototype,"pauseMenuScreen",[CT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),XT=Mt(ZT.prototype,"resultsScreen",[ET],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),QT=Mt(ZT.prototype,"settingsScreen",[PT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),JT=Mt(ZT.prototype,"tutorialScreen",[AT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),$T=Mt(ZT.prototype,"shopScreen",[MT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),tC=Mt(ZT.prototype,"loadingScreen",[OT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),eC=Mt(ZT.prototype,"scoreLabel",[IT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),iC=Mt(ZT.prototype,"songTimeLabel",[xT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),nC=Mt(ZT.prototype,"comboLabel",[RT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),oC=Mt(ZT.prototype,"progressBar",[LT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),rC=Mt(ZT.prototype,"healthBar",[NT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),aC=Mt(ZT.prototype,"songTitleLabel",[FT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),sC=Mt(ZT.prototype,"songArtistLabel",[DT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),lC=Mt(ZT.prototype,"finalScoreLabel",[kT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),cC=Mt(ZT.prototype,"accuracyLabel",[zT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),uC=Mt(ZT.prototype,"maxComboLabel",[VT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),hC=Mt(ZT.prototype,"perfectCountLabel",[BT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),pC=Mt(ZT.prototype,"goodCountLabel",[HT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),dC=Mt(ZT.prototype,"okCountLabel",[UT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),fC=Mt(ZT.prototype,"missCountLabel",[GT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),gC=Mt(ZT.prototype,"transitionDuration",[VC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.3}}),mC=Mt(ZT.prototype,"popupScaleDuration",[VC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.2}}),WT=ZT))||WT);t._RF.pop(),t._RF.push({},"bf871T6LV9LXZ2T/yZkKnKK","TileManager",void 0);var UC,GC,WC,ZC,YC,qC,jC=e.ccclass,KC=e.property,XC=(wC=jC("TileManager"),TC=KC(l),CC=KC([c]),wC((AC=Mt((PC=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,It(e,"tilePrefab",AC,xt(e)),It(e,"laneContainers",MC,xt(e)),It(e,"spawnPositionY",OC,xt(e)),It(e,"targetPositionY",IC,xt(e)),It(e,"recyclePositionY",xC,xt(e)),It(e,"lookAheadTime",RC,xt(e)),It(e,"defaultScrollSpeed",LC,xt(e)),e.scrollSpeed=600,It(e,"laneWidth",NC,xt(e)),It(e,"maxPoolSize",FC,xt(e)),e.beatmapManager=null,e.audioManager=null,e.tilePool=[],e.activeTiles=[],e.nextNoteIndex=0,e.gameTime=0,e.gameState="stopped",e._updateScheduled=!1,It(e,"isAutoplay",DC,xt(e)),It(e,"missThreshold",kC,xt(e)),e.touchedTiles=new Map,e.minTileHeight=300,e.lastAudioTimeCheck=0,e.cachedAudioTime=0,e.audioTimeCheckInterval=.05,e.timeSinceLastAudioCheck=0,e.laneArrays=[],e.tempVec3=new g,e.lanePositionVec3=new g,e.tilePositionsY=null,e.tileIndices=new Map,e.nextTileIndex=0,e.updateBudgetPerFrame=20,e.updateQueue=[],e.fpsHistory=[],e.lastFrameTime=0,e.frameCounter=0,e.performanceLevel="high",e}Ot(e,t);var i=e.prototype;return i.initialize=function(t,e){this.beatmapManager=t,this.audioManager=e,this.initTilePool()},i.onLoad=function(){this.beatmapManager||(this.beatmapManager=nw.instance),this.audioManager||(this.audioManager=XS.instance),this.initTilePool()},i.start=function(){this.ensureLaneContainers()},i.initTilePool=function(){var t;this.tilePool=[];var e=null==(t=this.beatmapManager)?void 0:t.getNotes();if(e&&e.length>0){var i=this.spawnPositionY-this.recyclePositionY,n=e[e.length-1].time-e[0].time,o=this.scrollSpeed||this.defaultScrollSpeed,r=Math.ceil(e.length*(i/(o*Math.max(.1,n))));this.maxPoolSize=Math.max(this.maxPoolSize,r+10),console.log("Dynamic pool size calculated: "+this.maxPoolSize+" (estimated visible: "+r+")")}for(var a=0;a<this.maxPoolSize;a++){var s=E(this.tilePrefab),l=s.getComponent(bT);s.active=!1,this.tilePool.push(l)}this.tilePositionsY=new Float32Array(this.maxPoolSize),this.tileIndices=new Map,this.nextTileIndex=0,this.initLaneArrays()},i.initLaneArrays=function(){var t=Math.max(4,this.laneContainers.length);this.laneArrays=new Array(t);for(var e=0;e<t;e++)this.laneArrays[e]=[]},i.ensureLaneContainers=function(){if(this.laneContainers.length<4){console.warn("TileManager needs 4 lane containers, but only "+this.laneContainers.length+" were provided.");for(var t=this.laneContainers.length;t<4;t++){var e=new c("Lane_"+t);e.parent=this.node,this.lanePositionVec3.set((t-2+.5)*this.laneWidth,0,0),e.position=this.lanePositionVec3,this.laneContainers.push(e)}}this.laneWidth=this.laneContainers[0].getComponent(B).width,this.initLaneArrays()},i.initGame=function(){this.clearActiveTiles(),this.nextNoteIndex=0,this.gameTime=0,this.activeTiles=[],this.touchedTiles.clear();for(var t=0;t<this.laneArrays.length;t++)this.laneArrays[t].length=0;this.calculateDynamicScrollSpeed()},i.startGame=function(){this.gameState="playing",this._updateScheduled||(M.getScheduler().schedule(this.update,this,0),this._updateScheduled=!0),this.fpsHistory=[],this.lastFrameTime=Date.now(),this.frameCounter=0,this.performanceLevel="high"},i.stopGame=function(){this.gameState="stopped",this._updateScheduled&&(M.getScheduler().unschedule(this.update,this),this._updateScheduled=!1),this.clearActiveTiles()},i.pauseGame=function(){this.gameState="paused"},i.resumeGame=function(){this.gameState="playing",this._updateScheduled||(M.getScheduler().schedule(this.update,this,0),this._updateScheduled=!0)},i.update=function(t){this.monitorPerformance(t),"playing"===this.gameState&&(this.audioManager?this.gameTime=this.audioManager.getEstimatedAudioTime():(this.timeSinceLastAudioCheck+=t,this.timeSinceLastAudioCheck>=this.audioTimeCheckInterval?(this.cachedAudioTime=XS.instance.getAudioTime(),this.timeSinceLastAudioCheck=0):this.cachedAudioTime+=t,this.gameTime=this.cachedAudioTime),Math.random()<.03&&HC.instance.updateSongTimeDisplay(this.gameTime),this.spawnTiles(),this.balancedUpdateActiveTiles())},i.updateTilePriorities=function(){for(var t,e=Ft(this.activeTiles);!(t=e()).done;){var i=t.value,n=Math.abs(i.node.position.y-this.targetPositionY),o=0;n>1500?o=2:n>1e3&&(o=1),i.setUpdatePriority(o)}},i.spawnTiles=function(){var t=this.beatmapManager.getNotes();if(t.length)for(var e=this.gameTime+this.lookAheadTime;this.nextNoteIndex<t.length&&t[this.nextNoteIndex].time<=e;)this.spawnTile(t[this.nextNoteIndex]),this.nextNoteIndex++},i.updateTilePosition=function(t,e){this.tempVec3.set(0,e,0),t.node.position=this.tempVec3},i.spawnTile=function(t){var e=this.getTileFromPool();if(e){var i=t.lane;if(i<0||i>=this.laneContainers.length)console.error("Invalid lane "+i+" for note "+t.midi);else{var n=this.laneContainers[i];e.node.parent=n,e.init(t,i,this.spawnPositionY,this.targetPositionY,this.laneWidth,this.scrollSpeed,this.minTileHeight),e.setBufferHeight(this.minTileHeight/2);var o=this.nextTileIndex%this.maxPoolSize;this.tileIndices.set(e,o),this.tilePositionsY[o]=this.spawnPositionY,this.nextTileIndex++,this.updateTilePosition(e,this.spawnPositionY);var r=this.spawnPositionY-this.recyclePositionY+e.getTileHeight()+500,a=(this.spawnPositionY-this.targetPositionY)/this.scrollSpeed,s=r/this.scrollSpeed,l=t.time-a;if(l<=this.gameTime)e.startMovement(s,l);else{var c=l-this.gameTime;this.scheduleOnce((function(){e.node.active&&e.startMovement(s,l)}),c)}this.activeTiles.push(e),i>=0&&i<this.laneArrays.length&&this.laneArrays[i].push(e)}}else console.warn("Tile pool exhausted, cannot spawn more tiles")},i.balancedUpdateActiveTiles=function(){var t=this;if(this.isAutoplay&&this.handleAutoplay(),this.updateQueue.length>0)for(var e=Math.min(this.updateBudgetPerFrame/2,this.updateQueue.length),i=0;i<e;i++){var n=this.updateQueue.shift();this.processTileUpdate(n)}if(this.activeTiles.length>this.updateBudgetPerFrame){this.activeTiles.sort((function(e,i){return Math.abs(e.node.position.y-t.targetPositionY)-Math.abs(i.node.position.y-t.targetPositionY)}));for(var o=0;o<this.updateBudgetPerFrame;o++)o<this.activeTiles.length&&this.processTileUpdate(this.activeTiles[o]);for(var r=this.updateBudgetPerFrame;r<this.activeTiles.length;r++)r<this.activeTiles.length&&!this.isInUpdateQueue(this.activeTiles[r])&&this.updateQueue.push(this.activeTiles[r])}else for(var a,s=Ft(this.activeTiles);!(a=s()).done;){var l=a.value;this.processTileUpdate(l)}this.checkRecycleTiles()},i.processTileUpdate=function(t){t.getStatus()===vT.ACTIVE&&t.node.position.y<=this.missThreshold&&t.miss()},i.checkRecycleTiles=function(){for(var t=0;t<this.activeTiles.length;){var e=this.activeTiles[t];if(e.node.position.y+e.getTileHeight()<=this.recyclePositionY){e.getStatus()===vT.HOLDING&&e.isLongPressType()&&e.release(this.gameTime),this.returnTileToPool(e),this.activeTiles[t]=this.activeTiles[this.activeTiles.length-1],this.activeTiles.pop();var i=this.updateQueue.indexOf(e);-1!==i&&this.updateQueue.splice(i,1)}else t++}},i.handleAutoplay=function(){var t=this;if(this.isAutoplay){for(var e,i=this.activeTiles.filter((function(e){if(e.getStatus()!==vT.ACTIVE)return!1;var i=e.getNote();return!!i&&i.time-t.gameTime<=.05})),n=Ft(i);!(e=n()).done;){var o=e.value,r=o.getLane();if(o.getNote())if(o.isLongPressType()){if(!this.touchedTiles.has(r))o.tap(this.gameTime)!==yT.MISS&&this.touchedTiles.set(r,o)}else o.tap(this.gameTime)}this.touchedTiles.forEach((function(e,i){var n=e.getNote();n&&e.getStatus()===vT.HOLDING?n.time+n.duration<=t.gameTime&&(e.release(t.gameTime),t.touchedTiles.delete(i)):t.touchedTiles.delete(i)}))}},i.toggleAutoplay=function(t){this.isAutoplay=void 0!==t?t:!this.isAutoplay,console.log("Autoplay "+(this.isAutoplay?"enabled":"disabled"))},i.isAutoplayEnabled=function(){return this.isAutoplay},i.clearActiveTiles=function(){for(var t,e=Ft(this.activeTiles);!(t=e()).done;){var i=t.value;this.returnTileToPool(i)}this.activeTiles=[]},i.getTileFromPool=function(){if(0===this.tilePool.length)return this.activeTiles.length<this.maxPoolSize?E(this.tilePrefab).getComponent(bT):null;var t=this.tilePool.pop();return t.node.active=!0,t},i.returnTileToPool=function(t){var e=t.getLane();if(this.touchedTiles.has(e)&&this.touchedTiles.get(e)===t&&(t.getStatus()===vT.HOLDING&&t.release(this.gameTime),this.touchedTiles.delete(e)),t.recycle(),this.tilePool.push(t),e>=0&&e<this.laneArrays.length){var i=this.laneArrays[e],n=i.indexOf(t);-1!==n&&(i[n]=i[i.length-1],i.pop())}this.tileIndices.delete(t)},i.handleLaneTouch=function(t,e){var i=this;if(console.log("handleLaneTouch",t,e),!e){var n=this.touchedTiles.get(t);if(n&&n.isLongPressType())return this.touchedTiles.delete(t),n.release(this.gameTime)}var o=(t>=0&&t<this.laneArrays.length?this.laneArrays[t]:[]).filter((function(t){return t.getStatus()===vT.ACTIVE}));if(o.sort((function(t,e){var n=t.getNote(),o=e.getNote();return n&&o?Math.abs(n.time-i.gameTime)-Math.abs(o.time-i.gameTime):0})),0===o.length)return yT.MISS;var r=o[0];if(e){var a=r.tap(this.gameTime);return r.isLongPressType()&&a!==yT.MISS&&this.touchedTiles.set(t,r),a}return yT.MISS},i.setScrollSpeed=function(t){this.scrollSpeed;this.scrollSpeed=t},i.getScrollSpeed=function(){return this.scrollSpeed},i.getActiveTileCount=function(){return this.activeTiles.length},i.getGameTime=function(){return this.gameTime},i.setGameTime=function(t){this.gameTime=t},i.calculateDynamicScrollSpeed=function(){var t=this.beatmapManager.getNotes();if(!t||t.length<2)this.scrollSpeed=this.defaultScrollSpeed;else{for(var e=.5*this.defaultScrollSpeed,i=1.5*this.defaultScrollSpeed,n=!0,o=1;o<t.length;o++)if(t[o].time<t[o-1].time){n=!1;break}for(var r=n?t:[].concat(t).sort((function(t,e){return t.time-e.time})),a=Number.MAX_VALUE,s=0,l=0,c=0,u=1;u<r.length;u++){var h=r[u].time-r[u-1].time;h>0&&(h<a&&(a=h),s+=h,l++);var p=r[u].duration;p>c&&(c=p)}var d=l>0?s/l:1;a===Number.MAX_VALUE&&(a=1);var f=Math.min(1,.7*a+.3),g=Math.min(1,.5*d+.5),m=1;c>0&&(m=Math.max(.7,1-.1*c));var v=e+(i-e)*(.6*f+.25*g+.15*m);this.setScrollSpeed(2.5*v),"high"===this.performanceLevel&&console.log("Dynamic scroll speed: "+Math.round(this.scrollSpeed)+" px/s")}},i.updateTilePositionsFromArray=function(){for(var t,e=Ft(this.activeTiles);!(t=e()).done;){var i=t.value,n=this.tileIndices.get(i);void 0!==n&&this.updateTilePosition(i,this.tilePositionsY[n])}},i.isInUpdateQueue=function(t){return-1!==this.updateQueue.findIndex((function(e){return e===t}))},i.monitorPerformance=function(t){this.frameCounter++;var e=Date.now();if(e-this.lastFrameTime>1e3){var i=this.frameCounter;this.fpsHistory.push(i),this.fpsHistory.length>5&&this.fpsHistory.shift();var n=this.fpsHistory.reduce((function(t,e){return t+e}),0)/this.fpsHistory.length;this.adjustPerformanceSettings(n),this.frameCounter=0,this.lastFrameTime=e}},i.adjustPerformanceSettings=function(t){var e=this.performanceLevel;if(this.performanceLevel=t<30?"low":t<50?"medium":"high",e!==this.performanceLevel)switch(console.log("Performance level changed: "+e+" -> "+this.performanceLevel+" (Average FPS: "+t.toFixed(1)+")"),this.performanceLevel){case"low":this.updateBudgetPerFrame=10,this.audioTimeCheckInterval=60;break;case"medium":this.updateBudgetPerFrame=15,this.audioTimeCheckInterval=45;break;case"high":this.updateBudgetPerFrame=20,this.audioTimeCheckInterval=30}},i.setupBeginningTile=function(){this.clearActiveTiles(),this.gameState="paused";var t=Math.min(Math.floor(this.laneContainers.length/2),this.laneContainers.length-1);this.createBeginningTile(t)},i.createBeginningTile=function(t){var e=this.getTileFromPool();if(e){var i={midi:60,time:0,lane:t,type:0,duration:.3,durationTicks:0,velocity:100},n=this.laneContainers[t];e.node.parent=n;var o=this.targetPositionY;e.init(i,t,o,o,this.laneWidth,this.scrollSpeed,this.minTileHeight),e.setBufferHeight(this.minTileHeight/2),e.setBeginningNodeActive(!0),e.node.name="beginning_tile",this.activeTiles.push(e),t>=0&&t<this.laneArrays.length&&this.laneArrays[t].push(e)}else console.error("Failed to create beginning tile - pool empty")},i.checkBeginningTileTap=function(t){for(var e=0;e<this.activeTiles.length;e++){var i=this.activeTiles[e];if("beginning_tile"===i.node.name&&i.getLane()===t)return i.startMovement(1,this.gameTime),!0}return!1},i.removeTile=function(t){var e=this.activeTiles.indexOf(t);e>=0&&this.activeTiles.splice(e,1);var i=t.getLane();if(i>=0&&i<this.laneArrays.length){var n=this.laneArrays[i].indexOf(t);n>=0&&this.laneArrays[i].splice(n,1)}this.returnTileToPool(t)},e}(r)).prototype,"tilePrefab",[TC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),MC=Mt(PC.prototype,"laneContainers",[CC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),OC=Mt(PC.prototype,"spawnPositionY",[KC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1200}}),IC=Mt(PC.prototype,"targetPositionY",[KC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-400}}),xC=Mt(PC.prototype,"recyclePositionY",[KC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-1500}}),RC=Mt(PC.prototype,"lookAheadTime",[KC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 4}}),LC=Mt(PC.prototype,"defaultScrollSpeed",[KC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 600}}),NC=Mt(PC.prototype,"laneWidth",[KC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 160}}),FC=Mt(PC.prototype,"maxPoolSize",[KC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 50}}),DC=Mt(PC.prototype,"isAutoplay",[KC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),kC=Mt(PC.prototype,"missThreshold",[KC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-450}}),EC=PC))||EC);t._RF.pop(),t._RF.push({},"7032aoU25dAwZKrnbS2Peig","TapValidator",void 0);var QC,JC,$C,tE,eE,iE,nE,oE,rE,aE,sE,lE,cE,uE,hE,pE,dE=e.ccclass,fE=e.property,gE=dE("TapValidator")((WC=Mt((GC=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,It(e,"audioOffset",WC,xt(e)),It(e,"perfectWindow",ZC,xt(e)),It(e,"goodWindow",YC,xt(e)),It(e,"okWindow",qC,xt(e)),e.beatmapManager=null,e.combo={count:0,maxCount:0,lastRating:yT.MISS,perfectCount:0,goodCount:0,okCount:0,missCount:0},e.onComboChangeCallbacks=[],e.onRatingCallbacks=[],e}Ot(e,t);var i=e.prototype;return i.onLoad=function(){this.resetCombo(),this.beatmapManager=nw.instance},i.validateTap=function(t,e,i){return this.updateCombo(i),console.log("combo",this.combo),this.onRatingCallbacks.forEach((function(e){return e(t,i)})),i},i.updateCombo=function(t){var e=this;switch(t){case yT.PERFECT:this.combo.perfectCount++,this.combo.count++;break;case yT.GREAT:this.combo.goodCount++,this.combo.count=0;break;case yT.COOL:this.combo.okCount++,this.combo.count=0;break;case yT.MISS:this.combo.missCount++,this.combo.count=0}this.combo.count>this.combo.maxCount&&(this.combo.maxCount=this.combo.count),this.combo.lastRating=t,this.onComboChangeCallbacks.forEach((function(t){return t(e.combo.count)}))},i.resetCombo=function(){this.combo={count:0,maxCount:0,lastRating:yT.MISS,perfectCount:0,goodCount:0,okCount:0,missCount:0},this.onComboChangeCallbacks.forEach((function(t){return t(0)}))},i.getCombo=function(){return this.combo.count},i.getMaxCombo=function(){return this.combo.maxCount},i.getAccuracy=function(){var t=this.combo.perfectCount+this.combo.goodCount+this.combo.okCount+this.combo.missCount;if(0===t)return 100;var e=100*this.combo.perfectCount+80*this.combo.goodCount+50*this.combo.okCount;return Math.round(e/(100*t)*100)},i.getRatingCounts=function(){return{perfect:this.combo.perfectCount,good:this.combo.goodCount,ok:this.combo.okCount,miss:this.combo.missCount}},i.getTotalNotes=function(){return this.combo.perfectCount+this.combo.goodCount+this.combo.okCount+this.combo.missCount},i.onComboChange=function(t){this.onComboChangeCallbacks.push(t)},i.offComboChange=function(t){var e=this.onComboChangeCallbacks.indexOf(t);-1!==e&&this.onComboChangeCallbacks.splice(e,1)},i.onRating=function(t){this.onRatingCallbacks.push(t)},i.offRating=function(t){var e=this.onRatingCallbacks.indexOf(t);-1!==e&&this.onRatingCallbacks.splice(e,1)},i.setAudioOffset=function(t){this.audioOffset=t},i.getAudioOffset=function(){return this.audioOffset},i.setHitWindows=function(t,e,i){this.perfectWindow=t,this.goodWindow=e,this.okWindow=i},i.isComboMilestone=function(t){return this.combo.count===t},i.calculateScore=function(){var t=Math.min(this.combo.maxCount/10,100),e=this.getAccuracy(),i=1e3*this.combo.perfectCount+500*this.combo.goodCount+100*this.combo.okCount;return Math.round(i*(1+t/100+e/100))},e}(r)).prototype,"audioOffset",[fE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),ZC=Mt(GC.prototype,"perfectWindow",[fE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.05}}),YC=Mt(GC.prototype,"goodWindow",[fE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.1}}),qC=Mt(GC.prototype,"okWindow",[fE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.15}}),UC=GC))||UC;t._RF.pop(),t._RF.push({},"19aa5JfAPNMBLEL5AtzqFm7","InputManager",void 0);var mE,vE,yE,bE,_E,SE,wE,TE,CE,EE,PE,AE,ME,OE,IE,xE=e.ccclass,RE=e.property,LE=(QC=xE("InputManager"),JC=RE([c]),$C=RE(c),tE=RE(c),eE=RE(XC),iE=RE(gE),nE=RE(bt),QC((aE=Mt((rE=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,It(e,"tapFeedbackNodes",aE,xt(e)),It(e,"hitLineNode",sE,xt(e)),It(e,"laneContainer",lE,xt(e)),It(e,"tileManager",cE,xt(e)),It(e,"tapValidator",uE,xt(e)),It(e,"camera",hE,xt(e)),It(e,"tapFeedbackDuration",pE,xt(e)),e.isEnabled=!0,e.laneWidth=0,e.laneCount=4,e.laneStartX=0,e.activeTouches=new Map,e._laneTapCallback=null,e.activeKeyLanes=new Map,e}Ot(e,t);var i=e.prototype;return i.onLoad=function(){this.initTapFeedback(),this.registerEvents()},i.start=function(){this.initLaneInfo()},i.initLaneInfo=function(){if(this.laneContainer){var t=this.laneContainer.getComponent(B);t?(this.laneCount=4,this.laneWidth=t.width/this.laneCount,this.laneStartX=0):console.error("Lane container doesn't have a UITransform component")}else console.error("Lane container is not assigned to InputManager")},i.initTapFeedback=function(){if(this.tapFeedbackNodes.length<this.laneCount){console.warn("Need "+this.laneCount+" tap feedback nodes, but only "+this.tapFeedbackNodes.length+" were provided.");for(var t=this.tapFeedbackNodes.length;t<this.laneCount;t++){var e=new c("TapFeedback_"+t);e.parent=this.node,e.addComponent(f).color=new X(255,255,255,120),e.addComponent(b).opacity=0,this.tapFeedbackNodes.push(e)}}for(var i=0;i<this.laneCount;i++){var n=this.tapFeedbackNodes[i],o=n.getComponent(B)||n.addComponent(B);o.width=.9*this.laneWidth,o.height=100;var r=this.laneStartX+(i+.5)*this.laneWidth,a=this.hitLineNode?this.hitLineNode.position.y:0;n.position=new g(r,a,0)}},i.registerEvents=function(){D.on(k.EventType.TOUCH_START,this.onTouchStart,this),D.on(k.EventType.TOUCH_MOVE,this.onTouchMove,this),D.on(k.EventType.TOUCH_END,this.onTouchEnd,this),D.on(k.EventType.TOUCH_CANCEL,this.onTouchCancel,this),D.on(k.EventType.KEY_DOWN,this.onKeyDown,this),D.on(k.EventType.KEY_UP,this.onKeyUp,this)},i.onDestroy=function(){D.off(k.EventType.TOUCH_START,this.onTouchStart,this),D.off(k.EventType.TOUCH_MOVE,this.onTouchMove,this),D.off(k.EventType.TOUCH_END,this.onTouchEnd,this),D.off(k.EventType.TOUCH_CANCEL,this.onTouchCancel,this),D.off(k.EventType.KEY_DOWN,this.onKeyDown,this),D.off(k.EventType.KEY_UP,this.onKeyUp,this)},i.onTouchStart=function(t){if(this.isEnabled)for(var e,i=t.getTouches(),n=Ft(i);!(e=n()).done;){var o=e.value,r=o.getLocation(),a=this.convertToWorldSpace(r.x,r.y),s=this.getLaneFromPosition(a.x);if(s>=0){var l={id:o.getID(),lane:s,startTime:Date.now()/1e3,position:a,active:!0,node:this.tapFeedbackNodes[s]};this.activeTouches.set(o.getID(),l),this.showTapFeedback(s),this._laneTapCallback&&this._laneTapCallback(s);var c=this.tileManager.getGameTime(),u=this.tileManager.handleLaneTouch(s,!0);this.tapValidator.validateTap(s,c,u)}}},i.onTouchMove=function(t){if(this.isEnabled)for(var e,i=t.getTouches(),n=Ft(i);!(e=n()).done;){var o=e.value,r=o.getID();if(this.activeTouches.has(r)){var a=this.activeTouches.get(r),s=o.getLocation(),l=this.convertToWorldSpace(s.x,s.y);a.position=l;var c=this.getLaneFromPosition(l.x);if(c>=0&&c!==a.lane){this.tileManager.handleLaneTouch(a.lane,!1),this.hideTapFeedback(a.lane),a.lane=c,a.node=this.tapFeedbackNodes[c],this.showTapFeedback(c);var u=this.tileManager.getGameTime(),h=this.tileManager.handleLaneTouch(c,!0);this.tapValidator.validateTap(c,u,h)}}}},i.onTouchEnd=function(t){if(this.isEnabled)for(var e,i=t.getTouches(),n=Ft(i);!(e=n()).done;){var o=e.value.getID();if(this.activeTouches.has(o)){var r=this.activeTouches.get(o);this.tileManager.getGameTime(),this.tileManager.handleLaneTouch(r.lane,!1);this.hideTapFeedback(r.lane),this.activeTouches.delete(o)}}},i.onTouchCancel=function(t){this.onTouchEnd(t)},i.onMouseDown=function(t){if(this.isEnabled){var e=t.getLocation(),i=this.convertToWorldSpace(e.x,e.y),n=this.getLaneFromPosition(i.x);if(n>=0){var o={id:0,lane:n,startTime:Date.now()/1e3,position:i,active:!0,node:this.tapFeedbackNodes[n]};this.activeTouches.set(0,o),this.showTapFeedback(n);var r=this.tileManager.getGameTime(),a=this.tileManager.handleLaneTouch(n,!0);this.tapValidator.validateTap(n,r,a)}}},i.onMouseMove=function(t){if(this.isEnabled&&this.activeTouches.has(0)){var e=this.activeTouches.get(0),i=t.getLocation(),n=this.convertToWorldSpace(i.x,i.y);e.position=n;var o=this.getLaneFromPosition(n.x);if(o>=0&&o!==e.lane){this.tileManager.handleLaneTouch(e.lane,!1),this.hideTapFeedback(e.lane),e.lane=o,e.node=this.tapFeedbackNodes[o],this.showTapFeedback(o);var r=this.tileManager.getGameTime(),a=this.tileManager.handleLaneTouch(o,!0);this.tapValidator.validateTap(o,r,a)}}},i.onMouseUp=function(t){if(this.isEnabled&&this.activeTouches.has(0)){var e=this.activeTouches.get(0);this.tileManager.getGameTime(),this.tileManager.handleLaneTouch(e.lane,!1);this.hideTapFeedback(e.lane),this.activeTouches.delete(0)}},i.showTapFeedback=function(t){var e=this;if(!(t<0||t>=this.tapFeedbackNodes.length)){var i=this.tapFeedbackNodes[t].getComponent(b);i&&(i.opacity=255,this.scheduleOnce((function(){e.hideTapFeedback(t)}),this.tapFeedbackDuration))}},i.hideTapFeedback=function(t){if(!(t<0||t>=this.tapFeedbackNodes.length)){var e=this.tapFeedbackNodes[t].getComponent(b);e&&(e.opacity=0)}},i.convertToWorldSpace=function(t,e){var i=this.camera;if(!i){var n=this.node.getComponent(B);if(!n)return new g(t,e,0);var o=n.width,r=n.height;return new g(t-o/2,e-r/2,0)}var a=new g(t,e,0);return i.screenToWorld(a)},i.getLaneFromPosition=function(t){var e=t-this.laneStartX;return e<0||e>=this.laneWidth*this.laneCount?-1:Math.floor(e/this.laneWidth)},i.setEnabled=function(t){if(this.isEnabled=t,!t){this.activeTouches.clear();for(var e=0;e<this.tapFeedbackNodes.length;e++)this.hideTapFeedback(e)}},i.isInputEnabled=function(){return this.isEnabled},i.getActiveTouchInLane=function(t){for(var e,i=Ft(this.activeTouches);!(e=i()).done;){var n=e.value,o=(n[0],n[1]);if(o.lane===t)return o}return null},i.getActiveTouchCount=function(){return this.activeTouches.size},i.onLaneTap=function(t){this._laneTapCallback=t},i.removeOnLaneTap=function(t){this._laneTapCallback===t&&(this._laneTapCallback=null)},i.onKeyDown=function(t){if(this.isEnabled){var e=-1;switch(t.keyCode){case L.KEY_A:e=0;break;case L.KEY_S:e=1;break;case L.KEY_D:e=2;break;case L.KEY_F:e=3}if(e>=0&&e<this.laneCount){this.activeKeyLanes.set(t.keyCode,e),this.showTapFeedback(e),this._laneTapCallback&&this._laneTapCallback(e);var i=this.tileManager.getGameTime(),n=this.tileManager.handleLaneTouch(e,!0);this.tapValidator.validateTap(e,i,n)}}},i.onKeyUp=function(t){if(this.isEnabled&&this.activeKeyLanes.has(t.keyCode)){var e=this.activeKeyLanes.get(t.keyCode);this.tileManager.getGameTime(),this.tileManager.handleLaneTouch(e,!1);this.hideTapFeedback(e),this.activeKeyLanes.delete(t.keyCode)}},e}(r)).prototype,"tapFeedbackNodes",[JC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),sE=Mt(rE.prototype,"hitLineNode",[$C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),lE=Mt(rE.prototype,"laneContainer",[tE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),cE=Mt(rE.prototype,"tileManager",[eE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),uE=Mt(rE.prototype,"tapValidator",[iE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),hE=Mt(rE.prototype,"camera",[nE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),pE=Mt(rE.prototype,"tapFeedbackDuration",[RE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.2}}),oE=rE))||oE);t._RF.pop(),t._RF.push({},"9daf9azaSJIKJ3U9ri2+dcr","ScoreManager",void 0);var NE,FE,DE,kE,zE,VE,BE,HE,UE,GE,WE,ZE,YE,qE,jE,KE,XE,QE,JE,$E,tP,eP=e.ccclass,iP=e.property,nP=(mE=eP("ScoreManager"),vE=iP(gE),yE=iP(y),bE=iP(y),mE((wE=Mt((SE=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,It(e,"tapValidator",wE,xt(e)),It(e,"scoreLabel",TE,xt(e)),It(e,"accuracyLabel",CE,xt(e)),It(e,"perfectScore",EE,xt(e)),It(e,"goodScore",PE,xt(e)),It(e,"okScore",AE,xt(e)),It(e,"missScore",ME,xt(e)),It(e,"maxComboBonus",OE,xt(e)),It(e,"accuracyBonus",IE,xt(e)),e.currentScore=0,e.finalScore=0,e.isTracking=!1,e.highScores=new Map,e.onScoreChangedCallback=null,e}Ot(e,t);var i=e.prototype;return i.onLoad=function(){this.updateScoreDisplay(),this.tapValidator&&this.tapValidator.onRating(this.onRatingEvent.bind(this))},i.startTracking=function(){this.resetScore(),this.isTracking=!0},i.pauseTracking=function(){this.isTracking=!1},i.resumeTracking=function(){this.isTracking=!0},i.stopTracking=function(){this.isTracking=!1,this.finalizeScore()},i.resetScore=function(){this.currentScore=0,this.finalScore=0,this.updateScoreDisplay()},i.onRatingEvent=function(t,e){if(this.isTracking){var i=0;switch(e){case yT.PERFECT:i=this.perfectScore;break;case yT.GREAT:i=this.goodScore;break;case yT.COOL:i=this.okScore;break;case yT.MISS:i=this.missScore}var n=this.tapValidator.getCombo();if(n>1){var o=1+Math.min(n/100,.5);i=Math.round(i*o)}this.addScore(i)}},i.addScore=function(t){this.isTracking&&(this.currentScore+=t,this.updateScoreDisplay(),this.onScoreChangedCallback&&this.onScoreChangedCallback(this.currentScore))},i.updateScoreDisplay=function(){if(this.scoreLabel&&(this.scoreLabel.string=this.formatScore(this.currentScore)),this.accuracyLabel&&this.tapValidator){var t=this.tapValidator.getAccuracy();this.accuracyLabel.string=t+"%"}},i.formatScore=function(t){return t.toLocaleString()},i.finalizeScore=function(){if(this.tapValidator){var t=this.tapValidator.getAccuracy(),e=this.tapValidator.getMaxCombo(),i=(this.tapValidator.getRatingCounts(),this.tapValidator.getTotalNotes()),n=this.currentScore,o=i>0?e/i:0,r=Math.round(this.maxComboBonus*o),a=Math.round(this.accuracyBonus*(t/100));this.finalScore=n+r+a,console.log("Score Breakdown:"),console.log("Base Score: "+n),console.log("Combo Bonus ("+e+"x): "+r),console.log("Accuracy Bonus ("+t+"%): "+a),console.log("Final Score: "+this.finalScore),this.checkHighScore()}else this.finalScore=this.currentScore},i.checkHighScore=function(){var t="current";return(!this.highScores.has(t)||this.finalScore>this.highScores.get(t))&&(this.highScores.set(t,this.finalScore),!0)},i.getCurrentScore=function(){return this.currentScore},i.getFinalScore=function(){return this.finalScore},i.onScoreChanged=function(t){this.onScoreChangedCallback=t},i.getHighScore=function(t){return this.highScores.get(t)||0},i.saveHighScores=function(){var t={};this.highScores.forEach((function(e,i){t[i]=e}));var e=JSON.stringify(t);localStorage.setItem("magicTilesHighScores",e)},i.loadHighScores=function(){var t=localStorage.getItem("magicTilesHighScores");if(t)try{var e=JSON.parse(t);for(var i in this.highScores.clear(),e)Object.prototype.hasOwnProperty.call(e,i)&&this.highScores.set(i,e[i])}catch(t){console.error("Failed to parse high scores:",t)}},e}(r)).prototype,"tapValidator",[vE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),TE=Mt(SE.prototype,"scoreLabel",[yE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),CE=Mt(SE.prototype,"accuracyLabel",[bE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),EE=Mt(SE.prototype,"perfectScore",[iP],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1e3}}),PE=Mt(SE.prototype,"goodScore",[iP],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 500}}),AE=Mt(SE.prototype,"okScore",[iP],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 100}}),ME=Mt(SE.prototype,"missScore",[iP],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),OE=Mt(SE.prototype,"maxComboBonus",[iP],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1e4}}),IE=Mt(SE.prototype,"accuracyBonus",[iP],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1e4}}),_E=SE))||_E);t._RF.pop(),t._RF.push({},"54bffb59LVEi6v9WbidyqIN","GameplayManager",void 0);var oP,rP,aP,sP,lP,cP,uP,hP,pP=e.ccclass,dP=e.property,fP=function(t){return t[t.NONE=0]="NONE",t[t.LOADING=1]="LOADING",t[t.WAITING_FOR_START=2]="WAITING_FOR_START",t[t.PLAYING=3]="PLAYING",t[t.PAUSED=4]="PAUSED",t[t.COMPLETED=5]="COMPLETED",t[t.FAILED=6]="FAILED",t}({}),gP=(NE=pP("GameplayManager"),FE=dP(XC),DE=dP(LE),kE=dP(SC),zE=dP(gE),VE=dP(nP),BE=dP(z),NE((GE=Mt((UE=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).gameState=fP.NONE,It(e,"tileManager",GE,xt(e)),It(e,"inputManager",WE,xt(e)),It(e,"feedbackManager",ZE,xt(e)),It(e,"tapValidator",YE,xt(e)),It(e,"scoreManager",qE,xt(e)),It(e,"toggleAutoPlay",jE,xt(e)),It(e,"countdownDuration",KE,xt(e)),It(e,"minSurvivalHP",XE,xt(e)),It(e,"maxSurvivalHP",QE,xt(e)),It(e,"missHPPenalty",JE,xt(e)),It(e,"badHitHPPenalty",$E,xt(e)),It(e,"perfectHPRecovery",tP,xt(e)),e.survivalHP=100,e.currentBeatmapId="",e.elapsedTime=0,e.notesPassed=0,e.totalNotes=0,e.autoPlay=!1,e.isPaused=!1,e.onGameStateChangedCallback=null,e.onSurvivalHPChangedCallback=null,e.audioManager=null,e.beatmapManager=null,e}Ot(e,t);var i=e.prototype;return i.onLoad=function(){this.audioManager||(this.audioManager=XS.instance),this.beatmapManager||(this.beatmapManager=nw.instance),this.tapValidator&&this.tapValidator.onRating(this.onRatingEvent.bind(this))},i.LoadBeatMap=function(){var t=Rt(Lt().mark((function t(e){var i,n,o;return Lt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.resetGameState(),this.currentBeatmapId=e,this.setGameState(fP.LOADING),t.prev=3,t.next=6,this.beatmapManager.loadBeatmapInfo(e);case 6:if(i=t.sent){t.next=10;break}return console.error("Failed to load beatmap: "+e),t.abrupt("return",!1);case 10:return t.next=12,this.beatmapManager.loadBeatmapAudioData();case 12:if(n=t.sent){t.next=16;break}return console.error("Failed to load beatmap audio"),t.abrupt("return",!1);case 16:return null==i.notes||0==i.notes.length?(o=this.beatmapManager.updateNotes(e,n.trackInfo.notes),this.totalNotes=o.notes.length):this.totalNotes=i.notes.length,this.tileManager.initGame(),this.createBeginningTile(),t.abrupt("return",!0);case 22:return t.prev=22,t.t0=t.catch(3),console.error("Error starting game:",t.t0),t.abrupt("return",!1);case 26:case"end":return t.stop()}}),t,this,[[3,22]])})));return function(e){return t.apply(this,arguments)}}(),i.startPlaying=function(){this.setAutoPlay(this.toggleAutoPlay.isChecked),this.tapValidator.resetCombo(),this.scoreManager.resetScore(),this.scoreManager.startTracking(),this.inputManager.setEnabled(!0),this.tileManager.startGame(),this.audioManager.playBeatmapAudio(),this.setGameState(fP.PLAYING),this.schedule(this.gameUpdate,0)},i.pauseGame=function(){this.gameState===fP.PLAYING&&(this.audioManager.pauseBeatmapAudio(),this.tileManager.pauseGame(),this.inputManager.setEnabled(!1),this.scoreManager.pauseTracking(),this.isPaused=!0,this.setGameState(fP.PAUSED),this.unschedule(this.gameUpdate))},i.resumeGame=function(){this.gameState===fP.PAUSED&&(this.audioManager.resumeBeatmapAudio(),this.tileManager.resumeGame(),this.inputManager.setEnabled(!0),this.scoreManager.resumeTracking(),this.isPaused=!1,this.setGameState(fP.PLAYING),this.schedule(this.gameUpdate,0))},i.gameUpdate=function(t){if(this.elapsedTime+=t,this.audioManager.isPlaying()){var e=this.audioManager.getCurrentTime();this.tileManager.setGameTime(e)}this.survivalHP<=0?this.failGame():this.notesPassed>=this.totalNotes&&0===this.tileManager.getActiveTileCount()&&this.completeGame()},i.onRatingEvent=function(t,e){switch(this.feedbackManager.showRatingFeedback(t,e),this.feedbackManager.updateCombo(this.tapValidator.getCombo()),this.notesPassed++,e){case yT.PERFECT:this.changeSurvivalHP(this.perfectHPRecovery);break;case yT.GREAT:break;case yT.COOL:this.changeSurvivalHP(-this.badHitHPPenalty);break;case yT.MISS:this.changeSurvivalHP(-this.missHPPenalty)}},i.changeSurvivalHP=function(t){this.survivalHP=Math.max(0,Math.min(this.maxSurvivalHP,this.survivalHP+t)),this.onSurvivalHPChangedCallback&&this.onSurvivalHPChangedCallback(this.survivalHP)},i.completeGame=function(){this.stopGameplay(),this.setGameState(fP.COMPLETED),this.feedbackManager.showMessage("LEVEL COMPLETE!");var t=this.scoreManager.getFinalScore(),e=this.tapValidator.getAccuracy(),i=this.tapValidator.getMaxCombo();console.log("Game completed! Score: "+t+", Accuracy: "+e+"%, Max Combo: "+i),this.scheduleOnce((function(){console.log("Show results screen")}),2)},i.failGame=function(){this.stopGameplay(),this.setGameState(fP.FAILED),this.feedbackManager.showMessage("GAME OVER"),this.feedbackManager.shakeCamera(.3,.8),this.scheduleOnce((function(){console.log("Show fail screen")}),2)},i.stopGameplay=function(){this.audioManager.stopBeatmapAudio(),this.tileManager.stopGame(),this.inputManager.setEnabled(!1),this.scoreManager.stopTracking(),this.unschedule(this.gameUpdate)},i.resetGameState=function(){this.gameState=fP.NONE,this.survivalHP=this.maxSurvivalHP,this.elapsedTime=0,this.notesPassed=0,this.totalNotes=0,this.isPaused=!1},i.setGameState=function(t){this.gameState=t,this.onGameStateChangedCallback&&this.onGameStateChangedCallback(t)},i.onGameStateChanged=function(t){this.onGameStateChangedCallback=t},i.onSurvivalHPChanged=function(t){this.onSurvivalHPChangedCallback=t},i.getGameState=function(){return this.gameState},i.getSurvivalHP=function(){return this.survivalHP},i.getProgress=function(){return 0===this.totalNotes?0:this.notesPassed/this.totalNotes},i.setAutoPlay=function(t){this.autoPlay=t,this.tileManager.toggleAutoplay(t)},i.isAutoPlayEnabled=function(){return this.autoPlay},i.togglePause=function(){this.isPaused?this.resumeGame():this.pauseGame()},i.restartGame=function(){this.currentBeatmapId&&this.LoadBeatMap(this.currentBeatmapId)},i.exitGame=function(){this.stopGameplay(),this.resetGameState(),console.log("Exit to menu")},i.createBeginningTile=function(){this.setGameState(fP.WAITING_FOR_START),this.feedbackManager.showMessage("Tap to Start",0,140),this.tileManager&&this.tileManager.setupBeginningTile(),this.inputManager.setEnabled(!0),this.inputManager.onLaneTap(this.onBeginningTileTap.bind(this))},i.onBeginningTileTap=function(t){this.gameState===fP.WAITING_FOR_START&&(this.tileManager.checkBeginningTileTap(t)&&(this.inputManager.removeOnLaneTap(this.onBeginningTileTap.bind(this)),this.startPlaying()))},e}(r)).prototype,"tileManager",[FE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),WE=Mt(UE.prototype,"inputManager",[DE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ZE=Mt(UE.prototype,"feedbackManager",[kE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),YE=Mt(UE.prototype,"tapValidator",[zE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),qE=Mt(UE.prototype,"scoreManager",[VE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),jE=Mt(UE.prototype,"toggleAutoPlay",[BE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),KE=Mt(UE.prototype,"countdownDuration",[dP],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 3}}),XE=Mt(UE.prototype,"minSurvivalHP",[dP],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 40}}),QE=Mt(UE.prototype,"maxSurvivalHP",[dP],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 100}}),JE=Mt(UE.prototype,"missHPPenalty",[dP],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 10}}),$E=Mt(UE.prototype,"badHitHPPenalty",[dP],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 5}}),tP=Mt(UE.prototype,"perfectHPRecovery",[dP],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 2}}),HE=UE))||HE);t._RF.pop(),t._RF.push({},"04c89d3uFxCxYqeuP2zDazt","MTDragAndDropTool",void 0);var mP,vP,yP,bP,_P,SP,wP,TP,CP,EP,PP,AP,MP,OP=e.ccclass,IP=e.property;oP=OP("MTDragAndDropTool"),rP=IP(c),aP=IP(y),oP(((hP=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,It(e,"notificationNode",cP,xt(e)),It(e,"notificationLabel",uP,xt(e)),e._midiFile=null,e._audioFile=null,e._tempBeatmapId=null,e._tempAssets=null,e._dropOverlay=null,e}Ot(e,t);var i=e.prototype;return i.onLoad=function(){e._instance=this,this.createDragOverlay(),this.initialize()},i.onDestroy=function(){this._dropOverlay&&this._dropOverlay.parentNode&&this._dropOverlay.parentNode.removeChild(this._dropOverlay),e._instance===this&&(e._instance=null)},i.createDragOverlay=function(){if(S.isBrowser){var t=document.createElement("div");t.style.position="fixed",t.style.top="0",t.style.left="0",t.style.width="100%",t.style.height="100%",t.style.backgroundColor="rgba(0, 100, 255, 0.3)",t.style.display="none",t.style.zIndex="9999",t.style.justifyContent="center",t.style.alignItems="center",t.style.fontSize="24px",t.style.color="white",t.style.textShadow="0 0 5px black",t.innerHTML='<div style="background: rgba(0,0,0,0.7); padding: 20px; border-radius: 10px;">Drop MIDI and Audio files here<br><small>(Need both files to start)</small></div>',document.body.appendChild(t),this._dropOverlay=t}},i.initialize=function(){var t=this;if(S.isBrowser){var e=document.body;e.addEventListener("dragover",(function(e){e.preventDefault(),e.stopPropagation(),t._dropOverlay&&(t._dropOverlay.style.display="flex")})),e.addEventListener("dragleave",(function(i){i.preventDefault(),i.stopPropagation();var n=e.getBoundingClientRect();(i.clientX<=n.left||i.clientX>=n.right||i.clientY<=n.top||i.clientY>=n.bottom)&&t._dropOverlay&&(t._dropOverlay.style.display="none")})),e.addEventListener("drop",(function(e){e.preventDefault(),e.stopPropagation(),t._dropOverlay&&(t._dropOverlay.style.display="none"),t.handleFileDrop(e.dataTransfer.files)})),console.log("MTDragAndDropTool: Initialized drag and drop handlers")}else console.warn("MTDragAndDropTool: Drag and drop is only supported in browser environments")},i.handleFileDrop=function(t){var e=this;if(t&&0!==t.length){for(var i=!1,n=0;n<t.length;n++){var o=t[n];if(o.name.toLowerCase().endsWith(".mid")||o.name.toLowerCase().endsWith(".midi")){this._midiFile=o,i=!0,console.log("MTDragAndDropTool: MIDI file dropped:",o.name);break}}i?(this.notifyNextStep("MIDI file received! Processing..."),this.scheduleOnce((function(){e.processFiles()}),0)):this.notifyNextStep("Please drop a MIDI file (.mid/.midi).")}},i.processFiles=function(){var t=Rt(Lt().mark((function t(){var e,i,n,o,r,a,s,l,c,u,h;return Lt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,this.notifyNextStep("Processing files..."),this._tempBeatmapId="temp_"+Date.now(),e=this._midiFile.name.replace(/\.(mid|midi)$/i,""),i="magic_tiles/audios/"+e,console.log("Attempting to load audio from resources: "+i),t.prev=6,t.next=9,this.loadAudioFromResources(i);case 9:n=t.sent,console.log("Successfully loaded audio from resources:",n.name),t.next=19;break;case 13:return t.prev=13,t.t0=t.catch(6),console.error("Failed to load audio resource at "+i+":",t.t0),this.notifyNextStep('Could not find matching audio file in resources. Please ensure audio file "'+e+'.mp3" exists in magic_tiles/audios folder.'),this.resetFiles(),t.abrupt("return");case 19:return o=URL.createObjectURL(this._midiFile),t.next=22,de(o);case 22:if(r=t.sent,a={id:this._tempBeatmapId,title:e,artist:"Unknown Artist",bpm:r.tempo||120,difficulty:3,difficultyName:"Medium",level:5,preview:{start:0,end:30},audioPath:null,midiPath:null,backgroundImage:"magic_tiles/images/default_background",coverImage:"magic_tiles/images/default_cover"},s={metadata:a,notes:[]},!r||!r.notes){t.next=32;break}l=[],l=nw.instance.convertNotes(r.notes,l),s.notes=l,console.log("Processed "+s.notes.length+" notes from MIDI data"),t.next=36;break;case 32:return console.warn("No valid MIDI tracks found in the file"),this.notifyNextStep("MIDI file doesn't contain valid note data. Please try another file."),this.resetFiles(),t.abrupt("return");case 36:c=nw.instance,u=XS.instance,console.log("AudioClip details:",{name:n.name,duration:n.getDuration(),isValid:n.loaded,type:typeof n._nativeAsset}),h={clip:n,trackInfo:r,totalDuration:n.getDuration()||180,currentTime:0,isPlaying:!1,isPaused:!1},u.setCurrentBeatmap(h),c.addTempBeatmap(this._tempBeatmapId,s),this.startGame(),t.next=50;break;case 45:t.prev=45,t.t1=t.catch(0),console.error("MTDragAndDropTool: Error processing files:",t.t1),this.notifyNextStep("Error processing files: "+t.t1.message),this.resetFiles();case 50:case"end":return t.stop()}}),t,this,[[0,45],[6,13]])})));return function(){return t.apply(this,arguments)}}(),i.startGame=function(){var t=this.findGameplayManager();if(!t)return console.error("MTDragAndDropTool: GameplayManager not found"),void this.notifyNextStep("Cannot start game. Please try loading files from the game menu.");this.notifyNextStep("Starting game..."),t.resetGameState(),t.setGameState(fP.LOADING),t.tileManager.initGame(),t.createBeginningTile(),this.resetFiles()},i.findGameplayManager=function(){return M.getScene().getComponentInChildren(gP)},i.loadAudioFromResources=function(t){return new Promise((function(e,i){Je.loadRes(t,x,(function(t,n){if(t)return console.error("Failed to load audio from resources:",t),void i(t);n&&n instanceof x?(console.log("Successfully loaded AudioClip from resources:",n),e(n)):(console.error("Invalid AudioClip received:",n),i("Invalid AudioClip received"))}))}))},i.resetFiles=function(){this._midiFile&&URL.revokeObjectURL(URL.createObjectURL(this._midiFile)),this._midiFile=null,this._tempBeatmapId=null,this._tempAssets=null},i.notifyNextStep=function(t){var e=this;console.log("MTDragAndDropTool: "+t),this.notificationNode&&this.notificationLabel?(this.notificationNode.active=!0,this.notificationLabel.string=t,this.scheduleOnce((function(){e.notificationNode.active=!1}),3)):this.showTemporaryNotification(t)},i.showTemporaryNotification=function(t){if(S.isBrowser){var e=document.createElement("div");e.style.position="fixed",e.style.bottom="20px",e.style.left="50%",e.style.transform="translateX(-50%)",e.style.backgroundColor="rgba(0, 0, 0, 0.7)",e.style.color="white",e.style.padding="10px 20px",e.style.borderRadius="5px",e.style.zIndex="10000",e.innerText=t,document.body.appendChild(e),setTimeout((function(){e.parentNode&&e.parentNode.removeChild(e)}),3e3)}},Nt(e,null,[{key:"instance",get:function(){return this._instance}}]),e}(r))._instance=null,cP=Mt((lP=hP).prototype,"notificationNode",[rP],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),uP=Mt(lP.prototype,"notificationLabel",[aP],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),sP=lP));t._RF.pop(),t._RF.push({},"dd74eu3S4NEpap53qs6fEO1","MTItemSong",void 0);var xP,RP,LP,NP,FP,DP,kP,zP=e.ccclass,VP=e.property,BP=(mP=zP("MTItemSong"),vP=VP(y),yP=VP(y),bP=VP(y),_P=VP(N),SP=VP(f),mP((CP=Mt((TP=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,It(e,"songNameLabel",CP,xt(e)),It(e,"artistLabel",EP,xt(e)),It(e,"difficultyLabel",PP,xt(e)),It(e,"selectButton",AP,xt(e)),It(e,"coverSprite",MP,xt(e)),e.songData=null,e.selectionCallback=null,e}Ot(e,t);var i=e.prototype;return i.start=function(){this.selectButton&&this.selectButton.node.on("click",this.onSongSelected,this)},i.setSongData=function(t,e){this.songData=t,this.selectionCallback=e,this.songNameLabel&&(this.songNameLabel.string=t.title||"Unknown Title"),this.artistLabel&&(this.artistLabel.string=t.artist||"Unknown Artist"),this.difficultyLabel&&(this.difficultyLabel.string="Difficulty: "+(t.difficultyName||"Medium")),this.coverSprite&&t.coverImage},i.onSongSelected=function(){this.selectionCallback&&this.songData&&this.selectionCallback(this.songData.id)},i.update=function(t){},e}(r)).prototype,"songNameLabel",[vP],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),EP=Mt(TP.prototype,"artistLabel",[yP],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),PP=Mt(TP.prototype,"difficultyLabel",[bP],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),AP=Mt(TP.prototype,"selectButton",[_P],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),MP=Mt(TP.prototype,"coverSprite",[SP],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),wP=TP))||wP);t._RF.pop(),t._RF.push({},"3828eDIEe1G/rr9u6tsVC3f","PopupMTSongSelection",void 0);var HP,UP,GP,WP,ZP,YP,qP,jP,KP,XP,QP,JP,$P,tA,eA,iA,nA,oA,rA,aA,sA,lA,cA,uA,hA,pA,dA,fA,gA,mA,vA,yA,bA,_A,SA,wA,TA,CA=e.ccclass,EA=e.property;xP=CA("PopupMTSongSelection"),RP=EA(c),LP=EA(c),xP((DP=Mt((FP=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,It(e,"contentNode",DP,xt(e)),It(e,"itemSongPrefab",kP,xt(e)),e.beatmaps=new Map,e.gameplayManager=null,e}Ot(e,t);var i=e.prototype;return i.start=function(){this.gameplayManager=M.getScene().getComponentInChildren(gP),this.loadAllBeatmaps()},i.loadAllBeatmaps=function(){var t=this;Je.loadAllResources("magic_tiles/beatmaps",(function(e){e.filter((function(t){return t instanceof yt})).forEach((function(e){if(e&&e.json)try{var i=e.json;i&&i.metadata&&(i.metadata.id=e.name,t.beatmaps.set(i.metadata.id,i.metadata))}catch(t){console.error("Failed to parse beatmap JSON: "+e.name,t)}})),t.createSongItems()}))},i.createSongItems=function(){var t=this;this.contentNode.removeAllChildren(),this.beatmaps.forEach((function(e){var i=E(t.itemSongPrefab);i.active=!0;var n=i.getComponent(BP);n&&(n.setSongData(e,t.onSongSelected.bind(t)),t.contentNode.addChild(i))}))},i.onSongSelected=function(t){var e=this;this.gameplayManager?this.gameplayManager.LoadBeatMap(t).then((function(i){i?e.hide():console.error("Failed to load beatmap: "+t)})):console.error("GameplayManager not found")},e}(so)).prototype,"contentNode",[RP],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),kP=Mt(FP.prototype,"itemSongPrefab",[LP],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),NP=FP));t._RF.pop(),t._RF.push({},"799d06L3O1HXqAs90sgfX8H","SongSelectionManager",void 0);var PA,AA,MA,OA,IA,xA=e.ccclass,RA=e.property,LA=function(t){return t[t.ALPHABETICAL=0]="ALPHABETICAL",t[t.DIFFICULTY=1]="DIFFICULTY",t[t.NEWEST=2]="NEWEST",t[t.POPULARITY=3]="POPULARITY",t}(LA||{}),NA=function(t){return t[t.ALL=0]="ALL",t[t.EASY=1]="EASY",t[t.MEDIUM=2]="MEDIUM",t[t.HARD=3]="HARD",t[t.EXTREME=4]="EXTREME",t}(NA||{});HP=xA("SongSelectionManager"),UP=RA(pt),GP=RA(l),WP=RA(c),ZP=RA(c),YP=RA(_t),qP=RA(_t),jP=RA(ut),KP=RA(c),XP=RA(y),QP=RA(f),JP=RA(y),$P=RA(y),tA=RA(y),eA=RA(y),iA=RA(y),nA=RA(N),oA=RA(N),HP((sA=Mt((aA=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,It(e,"songListScrollView",sA,xt(e)),It(e,"songItemPrefab",lA,xt(e)),It(e,"songItemContainer",cA,xt(e)),It(e,"songDetailsPanel",uA,xt(e)),It(e,"difficultyToggles",hA,xt(e)),It(e,"sortMethodToggles",pA,xt(e)),It(e,"previewProgressBar",dA,xt(e)),It(e,"noSongsMessage",fA,xt(e)),It(e,"searchResultsLabel",gA,xt(e)),It(e,"songCoverImage",mA,xt(e)),It(e,"songTitleLabel",vA,xt(e)),It(e,"songArtistLabel",yA,xt(e)),It(e,"songBPMLabel",bA,xt(e)),It(e,"songDifficultyLabel",_A,xt(e)),It(e,"songDurationLabel",SA,xt(e)),It(e,"playButton",wA,xt(e)),It(e,"previewButton",TA,xt(e)),e.beatmapManager=null,e.audioManager=null,e.gameplayManager=null,e.loadedBeatmaps=[],e.filteredBeatmaps=[],e.selectedBeatmapId="",e.previewAudioId="",e.previewAS=null,e.isPreviewPlaying=!1,e.previewUpdateTimer=null,e.currentSortMethod=LA.ALPHABETICAL,e.currentDifficultyFilter=NA.ALL,e.searchText="",e}Ot(e,t);var i=e.prototype;return i.onLoad=function(){this.beatmapManager=nw.instance,this.audioManager=XS.instance,this.initializeUI(),this.loadBeatmaps()},i.onDestroy=function(){this.stopPreview(),null!==this.previewUpdateTimer&&(clearInterval(this.previewUpdateTimer),this.previewUpdateTimer=null)},i.initializeUI=function(){this.songDetailsPanel&&(this.songDetailsPanel.active=!1),this.sortMethodToggles,this.difficultyToggles,this.noSongsMessage&&(this.noSongsMessage.active=!1),this.searchResultsLabel&&(this.searchResultsLabel.node.active=!1)},i.loadBeatmaps=function(){var t=Rt(Lt().mark((function t(){return Lt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,HC.instance.showLoadingScreen(!0),t.next=4,this.beatmapManager.loadBeatmapIndex();case 4:this.loadedBeatmaps=t.sent,this.applyFiltersAndSort(),HC.instance.showLoadingScreen(!1),t.next=14;break;case 9:t.prev=9,t.t0=t.catch(0),console.error("Failed to load beatmaps:",t.t0),HC.instance.showLoadingScreen(!1),HC.instance.showPopup("Failed to load song list. Please try again later.","Error");case 14:case"end":return t.stop()}}),t,this,[[0,9]])})));return function(){return t.apply(this,arguments)}}(),i.refreshSongList=function(){var t=this;if(this.songItemContainer&&this.songItemContainer.removeAllChildren(),0!==this.filteredBeatmaps.length){this.noSongsMessage&&(this.noSongsMessage.active=!1),this.searchText&&this.searchResultsLabel?(this.searchResultsLabel.string="Found "+this.filteredBeatmaps.length+' results for "'+this.searchText+'"',this.searchResultsLabel.node.active=!0):this.searchResultsLabel&&(this.searchResultsLabel.node.active=!1),this.filteredBeatmaps.forEach((function(e,i){t.createSongItem(e,i)}));var e=this.songItemContainer.getComponent($);e&&e.updateLayout()}else this.noSongsMessage&&(this.noSongsMessage.active=!0)},i.createSongItem=function(t,e){var i,n,o,r,a=this;if(this.songItemPrefab&&this.songItemContainer){var s=E(this.songItemPrefab);s.parent=this.songItemContainer;var l=null==(i=s.getChildByName("TitleLabel"))?void 0:i.getComponent(y),u=null==(n=s.getChildByName("ArtistLabel"))?void 0:n.getComponent(y),h=null==(o=s.getChildByName("DifficultyLabel"))?void 0:o.getComponent(y),p=null==(r=s.getChildByName("CoverImage"))?void 0:r.getComponent(f);if(l&&(l.string=t.title),u&&(u.string=t.artist),h&&(h.string=t.difficultyName+" (Lv."+t.level+")"),p&&t.coverImage,t.id===this.selectedBeatmapId){var d,m=null==(d=s.getChildByName("Background"))?void 0:d.getComponent(f);m&&m.color.set(200,200,255,255)}s.on(c.EventType.TOUCH_END,(function(){a.onSongItemClicked(t.id)})),s.scale=new g(.9,.9,1),v(s).delay(.05*e).to(.2,{scale:new g(1,1,1)}).start()}},i.onSongItemClicked=function(t){this.stopPreview(),this.selectedBeatmapId=t,this.showSongDetails(t),this.refreshSongList()},i.showSongDetails=function(){var t=Rt(Lt().mark((function t(e){var i,n,o,r;return Lt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.songDetailsPanel){t.next=2;break}return t.abrupt("return");case 2:return t.next=4,this.beatmapManager.loadBeatmapInfo(e);case 4:if(i=t.sent){t.next=8;break}return console.error("Failed to load beatmap details for ID: "+e),t.abrupt("return");case 8:this.songDetailsPanel.active=!0,this.songTitleLabel&&(this.songTitleLabel.string=i.metadata.title),this.songArtistLabel&&(this.songArtistLabel.string=i.metadata.artist),this.songBPMLabel&&(this.songBPMLabel.string=i.metadata.bpm+" BPM"),this.songDifficultyLabel&&(this.songDifficultyLabel.string=i.metadata.difficultyName+" (Lv."+i.metadata.level+")"),this.songDurationLabel&&(n=i.notes.length>0?i.notes[i.notes.length-1].time:0,o=Math.floor(n/60),r=Math.floor(n%60),this.songDurationLabel.string=o+":"+(r<10?"0"+r:r)),this.songCoverImage&&i.metadata.coverImage,this.playButton&&(this.playButton.interactable=!0),this.previewButton&&(this.previewButton.interactable=!0),this.songDetailsPanel.scale=new g(.9,.9,1),v(this.songDetailsPanel).to(.2,{scale:new g(1,1,1)}).start();case 19:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}(),i.startPreview=function(){var t,e=this;if(this.selectedBeatmapId){var i=this.beatmapManager.getActiveBeatmap();if(i){this.stopPreview();null==(t=i.metadata.preview)||t.start;if(this.previewAS=this.audioManager.playSound(i.metadata.audioPath,.8),this.isPreviewPlaying=!0,this.previewButton){var n,o=null==(n=this.previewButton.node.getChildByName("Label"))?void 0:n.getComponent(y);o&&(o.string="Stop")}this.previewUpdateTimer=setInterval((function(){e.updatePreviewProgress()}),100)}}},i.stopPreview=function(){if(this.previewAudioId&&this.isPreviewPlaying){if(this.previewAS.stop(),this.isPreviewPlaying=!1,this.previewButton){var t,e=null==(t=this.previewButton.node.getChildByName("Label"))?void 0:t.getComponent(y);e&&(e.string="Preview")}null!==this.previewUpdateTimer&&(clearInterval(this.previewUpdateTimer),this.previewUpdateTimer=null),this.previewProgressBar&&(this.previewProgressBar.progress=0)}},i.togglePreview=function(){this.isPreviewPlaying?this.stopPreview():this.startPreview()},i.updatePreviewProgress=function(){if(this.isPreviewPlaying&&this.previewProgressBar){var t=this.previewAS;if(t){var e=t.duration,i=t.currentTime;e>0&&(this.previewProgressBar.progress=i/e),i>=e&&this.stopPreview()}}},i.applyFiltersAndSort=function(){var t=this;if(this.loadedBeatmaps.length){if(this.filteredBeatmaps=[].concat(this.loadedBeatmaps),this.currentDifficultyFilter!==NA.ALL&&(this.filteredBeatmaps=this.filteredBeatmaps.filter((function(e){var i=e.level;switch(t.currentDifficultyFilter){case NA.EASY:return i<=3;case NA.MEDIUM:return i>3&&i<=6;case NA.HARD:return i>6&&i<=9;case NA.EXTREME:return i>9;default:return!0}}))),this.searchText){var e=this.searchText.toLowerCase();this.filteredBeatmaps=this.filteredBeatmaps.filter((function(t){return t.title.toLowerCase().includes(e)||t.artist.toLowerCase().includes(e)}))}switch(this.currentSortMethod){case LA.ALPHABETICAL:this.filteredBeatmaps.sort((function(t,e){return t.title.localeCompare(e.title)}));break;case LA.DIFFICULTY:this.filteredBeatmaps.sort((function(t,e){return t.level-e.level}));break;case LA.NEWEST:this.filteredBeatmaps.sort((function(t,e){return e.id.localeCompare(t.id)}));break;case LA.POPULARITY:}this.refreshSongList()}},i.setSortMethod=function(t){this.currentSortMethod=t,this.applyFiltersAndSort()},i.setDifficultyFilter=function(t){this.currentDifficultyFilter=t,this.applyFiltersAndSort()},i.setSearchText=function(t){this.searchText=t,this.applyFiltersAndSort()},i.playSong=function(){if(this.selectedBeatmapId){if(this.stopPreview(),!this.gameplayManager){var t,e=null==(t=this.node.parent)?void 0:t.getChildByName("GameplayManager");e&&(this.gameplayManager=e.getComponent(gP))}this.gameplayManager?this.gameplayManager.LoadBeatMap(this.selectedBeatmapId):console.error("GameplayManager not found")}},e}(r)).prototype,"songListScrollView",[UP],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),lA=Mt(aA.prototype,"songItemPrefab",[GP],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),cA=Mt(aA.prototype,"songItemContainer",[WP],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),uA=Mt(aA.prototype,"songDetailsPanel",[ZP],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),hA=Mt(aA.prototype,"difficultyToggles",[YP],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),pA=Mt(aA.prototype,"sortMethodToggles",[qP],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),dA=Mt(aA.prototype,"previewProgressBar",[jP],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),fA=Mt(aA.prototype,"noSongsMessage",[KP],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),gA=Mt(aA.prototype,"searchResultsLabel",[XP],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),mA=Mt(aA.prototype,"songCoverImage",[QP],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),vA=Mt(aA.prototype,"songTitleLabel",[JP],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),yA=Mt(aA.prototype,"songArtistLabel",[$P],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),bA=Mt(aA.prototype,"songBPMLabel",[tA],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_A=Mt(aA.prototype,"songDifficultyLabel",[eA],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),SA=Mt(aA.prototype,"songDurationLabel",[iA],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),wA=Mt(aA.prototype,"playButton",[nA],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),TA=Mt(aA.prototype,"previewButton",[oA],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),rA=aA));t._RF.pop(),t._RF.push({},"f3854cZ+7tJvbx0v7anFQPX","PopupLoading",void 0);var FA,DA,kA,zA,VA,BA,HA,UA,GA,WA=e.ccclass,ZA=e.property;PA=WA("PopupLoading"),AA=ZA(y),PA((IA=Mt((OA=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,It(e,"lbDetail",IA,xt(e)),e}Ot(e,t);var i=e.prototype;return i.show=function(e,i){var n;t.prototype.show.call(this,e,i);var o=null!=(n=e)?n:"";this.lbDetail.string=o},i.setLoadingDetail=function(t){this.lbDetail.string=t},e}(so)).prototype,"lbDetail",[AA],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),MA=OA));t._RF.pop(),t._RF.push({},"7cf33btXkBJaJszpFBOgTb7","PopupMessage",void 0);var YA,qA=e.ccclass,jA=e.property;FA=qA("PopupMessage"),DA=jA(y),kA=jA(y),zA=jA(y),FA((HA=Mt((BA=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,It(e,"lbContent",HA,xt(e)),It(e,"lbTitle",UA,xt(e)),It(e,"lbButtonText",GA,xt(e)),e.confirmCallback=null,e}Ot(e,t);var i=e.prototype;return i.show=function(e,i){var n,o;t.prototype.show.call(this,e,i),e&&(this.confirmCallback=e.buttonCallback,this.lbContent.string=e.message,this.lbTitle.string=null!=(n=e.title)?n:"",this.lbButtonText.string=null!=(o=e.buttonText)?o:"OK")},i.onTouch_Confirm=function(){var t;null==(t=this.confirmCallback)||t.call(this),this.doUImanagerHide()},e}(so)).prototype,"lbContent",[DA],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),UA=Mt(BA.prototype,"lbTitle",[kA],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),GA=Mt(BA.prototype,"lbButtonText",[zA],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),VA=BA));t._RF.pop(),t._RF.push({},"be613BiyadMYYQcjSzr/JtE","Bullet",void 0);var KA=e.ccclass,XA=(e.property,KA("Bullet")(YA=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).gravity=-18,e.elapsedTime=0,e.initialVelocity=new g(0,0,0),e.initialPosition=new g,e}Ot(e,t);var i=e.prototype;return i.shootWithVelocity=function(t){this.gravity=-me.GAME.PHYSIC_GRAVITY,this.elapsedTime=0,this.initialVelocity=t,this.initialPosition.set(this.node.position)},i.stop=function(){this.initialVelocity=g.ZERO.clone()},i.update=function(t){this.elapsedTime+=t;var e=this.calculatePosition(this.elapsedTime);this.node.setPosition(e)},i.calculatePosition=function(t){var e=new g;return e.x=this.initialPosition.x+this.initialVelocity.x*t,e.y=this.initialPosition.y+this.initialVelocity.y*t+.5*this.gravity*t*t,e.z=this.initialPosition.z+this.initialVelocity.z*t,e},e}(r))||YA);t._RF.pop(),t._RF.push({},"ac60c1uuSNLz566NcMsAduq","MathUtil",void 0);var QA,JA,$A,tM,eM,iM,nM,oM,rM,aM,sM,lM,cM,uM,hM,pM,dM,fM=180/Math.PI,gM=Math.PI/180,mM=function(){function t(){}return t.radiansToDegrees=function(t){return t*fM},t.degreesToRadians=function(t){return t*gM},t.clamp=function(t,e,i){return t<e?e:t>i?i:t},t.clamp01=function(e){return t.clamp(e,0,1)},t.lerp=function(e,i,n){return e+(i-e)*t.clamp01(n)},t.step=function(t,e){return e<t?0:1},t.smoothStep=function(e,i,n){return i*(n=-2*(n=t.clamp01(n))*n*n+3*n*n)+e*(1-n)},t.smoothDamp=function(e,i,n,o,r,a){r=null!=r?r:Number.POSITIVE_INFINITY,a=null!=a?a:O.deltaTime;var s=2/(o=Math.max(1e-4,o)),l=s*a,c=1/(1+l+.47999998927116394*l*l+.23499999940395355*l*l*l),u=e-i,h=i,p=r*o,d=t.clamp(u,-p,p),f=(n+s*d)*a,g=(n-s*f)*c,m=(i=e-d)+(d+f)*c;return h-e>0==m>h&&(g=((m=h)-h)/a),{value:m,velocity:g}},Nt(t,null,[{key:"rad2Deg",get:function(){return fM}},{key:"deg2Rad",get:function(){return gM}}]),t}();t._RF.pop(),t._RF.push({},"ee594FJk7xOGo9n2U0Qsd54","CameraController",void 0);var vM=e.ccclass,yM=e.property;QA=vM("CameraController"),JA=yM({type:c,displayName:"摄像机节点"}),$A=yM({type:c,displayName:"目标节点"}),tM=yM({displayName:"最小距离"}),eM=yM({displayName:"最大距离"}),iM=yM({displayName:"平滑时间"}),nM=yM({displayName:"鼠标滚轮敏感度"}),oM=yM({displayName:"双指触摸敏感度"}),QA((sM=Mt((aM=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,It(e,"cameraNode",sM,xt(e)),It(e,"targetNode",lM,xt(e)),It(e,"minDistance",cM,xt(e)),It(e,"maxDistance",uM,xt(e)),It(e,"smoothTime",hM,xt(e)),It(e,"mouseSensitivity",pM,xt(e)),It(e,"touchSensitivity",dM,xt(e)),e.currentValue=0,e.targetValue=0,e.currentVelocity=0,e.lastTouchesDistance=null,e.tempVec3=new g,e}Ot(e,t);var i=e.prototype;return i.onLoad=function(){this.init(),this.registerEvent()},i.onDestroy=function(){this.unregisterEvent()},i.registerEvent=function(){S.platform===S.Platform.MOBILE_BROWSER?(D.on(k.EventType.TOUCH_MOVE,this.onTouchMove,this),D.on(k.EventType.TOUCH_END,this.onTouchEnd,this)):D.on(k.EventType.MOUSE_WHEEL,this.onMouseWheel,this)},i.unregisterEvent=function(){S.platform===S.Platform.MOBILE_BROWSER?(D.off(k.EventType.TOUCH_MOVE,this.onTouchMove,this),D.off(k.EventType.TOUCH_END,this.onTouchEnd,this)):D.off(k.EventType.MOUSE_WHEEL,this.onMouseWheel,this)},i.init=function(){var t;this.cameraNode.lookAt(this.targetNode.getWorldPosition()),t=S.platform===S.Platform.MOBILE_BROWSER?15:8,this.setTarget(t)},i.onMouseWheel=function(t){var e=t.getScrollY()*this.mouseSensitivity;this.setTarget(this.targetValue-e)},i.onTouchMove=function(t){var e=t.getAllTouches();if(!(e.length<2)){var i=K.distance(e[0].getLocation(),e[1].getLocation());if(null!==this.lastTouchesDistance){var n=(i-this.lastTouchesDistance)*this.touchSensitivity;this.setTarget(this.targetValue-n)}this.lastTouchesDistance=i}},i.onTouchEnd=function(t){this.lastTouchesDistance=null},i.update=function(t){if(this.currentValue!==this.targetValue){var e=mM.smoothDamp(this.currentValue,this.targetValue,this.currentVelocity,this.smoothTime);this.currentVelocity=e.velocity,this.setCurrent(e.value)}},i.setCurrent=function(t){var e=g.subtract(this.tempVec3,this.cameraNode.getWorldPosition(),this.targetNode.getWorldPosition());e.normalize().multiplyScalar(t),this.cameraNode.setWorldPosition(e),this.currentValue=t},i.setTarget=function(t){this.targetValue=mM.clamp(t,this.minDistance,this.maxDistance)},e}(r)).prototype,"cameraNode",[JA],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),lM=Mt(aM.prototype,"targetNode",[$A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),cM=Mt(aM.prototype,"minDistance",[tM],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 5}}),uM=Mt(aM.prototype,"maxDistance",[eM],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 50}}),hM=Mt(aM.prototype,"smoothTime",[iM],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.1}}),pM=Mt(aM.prototype,"mouseSensitivity",[nM],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.05}}),dM=Mt(aM.prototype,"touchSensitivity",[oM],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.05}}),rM=aM));t._RF.pop(),t._RF.push({},"cc22b8mSmVF0q6lb6/6cNhf","ProjectileMath",void 0);var bM=180/Math.PI,_M=Math.PI/180,SM=function(){function t(){}return t.calculateTotalTime=function(t,e,i){var n=e*_M;return t/(i*Math.cos(n))},t.calculateAngleAtMoment=function(e,i,n,o){void 0===o&&(o=!1);var r=t.gravity,a=e*_M,s=i*Math.cos(a),l=i*Math.sin(a)-r*n,c=Math.atan(l/s);return o?c:c*bM},t.calculateDisplacementAtMoment=function(e,i,n){var o=t.gravity,r=e*_M;return{x:i*Math.cos(r)*n,y:i*Math.sin(r)*n-.5*o*Math.pow(n,2)}},t.calculateWithAngle=function(t,e,i){var n=me.GAME.PHYSIC_GRAVITY,o=i*_M,r=2*t*Math.sin(o)*Math.cos(o)-2*e*Math.pow(Math.cos(o),2);return r<0?NaN:Math.sqrt(n*Math.pow(t,2)/r)},t.calculateWithVelocity=function(e,i,n){var o=t.gravity,r=n,a=Math.pow(r,2),s=Math.pow(r,4)-o*(o*Math.pow(e,2)+2*i*a);if(s<0)return{angle1:NaN,angle2:NaN};var l=Math.sqrt(s),c=Math.atan((-a+l)/(-o*e)),u=Math.atan((-a-l)/(-o*e));return{angle1:c*bM,angle2:u*bM}},t.calculateWithMaxHeight=function(e,i,n){var o=t.gravity,r=n;if(r<0||r-i<0)return{angle:NaN,velocity:NaN,time:NaN};var a=Math.sqrt(2*o*r),s=Math.sqrt(2*o*(r-i)),l=(-a+s)/-o,c=(-a-s)/-o,u=Math.max(l,c),h=Math.atan(a*u/e),p=a/Math.sin(h);return{angle:h*bM,velocity:p,time:u}},Nt(t,null,[{key:"gravity",get:function(){return me.GAME.PHYSIC_GRAVITY}}]),t}();t._RF.pop(),t._RF.push({},"59f54A7NwlOiY/boc9L5zON","VectorUtil",void 0);var wM,TM,CM,EM,PM,AM,MM,OM,IM,xM=180/Math.PI,RM=new g,LM=function(){function t(){}return t.projectOnPlane=function(t,e){var i=g.dot(t,e),n=RM.set(e).multiplyScalar(i);return g.subtract(new g,t,n)},t.signedAngle=function(e,i,n){var o=t.projectOnPlane(e,n),r=t.projectOnPlane(i,n),a=o.normalize(),s=r.normalize(),l=g.cross(new g,a,s).normalize(),c=g.dot(l,n);return Math.acos(g.dot(a,s))*c*xM},t}();t._RF.pop(),t._RF.push({},"01c94oOie9EDZDjFFfzDe9j","TrajectoryDrawer",void 0);var NM,FM,DM,kM,zM,VM,BM,HM,UM,GM,WM,ZM,YM,qM,jM,KM,XM,QM,JM,$M,tO,eO,iO,nO,oO,rO,aO,sO=e.ccclass,lO=e.property,cO=(wM=sO("TrajectoryDrawer"),TM=lO({type:l,displayName:"prefab"}),CM=lO({displayName:"fixedQuantity"}),EM=lO({visible:function(){return this.fixedQuantity},displayName:"quantity"}),wM((MM=Mt((AM=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,It(e,"prefab",MM,xt(e)),It(e,"fixedQuantity",OM,xt(e)),It(e,"quantity",IM,xt(e)),e.points=[],e.nodePool=new et,e.tempVec3=new g,e.tempQuat=new St,e}Ot(e,t);var i=e.prototype;return i.draw=function(t,e,i,n,o,r){var a,s=g.subtract(new g,e,t),l=LM.projectOnPlane(s,g.UP),c=null!=o?o:l.length(),u=SM.calculateTotalTime(c,i,n)/(a=this.fixedQuantity?Math.ceil(this.quantity):Math.max(8,Math.ceil(3*c)));this.producePoints(a);for(var h=l.normalize(),p=this.points,d=this.tempVec3,f=this.tempQuat,m=0;m<a;m++){var v=p[m];v.active=!0;var y=(m+1)*u,b=SM.calculateDisplacementAtMoment(i,n,y),_=b.x,S=b.y,w=t.clone();w.add(d.set(h).multiplyScalar(_)),w.add(d.set(g.UP).multiplyScalar(S)),v.setWorldPosition(w);var T=St.fromViewUp(f,h,g.UP),C=-SM.calculateAngleAtMoment(i,n,y,!0);St.rotateX(T,T,C),v.setWorldRotation(T)}},i.clear=function(){this.producePoints(0)},i.setColor=function(t){var e=this.prefab.data.getComponent(ht);e||(e=this.prefab.data.getComponentInChildren(ht)),e&&e.sharedMaterial.setProperty("mainColor",t)},i.producePoints=function(t){var e=this.points;if(e.length<t)for(var i=t-e.length;i>0;)e.push(this.getPoint()),i--;else if(e.length>t)for(var n=e.length-t;n>0;)this.putPoint(e.pop()),n--},i.getPoint=function(){var t;return(t=this.nodePool.size()>0?this.nodePool.get():E(this.prefab)).setParent(this.node),t},i.putPoint=function(t){this.nodePool.size()<50?this.nodePool.put(t):t.destroy()},e}(r)).prototype,"prefab",[TM],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),OM=Mt(AM.prototype,"fixedQuantity",[CM],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),IM=Mt(AM.prototype,"quantity",[EM],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 20}}),PM=AM))||PM);t._RF.pop(),t._RF.push({},"af3dac0xL5BLrK8YABTwvI2","Cannon",void 0);var uO,hO,pO,dO,fO,gO,mO,vO=e.ccclass,yO=e.property,bO=function(t){return t[t.FIXED_ALL=1]="FIXED_ALL",t[t.FIXED_PITCH_ANGLE=2]="FIXED_PITCH_ANGLE",t[t.FIXED_VELOCITY=3]="FIXED_VELOCITY",t[t.UNFIXED=4]="UNFIXED",t}(bO||{}),_O=(NM=vO("Cannon"),FM=yO({type:c,displayName:"yawAxis",group:{name:"Configs",id:"1"}}),DM=yO({type:c,displayName:"pitchAxis",group:{name:"Configs",id:"1"}}),kM=yO({type:c,displayName:"firePoint",group:{name:"Configs",id:"1"}}),zM=yO({type:l,displayName:"bulletPrefab",group:{name:"model",id:"2"}}),VM=yO({type:c,group:{name:"model",id:"2"}}),BM=yO({type:R(bO),displayName:"mode",group:{name:"settings",id:"3"}}),HM=yO({displayName:"fixedPitchAngle",visible:function(){return this.mode===bO.FIXED_PITCH_ANGLE||this.mode===bO.FIXED_ALL},group:{name:"settings",id:"3"}}),UM=yO({displayName:"fixedVelocity",visible:function(){return this.mode===bO.FIXED_VELOCITY||this.mode===bO.FIXED_ALL},group:{name:"settings",id:"3"}}),GM=yO({displayName:"useSmallPitchAngle",visible:function(){return this.mode===bO.FIXED_VELOCITY},group:{name:"settings",id:"3"}}),WM=yO({type:cO,displayName:"trajectoryDrawer",group:{name:"trajectory",id:"4"}}),ZM=yO({displayName:"showTrajectory",visible:function(){return null!=this.trajectoryDrawer},group:{name:"trajectory",id:"4"}}),YM=yO({type:[lt],group:{name:"Animation",id:"5"}}),NM((KM=Mt((jM=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,It(e,"yawAxis",KM,xt(e)),It(e,"pitchAxis",XM,xt(e)),It(e,"firePoint",QM,xt(e)),It(e,"bulletPrefab",JM,xt(e)),It(e,"bulletContainer",$M,xt(e)),It(e,"mode",tO,xt(e)),It(e,"fixedPitchAngle",eO,xt(e)),It(e,"fixedVelocity",iO,xt(e)),It(e,"useSmallPitchAngle",nO,xt(e)),It(e,"trajectoryDrawer",oO,xt(e)),It(e,"_showTrajectory",rO,xt(e)),e.velocity=0,e.curTargetPos=new g(0,.753,-7.671),It(e,"shootAnimations",aO,xt(e)),e.shootAnimationState=[],e}Ot(e,t);var i=e.prototype;return i.rotateTo=function(t,e){this.pitch=t,this.yaw=e},i.aim=function(t){this.curTargetPos.set(t);var e=g.subtract(new g,t,this.mainPosition),i=-LM.signedAngle(e,this.mainForward,this.mainUp),n=NaN,o=NaN,r=NaN,a=!1;switch(this.mode){case bO.FIXED_ALL:n=this.fixedPitchAngle,r=this.fixedVelocity,a=!0;break;case bO.FIXED_PITCH_ANGLE:n=this.fixedPitchAngle,r=this.calculateVelocity(t,-n);break;case bO.FIXED_VELOCITY:r=this.fixedVelocity;var s=this.calculateAngle(t,r),l=s.angle1,c=s.angle2;isNaN(l)||isNaN(c)?a=!0:n=this.useSmallPitchAngle?-Math.min(l,c):-Math.max(l,c);break;case bO.UNFIXED:var u=this.calculateWithMaxHeight(t);n=-u.angle,r=u.velocity,o=u.time}return isNaN(n)&&(n=this.pitch),this.rotateTo(n,i),isNaN(r)||(this.velocity=r),this.trajectoryDrawer&&this.drawTrajectory(t,-this.pitch,this.velocity,a),{time:o,velocity:r,pitchAngle:n}},i.fire=function(t){var e=0;t&&(e=this.aim(t).time);var i=this.shoot(this.velocity);return v(this.yawAxis).to(.1,{position:m(0,-.1,.035)}).to(.35,{position:m(0,0,0)},{easing:_.quartOut}).start(),{flyTime:e,bullet:i}},i.shoot=function(t){var e=this.generateBullet(),i=e.forward.negative();i.multiplyScalar(t);var n=e.getComponent(XA);return n.shootWithVelocity(i),n},i.drawTrajectory=function(t,e,i,n){var o=this.firePoint.getWorldPosition();if(n){var r=SM.calculateDisplacementAtMoment(e,i,2).x;this.trajectoryDrawer.draw(o,t,e,i,r)}else this.trajectoryDrawer.draw(o,t,e,i)},i.generateBullet=function(){var t=E(this.bulletPrefab);return M.getScene().addChild(t),t.setWorldPosition(this.firePoint.getWorldPosition()),t.setWorldRotation(this.firePoint.getWorldRotation()),t},i.calculateDisplacement=function(t){var e=this.firePoint.getWorldPosition(),i=g.subtract(new g,t,e),n=i.y;return{horizontal:LM.projectOnPlane(i,g.UP).length(),vertical:n}},i.calculateVelocity=function(t,e){var i=this.calculateDisplacement(t),n=i.horizontal,o=i.vertical;return SM.calculateWithAngle(n,o,e)},i.calculateAngle=function(t,e){var i=this.calculateDisplacement(t),n=i.horizontal,o=i.vertical;return SM.calculateWithVelocity(n,o,e)},i.calculateWithMaxHeight=function(t){var e=this.calculateDisplacement(t),i=e.horizontal,n=e.vertical,o=Math.max(.5,n+.3*i);return SM.calculateWithMaxHeight(i,n,o)},i.fireWithAnimation=function(t,e){var i=this;this.shootAnimationState=[],this.shootAnimations.forEach((function(t){var e=t.getState("Shoot");e.speed=1,e.time=0,e.play(),i.shootAnimationState.push(e)})),this.scheduleOnce((function(){var n=i.fire(t),o=n.flyTime,r=n.bullet;i.scheduleOnce((function(){null==e||e(r)}),o),qi.instance.playSound("sfx_CannonWars_Shoot")}),.6)},Nt(e,[{key:"showTrajectory",get:function(){return this._showTrajectory},set:function(t){this._showTrajectory=t,this.trajectoryDrawer&&(t?this.curTargetPos&&this.aim(this.curTargetPos):this.trajectoryDrawer.clear())}},{key:"pitch",get:function(){return this.pitchAxis.eulerAngles.x},set:function(t){this.pitchAxis.setRotationFromEuler(t,0,0)}},{key:"yaw",get:function(){return this.yawAxis.eulerAngles.y},set:function(t){this.yawAxis.setRotationFromEuler(0,t,0)}},{key:"mainPosition",get:function(){return this.yawAxis.getWorldPosition()}},{key:"mainForward",get:function(){return this.yawAxis.parent.forward.negative()}},{key:"mainUp",get:function(){return this.yawAxis.up}}],[{key:"Mode",get:function(){return bO}}]),e}(r)).prototype,"yawAxis",[FM],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),XM=Mt(jM.prototype,"pitchAxis",[DM],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),QM=Mt(jM.prototype,"firePoint",[kM],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),JM=Mt(jM.prototype,"bulletPrefab",[zM],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),$M=Mt(jM.prototype,"bulletContainer",[VM],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),tO=Mt(jM.prototype,"mode",[BM],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return bO.FIXED_PITCH_ANGLE}}),eO=Mt(jM.prototype,"fixedPitchAngle",[HM],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-45}}),iO=Mt(jM.prototype,"fixedVelocity",[UM],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 5}}),nO=Mt(jM.prototype,"useSmallPitchAngle",[GM],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),oO=Mt(jM.prototype,"trajectoryDrawer",[WM],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),rO=Mt(jM.prototype,"_showTrajectory",[yO],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Mt(jM.prototype,"showTrajectory",[ZM],Object.getOwnPropertyDescriptor(jM.prototype,"showTrajectory"),jM.prototype),aO=Mt(jM.prototype,"shootAnimations",[YM],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),qM=jM))||qM);t._RF.pop(),t._RF.push({},"3e784wgXb5FD6qDmQMPWi5v","Cursor",void 0);var SO,wO,TO,CO,EO,PO,AO,MO=e.ccclass,OO=e.property,IO=(uO=MO("Cursor"),hO=OO({displayName:"adaptToSurface"}),pO=OO({type:c,displayName:"referNode",visible:function(){return this.adaptToSurface}}),uO((gO=Mt((fO=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,It(e,"_adaptToSurface",gO,xt(e)),It(e,"referNode",mO,xt(e)),e.tempVec3=new g,e.tempQuat=new St,e}return Ot(e,t),e.prototype.set=function(t,e){if(this.node.setWorldPosition(t),this.adaptToSurface&&e){var i,n,o=null!=(i=null==(n=this.referNode)?void 0:n.getWorldPosition())?i:g.ZERO,r=g.subtract(this.tempVec3,t,o),a=LM.projectOnPlane(r,e).normalize(),s=St.fromViewUp(this.tempQuat,a,e);this.node.setWorldRotation(s)}},Nt(e,[{key:"adaptToSurface",get:function(){return this._adaptToSurface},set:function(t){this._adaptToSurface=t,t||this.node.setWorldRotation(St.fromEuler(new St,0,0,0))}}]),e}(r)).prototype,"_adaptToSurface",[OO],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Mt(fO.prototype,"adaptToSurface",[hO],Object.getOwnPropertyDescriptor(fO.prototype,"adaptToSurface"),fO.prototype),mO=Mt(fO.prototype,"referNode",[pO],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),dO=fO))||dO);t._RF.pop(),t._RF.push({},"b1385xAyyhPB6TsvEBSW4MY","EffectManger",void 0);var xO,RO,LO,NO,FO,DO,kO,zO,VO,BO=e.ccclass,HO=e.property,UO=e.executionOrder;SO=BO("EffectManger"),wO=UO(-1),TO=HO({type:l,displayName:"炮弹爆炸效果预制体"}),SO(CO=wO(((AO=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,It(e,"bulletExplosionPrefab",PO,xt(e)),e}Ot(e,t);var i=e.prototype;return i.onLoad=function(){e._instance=this},i.onDestroy=function(){e._instance===this&&(e._instance=null)},i.playBulletExplosion=function(t){var e=E(this.bulletExplosionPrefab);M.getScene().addChild(e),e.setWorldPosition(t),this.scheduleOnce((function(){return e.destroy()}),1)},Nt(e,null,[{key:"instance",get:function(){return this._instance}}]),e}(r))._instance=null,PO=Mt((EO=AO).prototype,"bulletExplosionPrefab",[TO],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),CO=EO))||CO);t._RF.pop(),t._RF.push({},"065763s9dBIZrOHBYD+VlHO","ProjectileController",void 0);var GO,WO,ZO,YO,qO,jO,KO,XO=e.ccclass,QO=e.property;xO=XO("ProjectileController"),RO=QO({type:bt}),LO=QO({type:_O}),NO=QO({type:IO}),xO((kO=Mt((DO=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,It(e,"camera",kO,xt(e)),It(e,"cannon",zO,xt(e)),It(e,"cursor",VO,xt(e)),e.isActive=!1,e.aimValue={value:0},e.tweenAim=null,e.beginAimPosition=null,e.targetAimPosition=null,e}Ot(e,t);var i=e.prototype;return i.onLoad=function(){},i.onDestroy=function(){},i.update=function(t){this.updateAimPosition(t)},i.registerEvent=function(){S.platform===S.Platform.MOBILE_BROWSER?(D.on(k.EventType.TOUCH_START,this.onTouchStart,this),D.on(k.EventType.TOUCH_MOVE,this.onTouchMove,this),D.on(k.EventType.TOUCH_END,this.onTouchEnd,this)):(D.on(k.EventType.MOUSE_DOWN,this.onMouseDown,this),D.on(k.EventType.MOUSE_MOVE,this.onMouseMove,this),D.on(k.EventType.MOUSE_UP,this.onMouseUp,this))},i.unregisterEvent=function(){S.platform===S.Platform.MOBILE_BROWSER?(D.off(k.EventType.TOUCH_START,this.onTouchStart,this),D.off(k.EventType.TOUCH_MOVE,this.onTouchMove,this),D.off(k.EventType.TOUCH_END,this.onTouchEnd,this)):(D.off(k.EventType.MOUSE_DOWN,this.onMouseDown,this),D.off(k.EventType.MOUSE_MOVE,this.onMouseMove,this),D.off(k.EventType.MOUSE_UP,this.onMouseUp,this))},i.onTouchStart=function(t){t.getAllTouches().length>1||this.aimWithScreenPos(t.getLocation())},i.onTouchMove=function(t){t.getAllTouches().length>1||this.aimWithScreenPos(t.getLocation())},i.onTouchEnd=function(t){t.getAllTouches().length>0||(this.aimWithScreenPos(t.getLocation()),this.fire())},i.onMouseDown=function(t){this.aimWithScreenPos(t.getLocation())},i.onMouseMove=function(t){this.aimWithScreenPos(t.getLocation())},i.onMouseUp=function(t){this.fire()},i.aimWithScreenPos=function(t){if(this.isActive){var e=this.camera.screenPointToRay(t.x,t.y);if(wt.instance.raycastClosest(e)){var i=wt.instance.raycastClosestResult,n=i.hitPoint,o=i.hitNormal;this.cannon.aim(n),this.cursor.set(n,o)}}},i.aimToPosition=function(t,e,i){var n,o=this;if(void 0===e&&(e=0),void 0===i&&(i=null),e<=0)return this.cannon.aim(t),void this.cursor.set(t,g.FORWARD);this.aimValue.value=0,this.beginAimPosition=this.cannon.curTargetPos.clone(),this.targetAimPosition=t.clone(),null==(n=this.tweenAim)||n.stop(),this.tweenAim=v(this.aimValue).to(e,{value:1}).call((function(){o.tweenAim=null,o.cannon.aim(o.targetAimPosition),o.cursor.set(o.targetAimPosition,g.FORWARD),null==i||i()})).start()},i.updateAimPosition=function(t){if(null!==this.tweenAim){var e=g.lerp(new g,this.beginAimPosition,this.targetAimPosition,this.aimValue.value);this.cannon.aim(e),this.cursor.set(e,g.FORWARD)}},i.fire=function(){this.cannon.fire()},e}(r)).prototype,"camera",[RO],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),zO=Mt(DO.prototype,"cannon",[LO],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),VO=Mt(DO.prototype,"cursor",[NO],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),FO=DO));t._RF.pop(),t._RF.push({},"a48dbUuDTJPDp+LzPEDK4rA","ClickToLoadUrl",void 0);var JO,$O,tI,eI,iI,nI,oI,rI,aI,sI,lI,cI,uI,hI,pI,dI,fI,gI,mI,vI,yI,bI,_I,SI=e.ccclass,wI=e.property;GO=SI("ClickToLoadUrl"),WO=wI({multiline:!0}),ZO=wI({tooltip:"是否使用新窗口打开"}),GO((jO=Mt((qO=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,It(e,"url",jO,xt(e)),It(e,"openInNewTap",KO,xt(e)),e}Ot(e,t);var i=e.prototype;return i.onLoad=function(){this.registerEvent()},i.onDestroy=function(){this.unregisterEvent()},i.registerEvent=function(){this.node.on(c.EventType.TOUCH_END,this.onClick,this)},i.unregisterEvent=function(){this.node.off(c.EventType.TOUCH_END,this.onClick,this)},i.onClick=function(){var t=this.url;t&&""!==t&&(this.openInNewTap?window.open(t):window.location.href=t)},e}(r)).prototype,"url",[WO],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"https://gitee.com/ifaswind"}}),KO=Mt(qO.prototype,"openInNewTap",[ZO],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),YO=qO));t._RF.pop(),t._RF.push({},"1b4097H5s5E1YZkd5DJRPR9","HUD_Options",void 0);var TI,CI,EI,PI,AI,MI=e.ccclass,OI=e.property;JO=MI("HUD_Options"),$O=OI({type:c}),tI=OI({type:c}),eI=OI({type:_t}),iI=OI({type:Tt}),nI=OI({type:Tt}),oI=OI({type:z}),rI=OI({type:z}),aI=OI({type:z}),sI=OI({type:_O}),lI=OI({type:IO}),JO((hI=Mt((uI=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,It(e,"content",hI,xt(e)),It(e,"arrow",pI,xt(e)),It(e,"cannonModeToggleContainer",dI,xt(e)),It(e,"cannonAngleEditBox",fI,xt(e)),It(e,"cannonVelocityEditBox",gI,xt(e)),It(e,"cannonTrajectoryToggle",mI,xt(e)),It(e,"bulletExplodeToggle",vI,xt(e)),It(e,"cursorAdaptToggle",yI,xt(e)),It(e,"cannon",bI,xt(e)),It(e,"cursor",_I,xt(e)),e}Ot(e,t);var i=e.prototype;return i.onLoad=function(){this.init(),this.registerEvent()},i.onDestroy=function(){this.unregisterEvent()},i.registerEvent=function(){this.node.on(c.EventType.TOUCH_END,this.onTouchEnd,this)},i.unregisterEvent=function(){this.node.off(c.EventType.TOUCH_END,this.onTouchEnd,this)},i.onTouchEnd=function(t){this.changeState(!this.content.active)},i.init=function(){S.platform===S.Platform.MOBILE_BROWSER?this.node.setScale(new g(2,2,1)):this.node.setScale(new g(1,1,1)),this.changeState(!0);for(var t=_O.Mode[this.cannon.mode],e=this.cannonModeToggleContainer.toggleItems,i=0;i<e.length;i++)e[i].node.name===t&&(e[i].isChecked=!0);this.cannonAngleEditBox.string=this.cannon.fixedPitchAngle.toString(),this.cannonAngleEditBox.placeholder=this.cannon.fixedPitchAngle.toString(),this.cannonVelocityEditBox.string=this.cannon.fixedVelocity.toString(),this.cannonVelocityEditBox.placeholder=this.cannon.fixedVelocity.toString(),this.cannonTrajectoryToggle.isChecked=this.cannon.showTrajectory,this.bulletExplodeToggle.isChecked=XA.triggerExplode,this.cursorAdaptToggle.isChecked=this.cursor.adaptToSurface,this.changeState(!1)},i.changeState=function(t){this.content.active=t,this.arrow.angle=t?180:0},i.onCannonModeToggleChanged=function(t){switch(this.cannonModeToggleContainer.activeToggles()[0].node.name){case"FIXED_ALL":this.cannon.mode=_O.Mode.FIXED_ALL,this.cannonAngleEditBox.node.parent.active=!0,this.cannonVelocityEditBox.node.parent.active=!0;break;case"FIXED_PITCH_ANGLE":this.cannon.mode=_O.Mode.FIXED_PITCH_ANGLE,this.cannonAngleEditBox.node.parent.active=!0,this.cannonVelocityEditBox.node.parent.active=!1;break;case"FIXED_VELOCITY":this.cannon.mode=_O.Mode.FIXED_VELOCITY,this.cannonAngleEditBox.node.parent.active=!1,this.cannonVelocityEditBox.node.parent.active=!0;break;case"UNFIXED":this.cannon.mode=_O.Mode.UNFIXED,this.cannonAngleEditBox.node.parent.active=!1,this.cannonVelocityEditBox.node.parent.active=!1}},i.onCannonAngleEditBoxChanged=function(t){var e=Number(this.cannonAngleEditBox.string);isNaN(e)||e>0?this.cannonAngleEditBox.string=this.cannon.fixedPitchAngle.toString():this.cannon.fixedPitchAngle=e},i.onCannonVelocityEditBoxChanged=function(t){var e=Number(this.cannonVelocityEditBox.string);isNaN(e)||e<=0?this.cannonVelocityEditBox.string=this.cannon.fixedVelocity.toString():this.cannon.fixedVelocity=e},i.onCannonTrajectoryToggleChanged=function(t){var e=this.cannonTrajectoryToggle.isChecked;this.cannon.showTrajectory=e},i.onBulletExplodeToggleChanged=function(t){var e=this.bulletExplodeToggle.isChecked;XA.triggerExplode=e},i.onCursorAdaptToggleChanged=function(t){var e=this.cursorAdaptToggle.isChecked;this.cursor.adaptToSurface=e},e}(r)).prototype,"content",[$O],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),pI=Mt(uI.prototype,"arrow",[tI],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),dI=Mt(uI.prototype,"cannonModeToggleContainer",[eI],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),fI=Mt(uI.prototype,"cannonAngleEditBox",[iI],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),gI=Mt(uI.prototype,"cannonVelocityEditBox",[nI],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),mI=Mt(uI.prototype,"cannonTrajectoryToggle",[oI],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),vI=Mt(uI.prototype,"bulletExplodeToggle",[rI],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),yI=Mt(uI.prototype,"cursorAdaptToggle",[aI],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),bI=Mt(uI.prototype,"cannon",[sI],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_I=Mt(uI.prototype,"cursor",[lI],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),cI=uI));t._RF.pop(),t._RF.push({},"8d90ax9dDlNL5GpGoJYpjmB","HUD_Tips",void 0);var II=e.ccclass,xI=e.property;TI=II("HUD_Tips"),CI=xI({type:y}),TI((AI=Mt((PI=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,It(e,"label",AI,xt(e)),e}Ot(e,t);var i=e.prototype;return i.onLoad=function(){this.init()},i.init=function(){S.platform===S.Platform.MOBILE_BROWSER?(this.node.setScale(new g(1.5,1.5,1)),this.label.string="双指滑动可以调整摄像机距离"):(this.node.setScale(new g(1,1,1)),this.label.string="鼠标滚轮可以调整摄像机距离")},e}(r)).prototype,"label",[CI],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),EI=PI));t._RF.pop(),t._RF.push({},"298c3IQrZBP6Lx7XE+N393z","type",void 0);var RI=function(t){return t[t.Min=0]="Min",t[t.Max=1]="Max",t[t.Fixed=2]="Fixed",t[t.Texture=3]="Texture",t}({});RI._name="ConcretePrecisionType";var LI=function(t){return t[t.Texture2D=100]="Texture2D",t[t.TextureCube=101]="TextureCube",t}({});LI._name="TextureConcretePrecision";var NI=function(t){return t[t.Local=0]="Local",t[t.View=1]="View",t[t.World=2]="World",t}({});NI._name="PositionSpace";var FI=function(t){return t[t.Local=0]="Local",t[t.View=1]="View",t[t.World=2]="World",t}({});FI._name="NormalSpace";var DI=function(t){return t[t.Local=0]="Local",t[t.View=1]="View",t[t.World=2]="World",t}({});DI._name="ViewDirSpace",t._RF.pop(),t._RF.push({},"7ceabXBz/tABa7CTXDAMxJn","utils",void 0);var kI=globalThis.electron,zI=kI&&globalThis.require("fs-extra"),VI=kI&&globalThis.require("path");function BI(t){if("number"!=typeof t)return t;var e=t+"";return e.includes(".")||(e+="."),e}var HI=["x","y","z","w"],UI=["r","g","b","a"],GI=["e00","e01","e02","e03"];function WI(t,e){return BI(function(t,e){return"number"==typeof t?t:(void 0!==t.x?i=HI:void 0!==t.r?i=UI:void 0!==t.e00&&(i=GI),t[i[e]]||0);var i}(t,e))}function ZI(t){var e=1;return"object"==typeof t&&(void 0!==t.w||void 0!==t.a?e=4:void 0!==t.z||void 0!==t.b?e=3:void 0!==t.y||void 0!==t.g?e=2:void 0!==t.m_SerializedTexture?e=LI.Texture2D:void 0!==t.m_SerializedCubemap&&(e=LI.TextureCube)),e}function YI(t,e){var i="";return"boolean"===e?i="bool":1===t?i="float":2===t?i="vec2":3===t?i="vec3":4===t?i="vec4":t===LI.Texture2D?i="sampler2D":t===LI.TextureCube&&(i="samplerCube"),i}function qI(t,e,i,n,o){void 0===o&&(o={});var r={display:t,default:e,type:i,connectType:n};return Object.assign(r,o),r}function jI(t,e,i,n){void 0===n&&(n={});var o={display:t,default:e,type:i};return Object.assign(o,n),o}function KI(t,e){return("CC_"+t._name.replace("Space","")+"_"+t[e]).toUpperCase()}function XI(t,e){return"#define "+KI(t,e)+" 1"}function QI(t,e){var i,n;return(i=t,n=Object.getOwnPropertyNames(i),n.filter((function(t){return Number.isNaN(Number.parseFloat(t))&&"_name"!==t}))).forEach((function(i){var n=KI(t,t[i]);e.includes(n)||(e+="#define "+n+" 0\n")})),e}t._RF.pop(),t._RF.push({},"b05a8ea74hDTb7wArT51Kxn","property",void 0);var JI=function(t){return t.Float="Float",t.Boolean="Boolean",t.Vector2="Vector2",t.Vector3="Vector3",t.Vector4="Vector4",t.Color="Color",t.Texture2D="Texture2D",t.TextureCube="TextureCube",t}({}),$I=function(){function t(t){this.details={menu:"",style:{headerColor:"#ec7063"}},this.name="",this.type=JI.Float,this.value=0,this.outputs=[],this.type="string"==typeof t?JI[t]:t,this.name=JI[t],this.details.menu=this.name,this.updateDefaultValue()}var e=t.prototype;return e.setValue=function(t){this.value instanceof Ct?this.value.set(t):this.type===JI.Texture2D||this.type===JI.TextureCube?this.value._uuid=t.uuid:this.value=t},e.updateDefaultValue=function(){switch(this.type){case JI.Float:this.value=0,this.outputs=[qI("Out",this.value,"float","vector")];break;case JI.Boolean:this.value=!1,this.outputs=[qI("Out",this.value,"boolean","boolean")];break;case JI.Vector2:this.value=new K,this.outputs=[qI("Out",this.value,"vec2","vector")];break;case JI.Vector3:this.value=new g,this.outputs=[qI("Out",this.value,"vec3","vector")];break;case JI.Vector4:this.value=new Pt,this.outputs=[qI("Out",this.value,"vec4","vector")];break;case JI.Color:this.value=new X,this.outputs=[qI("Out",this.value,"color","vector")];break;case JI.Texture2D:this.value=new p,this.outputs=[qI("Out",this.value,"texture2D","texture2D")];break;case JI.TextureCube:this.value=new Et,this.outputs=[qI("Out",this.value,"textureCube","textureCube")]}},e.isTexture=function(){switch(this.type){case JI.Texture2D:case JI.TextureCube:return!0}return!1},Nt(t,[{key:"concretePrecision",get:function(){return ZI(this.value)}}]),t}();t._RF.pop(),t._RF.push({},"663baRF6QZFi6zhc8Qt66NF","register",void 0);var tx=new Map,ex=new Map,ix=new Map;function nx(t){return function(e){var i=new e,n=Object.getPrototypeOf(i.constructor).name,o={type:i.type,extend:n,details:t,node:i.data};"PropertyNode"===i.type&&function(t){for(var e in ex.clear(),JI){var i=JI[e];if("string"==typeof i){var n=new $I(i);n.type=i,ex.set(i,{type:i,declareType:t,name:n.name,outputs:n.outputs,default:n.value,details:n.details})}}}(i.type),ix.set(i.type,e),tx.set(i.type,o)}}t._RF.pop(),t._RF.push({},"ca808INO7FLGrJCNKRU+Sjn","index",void 0),t._RF.pop(),t._RF.push({},"130e0LrRvNOq7GOFf5/5IGV","context",void 0);var ox=new(function(){function t(){this.shaderTemplatesDir=void 0,this.allNodes=[],this.properties=[],this.localVars=[],this.getLocalVars=[]}return t.prototype.reset=function(){this.allNodes.length=0,this.properties.length=0,this.localVars.length=0,this.getLocalVars.length=0},t}());t._RF.pop(),t._RF.push({},"37bc8lcJkpAuZFrukwcAg+H","slot",void 0);var rx=0,ax=function(t){return t[t.Input=0]="Input",t[t.Output=1]="Output",t}({}),sx=function(){function t(t,e){this.data=void 0,this.globalID=0,this.id=0,this.displayName="",this.type=ax.Input,this.defaultValue=void 0,this.value=void 0,this.connectSlots=[],this.node=void 0,this._concretePrecision=-1,this.displayName=t.display,this.defaultValue=t.default,t.default instanceof Ct?this.value=t.default.clone():this.value=t.default,this.data=t,this.node=e,this.globalID=rx++}return Nt(t,[{key:"connectSlot",get:function(){var t=this.connectSlots[0];return t&&ox.getLocalVars.includes(t.node)?ox.localVars.find((function(e){return e.name===t.node.name})).inputs[0].connectSlot:this.connectSlots[0]},set:function(t){this.connectSlots.length=0,t&&(this.connectSlots[0]=t)}},{key:"connectNode",get:function(){return this.connectSlot&&this.connectSlot.node}},{key:"varName",get:function(){var t;return null!=(t=this.node)&&t.isPropertyNode?this.node.name:"var_"+this.globalID}},{key:"varDefine",get:function(){var t=YI(this.concretePrecision,this.data.type);return t&&(t+=" "),t+this.varName}},{key:"precisionName",get:function(){return YI(this.concretePrecision,this.data.type)}},{key:"isVector",get:function(){return"vector"===this.data.connectType}},{key:"slotValue",get:function(){var t=this.defaultConcretePrecision,e=this.concretePrecision,i="";if(this.connectSlot){if(t=this.connectSlot.concretePrecision,i=this.connectSlot.varName,this.isVector&&e!==t)if(e<t)1===e?i+=".x":2===e?i+=".xy":3===e&&(i+=".xyz");else if(1!==t){for(var n=e-t,o=[],r=0;r<n;r++)o.push("0.");i+=", "+o.join(", ")}}else{var a=this.value;if(this.isVector){var s=WI(a,0),l=WI(a,1),c=WI(a,2),u=WI(a,3);"object"!=typeof a&&(s=BI(a)),t=ZI(a);for(var h=[s,l,c,u],p=[],d=0;d<e;d++)p.push(void 0===h[d]?0:h[d]);i=p.join(", ")}else i=a}var f=""+i;return this.isVector&&(2===e?f="vec2("+i+")":3===e?f="vec3("+i+")":4===e&&(f="vec4("+i+")")),f}},{key:"defaultConcretePrecision",get:function(){var t=1,e=this.defaultValue;return"object"==typeof e&&(void 0!==e.w?t=4:void 0!==e.z?t=3:void 0!==e.y&&(t=2)),t}},{key:"concretePrecision",get:function(){if(-1===this._concretePrecision){var t,e=this.defaultValue;if(void 0===e)null!=(t=this.node)&&t.isPropertyNode&&(e=this.node.property.value);void 0===e&&console.error("Slot Value is undefined, concrete precision maybe wrong."),this._concretePrecision=ZI(e)}return this._concretePrecision}}]),t}();t._RF.pop(),t._RF.push({},"d0751arZzVMdrvnQr4rAMJC","base",void 0);var lx,cx=function(t,e){this.value=void 0,this.data=void 0,this.value=t instanceof Ct?t.clone():t,this.data=e},ux=function(){function t(){this.priority=0,this.uuid="",this.slots=[],this.depChunks=[],this.defines=[],this.isMasterNode=!1,this.isPropertyNode=!1,this.concretePrecisionType=RI.Min,this.fixedConcretePrecision=0,this.inputs=[],this.outputs=[],this.props=new Map,this.data={}}var e=t.prototype;return e.init=function(){var t=this;this.slots.length=0,this.inputs.length=0,this.outputs.length=0,this.data.inputs&&this.data.inputs.forEach((function(e){var i=new sx(e,t);t.inputs.push(i),t.slots.push(i)})),this.data.outputs&&this.data.outputs.forEach((function(e){var i=new sx(e,t);t.outputs.push(i),t.slots.push(i)})),this.data.props&&this.data.props.forEach((function(e){var i=new cx(e.default,e);t.props.set(e.display,i)}))},e.beforeGenreateCode=function(){},e.addDependency=function(t){t!==this&&(this.deps.includes(t)||this.deps.push(t))},e.calcConcretePrecision=function(){var t=this;if(this.fixedConcretePrecision>0&&this.slots.forEach((function(e){e._concretePrecision=t.fixedConcretePrecision})),this.concretePrecisionType!==RI.Fixed){var e=1;this.concretePrecisionType===RI.Min?(e=999,this.inputs.forEach((function(t){var i=t.concretePrecision;t.connectSlot&&(i=t.connectSlot.concretePrecision),e=Math.min(e,i)}))):this.concretePrecisionType===RI.Max?(e=-999,this.inputs.forEach((function(t){var i=t.concretePrecision;t.connectSlot&&(i=t.connectSlot.concretePrecision),e=Math.max(e,i)}))):this.concretePrecisionType===RI.Texture?e=LI.Texture2D:console.error("Not supported ConcretePrecisionType : "+this.concretePrecisionType),this.slots.forEach((function(t){t._concretePrecision=e}))}},e.setPriority=function(t){this.priority=Math.max(t,this.priority);for(var e=0;e<this.deps.length;e++)this.deps[e].setPriority(this.priority+1)},e.getPropWithName=function(t){var e;return this.props&&(e=this.props.get(t)),e||new cx(null,null)},e.getSlotWithSlotName=function(t){return this.slots.find((function(e){return e.displayName===t}))},e.getOutputSlotWithSlotName=function(t){return this.outputs.find((function(e){return e.displayName===t}))},e.getOutputVarName=function(t){return this.outputs[t].varName},e.getOutputVarDefine=function(t){return this.outputs[t].varDefine},e.getInputValue=function(t){return this.inputs[t].slotValue},e.generateCode=function(){return""},Nt(t,[{key:"type",get:function(){return this.constructor.name}},{key:"deps",get:function(){var t=[];return this.inputs.forEach((function(e){e.connectSlot&&t.push(e.connectSlot.node)})),t}}]),t}();t._RF.pop(),t._RF.push({},"21fbes9bMJN6oBb3TRVMZZ3","boolean",void 0);var hx;nx({menu:"Input/Basic/Boolean",title:"Boolean"})(lx=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).concretePrecisionType=RI.Fixed,e.data={inputs:[qI("In",0,"float","vector")],outputs:[qI("Out",0,"float","vector")]},e}Ot(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0);return"\n            "+this.getOutputVarDefine(0)+" = "+t+";\n        "},e}(ux));t._RF.pop(),t._RF.push({},"68e4bUVUSRHKo5B3bmMbsMV","float",void 0);var px;nx({menu:"Input/Basic/Float",title:"Float"})(hx=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).concretePrecisionType=RI.Fixed,e.data={inputs:[qI("In",0,"float","vector")],outputs:[qI("Out",0,"float","vector")]},e}Ot(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0);return"\n            "+this.getOutputVarDefine(0)+" = "+t+";\n        "},e}(ux));t._RF.pop(),t._RF.push({},"263a8VilSVCp4Eyo8YtLJnX","slider",void 0);var dx;nx({menu:"Input/Basic/Slider",title:"Slider"})(px=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).concretePrecisionType=RI.Fixed,e.data={inputs:[qI("In",0,"float","vector")],outputs:[qI("Out",0,"float","vector")]},e}Ot(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0);return"\n            "+this.getOutputVarDefine(0)+" = "+t+";\n        "},Nt(e,[{key:"type",get:function(){return"Slider"}}]),e}(ux));t._RF.pop(),t._RF.push({},"7f058nmp+ZIQ6FPIyLJ3wpK","vector2",void 0);var fx;nx({menu:"Input/Basic/Vector2",title:"Vector2"})(dx=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).concretePrecisionType=RI.Fixed,e.data={inputs:[qI("X",0,"float","vector"),qI("Y",0,"float","vector")],outputs:[qI("Out",K.ZERO,"vec2","vector")]},e}Ot(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0),e=this.getInputValue(1);return"\n            "+this.getOutputVarDefine(0)+" = vec2("+t+", "+e+");\n        "},e}(ux));t._RF.pop(),t._RF.push({},"99486WpmApIPoULZGXK9dCS","vector3",void 0);var gx;nx({menu:"Input/Basic/Vector3",title:"Vector3"})(fx=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).concretePrecisionType=RI.Fixed,e.data={inputs:[qI("X",0,"float","vector"),qI("Y",0,"float","vector"),qI("Z",0,"float","vector")],outputs:[qI("Out",g.ZERO,"vec3","vector")]},e}Ot(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0),e=this.getInputValue(1),i=this.getInputValue(2);return"\n            "+this.getOutputVarDefine(0)+" = vec3("+t+", "+e+", "+i+");\n        "},e}(ux));t._RF.pop(),t._RF.push({},"4e4e9VghSdMAohxS4AJDF0m","vector4",void 0);var mx;nx({menu:"Input/Basic/Vector4",title:"Vector4"})(gx=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).concretePrecisionType=RI.Fixed,e.data={inputs:[qI("X",0,"float","vector"),qI("Y",0,"float","vector"),qI("Z",0,"float","vector"),qI("W",0,"float","vector")],outputs:[qI("Out",Pt.ZERO,"vec4","vector")]},e}Ot(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0),e=this.getInputValue(1),i=this.getInputValue(2),n=this.getInputValue(3);return"\n            "+this.getOutputVarDefine(0)+" = vec4("+t+", "+e+", "+i+", "+n+");\n        "},e}(ux));t._RF.pop(),t._RF.push({},"bf087/OgI9HIaIKP+ZWp/tU","absolute",void 0);var vx;nx({menu:"Math/Advanced/Absolute",title:"Absolute"})(mx=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[qI("In",Pt.ZERO,"vec4","vector")],outputs:[qI("Out",Pt.ZERO,"vec4","vector")]},e}Ot(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0);return"\n            "+this.getOutputVarDefine(0)+" = abs("+t+");\n        "},e}(ux));t._RF.pop(),t._RF.push({},"5c4913KTCJGjqbcTxcC/UmQ","exponential",void 0);var yx;nx({menu:"Math/Advanced/Exponential",title:"Exponential"})(vx=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[qI("In",Pt.ZERO,"vec4","vector")],outputs:[qI("Out",Pt.ZERO,"vec4","vector")]},e}Ot(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0);return"\n            "+this.getOutputVarDefine(0)+" = exp("+t+");\n        "},e}(ux));t._RF.pop(),t._RF.push({},"d16658ODu5NPKUU74aU5bA5","length",void 0);var bx;nx({menu:"Math/Advanced/Length",title:"Length"})(yx=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[qI("In",Pt.ZERO,"vec4","vector")],outputs:[qI("Out",Pt.ZERO,"vec4","vector")]},e}Ot(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0);return"\n            "+this.getOutputVarDefine(0)+" = length("+t+");\n        "},e}(ux));t._RF.pop(),t._RF.push({},"40ca6yOjaJE8J+qRdu62/Jd","log",void 0);var _x;nx({menu:"Math/Advanced/Log",title:"Log"})(bx=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[qI("In",Pt.ZERO,"vec4","vector")],outputs:[qI("Out",Pt.ZERO,"vec4","vector")]},e}Ot(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0);return"\n            "+this.getOutputVarDefine(0)+" = log("+t+");\n        "},e}(ux));t._RF.pop(),t._RF.push({},"20807G1bipGRriFOGyGJxbW","modulo",void 0);var Sx;nx({menu:"Math/Advanced/Modulo",title:"Modulo"})(_x=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[qI("A",Pt.ZERO,"vec4","vector"),qI("B",Pt.ZERO,"vec4","vector")],outputs:[qI("Out",Pt.ZERO,"vec4","vector")]},e}Ot(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0),e=this.getInputValue(1);return"\n            "+this.getOutputVarDefine(0)+" = mod("+t+", "+e+");\n        "},e}(ux));t._RF.pop(),t._RF.push({},"1b741yPEQlEVL911xSY0qGi","negate",void 0);var wx;nx({menu:"Math/Advanced/Negate",title:"Negate"})(Sx=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[qI("In",Pt.ZERO,"vec4","vector")],outputs:[qI("Out",Pt.ZERO,"vec4","vector")]},e}Ot(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0);return"\n            "+this.getOutputVarDefine(0)+" = -"+t+";\n        "},e}(ux));t._RF.pop(),t._RF.push({},"00775HyBCRKYqjtgTFMEtIo","normalize",void 0);var Tx;nx({menu:"Math/Advanced/Normalize",title:"Normalize"})(wx=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[qI("In",Pt.ZERO,"vec4","vector")],outputs:[qI("Out",Pt.ZERO,"vec4","vector")]},e}Ot(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0);return"\n            "+this.getOutputVarDefine(0)+" = normalize("+t+");\n        "},e}(ux));t._RF.pop(),t._RF.push({},"83ac4Oj/INHY7tCCfwuaa6d","posterize",void 0);var Cx;nx({menu:"Math/Advanced/Posterize",title:"Posterize"})(Tx=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[qI("In",Pt.ZERO,"vec4","vector"),qI("Steps",Pt.ZERO,"vec4","vector")],outputs:[qI("Out",Pt.ZERO,"vec4","vector")]},e}Ot(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0),e=this.getInputValue(1);return"\n            "+this.getOutputVarDefine(0)+" = floor("+t+" / (1. / "+e+")) * (1. / "+e+");\n        "},e}(ux));t._RF.pop(),t._RF.push({},"eae1erXirxEXq46sl0FpxV0","reciprocal-square",void 0);var Ex;nx({menu:"Math/Advanced/ReciprocalSquare",title:"ReciprocalSquare"})(Cx=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[qI("In",Pt.ZERO,"vec4","vector")],outputs:[qI("Out",Pt.ZERO,"vec4","vector")]},e}Ot(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0);return"\n            "+this.getOutputVarDefine(0)+" = 1. / ("+t+" * "+t+");\n        "},e}(ux));t._RF.pop(),t._RF.push({},"5e330r2wGBAfouLL0jpsqul","reciprocal",void 0);var Px;nx({menu:"Math/Advanced/Reciprocal",title:"Reciprocal"})(Ex=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[qI("In",Pt.ZERO,"vec4","vector")],outputs:[qI("Out",Pt.ZERO,"vec4","vector")]},e}Ot(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0);return"\n            "+this.getOutputVarDefine(0)+" = 1. / "+t+";\n        "},e}(ux));t._RF.pop(),t._RF.push({},"37762nev7BLgIRh9U7rJXkP","add",void 0);var Ax;nx({menu:"Math/Basic/Add",title:"Add"})(Px=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).concretePrecisionType=RI.Max,e.data={inputs:[qI("A",Pt.ZERO,"vec4","vector"),qI("B",Pt.ZERO,"vec4","vector")],outputs:[qI("Out",Pt.ZERO,"vec4","vector")]},e}Ot(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0),e=this.getInputValue(1);return"\n            "+this.getOutputVarDefine(0)+" = "+t+" + "+e+";\n        "},e}(ux));t._RF.pop(),t._RF.push({},"027926d68NB7rx2YRTbh0wu","divide",void 0);var Mx;nx({menu:"Math/Basic/Divide",title:"Divide"})(Ax=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).concretePrecisionType=RI.Max,e.data={inputs:[qI("A",Pt.ZERO,"vec4","vector"),qI("B",Pt.ZERO,"vec4","vector")],outputs:[qI("Out",Pt.ZERO,"vec4","vector")]},e}Ot(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0),e=this.getInputValue(1);return"\n            "+this.getOutputVarDefine(0)+" = "+t+" / "+e+";\n        "},e}(ux));t._RF.pop(),t._RF.push({},"eb609R33glDfpL2KytmHUQe","multiply",void 0);var Ox;nx({menu:"Math/Basic/Multiply",title:"Multiply"})(Mx=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).concretePrecisionType=RI.Max,e.data={inputs:[qI("A",Pt.ZERO,"vec4","vector"),qI("B",Pt.ZERO,"vec4","vector")],outputs:[qI("Out",Pt.ZERO,"vec4","vector")]},e}Ot(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0),e=this.getInputValue(1);return"\n            "+this.getOutputVarDefine(0)+" = "+t+" * "+e+";\n        "},e}(ux));t._RF.pop(),t._RF.push({},"94eaaC4omdHcaTHrDX60+tq","power",void 0);var Ix;nx({menu:"Math/Basic/Power",title:"Power"})(Ox=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).concretePrecisionType=RI.Fixed,e.data={inputs:[qI("A",Pt.ZERO,"vec4","vector"),qI("B",Pt.ZERO,"vec4","vector")],outputs:[qI("Out",Pt.ZERO,"vec4","vector")]},e}Ot(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0),e=this.getInputValue(1);return"\n            "+this.getOutputVarDefine(0)+" = pow("+t+", "+e+");\n        "},e}(ux));t._RF.pop(),t._RF.push({},"861eejAxE9Kk5MHkzbOdXlI","square",void 0);var xx;nx({menu:"Math/Basic/Square",title:"Square"})(Ix=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[qI("A",Pt.ZERO,"vec4","vector")],outputs:[qI("Out",Pt.ZERO,"vec4","vector")]},e}Ot(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0);return"\n            "+this.getOutputVarDefine(0)+" = sqrt("+t+");\n        "},e}(ux));t._RF.pop(),t._RF.push({},"5fbb9DNFjJODZFHdbDe+csv","substract",void 0);var Rx;nx({menu:"Math/Basic/Substract",title:"Substract"})(xx=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).concretePrecisionType=RI.Max,e.data={inputs:[qI("A",Pt.ZERO,"vec4","vector"),qI("B",Pt.ZERO,"vec4","vector")],outputs:[qI("Out",Pt.ZERO,"vec4","vector")]},e}Ot(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0),e=this.getInputValue(1);return"\n            "+this.getOutputVarDefine(0)+" = "+t+" - "+e+";\n        "},e}(ux));t._RF.pop(),t._RF.push({},"a9e8cu/8AxJgqL6Mn6GY7sg","ddx",void 0);var Lx;nx({menu:"Math/Derivative/DDX",title:"DDX"})(Rx=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[qI("In",Pt.ZERO,"vec4","vector")],outputs:[qI("Out",Pt.ZERO,"vec4","vector")]},e}Ot(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0);return"\n            "+this.getOutputVarDefine(0)+" = dFdx("+t+");\n        "},e}(ux));t._RF.pop(),t._RF.push({},"ec1afn79wpEi5T7OYFN+OIo","ddxy",void 0);var Nx;nx({menu:"Math/Derivative/DDXY",title:"DDXY"})(Lx=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[qI("In",Pt.ZERO,"vec4","vector")],outputs:[qI("Out",Pt.ZERO,"vec4","vector")]},e}Ot(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0);return"\n            "+this.getOutputVarDefine(0)+" = abs(dFdx("+t+")) + abs(dFdy("+t+"));\n        "},e}(ux));t._RF.pop(),t._RF.push({},"8231cetsI5JAKl/k454/49j","ddy",void 0);var Fx;nx({menu:"Math/Derivative/DDY",title:"DDY"})(Nx=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[qI("In",Pt.ZERO,"vec4","vector")],outputs:[qI("Out",Pt.ZERO,"vec4","vector")]},e}Ot(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0);return"\n            "+this.getOutputVarDefine(0)+" = dFdy("+t+");\n        "},e}(ux));t._RF.pop(),t._RF.push({},"c589fRsjwlOb5Fzx0G64yl/","inverse-lerp",void 0);var Dx;nx({menu:"Math/Interpolation/InverseLerp",title:"InverseLerp"})(Fx=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[qI("A",Pt.ZERO,"vec4","vector"),qI("B",Pt.ZERO,"vec4","vector"),qI("T",Pt.ZERO,"vec4","vector")],outputs:[qI("Out",Pt.ZERO,"vec4","vector")]},e}Ot(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0),e=this.getInputValue(1),i=this.getInputValue(2);return"\n            "+this.getOutputVarDefine(0)+" = ("+i+" - "+t+") / ("+e+" - "+t+");\n        "},e}(ux));t._RF.pop(),t._RF.push({},"0583aaFcfFDfr3SugrLLX4t","lerp",void 0);var kx;nx({menu:"Math/Interpolation/Lerp",title:"Lerp"})(Dx=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).concretePrecisionType=RI.Max,e.data={inputs:[qI("A",Pt.ZERO,"vec4","vector"),qI("B",Pt.ZERO,"vec4","vector"),qI("T",Pt.ZERO,"vec4","vector")],outputs:[qI("Out",Pt.ZERO,"vec4","vector")]},e}Ot(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0),e=this.getInputValue(1),i=this.getInputValue(2);return"\n            "+this.getOutputVarDefine(0)+" = mix("+t+", "+e+", "+i+");\n        "},e}(ux));t._RF.pop(),t._RF.push({},"d4d9cMuNpBHKICVJVXTyXRO","smoothstep",void 0);var zx;nx({menu:"Math/Interpolation/Smoothstep",title:"Smoothstep"})(kx=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[qI("Edge1",Pt.ZERO,"vec4","vector"),qI("Edge2",Pt.ZERO,"vec4","vector"),qI("In",Pt.ZERO,"vec4","vector")],outputs:[qI("Out",Pt.ZERO,"vec4","vector")]},e}Ot(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0),e=this.getInputValue(1),i=this.getInputValue(2);return"\n            "+this.getOutputVarDefine(0)+" = smoothstep("+t+", "+e+", "+i+");\n        "},e}(ux));t._RF.pop(),t._RF.push({},"4637audjsFPEKaBJvnUsO5t","clamp",void 0);var Vx;nx({menu:"Math/Range/Clamp",title:"Clamp"})(zx=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[qI("In",Pt.ZERO,"vec4","vector"),qI("Min",Pt.ZERO,"vec4","vector"),qI("Max",Pt.ZERO,"vec4","vector")],outputs:[qI("Out",Pt.ZERO,"vec4","vector")]},e}Ot(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0),e=this.getInputValue(1),i=this.getInputValue(2);return"\n            "+this.getOutputVarDefine(0)+" = clamp("+t+", "+e+", "+i+");\n        "},e}(ux));t._RF.pop(),t._RF.push({},"1be9a5SW39Pr7Ypuq6zuC9D","fraction",void 0);var Bx;nx({menu:"Math/Range/Fraction",title:"Fraction"})(Vx=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[qI("In",Pt.ZERO,"vec4","vector")],outputs:[qI("Out",Pt.ZERO,"vec4","vector")]},e}Ot(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0);return"\n            "+this.getOutputVarDefine(0)+" = fract("+t+");\n        "},e}(ux));t._RF.pop(),t._RF.push({},"6e8a0vJMJZHLaTkO3zIBxfl","max",void 0);var Hx;nx({menu:"Math/Range/Max",title:"Max"})(Bx=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[qI("A",Pt.ZERO,"vec4","vector"),qI("B",Pt.ZERO,"vec4","vector")],outputs:[qI("Out",Pt.ZERO,"vec4","vector")]},e}Ot(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0),e=this.getInputValue(1);return"\n            "+this.getOutputVarDefine(0)+" = max("+t+", "+e+");\n        "},e}(ux));t._RF.pop(),t._RF.push({},"65629wgX7ZFlosarXfPMufw","min",void 0);var Ux;nx({menu:"Math/Range/Min",title:"Min"})(Hx=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[qI("A",Pt.ZERO,"vec4","vector"),qI("B",Pt.ZERO,"vec4","vector")],outputs:[qI("Out",Pt.ZERO,"vec4","vector")]},e}Ot(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0),e=this.getInputValue(1);return"\n            "+this.getOutputVarDefine(0)+" = min("+t+", "+e+");\n        "},e}(ux));t._RF.pop(),t._RF.push({},"cd61fVd7UJBB6ngXO+30nVS","one-minus",void 0);var Gx;nx({menu:"Math/Range/OneMinus",title:"OneMinus"})(Ux=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[qI("In",Pt.ZERO,"vec4","vector")],outputs:[qI("Out",Pt.ZERO,"vec4","vector")]},e}Ot(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0);return"\n            "+this.getOutputVarDefine(0)+" = 1. - "+t+";\n        "},e}(ux));t._RF.pop(),t._RF.push({},"33710RUTT1JXZDzqyhgRRxS","random-range",void 0);var Wx;nx({menu:"Math/Range/RandomRange",title:"RandomRange"})(Gx=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).concretePrecisionType=RI.Fixed,e.depChunks=["range"],e.data={inputs:[qI("seed",K.ZERO,"vec2","vector"),qI("minv",0,"float","vector"),qI("maxv",0,"float","vector")],outputs:[qI("Out",0,"float","vector")]},e}Ot(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0),e=this.getInputValue(1),i=this.getInputValue(2);return this.getOutputVarDefine(0)+" = RandomRange("+t+", "+e+", "+i+");"},e}(ux));t._RF.pop(),t._RF.push({},"c8987U3zUlCXZn8OW+mTz8j","remap",void 0);var Zx;nx({menu:"Math/Range/Remap",title:"Remap"})(Wx=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).concretePrecisionType=RI.Max,e.data={inputs:[qI("In",Pt.ZERO,"vec4","vector"),qI("InMinMax",K.ZERO,"vec2","vector"),qI("OutMinMax",K.ZERO,"vec2","vector")],outputs:[qI("Out",Pt.ZERO,"vec4","vector")]},e}Ot(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0),e=this.getInputValue(1),i=this.getInputValue(2);return"\n            "+this.getOutputVarDefine(0)+" = "+i+".x + ("+t+" - "+e+".x) * ("+i+".y - "+i+".x) / ("+e+".y - "+e+".x);\n        "},e}(ux));t._RF.pop(),t._RF.push({},"28c0baw9D1DwrDezfnwuGKN","saturate",void 0);var Yx;nx({menu:"Math/Range/Saturate",title:"Saturate"})(Zx=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[qI("In",Pt.ZERO,"vec4","vector")],outputs:[qI("Out",Pt.ZERO,"vec4","vector")]},e}Ot(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0);return"\n            "+this.getOutputVarDefine(0)+" = saturate("+t+");\n        "},e}(ux));t._RF.pop(),t._RF.push({},"9c519gjpitF6YbEaQTLOEve","ceil",void 0);var qx;nx({menu:"Math/Round/Ceil",title:"Ceil"})(Yx=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[qI("In",Pt.ZERO,"vec4","vector")],outputs:[qI("Out",Pt.ZERO,"vec4","vector")]},e}Ot(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0);return"\n            "+this.getOutputVarDefine(0)+" = ceil("+t+");\n        "},e}(ux));t._RF.pop(),t._RF.push({},"ee049iD/ZRMAqYgcXswPl0X","floor",void 0);var jx;nx({menu:"Math/Round/Floor",title:"Floor"})(qx=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[qI("In",Pt.ZERO,"vec4","vector")],outputs:[qI("Out",Pt.ZERO,"vec4","vector")]},e}Ot(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0);return"\n            "+this.getOutputVarDefine(0)+" = floor("+t+");\n        "},e}(ux));t._RF.pop(),t._RF.push({},"62b43+zJdRCqaCEyKSYFKtF","round",void 0);var Kx;nx({menu:"Math/Round/Round",title:"Round"})(jx=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[qI("In",Pt.ZERO,"vec4","vector")],outputs:[qI("Out",Pt.ZERO,"vec4","vector")]},e}Ot(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0);return"\n            "+this.getOutputVarDefine(0)+" = floor("+t+" + 0.5);\n        "},e}(ux));t._RF.pop(),t._RF.push({},"48af6KxjgJDrLG+h1577MoC","sign",void 0);var Xx;nx({menu:"Math/Round/Sign",title:"Sign"})(Kx=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[qI("In",Pt.ZERO,"vec4","vector")],outputs:[qI("Out",Pt.ZERO,"vec4","vector")]},e}Ot(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0);return"\n            "+this.getOutputVarDefine(0)+" = sign("+t+");\n        "},e}(ux));t._RF.pop(),t._RF.push({},"2b4cb9lBRBMqrQTPqc1e+XN","step",void 0);var Qx;nx({menu:"Math/Round/Step",title:"Step"})(Xx=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[qI("Edge",Pt.ZERO,"vec4","vector"),qI("In",Pt.ZERO,"vec4","vector")],outputs:[qI("Out",Pt.ZERO,"vec4","vector")]},e}Ot(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0),e=this.getInputValue(1);return"\n            "+this.getOutputVarDefine(0)+" = step("+t+", "+e+");\n        "},e}(ux));t._RF.pop(),t._RF.push({},"96ddfY+NwRNKa+F0/nHJXIw","truncate",void 0);var Jx;nx({menu:"Math/Round/Truncate",title:"Truncate"})(Qx=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[qI("In",Pt.ZERO,"vec4","vector")],outputs:[qI("Out",Pt.ZERO,"vec4","vector")]},e}Ot(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0);return"\n            "+this.getOutputVarDefine(0)+" = trunc("+t+");\n        "},e}(ux));t._RF.pop(),t._RF.push({},"d296eo8ejhAz4SJ+Afh3Ceo","arccosine",void 0);var $x;nx({menu:"Math/Trigonometry/Arccosine",title:"Arccosine"})(Jx=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[qI("In",Pt.ZERO,"vec4","vector")],outputs:[qI("Out",Pt.ZERO,"vec4","vector")]},e}Ot(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0);return"\n            "+this.getOutputVarDefine(0)+" = acos("+t+");\n        "},e}(ux));t._RF.pop(),t._RF.push({},"63135dmizRJ4Jf8BpVKF+Wm","arcsine",void 0);var tR;nx({menu:"Math/Trigonometry/Arcsine",title:"Arcsine"})($x=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[qI("In",Pt.ZERO,"vec4","vector")],outputs:[qI("Out",Pt.ZERO,"vec4","vector")]},e}Ot(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0);return"\n            "+this.getOutputVarDefine(0)+" = asin("+t+");\n        "},e}(ux));t._RF.pop(),t._RF.push({},"2986999N5lOG433MyYF3lBY","arctangent",void 0);var eR;nx({menu:"Math/Trigonometry/Arctangent",title:"Arctangent"})(tR=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[qI("In",Pt.ZERO,"vec4","vector")],outputs:[qI("Out",Pt.ZERO,"vec4","vector")]},e}Ot(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0);return"\n            "+this.getOutputVarDefine(0)+" = atan("+t+");\n        "},e}(ux));t._RF.pop(),t._RF.push({},"2a9c8rn4+VHWa4BXpsUBf1R","arctangent2",void 0);var iR;nx({menu:"Math/Trigonometry/Arctangent2",title:"Arctangent2"})(eR=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[qI("A",Pt.ZERO,"vec4","vector"),qI("B",Pt.ZERO,"vec4","vector")],outputs:[qI("Out",Pt.ZERO,"vec4","vector")]},e}Ot(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0),e=this.getInputValue(1);return"\n            "+this.getOutputVarDefine(0)+" = atan2("+t+", "+e+");\n        "},e}(ux));t._RF.pop(),t._RF.push({},"2e9b7mUik5Cj7/HtwG5GjOg","cosine",void 0);var nR;nx({menu:"Math/Trigonometry/Cosine",title:"Cosine"})(iR=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[qI("In",Pt.ZERO,"vec4","vector")],outputs:[qI("Out",Pt.ZERO,"vec4","vector")]},e}Ot(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0);return"\n            "+this.getOutputVarDefine(0)+" = cos("+t+");\n        "},e}(ux));t._RF.pop(),t._RF.push({},"54cccLnyalN+rGU9RVdf0Ob","degrees-to-radians",void 0);var oR;nx({menu:"Math/Trigonometry/DegreesToRadians",title:"DegreesToRadians"})(nR=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[qI("In",Pt.ZERO,"vec4","vector")],outputs:[qI("Out",Pt.ZERO,"vec4","vector")]},e}Ot(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0);return"\n            "+this.getOutputVarDefine(0)+" = radians("+t+");\n        "},e}(ux));t._RF.pop(),t._RF.push({},"d1158zUxl5K7KSvlL2F7+wS","hyperbolic-cosine",void 0);var rR;nx({menu:"Math/Trigonometry/HyperbolicCosine",title:"HyperbolicCosine"})(oR=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[qI("In",Pt.ZERO,"vec4","vector")],outputs:[qI("Out",Pt.ZERO,"vec4","vector")]},e}Ot(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0);return"\n            "+this.getOutputVarDefine(0)+" = cosh("+t+");\n        "},e}(ux));t._RF.pop(),t._RF.push({},"d0e30ycExdAl4oLI765JfTS","hyperbolic-sine",void 0);var aR;nx({menu:"Math/Trigonometry/HyperbolicSine",title:"HyperbolicSine"})(rR=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[qI("In",Pt.ZERO,"vec4","vector")],outputs:[qI("Out",Pt.ZERO,"vec4","vector")]},e}Ot(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0);return"\n            "+this.getOutputVarDefine(0)+" = sinh("+t+");\n        "},e}(ux));t._RF.pop(),t._RF.push({},"b180bsrU6dCOKdx5slTh5p9","hyperbolic",void 0);var sR;nx({menu:"Math/Trigonometry/Hyperbolic",title:"Hyperbolic"})(aR=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[qI("In",Pt.ZERO,"vec4","vector")],outputs:[qI("Out",Pt.ZERO,"vec4","vector")]},e}Ot(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0);return"\n            "+this.getOutputVarDefine(0)+" = tanh("+t+");\n        "},e}(ux));t._RF.pop(),t._RF.push({},"122290sL5ZBopCyAP2bpg8T","radians-to-degrees",void 0);var lR;nx({menu:"Math/Trigonometry/RadiansToDegrees",title:"RadiansToDegrees"})(sR=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[qI("In",Pt.ZERO,"vec4","vector")],outputs:[qI("Out",Pt.ZERO,"vec4","vector")]},e}Ot(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0);return"\n            "+this.getOutputVarDefine(0)+" = degrees("+t+");\n        "},e}(ux));t._RF.pop(),t._RF.push({},"203ea3iMklAUK9FzJeavWJF","sine",void 0);var cR;nx({menu:"Math/Trigonometry/Sine",title:"Sine"})(lR=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[qI("In",Pt.ZERO,"vec4","vector")],outputs:[qI("Out",Pt.ZERO,"vec4","vector")]},e}Ot(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0);return"\n            "+this.getOutputVarDefine(0)+" = sin("+t+");\n        "},e}(ux));t._RF.pop(),t._RF.push({},"adcb4trf/1C6627yz7YeTXn","tangent",void 0);var uR;nx({menu:"Math/Trigonometry/Tangent",title:"Tangent"})(cR=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[qI("In",Pt.ZERO,"vec4","vector")],outputs:[qI("Out",Pt.ZERO,"vec4","vector")]},e}Ot(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0);return"\n            "+this.getOutputVarDefine(0)+" = tan("+t+");\n        "},e}(ux));t._RF.pop(),t._RF.push({},"13009pA4vlKI5jSuhV9uAJV","cross-product",void 0);var hR;nx({menu:"Math/Vector/CrossProduct",title:"CrossProduct"})(uR=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[qI("A",Pt.ZERO,"vec4","vector"),qI("B",Pt.ZERO,"vec4","vector")],outputs:[qI("Out",Pt.ZERO,"vec4","vector")]},e}Ot(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0),e=this.getInputValue(1);return"\n            "+this.getOutputVarDefine(0)+" = cross("+t+", "+e+");\n        "},e}(ux));t._RF.pop(),t._RF.push({},"1d67fgjFt5PYIIoSIE7uP03","distance",void 0);var pR;nx({menu:"Math/Vector/Distance",title:"Distance"})(hR=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).concretePrecisionType=RI.Fixed,e.data={inputs:[qI("A",Pt.ZERO,"vec4","vector"),qI("B",Pt.ZERO,"vec4","vector")],outputs:[qI("Out",0,"float","vector")]},e}Ot(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0),e=this.getInputValue(1);return"\n            "+this.getOutputVarDefine(0)+" = distance("+t+", "+e+");\n        "},e}(ux));t._RF.pop(),t._RF.push({},"fe81frs65tLqqp2QPfF1tCJ","dot-product",void 0);var dR;nx({menu:"Math/Vector/DotProduct",title:"DotProduct"})(pR=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).concretePrecisionType=RI.Fixed,e.data={inputs:[qI("A",Pt.ZERO,"vec4","vector"),qI("B",Pt.ZERO,"vec4","vector")],outputs:[qI("Out",0,"float","vector")]},e}Ot(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0),e=this.getInputValue(1);return"\n            "+this.getOutputVarDefine(0)+" = dot("+t+", "+e+");\n        "},e}(ux));t._RF.pop(),t._RF.push({},"861c8JYxalKB66ptbnD6WdM","fresnel",void 0);var fR;nx({menu:"Math/Vector/Fresnel",title:"Fresnel"})(dR=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).concretePrecisionType=RI.Fixed,e.data={inputs:[qI("Normal",g.ZERO,"vec3","vector"),qI("ViewDir",g.ZERO,"vec3","vector"),qI("Power",0,"float","vector")],outputs:[qI("Out",0,"float","vector")]},e}Ot(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0),e=this.getInputValue(1),i=this.getInputValue(2);return"\n            "+this.getOutputVarDefine(0)+" = pow((1.0 - saturate(dot(normalize("+t+"), normalize("+e+")))), "+i+");\n        "},e}(ux));t._RF.pop(),t._RF.push({},"76ce8feSIBML7x6UxKZ/iDJ","projection",void 0);var gR;nx({menu:"Math/Vector/Projection",title:"Projection"})(fR=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[qI("A",Pt.ZERO,"vec4","vector"),qI("B",Pt.ZERO,"vec4","vector")],outputs:[qI("Out",Pt.ZERO,"vec4","vector")]},e}Ot(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0),e=this.getInputValue(1);return"\n            "+this.getOutputVarDefine(0)+" = "+e+" * dot("+t+", "+e+") / dot("+e+", "+e+");\n        "},e}(ux));t._RF.pop(),t._RF.push({},"83264s8H2BKlb81PIs6fbLm","reflection",void 0);var mR;nx({menu:"Math/Vector/Reflection",title:"Reflection"})(gR=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[qI("In",Pt.ZERO,"vec4","vector"),qI("Normal",Pt.ZERO,"vec4","vector")],outputs:[qI("Out",Pt.ZERO,"vec4","vector")]},e}Ot(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0),e=this.getInputValue(1);return"\n            "+this.getOutputVarDefine(0)+" = reflect("+t+", "+e+");\n        "},e}(ux));t._RF.pop(),t._RF.push({},"36176dcQhhIm7tg8pihGhm0","rejection",void 0);var vR;nx({menu:"Math/Vector/Rejection",title:"Rejection"})(mR=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[qI("A",Pt.ZERO,"vec4","vector"),qI("B",Pt.ZERO,"vec4","vector")],outputs:[qI("Out",Pt.ZERO,"vec4","vector")]},e}Ot(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0),e=this.getInputValue(1);return"\n            "+this.getOutputVarDefine(0)+" = "+t+" - ("+e+" * dot("+t+", "+e+") / dot("+e+", "+e+"))\n        "},e}(ux));t._RF.pop(),t._RF.push({},"2fd4cAU0iRIFbD4p8meWHjx","sphere-mask",void 0);var yR;nx({menu:"Math/Vector/SphereMask",title:"SphereMask"})(vR=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[qI("Coords",Pt.ZERO,"vec4","vector"),qI("Center",Pt.ZERO,"vec4","vector"),qI("Radius",0,"float","vector"),qI("Hardness",0,"float","vector")],outputs:[qI("Out",Pt.ZERO,"vec4","vector")]},e}Ot(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0),e=this.getInputValue(1),i=this.getInputValue(2),n=this.getInputValue(3);return"\n            "+this.getOutputVarDefine(0)+" = 1 - saturate((distance("+t+", "+e+") - "+i+") / (1 - "+n+"));\n        "},e}(ux));t._RF.pop(),t._RF.push({},"fdd3afGjspKIb7t04FDpYVl","noise-sine-wave",void 0);var bR;nx({menu:"Math/Wave/NoiseSineWave",title:"NoiseSineWave"})(yR=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[qI("In",Pt.ZERO,"vec4","vector"),qI("MinMax",K.ZERO,"vec2","vector")],outputs:[qI("Out",Pt.ZERO,"vec4","vector")]},e}Ot(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0),e=this.getInputValue(1);return"\n            float sinIn = sin("+t+");\n            float sinInOffset = sin("+t+" + 1.0);\n            float randomno =  frac(sin((sinIn - sinInOffset) * (12.9898 + 78.233))*43758.5453);\n            float noise = lerp("+e+".x, "+e+".y, randomno);\n            "+this.getOutputVarDefine(0)+" = sinIn + noise;\n        "},e}(ux));t._RF.pop(),t._RF.push({},"00c7bwAaf9HZYpgf9WzhbZa","sawtooth-wave",void 0);var _R;nx({menu:"Math/Wave/SawtoothWave",title:"SawtoothWave"})(bR=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[qI("In",Pt.ZERO,"vec4","vector")],outputs:[qI("Out",Pt.ZERO,"vec4","vector")]},e}Ot(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0);return"\n            "+this.getOutputVarDefine(0)+" = 2 * ("+t+" - floor(0.5 + "+t+"));\n        "},e}(ux));t._RF.pop(),t._RF.push({},"d9905hEvfVIh6Iwo+//rZfV","square-wave",void 0);var SR;nx({menu:"Math/Wave/SquareWave",title:"SquareWave"})(_R=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[qI("In",Pt.ZERO,"vec4","vector")],outputs:[qI("Out",Pt.ZERO,"vec4","vector")]},e}Ot(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0);return"\n            "+this.getOutputVarDefine(0)+" = 1.0 - 2.0 * round(frac("+t+"));\n        "},e}(ux));t._RF.pop(),t._RF.push({},"92a3eZPGhZGbpxgWBNEKAGs","triangle-wave",void 0);var wR;nx({menu:"Math/Wave/TriangleWave",title:"TriangleWave"})(SR=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[qI("In",Pt.ZERO,"vec4","vector")],outputs:[qI("Out",Pt.ZERO,"vec4","vector")]},e}Ot(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0);return"\n            "+this.getOutputVarDefine(0)+" = 2.0 * abs( 2 * ("+t+" - floor(0.5 + "+t+")) ) - 1.0;\n        "},e}(ux));t._RF.pop(),t._RF.push({},"5ccd4lVn2JLsKN+1DWNpIFz","gradient-noise",void 0);var TR;nx({menu:"Procedural/Noise/GradientNoise",title:"GradientNoise"})(wR=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).concretePrecisionType=RI.Fixed,e.depChunks=["noise"],e.data={inputs:[qI("uv",K.ZERO,"vec2","vector"),qI("scale",0,"float","vector")],outputs:[qI("Out",0,"float","vector")]},e}Ot(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0);this.inputs[0].connectSlot||(t="v_uv.xy");var e=this.getInputValue(1);return this.getOutputVarDefine(0)+" = GradientNoise("+t+", "+e+");"},e}(ux));t._RF.pop(),t._RF.push({},"35746vutFFE/Y01CS8ARMHq","simple-noise",void 0);var CR;nx({menu:"Procedural/Noise/SimpleNoise",title:"SimpleNoise"})(TR=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).concretePrecisionType=RI.Fixed,e.depChunks=["noise"],e.data={inputs:[qI("uv",K.ZERO,"vec2","vector"),qI("scale",0,"float","vector")],outputs:[qI("Out",0,"float","vector")]},e}Ot(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0);this.inputs[0].connectSlot||(t="v_uv.xy");var e=this.getInputValue(1);return this.getOutputVarDefine(0)+" = SimpleNoise("+t+", "+e+");"},e}(ux));t._RF.pop(),t._RF.push({},"71cb8o0v7xEvJDEaB1PCHhM","ellipse",void 0);var ER;nx({menu:"Procedural/Shape/Ellipse",title:"Ellipse"})(CR=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).concretePrecisionType=RI.Fixed,e.depChunks=["shape"],e.data={inputs:[qI("uv",K.ZERO,"vec2","vector"),qI("width",.5,"float","vector"),qI("height",.5,"float","vector")],outputs:[qI("Out",0,"float","vector")]},e}Ot(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0);this.inputs[0].connectSlot||(t="v_uv.xy");var e=this.getInputValue(1),i=this.getInputValue(2);return this.getOutputVarDefine(0)+" = Ellipse("+t+", "+e+", "+i+");"},e}(ux));t._RF.pop(),t._RF.push({},"c5bfexyH39Fw4zoC+a2iqVE","rectangle",void 0);var PR;nx({menu:"Procedural/Shape/Rectangle",title:"Rectangle"})(ER=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).concretePrecisionType=RI.Fixed,e.depChunks=["shape"],e.data={inputs:[qI("uv",K.ZERO,"vec2","vector"),qI("width",.5,"float","vector")],outputs:[qI("Out",0,"float","vector")]},e}Ot(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0);this.inputs[0].connectSlot||(t="v_uv.xy");var e=this.getInputValue(1);return this.getOutputVarDefine(0)+" = Rectangle("+t+", "+e+");"},e}(ux));t._RF.pop(),t._RF.push({},"ce89b57LA5CTpEIa3CV7imi","round-rectangle",void 0);var AR;nx({menu:"Procedural/Shape/RoundRectangle",title:"RoundRectangle"})(PR=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).concretePrecisionType=RI.Fixed,e.depChunks=["shape"],e.data={inputs:[qI("uv",K.ZERO,"vec2","vector"),qI("width",.5,"float","vector"),qI("radius",.1,"float","vector")],outputs:[qI("Out",0,"float","vector")]},e}Ot(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0);this.inputs[0].connectSlot||(t="v_uv.xy");var e=this.getInputValue(1),i=this.getInputValue(2);return this.getOutputVarDefine(0)+" = RoundRectangle("+t+", "+e+", "+i+");"},e}(ux));t._RF.pop(),t._RF.push({},"db427Xs0q5CMbRASs8quHqY","polar-coordinates",void 0);var MR;nx({menu:"Uv/PolarCoordinates",title:"PolarCoordinates"})(AR=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).concretePrecisionType=RI.Fixed,e.depChunks=["uv"],e.data={inputs:[qI("uv",K.ZERO,"vec2","vector"),qI("center",K.ZERO,"vec2","vector"),qI("radialScale",0,"float","vector"),qI("lengthScale",0,"float","vector")],outputs:[qI("Out",K.ZERO,"vec2","vector")]},e}Ot(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0);this.inputs[0].connectSlot||(t="v_uv.xy");var e=this.getInputValue(1),i=this.getInputValue(2),n=this.getInputValue(3);return this.getOutputVarDefine(0)+" = PolarCoordinates("+t+", "+e+", "+i+", "+n+");"},e}(ux));t._RF.pop(),t._RF.push({},"d6912eLcHVBjrq4U/b1qppk","rotate-coordinates",void 0);var OR;nx({menu:"Uv/RotateCoordinates",title:"RotateCoordinates"})(MR=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).concretePrecisionType=RI.Fixed,e.depChunks=["uv"],e.data={inputs:[qI("uv",K.ZERO,"vec2","vector"),qI("center",K.ZERO,"vec2","vector"),qI("rotation",0,"float","vector")],outputs:[qI("Out",K.ZERO,"vec2","vector")]},e}Ot(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0);this.inputs[0].connectSlot||(t="v_uv.xy");var e=this.getInputValue(1),i=this.getInputValue(2);return this.getOutputVarDefine(0)+" = RotateCoordinates("+t+", "+e+", "+i+");"},e}(ux));t._RF.pop(),t._RF.push({},"5f40e+RWa9OQYJs/kAgd0eT","tilling-and-offset",void 0);var IR;nx({menu:"Uv/TillingAndOffset",title:"TillingAndOffset"})(OR=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).concretePrecisionType=RI.Fixed,e.depChunks=["uv"],e.data={inputs:[qI("uv",K.ZERO,"vec2","vector"),qI("tilling",K.ZERO,"vec2","vector"),qI("offset",K.ZERO,"vec2","vector")],outputs:[qI("Out",K.ZERO,"vec2","vector")]},e}Ot(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0);this.inputs[0].connectSlot||(t="v_uv.xy");var e=this.getInputValue(1),i=this.getInputValue(2);return"\n            "+this.getOutputVarDefine(0)+" = "+t+" * "+e+" + "+i+";\n        "},e}(ux));t._RF.pop(),t._RF.push({},"ce045mF1/xFUKqKc7YUTgo5","index",void 0),t._RF.pop(),t._RF.push({},"c9cd7cUxzJGfqrBxyo6i9Gm","combine",void 0);var xR;nx({menu:"Channel/Combine",title:"Combine"})(IR=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).concretePrecisionType=RI.Fixed,e.data={inputs:[qI("R",0,"float","vector"),qI("G",0,"float","vector"),qI("B",0,"float","vector"),qI("A",0,"float","vector")],outputs:[qI("RGBA",Pt.ZERO,"vec4","vector"),qI("RGB",g.ZERO,"vec3","vector"),qI("RG",K.ZERO,"vec2","vector")]},e}return Ot(e,t),e.prototype.generateCode=function(){var t=this.getSlotWithSlotName("R"),e=this.getSlotWithSlotName("G"),i=this.getSlotWithSlotName("B"),n=this.getSlotWithSlotName("A"),o=this.getSlotWithSlotName("RGBA"),r=this.getSlotWithSlotName("RGB"),a=this.getSlotWithSlotName("RG"),s="";return o&&o.connectSlot&&(s+=(null==o?void 0:o.varDefine)+" = vec4("+(null==t?void 0:t.slotValue)+", "+(null==e?void 0:e.slotValue)+", "+(null==i?void 0:i.slotValue)+", "+(null==n?void 0:n.slotValue)+");\n"),r&&r.connectSlot&&(s+=(null==r?void 0:r.varDefine)+" = vec3("+(null==t?void 0:t.slotValue)+", "+(null==e?void 0:e.slotValue)+", "+(null==i?void 0:i.slotValue)+");\n"),a&&a.connectSlot&&(s+=(null==a?void 0:a.varDefine)+" = vec2("+(null==t?void 0:t.slotValue)+", "+(null==e?void 0:e.slotValue)+");\n"),s},e}(ux));t._RF.pop(),t._RF.push({},"3da06y4hU1Ow4fHMuaVh9Ox","split",void 0);nx({menu:"Channel/Split",title:"Split"})(xR=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).concretePrecisionType=RI.Fixed,e.data={inputs:[qI("Vector",new Pt,"vec4","vector")],outputs:[qI("R",0,"float","vector"),qI("G",0,"float","vector"),qI("B",0,"float","vector"),qI("A",0,"float","vector")]},e}return Ot(e,t),e.prototype.generateCode=function(){var t=this,e=this.getInputValue(0),i=[];return this.data.outputs.forEach((function(n){var o=t.getOutputSlotWithSlotName(n.display);o&&o.connectSlot&&i.push("float "+(null==o?void 0:o.varName)+" = "+e+"."+n.display.toLowerCase()+";")})),i.join("\n")},e}(ux));t._RF.pop(),t._RF.push({},"fcee9eMBvJBt5SDLbWEpbbO","input-node",void 0);var RR,LR=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).concretePrecisionType=RI.Fixed,e}return Ot(e,t),e}(ux);t._RF.pop(),t._RF.push({},"93194csMENJ+oWCPxFCx+9c","property-node",void 0);var NR;nx({style:{headerColor:"#ec7063"}})(RR=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).concretePrecisionType=RI.Fixed,e.property=null,e.name="",e.data={outputs:[qI("Out",{},"any","any")]},e.isPropertyNode=!0,e}Ot(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){var t=this,e=0;switch(ox.properties.find((function(e){return e.name===t.name})).type){case JI.Float:case JI.Boolean:e=1;break;case JI.Vector2:e=2;break;case JI.Vector3:e=4;break;case JI.Vector4:case JI.Color:e=4}this.slots[0]._concretePrecision=e},i.generateCode=function(){return""},e}(ux));t._RF.pop(),t._RF.push({},"08b1ekFRoNLQ5UDBj6YtBOO","all",void 0);var FR;nx({menu:"Logic/All",title:"All"})(NR=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).concretePrecisionType=RI.Min,e.data={inputs:[qI("In",Pt.ZERO,"vec4","vector")],outputs:[qI("Out",!1,"boolean","boolean")]},e}Ot(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){for(var t=this.getInputValue(0),e=this.getOutputVarDefine(0),i=["x","y","z","w"],n=[],o=this.slots[0].concretePrecision,r=0;r<o;r++)n.push("("+t+"."+i[r]+" > 0.)");return"\n            "+e+" = ("+n.join(" && ")+");\n        "},e}(ux));t._RF.pop(),t._RF.push({},"ad796qaJ35K1pVtAoiLAQwn","and",void 0);var DR;nx({menu:"Logic/And",title:"And"})(FR=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).concretePrecisionType=RI.Max,e.data={inputs:[qI("A",!1,"boolean","boolean"),qI("B",!1,"boolean","boolean")],outputs:[qI("Out",!1,"boolean","boolean")]},e}Ot(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0),e=this.getInputValue(1);return"\n            "+this.getOutputVarDefine(0)+" = ("+t+" && "+e+");\n        "},e}(ux));t._RF.pop(),t._RF.push({},"c213eN4ql1Fo5ECkorGOGam","any",void 0);var kR;nx({menu:"Logic/Any",title:"Any"})(DR=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).concretePrecisionType=RI.Min,e.data={inputs:[qI("In",Pt.ZERO,"vec4","vector")],outputs:[qI("Out",!1,"boolean","boolean")]},e}Ot(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){for(var t=this.getInputValue(0),e=this.getOutputVarDefine(0),i=["x","y","z","w"],n=[],o=this.slots[0].concretePrecision,r=0;r<o;r++)n.push("("+t+"."+i[r]+" > 0.)");return"\n            "+e+" = ("+n.join(" || ")+");\n        "},e}(ux));t._RF.pop(),t._RF.push({},"2f31f/lK6hGfInMVVNdS8Sy","branch",void 0);var zR;nx({menu:"Logic/Branch",title:"Branch"})(kR=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).concretePrecisionType=RI.Max,e.data={inputs:[qI("Predicate",!1,"boolean","boolean"),qI("True",Pt.ZERO,"vec4","vector"),qI("False",Pt.ZERO,"vec4","vector")],outputs:[qI("Out",Pt.ZERO,"vec4","vector")]},e}Ot(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0),e=this.getInputValue(1),i=this.getInputValue(2);return"\n            "+this.getOutputVarDefine(0)+" = ("+t+") ? ("+e+") : ("+i+");\n        "},e}(ux));t._RF.pop(),t._RF.push({},"29cf0dWHHJIo4dVJcv8q6Ik","comparison",void 0);var VR,BR=function(t){return t[t.Equal=0]="Equal",t[t.NotEqual=1]="NotEqual",t[t.Less=2]="Less",t[t.LessOrEqual=3]="LessOrEqual",t[t.Greater=4]="Greater",t[t.GreaterOrEqual=5]="GreaterOrEqual",t}(BR||{});nx({menu:"Logic/Comparison",title:"Comparison"})(zR=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).concretePrecisionType=RI.Fixed,e.fixedConcretePrecision=1,e.data={props:[jI("Type",BR.Equal,"enum",{enum:BR})],inputs:[qI("A",0,"float","vector"),qI("B",0,"float","vector")],outputs:[qI("Out",0,"boolean","boolean")]},e}Ot(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0),e=this.getInputValue(1),i=this.getOutputVarDefine(0),n="";switch(this.getPropWithName("Type").value){case BR.Equal:n="("+t+" == "+e+")";break;case BR.NotEqual:n="("+t+" != "+e+")";break;case BR.Less:n="("+t+" < "+e+")";break;case BR.LessOrEqual:n="("+t+" <= "+e+")";break;case BR.Greater:n="("+t+" > "+e+")";break;case BR.GreaterOrEqual:n="("+t+" >= "+e+")"}return"\n            "+i+" = "+n+";\n        "},e}(ux));t._RF.pop(),t._RF.push({},"c8ed6hsGT1HOKJ9Qr9y8+aM","is-nan",void 0);var HR;nx({menu:"Logic/IsNan",title:"IsNan"})(VR=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).concretePrecisionType=RI.Fixed,e.fixedConcretePrecision=1,e.data={inputs:[qI("In",0,"float","vector")],outputs:[qI("Out",!1,"boolean","boolean")]},e}Ot(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0);return"\n            "+this.getOutputVarDefine(0)+" = isnan("+t+");\n        "},e}(ux));t._RF.pop(),t._RF.push({},"aad29jVDvZJX7eHgVCkzuSx","not",void 0);var UR;nx({menu:"Logic/Not",title:"Not"})(HR=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).concretePrecisionType=RI.Max,e.data={inputs:[qI("In",!1,"boolean","boolean")],outputs:[qI("Out",!1,"boolean","boolean")]},e}Ot(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0);return"\n            "+this.getOutputVarDefine(0)+" = (!"+t+");\n        "},e}(ux));t._RF.pop(),t._RF.push({},"a2b3fR0/g9EC7haT+6NqTEL","or",void 0);nx({menu:"Logic/Or",title:"Or"})(UR=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).concretePrecisionType=RI.Max,e.data={inputs:[qI("A",!1,"boolean","boolean"),qI("B",!1,"boolean","boolean")],outputs:[qI("Out",!1,"boolean","boolean")]},e}Ot(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0),e=this.getInputValue(1);return"\n            "+this.getOutputVarDefine(0)+" = ("+t+" || "+e+");\n        "},e}(ux));t._RF.pop(),t._RF.push({},"1eab7ptCA1KiK+C6tmMVON/","MasterNode",void 0);var GR=function(t){return t[t.Vertex=0]="Vertex",t[t.Fragment=1]="Fragment",t}({});function WR(t,e){if(t.connectSlot){var i=t.connectNode;if(i){if(e.includes(i))return;i.inputs.forEach((function(t){WR(t,e)})),e.push(i)}}}var ZR,YR=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).isMasterNode=!0,e.concretePrecisionType=RI.Fixed,e.properties=[],e.data={inputs:[]},e}Ot(e,t);var i=e.prototype;return i.getConnectNodes=function(t){var e=[];return t.forEach((function(t){WR(t,e)})),e.sort((function(t,e){return e.priority-t.priority})),e},i.generatePropertiesCode=function(){var t="\n",e="\n",i="",n=ox.properties;n.sort((function(t,e){return e.concretePrecision-t.concretePrecision}));var o=0;return n.forEach((function(n){var r="",a="",s=n.value,l=n.type===JI.Color,c=s.x,u=s.y,h=s.z,p=s.w;if(n.type===JI.Texture2D)r="sampler2D",a="white";else if(n.type===JI.TextureCube)r="samplerCube",a="white";else{var d=n.concretePrecision;1===d?(r="float",a=""+s):2===d?(r="vec2",a="["+c+", "+u+"]"):3===d?(r="vec4",a="["+c+", "+u+", "+h+", 0]"):4===d&&(r="vec4",a="["+c+", "+u+", "+h+",  "+p+"]")}var f=l?", editor: { type: color }":"";n.isTexture()?i+="  uniform "+r+" "+n.name+";\n":(t+="    "+r+" "+n.name+";\n",o++),e+="        "+n.name+": { value: "+a+" "+f+"}\n"})),0===o&&(t+="    vec4 empty_value;\n"),{uniform:t,uniformSampler:i,mtl:e}},i.replaceChunks=function(t){var e=["common"];ox.allNodes.forEach((function(t){for(var i=0;i<t.depChunks.length;i++)e.includes(t.depChunks[i])||e.push(t.depChunks[i])}));var i="\n",n="\n";return e.forEach((function(t){var e=VI.join(ox.shaderTemplatesDir,"chunks/"+t+".chunk"),o=zI.readFileSync(e,"utf-8");o?(n+=o+"\n",i+="  #include <shader_graph_"+t+">\n"):console.error("Can not find chunk with path ["+e+"]")})),t=(t=(t=t.replace("{{chunks}}",n)).replace("{{vs_chunks}}",i)).replace("{{fs_chunks}}",i)},i.generateDefines=function(t){var e=[];ox.allNodes.forEach((function(t){t.defines.forEach((function(t){e.includes(t)||e.push(t)}))}));var i="";e.forEach((function(t){i+=t+"\n"})),i=QI(FI,i),i=QI(NI,i);var n=(i=QI(DI,i)).split("\n");return n=n.map((function(t){return"  "+t})),i=n.join("\n"),t.replace(/{{defines}}/g,i)},i.generateSlotsCode=function(t){var e=["\n"];return this.getConnectNodes(t).forEach((function(t){t.calcConcretePrecision(),t.generateCode().split("\n").forEach((function(i){i&&(i+=" // "+t.constructor.name,e.push("    "+i))}))})),e.join("\n")},i.generateCodeChunk=function(t){var e=this,i=[];return this.inputs.forEach((function(t){var e=t.data;i[e.codeChunk]||(i[e.codeChunk]=[]),i[e.codeChunk].push(t)})),i.forEach((function(i,n){var o=e.generateSlotsCode(i);t=t.replace("{{code_chunk_"+n+"}}",o)})),t},i.generateCode=function(){var t=zI.readFileSync(this.templatePath,"utf-8");t=this.generateCodeChunk(t),t=this.generateDefines(t),t=this.replaceChunks(t),ox.properties&&0!==ox.properties.length||(t=(t=t.replace(/properties: &props/g,"")).replace(/properties: \*props/g,""));var e=this.generatePropertiesCode();t=(t=(t=t.replace("{{properties}}",e.uniform)).replace("{{properties_sampler}}",e.uniformSampler)).replace("{{properties_mtl}}",e.mtl);var i=["Vertex Position","Vertex Normal","Vertex Tangent","Position"];return this.inputs.forEach((function(e){var n,o="slot_"+e.displayName.replace(/ /g,"_");i.includes(e.displayName)||"Normal"===e.displayName?e.connectSlot&&(n=e.slotValue):n=e.slotValue;var r=new RegExp("{{"+o+" *= *(.*)}}","g");if(void 0===n){var a=r.exec(t);a&&(n=a[1])}t=t.replace(r,n)})),t},i.createMaterial=function(){var t=Rt(Lt().mark((function t(e){var i,n,o,r;return Lt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=this.generateCode(),n=new At,"shader-graph-preview.effect",t.next=5,e("shader-graph-preview.effect",i);case 5:return o=t.sent,r=new cc.EffectAsset,Object.assign(r,o),r.onLoaded(),n.initialize({effectAsset:o}),t.next=12,Promise.all(ox.properties.map(Rt(Lt().mark((function t(e){var i;return Lt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.type!==JI.Texture2D&&e.type!==JI.TextureCube){t.next=3;break}return i=e.value.uuid,t.abrupt("return",new Promise((function(t){u.loadAny(i,(function(i,o){if(i)return console.error(i),t(null);n.setProperty(e.name,o),t(null)}))})));case 3:case"end":return t.stop()}}),t)})))));case 12:return t.abrupt("return",n);case 13:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}(),Nt(e,[{key:"templatePath",get:function(){return""}}]),e}(ux);t._RF.pop(),t._RF.push({},"3dc0bllbkxAsKzvUgvzcrgb","SurfaceMasterNode",void 0);var qR;nx({title:"Surface",master:!0})(ZR=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[qI("Vertex Position",g.ZERO,"vec3","vector",{slotType:GR.Vertex,codeChunk:0}),qI("Vertex Normal",g.ZERO,"vec3","vector",{slotType:GR.Vertex,codeChunk:0}),qI("Vertex Tangent",g.ZERO,"vec3","vector",{slotType:GR.Vertex,codeChunk:0}),qI("Albedo",new Pt(.5,.5,.5,.5),"color","vector",{slotType:GR.Fragment,codeChunk:3}),qI("Normal",g.ZERO,"vec3","vector",{slotType:GR.Fragment,codeChunk:3}),qI("Emission",g.ZERO,"vec3","vector",{slotType:GR.Fragment,codeChunk:3}),qI("Metallic",.6,"float","vector",{slotType:GR.Fragment,codeChunk:3}),qI("Roughness",.5,"float","vector",{slotType:GR.Fragment,codeChunk:3}),qI("Occlusion",1,"float","vector",{slotType:GR.Fragment,codeChunk:3}),qI("SpecularIntensity",.5,"float","vector",{slotType:GR.Fragment,codeChunk:3}),qI("Alpha",1,"float","vector",{slotType:GR.Fragment,codeChunk:3}),qI("AlphaClipThreshold",.5,"float","vector",{slotType:GR.Fragment,codeChunk:3}),qI("AnisotropyRotation",0,"float","vector",{slotType:GR.Fragment,codeChunk:3}),qI("AnisotropyShape",1,"float","vector",{slotType:GR.Fragment,codeChunk:3})]},e}return Ot(e,t),e.prototype.generateCode=function(){var e,i;null==(e=this.getSlotWithSlotName("AnisotropyRotation"))||e.connectSlot,null==(i=this.getSlotWithSlotName("AnisotropyShape"))||i.connectSlot;return t.prototype.generateCode.call(this)},Nt(e,[{key:"templatePath",get:function(){return VI.join(ox.shaderTemplatesDir,"master/SurfaceMasterNode.effect")}}]),e}(YR));t._RF.pop(),t._RF.push({},"f3fa2kI6ulBJKyUfbfTCT2P","UnlitMasterNode",void 0);var jR;nx({title:"Unlit",master:!0})(qR=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[qI("Vertex Position",g.ZERO,"vec3","vector",{slotType:GR.Vertex,codeChunk:0}),qI("Vertex Normal",g.ZERO,"vec3","vector",{slotType:GR.Vertex,codeChunk:0}),qI("Vertex Tangent",g.ZERO,"vec3","vector",{slotType:GR.Vertex,codeChunk:0}),qI("BaseColor",new Pt(.5,.5,.5,.5),"color","vector",{slotType:GR.Fragment,codeChunk:3}),qI("Alpha",1,"float","vector",{slotType:GR.Fragment,codeChunk:3}),qI("AlphaClipThreshold",0,"float","vector",{slotType:GR.Fragment,codeChunk:3})]},e}return Ot(e,t),e.generatePreviewCode=function(t){var i=new e;i.init();var n=i.getSlotWithSlotName("BaseColor");return n&&(n.connectSlots[0]=t.outputs[0]),i.generateCode()},Nt(e,[{key:"templatePath",get:function(){return VI.join(ox.shaderTemplatesDir,"master/UnlitMasterNode.effect")}}]),e}(YR));t._RF.pop(),t._RF.push({},"159abqfjclCYp0gqjzKIy69","SubGraphNode",void 0);var KR;nx({style:{headerColor:"#757575"}})(jR=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[qI("In",0,"any","any")],outputs:[qI("Out",0,"any","any")]},e}return Ot(e,t),e}(ux));t._RF.pop(),t._RF.push({},"a7a1dWl92NFI7N6B5WUHBcO","SubGraphOutputNode",void 0);var XR;nx({title:"Output",master:!0,style:{headerColor:"#81ff2f"}})(KR=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[qI("Out",0,"any","any")]},e}return Ot(e,t),e}(ux));t._RF.pop(),t._RF.push({},"f8b0fdliVNBereLRNhLivTf","PreviewNode",void 0),t._RF.pop(),t._RF.push({},"e3d34kNDmBJC7P5ldMA5yga","color",void 0);var QR;nx({menu:"Input/Basic/Color",title:"Color"})(XR=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).fixedConcretePrecision=4,e.data={props:[jI("Color",new Pt,"color")],outputs:[qI("Out",new Pt,"vec4","vector")]},e}return Ot(e,t),e.prototype.generateCode=function(){var t=this.getPropWithName("Color").value;return"vec4 "+this.getOutputVarName(0)+" = vec4("+t.x+", "+t.y+", "+t.z+", "+t.w+");"},e}(LR));t._RF.pop(),t._RF.push({},"d78e7iowiJHXbVo2J+jhSXo","time",void 0);var JR;nx({menu:"Input/Basic/Time",title:"Time"})(QR=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).data={outputs:[qI("Time",0,"float","vector"),qI("Sine Time",0,"float","vector"),qI("Cosine Time",0,"float","vector"),qI("Delta Time",0,"float","vector"),qI("Smooth Delta",0,"float","vector")]},e}return Ot(e,t),e.prototype.generateCode=function(){var t=this.getOutputSlotWithSlotName("Time"),e=this.getOutputSlotWithSlotName("Sine Time"),i=this.getOutputSlotWithSlotName("Cosine Time"),n=this.getOutputSlotWithSlotName("Delta Time"),o=this.getOutputSlotWithSlotName("Smooth Delta"),r="";return null!=t&&t.connectSlot&&(r+="float "+t.varName+" = cc_time.x;"),null!=e&&e.connectSlot&&(r+="float "+e.varName+" = sin(cc_time.x);"),null!=i&&i.connectSlot&&(r+="float "+i.varName+" = cos(cc_time.x);"),null!=n&&n.connectSlot&&(r+="float "+n.varName+" = cc_time.y;"),null!=o&&o.connectSlot&&(console.warn("Not support smooth delta time"),r+="float "+o.varName+" = cc_time.y;"),r},e}(LR));t._RF.pop(),t._RF.push({},"f4d52tjGCZK1JsKsZ4QUDNC","normal-vector",void 0);var $R;nx({menu:"Input/Geometry/NormalVector",title:"NormalVector"})(JR=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).concretePrecisionType=RI.Fixed,e.fixedConcretePrecision=3,e.data={props:[jI("Space",FI.World,"enum",{enum:FI})],outputs:[qI("Normal",g.ZERO,"vec3","vector")]},e}return Ot(e,t),e.prototype.generateCode=function(){var t=this.getPropWithName("Space"),e="normal";return t.value===FI.Local?e="normal":t.value===FI.View?e="viewNormal":t.value===FI.World&&(e="worldNormal"),this.defines=[XI(FI,t.value)],this.getOutputVarDefine(0)+" = "+e+";"},e}(ux));t._RF.pop(),t._RF.push({},"c4117F5YClIWKQl+GltCNqQ","position",void 0);var tL;nx({menu:"Input/Geometry/Position",title:"Position"})($R=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).concretePrecisionType=RI.Fixed,e.fixedConcretePrecision=3,e.data={props:[jI("Space",NI.World,"enum",{enum:NI})],outputs:[qI("Position",new g,"vec3","vector")]},e}return Ot(e,t),e.prototype.generateCode=function(){var t=this.getPropWithName("Space"),e="position";return t.value===NI.Local?e="position":t.value===NI.View?e="viewPos":t.value===NI.World&&(e="worldPos"),this.defines=[XI(NI,t.value)],this.getOutputVarDefine(0)+" = "+e+".xyz;"},e}(ux));t._RF.pop(),t._RF.push({},"95b7bSNki1Ba5Pk4AQXXcG5","uv",void 0);var eL;nx({menu:"Input/Geometry/UV",title:"UV"})(tL=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).concretePrecisionType=RI.Fixed,e.fixedConcretePrecision=2,e.data={props:[jI("Channel",0,"float")],outputs:[qI("UV",new K,"vec2","vector")]},e}return Ot(e,t),e.prototype.generateCode=function(){var t=this.getPropWithName("Channel");if(!t)return console.warn("UV Node generate code undefined"),"";var e="v_uv"+(t.value>0?t.value:"");return this.getOutputVarDefine(0)+" = "+e+";"},e}(ux));t._RF.pop(),t._RF.push({},"57f73xnQclNJoH/LZDbCo8N","vertex-color",void 0);var iL;nx({menu:"Input/Geometry/VertexColor",title:"VertexColor"})(eL=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).concretePrecisionType=RI.Fixed,e.fixedConcretePrecision=4,e.data={outputs:[qI("Out",new Pt,"vec4","vector")]},e}return Ot(e,t),e.prototype.generateCode=function(){return this.getOutputVarDefine(0)+" = FSInput_vertexColor;"},e}(ux));t._RF.pop(),t._RF.push({},"fbe73AP6NxBTqOrL07ng2zD","view-direction",void 0);var nL;nx({menu:"Input/Geometry/ViewDirection",title:"ViewDirection"})(iL=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).concretePrecisionType=RI.Fixed,e.fixedConcretePrecision=3,e.data={props:[jI("Space",DI.World,"enum",{enum:DI})],outputs:[qI("ViewDirection",new g,"vec3","vector")]},e}return Ot(e,t),e.prototype.generateCode=function(){var t=this.getPropWithName("Space"),e="view";return t.value===DI.Local?e="view":t.value===DI.View?e="viewView":t.value===DI.World&&(e="worldView"),this.defines=[XI(DI,t.value)],this.getOutputVarDefine(0)+" = "+e+";"},Nt(e,[{key:"type",get:function(){return"ViewDirection"}}]),e}(ux));t._RF.pop(),t._RF.push({},"ae6c5dYR/dM3qMNrhlBY9Hs","texture-asset",void 0),t._RF.pop(),t._RF.push({},"f593b68ejRHboYTcPDL7dZe","cubemap-asset",void 0),t._RF.pop(),t._RF.push({},"6f28a7ED/hGlLSDg1Rd/nOf","sample-cubemap",void 0),t._RF.pop(),t._RF.push({},"5895aMpjJJED5bYGNm0JmUq","sample-texture2d",void 0);var oL,rL=function(t){return t[t.Default=0]="Default",t[t.Normal=1]="Normal",t}(rL||{}),aL=function(t){return t[t.Tangent=0]="Tangent",t[t.Object=1]="Object",t}(aL||{});nx({menu:"Input/Texture/SampleTexture2D",title:"SampleTexture2D"})(nL=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).data={props:[jI("TextureType",rL.Default,"enum",{enum:rL}),jI("NormalSpace",aL.Tangent,"enum",{enum:aL})],inputs:[qI("Texture",new p,"texture2D","texture2D"),qI("UV",K.ZERO,"vec2","vector")],outputs:[qI("RGBA",Pt.ZERO,"vec4","vector"),qI("R",0,"float","vector"),qI("G",0,"float","vector"),qI("B",0,"float","vector"),qI("A",0,"float","vector")]},e}return Ot(e,t),e.prototype.generateCode=function(){var t,e,i=this.getSlotWithSlotName("Texture"),n=this.getSlotWithSlotName("UV"),o=this.getSlotWithSlotName("RGBA"),r=null==o?void 0:o.varName;null!=i&&i.connectSlot?(e=n.connectSlot?n.slotValue:"v_uv",t="vec4 "+r+" = texture("+(null==i?void 0:i.connectSlot.varName)+", "+e+");\n"):t="vec4 "+r+" = vec4(1.);\n";var a=this.getPropWithName("TextureType"),s=this.getPropWithName("NormalSpace");a.value===rL.Normal&&s.value===aL.Tangent&&(t+=r+".xyz -= vec3(0.5);\n",t+=r+".xyz = \n",t+="  "+r+".x * normalize(worldTangent) +\n",t+="  "+r+".y * normalize(worldBinormal) +\n",t+="  "+r+".z * normalize(worldNormal);\n",this.defines.push("CC_SURFACES_USE_TANGENT_SPACE"));var l=this.getSlotWithSlotName("R");l&&l.connectSlot&&(t+="float "+l.varName+" = "+r+".r;\n");var c=this.getSlotWithSlotName("G");c&&c.connectSlot&&(t+="float "+c.varName+" = "+r+".g;\n");var u=this.getSlotWithSlotName("B");u&&u.connectSlot&&(t+="float "+u.varName+" = "+r+".b;\n");var h=this.getSlotWithSlotName("A");return h&&h.connectSlot&&(t+="float "+h.varName+" = "+r+".a;\n"),t},e}(LR));t._RF.pop(),t._RF.push({},"1e7d5h/dpNKOKPycPdVfiDZ","texture2d-asset",void 0),t._RF.pop(),t._RF.push({},"30feaYkdKtOs5doShMcgDKA","get-local-var",void 0);var sL;nx({menu:"Input/Variable/GetLocalVar",title:"GetLocalVar"})(oL=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).data={props:[jI("Name","local_var","dynamicEnum",{registerEnum:{type:"RegisterLocalVarName",property:"Name"}})],outputs:[qI("Out",Pt.ZERO,"vec4","vector")]},e}return Ot(e,t),e.prototype.generateCode=function(){return this.inputs[0].connectSlot.precisionName+" "+this.name+"= "+this.getInputValue(0)+";"},Nt(e,[{key:"name",get:function(){var t=this.getPropWithName("Name");return t&&t.value},set:function(t){this.getPropWithName("Name").value=t}}]),e}(ux));t._RF.pop(),t._RF.push({},"b61a9DvFcxESK2/fNFtqY0h","register-local-var",void 0);nx({menu:"Input/Variable/RegisterLocalVar",title:"RegisterLocalVar"})(sL=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).isRegisterLocalVar=!0,e.data={props:[jI("Name","local_var","string",{registerEnumType:"RegisterLocalVarName"})],inputs:[qI("In",Pt.ZERO,"vec4","vector")]},e}return Ot(e,t),e.prototype.generateCode=function(){return""},Nt(e,[{key:"name",get:function(){return this.getPropWithName("Name").value},set:function(t){this.getPropWithName("Name").value=t}}]),e}(ux));t._RF.pop(),t._RF.push({},"00450ydLIRBS6bzTCNNRjmm","index",void 0),t._RF.pop(),t._RF.push({},"c03d0yZbI5CPJyIvpnia5dO","shadergraph",void 0),t._RF.pop()}}}));

(function(r) {
  r('virtual:///prerequisite-imports/main', 'chunks:///main.js'); 
})(function(mid, cid) {
    System.register(mid, [cid], function (_export, _context) {
    return {
        setters: [function(_m) {
            var _exportObj = {};

            for (var _key in _m) {
              if (_key !== "default" && _key !== "__esModule") _exportObj[_key] = _m[_key];
            }
      
            _export(_exportObj);
        }],
        execute: function () { }
    };
    });
});