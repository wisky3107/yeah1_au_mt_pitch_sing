System.register("chunks:///main.js",["cc","./rollupPluginModLoBabelHelpers-2a4540ca.js"],(function(){var t,e,i,n,o,r,a,s,l,c,u,h,p,d,f,g,m,v,y,b,_,S,w,T,C,E,A,P,M,I,N,O,L,R,x,F,D,z,k,V,B,H,U,G,W,q,Z,Y,j,K,X,J,Q,$,tt,et,it,nt,ot,rt,at,st,lt,ct,ut,ht,pt,dt,ft,gt,mt,vt,yt,bt,_t,St,wt,Tt,Ct,Et,At,Pt,Mt,It,Nt,Ot,Lt,Rt,xt,Ft,Dt,zt;return{setters:[function(It){t=It.cclegacy,e=It._decorator,i=It.SpriteFrame,n=It.math,o=It.randomRangeInt,r=It.Component,a=It.resources,s=It.Asset,l=It.Prefab,c=It.Node,u=It.assetManager,h=It.SpriteAtlas,p=It.Texture2D,d=It.ImageAsset,f=It.Sprite,g=It.Vec3,m=It.v3,v=It.tween,y=It.Label,b=It.UIOpacity,_=It.easing,S=It.sys,w=It.native,T=It.log,C=It.error,E=It.instantiate,A=It.find,P=It.isValid,M=It.director,I=It.game,N=It.AudioSource,O=It.AudioClip,L=It.Enum,R=It.KeyCode,x=It.Button,F=It.EventHandler,D=It.input,z=It.Input,k=It.Toggle,V=It.NodeEventType,B=It.UITransform,H=It.rect,U=It.CCBoolean,G=It.CCInteger,W=It.v2,q=It.screen,Z=It.Widget,Y=It.view,j=It.Slider,K=It.Vec2,X=It.Color,J=It.EventTouch,Q=It.macro,$=It.Layout,tt=It.Size,et=It.NodePool,it=It.Animation,nt=It.AnimationClip,ot=It.Game,rt=It.CCFloat,at=It.Tween,st=It.TextAsset,lt=It.SkeletalAnimation,ct=It.ParticleSystem2D,ut=It.ProgressBar,ht=It.MeshRenderer,pt=It.ScrollView,dt=It.animation,ft=It.ParticleSystem,gt=It.random,mt=It.randomRange,vt=It.SkinnedMeshRenderer,yt=It.EventTarget,bt=It.JsonAsset,_t=It.Camera,St=It.Quat,wt=It.PhysicsSystem,Tt=It.ToggleContainer,Ct=It.EditBox,Et=It.ValueType,At=It.TextureCube,Pt=It.Vec4,Mt=It.Material},function(t){It=t._,Nt=t.a,Ot=t.b,Lt=t.c,Rt=t.d,xt=t.e,Ft=t.f,Dt=t.g,zt=t.h}],execute:function(){var kt,Vt;t._RF.push({},"a3605ZRcydAsqLfvt2I7n/+","CSVLoader",void 0),t._RF.pop(),t._RF.push({},"f3654C79/FGx7RDXCjGKZLE","ClientEvent",void 0);var Bt,Ht=e.ccclass,Ut=(e.property,Ht("clientEvent")(((Vt=function(){function t(){}return t.on=function(e,i,n){var o={handler:i,target:n},r=t._handlers[e];r||(r=[],t._handlers[e]=r);for(var a=0;a<r.length;a++)if(!r[a])return r[a]=o,a;return r.push(o),r.length},t.off=function(e,i,n){var o=t._handlers[e];if(o)for(var r=0;r<o.length;r++){var a=o[r];if(a.handler===i&&(!n||n===a.target)){o.splice(r,1);break}}},t.dispatchEvent=function(e){for(var i=arguments.length,n=new Array(i>1?i-1:0),o=1;o<i;o++)n[o-1]=arguments[o];var r,a=t._handlers[e],s=[];for(r=1;r<arguments.length;r++)s.push(arguments[r]);if(a)for(r=0;r<a.length;r++){var l=a[r];l.handler&&l.handler.apply(l.target,s)}},t}())._handlers={},kt=Vt))||kt);t._RF.pop(),t._RF.push({},"bebeaAU60hJjpSfuLpkpTPQ","ComponentPool",void 0);var Gt,Wt,qt,Zt,Yt,jt,Kt,Xt,Jt,Qt,$t,te,ee=e.ccclass,ie=(e.property,ee("ComponentPool")(Bt=function(){function t(t,e){this.pool=void 0,this.factory=void 0,this.parentNode=void 0,this.pool=[],this.factory=t,this.parentNode=e}var e=t.prototype;return e.init=function(t){for(var e=0;e<t;e++){var i=this.factory();i.node.parent=this.parentNode,this.put(i)}},e.get=function(){if(this.pool.length>0){var t=this.pool.pop();return t.node.active=!0,t}var e=this.factory();return e.node.parent=this.parentNode,e},e.put=function(t){t.node.active=!1,t.node.parent=this.parentNode,this.pool.push(t)},e.putAll=function(t){var e=this;t.forEach((function(t){return e.put(t)}))},e.clear=function(){this.pool.forEach((function(t){t.node.destroy()})),this.pool=[]},t}())||Bt);t._RF.pop(),t._RF.push({},"449f63urB5BrqfvzhGei/dM","ImageLoader",void 0);var ne,oe,re,ae,se,le,ce,ue=e.ccclass,he=e.property,pe=(Gt=ue("ImageLoader"),Wt=he([i]),qt=he([i]),Zt=he(i),Yt=he(i),Gt(((te=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,Ot(e,"preloadSpriteFrames",Xt,Lt(e)),Ot(e,"avatarSpriteframe",Jt,Lt(e)),Ot(e,"sfDiamonds",Qt,Lt(e)),Ot(e,"sfCoins",$t,Lt(e)),e.spriteFrameMap=new Map,e}Nt(e,t);var i=e.prototype;return i.onLoad=function(){e.instance=this,this.initSpriteFrames()},i.initSpriteFrames=function(){var t=this;this.preloadSpriteFrames.forEach((function(e){t.spriteFrameMap.set(e.name,e)}))},i.getSpriteFrame=function(t){return this.spriteFrameMap.has(t)?this.spriteFrameMap.get(t):(console.error("Unknown sprite"+t),null)},i.getAvatar=function(t){var e=(Number(t)%1e3).toString(),i=function(t){try{var i;return parseInt(null!=(i=e[e.length-t])?i:"0")}catch(t){return 0}};try{var o=i(1),r=i(2),a=n.clamp(o+r,0,this.avatarSpriteframe.length-1);return this.avatarSpriteframe[a]}catch(t){return null}},i.getRandomCapyImage=function(){return this.avatarSpriteframe[o(0,this.avatarSpriteframe.length)]},e}(r)).instance=null,Xt=It((Kt=te).prototype,"preloadSpriteFrames",[Wt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Jt=It(Kt.prototype,"avatarSpriteframe",[qt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Qt=It(Kt.prototype,"sfDiamonds",[Zt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),$t=It(Kt.prototype,"sfCoins",[Yt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),jt=Kt))||jt);function de(t,e){return void 0===e&&(e=1),new Promise((function(i,n){a.load(t,(function(t,o){if(t)return console.error("Error loading asset:",t),void n(t);if(!(o instanceof s)){var r=new Error("Invalid asset type loaded");return console.error(r.message,o),void n(r)}var a=o.nativeUrl,l=new XMLHttpRequest;l.open("GET",a,!0),l.responseType="arraybuffer",l.onload=function(){if(200===l.status){var t=l.response,o=new Uint8Array(t);try{var r=new Midi(o.buffer);console.log("MIDI file loaded successfully:",r),e>=0&&r.tracks&&r.tracks.length>e?i(r.tracks[e]):i(r)}catch(t){console.error("Error parsing MIDI data:",t),n(t)}}else{var a=new Error("Error loading binary data: "+l.statusText);console.error(a.message),n(a)}},l.onerror=function(t){n(new Error("Network error during MIDI file loading"))},l.send()}))}))}function fe(t,e){return void 0===e&&(e=1),new Promise((function(i,n){var o=new XMLHttpRequest;o.open("GET",t,!0),o.responseType="arraybuffer",o.onload=function(){if(200===o.status){var t=o.response,r=new Uint8Array(t);try{if("undefined"!=typeof window&&window.Midi){var a=new window.Midi(r.buffer);console.log("MIDI file loaded successfully:",a);var s=a.tracks&&a.tracks.length>e?a.tracks[e]:null;i(s||a)}else n(new Error("Midi parser not available"))}catch(t){console.error("Error parsing MIDI data:",t),n(t)}}else n(new Error("Error loading binary data: "+o.statusText))},o.onerror=function(){n(new Error("Network error during MIDI file loading"))},o.send()}))}t._RF.pop(),t._RF.push({},"1b61cY0MSxGRrqa3QwVp8IO","MidiReader",void 0),t._RF.pop(),t._RF.push({},"6de52PO/FFI4qh57HrWi8RF","ObjectPoolData",void 0);var ge=e.ccclass,me=e.property;ne=ge("ObjectPoolData"),oe=me(l),re=me(c),ne((le=It((se=function(){Ot(this,"prefab",le,this),Ot(this,"container",ce,this)}).prototype,"prefab",[oe],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ce=It(se.prototype,"container",[re],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ae=se));t._RF.pop(),t._RF.push({},"5f860beWrBGtbckv8i95YZU","Constants",void 0);var ve={EVENT_NAME:{GAME_INITED:"GAME_INITED_DONE",USERDATA_UPDATED:"USERDATA_UPDATED",USERCOIN_UPDATED:"USERCOIN_UPDATED"},RESOURCE_PATH:{GAME_MAIN_PATH:"prefab/Game"},SOUND_FILES:{SFX_PATH:"sounds/sfx/"},CAMERA_CONFIG:{MIN_SIZE:200},CAMERA_ZOOM_THRESHOLD:500,AUTO_TIME:3,STORAGE_KEY:{BGM_VOLUME:"BGM_VOLUME",SFX_VOLUME:"SFX_VOLUME",USER_MODIFIER:"USER_MODIFIER"},EFFECT:{MOVING_UI_OBJECT:"moving",UI_COINS:"coins",UI_TURNS:"turns",LEVLEUP_SMALL:"levelup_small",LEVLEUP_BIG:"levelup_big",CONFETTI:"confetti",TEXT:"text"},GAME:{PHYSIC_GRAVITY:18},VIEW:{TOPHUB:"ViewTopHub"}},ye={API:"",LOG:!0};t._RF.pop(),t._RF.push({},"ad288/O58VDkJlgQZZZjRwu","assetRemoteUtil",void 0);var be,_e=function(){function t(){}return t.loadBundle=function(t,e){u.loadBundle(t,null,(function(t,i){if(t)return console.error(t),void e(t,null);e(null,i)}))},t.loadAltas=function(t,e,i){this.loadBundle(t,(function(t,n){t?null==i||i(t,null):n.load(e,h,(function(t,e){if(t)return console.error(t),void(null==i||i(t,null));null==i||i(null,e)}))}))},t.loadRemoteImage=function(){var t=Rt(xt().mark((function t(e){var n,o,r,a,s,l;return xt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,e="https://cors-anywhere.herokuapp.com/"+e,t.next=4,fetch(e);case 4:if((n=t.sent).ok){t.next=7;break}throw new Error("HTTP error! Status: "+n.status);case 7:return t.next=9,n.blob();case 9:return o=t.sent,(r=new Image).crossOrigin="Anonymous",a=new Promise((function(t,e){r.onload=function(){return t(r)},r.onerror=function(){return e(new Error("Failed to load image element"))}})),r.src=URL.createObjectURL(o),t.next=16,a;case 16:return(s=new p).image=new d(r),(l=new i).texture=s,t.abrupt("return",l);case 23:throw t.prev=23,t.t0=t.catch(0),new Error("Failed to load remote image: "+t.t0.message);case 26:case"end":return t.stop()}}),t,null,[[0,23]])})));return function(e){return t.apply(this,arguments)}}(),t.fetchImage=function(){var t=Rt(xt().mark((function t(e){var i,n,o;return xt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e){t.next=2;break}throw new Error("Failed to fetch image: URL is null or empty.");case 2:return t.prev=2,t.next=5,fetch(e);case 5:return i=t.sent,t.t0=Uint8Array,t.next=9,i.arrayBuffer();case 9:return t.t1=t.sent,n=new t.t0(t.t1),o=this.bufferToBase64(n),t.abrupt("return",this.convertBase64ToSpriteFrame(o));case 15:throw t.prev=15,t.t2=t.catch(2),new Error("Failed to get SpriteFrame: "+t.t2.message);case 18:case"end":return t.stop()}}),t,this,[[2,15]])})));return function(e){return t.apply(this,arguments)}}(),t.bufferToBase64=function(t){var e=Array.from(t).map((function(t){return String.fromCharCode(t)})).join("");return btoa(e)},t.convertBase64ToSpriteFrame=function(){var t=Rt(xt().mark((function t(e){return xt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t,n){var o=new Image;o.onload=function(){var e=new p;e.image=new d(o);var n=new i;n.texture=e,t(n),URL.revokeObjectURL(o.src)},o.onerror=function(){n(new Error("Failed to load base64 image")),URL.revokeObjectURL(o.src)},o.src="data:image/png;base64,"+e})));case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),t.loadAndListenAvatar=function(t,e){var i=this;if(this.spriteFrameMap.has(t))null==e||e(this.spriteFrameMap.get(t));else if(this.spriteCallbacks.has(t)||this.spriteCallbacks.set(t,[]),this.spriteCallbacks.get(t).push(e),!(this.loadingSprites.indexOf(t)>=0)){this.loadingSprites.push(t);var n=function(e){i.spriteFrameMap.set(t,e),i.spriteCallbacks.get(t).forEach((function(t){return t(e)})),i.spriteCallbacks.set(t,[]),i.loadingSprites=i.loadingSprites.filter((function(e){return e!==t})),i.spriteFrameMap.size>100&&(i.spriteFrameMap.clear(),ye.LOG&&console.log("SpriteFrameMap cache cleared due to exceeding 100 records.")),ye.LOG&&console.log("Total loaded avatar: ",i.spriteFrameMap.size)};this.fetchImage(t).then((function(t){n(t)})).catch((function(t){n(null)}))}},t.removeListenAvatar=function(t,e){0!=this.spriteCallbacks.has(t)&&this.spriteCallbacks.set(t,this.spriteCallbacks.get(t).filter((function(t){return t!=e})))},t}();_e.spriteFrameMap=new Map,_e.loadingSprites=[],_e.spriteCallbacks=new Map,_e.loadedImages=[],_e.loadedTextures=[],t._RF.pop(),t._RF.push({},"03f5c6o2sJBCL/VJkJmJTZA","UIAvatar",void 0);var Se,we=e.ccclass,Te=(e.property,e.requireComponent),Ce=we("UIAvatar")(be=Te(f)(be=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).sprite=null,e.data=null,e.url=null,e.id=null,e.loadAvatarFunction=null,e}Nt(e,t);var i=e.prototype;return i.onLoad=function(){this.sprite=this.getComponent(f)},i.onDisable=function(){this.loadAvatarFunction&&_e.removeListenAvatar(this.url,this.loadAvatarFunction)},i.setData=function(t,e){this.sprite&&(this.sprite.spriteFrame=pe.instance.getAvatar(this.id),this.id=e,this.url=t,this.loadAvatarFunction=this.onLoadedAvatar.bind(this),_e.loadAndListenAvatar(t,this.loadAvatarFunction))},i.onLoadedAvatar=function(t){this.sprite.spriteFrame=null!=t?t:pe.instance.getAvatar(this.id),this.loadAvatarFunction=null},i.clear=function(){this.sprite.spriteFrame=null},e}(r))||be)||be;t._RF.pop(),t._RF.push({},"60a69bp1SlI3LOxXGNq+M1o","UICashAnimation",void 0);var Ee,Ae,Pe=e.ccclass;e.property,Pe("UICashAnimation")(Se=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).posY=[],e.sprites=[],e.tweens=[],e}Nt(e,t);var i=e.prototype;return i.init=function(){var t=this;this.sprites=this.getComponentsInChildren(f),this.sprites.forEach((function(e){t.posY.push(e.node.position.y),t.tweens.push(null)}))},i.setVisible=function(t,e,i,n){var o=this;if(void 0===n&&(n=-1),this.sprites.length<=0&&this.init(),n=n<0?this.sprites.length:Math.min(this.sprites.length,n),t){this.sprites.forEach((function(t){return t.node.position=g.ZERO}));for(var r=e/n,a=function(){var t,a=s*r,l=s;if(o.sprites[l].node.active=!0,e<=0)return o.sprites[l].node.position=m(0,o.posY[l]),1;null==(t=o.tweens[l])||t.stop(),o.tweens[l]=v(o.sprites[l].node).to(a,{position:m(0,o.posY[l])}).call((function(){l==n-1&&(null==i||i())})).start()},s=0;s<n;s++)a()}else for(var l=function(){var t,n=c;if(e<=0)return o.sprites[n].node.active=!1,1;null==(t=o.tweens[n])||t.stop(),o.tweens[n]=v(o.sprites[n].node).to(e,{position:g.ZERO}).call((function(){o.sprites[n].node.active=!1,n==o.sprites.length-1&&(null==i||i())})).start()},c=0;c<this.sprites.length;c++)l()},e}(r));t._RF.pop(),t._RF.push({},"f17deAL74VOroYmPuGafWvU","Utils",void 0),Number.prototype.clamp=function(t,e){return Math.min(Math.max(this.valueOf(),t),e)},Number.prototype.pingPong=function(t,e){var i=e-t,n=(this.valueOf()-t)/i,o=Math.floor(n),r=n-o;return o%2==0?t+i*r:e-i*r},Number.prototype.randomInt=function(t,e){return Math.floor(Math.random()*(e-t)+t)},Array.prototype.shuffle=function(){for(var t=this.length-1;t>0;t--){var e=Math.floor(Math.random()*(t+1)),i=[this[e],this[t]];this[t]=i[0],this[e]=i[1]}return this},Array.prototype.distinct=function(){return this.filter((function(t,e,i){return i.findIndex((function(e){return e.id===t.id}))===e}))},Array.prototype.randomElement=function(){return this.length<=0?null:this[Math.floor(Math.random()*this.length)]};var Me,Ie=e.ccclass,Ne=(e.property,Ie("util")(((Ae=function(){function t(){}return t.formatNumber=function(t,e,i){if(void 0===e&&(e=0),void 0===i&&(i=2),!t)return"0";for(var n=["","K","M","B","T","Qa","Qi","Sx","Sp","Oc","No","Dc","Ud","Dd","Td","Qua","Qui","Sx","Sp","Oc","No","Vi","Dv","Tv","Qaa","Qaq","Qap","Qaop","Qit"],o=0;t>=1e3&&(t/=1e3,!(++o>=n.length-1)););return 0==o?this.toFixed(t,e):""+this.toFixed(t,i).replace(".",",")+n[o]},t.toFixed=function(t,e){return t.toFixed(e).replace(/(\.\d*?[1-9])0+$|\.0*$/,"$1")},t.commaNumber=function(t){return t?t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","):"0"},t.mapAbbreviationToWord=function(t){return{"":" ",K:"Thousand",M:"Million",B:"Billion",T:"Trillion",Qa:"Quadrillion",Qi:"Quintillion",Sx:"Sextillion",Sp:"Septillion",Oc:"Octillion",No:"Nonillion",Dc:"Decillion",Ud:"Undecillion",Dd:"Duodecillion",Td:"Tredecillion",Qua:"Quattuordecillion",Qui:"Quindecillion",Vi:"Sexdecillion",Dv:"Septendecillion",Tv:"Octodecillion",Qaa:"Novemdecillion",Qaq:"Vigintillion",Qap:"Unvigintillion",Qaop:"Duovigintillion",Qit:"Tresvigintillion"}[t]||""},t.getTokenParam=function(){return this.getUrlkeyValue("tk")},t.getRefreshTokenParam=function(){return this.getUrlkeyValue("rtk")},t.getDeviceKeyParam=function(){return this.getUrlkeyValue("dk")},t.getIdPasswordUrl=function(){return{username:this.getUrlkeyValue("username"),password:this.getUrlkeyValue("password")}},t.WaitFor=function(t,e){t()?e():setTimeout(this.WaitFor.bind(null,t,e),100)},t.loadScript=function(t,e){var i=document.createElement("script");i.type="text/javascript",i.src=t,e&&(i.onload=e),document.head.appendChild(i)},t.clone=function(t){if(null===t||"object"!=typeof t)return t;var e={};for(var i in t.constructor===Array&&(e=[]),t)t.hasOwnProperty(i)&&(e[i]=this.clone(t[i]));return e},t.objectToArray=function(t){var e=[];for(var i in t)t.hasOwnProperty(i)&&e.push(t[i]);return e},t.arrayToObject=function(t,e){var i={};for(var n in t)t.hasOwnProperty(n)&&t[n][e]&&(i[t[n][e]]=t[n]);return i},t.getWeightRandIndex=function(t,e){for(var i=Math.floor(Math.random()*e),n=0,o=0;o<t.length&&!(i<(n+=t[o]));o++);return o},t.getRandomNFromM=function(t,e){for(var i=[],n=0,o=0;o<e&&!(o>=t+1);){n=this.getRandomInt(0,t);for(var r=0,a=0;a<o;a++)if(i[a]===n){r=1;break}0===r&&(i[o]=n,o++)}return i},t.getRandomInt=function(t,e){var i=Math.random()*(e-t+1)+t;return Math.floor(i)},t.getStringLength=function(t){for(var e=t,i=0,n=0,o=e.length;n<o;n++){i+=e.charCodeAt(n)<=255?1:2}return Math.ceil(i/2)},t.isEmptyObject=function(t){var e=!0;if(t&&t.constructor===Object){for(var i in t)if(t.hasOwnProperty(i)){e=!1;break}}else e=!1;return e},t.isNewDay=function(t){var e=new Date(t),i=new Date,n=e.getYear(),o=e.getMonth(),r=e.getDate(),a=i.getYear(),s=i.getMonth(),l=i.getDate();return a>n||(s>o||l>r)},t.getPropertyCount=function(t){var e,i=0;for(e in t)t.hasOwnProperty(e)&&i++;return i},t.difference=function(t,e){var i=[];if(t.constructor!==Array||e.constructor!==Array)return i;for(var n=t.length,o=0;o<n;o++)-1===e.indexOf(t[o])&&i.push(t[o]);return i},t._stringToArray=function(t){var e,i="\\ufe0e\\ufe0f",n="\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff",o=RegExp("[\\u200d\\ud800-\\udfff"+n+i+"]"),r="\\ud83c[\\udffb-\\udfff]",a="[\\ufe0e\\ufe0f]?",s="["+n+"]",l="(?:"+s+"|"+r+")"+"?",c="[\\ud800-\\udfff]",u="[^\\ud800-\\udfff]",h="(?:\\ud83c[\\udde6-\\uddff]){2}",p="[\\ud800-\\udbff][\\udc00-\\udfff]",d=a+l+("(?:\\u200d(?:"+[u,h,p].join("|")+")"+a+l+")*"),f="(?:"+[u+s+"?",s,h,p,c].join("|")+")",g=RegExp(r+"(?="+r+")|"+f+d,"g");return e=t,o.test(e)?function(t){return t.match(g)||[]}(t):function(t){return t.split("")}(t)},t.simulationUUID=function(){function t(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return t()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t()},t.trim=function(t){return t.replace(/(^\s*)|(\s*$)/g,"")},t.isNowValid=function(t,e){var i=new Date(t),n=new Date(e),o=!1;if(i.getDate()+""!="NaN"&&n.getDate()+""!="NaN"){var r=new Date;o=r<n&&r>i}return o},t.getDeltaDays=function(t,e){t=new Date(t),e=new Date(e);var i=t.getFullYear(),n=t.getMonth()+1,o=t.getDate(),r=e.getFullYear(),a=e.getMonth()+1,s=e.getDate();t=new Date(i+"/"+n+"/"+o+" GMT+0800").getTime();var l=(e=new Date(r+"/"+a+"/"+s+" GMT+0800").getTime())-t;return Math.floor(l/864e5)},t.getUserTimezone=function(){var t=(new Date).getTimezoneOffset(),e=Math.abs(t/60),i=Math.abs(t%60);return"GMT"+(t>0?"-":"+")+String(e)+String(i)},t.getMin=function(t){var e=null;if(t.constructor===Array)for(var i=t.length,n=0;n<i;n++)e=0===n?Number(t[0]):e>Number(t[n])?Number(t[n]):e;return e},t.formatTwoDigits=function(t){return(Array(2).join(0)+t).slice(-2)},t.getRemainingTime=function(t,e){if(!e)return{string:"",isZero:!0,remainSeconds:0};var i=1e3,n=6e4,o=36e5,r=864e5,a=e.getTime()-t.getTime(),s=Math.floor(a/r),l=Math.floor(a%r/o),c=Math.floor(a%o/n),u=Math.floor(a%n/i),h=a<=0,p=function(t){return t<10?"0"+t:t+""},d=(s>0?p(s)+":":"")+p(l)+":"+p(c)+":"+p(u);return s<=0&&l<=0&&c<=0&&u<=10&&(d=p(u)),{string:d,isZero:h,remainSeconds:a/i}},t.formatDate=function(t,e){e.includes("MMMM")?e=e.replace("MMMM",["January","February","March","April","May","June","July","August","September","October","November","December"][t.getMonth()]):e.includes("MMM")&&(e=e.replace("MMM",["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][t.getMonth()]));var i={"Y+":t.getFullYear(),"M+":t.getMonth()+1,"d+":t.getDate(),"h+":t.getHours(),"m+":t.getMinutes(),"s+":t.getSeconds(),"q+":Math.floor((t.getMonth()+3)/3),S:t.getMilliseconds()};for(var n in/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(t.getFullYear()+"").substr(4-RegExp.$1.length))),i)new RegExp("("+n+")").test(e)&&(e=e.replace(RegExp.$1,1===RegExp.$1.length?i[n].toString():("00"+i[n]).substr((""+i[n]).length)));return e},t.getDay=function(){var t=new Date;return t.getFullYear()+"-"+(t.getMonth()+1)+"-"+t.getDate()},t.formatName=function(t,e){e=e||6;var i=this._stringToArray(t),n="";if(i.length>e){for(var o=0;o<e;o++)n+=i[o];n+="..."}else n=t;return n},t.formatMoney=function(t){for(var e=["","K","M","G","T","P","E","Z","Y","B","N","D"],i="",n=0;n<e.length;n++){if(!(t>=1e4)){i=Math.floor(t).toLocaleString()+e[n];break}t/=1e3}return""===i&&(i=Math.floor(t)+"U"),i.replace(/\B(?=(\d{3})+(?!\d))/g,",")},t.formatValue=function(t){for(var e=[],i="",n=0;n<26;n++)e.push(String.fromCharCode(97+n));for(var o=0;o<e.length;o++){if(!(t>=1e4)){i=Math.floor(t)+e[o];break}t/=1e3}return i},t.formatTimeForSecond=function(t,e){void 0===e&&(e=!1);var i="",n=t%60,o=Math.floor(t/60);o=o<0?0:o;var r=Math.floor(o/60),a=o%60;return r>0?(i+=r>9?r.toString():"0"+r,i+=":"):i+="00:",i+=a>9?a.toString():"0"+a,e||(i+=":",i+=n>9?n.toString():"0"+n),i},t.formatTimeForMillisecond=function(t){var e=Math.floor(t/1e3%60),i=Math.floor(t/1e3/60%60);return{hour:Math.floor(t/1e3/60/60),minute:i,second:e}},t.rand=function(t){for(var e=this.clone(t),i=e.length-1;i>=0;i--){var n=Math.floor(Math.random()*(i+1)),o=e[n];e[n]=e[i],e[i]=o}return e},t.getOffsetMimutes=function(t,e){var i=e-t;return Math.floor(i%36e5/6e4)},t.formatNumToFixed=function(t,e){return void 0===e&&(e=0),Number(t.toFixed(e))},t.lerp=function(t,e,i){void 0===i&&(i=.25);var n=e;return t>e?n=e+(t-e)*i:t<e&&(n=e-(e-t)*i),n},t.decrypt=function(t){var e=6;t.length%2==0&&(e=7);for(var i="",n=0;n<t.length-e;n+=2)i+=t[n+1],i+=t[n];return i+=t.slice(t.length-e+1),i=this._base64Decode(i)},t.encrypt=function(t){var e=this._base64encode(t),i=6;e.length%2==0&&(i=7);for(var n="",o=0;o<(e.length-i+1)/2;o++)n+=e[2*o+1],n+=e[2*o];return n+=e.slice(e.length-i+1)},t._base64encode=function(t){var e,i,n,o,r,a,s,l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",c="",u=0;for(t=this._utf8Encode(t);u<t.length;)o=(e=t.charCodeAt(u++))>>2,r=(3&e)<<4|(i=t.charCodeAt(u++))>>4,a=(15&i)<<2|(n=t.charCodeAt(u++))>>6,s=63&n,isNaN(i)?a=s=64:isNaN(n)&&(s=64),c=c+l.charAt(o)+l.charAt(r)+l.charAt(a)+l.charAt(s);return c},t._utf8Encode=function(t){t=t.replace(/\r\n/g,"\n");for(var e="",i=0;i<t.length;i++){var n=t.charCodeAt(i);n<128?e+=String.fromCharCode(n):n>127&&n<2048?(e+=String.fromCharCode(n>>6|192),e+=String.fromCharCode(63&n|128)):(e+=String.fromCharCode(n>>12|224),e+=String.fromCharCode(n>>6&63|128),e+=String.fromCharCode(63&n|128))}return e},t._utf8Decode=function(t){for(var e="",i=0,n=0,o=0,r=0;i<t.length;)(n=t.charCodeAt(i))<128?(e+=String.fromCharCode(n),i++):n>191&&n<224?(o=t.charCodeAt(i+1),e+=String.fromCharCode((31&n)<<6|63&o),i+=2):(o=t.charCodeAt(i+1),r=t.charCodeAt(i+2),e+=String.fromCharCode((15&n)<<12|(63&o)<<6|63&r),i+=3);return e},t._base64Decode=function(t){var e,i,n,o,r,a,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",l="",c=0;for(t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");c<t.length;)e=s.indexOf(t.charAt(c++))<<2|(o=s.indexOf(t.charAt(c++)))>>4,i=(15&o)<<4|(r=s.indexOf(t.charAt(c++)))>>2,n=(3&r)<<6|(a=s.indexOf(t.charAt(c++))),l+=String.fromCharCode(e),64!=r&&(l+=String.fromCharCode(i)),64!=a&&(l+=String.fromCharCode(n));return l=this._utf8Decode(l)},t.checkIsLowPhone=function(){if(window.wx){var t=-1,e=window.wx.getSystemInfoSync();if(e.system.indexOf("iOS")>=0){for(var i=e.model,n=["iPhone1,1","iPhone1,2","iPhone2,1","iPhone3,1","iPhone3,3","iPhone4,1","iPhone5,1","iPhone5,2","iPhone5,3","iPhone5,4","iPhone6,1","iPhone6,2"],o=["iPhone6,2","iPhone7,1","iPhone7,2","iPhone8,1","iPhone8,2","iPhone8,4"],r=["iPhone9,1","iPhone9,2","iPhone9,3","iPhone9,4","iPhone10,1","iPhone10,2","iPhone10,3","iPhone10,4","iPhone10,5","iPhone10,6"],a=["iPhone11,2","iPhone11,4","iPhone11,6","iPhone11,8","iPhone12,1","iPhone12,3","iPhone12,5","iPhone12,8"],s=0;s<n.length;s++)i.indexOf(n[s])>=0&&(t=5);for(var l=0;l<o.length;l++)i.indexOf(o[l])>=0&&(t=10);for(var c=0;c<r.length;c++)i.indexOf(r[c])>=0&&(t=20);for(var u=0;u<a.length;u++)i.indexOf(a[u])>=0&&(t=30)}else t=e.benchmarkLevel;return t<22}return!1},t.truncateString=function(t,e,i,n){return void 0===e&&(e=15),void 0===i&&(i=5),void 0===n&&(n=5),t.length<=e?t:t.slice(0,i)+"..."+t.slice(-n)},t.getVectorString=function(t){return t.x.toFixed(2)+"-"+t.y.toFixed(2)},t.getCoorKey=function(t,e){return t+"_"+e},t}()).getUrlkeyValue=function(t){var e=window.location.href,i=new URL(e);return i.searchParams.has(t)?i.searchParams.get(t):""},Ae.getAngle=function(t){return t<0?360+t%360:t>360?t%360:t},Ae.getPointText=function(t,e){return e<=0?t+"":t+"(<color=green>"+e+"</color>)"},Ae.getGuildShortName=function(t){var e=t.split(" "),i="";return e.forEach((function(t){return i+=t[0]})),i.toUpperCase()},Ae.capitalizeWords=function(t){return t.toLowerCase().replace(/\b\w/g,(function(t){return t.toUpperCase()}))},Ee=Ae))||Ee);t._RF.pop(),t._RF.push({},"d3e939wqpFGLblmd/OMduC5","UITimer",void 0);var Oe,Le,Re,xe,Fe,De=e.ccclass,ze=(e.property,e.requireComponent);De("UITimer")(Me=ze(y)(Me=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).label=null,e.endTime=0,e.callback=null,e.scheduleCountingDown=-1,e}Nt(e,t);var i=e.prototype;return i.onLoad=function(){this.label=this.getComponent(y)},i.onEnable=function(){this.endTime>0&&this.startCountingDown(this.endTime,this.callback)},i.onDisable=function(){this.stopCountingEventDown()},i.startCountingDown=function(t,e){var i=this;this.endTime=t,this.callback=e;var n=t-Date.now();if(n<=0)null==e||e();else{var o=Math.round(n/1e3)+1;this.stopCountingEventDown(),function t(){if(--o<0)null==e||e();else{var n=Ne.formatTimeForSecond(o);i.label&&(i.label.string=n),i.scheduleCountingDown=setTimeout((function(){t()}),1e3)}}()}},i.stopCountingEventDown=function(){clearTimeout(this.scheduleCountingDown)},e}(r))||Me);t._RF.pop(),t._RF.push({},"c5c0fR4sOtBf6AVBLMy1WNE","VisiblePanel",void 0);var ke=e.ccclass,Ve=e.property,Be=(Oe=ke("VisiblePanel"),Le=Ve({type:c,group:"VisiblePanel"}),Oe((Fe=It((xe=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,Ot(e,"indicator",Fe,Lt(e)),e.opMain=null,e.onVisibleChanged=void 0,e.tweenOpacity=null,e}Nt(e,t);var i=e.prototype;return i.setPanelVisible=function(t,e,i){var n,o=this;void 0===e&&(e=.35),void 0===i&&(i=!0),this.opMain||(this.opMain=this.getComponent(b),null==this.opMain&&(this.opMain=this.addComponent(b))),e<=0&&(this.opMain.opacity=t?255:0),t&&i&&(this.node.active=!0,this.indicator&&(this.indicator.active=!0)),this.opMain.opacity=t?0:255,null==(n=this.tweenOpacity)||n.stop(),this.tweenOpacity=v(this.opMain).to(e,{opacity:t?255:0}).call((function(){!t&&i&&(o.node.active=!1,o.indicator&&(o.indicator.active=!1)),o.visibleChanged(t)})).start()},i.visibleChanged=function(t){var e;null==(e=this.onVisibleChanged)||e.call(this,t)},e}(r)).prototype,"indicator",[Le],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Re=xe))||Re);t._RF.pop(),t._RF.push({},"6cbe82sbBRJZ5dw448hn0pZ","Defines",void 0);var He=function(t){return t[t.NONE=0]="NONE",t[t.TOUCH=1]="TOUCH",t[t.DRAG=2]="DRAG",t[t.ZOOM=3]="ZOOM",t[t.SWIPE=4]="SWIPE",t[t.HOVER=5]="HOVER",t[t.DOUBLE_TOUCH=6]="DOUBLE_TOUCH",t[t.END_INTERACTED=7]="END_INTERACTED",t}({}),Ue=function(t){return t[t.NONE=0]="NONE",t[t.HIDE=1]="HIDE",t[t.SHOW=2]="SHOW",t}({});t._RF.pop(),t._RF.push({},"996b7qdfwFAPbtK5uluV2M2","easing",void 0);var Ge,We,qe=function(t){return t[t.Linear=0]="Linear",t[t.SineIn=1]="SineIn",t[t.SineOut=2]="SineOut",t[t.SineInOut=3]="SineInOut",t[t.QuadIn=4]="QuadIn",t[t.QuadOut=5]="QuadOut",t[t.QuadInOut=6]="QuadInOut",t[t.CubicIn=7]="CubicIn",t[t.CubicOut=8]="CubicOut",t[t.CubicInOut=9]="CubicInOut",t[t.QuartIn=10]="QuartIn",t[t.QuartOut=11]="QuartOut",t[t.QuartInOut=12]="QuartInOut",t[t.QuintIn=13]="QuintIn",t[t.QuintOut=14]="QuintOut",t[t.QuintInOut=15]="QuintInOut",t[t.ExpoIn=16]="ExpoIn",t[t.ExpoOut=17]="ExpoOut",t[t.ExpoInOut=18]="ExpoInOut",t[t.CircIn=19]="CircIn",t[t.CircOut=20]="CircOut",t[t.CircInOut=21]="CircInOut",t[t.ElasticIn=22]="ElasticIn",t[t.ElasticOut=23]="ElasticOut",t[t.ElasticInOut=24]="ElasticInOut",t[t.BackIn=25]="BackIn",t[t.BackOut=26]="BackOut",t[t.BackInOut=27]="BackInOut",t[t.BounceIn=28]="BounceIn",t[t.BounceOut=29]="BounceOut",t[t.BounceInOut=30]="BounceInOut",t}({});function Ze(t){var e;return((e={})[qe.Linear]=_.linear,e[qe.SineIn]=_.sineIn,e[qe.SineOut]=_.sineOut,e[qe.SineInOut]=_.sineInOut,e[qe.QuadIn]=_.quadIn,e[qe.QuadOut]=_.quadOut,e[qe.QuadInOut]=_.quadInOut,e[qe.CubicIn]=_.cubicIn,e[qe.CubicOut]=_.cubicOut,e[qe.CubicInOut]=_.cubicInOut,e[qe.QuartIn]=_.quartIn,e[qe.QuartOut]=_.quartOut,e[qe.QuartInOut]=_.quartInOut,e[qe.QuintIn]=_.quintIn,e[qe.QuintOut]=_.quintOut,e[qe.QuintInOut]=_.quintInOut,e[qe.ExpoIn]=_.expoIn,e[qe.ExpoOut]=_.expoOut,e[qe.ExpoInOut]=_.expoInOut,e[qe.CircIn]=_.circIn,e[qe.CircOut]=_.circOut,e[qe.CircInOut]=_.circInOut,e[qe.ElasticIn]=_.elasticIn,e[qe.ElasticOut]=_.elasticOut,e[qe.ElasticInOut]=_.elasticInOut,e[qe.BackIn]=_.backIn,e[qe.BackOut]=_.backOut,e[qe.BackInOut]=_.backInOut,e[qe.BounceIn]=_.bounceIn,e[qe.BounceOut]=_.bounceOut,e[qe.BounceInOut]=_.bounceInOut,e)[t]}t._RF.pop(),t._RF.push({},"5e557ZxbcNFsbXuz8xq4hnD","storageManager",void 0);var Ye,je,Ke=e.ccclass,Xe=(e.property,Ke("StorageManager")(((We=function(){function t(){this._jsonData={},this._path=null,this.KEY_CONFIG="coindfo",this._markSave=!1,this._saveTimer=-1}var e=t.prototype;return e.start=function(){var t;(this._jsonData={userId:""},this._path=this._getConfigPath(),S.isNative)?t=w.fileUtils.getValueMapFromFile(this._path)[this.KEY_CONFIG]:t=S.localStorage.getItem(this.KEY_CONFIG);if(t&&t.length){t.startsWith("@")&&(t=t.substring(1),t=Ne.decrypt(t));try{var e=JSON.parse(t);this._jsonData=e}catch(t){}}},e.setConfigDataWithoutSave=function(t,e){var i=this._jsonData.userId;this._jsonData[i]?this._jsonData[i][t]=e:console.error("no account can not save")},e.setConfigData=function(t,e){this.setConfigDataWithoutSave(t,e),this._markSave=!0},e.getConfigData=function(t){var e=this._jsonData.userId;if(this._jsonData[e]){var i=this._jsonData[e][t];return i||""}return T("no account can not load"),""},e.removeGlobalData=function(t){delete this._jsonData[t]},e.setGlobalData=function(t,e){this._jsonData[t]=e,this.save()},e.getGlobalData=function(t){return this._jsonData[t]},e.setUserId=function(t){this._jsonData.userId=t,this._jsonData[t]||(this._jsonData[t]={}),this.save()},e.getUserId=function(){return this._jsonData.userId},e.scheduleSave=function(){this._markSave&&this.save()},e.markModified=function(){this._markSave=!0},e.save=function(){var t=JSON.stringify(this._jsonData),e="@"+Ne.encrypt(t);if(this._markSave=!1,S.isNative){var i={};i[this.KEY_CONFIG]=e,w.fileUtils.writeValueMapToFile(i,this._getConfigPath())}else{S.localStorage.setItem(this.KEY_CONFIG,e)}},e._getConfigPath=function(){var t=S.platform,e="";return t===S.OS.WINDOWS?e="src/conf":t===S.OS.LINUX?e="./conf":S.isNative?(e=w.fileUtils.getWritablePath(),e+="conf"):e="src/conf",e},Ft(t,null,[{key:"instance",get:function(){return this._instance||(this._instance=new t,this._instance.start()),this._instance}}]),t}())._instance=void 0,Ge=We))||Ge);t._RF.pop(),t._RF.push({},"f11da56ne5J4oRL4Avag26V","resourceUtil",void 0);var Je,Qe,$e=(0,e.ccclass)("resourceUtil")(((je=function(){function t(){}return t.loadRes=function(t,e,i){var n=this;void 0===i&&(i=function(){}),this.resLoadedMap.has(t)?i&&i(null,this.resLoadedMap.get(t)):a.load(t,(function(e,o){return e?(C(e.message||e),void i(e,o)):o?(n.resLoadedMap.set(t,o),void(i&&i(null,o))):(C("res not found"),void i("res not found",o))}))},t.loadResNoCache=function(t,e,i){var n=this;void 0===i&&(i=function(){}),a.load(t,(function(e,o){if(e)return C(e.message||e),void i(e,o);n.resLoadedMap.set(t,o),i&&i(null,o)}))},t.loadEffectRes=function(t){var e=this;return new Promise((function(i,n){e.loadRes("prefab/effect/"+t,l,(function(e,o){if(e)return console.error("effect load failed",t),void(n&&n());i&&i(o)}))}))},t.loadModelResArr=function(t,e,i,n){var o=e.map((function(e){return t+"/"+e}));a.load(o,l,i,n)},t.loadResArr=function(t,e,i){a.load(t,l,e,i)},t.loadSpriteFrameRes=function(t){var e=this;return new Promise((function(n,o){e.loadRes(t,i,(function(e,r){if(e)return console.error("spriteFrame load failed!",t,e),void(o&&o());var a=new p;a.image=r;var s=new i;s.texture=a,n&&n(s)}))}))},t.getMap=function(t,e){var i="map";i+=t>=100?t:t>=10?"0"+t:"00"+t,this.loadRes("map/config/"+i,null,(function(t,i){if(t)e(t,i);else{var n="";if(i._file){window.LZString&&(n=window.LZString.decompressFromEncodedURIComponent(i._file));var o=JSON.parse(n);e(null,o)}else if(i.text){window.LZString&&(n=window.LZString.decompressFromEncodedURIComponent(i.text));o=JSON.parse(n);e(null,o)}else i.json?e(null,i.json):e("failed")}}))},t.getMapObj=function(t,e,i,n){for(var o=[],r=0;r<e.length;r++)o.push("map/"+t+"/"+e[r]);a.load(o,l,i,n)},t.getUIPrefabRes=function(t,e){this.loadRes("prefab/ui/"+t,l,e)},t.createUI=function(t,e,i,n){void 0===n&&(n="Canvas/Popup"),this.getUIPrefabRes(t,(function(t,o){if(!t){var r=E(o);r.setPosition(0,0,0),i||(i=A(n))||((i=A("Canvas"))||(i=A("/Canvas")),i||console.error("Canvas node not found in the scene")),i?(i.addChild(r),e&&e(null,r)):e&&e(null,r)}}))},t.preloadUI=function(t,e){this.getUIPrefabRes(t,(function(t,i){if(t)e&&e(t,null);else{var n=E(i);e&&e(null,n)}}))},t.getJsonData=function(t,e){this.loadRes("datas/"+t,null,(function(t,i){t?C(t.message||t):i.json?e(t,i.json):e("failed!!!")}))},t.getTextData=function(t,e){this.loadRes("datas/"+t,null,(function(t,i){if(t)C(t.message||t);else{var n=i.text;e(t,n)}}))},t.setSpriteFrame=function(t,e,i){a.load(t,(function(t,n){if(t)return C(t.message||t),void i(t,n);e&&P(e)&&(e.spriteFrame=n,null==i||i(null))}))},t.setSpriteFrameFromAtlas=function(t,e,i,n){a.load(t,h,(function(o,r){if(o)return console.error("set sprite frame form atlas failed! err:",t,o),void(null==n||n(o));if(i&&P(i)){var a=r.getSpriteFrame(e);i.spriteFrame=a,null==n||n(null)}}))},t.setSpriteFrameFromAutoAtlas=function(t,e,n,o){a.load(t+"/"+e,i,(function(e,i){if(e)return console.error("set sprite frame form atlas failed! err:",t,e),void(null==o||o(e));n&&P(n)&&(n.spriteFrame=i,null==o||o(null))}))},t.loadAndConvertSpriteFrame=function(t,e,n){this.loadRes(t,i,(function(o,r){if(o)return console.error("set sprite frame failed! err:",t,o),void(null==n||n(o));var a=new p;a.image=r;var s=new i;s.texture=a,s&&P(s)&&(e.spriteFrame=s,null==n||n(null))}))},t.setSpriteFrameRenderer=function(t,e,n){this.loadRes(t,i,(function(o,r){if(o)return console.error("set sprite frame failed! err:",t,o),void(null==n||n(o));var a=new p;a.image=r;var s=new i;s.texture=a,s&&P(s)&&(e.spriteFrame=s,null==n||n(null))}))},t.loadAllResources=function(t,e){a.loadDir(t,(function(t,i){t?console.error("Error loading resources: ",t):e(i)}))},t.loadAllSprites=function(t,e){a.loadDir(t,(function(t,n){if(t)console.error("Error loading resources: ",t);else{var o=n.filter((function(t){return t instanceof i}));e(o)}}))},t}()).resLoadedMap=new Map,Ye=je))||Ye;t._RF.pop(),t._RF.push({},"d7ecda770NLF4OP1Afz5O5u","audioManager",void 0);var ti,ei,ii,ni,oi,ri,ai,si,li,ci,ui,hi,pi,di,fi,gi,mi,vi,yi,bi,_i,Si,wi,Ti,Ci,Ei,Ai,Pi,Mi,Ii,Ni,Oi,Li,Ri,xi,Fi,Di,zi,ki,Vi,Bi,Hi,Ui,Gi,Wi,qi,Zi,Yi=e.ccclass,ji=(e.property,Yi("AudioManager")(((Qe=function(){function t(){this.audioMap=new Map,this._persistRootNode=null,this._audioSources=[],this.dictWeaponSoundIndex={},this.bgmVolume=.8,this.sfxVolume=1,this.audios={},this.arrSound=[],this.BGM_VOLUME=.35,this.SFX_VOLUME=.75,this.asMusic=null,this.curGetSFXSourceIndex=0,this.tweenFadeMusic=null,this.init()}var e=t.prototype;return e.init=function(){if(!this._persistRootNode){this._persistRootNode=new c("audio"),M.getScene().addChild(this._persistRootNode),I.addPersistRootNode(this._persistRootNode),this.asMusic=this._persistRootNode.addComponent(N);for(var t=0;t<15;t++)this._audioSources.push(this._persistRootNode.addComponent(N));this.bgmVolume=this.getAudioSetting(!0),this.sfxVolume=this.getAudioSetting(!1),this.audioMap.clear()}},e.getAudioSetting=function(t){var e,i,n;t?e=null!=(i=Xe.instance.getGlobalData(ve.STORAGE_KEY.BGM_VOLUME))?i:this.BGM_VOLUME:e=null!=(n=Xe.instance.getGlobalData(ve.STORAGE_KEY.SFX_VOLUME))?n:this.SFX_VOLUME;return e},e.setBGMProgress=function(t){this.bgmVolume=t*this.BGM_VOLUME,Xe.instance.setGlobalData(ve.STORAGE_KEY.BGM_VOLUME,this.bgmVolume)},e.setSFXProgress=function(t){this.sfxVolume=t*this.SFX_VOLUME,Xe.instance.setGlobalData(ve.STORAGE_KEY.SFX_VOLUME,this.sfxVolume)},e.getSound=function(t){return this.audioMap.has(t)?this.audioMap.get(t):null},e.playMusic=function(t,e){var i=this,n=this.asMusic,o="sounds/bgm/"+t;return $e.loadRes(o,O,(function(o,r){if(o)ye.LOG&&console.error(o);else{if(!r)return null;var a={source:n,isMusic:!0};i.audios[t]=a,n.stop(),n.clip=r,n.volume=i.bgmVolume,n.loop=e,n.play()}})),n},e.setMusicFade=function(t,e,i){var n,o=this;void 0===e&&(e=.5),void 0===i&&(i=null);var r=t?0:1,a=t?1:0,s=a-r,l={value:r};null==(n=this.tweenFadeMusic)||n.stop(),this.tweenFadeMusic=v(l).to(e,{value:a},{easing:_.linear,progress:function(t,e,i,n){var a;return a=r+n*s,o.asMusic&&o.bgmVolume&&(o.asMusic.volume=o.bgmVolume*a),0}}).call((function(){return null==i?void 0:i()})).start()},e.dimAllSounds=function(){this._audioSources.forEach((function(t){t.volume=0}))},e.playSound=function(t,e){var i=this;if(void 0===e&&(e=1),this.sfxVolume){this.curGetSFXSourceIndex=++this.curGetSFXSourceIndex%this._audioSources.length;var n=this._audioSources[this.curGetSFXSourceIndex],o="sounds/sfx/"+t;return $e.loadRes(o,O,(function(t,o){t?ye.LOG&&console.error(t):o&&(n.stop(),n.clip=o,n.currentTime=0,n.volume=i.sfxVolume*e,n.play())})),n}},e.stop=function(t){if(this.audios.hasOwnProperty(t)){var e=this.audios[t];e.source.stop(),e.source.volume=0}},e.stopAll=function(){for(var t in this.audios)if(this.audios.hasOwnProperty(t)){var e=this.audios[t];e.source.stop(),e.source.clip=null}this.asMusic.stop(),this.asMusic.clip=null},e.getMusicVolume=function(){return this.bgmVolume},e.setMusic=function(t){var e=t*this.BGM_VOLUME;Xe.instance.setGlobalData(ve.STORAGE_KEY.BGM_VOLUME,e),this.bgmVolume=e,this.asMusic.volume=this.bgmVolume},e.pauseAll=function(){for(var t in ye.LOG&&console.log("pause all music!!!"),this.audios){if(this.audios.hasOwnProperty(t))this.audios[t].source.pause()}},e.resumeAll=function(){for(var t in this.audios){if(this.audios.hasOwnProperty(t))this.audios[t].source.play()}},e.setSound=function(t){var e=t*this.SFX_VOLUME;for(var i in Xe.instance.setGlobalData(ve.STORAGE_KEY.SFX_VOLUME,e),this.sfxVolume=e,this.audios){if(this.audios.hasOwnProperty(i)&&!this.audios[i].isMusic)this.audios[i].source.volume=this.sfxVolume}for(var n=0;n<this.arrSound.length;n++){this.arrSound[n].source.volume=this.sfxVolume}},e.stopSingleSound=function(t){this.audios.hasOwnProperty(t)&&!this.audios[t].isMusic&&this.audios[t].source.stop()},Ft(t,[{key:"bgmProgress",get:function(){return this.bgmVolume/this.BGM_VOLUME}},{key:"sfxProgress",get:function(){return this.sfxVolume/this.SFX_VOLUME}}]),t}()).instance=void 0,Je=Qe))||Je);t._RF.pop(),t._RF.push({},"0ade8jDYZpLPZyun6PIe4u6","AnimationPanel",void 0);var Ki,Xi,Ji,Qi=e.ccclass,$i=e.property,tn=(ti=Qi("AnimationPanel"),ei=$i({group:{name:"Animation Settings",id:"animation"},tooltip:"Enable to customize animation settings"}),ii=$i({type:L(Ue),group:{name:"Animation Settings",id:"animation"},tooltip:"Initial state of the panel",visible:function(){return this.isShowPopupsetting}}),ni=$i({type:g,group:{name:"Animation Settings",id:"animation"},tooltip:"Initial position of the panel",visible:function(){return this.isShowPopupsetting}}),oi=$i({group:{name:"Show Animation",id:"show"},tooltip:"Starting X position for show animation",visible:function(){return this.isShowPopupsetting}}),ri=$i({group:{name:"Show Animation",id:"show"},tooltip:"Starting Y position for show animation",visible:function(){return this.isShowPopupsetting}}),ai=$i({group:{name:"Show Animation",id:"show"},tooltip:"Starting scale for show animation",visible:function(){return this.isShowPopupsetting}}),si=$i({type:L(qe),group:{name:"Show Animation",id:"show"},tooltip:"Easing function for show animation",visible:function(){return this.isShowPopupsetting}}),li=$i({group:{name:"Hide Animation",id:"hide"},tooltip:"Ending X position for hide animation",visible:function(){return this.isShowPopupsetting}}),ci=$i({group:{name:"Hide Animation",id:"hide"},tooltip:"Ending Y position for hide animation",visible:function(){return this.isShowPopupsetting}}),ui=$i({group:{name:"Hide Animation",id:"hide"},tooltip:"Ending scale for hide animation",visible:function(){return this.isShowPopupsetting}}),hi=$i({type:L(qe),group:{name:"Hide Animation",id:"hide"},tooltip:"Easing function for hide animation",visible:function(){return this.isShowPopupsetting}}),pi=$i({group:{name:"Additional Settings",id:"additional"},tooltip:"Duration of show animation in seconds",visible:function(){return this.isShowPopupsetting}}),di=$i({group:{name:"Additional Settings",id:"additional"},tooltip:"Duration of hide animation in seconds",visible:function(){return this.isShowPopupsetting}}),fi=$i({group:{name:"Additional Settings",id:"additional"},tooltip:"Enable rotation animation",visible:function(){return this.isShowPopupsetting}}),gi=$i({group:{name:"Additional Settings",id:"additional"},tooltip:"Starting rotation for show animation (in degrees)",visible:function(){return this.isShowPopupsetting&&this.enableRotation}}),mi=$i({group:{name:"Additional Settings",id:"additional"},tooltip:"Ending rotation for hide animation (in degrees)",visible:function(){return this.isShowPopupsetting&&this.enableRotation}}),vi=$i({group:{name:"Additional Settings",id:"additional"},tooltip:"Enable opacity animation",visible:function(){return this.isShowPopupsetting}}),yi=$i({group:{name:"Additional Settings",id:"additional"},tooltip:"Starting opacity for show animation (0-255)",visible:function(){return this.isShowPopupsetting&&this.enableOpacity}}),bi=$i({group:{name:"Additional Settings",id:"additional"},tooltip:"Ending opacity for hide animation (0-255)",visible:function(){return this.isShowPopupsetting&&this.enableOpacity}}),_i=$i({type:Be,group:{name:"Background Settings",id:"background"},tooltip:"Background panel that dims when this panel is shown",visible:function(){return this.isShowPopupsetting}}),Si=$i({group:{name:"Background Settings",id:"background"},tooltip:"Duration of background dim animation in seconds",visible:function(){return this.isShowPopupsetting}}),wi=$i({group:{name:"Audio Settings",id:"audio"},tooltip:"Sound effect to play when panel is shown"}),ti((Ei=It((Ci=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,Ot(e,"isShowPopupsetting",Ei,Lt(e)),Ot(e,"beginType",Ai,Lt(e)),Ot(e,"beginPosition",Pi,Lt(e)),Ot(e,"showFromPosX",Mi,Lt(e)),Ot(e,"showFromPosY",Ii,Lt(e)),Ot(e,"showFromScale",Ni,Lt(e)),Ot(e,"showEasingType",Oi,Lt(e)),Ot(e,"hideToPosX",Li,Lt(e)),Ot(e,"hideToPosY",Ri,Lt(e)),Ot(e,"hideToScale",xi,Lt(e)),Ot(e,"hideEasingType",Fi,Lt(e)),Ot(e,"showDuration",Di,Lt(e)),Ot(e,"hideDuration",zi,Lt(e)),Ot(e,"enableRotation",ki,Lt(e)),Ot(e,"showFromRotation",Vi,Lt(e)),Ot(e,"hideToRotation",Bi,Lt(e)),Ot(e,"enableOpacity",Hi,Lt(e)),Ot(e,"showFromOpacity",Ui,Lt(e)),Ot(e,"hideToOpacity",Gi,Lt(e)),Ot(e,"dimNode",Wi,Lt(e)),Ot(e,"dimDuration",qi,Lt(e)),Ot(e,"shownAudioName",Zi,Lt(e)),e.opMain=null,e.visibleIndex=-1,e.visibleTween=null,e.scheduleDim=null,e}Nt(e,t);var i=e.prototype;return i.onLoad=function(){var t,e;switch(this.node.setPosition(this.beginPosition),this.beginType){case Ue.NONE:this.visibleIndex=-1;break;case Ue.HIDE:this.visibleIndex=0,this.setPanelVisible(!1,0),null==(t=this.dimNode)||t.setPanelVisible(!1,0);break;case Ue.SHOW:this.visibleIndex=1,this.setPanelVisible(!0,0),null==(e=this.dimNode)||e.setPanelVisible(!0,0)}},i.setAnimVisible=function(t,e,i){void 0===e&&(e=null),void 0===i&&(i=.35),this.visibleIndex!=(t?1:0)?(this.visibleIndex=t?1:0,t?this.showAnimation(e,i):this.hideAnimation(e,i)):null==e||e()},i.showAnimation=function(t,e){var i;this.node.active=!0,this.node.position=m(this.showFromPosX,this.showFromPosY,0),this.node.setScale(m(this.showFromScale,this.showFromScale,this.showFromScale)),this.enableRotation&&this.node.setRotationFromEuler(0,0,this.showFromRotation),this.enableOpacity&&(this.opMain=this.getComponent(b)||this.addComponent(b),this.opMain.opacity=this.showFromOpacity),null==(i=this.visibleTween)||i.stop(),this.visibleTween=v(this.node),this.visibleTween.to(e,{position:g.ZERO},{easing:this.getEasingShowAnim()}),this.visibleTween.to(e,{scale:g.ONE},{easing:this.getEasingShowAnim()}),this.enableRotation&&this.visibleTween.to(e,{eulerAngles:new g(0,0,0)},{easing:this.getEasingShowAnim()}),this.enableOpacity&&v(this.opMain).to(e,{opacity:255},{easing:this.getEasingShowAnim()}).start(),this.visibleTween.call((function(){return null==t?void 0:t()})).start(),this.setDimBackground(!0,e,this.dimDuration)},i.hideAnimation=function(t,e){var i,n=this;null==(i=this.visibleTween)||i.stop(),this.visibleTween=v(this.node),this.visibleTween.to(e,{position:m(this.hideToPosX,this.hideToPosY,0)},{easing:this.getEasingHideAnim()}),this.visibleTween.to(e,{scale:m(this.hideToScale,this.hideToScale,this.hideToScale)},{easing:this.getEasingHideAnim()}),this.enableRotation&&this.visibleTween.to(e,{eulerAngles:new g(0,0,this.hideToRotation)},{easing:this.getEasingHideAnim()}),this.enableOpacity&&v(this.opMain).to(e,{opacity:this.hideToOpacity},{easing:this.getEasingHideAnim()}).start(),this.visibleTween.call((function(){n.node.active=!1,null==t||t()})).start(),this.setDimBackground(!1,0,this.dimDuration)},i.getEasingShowAnim=function(){return Ze(this.showEasingType)},i.getEasingHideAnim=function(){return Ze(this.hideEasingType)},i.setDimBackground=function(t,e,i){var n=this;void 0===i&&(i=.2),null!=this.dimNode&&(null!=this.scheduleDim&&this.unschedule(this.scheduleDim),this.scheduleDim=this.scheduleOnce((function(){return n.dimNode.setPanelVisible(t,i)}),e))},i.show=function(t,e){var i=this;this.shownAudioName&&1!=this.visibleIndex&&ji.instance.playSound(this.shownAudioName),this.setAnimVisible(!0,(function(){i.shown(),null==e||e()}),this.showDuration)},i.doShow=function(){this.show(null,void 0)},i.doHide=function(){this.hide(void 0)},i.hide=function(t){var e=this;this.setAnimVisible(!1,(function(){e.hided(),null==t||t()}),this.hideDuration)},i.shown=function(){},i.hided=function(){},i.onKeyDown=function(t){0!=this.isEscable&&t.keyCode===R.ESCAPE&&this.doHide()},i.onTouch_Close=function(){this.doHide()},Ft(e,[{key:"isShowing",get:function(){return 1==this.visibleIndex}},{key:"isEscable",get:function(){return!1}}]),e}(Be)).prototype,"isShowPopupsetting",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Ai=It(Ci.prototype,"beginType",[ii],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Ue.NONE}}),Pi=It(Ci.prototype,"beginPosition",[ni],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return m(0,0,0)}}),Mi=It(Ci.prototype,"showFromPosX",[oi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-1080}}),Ii=It(Ci.prototype,"showFromPosY",[ri],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Ni=It(Ci.prototype,"showFromScale",[ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),Oi=It(Ci.prototype,"showEasingType",[si],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return qe.BackOut}}),Li=It(Ci.prototype,"hideToPosX",[li],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1080}}),Ri=It(Ci.prototype,"hideToPosY",[ci],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),xi=It(Ci.prototype,"hideToScale",[ui],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Fi=It(Ci.prototype,"hideEasingType",[hi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return qe.BackIn}}),Di=It(Ci.prototype,"showDuration",[pi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.35}}),zi=It(Ci.prototype,"hideDuration",[di],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.25}}),ki=It(Ci.prototype,"enableRotation",[fi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Vi=It(Ci.prototype,"showFromRotation",[gi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-45}}),Bi=It(Ci.prototype,"hideToRotation",[mi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 45}}),Hi=It(Ci.prototype,"enableOpacity",[vi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Ui=It(Ci.prototype,"showFromOpacity",[yi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Gi=It(Ci.prototype,"hideToOpacity",[bi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Wi=It(Ci.prototype,"dimNode",[_i],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),qi=It(Ci.prototype,"dimDuration",[Si],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.2}}),Zi=It(Ci.prototype,"shownAudioName",[wi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),Ti=Ci))||Ti);t._RF.pop(),t._RF.push({},"9bf359IqNNOdo7v0PQCju2a","ButtonAutoSound",void 0);var en,nn,on,rn,an,sn=e.ccclass,ln=e.property;sn("ButtonAutoSound")((Ji=It((Xi=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,Ot(e,"audioName",Ji,Lt(e)),e}Nt(e,t);var i=e.prototype;return i.onLoad=function(){var t=this.getComponent(x);if(t){var e=new F;e.target=this.node,e.component="ButtonAutoSound",e.handler="onButtonClicked",t.clickEvents.push(e)}},i.onButtonClicked=function(){var t;null==(t=ji.instance)||t.playSound(this.audioName)},e}(r)).prototype,"audioName",[ln],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"A_Click_Menu"}}),Ki=Xi));t._RF.pop(),t._RF.push({},"e01eb+jQTRNdbPwrEVkkCRc","HotKey",void 0);var cn,un=e.ccclass,hn=e.property,pn=(en=un("Hotkey"),nn=hn({type:[L(R)]}),en((an=It((rn=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,Ot(e,"keys",an,Lt(e)),e.keyMap=new Map,e}Nt(e,t);var i=e.prototype;return i.onLoad=function(){var t=this;this.keys.forEach((function(e){return t.keyMap.set(e,!1)}))},i.getKeyString=function(){try{var t=R[this.keys[0]];if(t.length<=2)return t;var e=t.split("_");return e[e.length-1]}catch(t){return""}},i.onEnable=function(){D.on(z.EventType.KEY_DOWN,this.onKeyDown,this),D.on(z.EventType.KEY_UP,this.onKeyUp,this)},i.onDisable=function(){D.off(z.EventType.KEY_DOWN,this.onKeyDown,this),D.off(z.EventType.KEY_UP,this.onKeyUp,this)},i.onKeyDown=function(t){this.keyMap.has(t.keyCode)&&(this.keyMap.set(t.keyCode,!0),this.isKeyCombinationPressed()&&this.trigger())},i.onKeyUp=function(t){this.keyMap.has(t.keyCode)&&this.keyMap.set(t.keyCode,!1)},i.isKeyCombinationPressed=function(){var t=!0;return this.keyMap.forEach((function(e,i){e||(t=!1)})),t},i.trigger=function(){},e}(r)).prototype,"keys",[nn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),on=rn))||on);t._RF.pop(),t._RF.push({},"099f7MZV3JPrp3nEUGlRKH5","ButtonHotKey",void 0);var dn,fn,gn=e.ccclass,mn=(e.property,gn("ButtonHotKey")(cn=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).button=null,e}Nt(e,t);var i=e.prototype;return i.onLoad=function(){t.prototype.onLoad.call(this),this.button=this.getComponent(x)},i.trigger=function(){t.prototype.trigger.call(this),this.button&&this.button.clickEvents.forEach((function(t){t.emit(null)}))},e}(pn))||cn);t._RF.pop(),t._RF.push({},"2d53e8mnhxHI4l+waizfjCg","EscHotkey",void 0);var vn,yn=e.ccclass;e.property,yn("EscHotkey")(((fn=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).index=0,e}Nt(e,t);var i=e.prototype;return i.onLoad=function(){this.keys=[R.ESCAPE],t.prototype.onLoad.call(this)},i.onEnable=function(){e.escIndex+=1,this.index=e.escIndex,t.prototype.onEnable.call(this)},i.onDisable=function(){e.escIndex-=1,this.index=-1,t.prototype.onDisable.call(this)},i.trigger=function(){e.escIndex<0||this.index==e.escIndex&&t.prototype.trigger.call(this)},e}(mn)).escIndex=-1,dn=fn));t._RF.pop(),t._RF.push({},"37345Pr89dKxKXe+sjSuW5N","ToggleHotKey",void 0);var bn,_n,Sn,wn,Tn,Cn,En,An=e.ccclass;e.property,An("ToggleHotKey")(vn=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).toggle=null,e}Nt(e,t);var i=e.prototype;return i.onLoad=function(){t.prototype.onLoad.call(this),this.toggle=this.getComponent(k)},i.trigger=function(){t.prototype.trigger.call(this),this.toggle&&(this.toggle.isChecked=!this.toggle.isChecked,this.toggle.checkEvents.forEach((function(t){t.emit(null)})))},e}(pn));t._RF.pop(),t._RF.push({},"3d20epSqOJE7Yu882uRz4oI","UIHotkeyLabel",void 0);var Pn,Mn,In,Nn,On,Ln=e.ccclass,Rn=e.property;bn=Ln("UIHotkeyLabel"),_n=Rn(c),Sn=Rn(y),bn((Cn=It((Tn=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,Ot(e,"nodeMain",Cn,Lt(e)),Ot(e,"lbMain",En,Lt(e)),e.hotkey=null,e}Nt(e,t);var i=e.prototype;return i.onLoad=function(){this.hotkey=this.node.getComponent(pn),this.hotkey?(this.lbMain.string=this.hotkey.getKeyString(),Ut.on(ve.EVENT_NAME.HOTKEY_STATE_CHANGED,this.updateHotKeyState,this),this.updateHotKeyState()):console.error("UIHotkeylabel the hotkey is null")},i.onDestroy=function(){Ut.off(ve.EVENT_NAME.HOTKEY_STATE_CHANGED,this.updateHotKeyState,this)},i.updateHotKeyState=function(){var t,e=null!=(t=Xe.instance.getGlobalData(ve.STORAGE_KEY.HOTKEY))&&t;this.nodeMain.active=e},e}(r)).prototype,"nodeMain",[_n],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),En=It(Tn.prototype,"lbMain",[Sn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),wn=Tn));t._RF.pop(),t._RF.push({},"05db20FCuhNgIZ/Of1+Usnv","InteractableItem",void 0);var xn,Fn=e.ccclass,Dn=e.property;Pn=Fn("InteractableItem"),Mn=Dn(c),Pn((On=It((Nn=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,Ot(e,"nodeTouch",On,Lt(e)),e.onSelected=null,e.onStart=null,e.onDrag=null,e.onHover=null,e.onEndInteracted=null,e.isInteracting=!1,e.passThroughNode=null,e.dragCount=0,e.interactNode=null,e.transform=null,e}Nt(e,t);var i=e.prototype;return i.setInteractable=function(t,e){var i;void 0===e&&(e=null),this.passThroughNode=e;var n=null!=(i=this.nodeTouch)?i:this.node;t?(n.on(V.TOUCH_END,this.onTouchEnd,this),n.on(V.TOUCH_START,this.onTouchStart,this),n.on(V.TOUCH_MOVE,this.onTouchMove,this),n.on(V.MOUSE_ENTER,this.onMouseHover,this),n.on(V.MOUSE_LEAVE,this.onMouseLeave,this)):(n.off(V.TOUCH_END,this.onTouchEnd,this),n.off(V.TOUCH_START,this.onTouchStart,this),n.off(V.TOUCH_MOVE,this.onTouchMove,this),n.off(V.MOUSE_ENTER,this.onMouseHover,this),n.off(V.MOUSE_LEAVE,this.onMouseLeave,this))},i.getTransform=function(){var t;null==this.transform&&(this.interactNode=null!=(t=this.nodeTouch)?t:this.node,this.transform=this.interactNode.getComponent(B));return this.transform},i.isContainsPosition=function(t){var e=this.getTransform().contentSize;return H(this.interactNode.position.x-e.width/2,this.interactNode.position.y-e.height/2,e.width,e.height).contains(t)},i.onTouchEnd=function(t){var e,i;this.dragCount<=4&&(null==(i=this.onSelected)||i.call(this,this));this.dragCount=0,this.isInteracting=!1,this.checkPassThroughNode(V.TOUCH_END,t),null==(e=this.onEndInteracted)||e.call(this,this)},i.onTouchStart=function(t){var e;this.dragCount=0,this.isInteracting=!0,this.checkPassThroughNode(V.TOUCH_START,t),null==(e=this.onStart)||e.call(this,this)},i.onTouchMove=function(t){var e;(this.dragCount++,this.checkPassThroughNode(V.TOUCH_MOVE,t),this.dragCount>=4)&&(null==(e=this.onDrag)||e.call(this,this))},i.onMouseHover=function(t){var e;this.checkPassThroughNode(V.MOUSE_ENTER,t),null==(e=this.onHover)||e.call(this,this)},i.onMouseLeave=function(t){var e;this.checkPassThroughNode(V.MOUSE_ENTER,t),this.isInteracting=!1,null==(e=this.onEndInteracted)||e.call(this,this)},i.checkPassThroughNode=function(t,e){this.passThroughNode&&this.passThroughNode.emit(t,e)},e}(r)).prototype,"nodeTouch",[Mn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),In=Nn));t._RF.pop(),t._RF.push({},"63b2flj0OJDBKxMBXVQtrFG","PageViewBaseItem",void 0);var zn,kn=e.ccclass,Vn=(e.property,kn("PageViewBaseItem")(xn=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).onSelected=void 0,e}Nt(e,t);var i=e.prototype;return i.init=function(t,e){this.onSelected=e},i.onTouch_Main=function(){var t;null==(t=this.onSelected)||t.call(this,this)},e}(r))||xn);t._RF.pop(),t._RF.push({},"1049b+/UgpATrtKU8hoqIHQ","PageViewBasePage",void 0);var Bn,Hn,Un,Gn,Wn,qn,Zn,Yn=e.ccclass,jn=(e.property,Yn("PageViewBasePage")(zn=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).items=[],e.itemData=[],e.onSelectItem=void 0,e.onCreatedItem=void 0,e}Nt(e,t);var i=e.prototype;return i.onLoad=function(){this.getChilds()},i.getChildNumber=function(){return this.items.length>0&&this.items.length,this.getChilds(),this.items.length},i.getChilds=function(){this.items.length>0||(this.items=this.getComponentsInChildren(Vn))},i.init=function(t){var e=this;this.getChilds(),this.itemData=t;for(var i=0;i<this.items.length;i++){var n=this.items[i],o=i<t.length;if(n.node.active=o,o){var r,a=t[i];n.init(a,(function(t){null==e.onSelectItem||e.onSelectItem(t)})),null==(r=this.onCreatedItem)||r.call(this,n)}}},e}(r))||zn);t._RF.pop(),t._RF.push({},"fe2875NRMFPRoZfEkgoBxVz","PageViewBase",void 0);var Kn,Xn=e.ccclass,Jn=e.property;Bn=Xn("PageViewBase"),Hn=Jn(c),Un=Jn(l),Bn((qn=It((Wn=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,Ot(e,"content",qn,Lt(e)),Ot(e,"prefabPageView",Zn,Lt(e)),e.onSelectedItem=void 0,e.onCreatedItem=void 0,e.itemPerPage=0,e.firstPage=null,e.pages=[],e.items=[],e}Nt(e,t);var i=e.prototype;return i.init=function(t){t.length<=0||(this.items=t,this.createFristPage(),this.createPages(),this.setPageData())},i.createPages=function(){for(var t=Math.ceil(this.items.length/this.itemPerPage),e=this.pages.length;e<t;e++)this.createPage()},i.setPageData=function(){var t=this;if(!(this.pages.length<=0)){for(var e=0,i=0,n=function(e,i){e.node.active=!0,e.onSelectItem=t.onPageSelectItem.bind(t),e.onCreatedItem=t.onPageCreateItem.bind(t),e.init(i)},o=0;o<this.items.length;o+=this.itemPerPage){var r=this.items.slice(o,o+this.itemPerPage);n(this.pages[e],r),i=o+r.length,e++}if(i<this.items.length-1){var a=this.items.slice(i,this.items.length);n(this.pages[e],a)}for(var s=++e;s<this.pages.length;s++)this.pages[s].node.active=!1}},i.createFristPage=function(){var t;null==this.firstPage&&(this.firstPage=this.createPage(),this.itemPerPage=null==(t=this.firstPage)?void 0:t.getChildNumber())},i.createPage=function(){var t=E(this.prefabPageView);t.parent=this.content;var e=t.getComponent(jn);return this.pages.push(e),e},i.onPageCreateItem=function(t){var e;null==(e=this.onCreatedItem)||e.call(this,t)},i.onPageSelectItem=function(t){var e;null==(e=this.onSelectedItem)||e.call(this,t)},e}(r)).prototype,"content",[Hn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Zn=It(Wn.prototype,"prefabPageView",[Un],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Gn=Wn));t._RF.pop(),t._RF.push({},"cf006zT+RZGvahsGniqfbWl","PersistentNode",void 0);var Qn=e.ccclass;e.property,Qn("PersistentNode")(Kn=function(t){function e(){return t.apply(this,arguments)||this}return Nt(e,t),e.prototype.onLoad=function(){M.addPersistRootNode(this.node)},e}(r));t._RF.pop(),t._RF.push({},"508dcnFkVtIbZwwhiY9QURR","PopupDefine",void 0);var $n,to,eo="PopupMessage",io="PopupLoading";t._RF.pop(),t._RF.push({},"c34cbKAQZdEpJrFv/VJuh+B","uiManager",void 0);var no,oo=e.ccclass,ro=(e.property,function(t){return t.LAYER_1="GlobalCanvas/Layer1",t.LAYER_2="GlobalCanvas/Layer2",t.LAYER_3="GlobalCanvas/Layer3",t.LAYER_4="GlobalCanvas/Layer4",t}({})),ao=oo("UIManager")(((to=function(){function t(){this.preloadPrefabNames=[io,eo],this._dictSharedPanel={},this._dictLoading={},this._arrPopupDialog=[],this.layerNodeMap=new Map,this.blockNode=null,this.delayTimeoutDefine=0,this.popupLoading=null,this.popupLoadingData=null,this.preloadUIs()}var e=t.prototype;return e.preloadUIs=function(){var t=this;this.preloadPrefabNames.forEach((function(e){t.preloadDialog(e,null)}))},e.isDialogVisible=function(t){if(!this._dictSharedPanel.hasOwnProperty(t))return!1;var e=this._dictSharedPanel[t];return P(e)&&e.active&&P(e.parent)},e.getLayerNode=function(t){if(this.layerNodeMap.has(t)){var e=this.layerNodeMap.get(t);if(P(e))return e}var i=A(t);if(!i){i=new c;var n=t.split("/");i.name=n[n.length-1],i.parent=A("Game/Canvas")}return this.layerNodeMap.set(t,i),i},e.showDialog=function(t,e,i,n,o){var r=this;if(void 0===n&&(n=-1),void 0===o&&(o=ro.LAYER_1),!this._dictLoading[t]){var a=t.lastIndexOf("/"),s=t.slice(a+1);if(e||(e=[]),this._dictSharedPanel.hasOwnProperty(t)){var l=this._dictSharedPanel[t];if(P(l)&&P(l.parent))try{l.parent=this.getLayerNode(o),l.active=!0;var c=l.getComponent(s),u=l.getComponent(s.charAt(0).toUpperCase()+s.slice(1));if(c&&c.show)c.show.apply(c,e),i&&i(c);else{if(!u||!u.show)throw""+s;u.show.apply(u,e),i&&i(u)}return}catch(t){return void this.showMessage({message:"Error while showing dialog",title:"Error"})}}this.setLoading(!0,.5),this._dictLoading[t]=!0,$e.createUI(t,(function(o,a){if(r.setLoading(!1),!o){var l=!1;r._dictLoading[t]||(l=!0),r._dictLoading[t]=!1,n>=0&&a.setSiblingIndex(n),r._dictSharedPanel[t]=a;var c=a.getComponent(s),u=a.getComponent(s.charAt(0).toUpperCase()+s.slice(1));if(c&&c.show)c.show.apply(c,e),i&&i(c);else{if(!u||!u.show)throw""+s;u.show.apply(u,e),i&&i(u)}l&&r.hideDialog(t)}}),null,o)}},e.preloadDialog=function(t,e){var i=this;this._dictLoading[t]=!0,$e.preloadUI(t,(function(n,o){n?null==e||e(n):(i._dictLoading[t]=!1,i._dictSharedPanel[t]=o,o.parent=null,null==e||e(null))}))},e.hideDialog=function(t,e){if(this._dictSharedPanel.hasOwnProperty(t)){var i=this._dictSharedPanel[t];if(i&&P(i)){var n=i.getComponent("animationUI");n?n.close((function(){i.parent=null,e&&"function"==typeof e&&e()})):(i.parent=null,e&&"function"==typeof e&&e())}else e&&"function"==typeof e&&e()}this._dictLoading[t]=!1},e.hidePopup=function(t,e){if(this._dictSharedPanel.hasOwnProperty(t)){var i=this._dictSharedPanel[t];if(i&&P(i)){var n=i.getComponent(lo);n?n.hide((function(){i.parent=null,e&&"function"==typeof e&&e()})):(i.parent=null,e&&"function"==typeof e&&e())}else e&&"function"==typeof e&&e()}this._dictLoading[t]=!1},e.pushToPopupSeq=function(t,e,i){var n={panelPath:t,scriptName:e,param:i,isShow:!1};this._arrPopupDialog.push(n),this._checkPopupSeq()},e.insertToPopupSeq=function(t,e,i){var n={panelPath:e,param:i,isShow:!1};this._arrPopupDialog.splice(t,0,n)},e.shiftFromPopupSeq=function(t){var e=this;this.hideDialog(t,(function(){e._arrPopupDialog[0]&&e._arrPopupDialog[0].panelPath===t&&(e._arrPopupDialog.shift(),e._checkPopupSeq())}))},e._checkPopupSeq=function(){if(this._arrPopupDialog.length>0){var t=this._arrPopupDialog[0];t.isShow||(this.showDialog(t.panelPath,t.param),this._arrPopupDialog[0].isShow=!0)}},e.showMessage=function(t){this.showDialog(eo,[t],(function(t){}),9999,ro.LAYER_4)},e.setBlock=function(t){this.blockNode||(this.blockNode=A("GlobalCanvas/Block")),this.blockNode.active=t,this.blockNode.setSiblingIndex(999)},e.setLoading=function(t,e,i){var n=this;if(void 0===e&&(e=2),void 0===i&&(i=null),clearTimeout(this.delayTimeoutDefine),t){if(this.setBlock(!0),this.popupLoadingData=i,this.popupLoading)return void this.popupLoading.setLoadingDetail(i);this.delayTimeoutDefine=setTimeout((function(){n.showLoading()}),1e3*e)}else clearTimeout(this.delayTimeoutDefine),this.setBlock(!1),this.hidePopup(io),this.popupLoading=null,this.popupLoadingData=null},e.showLoading=function(){var t=this;this.showDialog(io,[this.popupLoadingData],(function(e){t.popupLoading=e}),1,ro.LAYER_3)},t}()).instance=void 0,$n=to))||$n;t._RF.pop(),t._RF.push({},"60806q+/XRP8Yh7Fpwhr+Nd","PopupBase",void 0);var so,lo=(0,e.ccclass)("PopupBase")(no=function(t){function e(){return t.apply(this,arguments)||this}return Nt(e,t),e.prototype.doUImanagerHide=function(){var t=this;this.hide((function(){ao.instance.hideDialog(t.node.name)}))},e}(tn))||no;t._RF.pop(),t._RF.push({},"24d73F5z1hKK5U8r6924kDc","ScrollViewBaseItem",void 0);var co,uo=e.ccclass,ho=(e.property,uo("ScrollViewBaseItem")(so=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).onSelected=void 0,e}Nt(e,t);var i=e.prototype;return i.init=function(t,e){this.onSelected=e},i.onTouch_Main=function(){var t;null==(t=this.onSelected)||t.call(this,this)},e}(r))||so);t._RF.pop(),t._RF.push({},"4fd8fTpdO9H04vVXP8RzKRM","ScrollViewBaseLine",void 0);var po,fo,go,mo,vo,yo,bo,_o=(0,e.ccclass)("ScrollViewBaseLine")(co=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).items=[],e.itemData=[],e.onSelectItem=void 0,e.onCreatedItem=void 0,e}Nt(e,t);var i=e.prototype;return i.onLoad=function(){this.getChilds()},i.getChildNumber=function(){return this.items.length>0&&this.items.length,this.getChilds(),this.items.length},i.getChilds=function(){this.items.length>0||(this.items=this.getComponentsInChildren(ho))},i.init=function(t){var e=this;this.getChilds(),this.itemData=t;for(var i=0;i<this.items.length;i++){var n=this.items[i],o=i<t.length;if(o&&(o=null!=t[0]),n.node.active=o,o){var r,a=t[i];n.init(a,(function(t){null==e.onSelectItem||e.onSelectItem(t)})),null==(r=this.onCreatedItem)||r.call(this,n)}}},e}(r))||co;t._RF.pop(),t._RF.push({},"c6578BkEldD6Ymz3t6pB6h0","ScrollViewBase",void 0);var So,wo,To,Co,Eo=e.ccclass,Ao=e.property;po=Eo("ScrollViewBase"),fo=Ao(c),go=Ao(l),po((yo=It((vo=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,Ot(e,"content",yo,Lt(e)),Ot(e,"prefabLine",bo,Lt(e)),e.onSelectedItem=void 0,e.onCreatedItem=void 0,e.itemPerLine=0,e.firstLine=null,e.lines=[],e.items=[],e}Nt(e,t);var i=e.prototype;return i.init=function(t){t.length<=0||(this.items=t,this.createFristLine(),this.createLines(),this.setLineData())},i.createLines=function(){for(var t=Math.ceil(this.items.length/this.itemPerLine),e=this.lines.length;e<t;e++)this.createLine()},i.setLineData=function(){var t=this;if(!(this.lines.length<=0)){for(var e=0,i=0,n=function(e,i){e.node.active=!0,e.onSelectItem=t.onLineSelectItem.bind(t),e.onCreatedItem=t.onLineCreateItem.bind(t),e.init(i)},o=0;o<this.items.length;o+=this.itemPerLine){var r=this.items.slice(o,o+this.itemPerLine);n(this.lines[e],r),i=o+r.length,e++}if(i<this.items.length-1){var a=this.items.slice(i,this.items.length);n(this.lines[e],a)}for(var s=++e;s<this.lines.length;s++)this.lines[s].node.active=!1}},i.createFristLine=function(){var t;null==this.firstLine&&(this.firstLine=this.createLine(),this.itemPerLine=null==(t=this.firstLine)?void 0:t.getChildNumber())},i.createLine=function(){var t=E(this.prefabLine);t.parent=this.content;var e=t.getComponent(_o);return this.lines.push(e),e},i.onLineCreateItem=function(t){var e;null==(e=this.onCreatedItem)||e.call(this,t)},i.onLineSelectItem=function(t){var e;null==(e=this.onSelectedItem)||e.call(this,t)},e}(r)).prototype,"content",[fo],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),bo=It(vo.prototype,"prefabLine",[go],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),mo=vo));t._RF.pop(),t._RF.push({},"36cdeVcYgBP746cVQn6km3N","ToggleAutoSound",void 0);var Po,Mo,Io,No,Oo,Lo=e.ccclass,Ro=e.property;Lo("ToggleAutoSound")((To=It((wo=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,Ot(e,"onAudioName",To,Lt(e)),Ot(e,"offAudioName",Co,Lt(e)),e.toggle=null,e}Nt(e,t);var i=e.prototype;return i.onLoad=function(){if(this.toggle=this.getComponent(k),this.toggle){var t=new F;t.target=this.node,t.component="ToggleAutoSound",t.handler="onToggleChanged",this.toggle.checkEvents.push(t)}},i.onToggleChanged=function(){this.toggle&&ji.instance.playSound(this.toggle.isChecked?this.onAudioName:this.offAudioName)},e}(r)).prototype,"onAudioName",[Ro],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"sfx_lobby_ui_01"}}),Co=It(wo.prototype,"offAudioName",[Ro],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"sfx_lobby_ui_01_Low"}}),So=wo));t._RF.pop(),t._RF.push({},"ade5btidtpL5YVAIw3v0u9e","UIAutoVersion",void 0);var xo=e.ccclass,Fo=e.property;Po=xo("UIAutoVersion"),Mo=Fo(y),Po((Oo=It((No=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,Ot(e,"lbVersion",Oo,Lt(e)),e}Nt(e,t);var i=e.prototype;return i.start=function(){},i.onFocusInEditor=function(){},e}(r)).prototype,"lbVersion",[Mo],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Io=No));t._RF.pop(),t._RF.push({},"e2cc7nhdnVFF5CMWYmDA7HF","UserManager",void 0);var Do=function(){function t(){this.userdata=null,t.instance=this}return t.prototype.setUserData=function(t){this.userdata=t},Ft(t,[{key:"id",get:function(){var t;return null!=(t=this.userdata.id)?t:""}},{key:"coins",get:function(){var t,e;return null!=(t=null==(e=this.userdata)?void 0:e.coin)?t:0}}]),t}();Do.instance=null;var zo,ko,Vo,Bo,Ho,Uo;new Do;t._RF.pop(),t._RF.push({},"f56b3kOhzpA5qPzFsat65CR","UICoins",void 0);var Go,Wo=e.ccclass,qo=e.property,Zo=(zo=Wo("UICoins"),ko=qo(c),zo(((Uo=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,Ot(e,"nodeIcon",Ho,Lt(e)),e.labelMain=null,e.showCoins={value:0},e.tweenMain=null,e.tweenNodeCoin=null,e}Nt(e,t);var i=e.prototype;return i.onEnable=function(){null==this.labelMain&&(this.labelMain=this.getComponent(y)),Ut.on(ve.EVENT_NAME.USERCOIN_UPDATED,this.updateData,this),e.uistacks.push(this)},i.onDisable=function(){var t,i=this;Ut.off(ve.EVENT_NAME.USERCOIN_UPDATED,this.updateData,this),e.uistacks=e.uistacks.filter((function(t){return t!=i})),null==(t=this.tweenMain)||t.stop(),this.tweenMain=null},i.updateData=function(){var t,e=this,i=Do.instance.coins;null==(t=this.tweenMain)||t.stop(),this.tweenMain=v(this.showCoins).to(.35,{value:i}).call((function(){var t;e.tweenMain=null,e.labelMain.string=Ne.formatNumber(Math.round(null==(t=e.showCoins)?void 0:t.value))})).start()},i.update=function(t){var e;if(null!=this.tweenMain){var i=Ne.formatNumber(Math.round(null==(e=this.showCoins)?void 0:e.value));this.labelMain.string!=i&&(this.labelMain.string=i)}},i.doSpriteEffect=function(){var t;this.nodeIcon&&(this.nodeIcon.scale=m(1.1,1.1),null==(t=this.tweenNodeCoin)||t.stop(),this.tweenNodeCoin=v(this.nodeIcon).to(.15,{scale:g.ONE},{easing:_.backIn}).start())},Ft(e,null,[{key:"position",get:function(){try{return this.uistacks[this.uistacks.length-1].node.worldPosition}catch(t){return new g(0,0,0)}}},{key:"iconPosition",get:function(){try{return this.uistacks[this.uistacks.length-1].nodeIcon.worldPosition}catch(t){return new g(0,0,0)}}},{key:"current",get:function(){try{return this.uistacks[this.uistacks.length-1]}catch(t){return null}}}]),e}(r)).uistacks=[],Ho=It((Bo=Uo).prototype,"nodeIcon",[ko],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Vo=Bo))||Vo);t._RF.pop(),t._RF.push({},"4bf9dim3D5ES4wXF3TDJfmM","UINumberLabel",void 0);var Yo,jo,Ko,Xo,Jo,Qo,$o,tr=(0,e.ccclass)("UINumberLabel")(Go=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).showValue={value:0},e.tweenMain=null,e.isReformatNumber=!1,e.decimalNumberCount=0,e.format="",e}Nt(e,t);var i=e.prototype;return i.getNumber=function(t){return this.isReformatNumber?Ne.formatNumber(this.showValue.value,this.decimalNumberCount,this.decimalNumberCount):Ne.toFixed(t,3)},i.getString=function(t){var e=this.getNumber(t);return this.format?this.format.replace("value",e):e},i.onDisable=function(){this.stop()},i.setNumber=function(t,e,i,n,o,r){var a,s=this;if(void 0===e&&(e=.35),void 0===i&&(i=!0),void 0===n&&(n=null),void 0===o&&(o=""),void 0===r&&(r=2),this.isReformatNumber=i,this.decimalNumberCount=r,this.format=o,null==(a=this.tweenMain)||a.stop(),e<=0)return this.showValue.value=e,void(this.string=this.getString(this.showValue.value));this.tweenMain=v(this.showValue).to(e,{value:t}).call((function(){s.tweenMain=null,s.string=s.getString(s.showValue.value),null==n||n()})).start()},i.stop=function(){var t;null==(t=this.tweenMain)||t.stop(),this.tweenMain=null},i.update=function(t){if(null!=this.tweenMain){var e=this.getString(this.showValue.value);this.string!=e&&(this.string=e)}},e}(y))||Go;t._RF.pop(),t._RF.push({},"64605hgPdJFkLm/270UV/jD","UICountdownNumber",void 0);var er,ir,nr,or,rr,ar=e.ccclass,sr=e.property;Yo=ar("UICountdownNumber"),jo=sr(f),Ko=sr(U),Yo((Qo=It((Jo=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,Ot(e,"sprtProgress",Qo,Lt(e)),Ot(e,"isProgressSpriteRevert",$o,Lt(e)),e.startValue=0,e.onRoundNumberCallback=null,e.lastRoundNumberCall=0,e}Nt(e,t);var i=e.prototype;return i.startCountdownFrom=function(t,e,i,n){void 0===e&&(e=null),void 0===i&&(i=""),void 0===n&&(n=null),this.startValue=t,this.onRoundNumberCallback=n,this.lastRoundNumberCall=0,this.showValue.value=t,this.setNumber(0,t,!0,e,i,0)},i.update=function(e){if(t.prototype.update.call(this,e),this.sprtProgress){var i=n.clamp(this.showValue.value/this.startValue,0,1);this.isProgressSpriteRevert&&(i=1-i),this.sprtProgress.fillRange=i}this.checkCallRoundNumber()},i.checkCallRoundNumber=function(){var t,e=Math.round(this.showValue.value);e!=this.lastRoundNumberCall&&(this.lastRoundNumberCall=e,null==(t=this.onRoundNumberCallback)||t.call(this,this.lastRoundNumberCall))},e}(tr)).prototype,"sprtProgress",[jo],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),$o=It(Jo.prototype,"isProgressSpriteRevert",[Ko],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Xo=Jo));t._RF.pop(),t._RF.push({},"0c915T7nLRFS43XBQpOPZlf","UIFastToggle",void 0);var lr,cr,ur,hr,pr,dr=e.ccclass,fr=e.property;er=dr("UIFastToggle"),ir=fr([c]),er((rr=It((or=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,Ot(e,"nodes",rr,Lt(e)),e}Nt(e,t);var i=e.prototype;return i.onLoad=function(){var t=new F;t.target=this.node,t.component="UIFastToggle",t.handler="updateNodesState",this.checkEvents.push(t),this.updateNodesState()},i.updateNodesState=function(){var t=this;this.nodes.forEach((function(e){return e.active=t.isChecked}))},e}(k)).prototype,"nodes",[ir],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),nr=or));t._RF.pop(),t._RF.push({},"4a84fL/AtlOh5ZYcK3uvEF8","UIName",void 0);var gr,mr,vr,yr,br,_r,Sr,wr,Tr,Cr,Er,Ar=e.ccclass,Pr=e.property,Mr=(lr=Ar("UIName"),cr=Pr(G),lr((pr=It((hr=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,Ot(e,"limitChar",pr,Lt(e)),e}return Nt(e,t),e.prototype.setName=function(t){var e=Math.round((this.limitChar-3)/2);this.string=Ne.truncateString(t,this.limitChar,e,e)},e}(y)).prototype,"limitChar",[cr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 15}}),ur=hr))||ur);t._RF.pop(),t._RF.push({},"5a859+X7W5OBYSIMvu0QJVW","UIItemUser",void 0);var Ir,Nr,Or,Lr,Rr,xr,Fr,Dr,zr,kr,Vr,Br=e.ccclass,Hr=e.property;gr=Br("UIItemUser"),mr=Hr({type:Mr,group:{name:"User Info",id:"1"}}),vr=Hr({type:Mr,group:{name:"User Info",id:"1"}}),yr=Hr({type:Zo,group:{name:"User Info",id:"1"}}),br=Hr({type:Ce,group:{name:"User Info",id:"1"}}),gr((wr=It((Sr=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,Ot(e,"lbUserName",wr,Lt(e)),Ot(e,"lbUserUserName",Tr,Lt(e)),Ot(e,"lbCoins",Cr,Lt(e)),Ot(e,"avatarUser",Er,Lt(e)),e}Nt(e,t);var i=e.prototype;return i.setUserData=function(t){var e,i,n,o,r,a,s,l,c,u;if(!t)return null==(l=this.lbUserName)||l.setName(""),null==(c=this.lbUserUserName)||c.setName(""),void(null==(u=this.avatarUser)||u.setData(null,null));null==(e=this.lbUserName)||e.setName((null!=(i=null==t?void 0:t.first_name)?i:"")+" "+(null!=(n=null==t?void 0:t.last_name)?n:"")),null==(o=this.lbUserUserName)||o.setName("@"+(null!=(r=null==t?void 0:t.username)?r:"")),null==(a=this.lbCoins)||a.updateData(),null==(s=this.avatarUser)||s.setData(t.photo_url,"")},i.setFechtingData=function(t){void 0===t&&(t="loading..."),this.lbUserName&&this.lbUserName.setName(t),this.lbUserUserName&&this.lbUserUserName.setName(t),this.avatarUser&&this.avatarUser.setData("","")},i.setNullAvatar=function(){this.avatarUser&&this.avatarUser.clear()},e}(r)).prototype,"lbUserName",[mr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Tr=It(Sr.prototype,"lbUserUserName",[vr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Cr=It(Sr.prototype,"lbCoins",[yr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Er=It(Sr.prototype,"avatarUser",[br],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_r=Sr));t._RF.pop(),t._RF.push({},"63144Dta6NLH4Ot5UmPJL47","UINumberByImages",void 0);var Ur,Gr=e.ccclass,Wr=e.property;Ir=Gr("UINumberByImages"),Nr=Wr([i]),Or=Wr([f]),Lr=Wr([f]),Rr=Wr(c),Ir((Dr=It((Fr=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,Ot(e,"spriteframeNumbers",Dr,Lt(e)),Ot(e,"spriteNumbers",zr,Lt(e)),Ot(e,"spriteDecimals",kr,Lt(e)),Ot(e,"nodeDot",Vr,Lt(e)),e.charMap=new Map,e}Nt(e,t);var i=e.prototype;return i.onLoad=function(){var t=this;this.spriteframeNumbers.forEach((function(e){return t.charMap.set(e.name,e)}))},i.getChar=function(t){return this.charMap.get(t)},i.setNumber=function(t){this.setNumberString(Ne.toFixed(t,5))},i.setNumberString=function(t){var e,i,n=t.split(".");this.nodeDot.active=n.length>1;for(var o=null!=(e=n[0])?e:"",r=0;r<this.spriteNumbers.length;r++){var a=o[r];this.spriteNumbers[r].node.active=!!a,a&&(this.spriteNumbers[r].spriteFrame=this.getChar(a))}for(var s=null!=(i=n[1])?i:"",l=0;l<this.spriteDecimals.length;l++){var c=s[l];this.spriteDecimals[l].node.active=!!c,c&&(this.spriteDecimals[l].spriteFrame=this.getChar(c))}},e}(r)).prototype,"spriteframeNumbers",[Nr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),zr=It(Fr.prototype,"spriteNumbers",[Or],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),kr=It(Fr.prototype,"spriteDecimals",[Lr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Vr=It(Fr.prototype,"nodeDot",[Rr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),xr=Fr));t._RF.pop(),t._RF.push({},"3d366e1pk5BN6GTDW/fi9nd","UINumberLabelComponent",void 0);var qr,Zr,Yr,jr,Kr=e.ccclass,Xr=(e.property,e.requireComponent);Kr("UINumberLabelComponent")(Ur=Xr(y)(Ur=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).showValue={value:0},e.tweenMain=null,e.isReformatNumber=!1,e.decimalNumberCount=0,e.format="",e.label=null,e}Nt(e,t);var i=e.prototype;return i.onLoad=function(){this.label=this.node.getComponent(y)},i.getNumber=function(t){return this.isReformatNumber?Ne.formatNumber(this.showValue.value,this.decimalNumberCount,this.decimalNumberCount):Ne.toFixed(t,3)},i.getString=function(t){var e=this.getNumber(t);return this.format?this.format.replace("value",e):e},i.onDisable=function(){this.stop()},i.setNumber=function(t,e,i,n,o,r){var a,s=this;if(void 0===e&&(e=.35),void 0===i&&(i=!0),void 0===n&&(n=null),void 0===o&&(o=""),void 0===r&&(r=2),this.isReformatNumber=i,this.decimalNumberCount=r,this.format=o,null==(a=this.tweenMain)||a.stop(),e<=0)return this.showValue.value=e,void(this.label.string=this.getString(this.showValue.value));this.tweenMain=v(this.showValue).to(e,{value:t}).call((function(){s.tweenMain=null,s.label.string=s.getString(s.showValue.value),null==n||n()})).start()},i.stop=function(){var t;null==(t=this.tweenMain)||t.stop(),this.tweenMain=null},i.update=function(t){if(null!=this.tweenMain){var e=this.getString(this.showValue.value);this.label.string!=e&&(this.label.string=e)}},e}(r))||Ur);t._RF.pop(),t._RF.push({},"35e18W5KnNNt7BMewSFb2bH","UIScaler",void 0);var Jr,Qr,$r,ta,ea,ia,na,oa=e.ccclass,ra=e.property;oa("UIScaler")((Yr=It((Zr=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,Ot(e,"maxValue",Yr,Lt(e)),Ot(e,"minValue",jr,Lt(e)),e}return Nt(e,t),e.prototype.onLoad=function(){var t=W(1080,1920),e=t.x/t.y,i=q.windowSize.width/q.windowSize.height,o=n.clamp(i/e,this.minValue,this.maxValue);this.node.setScale(m(o,o,o))},e}(r)).prototype,"maxValue",[ra],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),jr=It(Zr.prototype,"minValue",[ra],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),qr=Zr));t._RF.pop(),t._RF.push({},"30045XZ1HVFj77RL4VxNUVU","UIScreenScaler",void 0);var aa,sa,la,ca,ua,ha,pa,da,fa,ga=e.ccclass,ma=e.property;Jr=ga("UIScreenScaler"),Qr=ma(c),Jr((ea=It((ta=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,Ot(e,"targetNode",ea,Lt(e)),Ot(e,"designWidth",ia,Lt(e)),Ot(e,"designHeight",na,Lt(e)),e.widget=null,e.transform=null,e}Nt(e,t);var i=e.prototype;return i.onLoad=function(){this.targetNode||(this.targetNode=this.node),this.widget=this.targetNode.getComponent(Z),this.transform=this.targetNode.getComponent(B),Y.on("design-resolution-changed",this.onScreenResize,this),Y.on("canvas-resize",this.onScreenResize,this),this.onScreenResize()},i.onDestroy=function(){Y.off("design-resolution-changed",this.onScreenResize,this),Y.off("canvas-resize",this.onScreenResize,this)},i.onScreenResize=function(){var t=Y.getVisibleSize();if(S.platform===S.Platform.MOBILE_BROWSER)this.widget.isAlignLeft=!0,this.widget.isAlignRight=!0,this.widget.isAlignTop=!0,this.widget.isAlignBottom=!0,this.widget.left=0,this.widget.right=0,this.widget.top=0,this.widget.bottom=0;else{var e=9/16;if(t.width/t.height>e){var i=t.height*e,n=(t.width-i)/2;this.widget.isAlignLeft=!0,this.widget.isAlignRight=!0,this.widget.isAlignTop=!0,this.widget.isAlignBottom=!0,this.widget.left=n,this.widget.right=n,this.widget.top=0,this.widget.bottom=0}else this.widget.isAlignLeft=!0,this.widget.isAlignRight=!0,this.widget.isAlignTop=!0,this.widget.isAlignBottom=!0,this.widget.left=0,this.widget.right=0,this.widget.top=0,this.widget.bottom=0}this.widget.updateAlignment()},e}(r)).prototype,"targetNode",[Qr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ia=It(ta.prototype,"designWidth",[ma],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1080}}),na=It(ta.prototype,"designHeight",[ma],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1920}}),$r=ta));t._RF.pop(),t._RF.push({},"23aff/dfqZMeJFuAqFaQ5p2","UISlider",void 0);var va,ya,ba,_a,Sa,wa,Ta,Ca=e.ccclass,Ea=e.property,Aa=(aa=Ca("UISlider"),sa=Ea(f),la=Ea([c]),ca=Ea([c]),aa((pa=It((ha=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,Ot(e,"spriteFiller",pa,Lt(e)),Ot(e,"objectsOff",da,Lt(e)),Ot(e,"objectsOn",fa,Lt(e)),e}Nt(e,t);var i=e.prototype;return i.start=function(){this.node.on("slide",this.onSliderChange,this),this.onSliderChange()},i.onSliderChange=function(){var t=this.progress;this.updateSpriteFiller(t),this.updateObjects(t)},i.updateSpriteFiller=function(t){this.spriteFiller&&this.spriteFiller.node.setScale(t,1,1)},i.updateObjects=function(t){for(var e,i=0===t,n=Dt(this.objectsOff);!(e=n()).done;){e.value.active=i}for(var o,r=Dt(this.objectsOn);!(o=r()).done;){o.value.active=!i}},e}(j)).prototype,"spriteFiller",[sa],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),da=It(ha.prototype,"objectsOff",[la],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),fa=It(ha.prototype,"objectsOn",[ca],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),ua=ha))||ua);t._RF.pop(),t._RF.push({},"92959RjXUxD97yy1ukHjcyM","UISliderRectSize",void 0);var Pa,Ma,Ia,Na,Oa,La,Ra,xa,Fa,Da,za,ka,Va,Ba,Ha,Ua=e.ccclass,Ga=e.property;va=Ua("UISliderRectSize"),ya=Ga(B),ba=Ga(B),va((wa=It((Sa=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,Ot(e,"transSlider",wa,Lt(e)),Ot(e,"transMain",Ta,Lt(e)),e.originalWidth=0,e}Nt(e,t);var i=e.prototype;return i.start=function(){this.originalWidth=this.transSlider.width,t.prototype.start.call(this)},i.updateSpriteFiller=function(t){this.transMain.width=t*this.originalWidth},e}(Aa)).prototype,"transSlider",[ya],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ta=It(Sa.prototype,"transMain",[ba],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_a=Sa));t._RF.pop(),t._RF.push({},"59a6c9CvhtC0L3ZWOHqwOyc","UIToggleGroups",void 0);var Wa,qa,Za,Ya,ja,Ka,Xa,Ja,Qa,$a,ts,es,is,ns,os,rs=e.ccclass,as=e.property,ss=(Pa=rs("ToggleData"),Ma=as(k),Ia=as([Be]),Pa((La=It((Oa=function(){function t(){Ot(this,"toggle",La,this),Ot(this,"visibleViews",Ra,this)}return t.prototype.updateVisible=function(){var t=this;this.visibleViews.forEach((function(e){return null==e?void 0:e.setPanelVisible(t.toggle.isChecked,.25,!0)}))},t}()).prototype,"toggle",[Ma],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ra=It(Oa.prototype,"visibleViews",[Ia],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Na=Oa))||Na);xa=rs("UIToggleGroups"),Fa=as([ss]),Da=as(k),xa((Va=It((ka=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,Ot(e,"data",Va,Lt(e)),Ot(e,"default",Ba,Lt(e)),Ot(e,"isAllowOffAll",Ha,Lt(e)),e.activeToggle=null,e}Nt(e,t);var i=e.prototype;return i.onLoad=function(){this.init()},i.init=function(){var t=this;this.data.forEach((function(e){var i=new F;i.target=t.node,i.component="UIToggleGroups",i.handler="onToggleChanged",e.toggle.checkEvents.push(i)})),this.default&&(this.default.isChecked=!0,this.onToggleChanged(this.default))},i.onToggleChanged=function(t){this.isAllowOffAll,this.activeToggle!=t&&(t.isChecked&&(this.activeToggle=t,this.activeToggle.interactable=!1),ye.LOG&&console.log("onToggleChanged"+t),t.isChecked&&this.data.forEach((function(e){e.toggle!=t&&(e.toggle.isChecked=!1,e.toggle.interactable=!0),e.updateVisible()})))},i.updateToggles=function(){this.data.forEach((function(t){t.updateVisible()}))},e}(r)).prototype,"data",[Fa],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Ba=It(ka.prototype,"default",[Da],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ha=It(ka.prototype,"isAllowOffAll",[as],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),za=ka));t._RF.pop(),t._RF.push({},"e1a51NjaFRBkoSdI6zruA8N","UIViewDrawer",void 0);var ls,cs,us,hs,ps,ds=e.ccclass,fs=e.property,gs=function(t){return t[t.HORIZONTAL=0]="HORIZONTAL",t[t.VERTICAL=1]="VERTICAL",t}({});Wa=ds("UIViewDrawer"),qa=fs({type:L(Ue)}),Za=fs({type:L(gs)}),Ya=fs(g),ja=fs(c),Ka=fs([c]),Wa((Qa=It((Ja=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,Ot(e,"beginType",Qa,Lt(e)),Ot(e,"direction",$a,Lt(e)),Ot(e,"beginPosition",ts,Lt(e)),Ot(e,"drawerIndicator",es,Lt(e)),Ot(e,"nodeVisibles",is,Lt(e)),Ot(e,"hidePosX",ns,Lt(e)),Ot(e,"showPosX",os,Lt(e)),e.visibleIndex=-1,e}Nt(e,t);var i=e.prototype;return i.setPosition=function(t,e){switch(this.direction){case gs.HORIZONTAL:t.x=e;break;case gs.VERTICAL:t.y=e}return t},i.addPosition=function(t,e){switch(this.direction){case gs.HORIZONTAL:t.x+=e;break;case gs.VERTICAL:t.y+=e}return t},i.onLoad=function(){switch(this.beginType){case Ue.NONE:break;case Ue.HIDE:this.nodeVisibles.forEach((function(t){return t.active=!1}));var t=this.beginPosition.clone();this.setPosition(t,this.hidePosX),this.node.setPosition(t),this.drawerIndicator&&(this.drawerIndicator.angle=0),this.visibleIndex=0;break;case Ue.SHOW:this.node.setPosition(this.beginPosition),this.nodeVisibles.forEach((function(t){return t.active=!0})),this.drawerIndicator&&(this.drawerIndicator.angle=180),this.visibleIndex=1}},i.setDrawerVisible=function(t,e,i){var n=this;if(void 0===e&&(e=null),void 0===i&&(i=.2),this.visibleIndex!=(t?1:0)){this.visibleIndex=t?1:0,t&&this.nodeVisibles.forEach((function(t){return t.active=!0}));var o=this.node.position.clone();this.setPosition(o,t?this.showPosX:this.hidePosX),v(this.node).stop(),v(this.node).to(i,{position:o},{easing:_.quartOut}).call((function(){0==t&&n.nodeVisibles.forEach((function(t){return t.active=!1})),null==e||e()})).start();var r=t?180:0;this.drawerIndicator&&(v(this.drawerIndicator).stop(),v(this.drawerIndicator).to(i,{angle:r},{easing:_.backOut}).start())}},i.show=function(t,e){var i=this;void 0===e&&(e=null),this.setDrawerVisible(!0,(function(){i.shown(),null==e||e()})),ji.instance.playSound(ve.SOUND_FILES.SLIDE_IN)},i.doShow=function(){this.show(null)},i.doHide=function(){this.hide()},i.hide=function(t){var e=this;void 0===t&&(t=null),this.setDrawerVisible(!1,(function(){e.hided(),null==t||t()})),ji.instance.playSound(ve.SOUND_FILES.SLIDE_OUT)},i.shown=function(){},i.hided=function(){},i.onTouch_ShowHide=function(){1==this.visibleIndex?this.doHide():this.doShow()},Ft(e,[{key:"isShowing",get:function(){return 1==this.visibleIndex}}]),e}(r)).prototype,"beginType",[qa],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Ue.HIDE}}),$a=It(Ja.prototype,"direction",[Za],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return gs.HORIZONTAL}}),ts=It(Ja.prototype,"beginPosition",[Ya],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return m(0,0,0)}}),es=It(Ja.prototype,"drawerIndicator",[ja],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),is=It(Ja.prototype,"nodeVisibles",[Ka],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),ns=It(Ja.prototype,"hidePosX",[fs],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),os=It(Ja.prototype,"showPosX",[fs],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Xa=Ja));t._RF.pop(),t._RF.push({},"6cc02rpxS1ESpwuMymGkGQL","UserInteractHandler",void 0);var ms=e.ccclass,vs=e.property,ys=function(){this.type=He.NONE,this.data=null};ls=ms("TouchController"),cs=vs(c),ls((ps=It((hs=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,Ot(e,"listenerNode",ps,Lt(e)),e.listeners={},e.initialDistance=null,e.startTouchPos=null,e.isTouchMoveTrigger=!1,e.lastDragPos=null,e}Nt(e,t);var i=e.prototype;return i.onLoad=function(){this.initInteracting()},i.onDestroy=function(){},i.addListener=function(t,e){this.listeners[t]||(this.listeners[t]=[]),this.listeners[t].push(e)},i.removeListener=function(t,e){if(this.listeners[t]){var i=this.listeners[t].indexOf(e);i>-1&&this.listeners[t].splice(i,1)}},i.dispatchEvent=function(t){this.listeners[t.type]&&this.listeners[t.type].forEach((function(e){return e(t.data)}))},i.resetValues=function(){this.startTouchPos=null,this.initialDistance=null,this.lastDragPos=null},i.initInteracting=function(){var t=this;this.listenerNode.on(V.MOUSE_WHEEL,(function(e){var i=new ys;i.type=He.ZOOM,i.data=-e.getScrollY()/10,t.dispatchEvent(i)}),this),this.listenerNode.on(V.TOUCH_START,this.onTouchStart,this),this.listenerNode.on(V.TOUCH_MOVE,this.onTouchMove,this),this.listenerNode.on(V.TOUCH_END,this.onTouchEnd,this),this.listenerNode.on(V.TOUCH_CANCEL,this.onTouchEnd,this),this.listenerNode.on(V.MOUSE_ENTER,this.onHoverBackground,this)},i.onHoverBackground=function(t){var e=new ys;e.type=He.HOVER,this.dispatchEvent(e)},i.onTouchStart=function(t){2===t.getTouches().length&&(this.initialDistance=this.getDistanceBetweenTouches(t)),1===t.getTouches().length&&(this.startTouchPos=t.getTouches()[0].getLocation()),this.isTouchMoveTrigger=!1},i.onTouchMove=function(t){if(2===t.getTouches().length){var e=this.getDistanceBetweenTouches(t)-this.initialDistance,i=new ys;i.type=He.ZOOM;i.data=-.01*e,this.dispatchEvent(i),this.isTouchMoveTrigger=!0}else if(1===t.getTouches().length){var n=t.getTouches()[0].getLocation(),o=new ys;o.type=He.DRAG,o.data={start:null==this.lastDragPos?this.startTouchPos:this.lastDragPos,current:n},this.dispatchEvent(o),this.isTouchMoveTrigger=!0,this.lastDragPos=n.clone()}},i.onTouchEnd=function(t){if(t.getTouches().length<2&&(this.initialDistance=null,this.lastDragPos=null,0==this.isTouchMoveTrigger)){var e=new ys;e.type=He.TOUCH,e.data=this.startTouchPos,this.dispatchEvent(e)}if(0===t.getTouches().length&&this.startTouchPos){var i=t.getTouches()[0].getLocation();if(K.distance(i,this.startTouchPos)>100){var n=new ys;n.type=He.SWIPE,n.data={start:this.startTouchPos,end:i},this.dispatchEvent(n)}}var o=new ys;o.type=He.END_INTERACTED,this.dispatchEvent(o),this.startTouchPos=null},i.getDistanceBetweenTouches=function(t){var e=t.getTouches(),i=e[0].getLocation(),n=e[1].getLocation();return K.distance(i,n)},e}(r)).prototype,"listenerNode",[cs],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),us=hs));t._RF.pop(),t._RF.push({},"f34a2opKdlGHZC9qbc+L0O/","enum",void 0);var bs=function(t){return t[t.Vertical=0]="Vertical",t[t.Horizontal=1]="Horizontal",t}({}),_s=function(t){return t[t.Unrestricted=0]="Unrestricted",t[t.Elastic=1]="Elastic",t[t.Clamped=2]="Clamped",t}({}),Ss=function(t){return t[t.Start=0]="Start",t[t.End=1]="End",t}({}),ws=function(t){return t[t.Auto=0]="Auto",t[t.Header=1]="Header",t[t.Footer=2]="Footer",t[t.Center=3]="Center",t}({}),Ts=function(t){return t[t.Lowest=0]="Lowest",t[t.Medium=1]="Medium",t[t.Highest=2]="Highest",t}({}),Cs=function(t){return t[t.Auto=0]="Auto",t[t.Wrap=1]="Wrap",t[t.Nowrap=2]="Nowrap",t}({}),Es=function(t){return t[t.Auto=0]="Auto",t[t.AlwaysAllow=1]="AlwaysAllow",t[t.Disabled=2]="Disabled",t}({}),As=function(t){return t[t.Header=0]="Header",t[t.Footer=1]="Footer",t}({}),Ps=function(t){return t[t.UpperLeft=0]="UpperLeft",t[t.UpperCenter=1]="UpperCenter",t[t.UpperRight=2]="UpperRight",t[t.MiddleLeft=3]="MiddleLeft",t[t.MiddleCenter=4]="MiddleCenter",t[t.MiddleRight=5]="MiddleRight",t[t.LowerLeft=6]="LowerLeft",t[t.LowerCenter=7]="LowerCenter",t[t.LowerRight=8]="LowerRight",t}({}),Ms=function(t){return t[t.Up=0]="Up",t[t.Down=1]="Down",t[t.Left=2]="Left",t[t.Right=3]="Right",t[t.None=4]="None",t}({}),Is=function(t){return t[t.Top_To_Bottom=0]="Top_To_Bottom",t[t.Bottom_To_Top=1]="Bottom_To_Top",t[t.Left_To_Right=2]="Left_To_Right",t[t.Right_To_Left=3]="Right_To_Left",t}({}),Ns=function(t){return t[t.Both=0]="Both",t[t.Header=1]="Header",t[t.Footer=2]="Footer",t}({}),Os=function(t){return t[t.Auto=0]="Auto",t[t.Header=1]="Header",t[t.Footer=2]="Footer",t}({}),Ls=function(t){return t[t.Normal=0]="Normal",t[t.Button=1]="Button",t}({}),Rs=function(t){return t[t.None=0]="None",t[t.ColorTint=1]="ColorTint",t[t.SpriteSwap=2]="SpriteSwap",t[t.Scale=3]="Scale",t}({}),xs=function(t){return t.IDLE="IDLE",t.PULL="PULL",t.WAIT="WAIT",t.RELEASE="RELEASE",t}({}),Fs=function(t){return t.CREATED="ADAPTER:HOLDER:CREATED",t.VISIBLE="ADAPTER:HOLDER:VISIBLE",t.DISABLE="ADAPTER:HOLDER:DISABLE",t}({}),Ds=function(t){return t.VISIBLE="ADAPTER:VIEW:VISIBLE",t.DISABLE="ADAPTER::VIEW:DISABLE",t}({});L(bs),L(_s),L(Ss),L(ws),L(As),L(Is),L(Ps),L(Es),L(Ls),L(Rs),t._RF.pop(),t._RF.push({},"745449vUL5G0oNZ/T6pUfiN","Group",void 0);var zs=function(){function t(t){this._adapter=void 0,this._index=-1,this._models=[],this._size={x:0,y:0},this._oldSize={x:0,y:0},this._anchorPoint={x:.5,y:.5},this._position={x:0,y:0},this._oldPosition={x:0,y:0},this._totalMinSize={x:0,y:0},this._totalPreferredSize={x:0,y:0},this._totalFlexibleSize={x:0,y:0},this._isFixed=!1,this._fixedIndex=-1,this._adapter=t,this.internal_reset()}var e=t.prototype;return e.findModelIndex=function(t){return this.models.findIndex((function(e){return e.index==t}))},e.internal_reset=function(){this._models=[],this._size={x:0,y:0},this._oldSize={x:0,y:0},this._anchorPoint={x:.5,y:.5},this._position={x:0,y:0},this._oldPosition={x:0,y:0},this._totalMinSize={x:0,y:0},this._totalPreferredSize={x:0,y:0},this._totalFlexibleSize={x:0,y:0},this._isFixed=!1,this._fixedIndex=-1,this._setAnchorPoint()},e.internal_setPosition=function(t){var e=this.adapter.mainAxis;this.oldPosition[e]=this.position[e],this.position[e]=t},e.internal_setIndex=function(t){this._index=t},e.internal_insert=function(t,e,i){e.internal_reset();var n=this.models;if(this.internal_reset(),this._fixedIndex=t.fixedIndex,!i)for(var o=0;o<n.length;o++){var r=n[o];if(!(r.index<t.modelIndex))break;if(!this._insertHandler(r,e))return t.modelIndex=r.index,t.fixedIndex=this.isFixed?this.index:t.fixedIndex,!0}for(var a=t.modelIndex;a<this.adapter.modelManager.length;a++){var s=this.adapter.modelManager.get(a);if(!this._insertHandler(s,e))return t.modelIndex=s.index,t.fixedIndex=this.isFixed?this.index:t.fixedIndex,s.index}return!1},e.internal_includes=function(t){for(var e,i=this,n=function(){var e=t[o];if(-1!=i.models.findIndex((function(t){return t.data==e})))return{v:!0}},o=0;o<t.length;o++)if(e=n())return e.v;return!1},e._insertHandler=function(t,e){if(e.internal_isWrap(t,this))return e.internal_reset(),!1;e.internal_push(t),t.element.fixed&&(this._isFixed=!0,this._fixedIndex=-1);var i=this.adapter.mainAxis,n=this.adapter.crossAxis;return(!t.element.ignoreLayout||t.element.ignoreLayout&&t.element.placeholder)&&(this.size[i]=Math.max(this.size[i],t.size[i]*t.scale[i])),this.size[n]=this.adapter.crossAxisSize,this.oldSize[i]=this.size[i],this.oldSize[n]=this.size[n],this.models.push(t),!0},e._setAnchorPoint=function(){switch(this.adapter.viewManager.stretchDirection){case ws.Center:this.anchorPoint[this.adapter.mainAxis]=.5;break;case ws.Header:this.anchorPoint[this.adapter.mainAxis]=1-this.adapter.mainAxisAnchorPoint;break;default:this.anchorPoint[this.adapter.mainAxis]=this.adapter.mainAxisAnchorPoint}},Ft(t,[{key:"adapter",get:function(){return this._adapter}},{key:"index",get:function(){return this._index}},{key:"models",get:function(){return this._models}},{key:"size",get:function(){return this._size}},{key:"oldSize",get:function(){return this._oldSize}},{key:"anchorPoint",get:function(){return this._anchorPoint}},{key:"position",get:function(){return this._position}},{key:"oldPosition",get:function(){return this._oldPosition}},{key:"totalMinSize",get:function(){return this._totalMinSize}},{key:"totalPreferredSize",get:function(){return this._totalPreferredSize}},{key:"totalFlexibleSize",get:function(){return this._totalFlexibleSize}},{key:"isFixed",get:function(){return this._isFixed}},{key:"fixedIndex",get:function(){return this._fixedIndex}}]),t}();t._RF.pop(),t._RF.push({},"9951cDVtORNYrBREEqRMzYS","helper",void 0);var ks,Vs=function(){function t(){}return t.smoothStep=function(t,e,i){return e*(i=-2*(i=this.clamp01(i))*i*i+3*i*i)+t*(1-i)},t.smoothDamp=function(t,e,i,n,o,r){var a=2/(n=Math.max(1e-4,n)),s=a*r,l=1/(1+s+.48*s*s+.235*s*s*s),c=t-e,u=e,h=o*n,p=(i+a*(c=this.clamp(c,0-h,h)))*r;i=(i-a*p)*l;var d=(e=t-c)+(c+p)*l;return u-t>0==d>u&&(i=((d=u)-u)/r),{velocity:i,position:d}},t.clamp01=function(t){return this.clamp(t,0,1)},t.clamp=function(t,e,i){return void 0===e&&(e=0),void 0===i&&(i=1),Math.min(Math.max(t,e),i)},t.sign=function(t){return t>=0?1:-1},t.lerp=function(t,e,i){return t+(e-t)*this.clamp01(i)},t.approximately=function(t,e){return Math.abs(e-t)<Math.max(1e-4*Math.max(Math.abs(t),Math.abs(e)),8*this.Epsilon)},t.round=function(t,e){return Math.round(t*Math.pow(10,e))/Math.pow(10,e)},t.pingpang=function(t){var e=t;e=Math.abs(t);var i=Math.trunc(e);return i%2==0?e-=i:e=1-(e-i),e},t.isNumber=function(t){return"number"==typeof t&&!isNaN(t)},t.progress=function(t,e,i,n){return t+(e-t)*n},t.getGuid=function(){var t=(new Date).getTime();return window.performance&&"function"==typeof window.performance.now&&(t+=performance.now()),"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var i=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"==e?i:3&i|8).toString(16)}))},t}();Vs.Epsilon=1401298e-51,Vs.Infinity=1/0,t._RF.pop(),t._RF.push({},"2be49b5ffhLSZVXKWyATSqt","Manager",void 0);var Bs,Hs,Us=e.ccclass,Gs=(e.property,Us("Manager")(ks=function(){function t(){this._inited=!1,this._eventMap=new Map,this._adapter=null}var e=t.prototype;return e.internal_create=function(t){this._adapter=t},e.internal_init=function(){this._inited||(this._inited=!0,this.onInit())},e.on=function(t,e,i,n){void 0===n&&(n=!1),this._eventMap.has(t)||this._eventMap.set(t,[]);var o=this._eventMap.get(t);null!=o&&o.find((function(t){return t.target==i&&t.callback==e}))||o.push({callback:e,target:i,once:n})},e.off=function(t,e,i){if(this._eventMap.has(t)){var n=this._eventMap.get(t),o=null==n?void 0:n.findIndex((function(t){return t.callback==e&&t.target==i}));-1!=o&&n.splice(o,1)}},e.emit=function(t){if(this._eventMap.has(t)){for(var e=this._eventMap.get(t),i=arguments.length,n=new Array(i>1?i-1:0),o=1;o<i;o++)n[o-1]=arguments[o];for(var r=0;r<e.length;r++){var a,s=e[r];(a=s.callback).call.apply(a,[s.target].concat(n)),s.once&&(e.splice(r,1),r--)}}},Ft(t,[{key:"adapter",get:function(){return this._adapter}}]),t}())||ks);t._RF.pop(),t._RF.push({},"36ea76OAA9IiJKehmGOQ6xW","ModelManager",void 0);var Ws,qs=e.ccclass,Zs=(e.property,function(t){return t[t.ON_CLEAR=0]="ON_CLEAR",t[t.ON_INSERT=1]="ON_INSERT",t[t.ON_REMOVE=2]="ON_REMOVE",t[t.ON_MOVE=3]="ON_MOVE",t[t.ON_UPDATE=4]="ON_UPDATE",t[t.ON_CHANGE_BEFORE=5]="ON_CHANGE_BEFORE",t}(Zs||{})),Ys=qs("ModelManager")(((Hs=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this)._modelList=[],e._length=0,e}Nt(e,t);var i=e.prototype;return i.onInit=function(){},i.insert=function(){var t=Rt(xt().mark((function t(e,i){var n;return xt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:void 0===i&&(i=this.length),n=this._toArray(e),i=Vs.clamp(i,0,this.length),this.emit(Zs.ON_CHANGE_BEFORE),this._insertHandler(n,i),this._length=this._modelList.length,n.length>0&&this.emit(Zs.ON_INSERT,i);case 7:case"end":return t.stop()}}),t,this)})));return function(e,i){return t.apply(this,arguments)}}(),i._insertHandler=function(t,e){var i=this,n=e;this._length=this._modelList.length;for(var o=[],r=function(t,e){return(p=i._getNewModel(t)).index=e,i._modelList.push(p),p},a=function(t){var e=i.get(n);if(e)o.push(i._copyModel(e,{})),e.data=t,e.index=n,i._initModel(e);else{var a=r(t,n);i._initModel(a)}n++},s=0,l=t.length;s<l;s++)a(t[s]);for(var c=0;c<o.length;c++){var u=o[c],h=n+c;if(this.get(h)){var p=this.get(h);o.push(this._copyModel(p,{})),this._copyModel(u,p)}else{var d=r(u.data,h);this._copyModel(u,d)}}},i.remove=function(t,e){if(void 0===e&&(e=1),0!=e&&!(t<0||t>=this.length)){var i=this.length;this.emit(Zs.ON_CHANGE_BEFORE);for(var n=t;n<this.length;n++){var o=this.get(n),r=this.get(n+e);if(!r){i=n;break}this._copyModel(r,o),o.index=n}this._modelList.splice(i,this.length),this._length=this._modelList.length,this.emit(Zs.ON_REMOVE,t)}},i.move=function(t,e,i){var n=this;if(!(t<0||e<=0)){this.emit(Zs.ON_CHANGE_BEFORE);var o=this._modelList.map((function(t){return n._copyModel(t,{})})),r=o.splice(t,e);o.splice.apply(o,[i,0].concat(r));for(var a=0;a<o.length;a++)this._copyModel(o[a],this._modelList[a]);var s=Math.min(t,i);this.emit(Zs.ON_MOVE,s)}},i.update=function(){this.emit(Zs.ON_UPDATE)},i.clear=function(){this._modelList.length=0,this._length=0,this.emit(Zs.ON_CLEAR)},i.has=function(t){return!!this._modelList[t]},i.get=function(t){return isNaN(t)?null:this._modelList[t]},i.slice=function(t,e){return 0==this.length?[]:this._modelList.slice(t,e)},i._toArray=function(t){return t?t instanceof Array?t:[t]:[]},i._getNewModel=function(t){return{data:t,index:-1,code:null,size:{x:0,y:0},layoutSize:{x:0,y:0},scale:{x:0,y:0},position:{x:0,y:0},anchorPoint:{x:0,y:0},element:{wrapBeforeMode:Cs.Wrap,wrapAfterMode:Cs.Nowrap,ignoreLayout:!1,placeholder:!1,minSize:{x:0,y:0},preferredSize:{x:0,y:0},flexibleSize:{x:0,y:0},layer:Ts.Lowest,fixed:!1,fixedOffset:0,fixedSpacing:null,update:function(){}},isValid:!0,update:function(){}}},i._initModel=function(t){var e=this.adapter.getPrefab(t.data);if(!e)throw Error("预制体不能为空");if(e instanceof c){var i=e.getComponent(B);t.code=e.uuid,t.size={x:i.width,y:i.height},t.scale={x:i.node.scale.x,y:i.node.scale.y},t.anchorPoint={x:i.anchorPoint.x,y:i.anchorPoint.y}}else{var n=e.data.getComponent(B);t.code=e.data._prefab.fileId,t.size={x:n.width,y:n.height},t.scale={x:n.node.scale.x,y:n.node.scale.y},t.anchorPoint={x:n.anchorPoint.x,y:n.anchorPoint.y}}t.layoutSize={x:0,y:0},t.position={x:0,y:0},t.element={wrapBeforeMode:Cs.Wrap,wrapAfterMode:Cs.Nowrap,ignoreLayout:!1,placeholder:!1,minSize:{x:0,y:0},preferredSize:{x:0,y:0},flexibleSize:{x:0,y:0},layer:Ts.Lowest,fixed:!1,fixedOffset:0,fixedSpacing:null,update:function(){}},this.adapter.initElement(t.element,t.data)},i._copyModel=function(t,e){t.element.update=function(){};return function t(e,i){for(var n in e){var o=e[n];"data"!=n?"index"!=n&&(null!=o&&"object"==typeof o?(i[n]={},t(o,i[n])):i[n]=o):i[n]=o}}(t,e),e},Ft(e,[{key:"length",get:function(){return this._length}},{key:"modelList",get:function(){return this._modelList}}]),e}(Gs)).Event=Zs,Bs=Hs))||Bs;t._RF.pop(),t._RF.push({},"e143cqYQS9Lga09ceG48Qky","Holder",void 0);var js=e.ccclass,Ks=(e.property,js("Holder")(Ws=function(){function t(t,e,i){this._node=void 0,this._transform=void 0,this._code=void 0,this._adapter=void 0,this._model=void 0,this._view=void 0,this._fixedIndex=-1,this._oldData=null,this._oldElement=null,this._isCallCreated=!1,this._isLayout=!1,this._node=t,this._code=e,this._adapter=i,this._transform=this.node.getComponent(B)}var e=t.prototype;return e.internal_visible=function(t,e,i){var n=this;this._view=t,this._model=e,this._oldElement=Object.assign({},e.element),this._model.element.update=this._updateElement.bind(this),this._oldData=this.data,i&&(this.node.active=!0,this._isCallCreated||(this._isCallCreated=!0,this.onCreated()),this.element.fixed&&(this._fixedIndex=this.view.group.models.findIndex((function(t){return t.index==n.model.index}))),this.transform.setContentSize(this.model.size.x,this.model.size.y),this.node.setScale(this.model.scale.x,this.model.scale.y),this._register(),this.onVisible(),this._model.update=this._updateHandler.bind(this))},e._updateElement=function(){this._oldElement.layer!=this.element.layer&&(this.node.parent=this.adapter.scrollManager.getLayerNode(this.element.layer),this._oldElement.layer=this.element.layer),(this._oldElement.wrapAfterMode!=this.element.wrapAfterMode||this._oldElement.wrapBeforeMode!=this.element.wrapBeforeMode||this._oldElement.ignoreLayout!=this.element.ignoreLayout||this.element.ignoreLayout&&this._oldElement.placeholder!=this.element.placeholder)&&(this.adapter.viewManager.internal_updateVisibleView(this.model.index),this._oldElement.wrapAfterMode=this.element.wrapAfterMode,this._oldElement.wrapBeforeMode=this.element.wrapBeforeMode,this._oldElement.ignoreLayout=this.element.ignoreLayout,this._oldElement.placeholder=this.element.placeholder)},e._updateHandler=function(){this._model.update=function(){},this.onVisible(),this._model.update=this._updateHandler.bind(this)},e.internal_disable=function(){this.adapter.scrollManager.internal_disableTouchTarget(this.node),this.onDisable(),this._unregister(),this._model.update=function(){},this._model.element.update=function(){},this._view=null,this._model=null,this._fixedIndex=-1,this._isLayout=!1,this._oldData=null,this.node.active=!1},e.internal_layout=function(){var t={x:this.model.size.x,y:this.model.size.y};this.adapter.layoutManager.isControlMainAxisSize&&(t[this.adapter.mainAxis]=this.model.layoutSize[this.adapter.mainAxis]),this.adapter.layoutManager.isControlCrossAxisSize&&(t[this.adapter.crossAxis]=this.model.layoutSize[this.adapter.crossAxis]),this._isLayout=!0,this.transform.setContentSize(t.x,t.y),this._isLayout=!1,this.node.setPosition(this.model.position.x,this.model.position.y)},e._register=function(){this.node.on(c.EventType.SIZE_CHANGED,this._onSizeChanged,this),this.node.on(c.EventType.TRANSFORM_CHANGED,this._onScaleChanged,this),this.node.on(c.EventType.ANCHOR_CHANGED,this._onAnchorPointChanged,this),this._adapter.modelManager.on(Ys.Event.ON_UPDATE,this._updateHandler,this)},e._unregister=function(){this.node.off(c.EventType.SIZE_CHANGED,this._onSizeChanged,this),this.node.off(c.EventType.TRANSFORM_CHANGED,this._onScaleChanged,this),this.node.off(c.EventType.ANCHOR_CHANGED,this._onAnchorPointChanged,this),this._adapter.modelManager.off(Ys.Event.ON_UPDATE,this._updateHandler,this)},e._onSizeChanged=function(){if(!this._isLayout){var t=Vs.approximately(this.model.size[this.adapter.mainAxis],this.transform.contentSize[this.adapter.mainAxis]),e=Vs.approximately(this.model.size[this.adapter.crossAxis],this.transform.contentSize[this.adapter.crossAxis]);this.model.size.x=this.transform.width,this.model.size.y=this.transform.height,t&&e||this.view.internal_holderChanged(t)}},e._onScaleChanged=function(t){if(t==c.TransformBit.SCALE&&(this.adapter.layoutManager.controlScaleWidth||this.adapter.layoutManager.controlScaleHeight)){var e=Vs.approximately(this.model.scale[this.adapter.mainAxis],this.node.scale[this.adapter.mainAxis]),i=Vs.approximately(this.model.scale[this.adapter.crossAxis],this.node.scale[this.adapter.crossAxis]);this.model.scale.x=this.node.scale.x,this.model.scale.y=this.node.scale.y,e&&i||this.view.internal_holderChanged(e)}},e._onAnchorPointChanged=function(){var t=Vs.approximately(this.model.anchorPoint[this.adapter.mainAxis],this.transform.anchorPoint[this.adapter.mainAxis]),e=Vs.approximately(this.model.anchorPoint[this.adapter.crossAxis],this.transform.anchorPoint[this.adapter.crossAxis]);this.model.anchorPoint.x=this.transform.anchorPoint.x,this.model.anchorPoint.y=this.transform.anchorPoint.y,t&&e||this.view.internal_holderChanged(t)},Ft(t,[{key:"node",get:function(){return this._node}},{key:"transform",get:function(){return this._transform}},{key:"code",get:function(){return this._code}},{key:"adapter",get:function(){return this._adapter}},{key:"model",get:function(){return this._model}},{key:"view",get:function(){return this._view}},{key:"data",get:function(){return this._model&&this._model.data}},{key:"fixedIndex",get:function(){return this._fixedIndex}},{key:"oldData",get:function(){return this._oldData}},{key:"element",get:function(){return this._model&&this._model.element}},{key:"index",get:function(){return this._model&&this._model.index}}]),t}())||Ws);t._RF.pop(),t._RF.push({},"a66bdQHmTxEUris3Jx+UGmB","debug",void 0);var Xs,Js,Qs,$s,tl,el,il,nl,ol,rl,al,sl,ll,cl,ul,hl,pl,dl,fl,gl,ml,vl,yl,bl,_l;new X(238,124,55,255),new X(88,175,64,50),new X(56,120,94,255);t._RF.pop(),t._RF.push({},"9a8caWSYQZLqr6N7OEAXSa7","LayoutManager",void 0);var Sl,wl=e.ccclass,Tl=e.property,Cl=function(t){return t[t.ON_LAYOUT_COMPLATED=0]="ON_LAYOUT_COMPLATED",t[t.ON_CHANGED_LAYOUT_STATE=1]="ON_CHANGED_LAYOUT_STATE",t}(Cl||{}),El=(Xs=wl("LayoutManager"),Js=Tl({type:Ps}),Qs=Tl({type:Ps,tooltip:"布局元素的对齐方式"}),$s=Tl({tooltip:"元素交叉轴布局的间距"}),tl=Tl({tooltip:"反转布局"}),el=Tl({tooltip:"延迟布局，开启后会统一在下一帧布局，建议开启"}),il=Tl({group:{id:"0",name:"forceExpand"},tooltip:"是否强制布局元素宽度扩展以填充额外的可用空间"}),nl=Tl({group:{id:"0",name:"forceExpand"},tooltip:"是否强制布局元素高度扩展以填充额外的可用空间"}),ol=Tl({group:{id:"0",name:"controlSize"},tooltip:"如果设置为 false，布局只会影响元素的位置，而不会影响宽度，在这种情况下你可以设置元素的宽度\n如果设置为 true，元素的宽度将由布局根据它们各自的 IElement.minSize、IElement.preferredSize、IElement.flexibleSize自动设置。如果元素的宽度应根据可用空间的大小而变化，应开启此功能。在这种情况下不能直接设置每个元素的宽度，但可以通过控制每个元素的IElement.minSize、IElement.preferredSize、IElement.flexibleSize来进行控制"}),rl=Tl({group:{id:"0",name:"controlSize"},tooltip:"如果设置为 false，布局只会影响元素的位置，而不会影响高度，在这种情况下你可以设置元素的高度\n如果设置为 true，元素的高度将由布局根据它们各自的 IElement.minSize、IElement.preferredSize、IElement.flexibleSize自动设置。如果元素的高度应根据可用空间的大小而变化，应开启此功能。在这种情况下不能直接设置每个元素的高度，但可以通过控制每个元素的IElement.minSize、IElement.preferredSize、IElement.flexibleSize来进行控制"}),al=Tl({group:{id:"0",name:"controlScale"},tooltip:"是否使用 x 缩放计算宽度"}),sl=Tl({group:{id:"0",name:"controlScale"},tooltip:"是否使用 y 缩放计算高度"}),Xs(((_l=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,Ot(e,"_childAlignment",ul,Lt(e)),Ot(e,"_spacing",hl,Lt(e)),Ot(e,"_reverseArrangement",pl,Lt(e)),Ot(e,"delayLayout",dl,Lt(e)),Ot(e,"_forceExpandWidth",fl,Lt(e)),Ot(e,"_forceExpandHeight",gl,Lt(e)),Ot(e,"_controlSizeWidth",ml,Lt(e)),Ot(e,"_controlSizeHeight",vl,Lt(e)),Ot(e,"_controlScaleWidth",yl,Lt(e)),Ot(e,"_controlScaleHeight",bl,Lt(e)),e._isDirty=!1,e._layoutQueue=[],e}Nt(e,t);var i=e.prototype;return i.onInit=function(){},i.layout=function(t){t&&(this.delayLayout?(this.unLayout(t.index),this._layoutQueue.push(t),this._isDirty=!0):(this._layoutHandler(t),this.emit(Cl.ON_LAYOUT_COMPLATED,[t.index])))},i.unLayout=function(t){-1!=(t=this._layoutQueue.findIndex((function(e){return e.index==t})))&&this._layoutQueue.splice(t,1)},i._layoutHandler=function(t){this._calcAlongAxis(t,bs.Horizontal,this.adapter.isHorizontal),this._setChildrenAlongAxis(t,bs.Horizontal,this.adapter.isHorizontal),this._calcAlongAxis(t,bs.Vertical,this.adapter.isHorizontal),this._setChildrenAlongAxis(t,bs.Vertical,this.adapter.isHorizontal)},i._calcAlongAxis=function(t,e,i){for(var n=e==bs.Horizontal?this.horizontal:this.vertical,o=this._getControlSize(e),r=this._getControlScale(e),a=this._getForceExpandSize(e),s=n,l=n,c=0,u=i!=(e==bs.Vertical),h=this._getLayoutList(t.models),p=0;p<h.length;p++){var d=h[p],f=this._getChildSizes(d,e,o,a),g=f.min,m=f.preferred,v=f.flexible;if(r){var y=d.scale[this._getAxis(e)];g*=y,m*=y,v*=y}u?(s=Math.max(g+n,s),l=Math.max(m+n,l),c=Math.max(v,c)):(s+=g+this.spacing,l+=m+this.spacing,c+=v)}!u&&h.length>0&&(s-=this.spacing,l-=this.spacing),l=Math.max(s,l),this._setLayoutInputForAxis(t,s,l,c,e)},i._getControlSize=function(t){return t==bs.Horizontal?this.controlSizeWidth:this.controlSizeHeight},i._getControlScale=function(t){return t==bs.Horizontal?this.controlScaleWidth:this.controlScaleHeight},i._getForceExpandSize=function(t){return t==bs.Horizontal?this.forceExpandWidth:this.forceExpandHeight},i._setChildrenAlongAxis=function(t,e,i){var n=t.size[this._getAxis(e)],o=this._getControlSize(e),r=this._getControlScale(e),a=this._getForceExpandSize(e),s=this._getAlignmentOnAxis(e),l=this._getLayoutList(t.models),c=i!=(e==bs.Vertical),u=this.reverseArrangement?l.length-1:0,h=this.reverseArrangement?0:l.length,p=this.reverseArrangement?-1:1,d=this._getAxis(e);if(c)for(var f=n-(e==bs.Horizontal?this.horizontal:this.vertical),g=u;this.reverseArrangement?g>=h:g<h;g+=p){var m=l[g],v=this._getChildSizes(m,e,o,a),y=v.min,b=v.preferred,_=v.flexible,S=r?m.scale[d]:1,w=Vs.clamp(f,y,_>0?n:b),T=this._getStartOffset(t,e,w*S);if(o)this._setChildAlongAxisWithScale(t,m,e,T,S,w);else{var C=(w-m.size[d])*s;C*=S,this._setChildAlongAxisWithScale(t,m,e,T+C,S)}}else{var E=e==bs.Horizontal?this.left:this.top,A=0,P=n-this._getTotalPreferredSize(t,e);P>0&&(0==this._getTotalFlexibleSize(t,e)?E=this._getStartOffset(t,e,this._getTotalPreferredSize(t,e)-(e==bs.Horizontal?this.horizontal:this.vertical)):this._getTotalFlexibleSize(t,e)>0&&(A=P/this._getTotalFlexibleSize(t,e)));var M=0;this._getTotalMinSize(t,e)!=this._getTotalPreferredSize(t,e)&&(M=Vs.clamp01((n-this._getTotalMinSize(t,e))/(this._getTotalPreferredSize(t,e)-this._getTotalMinSize(t,e))));for(g=u;this.reverseArrangement?g>=h:g<h;g+=p){var I=l[g],N=this._getChildSizes(I,e,o,a),O=(y=N.min,b=N.preferred,_=N.flexible,r?I.scale[d]:1),L=Vs.lerp(y,b,M);if(L+=_*A,o)this._setChildAlongAxisWithScale(t,I,e,E,O,L);else{C=(L-I.size[d])*s;this._setChildAlongAxisWithScale(t,I,e,E+C,O)}E+=L*O+this.spacing}}},i._setChildAlongAxisWithScale=function(t,e,i,n,o,r){if(null!=e){var a=this._getAxis(i),s=0;isNaN(r)?s=e.size[a]:(e.layoutSize[a]=r,s=r);var l={x:e.position.x,y:e.position.y},c=0;i==bs.Horizontal?(c=n+s*e.anchorPoint[a]*o,c-=t.size[a]*t.anchorPoint[a],c+=t.position[a]):(c=-n-s*(1-e.anchorPoint[a])*o,c+=t.size[a]*(1-t.anchorPoint[a]),c+=t.position[a]),l[a]=c,e.position=l}},i._getStartOffset=function(t,e,i){var n=i+(e==bs.Horizontal?this.horizontal:this.vertical),o=t.size[this._getAxis(e)]-n,r=this._getAlignmentOnAxis(e);return(e==bs.Horizontal?this.left:this.top)+o*r},i._setLayoutInputForAxis=function(t,e,i,n,o){var r=this._getAxis(o);t.totalMinSize[r]=e,t.totalPreferredSize[r]=i,t.totalFlexibleSize[r]=n},i._getAxis=function(t){return t==bs.Horizontal?"x":"y"},i._getMinSize=function(t,e){return t.minSize[this._getAxis(e)]},i._getPreferredSize=function(t,e){var i=this._getAxis(e);return Math.max(t.minSize[i],t.preferredSize[i])},i._getFlexibleSize=function(t,e){return t.flexibleSize[this._getAxis(e)]},i._getTotalMinSize=function(t,e){return t.totalMinSize[this._getAxis(e)]},i._getTotalPreferredSize=function(t,e){return t.totalPreferredSize[this._getAxis(e)]},i._getTotalFlexibleSize=function(t,e){return t.totalFlexibleSize[this._getAxis(e)]},i._getChildSizes=function(t,e,i,n){var o,r,a;return i?(o=this._getMinSize(t.element,e),r=this._getPreferredSize(t.element,e),a=this._getFlexibleSize(t.element,e)):(r=o=t.size[this._getAxis(e)],a=0),n&&(a=Math.max(a,1)),{min:o,preferred:r,flexible:a}},i._getAlignmentOnAxis=function(t){return t==bs.Horizontal?this.adapter.layoutManager.childAlignment%3*.5:.5*Math.floor(this.adapter.layoutManager.childAlignment/3)},i._getLayoutList=function(t){for(var e=[],i=0;i<t.length;i++){var n=t[i];n.element.ignoreLayout||e.push(n)}return e},i.internal_lateUpdate=function(t){if(this._isDirty){this._isDirty=!1;for(var e=[];this._layoutQueue.length>0;){var i=this._layoutQueue.shift();this._layoutHandler(i),e.push(i.index)}e.length>0&&this.emit(Cl.ON_LAYOUT_COMPLATED,e)}},Ft(e,[{key:"childAlignment",get:function(){return this._childAlignment},set:function(t){t!=this._childAlignment&&(this._childAlignment=t,this.emit(Cl.ON_CHANGED_LAYOUT_STATE))}},{key:"spacing",get:function(){return this._spacing},set:function(t){t!=this._spacing&&(this._spacing=t,this.emit(Cl.ON_CHANGED_LAYOUT_STATE))}},{key:"reverseArrangement",get:function(){return this._reverseArrangement},set:function(t){t!=this._reverseArrangement&&(this._reverseArrangement=t,this.emit(Cl.ON_CHANGED_LAYOUT_STATE))}},{key:"forceExpandWidth",get:function(){return this._forceExpandWidth},set:function(t){t!=this._forceExpandWidth&&(this._forceExpandWidth=t,this.emit(Cl.ON_CHANGED_LAYOUT_STATE))}},{key:"forceExpandHeight",get:function(){return this._forceExpandHeight},set:function(t){t!=this._forceExpandHeight&&(this._forceExpandHeight=t,this.emit(Cl.ON_CHANGED_LAYOUT_STATE))}},{key:"controlSizeWidth",get:function(){return this._controlSizeWidth},set:function(t){t!=this._controlSizeWidth&&(this._controlSizeWidth=t,this.emit(Cl.ON_CHANGED_LAYOUT_STATE))}},{key:"controlSizeHeight",get:function(){return this._controlSizeHeight},set:function(t){t!=this._controlSizeHeight&&(this._controlSizeHeight=t,this.emit(Cl.ON_CHANGED_LAYOUT_STATE))}},{key:"controlScaleWidth",get:function(){return this._controlScaleWidth},set:function(t){t!=this._controlScaleWidth&&(this._controlScaleWidth=t,this.emit(Cl.ON_CHANGED_LAYOUT_STATE))}},{key:"controlScaleHeight",get:function(){return this._controlScaleHeight},set:function(t){t!=this._controlScaleHeight&&(this._controlScaleHeight=t,this.emit(Cl.ON_CHANGED_LAYOUT_STATE))}},{key:"top",get:function(){return this.adapter.isVertical?0:this.adapter.viewManager.top}},{key:"bottom",get:function(){return this.adapter.isVertical?0:this.adapter.viewManager.bottom}},{key:"left",get:function(){return this.adapter.isHorizontal?0:this.adapter.viewManager.left}},{key:"right",get:function(){return this.adapter.isHorizontal?0:this.adapter.viewManager.right}},{key:"horizontal",get:function(){return this.left+this.right}},{key:"vertical",get:function(){return this.top+this.bottom}},{key:"isControlMainAxisSize",get:function(){return this.adapter.isHorizontal&&this.controlSizeWidth||this.adapter.isVertical&&this.controlSizeHeight}},{key:"isControlCrossAxisSize",get:function(){return this.adapter.isHorizontal&&this.controlSizeHeight||this.adapter.isVertical&&this.controlSizeWidth}},{key:"isControlCrossAxisScale",get:function(){return this.adapter.isHorizontal&&this.controlScaleHeight||this.adapter.isVertical&&this.controlScaleWidth}}]),e}(Gs)).Event=Cl,ul=It((cl=_l).prototype,"_childAlignment",[Js],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Ps.UpperLeft}}),It(cl.prototype,"childAlignment",[Qs],Object.getOwnPropertyDescriptor(cl.prototype,"childAlignment"),cl.prototype),hl=It(cl.prototype,"_spacing",[Tl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),It(cl.prototype,"spacing",[$s],Object.getOwnPropertyDescriptor(cl.prototype,"spacing"),cl.prototype),pl=It(cl.prototype,"_reverseArrangement",[Tl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),It(cl.prototype,"reverseArrangement",[tl],Object.getOwnPropertyDescriptor(cl.prototype,"reverseArrangement"),cl.prototype),dl=It(cl.prototype,"delayLayout",[el],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),fl=It(cl.prototype,"_forceExpandWidth",[Tl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),It(cl.prototype,"forceExpandWidth",[il],Object.getOwnPropertyDescriptor(cl.prototype,"forceExpandWidth"),cl.prototype),gl=It(cl.prototype,"_forceExpandHeight",[Tl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),It(cl.prototype,"forceExpandHeight",[nl],Object.getOwnPropertyDescriptor(cl.prototype,"forceExpandHeight"),cl.prototype),ml=It(cl.prototype,"_controlSizeWidth",[Tl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),It(cl.prototype,"controlSizeWidth",[ol],Object.getOwnPropertyDescriptor(cl.prototype,"controlSizeWidth"),cl.prototype),vl=It(cl.prototype,"_controlSizeHeight",[Tl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),It(cl.prototype,"controlSizeHeight",[rl],Object.getOwnPropertyDescriptor(cl.prototype,"controlSizeHeight"),cl.prototype),yl=It(cl.prototype,"_controlScaleWidth",[Tl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),It(cl.prototype,"controlScaleWidth",[al],Object.getOwnPropertyDescriptor(cl.prototype,"controlScaleWidth"),cl.prototype),bl=It(cl.prototype,"_controlScaleHeight",[Tl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),It(cl.prototype,"controlScaleHeight",[sl],Object.getOwnPropertyDescriptor(cl.prototype,"controlScaleHeight"),cl.prototype),ll=cl))||ll);t._RF.pop(),t._RF.push({},"2de05BThzdKpKfaXzu3wLES","View",void 0);var Al,Pl,Ml,Il,Nl,Ol,Ll,Rl,xl,Fl,Dl,zl,kl,Vl,Bl,Hl,Ul,Gl,Wl,ql,Zl,Yl,jl,Kl,Xl,Jl,Ql,$l,tc,ec,ic,nc,oc,rc,ac,sc=e.ccclass,lc=(e.property,sc("View")(Sl=function(){function t(t){this.__debug_graphics=void 0,this._adapter=void 0,this._total=0,this._innerSize=0,this._group=null,this._holderList=[],this._tempHolderList=[],this._isOverflowFixed=void 0,this._adapter=t,this.internal_reset(),this.__createDebug()}var e=t.prototype;return e.__createDebug=function(){},e.__drawDebug=function(){if(this.__debug_graphics&&this.group){this.__debug_graphics.clear();var t=this.adapter.mainAxis,e=this.adapter.crossAxis,i={x:0,y:0},n={x:this.group.size.x,y:this.group.size.y},o={x:this.group.anchorPoint.x,y:this.group.anchorPoint.y};i[t]=this.group.position[t]-n[t]*o[t],i[t]+=1.5,i[e]=this.group.position[e]-n[e]*(1-o[e]),i[e]+=1.5,n[t]-=3,n[e]-=3,this.__debug_graphics.roundRect(i.x,i.y,n.x,n.y,2),this.__debug_graphics.stroke()}},e.getFixedHolders=function(){if(!this.group.isFixed)return[];for(var t=[],e=this.holderList.length,i=0;i<e;i++){var n=this.holderList[i];n.model.element.fixed&&t.push(n)}return t},e.internal_isWrap=function(t,e){var i=!1,n=e&&e.models[e.models.length-1];if(n)switch(t.element.wrapBeforeMode){case Cs.Wrap:i=!0;break;case Cs.Nowrap:i=n.element.wrapAfterMode==Cs.Wrap;break;case Cs.Auto:(i=n.element.wrapAfterMode==Cs.Wrap)||(i=this._calculateInnerSize(t,e))}return i},e.internal_reset=function(){this._group=null,this._innerSize=0,this._total=0,this._holderList.length=0,this._isOverflowFixed=!0,this._tempHolderList.length=0,this.__debug_graphics&&this.__debug_graphics.clear()},e.internal_push=function(t){this._total++;var e=this.adapter.crossAxis;(!t.element.ignoreLayout||t.element.ignoreLayout&&t.element.placeholder)&&(0!=this._innerSize&&(this._innerSize+=this.adapter.layoutManager.spacing),this._innerSize+=t.size[e])},e.internal_recycleHolders=function(t){for(var e=0;e<this._holderList.length;e++){var i=this._holderList[e];i.internal_disable(),t(i)}this._holderList.length=0},e.internal_preVisible=function(t,e){return this._group=t,this._createHolders(e),this},e.internal_visible=function(){this.register();for(var t=0;t<this._tempHolderList.length;t++){var e=this._tempHolderList[t],i=e.holder,n=e.model,o=e.isNew;i.internal_visible(this,n,o)}this._tempHolderList.length=0,this.adapter.layoutManager.layout(this.group),this.onVisible()},e.internal_disable=function(){this.adapter.layoutManager.unLayout(this.index),this.unregister(),this.onDisable(),this.internal_reset()},e.internal_holderChanged=function(t){var e=!0,i=this.adapter.mainAxis,n=this.group.size[i];if(!t){for(var o=0,r=0;r<this.group.models.length;r++){var a=this.group.models[r],s=a.size[i];(this.adapter.isVertical&&this.adapter.layoutManager.controlScaleHeight||this.adapter.isHorizontal&&this.adapter.layoutManager.controlScaleWidth)&&(s*=a.scale[i]),o=Math.max(o,s)}Vs.approximately(this.group.size[i],o)||(this.group.oldSize[i]=this.group.size[i],this.group.size[i]=o,e=!1)}e?this.adapter.layoutManager.layout(this.group):this.adapter.viewManager.internal_viewChanged(this,n)},e.register=function(){this.adapter.viewManager.on(Gc.Event.ON_SCROLL,this._onScroll,this),this.adapter.viewManager.on(Gc.Event.ON_LATEUPDATE,this._onLateUpdate,this),this.adapter.layoutManager.on(El.Event.ON_LAYOUT_COMPLATED,this._onLayoutComplated,this),this.adapter.layoutManager.on(El.Event.ON_CHANGED_LAYOUT_STATE,this._onChangedLayoutState,this)},e.unregister=function(){this.adapter.viewManager.off(Gc.Event.ON_SCROLL,this._onScroll,this),this.adapter.viewManager.off(Gc.Event.ON_LATEUPDATE,this._onLateUpdate,this),this.adapter.layoutManager.off(El.Event.ON_LAYOUT_COMPLATED,this._onLayoutComplated,this),this.adapter.layoutManager.off(El.Event.ON_CHANGED_LAYOUT_STATE,this._onChangedLayoutState,this)},e._createHolders=function(t){var e=this.adapter.mainAxis;this._tempHolderList.length=0;for(var i=0;i<this.group.models.length;i++){var n=this.group.models[i],o=!1,r=t&&t(n);r||(r=this.adapter.viewManager.internal_getHolder(n),o=!0),n.position[e]=this.group.position[e],this._holderList.push(r),this._tempHolderList.push({holder:r,model:n,isNew:o})}},e._calculateInnerSize=function(t,e){if(0==this._total)return!1;var i=t.size[this.adapter.crossAxis];return this._innerSize+i+this.adapter.layoutManager.spacing>e.size[this.adapter.crossAxis]},e._onLayoutComplated=function(t){if(-1!=t.indexOf(this.index)){for(var e=0;e<this.holderList.length;e++){this.holderList[e].internal_layout()}this.group.isFixed&&this._calcFixedPosition()}},e._calcFixedPosition=function(){for(var t=this._holderList.length,e=this.adapter.mainAxis,i=0;i<t;i++){var n=this._holderList[i];if(n.element.fixed){var o={x:n.model.position.x,y:n.model.position.y},r=0,a=this._getModelBoundary(n.model);if(this._isNeedFixed(a)){o[e]-=a;var s=this.adapter.viewManager.getNextFixedHolders(this.index);r=this._getRelativeNextHolderOffset(n,s)}o[e]+=r*this.adapter.multiplier,o[e]!=n.node.position[e]&&n.node.setPosition(o.x,o.y)}}},e._onChangedLayoutState=function(){this.adapter.layoutManager.layout(this.group)},e._onScroll=function(){this.group.isFixed&&0!=this._holderList.length&&this._calcFixedPosition()},e._onLateUpdate=function(t){},e._isNeedFixed=function(t){return 1==this.adapter.multiplier?t>=0:t<=0},e._getModelBoundary=function(t){var e=Vs.isNumber(t.element.fixedOffset)?t.element.fixedOffset:0;return 1==this.adapter.multiplier?this._getModelHeaderBoundary(t)+e:this._getModelFooterBoundary(t)-e},e._getModelHeaderBoundary=function(t){var e=this.adapter.mainAxis;return t.position[e]+t.size[e]*(1-t.anchorPoint[e])*t.scale[e]+this.adapter.scrollManager.contentPosition},e._getModelFooterBoundary=function(t){var e=this.adapter.mainAxis;return t.position[e]-t.size[e]*t.anchorPoint[e]*t.scale[e]+this.adapter.scrollManager.contentPosition},e._getModelSizeWithSpacing=function(t){var e=this.adapter.mainAxis,i=Vs.isNumber(t.element.fixedOffset)?t.element.fixedOffset:0,n=Vs.isNumber(t.element.fixedSpacing)?t.element.fixedSpacing:this.adapter.viewManager.spacing;return t.size[e]*t.scale[e]+i+n},e._getReatureRelativeBoundary=function(t,e){var i=1==this.adapter.multiplier?this._getModelHeaderBoundary(t):this._getModelFooterBoundary(t),n=1==this.adapter.multiplier?i+e:e-i;return Math.min(n,e)},e._getRelativeNextHolderOffset=function(t,e){for(var i=e.length,n=this.adapter.crossAxis,o=this._getModelSizeWithSpacing(t.model),r=0,a=0;a<i;a++){var s=e[a],l=this._getReatureRelativeBoundary(s.model,o),c=t.model.scale[n]==s.model.scale[n],u=t.model.size[n]==s.model.size[n];if(t.fixedIndex==s.fixedIndex&&c&&u){r=l>0?l:0;break}l>0&&(r=Math.max(r,l))}return r},Ft(t,[{key:"isOverflowFixed",get:function(){return this._isOverflowFixed}},{key:"adapter",get:function(){return this._adapter}},{key:"group",get:function(){return this._group}},{key:"holderList",get:function(){return this._holderList}},{key:"index",get:function(){return this.group?this.group.index:-1}}]),t}())||Sl);t._RF.pop(),t._RF.push({},"f2204qKI49MuZnaH/naH4DF","ViewManager",void 0);var uc,hc,pc,dc,fc,gc,mc,vc,yc,bc,_c,Sc,wc,Tc,Cc,Ec,Ac,Pc,Mc,Ic,Nc,Oc,Lc,Rc,xc,Fc,Dc,zc,kc,Vc,Bc=e.ccclass,Hc=e.property,Uc=function(t){return t[t.ON_SCROLL=0]="ON_SCROLL",t[t.ON_LATEUPDATE=1]="ON_LATEUPDATE",t[t.ON_CLEARVIEWS=2]="ON_CLEARVIEWS",t[t.ON_UPDATE_VIEWS=3]="ON_UPDATE_VIEWS",t[t.ON_CHANGED_VIRTUALSIZE=4]="ON_CHANGED_VIRTUALSIZE",t[t.ON_MAGNETIC=5]="ON_MAGNETIC",t[t.ON_CHANGED_OVERFLOWHEADER=6]="ON_CHANGED_OVERFLOWHEADER",t[t.ON_RESET_ALL_STATE=7]="ON_RESET_ALL_STATE",t[t.ON_CHANGED_SPACING=8]="ON_CHANGED_SPACING",t}(Uc||{}),Gc=(Al=Bc("ViewManager"),Pl=Hc({type:Ss}),Ml=Hc({type:Ss,tooltip:"主轴方向的排列方式\n        Start: 从上到下、从左到右\n        End: 从下到上、从右到左"}),Il=Hc({type:ws,tooltip:"当元素的尺寸、缩放改变时，受影响的其他元素应该如何计算新的位置\n        Auto: 以可视区域中心为起点，所有其他元素向两边延伸\n        Center: 以当前变化的元素为起点，所有其他元素向两边延伸\n        Header: 以当前变化的元素和它头部的所有元素向头部延伸\n        Footer: 以当前变化的元素和它尾部的所有元素向尾部延伸"}),Nl=Hc({range:[0,1],slide:!0,step:.01,tooltip:"当元素移动到可视区域外偏移多少时才进行回收\n        比如元素的尺寸为100，当元素超出可视范围 100+100*0.3 时就会被回收\n        没有特殊需求时，默认值即可"}),Ol=Hc({range:[0,1],slide:!0,step:.01,tooltip:"此值会影响填充元素的时机\n        没有特殊需求时，默认值即可"}),Ll=Hc({tooltip:"主轴方向元素的间隙"}),Rl=Hc({group:{id:"padding",name:"padding"}}),xl=Hc({group:{id:"padding",name:"padding"}}),Fl=Hc({group:{id:"padding",name:"padding"}}),Dl=Hc({group:{id:"padding",name:"padding"}}),zl=Hc({tooltip:"磁性停靠\n        开启后，会在增加数据时，根据设置进行自动滚动到顶部或底部"}),kl=Hc({type:As,visible:function(){return this.magnetic},tooltip:"停靠的方向"}),Vl=Hc({visible:function(){return this.magnetic},tooltip:"停靠动画的时长"}),Bl=Hc({visible:function(){return this.magnetic},tooltip:"默认情况下，仅当添加数据时才会触发停靠\n        当开启时，元素的尺寸改变时,也会否触发停靠"}),Hl=Hc({tooltip:"头部循环"}),Ul=Hc({tooltip:"尾部循环"}),Al(((ac=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,Ot(e,"_arrangeAxis",ql,Lt(e)),Ot(e,"stretchDirection",Zl,Lt(e)),Ot(e,"overflowOffset",Yl,Lt(e)),Ot(e,"enterOffset",jl,Lt(e)),Ot(e,"_spacing",Kl,Lt(e)),Ot(e,"left",Xl,Lt(e)),Ot(e,"right",Jl,Lt(e)),Ot(e,"top",Ql,Lt(e)),Ot(e,"bottom",$l,Lt(e)),Ot(e,"magnetic",tc,Lt(e)),Ot(e,"magneticDirection",ec,Lt(e)),Ot(e,"magneticDuration",ic,Lt(e)),Ot(e,"magneticSizeChanges",nc,Lt(e)),Ot(e,"loopHeader",oc,Lt(e)),Ot(e,"loopFooter",rc,Lt(e)),e._groupLength=0,e._cacheGroups=[],e._groups=[],e._disableViews=[],e._visibleViews=[],e._fixedViews=[],e._disableHolders=[],e._isFill=!1,e._headerIndex=-1,e._footerIndex=-1,e._virtualSize=0,e._overflowHeader=0,e._cacheHeadeDatas=[],e._cacheHeadePosition=void 0,e}Nt(e,t);var i=e.prototype;return i.onInit=function(){this.adapter.modelManager.on(Ys.Event.ON_CHANGE_BEFORE,this._onModelChangeBefore,this),this.adapter.modelManager.on(Ys.Event.ON_INSERT,this._updateGroups,this),this.adapter.modelManager.on(Ys.Event.ON_REMOVE,this._updateGroups,this),this.adapter.modelManager.on(Ys.Event.ON_MOVE,this._updateGroups,this),this.adapter.modelManager.on(Ys.Event.ON_CLEAR,this._onClearModel,this),this.adapter.scrollManager.on(au.Event.ON_SCROLL,this._onScroll,this),this.adapter.scrollManager.on(au.Event.ON_VIEW_SIZE_CHANGED,this._resetAllState,this),this.adapter.scrollManager.on(au.Event.ON_CHANGED_ORIENTATION,this._resetAllState,this)},i._clearAll=function(){for(var t,e=0,i=this._visibleViews.length;e<i;e++)this._recycleViewToDisableViews(this._visibleViews[e]);(t=this._cacheGroups).push.apply(t,this._groups),this._clearFixedViews(),this._visibleViews.length=0,this._groups.length=0,this.virtualSize=0,this.overflowHeader=0},i._onClearModel=function(){this._clearAll(),this.emit(Uc.ON_CLEARVIEWS)},i._resetAllState=function(){this._clearAll(),this.internal_updateVisibleView(0),this.emit(Uc.ON_RESET_ALL_STATE)},i._onModelChangeBefore=function(){if(this.header&&this.virtualSize>this.adapter.mainAxisSize){var t=this.getVisibleIndexByGroupIndex(0);if(-1!=t){var e=this._visibleViews[t];this._cacheHeadeDatas=e.group.models.map((function(t){return t.data})),this._cacheHeadePosition={x:e.group.position.x,y:e.group.position.y}}else this._cacheHeadeDatas=this.header.group.models.map((function(t){return t.data})),this._cacheHeadePosition={x:this.header.group.position.x,y:this.header.group.position.y}}},i._updateGroups=function(t){var e,i=this,n=this._getViewFromDisibleViews(null),o=this.getGroupIndexByModelIndex(t);-1==o&&(o=this._groupLength-1);var r=null,a=!1,s={modelIndex:t,fixedIndex:-1},l=this._groups[o-1];for(l&&(s.fixedIndex=l.fixedIndex);;){(r=this._groups[o])||((r=this._getGroupFromCache()).internal_setIndex(this._groups.length),this._groups.push(r),o=this._groups.length);var c=r.internal_insert(s,n,a);if(o++,a=!0,!c)break}var u=this._groups.splice(o,this._groups.length);(e=this._cacheGroups).push.apply(e,u),this._groupLength=this._groups.length;var h=-1,p=0;this._cacheHeadeDatas.length>0&&(h=this._groups.findIndex((function(t){return t.internal_includes(i._cacheHeadeDatas)})));var d=this._groups[h];d&&(p+=d.size[this.adapter.mainAxis]+this.spacing,d.internal_setPosition(this._cacheHeadePosition[this.adapter.mainAxis]));for(var f=h-1;f>=0;f--){var g=this._groups[f];this._calcMainAxisPosition(g,d,As.Header),p+=g.size[this.adapter.mainAxis]+this.spacing,d=g}d=this._groups[h];for(var m=h+1;m<this.groupLength;m++){g=this._groups[m];this._calcMainAxisPosition(g,d,As.Footer),p+=g.size[this.adapter.mainAxis]+this.spacing,d=g}p-=this.spacing,this._virtualSize=Math.max(0,p),this._resetOverflowHeader(this._groups[0]),n.internal_reset(),this._disableViews.push(n),this.updateVisibles(h),this._cacheHeadeDatas=[],this._cacheHeadePosition=null},i.updateVisibles=function(t){var e=[];t=Math.max(0,t);for(var i=function(t){var i=e.findIndex((function(e){return e.oldData==t.data}));return-1!=i?e.splice(i,1)[0]:null},n=0;n<this._visibleViews.length;n++){var o=this._visibleViews[n];e=e.concat(o.holderList),o.internal_reset()}for(var r=this.adapter.mainAxisSize,a=0,s=this.visibleLength,l=t,c=this._groups.length;l<c;l++){var u=this._groups[l];if(this.getVisibleMainAxisSize()>=r&&s<=0)break;(p=this._visibleViews[a++])||(p=this._getViewFromDisibleViews(u.index),this._visibleViews.push(p)),p.internal_preVisible(u,i),s--}for(var h=this._visibleViews.length-1;h>=0;h--){var p;if((p=this._visibleViews[h]).holderList.length>0)break;this._disableFromVisibleViews(h)}for(var d=0,f=e.length;d<f;d++){var g=e[d];g.internal_disable(),this._disableHolders.push(g)}for(var m=0;m<this.visibleLength;m++)this._visibleViews[m].internal_visible();this._forceFill(),this._calcMagnetic(),this.emit(Uc.ON_UPDATE_VIEWS)},i._getGroupFromCache=function(){var t=this._cacheGroups.pop();return t||(t=new zs(this.adapter)),t.internal_reset(),t},i._calcMagnetic=function(){if(this.magnetic&&this.header){var t=!1;0==this.adapter.scrollManager.velocity&&(this.magneticDirection==As.Footer?this.footer.index==this._groupLength-1&&(this.adapter.scrollManager.scrollToFooter(this.magneticDuration),t=!0):0==this.header.index&&(this.adapter.scrollManager.scrollToHeader(this.magneticDuration),t=!0)),this.emit(Uc.ON_MAGNETIC,t)}},i._calcMainAxisPosition=function(t,e,i){if(t)if(e){var n,o,r=this.adapter.mainAxis,a=this.adapter.multiplier,s=i==As.Footer?1:-1;i==As.Footer?(n=1==a?e.anchorPoint[r]:1-e.anchorPoint[r],o=1==a?1-t.anchorPoint[r]:t.anchorPoint[r]):(n=1==a?1-e.anchorPoint[r]:e.anchorPoint[r],o=1==a?t.anchorPoint[r]:1-t.anchorPoint[r]);var l=e.position[r];l-=e.size[r]*n*s*a,l-=this.spacing*a*s,l-=t.size[r]*o*s*a,t.internal_setPosition(l)}else t.internal_setPosition(this._getMainAxisHeaderPosition(t))},i._getMainAxisHeaderPosition=function(t){var e=0,i=0;return this.adapter.isVertical?(e=this.adapter.isArrangeAxisStart?-this.top:this.bottom,i=this.adapter.isArrangeAxisStart?1-t.anchorPoint[this.adapter.mainAxis]:t.anchorPoint[this.adapter.mainAxis]):(e=this.adapter.isArrangeAxisStart?this.left:-this.right,i=this.adapter.isArrangeAxisStart?t.anchorPoint[this.adapter.mainAxis]:1-t.anchorPoint[this.adapter.mainAxis]),e-=i*t.size[this.adapter.mainAxis]*this.adapter.multiplier},i._getViewFromDisibleViews=function(t){var e=null;if(null!=t){var i=this._fixedViews.findIndex((function(e){return e.index==t}));if(-1!=i){var n=this._fixedViews.splice(i,1)[0];this._recycleViewToDisableViews(n)}}return e||(e=this._disableViews.pop()),e||(e=this.adapter.getView()),e},i._getHolderFromDisableHolders=function(t){var e=this._disableHolders.findIndex((function(e){return e.code==t.code}));if(-1!=e)return this._disableHolders.splice(e,1)[0]},i._disableFromVisibleViews=function(t){var e=-1;e=t instanceof lc?this._visibleViews.findIndex((function(e){return e.index==t.index})):t,this._recycleViewToDisableViews(this._visibleViews[e]),this._visibleViews.splice(e,1)},i._recycleViewToDisableViews=function(t){var e=this;t&&(t.internal_recycleHolders((function(t){return e._disableHolders.push(t)})),t.internal_disable(),this._disableViews.push(t))},i._clearFixedViews=function(){for(var t=0,e=this._fixedViews.length;t<e;t++){var i=this._fixedViews[t];this._recycleViewToDisableViews(i)}this._fixedViews.length=0},i._checkHeaderInvisible=function(){this.header&&(this.loopFooter||this.footer.index!=this.groupLength-1)&&this._isOverflowHeader(this.header.group)&&(this._disableFromVisibleViews(0),this._checkHeaderInvisible())},i._checkFooterInvisible=function(){this.footer&&(this.loopHeader||0!=this.header.index)&&this._isOverflowFooter(this.footer.group)&&(this._disableFromVisibleViews(this._visibleViews.length-1),this._checkFooterInvisible())},i._isOverflowHeader=function(t,e){void 0===e&&(e=this.overflowOffset);var i=this.internal_getGroupFooterBoundary(t);return e*=t.size[this.adapter.mainAxis],1==this.adapter.multiplier?i>=e:i<=-e},i._isOverflowFooter=function(t,e){void 0===e&&(e=this.overflowOffset);var i=this.internal_getGroupHeaderBoundary(t);return e*=t.size[this.adapter.mainAxis],1==this.adapter.multiplier?i+this.adapter.mainAxisSize<=-e:i-this.adapter.mainAxisSize>=e},i._isEnterFooter=function(t){if(!t)return!1;var e=this.internal_getGroupFooterBoundary(t),i=this.enterOffset*t.size[this.adapter.mainAxis];return 1==this.adapter.multiplier?e+this.adapter.mainAxisSize+i>=0:e-this.adapter.mainAxisSize-i<=0},i._isEnterHeader=function(t){if(!t)return!1;var e=this.internal_getGroupHeaderBoundary(t),i=this.overflowOffset*t.size[this.adapter.mainAxis];return 1==this.adapter.multiplier?e-i<=0:e+i>=0},i._fillHeader=function(){var t=this._groups[this._headerIndex];if(this._isEnterHeader(t)){var e=this._accumTargetSizeTowardsHeader(t.index,this.internal_getInitHeaderSize(t)),i=e.index,n=e.size,o=this._groups[i];if(o&&-1==this.getVisibleIndexByGroupIndex(i)){var r=this.internal_convertSizeToHeaderPosition(n,o);o.internal_setPosition(r);var a=this._getViewFromDisibleViews(o.index);this._visibleViews.unshift(a),a.internal_preVisible(o).internal_visible(),0==a.index&&this._resetOverflowHeader(a.group),this._headerIndex=o.index,this._fillHeader()}}},i._fillFooter=function(){var t=this._groups[this._footerIndex];if(this._isEnterFooter(t)){var e=this._accumTargetSizeTowardsFooter(t.index,this.internal_getInitFooterSize(t)),i=e.index,n=e.size,o=this._groups[i];if(o&&-1==this.getVisibleIndexByGroupIndex(i)){var r=this.internal_convertSizeToFooterPosition(n,o);o.internal_setPosition(r);var a=this._getViewFromDisibleViews(o.index);this._visibleViews.push(a),a.internal_preVisible(o).internal_visible(),0==a.index&&this._resetOverflowHeader(a.group),this._footerIndex=o.index,this._fillFooter()}}},i._fillFixedView=function(){if(this.header&&(-1!=this.header.group.fixedIndex||this.header.group.isFixed))for(var t=this.header.index,e=this.adapter.mainAxis,i=this.internal_getInitHeaderSize(this.header.group),n=t-1;n>=0;n--){var o=this._groups[n];if(!o)return void console.error("_fillFixedView错误 找不到group",n);if(i+=o.size[e]+this.spacing,o.isFixed){var r=this.internal_convertSizeToHeaderPosition(i,o);if(-1!=this._fixedViews.findIndex((function(t){return t.index==o.index}))){Vs.approximately(r,o.position[e])||(o.internal_setPosition(r),this.adapter.layoutManager.layout(o));break}this._clearFixedViews();r=this.internal_convertSizeToHeaderPosition(i,o);o.internal_setPosition(r);var a=this._getViewFromDisibleViews(o.index);a.internal_preVisible(o).internal_visible(),this._fixedViews.push(a);break}}},i._accumTargetSizeTowardsHeader=function(t,e){for(var i=this._groups.length;;){if(0==t&&this.loopHeader&&(t=i),0==t)return{index:t,size:e};if(t--,!this._groups[t])return{index:t,size:e};if((e+=this.internal_accumulationSize(t))>=0)return{index:t,size:e}}},i._accumTargetSizeTowardsFooter=function(t,e){for(var i=this._groups.length;;){if(t==i-1&&this.loopFooter&&(t=-1),t==i-1)return{index:t,size:e};if(t++,!this._groups[t])return{index:t,size:e};if((e+=this.internal_accumulationSize(t))>=0)return{index:t,size:e}}},i._fillFooterHandle=function(){this._checkHeaderInvisible(),this._fillFooter()},i._fillHeaderHandle=function(){this._checkFooterInvisible(),this._fillHeader()},i._forceFill=function(){this._updateHeaderFooterIndex(),this._fillHeaderHandle(),this._fillFooterHandle()},i._updateHeaderFooterIndex=function(){this._headerIndex=this.header?this.header.index:0,this._footerIndex=this.footer?this.footer.index:0},i._onScroll=function(t){if(0!=this._groups.length){switch(this._updateHeaderFooterIndex(),t){case Ms.Up:case Ms.Left:this.adapter.isArrangeAxisStart?this._fillFooterHandle():this._fillHeaderHandle();break;case Ms.Down:case Ms.Right:this.adapter.isArrangeAxisStart?this._fillHeaderHandle():this._fillFooterHandle()}this._fillFixedView(),this.emit(Uc.ON_SCROLL)}},i._stretchToHeader=function(t,e){for(var i=this._visibleViews[t],n=e;n>=0;n--){var o=this._visibleViews[n];i?(this._calcMainAxisPosition(o.group,i.group,As.Header),this.adapter.layoutManager.layout(o.group)):this.getVisibleMainAxisSize()<this.adapter.mainAxisSize&&this._calcMainAxisPosition(o.group,null,As.Header),i=o}},i._stretchToFooter=function(t,e){for(var i=this._visibleViews[t],n=e;n<this._visibleViews.length;n++){var o=this._visibleViews[n];i?(this._calcMainAxisPosition(o.group,i.group,As.Footer),this.adapter.layoutManager.layout(o.group)):this.getVisibleMainAxisSize()<this.adapter.mainAxisSize&&this._calcMainAxisPosition(o.group,null,As.Footer),i=o}},i._resetOverflowHeader=function(t){if(!t)return this.overflowHeader=0;var e=this.adapter.mainAxis,i=t.anchorPoint[e];i=1==this.adapter.multiplier?1-i:i;var n=t.position[e];n+=t.size[e]*i*this.adapter.multiplier,this.overflowHeader=n},i._calcOverflowHeader=function(t,e,i){var n=this.getVisibleIndexByGroupIndex(0);if(-1!=n){var o=this._visibleViews[n];return this._resetOverflowHeader(o.group)}var r=this.adapter.mainAxis,a=t.anchorPoint[r];a=1==this.adapter.multiplier?1-a:a;var s=t.oldSize[r],l=t.size[r],c=this.adapter.multiplier;switch(this.stretchDirection){case ws.Header:var u=t.oldPosition[r]+s*a*c;(h=1==c?this.overflowHeader>=u:this.overflowHeader<=u)&&(this.overflowHeader+=(l-s)*c);break;case ws.Footer:u=t.oldPosition[r]+s*a*c;(h=1==c?this.overflowHeader>=u:this.overflowHeader<=u)||(this.overflowHeader-=(l-s)*c);break;case ws.Center:u=t.oldPosition[r]+s*a*c;(h=1==c?this.overflowHeader>=u:this.overflowHeader<=u)?this.overflowHeader+=.5*(l-s)*c:this.overflowHeader-=.5*(l-s)*c;break;case ws.Auto:u=t.oldPosition[r]+s*a*c;var h=1==c?this.overflowHeader>=u:this.overflowHeader<=u;e<=i&&(u=t.oldPosition[r]+s*a*c,h=-1==c?this.overflowHeader>=u:this.overflowHeader<=u),h&&(e<=i?this.overflowHeader-=(l-s)*c:this.overflowHeader+=(l-s)*c)}},i.internal_lateUpdate=function(t){this._isFill&&(this._isFill=!1,this._forceFill()),this.emit(Uc.ON_LATEUPDATE,t)},i.internal_viewChanged=function(t,e){var i=t.group.size[this.adapter.mainAxis]-e;this.virtualSize+=i;var n=this.getVisibleIndexByGroupIndex(t.index),o=-1;if(this.getVisibleMainAxisSize()<this.adapter.mainAxisSize||this.stretchDirection==ws.Footer){var r=n-1;this._visibleViews[r]||this.adapter.layoutManager.layout(t.group),this._stretchToFooter(r,n)}else if(this.stretchDirection==ws.Header){var a=n+1;this._visibleViews[a]||this.adapter.layoutManager.layout(t.group),this._stretchToHeader(a,n)}else if(this.stretchDirection==ws.Center)this.adapter.layoutManager.layout(t.group),this._stretchToHeader(n,n-1),this._stretchToFooter(n,n+1);else{if(-1==(o=this.adapter.centerManager.getCenterVisibleIndex()))throw Error("找不到中心索引"+t.index);var s=this._visibleViews[o];this.adapter.layoutManager.layout(s.group),this._stretchToHeader(o,o-1),this._stretchToFooter(o,o+1)}this._calcOverflowHeader(t.group,o,n),this.magneticSizeChanges&&this._calcMagnetic(),this._isFill=!0,this.emit(Uc.ON_CHANGED_VIRTUALSIZE)},i.internal_getHolder=function(t){var e=this._getHolderFromDisableHolders(t);if(!e){var i=this.adapter.getPrefab(t.data),n=E(i);e=this.adapter.getHolder(n,t.code)}return e.node.parent=this.adapter.scrollManager.getLayerNode(t.element.layer),e},i.internal_updateVisibleView=function(t){this._onModelChangeBefore(),this._updateGroups(t)},i.internal_getGroupFooterBoundary=function(t){if(!t)return 0;var e=t.anchorPoint[this.adapter.mainAxis];e=1==this.adapter.multiplier?e:1-e;var i=t.position[this.adapter.mainAxis];return i-=t.size[this.adapter.mainAxis]*e*this.adapter.multiplier,i+=this.adapter.scrollManager.contentPosition},i.internal_getGroupHeaderBoundary=function(t){if(!t)return 0;var e=t.anchorPoint[this.adapter.mainAxis];return e=1==this.adapter.multiplier?1-e:e,t.position[this.adapter.mainAxis]+this.adapter.scrollManager.contentPosition+e*t.size[this.adapter.mainAxis]*this.adapter.multiplier},i.internal_getInitHeaderSize=function(t){if(!t)return 0;var e=t.anchorPoint[this.adapter.mainAxis];e=1==this.adapter.multiplier?1-e:e;var i=-t.position[this.adapter.mainAxis]*this.adapter.multiplier;return i-=t.size[this.adapter.mainAxis]*e,i-=this.adapter.scrollManager.contentPosition*this.adapter.multiplier,i=this.adapter.mainAxisSize-i},i.internal_getInitFooterSize=function(t){if(!t)return 0;var e=t.anchorPoint[this.adapter.mainAxis];e=1==this.adapter.multiplier?e:1-e;var i=-t.position[this.adapter.mainAxis]*this.adapter.multiplier;return i+=t.size[this.adapter.mainAxis]*e,i-=this.adapter.scrollManager.contentPosition*this.adapter.multiplier},i.internal_accumulationSize=function(t){var e=this._groups[t];return e?e.size[this.adapter.mainAxis]+this.spacing:0},i.internal_convertSizeToFooterPosition=function(t,e){var i=e.anchorPoint[this.adapter.mainAxis];i=1==this.adapter.multiplier?i:1-i;var n=e.size[this.adapter.mainAxis]*i,o=-this.adapter.scrollManager.contentPosition;return o-=this.adapter.multiplier*t-this.adapter.multiplier*n},i.internal_convertSizeToHeaderPosition=function(t,e){var i=e.anchorPoint[this.adapter.mainAxis];i=1==this.adapter.multiplier?1-i:i;var n=e.size[this.adapter.mainAxis]*i,o=this.adapter.multiplier*t-this.adapter.multiplier*n;return o-=this.adapter.multiplier*this.adapter.mainAxisSize,o-=this.adapter.scrollManager.contentPosition},i.getGroup=function(t){return this._groups[t]},i.getVisibleView=function(t){return this._visibleViews[t]},i.getVisibleMainAxisSize=function(){if(0==this._visibleViews.length)return 0;for(var t=0,e=this.adapter.mainAxis,i=0,n=this._visibleViews.length;i<n;i++){var o=this._visibleViews[i];o.group&&(t+=o.group.size[e]+this.spacing)}return t-=this.spacing},i.getGroupIndexByModelIndex=function(t){for(var e=0,i=this._groups.length;e<i;e++){if(-1!=this._groups[e].findModelIndex(t))return e}return-1},i.getVisibleIndexByGroupIndex=function(t){return this._visibleViews.findIndex((function(e){return e.index==t}))},i.getNextFixedHolders=function(t){for(var e=[],i=this.getVisibleIndexByGroupIndex(t)+1,n=this._visibleViews.length;i<n;i++){var o=this._visibleViews[i];if(o.index!=t&&o.group.isFixed){e=o.getFixedHolders();break}}return e},i.getMagneticOffset=function(){if(!this.magnetic)return 0;var t=this.adapter.isHorizontal?-this.adapter.multiplier:this.adapter.multiplier;return this.magneticDirection==As.Footer?this.footer?Math.max(0,this.adapter.mainAxisSize-this.adapter.mainAxisPadding-this.getVisibleMainAxisSize())*t:this.adapter.mainAxisSize*t:0},Ft(e,[{key:"arrangeAxis",get:function(){return this._arrangeAxis},set:function(t){t!=this._arrangeAxis&&(this._arrangeAxis=t,this._resetAllState())}},{key:"spacing",get:function(){return this._spacing},set:function(t){t!=this._spacing&&(this._spacing=t,this._resetAllState())}},{key:"header",get:function(){return this._visibleViews[0]}},{key:"footer",get:function(){return this._visibleViews[this._visibleViews.length-1]}},{key:"overflowHeader",get:function(){return this._overflowHeader},set:function(t){t!=this._overflowHeader&&(this._overflowHeader=t,this.emit(Uc.ON_CHANGED_OVERFLOWHEADER,t))}},{key:"virtualSize",get:function(){return this._virtualSize},set:function(t){t!=this._virtualSize&&(this._virtualSize=t,this.emit(Uc.ON_CHANGED_VIRTUALSIZE))}},{key:"groupLength",get:function(){return this._groupLength}},{key:"visibleLength",get:function(){return this._visibleViews.length}},{key:"min",get:function(){return this.header?this.adapter.isArrangeAxisStart?this.internal_getGroupFooterBoundary(this.footer.group):this.internal_getGroupHeaderBoundary(this.header.group):0}},{key:"max",get:function(){return this.header?this.adapter.isArrangeAxisStart?this.internal_getGroupHeaderBoundary(this.header.group):this.internal_getGroupFooterBoundary(this.footer.group):0}}]),e}(Gs)).Event=Uc,ql=It((Wl=ac).prototype,"_arrangeAxis",[Pl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Ss.Start}}),It(Wl.prototype,"arrangeAxis",[Ml],Object.getOwnPropertyDescriptor(Wl.prototype,"arrangeAxis"),Wl.prototype),Zl=It(Wl.prototype,"stretchDirection",[Il],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return ws.Auto}}),Yl=It(Wl.prototype,"overflowOffset",[Nl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.3}}),jl=It(Wl.prototype,"enterOffset",[Ol],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Kl=It(Wl.prototype,"_spacing",[Hc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),It(Wl.prototype,"spacing",[Ll],Object.getOwnPropertyDescriptor(Wl.prototype,"spacing"),Wl.prototype),Xl=It(Wl.prototype,"left",[Rl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Jl=It(Wl.prototype,"right",[xl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Ql=It(Wl.prototype,"top",[Fl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),$l=It(Wl.prototype,"bottom",[Dl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),tc=It(Wl.prototype,"magnetic",[zl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),ec=It(Wl.prototype,"magneticDirection",[kl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return As.Header}}),ic=It(Wl.prototype,"magneticDuration",[Vl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),nc=It(Wl.prototype,"magneticSizeChanges",[Bl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),oc=It(Wl.prototype,"loopHeader",[Hl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),rc=It(Wl.prototype,"loopFooter",[Ul],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Gl=Wl))||Gl);t._RF.pop(),t._RF.push({},"38125A9jl5DlJflB6yBKrYI","ScrollManager",void 0);var Wc,qc,Zc,Yc,jc,Kc,Xc,Jc,Qc,$c,tu,eu=e.ccclass,iu=e.property,nu=new g,ou="__ADAPTER__",ru=function(t){return t[t.ON_SCROLL=0]="ON_SCROLL",t[t.ON_UPDATE_PERCENTAGE=1]="ON_UPDATE_PERCENTAGE",t[t.ON_VIEW_SIZE_CHANGED=2]="ON_VIEW_SIZE_CHANGED",t[t.ON_ABOUT_TO_STOP=3]="ON_ABOUT_TO_STOP",t[t.ON_SCROLL_START=4]="ON_SCROLL_START",t[t.ON_SCROLL_END=5]="ON_SCROLL_END",t[t.ON_SCROLL_CANCEL=6]="ON_SCROLL_CANCEL",t[t.ON_CHANGED_ORIENTATION=7]="ON_CHANGED_ORIENTATION",t[t.ON_SCROLL_TO_GROUPINDEX_BEFOR=8]="ON_SCROLL_TO_GROUPINDEX_BEFOR",t[t.ON_SCROLL_TO_GROUPINDEX_AFTER=9]="ON_SCROLL_TO_GROUPINDEX_AFTER",t[t.ON_SCROLL_TO_MODELINDEX_BEFOR=10]="ON_SCROLL_TO_MODELINDEX_BEFOR",t[t.ON_SCROLL_TO_MODELINDEX_AFTER=11]="ON_SCROLL_TO_MODELINDEX_AFTER",t}(ru||{}),au=(uc=eu("ScrollManager"),hc=iu(B),pc=iu(B),dc=iu(B),fc=iu(B),gc=iu({type:bs}),mc=iu({type:bs}),vc=iu({type:Es,tooltip:"Auto: 当内容撑满可视区域或开启ReleaseManager时允许拖动\n        AlwaysAllow: 任何情况下都可以拖动，即使没有任何元素\n        Disabled: 任何情况下都禁用拖动\n        "}),yc=iu({type:_s}),bc=iu({range:[0,1],slide:!0,step:.001,visible:function(){return this.movementType==_s.Elastic}}),_c=iu({range:[0,1],slide:!0,step:.001,visible:function(){return this.inertia}}),Sc=iu({tooltip:"当滚动速度小于这个值时，会发送ON_ABOUT_TO_STOP广播"}),wc=iu({tooltip:"取消子节点的Button点击事件"}),Tc=iu({range:[0,.5],slide:!0,step:.001,visible:function(){return this.inertia},tooltip:"嵌套时，当子元素的ScrollView拖动方向和当前拖动方向相同时，使用当前阈值进行计算由谁来处理拖动\n        无特殊需求时，默认值即可"}),Cc=iu({range:[.5,1],slide:!0,step:.001,visible:function(){return this.inertia},tooltip:"嵌套时，当子元素的ScrollView拖动方向和当前拖动方向相同时，使用当前阈值进行计算由谁来处理拖动\n        无特殊需求时，默认值即可"}),uc(((Vc=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,Ot(e,"_view",Pc,Lt(e)),Ot(e,"_content",Mc,Lt(e)),Ot(e,"_orientation",Ic,Lt(e)),Ot(e,"touchMode",Nc,Lt(e)),Ot(e,"movementType",Oc,Lt(e)),Ot(e,"elasticity",Lc,Lt(e)),Ot(e,"inertia",Rc,Lt(e)),Ot(e,"decelerationRate",xc,Lt(e)),Ot(e,"aboutToStopVelocity",Fc,Lt(e)),Ot(e,"cancelInnerEvents",Dc,Lt(e)),Ot(e,"nestedMinThreshold",zc,Lt(e)),Ot(e,"nestedMaxThreshold",kc,Lt(e)),e.__debug_graphics=void 0,e._boundaryOffset=0,e._viewWidget=null,e._parentAdapter=void 0,e._layerLowest=void 0,e._layerMedium=void 0,e._layerHighest=void 0,e._percentage=0,e._velocity=0,e._dragging=!1,e._scrolling=!1,e._isCanceledEvent=!1,e._contentStartPosition=new g,e._prevContentPosition=new g,e._nestedDirection=Ns.Both,e._parentTouch=!1,e._stopCheckNested=!1,e._scrollHandlePercentage=null,e._scrollHandlePosition=null,e._isEmitAboutToStop=!1,e._isMyEventAndMoved=!1,e._scrollDirection=Ms.None,e._laseScrollDirection=Ms.None,e._touchEvent=null,e.test=!1,e}Nt(e,t);var i=e.prototype;return i.onInit=function(){var t=this;this._initView(),this._initContent(),this._parentAdapter=this.adapter.getParentAdapter(this.adapter.node.parent),this.view.node[ou]=!0,this.adapter.viewManager.on(Gc.Event.ON_UPDATE_VIEWS,this._onUpdateViews,this),this.adapter.viewManager.on(Gc.Event.ON_CHANGED_VIRTUALSIZE,this._onChangedVirtualSize,this),this.adapter.viewManager.on(Gc.Event.ON_CHANGED_OVERFLOWHEADER,this._onChangedOverflowHeader,this),this.adapter.viewManager.on(Gc.Event.ON_RESET_ALL_STATE,this._onResetAllState,this),this.adapter.viewManager.on(Gc.Event.ON_CLEARVIEWS,this._onResetAllState,this),this.adapter.node.on(c.EventType.SIZE_CHANGED,this._onAdapterSizeChanged,this),this.view.node.on(c.EventType.SIZE_CHANGED,this._onViewSizeChanged,this),this._registerTouchEvent(),this.__createDebug(),this.view.scheduleOnce((function(){t._updatePercentage()}))},i._initView=function(){if(!this.view)throw Error("ScrollManager view 参数为空！");var t={x:.5,y:.5};t[this.adapter.mainAxis]=this.adapter.mainAxisAnchorPoint,this.view.setAnchorPoint(t.x,t.y);var e=this.view.getComponent(Z);e||((e=this.view.addComponent(Z)).isAlignLeft=e.isAlignRight=e.isAlignTop=e.isAlignBottom=!0,e.left=e.right=e.top=e.bottom=0),e.updateAlignment(),this._viewWidget=e},i.__createDebug=function(){},i.__drawDebug=function(){if(this.__debug_graphics){this.__debug_graphics.clear();var t=this.adapter.mainAxis,e=this.adapter.crossAxis,i=this.adapter.multiplier,n={x:0,y:0},o={x:0,y:0};o[t]=this.adapter.viewManager.virtualSize,o[e]=this.adapter.crossAxisSize,n[t]=this.contentPosition-o[t]*this.content.anchorPoint[t]*i,n[t]+=this.adapter.viewManager.overflowHeader,n[e]-=o[e]*this.view.anchorPoint[e],this.__debug_graphics.fillRect(n.x,n.y,o.x,o.y),this.__debug_graphics.stroke()}},i._initContent=function(){if(!this.content)throw Error("ScrollManager content 参数为空！");this.content.setAnchorPoint(this.view.anchorPoint);var t={x:0,y:0};t[this.adapter.crossAxis]=this.view.contentSize[this.adapter.crossAxis],this.content.setContentSize(t.x,t.y),this._layerLowest||(this._layerLowest=new c("_layerLowest"),this._layerMedium=new c("_layerMedium"),this._layerHighest=new c("_layerHighest"),this.content.node.addChild(this._layerLowest),this.content.node.addChild(this._layerMedium),this.content.node.addChild(this._layerHighest)),this._updateContentPosition({x:0,y:0})},i._registerTouchEvent=function(){this.view.node.on(c.EventType.TOUCH_START,this._onTouchStart,this,!0),this.view.node.on(c.EventType.TOUCH_END,this._onTouchEnd,this,!0),this.view.node.on(c.EventType.TOUCH_CANCEL,this._onTouchCancel,this,!0),this.view.node.on(c.EventType.TOUCH_MOVE,this._onTouchMove,this,!0)},i._bubbleToParent=function(t){this._parentAdapter&&this._parentAdapter.scrollManager.view.node.dispatchEvent(t)},i._emitCancelEvent=function(t){if(!this._isCanceledEvent){var e=t.getUILocation();e.subtract(t.getUIStartLocation()),this.cancelInnerEvents&&e.length()>7&&t.target!==this.view.node&&(this._simulateEvent(t,c.EventType.MOUSE_LEAVE),this._simulateEvent(t,c.EventType.TOUCH_CANCEL),this._isCanceledEvent=!0)}},i._simulateEvent=function(t,e,i){if(void 0===i&&(i=!0),t){var n=new J(t.getTouches(),t.bubbles),o=t.target;n.type=e,n.touch=t.touch,n.simulate=i,o.dispatchEvent(n)}},i._onUpdateViews=function(){this._velocity=0,this._updatePercentage()},i._onChangedVirtualSize=function(){this._updatePercentage(),null!=this._scrollHandlePosition&&null!=this._scrollHandlePosition.change&&this._scrollHandlePosition.change()},i._onChangedOverflowHeader=function(t){this.__drawDebug()},i._onResetAllState=function(){this._velocity=0,this._scrolling=!1,this._dragging=!1,this._isMyEventAndMoved=!1,this._scrollDirection=Ms.None,this._percentage=0,this._isEmitAboutToStop=!1,this._boundaryOffset=0,this._isCanceledEvent=!1,this._parentTouch=!1,this._stopCheckNested=!1,this._scrollDirection=Ms.None,this._touchEvent=null,this.stopScroll(),this._initView(),this._initContent()},i._onAdapterSizeChanged=function(){this._viewWidget.updateAlignment()},i._onViewSizeChanged=function(){this.emit(ru.ON_VIEW_SIZE_CHANGED)},i._isMyEvent=function(t,e){return t.eventPhase==J.AT_TARGET||!e||e[0]==this.view.node&&!t.target[ou]},i._onTouchStart=function(t){this._velocity=0,this._dragging=!0,this._isMyEventAndMoved=!1,this._isCanceledEvent=!1,this._parentTouch=!1,this._stopCheckNested=!1,this._isEmitAboutToStop=!1,this._scrollDirection=Ms.None,this._contentStartPosition.set(this.content.node.position),this._touchEvent=t,this.stopScroll(),this._calcNestedDirection(),this.emit(ru.ON_SCROLL_START)},i._onTouchEnd=function(t,e){this._dragging=!1,this._touchEvent=null,this.emit(ru.ON_SCROLL_END,t)},i._onTouchCancel=function(t,e){t.simulate||(this._dragging=!1,this._touchEvent=null,this.emit(ru.ON_SCROLL_CANCEL,t))},i._onTouchMove=function(t,e){if(this._isMyEvent(t,e)){if(this._emitCancelEvent(t),this._parentTouch||!this.canTouch)return this._bubbleToParent(t);if(this._touchEvent){var i=this.adapter.mainAxis,n=t.getUILocation(),o=t.getUIStartLocation(),r=n.subtract(o);if(!r.equals2f(0,0)){var a={x:0,y:0};a[i]=this._contentStartPosition[i]+r[i];var s=a[i]-this.contentPosition,l=this.calcOffset(s),c=this.adapter.isHorizontal?-1:1;a[i]+=c*l,this.movementType==_s.Elastic&&0!=l&&(a[i]-=c*this._rubberDelta(l,this.adapter.mainAxisSize)),this._checkNested(t,a,this._parentAdapter),this._parentTouch?this._bubbleToParent(t):(this._isMyEventAndMoved=!0,this._updateContentPosition(a))}}}},i._calcNestedDirection=function(){this._parentAdapter&&(this.percentage<=this.nestedMinThreshold&&!this.adapter.viewManager.loopHeader?this._nestedDirection=1==this.adapter.multiplier?Ns.Footer:Ns.Header:this.percentage>=this.nestedMaxThreshold&&!this.adapter.viewManager.loopFooter?this._nestedDirection=1==this.adapter.multiplier?Ns.Header:Ns.Footer:this._nestedDirection=Ns.Both)},i._checkNested=function(t,e,i){if(i&&!this._stopCheckNested){if(this.orientation==i.scrollManager.orientation){var n=e[this.adapter.mainAxis]-this._contentStartPosition[this.adapter.mainAxis];if(Math.abs(n)<=.1)return;this._nestedDirection==Ns.Footer?n<0&&(this._parentTouch=!0):this._nestedDirection==Ns.Header&&n>0&&(this._parentTouch=!0)}else{var o=0,r=0;if(t instanceof J){var a=t.getUIStartLocation(),s=t.getUILocation();o=Math.abs(a.x-s.x),r=Math.abs(a.y-s.y)}else o=Math.abs(t.getScrollX()),r=Math.abs(t.getScrollY());if(o==r)return;o>r?this.adapter.isVertical&&(this._parentTouch=!0):r>o&&this.adapter.isHorizontal&&(this._parentTouch=!0)}if(!this._parentTouch&&i.scrollManager.parentAdapter)return this._checkNested(t,e,i.scrollManager.parentAdapter);this._stopCheckNested=!0}},i._updateContentPosition=function(t,e){void 0===e&&(e=!0),this._updateScrollDirection(t),this.content.node.setPosition(t.x,t.y),this.emit(ru.ON_SCROLL,this._scrollDirection),e?this._updatePercentage():this.__drawDebug()},i._updatePrevContentPosition=function(){this._prevContentPosition.set(this.content.node.position)},i._calcPercentage=function(t,e){var i=this.internal_getHiddenSize(),n=this.adapter.viewManager.loopHeader,o=this.adapter.viewManager.loopFooter,r=this.adapter.multiplier,a=this.adapter.viewManager.overflowHeader,s=t*r;if(this.adapter.isHorizontal?s-=e*r:s+=e*r,o)s+=(a+(i+=this.adapter.viewManager.spacing)*r)*r,this.adapter.centerManager.enabled?s+=this.adapter.centerManager.getContainerOffset():s+=this.adapter.paddingHeader,s+=1,s%=i;else if(n){s+=this.adapter.mainAxisSize-1,this.adapter.centerManager.enabled?s-=this.adapter.centerManager.getContainerOffset():s-=this.adapter.paddingFooter,s+=(a+i*r)*r,t*-r>a*r&&(s+=this.adapter.viewManager.spacing),s%=i}else s+=a*r,this.adapter.centerManager.enabled?s+=this.adapter.centerManager.getContainerOffset():s+=this.adapter.paddingHeader,s>i&&(s=i);return s/i},i._updatePercentage=function(){var t=this.calcOffset();this.adapter.viewManager.virtualSize<=this.adapter.mainAxisSize?this._percentage=0:this._percentage=this._calcPercentage(this.contentPosition,t),this.emit(ru.ON_UPDATE_PERCENTAGE,this._percentage,t),this.__drawDebug()},i.internal_disableTouchTarget=function(t){if(this._touchEvent&&this._touchEvent.target==t){var e=this._touchEvent;this._simulateEvent(e,c.EventType.TOUCH_CANCEL,!1),this._simulateEvent(e,c.EventType.MOUSE_LEAVE,!1),this._touchEvent=null}},i.internal_getHiddenSize=function(){var t=this.adapter.viewManager.loopHeader,e=this.adapter.viewManager.loopFooter,i=this.adapter.viewManager.virtualSize;return t||e||this.adapter.centerManager.enabled||(i-=this.adapter.mainAxisSize,i+=this.adapter.mainAxisPadding),i},i._getContentMinBoundaryOffset=function(t,e){return!this.adapter.viewManager.header||!this.adapter.centerManager.enabled&&this.adapter.viewManager.virtualSize<=this.adapter.mainAxisSize?this.adapter.isHorizontal?e+this._defaultMax+t:e+this._defaultMin+t:this.adapter.viewManager.min+t},i._getContentMaxBoundaryOffset=function(t,e){return!this.adapter.viewManager.header||!this.adapter.centerManager.enabled&&this.adapter.viewManager.virtualSize<=this.adapter.mainAxisSize?this.adapter.isHorizontal?e+this._defaultMin+t:e+this._defaultMax+t:this.adapter.viewManager.max+t},i._getMaxBoundaryOffset=function(t){var e=this._viewMax;return this.adapter.isHorizontal?this.adapter.isArrangeAxisStart?t:e+t:this.adapter.isArrangeAxisStart?-t:e-t},i._getMinBoundaryOffset=function(t){var e=this._viewMin;return this.adapter.isHorizontal?this.adapter.isArrangeAxisStart?e+t:t:this.adapter.isArrangeAxisStart?e-t:-t},i._rubberDelta=function(t,e){return(1-1/(.55*Math.abs(t)/e+1))*e*Math.sign(t)},i._calcElastic=function(t,e,i){var n=this.adapter.mainAxis,o=this.elasticity;this._scrolling&&(o*=3);var r=this.adapter.isHorizontal?-1:1,a=Vs.smoothDamp(this.contentPosition,this.contentPosition+r*e,this._velocity,o,Vs.Infinity,t),s=a.velocity,l=a.position;Math.abs(s)<1&&(s=0),this._velocity=s,i[n]=l},i._calcInertia=function(t,e){this._velocity*=Math.pow(this.decelerationRate,t),Math.abs(this._velocity)<1&&(this._velocity=0),e[this.adapter.mainAxis]+=this._velocity*t},i._calcClamped=function(t){var e=this.adapter.mainAxis,i=t[e]-this.contentPosition,n=this.calcOffset(i);this.adapter.isHorizontal?t[e]-=n:t[e]+=n},i._updateScrollDirection=function(t){var e=t[this.adapter.mainAxis]-this.contentPosition;0!=e?(this.adapter.isHorizontal?this._scrollDirection=e>0?Ms.Right:Ms.Left:this._scrollDirection=e>0?Ms.Up:Ms.Down,this._laseScrollDirection=this._scrollDirection):this._scrollDirection=Ms.None},i.internal_setContentPosition=function(t,e){void 0===e&&(e=!0);var i={x:0,y:0};i[this.adapter.mainAxis]=t,this._updateContentPosition(i,e)},i.internal_lateUpdate=function(t){this.test||(this._autoScrolling(t),this._scrollHandler(t,this._scrollHandlePosition,this._scrollPositionHandler.bind(this)),this._scrollHandler(t,this._scrollHandlePercentage,this._scrollPercentageHandler.bind(this)))},i._autoScrolling=function(t){var e=this.calcOffset();if(this._boundaryOffset=e,this._dragging||0==e&&0==this._velocity||(this.content.node.getPosition(nu),this.movementType==_s.Elastic&&0!=e?this._calcElastic(t,e,nu):this.inertia?this._calcInertia(t,nu):this._velocity=0,this.movementType==_s.Clamped&&this._calcClamped(nu),this._updateContentPosition(nu)),this._dragging&&this.inertia){var i=(this.contentPosition-this._prevContentPosition[this.adapter.mainAxis])/t;this._velocity=Vs.lerp(this._velocity,i,10*t)}this._prevContentPosition.equals(this.content.node.position)||this._updatePrevContentPosition(),!this._isEmitAboutToStop&&!this._dragging&&Math.abs(this._velocity)<=this.aboutToStopVelocity&&(this._scrollHandlePercentage||this._scrollHandlePosition||(this.emit(ru.ON_ABOUT_TO_STOP,this._velocity),this._isEmitAboutToStop=!0)),this._scrolling=!1},i._scrollHandler=function(t,e,i){if(null!=e){e.deltaTime+=t;var n=e.deltaTime/(e.duration>Q.FLT_EPSILON?e.duration:Q.FLT_EPSILON);n=Vs.clamp01(n);var o=_.quintOut(n);e.current=Vs.progress(e.from,e.to,e.current,o),i(e,n)}},i._scrollPercentageHandler=function(t,e){var i=this.percentage;if(this.setPercentage(t.current),1==e||i==this.percentage){var n=!0;this._scrollHandlePercentage.stop&&(n=this._scrollHandlePercentage.stop()),n&&(this._scrollHandlePercentage=null)}},i._scrollPositionHandler=function(t,e){var i={x:0,y:0};i[this.adapter.mainAxis]=t.current,this._setAutoScroll(i),(1==e||Math.abs(this.contentPosition-t.to)<=1e-4)&&(this._scrollHandlePosition.stop&&this._scrollHandlePosition.stop(),this._scrollHandlePosition=null)},i._setAutoScroll=function(t){var e=this,i=function(t){e._updateContentPosition(t),e._updatePrevContentPosition(),e._velocity=0};i(t);var n=this.calcOffset();if(0!=n){var o=this.adapter.isHorizontal?-1:1;return t[this.adapter.mainAxis]+=n*o,i(t),!1}return!0},i._scrollToPosition=function(t,e,i){var n=this;if(!this.canAutoScroll)return!1;var o=e();return!(null==o||Math.abs(this.contentPosition-o)<Q.FLT_EPSILON)&&(this._scrollHandlePercentage=null,this._scrollHandlePosition={current:0,from:this.contentPosition,to:o,deltaTime:0,duration:Math.max(0,t),change:function(){o=e(),n._scrollHandlePosition.to=o},stop:function(){i()}},!0)},i.getLayerNode=function(t){switch(t){case Ts.Medium:return this._layerMedium;case Ts.Highest:return this._layerHighest;default:return this._layerLowest}},i.scrollToModelIndex=function(t,e,i){var n=this,o=this.adapter.viewManager.getGroupIndexByModelIndex(e);if(-1!=o){var r=!1;this._scrollToPosition(t,(function(){var t=n.adapter.centerManager.getPositionByGroupIndex(o,i,r);return r=!0,t}),(function(){n.emit(ru.ON_SCROLL_TO_MODELINDEX_AFTER,e)}))&&this.emit(ru.ON_SCROLL_TO_MODELINDEX_BEFOR,e)}},i.scrollToGroupIndex=function(t,e,i){var n=this,o=!1;this._scrollToPosition(t,(function(){var t=n.adapter.centerManager.getPositionByGroupIndex(e,i,o);return o=!0,t}),(function(){n.emit(ru.ON_SCROLL_TO_GROUPINDEX_AFTER,e)}))&&this.emit(ru.ON_SCROLL_TO_GROUPINDEX_BEFOR,e)},i.scrollToHeader=function(t){this.scrollToGroupIndex(t,0)},i.scrollToFooter=function(t){this.scrollToGroupIndex(t,this.adapter.viewManager.groupLength-1)},i.scrollToPercentage=function(t,e){if(!this.canAutoScroll)return!1;Math.abs(this._percentage-e)<.001||(e=Vs.clamp01(e),t=Math.max(0,t),this._scrollHandlePercentage=null,this._scrollHandlePercentage={deltaTime:0,duration:t,current:0,from:this._percentage,to:e})},i.stopVelocity=function(){this._velocity=0},i.setVelocity=function(t){this._velocity=t},i.stopScroll=function(){this._scrollHandlePosition=null,this._scrollHandlePercentage=null,this.stopVelocity()},i.setPercentage=function(t){for(var e=this.internal_getHiddenSize(),i={x:0,y:0},n=0,o=null;n<100;){n++;var r=this._percentage-t;if(null!=o&&this._percentage===o)break;if(Math.abs(r)<Q.FLT_EPSILON)break;o=this._percentage;var a=this.contentPosition-r*this.adapter.multiplier*e;if(i[this.adapter.mainAxis]=a,!this._setAutoScroll(i))break}100==n&&console.warn("Số vòng lặp đã đạt đến giá trị tối đa. Cố gắng không sửa đổi kích thước thường xuyên trong quá trình cuộn.")},i.calcOffset=function(t,e){void 0===t&&(t=0),void 0===e&&(e=this.contentPosition);var i=0;if(this.movementType==_s.Unrestricted)return i;var n=this._getContentMaxBoundaryOffset(t,e),o=this._getContentMinBoundaryOffset(t,e),r=this._getMaxBoundaryOffset(n),a=this._getMinBoundaryOffset(o);!this.adapter.centerManager.enabled&&this.adapter.viewManager.virtualSize>this.adapter.mainAxisSize&&(this.adapter.isVertical?(r-=this.adapter.viewManager.top,a+=this.adapter.viewManager.bottom):(r-=this.adapter.viewManager.left,a+=this.adapter.viewManager.right));var s=0,l=0;if(this.adapter.centerManager.enabled&&this.adapter.viewManager.groupLength>0)l=this.adapter.centerManager.max,s=this.adapter.centerManager.min;else{var c=this.adapter.viewManager.getMagneticOffset();r-=c,a-=c}return this.adapter.releaseManager.enabled&&(l=Math.max(l,this.adapter.releaseManager.max),s=Math.max(s,this.adapter.releaseManager.min)),r-=l,(a+=s)<-.001?i=a:r>.001&&(i=r),i},Ft(e,[{key:"view",get:function(){return this._view},set:function(t){this._view=t}},{key:"content",get:function(){return this._content},set:function(t){this._content=t}},{key:"orientation",get:function(){return this._orientation},set:function(t){t!=this._orientation&&(this._orientation=t,this.emit(ru.ON_CHANGED_ORIENTATION))}},{key:"_viewMin",get:function(){return-this.adapter.mainAxisSize}},{key:"_viewMax",get:function(){return this.adapter.mainAxisSize}},{key:"_defaultMin",get:function(){return 1==this.adapter.multiplier?-this.adapter.mainAxisSize:0}},{key:"_defaultMax",get:function(){return 1==this.adapter.multiplier?0:this.adapter.mainAxisSize}},{key:"isMyEventAndMoved",get:function(){return this._isMyEventAndMoved}},{key:"velocity",get:function(){return this._velocity}},{key:"scrollDirection",get:function(){return this._scrollDirection}},{key:"laseScrollDirection",get:function(){return this._laseScrollDirection}},{key:"percentage",get:function(){return this._percentage}},{key:"dragging",get:function(){return this._dragging}},{key:"boundaryOffset",get:function(){return this._boundaryOffset}},{key:"parentAdapter",get:function(){return this._parentAdapter}},{key:"canAutoScroll",get:function(){return!this.dragging&&this.adapter.viewManager.virtualSize>this.adapter.mainAxisSize}},{key:"canTouch",get:function(){return this.touchMode==Es.AlwaysAllow||this.touchMode!=Es.Disabled&&(!!this.adapter.centerManager.enabled||(!!this.adapter.releaseManager.enabled||this.adapter.viewManager.virtualSize>this.adapter.mainAxisSize))}},{key:"contentPosition",get:function(){return this.content.node.position[this.adapter.mainAxis]}}]),e}(Gs)).Event=ru,Pc=It((Ac=Vc).prototype,"_view",[hc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),It(Ac.prototype,"view",[pc],Object.getOwnPropertyDescriptor(Ac.prototype,"view"),Ac.prototype),Mc=It(Ac.prototype,"_content",[dc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),It(Ac.prototype,"content",[fc],Object.getOwnPropertyDescriptor(Ac.prototype,"content"),Ac.prototype),Ic=It(Ac.prototype,"_orientation",[gc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return bs.Vertical}}),It(Ac.prototype,"orientation",[mc],Object.getOwnPropertyDescriptor(Ac.prototype,"orientation"),Ac.prototype),Nc=It(Ac.prototype,"touchMode",[vc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Es.Auto}}),Oc=It(Ac.prototype,"movementType",[yc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return _s.Elastic}}),Lc=It(Ac.prototype,"elasticity",[bc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.1}}),Rc=It(Ac.prototype,"inertia",[iu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),xc=It(Ac.prototype,"decelerationRate",[_c],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.135}}),Fc=It(Ac.prototype,"aboutToStopVelocity",[Sc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 100}}),Dc=It(Ac.prototype,"cancelInnerEvents",[wc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),zc=It(Ac.prototype,"nestedMinThreshold",[Tc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.001}}),kc=It(Ac.prototype,"nestedMaxThreshold",[Cc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.999}}),Ec=Ac))||Ec);t._RF.pop(),t._RF.push({},"e5ff40NmxhKAaD04pv29iQm","CenterManager",void 0);var su,lu,cu,uu,hu,pu,du,fu,gu,mu,vu,yu,bu,_u,Su=e.ccclass,wu=e.property,Tu=(Wc=Su("CenterManager"),qc=wu("boolean"),Zc=wu({visible:function(){return this.enabled},tooltip:"自动居中动画的时长"}),Yc=wu({range:[0,1],slide:!0,step:.1,tooltip:"容器(view)的锚点,当滚动停止时,元素锚点位置会和容器锚点位置重合"}),jc=wu({range:[0,1],slide:!0,step:.1,tooltip:"元素(item)的锚点位置,当滚动停止时,元素锚点位置会和容器锚点位置重合"}),Wc((Jc=It((Xc=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,Ot(e,"_enabled",Jc,Lt(e)),Ot(e,"duration",Qc,Lt(e)),Ot(e,"containerAnchorPoint",$c,Lt(e)),Ot(e,"elementAnchorPoint",tu,Lt(e)),e}Nt(e,t);var i=e.prototype;return i.getContainerOffset=function(t){void 0===t&&(t=this.containerAnchorPoint);var e=0;return e=this.adapter.isHorizontal?-1==this.adapter.multiplier?t:1-t:1==this.adapter.multiplier?t:1-t,this.adapter.mainAxisSize*e},i.getElementOffset=function(t){void 0===t&&(t=this.elementAnchorPoint);return this.adapter.isHorizontal?-1==this.adapter.multiplier?t:1-t:1==this.adapter.multiplier?t:1-t},i.onInit=function(){this.adapter.scrollManager.on(au.Event.ON_ABOUT_TO_STOP,this._onAboutToStop,this),this.adapter.viewManager.on(Gc.Event.ON_UPDATE_VIEWS,this.scrollToCenter,this,!0)},i._onAboutToStop=function(){this.scrollToCenter()},i.scrollToCenter=function(t){if(void 0===t&&(t=this.duration),this.enabled){var e=this.getCenterVisibleIndex();if(-1!=e){var i=this.adapter.viewManager.getVisibleView(e);this.adapter.scrollManager.scrollToGroupIndex(t,i.index)}}},i.getCenterVisibleIndex=function(t,e){void 0===t&&(t=this.containerAnchorPoint),void 0===e&&(e=this.elementAnchorPoint);for(var i=this.adapter.mainAxis,n=this.getContainerOffset(t),o=-1,r=Number.MAX_SAFE_INTEGER,a=0;a<this.adapter.viewManager.visibleLength;a++){var s=this.adapter.viewManager.getVisibleView(a);if(!s||!s.group)break;var l={x:s.group.position.x,y:s.group.position.y};l[i]-=this.adapter.multiplier*s.group.size[i]*e;var c=this.adapter.scrollManager.content.convertToWorldSpaceAR(m(l.x,l.y)),u=this.adapter.scrollManager.view.convertToNodeSpaceAR(c),h=Math.abs(u[i]+this.adapter.multiplier*n);h<r&&(r=h,o=a)}return o},i.getPositionByGroupIndex=function(t,e,i){void 0===e&&(e=Os.Auto),void 0===i&&(i=!1);var n=this.adapter.viewManager.getGroup(t);if(!n)return null;var o=null;if(e==Os.Header&&this.adapter.viewManager.loopHeader)i&&(o=this._checkExists(t)),null==o&&(o=this._alwaysHeader(t,n));else if(e==Os.Footer&&this.adapter.viewManager.loopFooter)i&&(o=this._checkExists(t)),null==o&&(o=this._alwaysFooter(t,n));else if(null==(o=this._checkExists(t))){var r=this.adapter.viewManager.header,a=this.adapter.viewManager.footer;r?t>a.index?o=this._calcTargetFooter(a.group,a.index+1,t,n):t<r.index&&(o=this._calcTargetHeader(r.group,r.index-1,t,n)):o={position:n.position[this.adapter.mainAxis],size:n.size[this.adapter.mainAxis],anchor:n.anchorPoint[this.adapter.mainAxis]}}return this._convertTargetToPosition(o)},i._convertTargetToPosition=function(t){var e=null;if(t){var i=this.adapter.multiplier,n=-1==i?t.anchor:1-t.anchor;e=-t.position,e-=this.getContainerOffset()*i,e-=t.size*n*i,e+=t.size*this.getElementOffset()*i}return e},i._checkExists=function(t){var e=this.adapter.viewManager.getVisibleIndexByGroupIndex(t);if(-1!=e){var i=this.adapter.viewManager.getVisibleView(e);return{position:i.group.position[this.adapter.mainAxis],size:i.group.size[this.adapter.mainAxis],anchor:i.group.anchorPoint[this.adapter.mainAxis]}}return null},i._calcTargetFooter=function(t,e,i,n){for(var o=this.adapter.viewManager.internal_getInitFooterSize(t),r=e;r<=i;r++)o+=this.adapter.viewManager.internal_accumulationSize(r);return{position:this.adapter.viewManager.internal_convertSizeToFooterPosition(o,n),size:n.size[this.adapter.mainAxis],anchor:n.anchorPoint[this.adapter.mainAxis]}},i._calcTargetHeader=function(t,e,i,n){for(var o=this.adapter.viewManager.internal_getInitHeaderSize(t),r=e;r>=i;r--)o+=this.adapter.viewManager.internal_accumulationSize(r);return{position:this.adapter.viewManager.internal_convertSizeToHeaderPosition(o,n),size:n.size[this.adapter.mainAxis],anchor:n.anchorPoint[this.adapter.mainAxis]}},i._alwaysHeader=function(t,e){var i=0,n=t,o=this.adapter.viewManager.header;return o&&(i=this.adapter.viewManager.internal_getInitHeaderSize(o.group),n=o.index),t!=n&&(i=this._calcSizeToHeader(n,t,i)),{position:this.adapter.viewManager.internal_convertSizeToHeaderPosition(i,e),size:e.size[this.adapter.mainAxis],anchor:e.anchorPoint[this.adapter.mainAxis]}},i._alwaysFooter=function(t,e){var i=0,n=t,o=this.adapter.viewManager.footer;return o&&(i=this.adapter.viewManager.internal_getInitFooterSize(o.group),n=o.index),t!=n&&(i=this._calcSizeToFooter(n,t,i)),{position:this.adapter.viewManager.internal_convertSizeToFooterPosition(i,e),size:e.size[this.adapter.mainAxis],anchor:e.anchorPoint[this.adapter.mainAxis]}},i._calcSizeToHeader=function(t,e,i){for(;;){if(--t<0){if(!this.adapter.viewManager.loopHeader)return i;t=this.adapter.viewManager.groupLength-1}if(i+=this.adapter.viewManager.internal_accumulationSize(t),e==t)return i}},i._calcSizeToFooter=function(t,e,i){for(;;){if(++t>=this.adapter.viewManager.groupLength){if(!this.adapter.viewManager.loopFooter)return i;t=0}if(i+=this.adapter.viewManager.internal_accumulationSize(t),t==e)return i}},Ft(e,[{key:"enabled",get:function(){return this._enabled},set:function(t){t!=this._enabled&&(this._enabled=t)}},{key:"max",get:function(){var t=this.getContainerOffset(this.containerAnchorPoint);return this.adapter.isArrangeAxisStart?t:this.adapter.mainAxisSize-t}},{key:"min",get:function(){var t=this.getContainerOffset(this.containerAnchorPoint);return this.adapter.isArrangeAxisStart?this.adapter.mainAxisSize-t:t}}]),e}(Gs)).prototype,"_enabled",[wu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),It(Xc.prototype,"enabled",[qc],Object.getOwnPropertyDescriptor(Xc.prototype,"enabled"),Xc.prototype),Qc=It(Xc.prototype,"duration",[Zc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),$c=It(Xc.prototype,"containerAnchorPoint",[Yc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),tu=It(Xc.prototype,"elementAnchorPoint",[jc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Kc=Xc))||Kc);t._RF.pop(),t._RF.push({},"e3a2d9kCydCzZKVh5E8qZ8J","PageViewManager",void 0);var Cu,Eu,Au,Pu,Mu,Iu,Nu,Ou,Lu,Ru,xu,Fu,Du,zu,ku=e.ccclass,Vu=e.property,Bu=function(t){return t[t.ON_PAGE_LENGTH_CHANGED=0]="ON_PAGE_LENGTH_CHANGED",t[t.ON_SCROLL_PAGE_BEFOR=1]="ON_SCROLL_PAGE_BEFOR",t[t.ON_SCROLL_PAGE_END=2]="ON_SCROLL_PAGE_END",t}(Bu||{}),Hu=(su=ku("PageViewManager"),lu=Vu("boolean"),cu=Vu({range:[0,1],slide:!0,step:.01,visible:function(){return this.enabled},tooltip:"滚动临界值，默认单位百分比，当拖拽超出该数值时，松开会自动滚动下一页，小于时则还原"}),uu=Vu({range:[0,1],slide:!0,step:.01,visible:function(){return this.enabled},tooltip:"设置 PageView PageTurning 事件的发送时机"}),hu=Vu({visible:function(){return this.enabled},tooltip:"快速滑动翻页临界值\n        当用户快速滑动时，会根据滑动开始和结束的距离与时间计算出一个速度值\n        该值与此临界值相比较，如果大于临界值，则进行自动翻页"}),pu=Vu({visible:function(){return this.enabled},tooltip:"每个页面翻页时所需时间。单位：秒"}),su(((_u=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,Ot(e,"_enabled",gu,Lt(e)),Ot(e,"scrollThreshold",mu,Lt(e)),Ot(e,"pageTurningEventTiming",vu,Lt(e)),Ot(e,"autoPageTurningThreshold",yu,Lt(e)),Ot(e,"pageTurningSpeed",bu,Lt(e)),e._currentIndex=0,e}Nt(e,t);var i=e.prototype;return i.onInit=function(){this._register()},i._register=function(){this.adapter&&this.enabled&&(this.adapter.scrollManager.on(au.Event.ON_SCROLL_END,this._handleReleaseLogic,this),this.adapter.scrollManager.on(au.Event.ON_SCROLL_CANCEL,this._handleReleaseLogic,this),this.adapter.scrollManager.on(au.Event.ON_SCROLL_TO_GROUPINDEX_BEFOR,this._onScrollToIndex,this),this.adapter.viewManager.on(Gc.Event.ON_UPDATE_VIEWS,this._onUpdateViews,this,!0))},i._unregister=function(){this.adapter&&!this.enabled&&(this.adapter.scrollManager.off(au.Event.ON_SCROLL_END,this._handleReleaseLogic,this),this.adapter.scrollManager.off(au.Event.ON_SCROLL_CANCEL,this._handleReleaseLogic,this),this.adapter.scrollManager.off(au.Event.ON_SCROLL_TO_GROUPINDEX_BEFOR,this._onScrollToIndex,this),this.adapter.viewManager.off(Gc.Event.ON_UPDATE_VIEWS,this._onUpdateViews,this))},i.scrollToPage=function(t,e,i){e<0||e>=this.length||e==this.currentIndex&&0!=this.adapter.scrollManager.calcOffset()||(this.adapter.scrollManager.scrollToGroupIndex(t,e,i),this.emit(Bu.ON_SCROLL_PAGE_BEFOR,e))},i.scrollToPrevPage=function(t,e){void 0===t&&(t=this.pageTurningSpeed),void 0===e&&(e=Os.Header),0!=this._currentIndex?this.scrollToPage(t,this._currentIndex-1,e):this.adapter.viewManager.loopHeader&&this.scrollToPage(t,this.length-1,e)},i.scrollToNextPage=function(t,e){void 0===t&&(t=this.pageTurningSpeed),void 0===e&&(e=Os.Footer),this._currentIndex>=this.length-1?this.adapter.viewManager.loopFooter&&this.scrollToPage(t,0,e):this.scrollToPage(t,this._currentIndex+1,e)},i._onUpdateViews=function(){this.emit(Bu.ON_PAGE_LENGTH_CHANGED),this._currentIndex=0,this.scrollToPage(this.pageTurningSpeed,this._currentIndex)},i._onScrollToIndex=function(t){this._currentIndex=t,this.emit(Bu.ON_SCROLL_PAGE_END,t)},i._handleReleaseLogic=function(t){if(this._enabled&&this.adapter.scrollManager.isMyEventAndMoved){var e=t.getUIStartLocation()[this.adapter.mainAxis]-t.getUILocation()[this.adapter.mainAxis],i=this._getNextIndex(e);this._isScrollable(e)||this._isQuicklyScrollable(this.adapter.scrollManager.velocity)?this.scrollToPage(this.pageTurningSpeed,i):this.scrollToPage(this.pageTurningSpeed,this._currentIndex)}},i._getNextIndex=function(t){var e=this._currentIndex;return this.adapter.isHorizontal?this.adapter.isArrangeAxisStart?t>0?e++:t<0&&e--:(t<0&&e++,t>0&&e--):this.adapter.isArrangeAxisStart?t<0?e++:t>0&&e--:t>0?e++:t<0&&e--,e>=this.length&&this.adapter.viewManager.loopFooter?e=0:e<0&&this.adapter.viewManager.loopHeader&&(e=this.length-1),(e<0||e>=this.length)&&(e=this._currentIndex),e},i._isScrollable=function(t){return Math.abs(t)>=this.adapter.mainAxisSize*this.scrollThreshold},i._isQuicklyScrollable=function(t){return Math.abs(t)>this.autoPageTurningThreshold},Ft(e,[{key:"enabled",get:function(){return this._enabled},set:function(t){t!=this._enabled&&(this._enabled=t,this._enabled?this._register():this._unregister())}},{key:"currentIndex",get:function(){return this._currentIndex}},{key:"length",get:function(){return this.adapter.viewManager.groupLength}}]),e}(Gs)).Event=Bu,gu=It((fu=_u).prototype,"_enabled",[Vu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),It(fu.prototype,"enabled",[lu],Object.getOwnPropertyDescriptor(fu.prototype,"enabled"),fu.prototype),mu=It(fu.prototype,"scrollThreshold",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),vu=It(fu.prototype,"pageTurningEventTiming",[uu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.1}}),yu=It(fu.prototype,"autoPageTurningThreshold",[hu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 100}}),bu=It(fu.prototype,"pageTurningSpeed",[pu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.3}}),du=fu))||du);t._RF.pop(),t._RF.push({},"797a5chXbhC64OnuHlVCMHV","ReleaseManager",void 0);var Uu,Gu,Wu,qu,Zu,Yu,ju,Ku,Xu,Ju,Qu,$u,th,eh,ih,nh=e.ccclass,oh=e.property,rh=function(t){return t[t.ON_PULL_UP=0]="ON_PULL_UP",t[t.ON_PULL_DOWN=1]="ON_PULL_DOWN",t[t.ON_PULL_LEFT=2]="ON_PULL_LEFT",t[t.ON_PULL_RIGHT=3]="ON_PULL_RIGHT",t}(rh||{}),ah=(Cu=nh("ReleaseManager"),Eu=oh("boolean"),Au=oh({range:[0,1],slide:!0,step:.01,visible:function(){return this.enabled},tooltip:"根据此阈值来切换state状态"}),Pu=oh({range:[0,1],slide:!0,step:.01,visible:function(){return this.enabled},tooltip:"根据此阈值来切换state状态"}),Mu=oh({range:[0,1],slide:!0,step:.01,visible:function(){return this.enabled},tooltip:"根据此阈值来切换state状态"}),Iu=oh({range:[0,1],slide:!0,step:.01,visible:function(){return this.enabled},tooltip:"根据此阈值来切换state状态"}),Cu(((zu=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,Ot(e,"_enabled",Lu,Lt(e)),Ot(e,"left",Ru,Lt(e)),Ot(e,"right",xu,Lt(e)),Ot(e,"top",Fu,Lt(e)),Ot(e,"bottom",Du,Lt(e)),e._pullUp=void 0,e._pullDown=void 0,e._pullLeft=void 0,e._pullRight=void 0,e}Nt(e,t);var i=e.prototype;return i.onInit=function(){this.enabled&&(this._pullUp=new sh(this,rh.ON_PULL_UP,this.bottom),this._pullDown=new sh(this,rh.ON_PULL_DOWN,this.top),this._pullLeft=new sh(this,rh.ON_PULL_LEFT,this.right),this._pullRight=new sh(this,rh.ON_PULL_RIGHT,this.left),this.adapter.scrollManager.on(au.Event.ON_SCROLL_START,this.onScrollStart,this),this.adapter.scrollManager.on(au.Event.ON_SCROLL_END,this.onScrollEnd,this),this.adapter.scrollManager.on(au.Event.ON_SCROLL_CANCEL,this.onScrollEnd,this),this.checkLoop())},i.checkLoop=function(){this.adapter.isHorizontal?this.adapter.isArrangeAxisStart?(this.left>0&&(this.adapter.viewManager.loopHeader=!1),this.right>0&&(this.adapter.viewManager.loopFooter=!1)):(this.left>0&&(this.adapter.viewManager.loopFooter=!1),this.right>0&&(this.adapter.viewManager.loopHeader=!1)):this.adapter.isArrangeAxisStart?(this.top>0&&(this.adapter.viewManager.loopHeader=!1),this.bottom>0&&(this.adapter.viewManager.loopFooter=!1)):(this.top>0&&(this.adapter.viewManager.loopFooter=!1),this.bottom>0&&(this.adapter.viewManager.loopHeader=!1))},i.onScrollStart=function(){this.adapter.isHorizontal?(this.left>0&&this._pullRight._setState(xs.IDLE),this.right>0&&this._pullLeft._setState(xs.IDLE)):(this.top>0&&this._pullDown._setState(xs.IDLE),this.bottom>0&&this._pullUp._setState(xs.IDLE))},i.onScrollEnd=function(){this.adapter.isHorizontal?(this.left>0&&this._pullRight._setState(xs.RELEASE),this.right>0&&this._pullLeft._setState(xs.RELEASE)):(this.top>0&&this._pullDown._setState(xs.RELEASE),this.bottom>0&&this._pullUp._setState(xs.RELEASE))},i.internal_lateUpdate=function(t){if(this.enabled){var e=this.adapter.scrollManager.boundaryOffset;this.adapter.scrollManager.dragging||(e=0),this.adapter.isHorizontal?(this.left>0&&this._pullRight._set(Math.max(-e,0),e<0),this.right>0&&this._pullLeft._set(Math.max(e,0),e>0)):(this.top>0&&this._pullDown._set(Math.max(e,0),e>0),this.bottom>0&&this._pullUp._set(Math.max(-e,0),e<0))}},Ft(e,[{key:"enabled",get:function(){return this._enabled},set:function(t){t!=this._enabled&&(this._enabled=t)}},{key:"max",get:function(){return this.enabled?this.adapter.isHorizontal?this._pullLeft?this._pullLeft.expand:0:this._pullDown?this._pullDown.expand:0:0}},{key:"min",get:function(){return this.enabled?this.adapter.isHorizontal?this._pullRight?this._pullRight.expand:0:this._pullUp?this._pullUp.expand:0:0}}]),e}(Gs)).Event=rh,Lu=It((Ou=zu).prototype,"_enabled",[oh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),It(Ou.prototype,"enabled",[Eu],Object.getOwnPropertyDescriptor(Ou.prototype,"enabled"),Ou.prototype),Ru=It(Ou.prototype,"left",[Au],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),xu=It(Ou.prototype,"right",[Pu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Fu=It(Ou.prototype,"top",[Mu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Du=It(Ou.prototype,"bottom",[Iu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Nu=Ou))||Nu),sh=function(){function t(t,e,i){this._expand=0,this._progress=0,this._offset=0,this._state=void 0,this._defaultPercentage=void 0,this._manager=void 0,this._event=void 0,this._stop=void 0,this._defaultPercentage=i,this._manager=t,this._event=e}var e=t.prototype;return e._set=function(t,e){e&&(this._stop=!1),this._stop||(this._offset=t,this._progress=t/(this._defaultPercentage*this._manager.adapter.mainAxisSize),this._stop=this._offset<=.1,this._setState(xs.PULL),this._manager.emit(this._event,this))},e._setState=function(t){this._state!=xs.WAIT&&(t==xs.PULL&&this._state==xs.RELEASE||(this._state=t))},e.wait=function(t){void 0===t&&(t=this._defaultPercentage*this._manager.adapter.mainAxisSize),this._expand=t,this._state=xs.WAIT},e.release=function(){this._expand=0,this._state=xs.IDLE,this.offset<=.1&&(this._offset=0,this._progress=0,this._manager.emit(this._event,this))},Ft(t,[{key:"expand",get:function(){return this._expand}},{key:"progress",get:function(){return this._progress}},{key:"offset",get:function(){return this._offset}},{key:"state",get:function(){return this._state}}]),t}();t._RF.pop(),t._RF.push({},"4f9c5h5sDhP/78kLerCTNfA","ScrollAdapter",void 0);var lh,ch,uh,hh,ph,dh,fh,gh,mh,vh,yh,bh=e.ccclass,_h=e.property,Sh=(Uu=bh("ScrollAdapter"),Gu=_h(au),Wu=_h(Gc),qu=_h(El),Zu=_h(Hu),Yu=_h(ah),ju=_h(Tu),Uu((Ju=It((Xu=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,Ot(e,"scrollManager",Ju,Lt(e)),Ot(e,"viewManager",Qu,Lt(e)),Ot(e,"layoutManager",$u,Lt(e)),Ot(e,"pageViewManager",th,Lt(e)),Ot(e,"releaseManager",eh,Lt(e)),Ot(e,"centerManager",ih,Lt(e)),e.modelManager=new Ys,e}Nt(e,t);var i=e.prototype;return i.initElement=function(t,e){},i.getView=function(){return new wh(this)},i.getHolder=function(t,e){return new Th(t,e,this)},i.getParentAdapter=function(t){if(null!=t){var e=t.getComponent("ScrollAdapter");return e||this.getParentAdapter(t.parent)}},i.__preload=function(){this.scrollManager.internal_create(this),this.viewManager.internal_create(this),this.modelManager.internal_create(this),this.releaseManager.internal_create(this),this.layoutManager.internal_create(this),this.pageViewManager.internal_create(this),this.centerManager.internal_create(this),this.viewManager.internal_init(),this.releaseManager.internal_init(),this.layoutManager.internal_init(),this.pageViewManager.internal_init(),this.centerManager.internal_init(),this.scrollManager.internal_init(),this.modelManager.internal_init()},i.lateUpdate=function(t){this.scrollManager.internal_lateUpdate(t),this.viewManager.internal_lateUpdate(t),this.layoutManager.internal_lateUpdate(t),this.releaseManager.internal_lateUpdate(t)},Ft(e,[{key:"isVertical",get:function(){return this.scrollManager.orientation==bs.Vertical}},{key:"isHorizontal",get:function(){return this.scrollManager.orientation==bs.Horizontal}},{key:"isArrangeAxisStart",get:function(){return this.viewManager.arrangeAxis==Ss.Start}},{key:"mainAxis",get:function(){return this.isVertical?"y":"x"}},{key:"crossAxis",get:function(){return this.isVertical?"x":"y"}},{key:"mainAxisAnchorPoint",get:function(){var t=this.isVertical?1:0;return this.isArrangeAxisStart?t:1-t}},{key:"mainAxisSize",get:function(){return this.scrollManager.view.contentSize[this.mainAxis]}},{key:"crossAxisSize",get:function(){return this.scrollManager.view.contentSize[this.crossAxis]}},{key:"multiplier",get:function(){var t=this.isVertical?-1:1;return this.isArrangeAxisStart?-t:t}},{key:"paddingHeader",get:function(){return this.isHorizontal?this.isArrangeAxisStart?this.viewManager.left:this.viewManager.right:this.isArrangeAxisStart?this.viewManager.top:this.viewManager.bottom}},{key:"paddingFooter",get:function(){return this.isHorizontal?this.isArrangeAxisStart?this.viewManager.right:this.viewManager.left:this.isArrangeAxisStart?this.viewManager.bottom:this.viewManager.top}},{key:"mainAxisPadding",get:function(){return this.isHorizontal?this.viewManager.left+this.viewManager.right:this.viewManager.top+this.viewManager.bottom}}]),e}(r)).prototype,"scrollManager",[Gu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new au}}),Qu=It(Xu.prototype,"viewManager",[Wu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Gc}}),$u=It(Xu.prototype,"layoutManager",[qu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new El}}),th=It(Xu.prototype,"pageViewManager",[Zu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Hu}}),eh=It(Xu.prototype,"releaseManager",[Yu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new ah}}),ih=It(Xu.prototype,"centerManager",[ju],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Tu}}),Ku=Xu))||Ku),wh=function(t){function e(){return t.apply(this,arguments)||this}Nt(e,t);var i=e.prototype;return i.onVisible=function(){this.adapter.node.emit(Ds.VISIBLE,this)},i.onDisable=function(){this.adapter.node.emit(Ds.DISABLE,this)},e}(lc),Th=function(t){function e(){return t.apply(this,arguments)||this}Nt(e,t);var i=e.prototype;return i.onCreated=function(){this.node.emit(Fs.CREATED,this)},i.onVisible=function(){this.node.emit(Fs.VISIBLE,this)},i.onDisable=function(){this.node.emit(Fs.DISABLE,this)},e}(Ks);t._RF.pop(),t._RF.push({},"518d6bEinVOEZVOae09QC8Z","Indicator",void 0);var Ch,Eh,Ah,Ph,Mh,Ih,Nh,Oh,Lh,Rh,xh,Fh,Dh,zh,kh,Vh,Bh,Hh,Uh,Gh,Wh,qh,Zh,Yh,jh,Kh,Xh,Jh,Qh,$h,tp,ep,ip,np,op,rp,ap,sp,lp,cp,up=e.ccclass,hp=e.property;lh=up("Indicator"),ch=hp(Sh),uh=hp({type:i}),hh=hp({type:Ls}),lh((fh=It((dh=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,Ot(e,"adapter",fh,Lt(e)),Ot(e,"spriteFrame",gh,Lt(e)),Ot(e,"indicatorMode",mh,Lt(e)),Ot(e,"cellSize",vh,Lt(e)),Ot(e,"spacing",yh,Lt(e)),e._indicators=[],e._layout=null,e._color=new X,e}Nt(e,t);var i=e.prototype;return i.__preload=function(){this.adapter&&(this.adapter.pageViewManager.on(Hu.Event.ON_PAGE_LENGTH_CHANGED,this._onPageLengthChanged,this),this.adapter.pageViewManager.on(Hu.Event.ON_SCROLL_PAGE_END,this._onScrollPageEnd,this))},i._onScrollPageEnd=function(){this.changedState()},i._onPageLengthChanged=function(){if(this.adapter){var t=this._indicators,e=this.adapter.viewManager.groupLength;if(e!==t.length){var i=0;if(e>t.length)for(i=0;i<e;++i)t[i]||(t[i]=this._createIndicator(i));else for(i=t.length-e;i>0;--i){var n=t[i-1];this.node.removeChild(n.node),t.splice(i-1,1)}this.layout&&this.layout.enabledInHierarchy&&this.layout.updateLayout(),this.changedState()}}},i._createIndicator=function(t){var e=new c;e.layer=this.node.layer;var i=e.addComponent(f);i.spriteFrame=this.spriteFrame,i.sizeMode=f.SizeMode.CUSTOM,e.parent=this.node;var n=e.getComponent(B);if(n.setContentSize(this.cellSize),this.indicatorMode==Ls.Button){var o=e.getComponent(x)||e.addComponent(x),r=new F;r.component="Indicator",r.handler="_click",r.target=this.node,r.customEventData=t,o.clickEvents.push(r)}return n},i._click=function(t,e){this.adapter.pageViewManager.scrollToPage(this.adapter.pageViewManager.pageTurningSpeed,e)},i.changedState=function(){var t=this._indicators;if(0!==t.length&&this.adapter){var e=this.adapter.pageViewManager.currentIndex;if(!(e>=t.length)){for(var i=0;i<t.length;++i){var n=t[i].getComponent(f);this._color.set(n.color),this._color.a=127.5,n.color=this._color}if(t[e]){var o=t[e].getComponent(f);this._color.set(o.color),this._color.a=255,o.color=this._color}}}},Ft(e,[{key:"layout",get:function(){return null==this._layout&&(this._layout=this.getComponent($)||this.addComponent($),this.adapter.isHorizontal?(this._layout.type=$.Type.HORIZONTAL,this._layout.spacingX=this.spacing):(this._layout.type=$.Type.VERTICAL,this._layout.spacingY=this.spacing),this._layout.resizeMode=$.ResizeMode.CONTAINER),this._layout}}]),e}(r)).prototype,"adapter",[ch],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),gh=It(dh.prototype,"spriteFrame",[uh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),mh=It(dh.prototype,"indicatorMode",[hh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Ls.Normal}}),vh=It(dh.prototype,"cellSize",[hp],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new tt(10,10)}}),yh=It(dh.prototype,"spacing",[hp],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 10}}),ph=dh));t._RF.pop(),t._RF.push({},"67fa5ko0UJAJpbCzgGfagdw","Scrollbar",void 0);var pp,dp,fp=e.ccclass,gp=e.property,mp=new X;Ch=fp("Scrollbar"),Eh=gp(Sh),Ah=gp(f),Ph=gp({type:Is,tooltip:"滚动方向"}),Mh=gp({tooltip:"开启后会允许用户滑动进度条"}),Ih=gp({range:[0,1],slide:!0,step:.001,visible:function(){return this.interactable},tooltip:"可拖拽的最小限制，默认=0不限制,仅当你开启了循环,并且你的item会实时修改主轴尺寸时,那么你应该适当限制拖拽区域"}),Nh=gp({range:[0,1],slide:!0,step:.001,visible:function(){return this.interactable},tooltip:"可拖拽的最大限制，默认=1不限制,仅当你开启了循环,并且你的item会实时修改主轴尺寸时,那么你应该适当限制拖拽区域"}),Oh=gp({type:Rs}),Lh=gp({type:Rs,visible:function(){return this.interactable}}),Rh=gp({type:f,visible:function(){return this.transition!=Rs.None&&this.interactable}}),xh=gp({type:i,visible:function(){return this.transition==Rs.SpriteSwap&&this.interactable}}),Fh=gp({type:i,visible:function(){return this.transition==Rs.SpriteSwap&&this.interactable}}),Dh=gp({visible:function(){return this.transition==Rs.ColorTint&&this.interactable}}),zh=gp({visible:function(){return this.transition==Rs.ColorTint&&this.interactable}}),kh=gp({visible:function(){return this.transition==Rs.Scale&&this.interactable}}),Vh=gp({visible:function(){return this.transition==Rs.Scale&&this.interactable}}),Bh=gp({visible:function(){return this.transition==Rs.Scale||this.transition==Rs.ColorTint&&this.interactable}}),Hh=gp({range:[0,11],slide:!0,step:1,tooltip:"用于进度的步数。值为 < 2 将禁用"}),Uh=gp({tooltip:"开启后会在滚动条无更新时自动隐藏"}),Gh=gp({visible:function(){return this.enableAutoHide},tooltip:"自动隐藏滚动条的时间"}),Ch((Zh=It((qh=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,Ot(e,"adapter",Zh,Lt(e)),Ot(e,"handle",Yh,Lt(e)),Ot(e,"direction",jh,Lt(e)),Ot(e,"interactable",Kh,Lt(e)),Ot(e,"dragMinLimit",Xh,Lt(e)),Ot(e,"dragMaxLimit",Jh,Lt(e)),Ot(e,"_transition",Qh,Lt(e)),Ot(e,"targetGraphic",$h,Lt(e)),Ot(e,"hoverSprite",tp,Lt(e)),Ot(e,"pressedSprite",ep,Lt(e)),Ot(e,"hoverColor",ip,Lt(e)),Ot(e,"pressedColor",np,Lt(e)),Ot(e,"hoverScale",op,Lt(e)),Ot(e,"pressedScale",rp,Lt(e)),Ot(e,"transitionDuration",ap,Lt(e)),Ot(e,"numberOfSteps",sp,Lt(e)),Ot(e,"enableAutoHide",lp,Lt(e)),Ot(e,"autoHideTime",cp,Lt(e)),e._transitionInfo=void 0,e._targetEnter=void 0,e._targetStart=void 0,e._isDirty=!1,e._transform=void 0,e._handleTransform=void 0,e._size=0,e._value=-1,e._pointerEvent=void 0,e._offset=void 0,e._isHide=void 0,e._opacity=255,e._autoHideRemainingTime=void 0,e._rawTargetScale=void 0,e._rawTargetFrame=void 0,e._rawTargetColor=void 0,e}Nt(e,t);var i=e.prototype;return i.__preload=function(){this.transform.setAnchorPoint(.5,.5),this.handleTransform.setAnchorPoint(.5,.5),this.handle.node.setPosition(0,0),this.adapter&&(this.adapter.scrollManager.on(au.Event.ON_UPDATE_PERCENTAGE,this._onUpdateScrollbar,this),this._updateVisuals()),this.targetGraphic&&(this._rawTargetScale=this.targetGraphic.node.getScale().clone(),this._rawTargetFrame=this.targetGraphic.spriteFrame,this._rawTargetColor=this.targetGraphic.color.clone()),this._openAutoHide(!0)},i.onEnable=function(){var t=this.node.getComponent(f);t&&(this._opacity=t.color.a),this.adapter&&(this.node[ou]=!0,this.node.on(c.EventType.TOUCH_START,this._onTouchStart,this),this.node.on(c.EventType.TOUCH_MOVE,this._onTouchMove,this),this.node.on(c.EventType.TOUCH_END,this._onTouchEnd,this),this.node.on(c.EventType.TOUCH_CANCEL,this._onTouchEnd,this),this.node.on(c.EventType.MOUSE_ENTER,this._mouseEnter,this),this.node.on(c.EventType.MOUSE_LEAVE,this._mouseLeave,this),this.targetGraphic&&(this.targetGraphic.node.on(c.EventType.MOUSE_ENTER,this._targetMouseEnter,this),this.targetGraphic.node.on(c.EventType.MOUSE_LEAVE,this._targetMouseLeave,this)))},i.onDisable=function(){this.node.off(c.EventType.TOUCH_START,this._onTouchStart,this),this.node.off(c.EventType.TOUCH_MOVE,this._onTouchMove,this),this.node.off(c.EventType.TOUCH_END,this._onTouchEnd,this),this.node.off(c.EventType.TOUCH_CANCEL,this._onTouchEnd,this),this.node.off(c.EventType.MOUSE_ENTER,this._mouseEnter,this),this.node.off(c.EventType.MOUSE_LEAVE,this._mouseLeave,this),this.targetGraphic&&(this.targetGraphic.node.off(c.EventType.MOUSE_ENTER,this._targetMouseEnter,this),this.targetGraphic.node.off(c.EventType.MOUSE_LEAVE,this._targetMouseLeave,this))},i._targetMouseEnter=function(){switch(this._targetEnter=!0,this._openAutoHide(!1),this.transition){case Rs.Scale:this._transitionScale(this._targetStart?this.pressedScale:this.hoverScale);break;case Rs.SpriteSwap:this._transitionSprite(this._targetStart?this.pressedSprite:this.hoverSprite);break;case Rs.ColorTint:this._transitionColor(this._targetStart?this.pressedColor:this.hoverColor)}},i._targetMouseLeave=function(){switch(this._targetEnter=!1,this._openAutoHide(!0),this.transition){case Rs.Scale:this._transitionScale(this._targetStart?this.pressedScale:this._rawTargetScale);break;case Rs.SpriteSwap:this._transitionSprite(this._targetStart?this.pressedSprite:this._rawTargetFrame);break;case Rs.ColorTint:this._transitionColor(this._targetStart?this.pressedColor:this._rawTargetColor)}},i._transitionScale=function(t){t&&this.targetGraphic&&(this._transitionInfo={time:0,from:this.targetGraphic.node.getScale().clone(),to:t})},i._transitionColor=function(t){t&&this.targetGraphic&&(this._transitionInfo={time:0,from:this.targetGraphic.color,to:t})},i._transitionSprite=function(t){t&&this.targetGraphic&&(this.targetGraphic.spriteFrame=t)},i._mouseEnter=function(t){this.interactable&&this._openAutoHide(!1)},i._mouseLeave=function(t){this.interactable&&this._openAutoHide(!0)},i._openAutoHide=function(t){this.enableAutoHide&&(this._autoHideRemainingTime=this.autoHideTime,this._isHide=t,t||this._setOpacity(this._opacity))},i._onTouchStart=function(t){if(this.interactable&&1!=this.size&&0!=this.size){this._openAutoHide(!1),this._pointerEvent=null,this._targetStart=!0;var e=t.getUIStartLocation();if(this._offset=this.handleTransform.convertToNodeSpaceAR(m(e.x,e.y)),Math.abs(this._offset[this.xy])>.5*this.handleTransform[this.wh]){this._offset=null,this._pointerEvent=t;var i=this._calcPercentage(t);this._setPercentage(i)}this.transition==Rs.Scale?this._transitionScale(this.pressedScale):this.transition==Rs.SpriteSwap?this._transitionSprite(this.pressedSprite):this.transition==Rs.ColorTint&&this._transitionColor(this.pressedColor)}},i._onTouchMove=function(t){if(this.interactable&&1!=this.size&&0!=this.size&&this._offset){var e=this._calcPercentage(t,this._offset[this.xy]);this._setPercentage(e)}},i._onTouchEnd=function(t){if(this.interactable&&1!=this.size&&0!=this.size){switch(this._offset=null,this._pointerEvent=null,this._targetStart=!1,this.transition){case Rs.Scale:this._transitionScale(this._targetEnter?this.hoverScale:this._rawTargetScale);break;case Rs.SpriteSwap:this._transitionSprite(this._targetEnter?this.hoverSprite:this._rawTargetFrame);break;case Rs.ColorTint:this._transitionColor(this._targetEnter?this.hoverColor:this._rawTargetColor)}this.adapter.centerManager.scrollToCenter()}},i._setPercentage=function(t){this.adapter.scrollManager.stopScroll(),this.adapter.scrollManager.setPercentage(t)},i._calcPercentage=function(t,e){void 0===e&&(e=0);var i=(this.axis==bs.Horizontal?this.transform.width:this.transform.height)*(1-this.size),n=t.getUILocation(),o=this.transform.convertToNodeSpaceAR(m(n.x,n.y))[this.xy]-e-.5*-this.transform[this.wh];o-=.5*this.handleTransform[this.wh];var r=this.adapter.scrollManager.percentage;switch(this.direction){case Is.Right_To_Left:case Is.Top_To_Bottom:r=Vs.clamp(1-o/i,this.dragMinLimit,this.dragMaxLimit);break;case Is.Left_To_Right:case Is.Bottom_To_Top:r=Vs.clamp(o/i,this.dragMinLimit,this.dragMaxLimit)}return this.getSteps(r)},i._onUpdateScrollbar=function(t,e){var i=0,n=0;this.adapter.viewManager.virtualSize>0&&(i=this.adapter.viewManager.virtualSize>=this.adapter.mainAxisSize?Vs.clamp01((this.adapter.mainAxisSize-Math.abs(e))/this.adapter.viewManager.virtualSize):1),n=t,this.size=i,this.numberOfSteps>1&&(n=Math.round(n*(this.numberOfSteps-1))/(this.numberOfSteps-1),n=Vs.clamp01(n)),this.value=n,this._autoHideRemainingTime=this.autoHideTime,this._setOpacity(this._opacity)},i._updateVisuals=function(){if(this.handleTransform&&this.adapter){var t={x:0,y:0},e={x:0,y:0},i=this.adapter.mainAxis,n=Vs.clamp01(this.value)*(1-this.size);t[i]=n,e[i]=n+this.size;var o=this.transform.contentSize[this.wh]-e[i]*this.transform.contentSize[this.wh],r=t[i]*this.transform.contentSize[this.wh],a=this.handle.node.getPosition();switch(this.direction){case Is.Bottom_To_Top:case Is.Left_To_Right:a[this.xy]=.5*(r-o);break;case Is.Top_To_Bottom:case Is.Right_To_Left:a[this.xy]=.5*(o-r)}this.handleTransform[this.wh]=this.transform.contentSize[this.wh]-o-r,this.handle.node.setPosition(a)}},i.update=function(t){this._clearDirty(),this._autoHide(t),this._tranitionHandler(t)},i._clearDirty=function(){if(this._isDirty&&(this._isDirty=!1,this._updateVisuals(),this._pointerEvent)){var t=this._pointerEvent.getUILocation();this._offset=this.handleTransform.convertToNodeSpaceAR(m(t.x,t.y)),this._pointerEvent=null}},i._autoHide=function(t){if(this.enableAutoHide&&this._isHide&&!(this._autoHideRemainingTime<=0)&&(this._autoHideRemainingTime-=t,this._autoHideRemainingTime<=this.autoHideTime)){this._autoHideRemainingTime=Math.max(0,this._autoHideRemainingTime);var e=this._opacity*(this._autoHideRemainingTime/this.autoHideTime);this._setOpacity(e)}},i._tranitionHandler=function(t){var e=this.targetGraphic;if(this.transition!=Rs.None&&e&&this._transitionInfo){this._transitionInfo.time+=t;var i=1;if(this.transitionDuration>0&&(i=this._transitionInfo.time/this.transitionDuration),i>=1&&(i=1),this.transition==Rs.Scale){this._transitionInfo.current=e.node.getScale();var n=this._transitionInfo.from,o=this._transitionInfo.to;this._transitionInfo.current.x=Vs.lerp(n.x,o.x,i),this._transitionInfo.current.y=Vs.lerp(n.y,o.y,i),e.node.setScale(this._transitionInfo.current)}else if(this.transition==Rs.ColorTint){var r=this._transitionInfo.from,a=this._transitionInfo.to;X.lerp(mp,r,a,i),e.color=mp}1===i&&(this._transitionInfo=null)}},i._setOpacity=function(t){if(this.handle){var e=function(e){e&&(mp.set(e.color),mp.a=t,e.color=mp)};e(this.node.getComponent(f)),e(this.handle.getComponent(f))}},i.getSteps=function(t){return this.numberOfSteps>1&&(t=Math.round(t*(this.numberOfSteps-1))/(this.numberOfSteps-1),t=Vs.clamp(t,this.dragMinLimit,this.dragMaxLimit)),t},Ft(e,[{key:"transition",get:function(){return this._transition},set:function(t){t!=this._transition&&(this._transition=t,t!=Rs.None&&(this.targetGraphic||(this.targetGraphic=this.handle)))}},{key:"size",get:function(){return this._size},set:function(t){t!=this._size&&(this._size=Vs.clamp(t,.01,1),this._isDirty=!0)}},{key:"value",get:function(){return this._value},set:function(t){t!=this._value&&(this._value=this.getSteps(t),this._isDirty=!0)}},{key:"stepSize",get:function(){return this.numberOfSteps>1?1/(this.numberOfSteps-1):.1}},{key:"transform",get:function(){return this._transform||(this._transform=this.node.getComponent(B)),this._transform}},{key:"handleTransform",get:function(){return this.handle?(this._handleTransform||(this._handleTransform=this.handle.node.getComponent(B)),this._handleTransform):null}},{key:"xy",get:function(){return this.axis==bs.Horizontal?"x":"y"}},{key:"wh",get:function(){return this.axis==bs.Horizontal?"width":"height"}},{key:"axis",get:function(){return this.direction==Is.Left_To_Right||this.direction==Is.Right_To_Left?bs.Horizontal:bs.Vertical}}]),e}(r)).prototype,"adapter",[Eh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Yh=It(qh.prototype,"handle",[Ah],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),jh=It(qh.prototype,"direction",[Ph],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Is.Top_To_Bottom}}),Kh=It(qh.prototype,"interactable",[Mh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Xh=It(qh.prototype,"dragMinLimit",[Ih],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Jh=It(qh.prototype,"dragMaxLimit",[Nh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),Qh=It(qh.prototype,"_transition",[Oh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Rs.None}}),It(qh.prototype,"transition",[Lh],Object.getOwnPropertyDescriptor(qh.prototype,"transition"),qh.prototype),$h=It(qh.prototype,"targetGraphic",[Rh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),tp=It(qh.prototype,"hoverSprite",[xh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ep=It(qh.prototype,"pressedSprite",[Fh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ip=It(qh.prototype,"hoverColor",[Dh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return X.WHITE.clone()}}),np=It(qh.prototype,"pressedColor",[zh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new X(211,211,211,255)}}),op=It(qh.prototype,"hoverScale",[kh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new K(1,1)}}),rp=It(qh.prototype,"pressedScale",[Vh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new K(1.2,1.2)}}),ap=It(qh.prototype,"transitionDuration",[Bh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.2}}),sp=It(qh.prototype,"numberOfSteps",[Hh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),lp=It(qh.prototype,"enableAutoHide",[Uh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),cp=It(qh.prototype,"autoHideTime",[Gh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),Wh=qh));t._RF.pop(),t._RF.push({},"40680UcTm9G/ZhjtPkyAjKr","interface",void 0),t._RF.pop(),t._RF.push({},"0a2997sehVGrL8shCrZiUoV","index",void 0),t._RF.pop(),t._RF.push({},"60302ameClCGbCam2xkotxy","csvManager",void 0);var vp,yp,bp=e.ccclass,_p=(e.property,[",",";","\t","|","^"]),Sp=["\r\n","\r","\n"],wp=function(t,e,i,n){return i instanceof Array?"number"===i[e]?Number(n[e]):"boolean"===i[e]?"true"===n[e]||"t"===n[e]||"1"===n[e]:n[e]:isNaN(Number(t))?"false"==t||"true"==t||"t"==t||"f"==t?"true"===n[e]||"t"===n[e]||"1"===n[e]:n[e]:Number(n[e])},Tp={STANDARD_DECODE_OPTS:{skip:0,limit:!1,header:!1,cast:!1,comment:""},STANDARD_ENCODE_OPTS:{delimiter:_p[0],newline:Sp[0],skip:0,limit:!1,header:!1},quoteMark:'"',doubleQuoteMark:'""',quoteRegex:/"/g,assign:function(){for(var t=Array.prototype.slice.call(arguments),e=t[0],i=t.slice(1),n=0,o=i.length;n<o;n++)for(var r in i[n])e[r]=i[n][r];return e},map:function(t,e){for(var i=[],n=0,o=t.length;n<o;n++)i[n]=e(t[n],n);return i},getType:function(t){return Object.prototype.toString.call(t).slice(8,-1)},getLimit:function(t,e){return!1===t?e:t},buildObjectConstructor:function(t,e,i){return function(n){var o=new Object,r=function(t,e){return o[t]=e};return i?t.forEach((function(t,o){r(t,wp(e[o],o,i,n))})):t.forEach((function(t,i){r(t,wp(e[i],i,null,n))})),o}},buildArrayConstructor:function(t,e,i){return function(n){var o=new Array(e.length),r=function(t,e){return o[t]=e};return i?t.forEach((function(t,o){r(t,wp(e[o],o,i,n))})):t.forEach((function(t,i){r(t,wp(e[i],i,null,n))})),o}},frequency:function(t,e,i){void 0===i&&(i=!1);for(var n=0,o=0,r=this.getLimit(i,t.length);o<r&&-1!==(o=t.indexOf(e,o));)o+=1,n++;return n},mostFrequent:function(t,e,i){for(var n,o=e.length-1;o>=0;o--)this.frequency(t,e[o],i)>0&&(n=e[o]);return n||e[0]},unsafeParse:function(t,e,i){var n,o,r=t.split(e.newline);function a(t){var i=t.shift();if(i.indexOf('"')>=0){for(var n=0,o=0,r=0;t.length>0&&(-1!==(n=i.indexOf('"',o))||r%2!=0);)-1!==n?(o=n+1,r++):i=i+e.newline+t.shift();var a,s=[],l=0,c=0,u=0,h=i.length;for(var p in i)if(i.hasOwnProperty(p)){var d=parseInt(p),f=i[p];0===d&&'"'===f&&(l++,c=1),'"'===f&&(l++,i[d-1]===e.delimiter&&c===d&&c++),'"'===f&&l%2==0&&(i[d+1]!==e.delimiter&&d+1!==h||(u=d,a=i.substring(c,u),s.push(a),u=c=u+2)),f===e.delimiter&&l%2==0&&((u=d)>c?(a=i.substring(c,u),s.push(a),u=c=u+1):u===c&&(s.push(""),u=c=u+1))}return(u=h)>=c&&(a=i.substring(c,u),s.push(a)),s}return i.split(e.delimiter)}for(e.skip>0&&r.splice(e.skip),e.header?(!0===e.header?(e.comment=a(r),e.cast=a(r),n=a(r)):"Array"===this.getType(e.header)&&(n=e.header),o=this.buildObjectConstructor(n,r[0].split(e.delimiter),e.cast)):o=this.buildArrayConstructor(n,r[0].split(e.delimiter),e.cast);r.length>0;){var s=a(r);s.length>1&&i(o(s),n[0])}return!0},safeParse:function(t,e,i){e.delimiter;var n=e.newline,o=t.split(n);return e.skip>0&&o.splice(e.skip),!0},encodeCells:function(t,e,i){for(var n=t.slice(0),o=0,r=n.length;o<r;o++)-1!==n[o].indexOf(this.quoteMark)&&(n[o]=n[o].replace(this.quoteRegex,this.doubleQuoteMark)),-1===n[o].indexOf(e)&&-1===n[o].indexOf(i)||(n[o]=this.quoteMark+n[o]+this.quoteMark);return n.join(e)},encodeArrays:function(t,e,i){var n=e.delimiter,o=e.newline;e.header&&"Array"===this.getType(e.header)&&i(this.encodeCells(e.header,n,o));for(var r=0,a=this.getLimit(e.limit,t.length);r<a;r++)i(this.encodeCells(t[r],n,o));return!0},encodeObjects:function(t,e,i){var n,o,r=e.delimiter,a=e.newline;for(var s in n=[],o=[],t[0])n.push(s),o.push(t[0][s]);!0===e.header?i(this.encodeCells(n,r,a)):"Array"===this.getType(e.header)&&i(this.encodeCells(e.header,r,a)),i(this.encodeCells(o,r));for(var l=1,c=this.getLimit(e.limit,t.length);l<c;l++){o=[];for(var u=0,h=n.length;u<h;u++)o.push(t[l][n[u]]);i(this.encodeCells(o,r,a))}return!0},parse:function(t,e,i){var n;if("Function"===this.getType(e)?(i=e,e={}):"Function"!==this.getType(i)?i=(n=[]).push.bind(n):n=[],e=this.assign({},this.STANDARD_DECODE_OPTS,e),this.opts=e,!e.delimiter||!e.newline){var o=Math.min(48,Math.floor(t.length/20),t.length);e.delimiter=e.delimiter||this.mostFrequent(t,_p,o),e.newline=e.newline||this.mostFrequent(t,Sp,o)}return this.unsafeParse(t,e,i)&&(!(n.length>0)||n)},encode:function(t,e,i){var n;return"Function"===this.getType(e)?(i=e,e={}):"Function"!==this.getType(i)&&(i=(n=[]).push.bind(n)),(e=this.assign({},this.STANDARD_ENCODE_OPTS,e)).skip>0&&(t=t.slice(e.skip)),("Array"===this.getType(t[0])?this.encodeArrays:this.encodeObjects)(t,e,i)&&(!(n.length>0)||n.join(e.newline))}},Cp=bp("CSVManager")(((dp=function(){function t(){this._csvTables={},this._csvTableForArr={},this._tableCast={},this._tableComment={}}var e=t.prototype;return e.addTable=function(t,e,i){if(!this._csvTables[t]||i){var n={},o=[];Tp.parse(e,{header:!0},(function(t,e){n[t[e]]=t,o.push(t)})),this._tableCast[t]=Tp.opts.cast,this._tableComment[t]=Tp.opts.comment,this._csvTables[t]=n,this._csvTableForArr[t]=o}},e.getTableArr=function(t){return this._csvTableForArr[t]},e.getTable=function(t){return this._csvTables[t]},e.queryOne=function(t,e,i){var n=this.getTable(t);if(!n)return null;if(!e)return n[i];for(var o in n)if(n.hasOwnProperty(o)&&n[o][e]===i)return n[o]},e.queryByID=function(t,e){return this.queryOne(t,null,e)},e.queryAll=function(t,e,i){var n=this.getTable(t);if(!n||!e)return null;var o={};for(var r in n)n.hasOwnProperty(r)&&n[r][e]===i&&(o[r]=n[r]);return o},e.queryIn=function(t,e,i){var n=this.getTable(t);if(!n||!e)return null;for(var o={},r=Object.keys(n),a=r.length,s=0;s<a;s++){var l=n[r[s]];i.indexOf(l[e])>-1&&(o[r[s]]=l)}return o},e.queryByCondition=function(t,e){if(e.constructor!==Object)return null;var i=this.getTable(t);if(!i)return null;for(var n={},o=Object.keys(i),r=o.length,a=Object.keys(e),s=a.length,l=0;l<r;l++){for(var c=i[o[l]],u=!0,h=0;h<s;h++){var p=a[h];u=u&&e[p]===c[p]&&!n[o[l]]}u&&(n[o[l]]=c)}return n},e.queryOneByCondition=function(t,e){if(e.constructor!==Object)return null;var i=this.getTable(t);if(!i)return null;var n=Object.keys(e),o=n.length;for(var r in i){for(var a=i[r],s=!0,l=0;l<o;l++){var c=n[l];s=s&&e[c]===a[c]}if(s)return a}return null},Ft(t,null,[{key:"instance",get:function(){return this._instance||(this._instance=new t),this._instance}}]),t}())._instance=void 0,pp=dp))||pp;t._RF.pop(),t._RF.push({},"aca4damK49DYqlWPDNwTrSS","localConfig",void 0);var Ep,Ap,Pp=e.ccclass;e.property,Pp("LocalConfig")(((yp=function(){function t(){this._csvManager=new Cp,this._callback=new Function,this._currentLoad=0,this._cntLoad=0}var e=t.prototype;return e.loadConfig=function(t){this._callback=t,this._loadCSV()},e._loadCSV=function(){var t=this;a.loadDir("datas",(function(e,i){if(!e){var n=i.filter((function(t){return".md"!==t._native}));t._cntLoad=n.length,n.length?n.forEach((function(e,i,n){$e.getTextData(e.name,(function(i){t._csvManager.addTable(e.name,i),t._tryToCallbackOnFinished()}))})):t._tryToCallbackOnFinished()}}))},e.queryOne=function(t,e,i){return this._csvManager.queryOne(t,e,i)},e.queryByID=function(t,e){return this._csvManager.queryByID(t,e)},e.getTable=function(t){return this._csvManager.getTable(t)},e.getTableArr=function(t){return this._csvManager.getTableArr(t)},e.queryAll=function(t,e,i){return this._csvManager.queryAll(t,e,i)},e.queryIn=function(t,e,i){return this._csvManager.queryIn(t,e,i)},e.queryByCondition=function(t,e){return this._csvManager.queryByCondition(t,e)},e._tryToCallbackOnFinished=function(){this._callback&&(this._currentLoad++,this._currentLoad>=this._cntLoad&&this._callback())},Ft(t,null,[{key:"instance",get:function(){return this._instance||(this._instance=new t),this._instance}}]),t}())._instance=void 0,vp=yp));t._RF.pop(),t._RF.push({},"6743cVJ1/1Ha68y/dyVx1hh","lodash",void 0);var Mp,Ip;(0,e.ccclass)("lodash")(((Ap=function(){function t(){}return t.find=function(e,i){var n;if(Array.isArray(e)||(e=t._toArray(e)),(n=e.filter(i)).length)return n[0]},t.forEach=function(e,i){Array.isArray(e)?e.forEach(i):t._toArrayKey(e).forEach((function(t,n,o){var r=t.key,a=t.value;i(a,r,e)}))},t.cloneDeep=function(e){if(null===e||"object"!=typeof e)return e;var i={};for(var n in e.constructor===Array&&(i=[]),e)e.hasOwnProperty(n)&&(i[n]=t.cloneDeep(e[n]));return i},t.map=function(e,i){Array.isArray(e)||(e=t._toArray(e));var n=[];return e.forEach((function(t,e,o){n.push(i(t,e,o))})),n},t._toArrayKey=function(t){var e=[];for(var i in t)t.hasOwnProperty(i)&&e.push({key:i,value:t[i]});return e},t._toArray=function(t){var e=[];for(var i in t)t.hasOwnProperty(i)&&e.push(t[i]);return e},t.filter=function(e,i){return Array.isArray(e)||(e=t._toArray(e)),e.filter(i)},t.isEqual=function(e,i){if(!(e instanceof Object)||!(i instanceof Object))return e===i;if(Object.keys(e).length!==Object.keys(i).length)return!1;for(var n in e){var o=e[n]instanceof Object,r=i[n]instanceof Object;if(o&&r)return t.isEqual(e[n],i[n]);if(e[n]!==i[n])return!1}return!0},t.pullAllWith=function(t,e,i){return e.forEach((function(e){t.filter((function(t){return i(t,e)})).forEach((function(e){var i=t.indexOf(e);-1!==t.indexOf(e)&&t.splice(i,1)}))})),t},t.now=function(){return Date.now()},t.pullAll=function(t,e){return e.forEach((function(e){var i=t.indexOf(e);-1!==t.indexOf(e)&&t.splice(i,1)})),t},t.forEachRight=function(e,i){Array.isArray(e)||(e=t._toArray(e));for(var n=e.length-1;n>=0;n--){if(!i(e[n]))break}},t.startsWith=function(t,e,i){return(t=t.substr(i)).startsWith(e)},t.endsWith=function(t,e,i){return(t=t.substr(i)).endsWith(e)},t.remove=function(e,i){var n=[],o=[];return e.forEach((function(t,e){i(t)&&(n.push(t),o.push(e))})),t._basePullAt(e,o),n},t._basePullAt=function(t,e){for(var i,n=t?e.length:0,o=n-1;n--;){var r=e[n];n!==o&&r===i||(i=r,Array.prototype.splice.call(t,r,1))}return t},t.findIndex=function(t,e,i){var n;if(t=t.slice(i),"function"==typeof e){for(n=0;n<t.length;n++)if(e(t[n]))return n}else if(Array.isArray(e))for(n=0;n<t.length;n++){var o=e[0],r=!0;if(e.length>1&&(r=e[1]),t[n][o]===r)return n}else for(n=0;n<t.length;n++)if(t[n]===e)return n;return-1},t.concat=function(){var t=arguments.length;if(!t)return[];for(var e=arguments[0],i=1;i<t;)e=e.concat(arguments[i]),i++;return e},t.isNumber=function(t){return"number"==typeof t},t.indexOf=function(t,e,i){return(t=t.slice(i)).indexOf(e)},t.join=function(t,e){if(null===t)return"";var i="";return t.forEach((function(t){i+=t+e})),i.substr(0,i.length-1)},t.split=function(t,e,i){return t.split(e,i)},t.max=function(t){if(t&&t.length){for(var e,i=0;i<t.length;i++)0===i?e=t[0]:e<t[i]&&(e=t[i]);return e}},t.drop=function(t,e){return(null===t?0:t.length)?t.slice(e):[]},t.flattenDeep=function(e){return e.reduce((function(e,i){return e.concat(Array.isArray(i)?t.flattenDeep(i):i)}),[])},t.uniq=function(t){var e=[];return t.forEach((function(t){-1===e.indexOf(t)&&e.push(t)})),e},t.isNaN=function(e){return t.isNumber(e)&&e!==+e},t.chunk=function(t,e){if(!(null===t?0:t.length)||e<1)return[];for(var i=[];t.length>e;)i.push(t.slice(0,e)),t=t.slice(e);return i.push(t),i},t.toFinite=function(t){var e=1/0;return t?(t=Number(t))===e||t===-1/0?17976931348623157e292*(t<0?-1:1):t==t?t:0:0===t?t:0},t.isObject=function(t){var e=typeof t;return null!==t&&("object"===e||"function"===e)},t.isLength=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=t.MAX_SAFE_INTEGER},t._isArrayLike=function(e){return null!==e&&t.isLength(e.length)},t.maxBy=function(t,e){if(t&&t.length){for(var i,n,o=0;o<t.length;o++)0===o?(i=e(t[0]),n=t[0]):i<t[o]&&(i=t[o],n=t[o]);return n}},t.minBy=function(t,e){if(t&&t.length){for(var i,n,o=0;o<t.length;o++)0===o?(i=e(t[0]),n=t[0]):i>t[o]&&(i=e(t[o]),n=t[o]);return n}},t.sumBy=function(t,e){var i=0;for(var n in t)i+=e(t[n]);return i},t.countBy=function(t,e){var i={};for(var n in t){var o=e(n);i.hasOwnProperty(o)?i[o]+=1:i[o]=1}return i},t}()).MAX_SAFE_INTEGER=9007199254740991,Ep=Ap));t._RF.pop(),t._RF.push({},"411ad/aVKtGja0EX2BBJnVT","poolManager",void 0);var Np=e.ccclass,Op=(e.property,Np("PoolManager")(((Ip=function(){function t(){this._dictPool={},this._dictPrefab={}}var e=t.prototype;return e.getNode=function(t,e){var i=t.name;t.position||(i=t.data.name),this._dictPrefab[i]=t;var n=null;if(this._dictPool.hasOwnProperty(i)){var o=this._dictPool[i];n=o.size()>0?o.get():E(t)}else{var r=new et;this._dictPool[i]=r,n=E(t)}return n.parent=e,n.active=!0,n.name=i,n},e.putNode=function(t){if(t){var e=t.name,i=null;this._dictPool.hasOwnProperty(e)?i=this._dictPool[e]:(i=new et,this._dictPool[e]=i),i.put(t)}},e.clearPool=function(t){this._dictPool.hasOwnProperty(t)&&this._dictPool[t].clear()},e.preloadPool=function(t,e){var i=t.name;t.position||(i=t.data.name);var n=null;this._dictPool.hasOwnProperty(i)?n=this._dictPool[i]:(n=new et,this._dictPool[i]=n);for(var o=0;o<e;o++){var r=E(t);n.put(r)}},Ft(t,null,[{key:"instance",get:function(){return this._instance||(this._instance=new t),this._instance}}]),t}())._instance=void 0,Mp=Ip))||Mp);t._RF.pop(),t._RF.push({},"a4ed0rV6NNLHYnS0I+Yctb7","SceneDefine",void 0);var Lp="Home",Rp="Audition",xp="MagicTile",Fp="Pitch",Dp="Karaoke";t._RF.pop(),t._RF.push({},"f75e0dYk2hItL6AtoKH1J3L","SocketEventDefines",void 0),t._RF.pop(),t._RF.push({},"bb226P25spAXpqOG9j9rTka","SongConstant",void 0);var zp,kp,Vp,Bp,Hp,Up="music";t._RF.pop(),t._RF.push({},"97270evPX5NaoJ6I7QVNd3F","DynamicSkeletonAnimation",void 0);var Gp=e.ccclass,Wp=e.property;zp=Gp("DynamicAnimationClip"),kp=Wp({type:it}),zp((Hp=It((Bp=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,Ot(e,"animationComponent",Hp,Lt(e)),e}return Nt(e,t),e.prototype.start=function(){var t=this;a.load("3d/animation_clips/your_animation_clip",nt,(function(e,i){e?console.error("Failed to load animation clip:",e):i?t.animationComponent?(t.animationComponent.addClip(i),t.animationComponent.play("your_animation_clip")):console.error("Animation component is not assigned in the editor."):console.warn("Animation clip not found at the specified path.")}))},e}(r)).prototype,"animationComponent",[kp],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Vp=Bp));t._RF.pop(),t._RF.push({},"bc1d75XEItMOZF3HZi0EoA3","APIFakeData",void 0),t._RF.pop(),t._RF.push({},"3b325m3/clNb7s376jIQ9MJ","APIManager",void 0);var qp=function(){function t(){var t=this;this.baseURL=void 0,this.timeout=void 0,this.MAX_RETAKE_TOKEN=5,this.retakeTokenTimesThisSession=0,this.retakeToken=null,this.onFailedCallback=null,this.isLog=!0,this.log=function(e){t.isLog&&ye.LOG&&console.log("[API] : ",e)},this.baseURL="",this.timeout=3e4}var e=t.prototype;return e.setBaseURL=function(t){this.baseURL=t},e.setTimeout=function(t){this.timeout=t},e.request=function(){var t=Rt(xt().mark((function t(e,i,n,o,r){var a,s,l,c,u,h,p,d;return xt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return void 0===r&&(r=null),a=null,s=!1,l=null,r||(r=Yp),t.prev=5,t.next=8,this.fetchWithRetry(e,i);case 8:if((c=t.sent).ok){t.next=11;break}throw{message:"Network response was not ok",statusCode:777};case 11:return t.next=13,c.json();case 13:a=t.sent,this.log("data:"+a),(l=a).statusCode&&200!=l.statusCode&&(s=!0,this.log("Server response ERROR:"+l.message),o(l),null==(u=this.onFailedCallback)||u.call(this,l)),t.next=25;break;case 19:t.prev=19,t.t0=t.catch(5),s=!0,this.log("ERROR:"+t.t0),o(t.t0),null==(h=this.onFailedCallback)||h.call(this,t.t0);case 25:if(!s){try{p=Zp.AES.decrypt(l.data,r),d=p.toString(Zp.enc.Utf8),l.data=JSON.parse(d)}catch(t){this.log("resData: ERROR"+t)}n(l)}case 26:case"end":return t.stop()}}),t,this,[[5,19]])})));return function(e,i,n,o,r){return t.apply(this,arguments)}}(),e.fetchWithRetry=function(){var t=Rt(xt().mark((function t(e,i,n){var o,r,a;return xt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:void 0===n&&(n=3),o=0;case 2:if(!(o<n)){t.next=28;break}return t.prev=3,r=this.baseURL+e,this.log("fetch "+r),t.next=8,this.timeoutPromise(fetch(r,i));case 8:if(401!=(a=t.sent).status||!this.retakeToken){t.next=16;break}if(this.log("try get new token"),!(++this.retakeTokenTimesThisSession<=this.MAX_RETAKE_TOKEN)){t.next=16;break}return t.next=14,this.retakeToken();case 14:t.sent&&(i.headers=Kp());case 16:if(!a.ok){t.next=18;break}return t.abrupt("return",a);case 18:t.next=24;break;case 20:if(t.prev=20,t.t0=t.catch(3),o!==n-1){t.next=24;break}throw t.t0;case 24:o++,this.log("retry attemptes:"+o),t.next=2;break;case 28:throw{message:"All retries failed",statusCode:666};case 29:case"end":return t.stop()}}),t,this,[[3,20]])})));return function(e,i,n){return t.apply(this,arguments)}}(),e.timeoutPromise=function(t){var e=this;return new Promise((function(i,n){var o=setTimeout((function(){return n(new Error("Request timed out"))}),e.timeout);t.then((function(t){clearTimeout(o),i(t)}),(function(t){clearTimeout(o),n(t)}))}))},t}(),Zp=window.CryptoJS,Yp="",jp=new qp;jp.onFailedCallback=function(t){},setInterval((function(){return}),3e5);var Kp=function(){return{Authorization:"Bearer ","Content-Type":"application/json"}};t._RF.pop(),t._RF.push({},"399f2AVXt9B5ozV4m+hAt4r","GameManager",void 0);var Xp=function(){function t(){this.userInfo=null,this.isNeedToReload=!1,this.isShouldSync=!0,this.initGameEvents()}var e=t.prototype;return e.initGameEvents=function(){I.on(ot.EVENT_HIDE,(function(){ye.LOG&&console.log("GameManager: on game hided")}))},e.setUserInfo=function(t){this.userInfo=t,this.isNeedToReload=!1,this.isShouldSync=!0},t}();Xp.instance=null,Xp.instance=new Xp,t._RF.pop(),t._RF.push({},"29ee18T099MnaDN9VHyT8uY","AuditionSongModel",void 0),t._RF.pop(),t._RF.push({},"af924z6pApFx55QJTlI1nlf","KaraokeTypes",void 0);var Jp,Qp,$p="karaoke/lyrics";t._RF.pop(),t._RF.push({},"5fc5f+jwVVKKZ2fyjN9A0/o","KaraokeSongModel",void 0),(Qp=Jp||(Jp={})).getLyricPath=function(t){return $p+"/"+(t.lyricPath||t.id)},Qp.getBeatmapPath=function(t){return Up+"/"+(t.musicPath||t.id)+"_beat"},t._RF.pop(),t._RF.push({},"12489oNGpZFfYaPjF1Ir4kw","MTDefines",void 0);var td,ed,id,nd,od,rd,ad,sd,ld,cd,ud,hd,pd,dd,fd,gd,md,vd,yd,bd,_d,Sd,wd,Td="magic_tiles/midi",Cd=function(t){return t[t.TAP=0]="TAP",t[t.HOLD=1]="HOLD",t[t.SLIDE=2]="SLIDE",t}({});t._RF.pop(),t._RF.push({},"27ac05hMORHgqIDpEPGG3ky","MTSongModel",void 0),(td||(td={})).getMidiPath=function(t){return Td+"/"+(t.midiPath||t.id)},t._RF.pop(),t._RF.push({},"6f301gGi7hEv5pCamsfrbSo","SongModel",void 0),(ed||(ed={})).getMusicPath=function(t){return Up+"/"+(t.musicPath||t.id)},t._RF.pop(),t._RF.push({},"2863714705FO4J9mAWwN/3b","UserModel",void 0),t._RF.pop(),t._RF.push({},"3407dOpf11DQZytuXaeEQcr","AuditionNoteVisual",void 0);var Ed,Ad,Pd,Md,Id,Nd,Od,Ld,Rd,xd,Fd,Dd,zd=e.ccclass,kd=e.property,Vd=(id=zd("AuditionNoteVisual"),nd=kd(f),od=kd(f),rd=kd(b),ad=kd(X),sd=kd(X),ld=kd(X),cd=kd(X),ud=kd(X),id((dd=It((pd=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,Ot(e,"noteSprite",dd,Lt(e)),Ot(e,"glowSprite",fd,Lt(e)),Ot(e,"opacity",gd,Lt(e)),Ot(e,"pulseSpeed",md,Lt(e)),Ot(e,"pulseIntensity",vd,Lt(e)),Ot(e,"leftNoteColor",yd,Lt(e)),Ot(e,"rightNoteColor",bd,Lt(e)),Ot(e,"perfectColor",_d,Lt(e)),Ot(e,"goodColor",Sd,Lt(e)),Ot(e,"missColor",wd,Lt(e)),e.hitAnimDuration=.2,e.missAnimDuration=.4,e.appearAnimDuration=.05,e.activeTweens=[],e.originalScale=new g(1,1,1),e.isHit=!1,e}Nt(e,t);var i=e.prototype;return i.onLoad=function(){this.node&&(this.originalScale=this.node.getScale().clone()),this.opacity||(this.opacity=this.getComponent(b),this.opacity||(this.opacity=this.addComponent(b)))},i.initialize=function(){this.isHit=!1,this.node.setScale(this.originalScale),this.node.setRotation(0,0,0,1),this.opacity&&(this.opacity.opacity=255)},i.playAppearAnimation=function(){var t=this;if(this.node){this.stopAllTweens(),this.node.setScale(0,0,1);var e=v(this.node).to(this.appearAnimDuration,{scale:this.originalScale},{easing:"backOut"}).call((function(){t.startPulseAnimation()})).start();this.activeTweens.push(e)}},i.startPulseAnimation=function(){if(this.node&&!this.isHit){this.stopAllTweens();var t=v(this.node).to(this.pulseSpeed/2,{scale:new g(this.originalScale.x*(1+this.pulseIntensity),this.originalScale.y*(1+this.pulseIntensity),this.originalScale.z)},{easing:"sineInOut"}).to(this.pulseSpeed/2,{scale:this.originalScale},{easing:"sineInOut"}).union().repeatForever().start();this.activeTweens.push(t)}},i.stopAllTweens=function(){this.activeTweens.forEach((function(t){return t.stop()})),this.activeTweens=[]},i.showHitEffect=function(){if(this.node){this.isHit=!0,this.stopAllTweens();var t=new g(1.5*this.originalScale.x,1.5*this.originalScale.y,this.originalScale.z),e=v(this.node).to(this.hitAnimDuration/3,{scale:t},{easing:"quadOut"}).to(2*this.hitAnimDuration/3,{scale:this.originalScale},{easing:"quadIn"}).start();if(this.activeTweens.push(e),this.opacity){var i=v(this.opacity).to(this.hitAnimDuration,{opacity:50}).start();this.activeTweens.push(i)}}},i.showMissEffect=function(){var t=this;if(this.node){this.isHit=!0,this.stopAllTweens(),this.glowSprite&&(this.glowSprite.color=this.missColor,this.glowSprite.node.active=!0);var e=new g(this.node.position.x,this.node.position.y-50,this.node.position.z),i=v(this.node).to(this.missAnimDuration,{position:e,scale:new g(.7*this.originalScale.x,.7*this.originalScale.y,this.originalScale.z)},{easing:"quadIn"}).call((function(){t.node.active=!1})).start();if(this.activeTweens.push(i),this.opacity){var n=v(this.opacity).to(this.missAnimDuration,{opacity:0}).start();this.activeTweens.push(n)}}},i.reset=function(){this.stopAllTweens(),this.node.setScale(this.originalScale),this.node.setRotation(0,0,0,1),this.opacity&&(this.opacity.opacity=255),this.glowSprite&&(this.glowSprite.node.active=!1),this.isHit=!1},e}(r)).prototype,"noteSprite",[nd],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),fd=It(pd.prototype,"glowSprite",[od],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),gd=It(pd.prototype,"opacity",[rd],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),md=It(pd.prototype,"pulseSpeed",[kd],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),vd=It(pd.prototype,"pulseIntensity",[kd],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.2}}),yd=It(pd.prototype,"leftNoteColor",[ad],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new X(79,195,247)}}),bd=It(pd.prototype,"rightNoteColor",[sd],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new X(255,112,67)}}),_d=It(pd.prototype,"perfectColor",[ld],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new X(120,255,120)}}),Sd=It(pd.prototype,"goodColor",[cd],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new X(255,193,7)}}),wd=It(pd.prototype,"missColor",[ud],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new X(211,47,47)}}),hd=pd))||hd);t._RF.pop(),t._RF.push({},"d703e2K9thB05Xmm4wf/DzN","AuditionAudioManager",void 0);var Bd,Hd,Ud,Gd,Wd,qd,Zd,Yd,jd,Kd=e.ccclass,Xd=e.property,Jd=(Ed=Kd("AuditionAudioManager"),Ad=Xd(N),Pd=Xd(N),Md=Xd({range:[0,1]}),Id=Xd({range:[0,1]}),Ed((Ld=It((Od=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,Ot(e,"musicSource",Ld,Lt(e)),Ot(e,"sfxSource",Rd,Lt(e)),Ot(e,"audioOffset",xd,Lt(e)),Ot(e,"musicVolume",Fd,Lt(e)),Ot(e,"sfxVolume",Dd,Lt(e)),e.soundEffects=new Map,e.startTime=0,e.isPaused=!1,e.pauseTime=0,e}Nt(e,t);var i=e.prototype;return i.onLoad=function(){this.musicSource||(this.musicSource=this.node.addComponent(N),this.musicSource.loop=!0,this.musicSource.volume=this.musicVolume),this.sfxSource||(this.sfxSource=this.node.addComponent(N),this.sfxSource.loop=!1,this.sfxSource.volume=this.sfxVolume),this.loadSoundEffects()},i.loadSoundEffects=function(){var t=this;["good","miss","s_ready","s_go"].forEach((function(e){$e.loadRes("audition/audio/sfx/"+e,O,(function(i,n){i?console.error("Failed to load sound effect: "+e,i):(t.soundEffects.set(e,n),console.log("Sound effect loaded: "+e))}))}));for(var e=function(){var e=1===i?"perfect":"perfect"+i;$e.loadRes("audition/audio/sfx/"+e,O,(function(i,n){i?console.error("Failed to load perfect sound effect: "+e,i):(t.soundEffects.set(e,n),console.log("Perfect sound effect loaded: "+e))}))},i=1;i<=5;i++)e()},i.loadSong=function(t){var e=this;return new Promise((function(i,n){console.log("Loading song: "+t),$e.loadRes(t,O,(function(o,r){if(o)return console.error("Failed to load song: "+t,o),void n(o);e.musicSource.clip=r,console.log("Song loaded: "+t),i()}))}))},i.playSong=function(t){void 0===t&&(t=0),this.musicSource.clip?(this.musicSource.currentTime=t/1e3,this.startTime=Date.now()-t,this.isPaused=!1,this.musicSource.play(),console.log("Playing song from "+t+"ms")):console.error("No song loaded")},i.pauseSong=function(){this.musicSource.playing&&(this.musicSource.pause(),this.isPaused=!0,this.pauseTime=this.getCurrentTime(),console.log("Song paused at "+this.pauseTime+"ms"))},i.resumeSong=function(){this.isPaused&&(this.musicSource.play(),this.startTime=Date.now()-this.pauseTime,this.isPaused=!1,console.log("Song resumed from "+this.pauseTime+"ms"))},i.stopSong=function(){this.musicSource.stop(),this.isPaused=!1,console.log("Song stopped")},i.getCurrentTime=function(){return this.isPaused?this.pauseTime:1e3*this.musicSource.currentTime},i.getDuration=function(){return 1e3*this.musicSource.clip.getDuration()},i.playSound=function(t){var e=this.soundEffects.get(t);e?this.sfxSource.playOneShot(e):console.warn("Sound effect not found: "+t)},i.setMusicVolume=function(t){this.musicVolume=Math.max(0,Math.min(1,t)),this.musicSource.volume=this.musicVolume},i.setSfxVolume=function(t){this.sfxVolume=Math.max(0,Math.min(1,t)),this.sfxSource.volume=this.sfxVolume},i.getMusicVolume=function(){return this.musicVolume},i.getSfxVolume=function(){return this.sfxVolume},i.setAudioOffset=function(t){this.audioOffset=t,console.log("Audio offset set to "+t+"ms")},i.getAudioOffset=function(){return this.audioOffset},i.calibrateAudioOffset=function(){console.log("Audio calibration initiated"),this.audioOffset=-50,console.log("Audio calibrated with offset: "+this.audioOffset+"ms")},e}(r)).prototype,"musicSource",[Ad],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Rd=It(Od.prototype,"sfxSource",[Pd],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),xd=It(Od.prototype,"audioOffset",[Xd],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Fd=It(Od.prototype,"musicVolume",[Md],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.7}}),Dd=It(Od.prototype,"sfxVolume",[Id],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),Nd=Od))||Nd);t._RF.pop(),t._RF.push({},"3e57c37p+BC+q4zA+47ifrI","AuditionInputHandler",void 0);var Qd,$d,tf,ef,nf,of,rf,af,sf,lf=e.ccclass,cf=e.property,uf=function(t){return t[t.LEFT=0]="LEFT",t[t.RIGHT=1]="RIGHT",t[t.SPACE=2]="SPACE",t}({}),hf=(Bd=lf("AuditionInputHandler"),Hd=cf(c),Ud=cf(c),Gd=cf(c),Bd((Zd=It((qd=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,Ot(e,"leftInputArea",Zd,Lt(e)),Ot(e,"rightInputArea",Yd,Lt(e)),Ot(e,"spaceInputArea",jd,Lt(e)),e.isInputEnabled=!0,e.inputCallbacks=new Map,e.lastInputTime=new Map,e.inputDebounceTime=100,e}Nt(e,t);var i=e.prototype;return i.onLoad=function(){this.initialize()},i.initialize=function(){this.inputCallbacks.set(uf.LEFT,[]),this.inputCallbacks.set(uf.RIGHT,[]),this.inputCallbacks.set(uf.SPACE,[]),this.lastInputTime.set(uf.LEFT,0),this.lastInputTime.set(uf.RIGHT,0),this.lastInputTime.set(uf.SPACE,0),this.registerTouchEvents(),this.registerKeyboardEvents(),console.log("Audition Input Handler initialized")},i.registerTouchEvents=function(){var t=this;this.leftInputArea&&this.leftInputArea.on(z.EventType.TOUCH_START,(function(e){t.isInputEnabled&&t.handleInput(uf.LEFT)})),this.rightInputArea&&this.rightInputArea.on(z.EventType.TOUCH_START,(function(e){t.isInputEnabled&&t.handleInput(uf.RIGHT)})),this.spaceInputArea&&this.spaceInputArea.on(z.EventType.TOUCH_START,(function(e){t.isInputEnabled&&t.handleInput(uf.SPACE)}))},i.registerKeyboardEvents=function(){var t=this;D.on(z.EventType.KEY_DOWN,(function(e){if(t.isInputEnabled)switch(e.keyCode){case R.ARROW_LEFT:case R.KEY_A:t.handleInput(uf.LEFT);break;case R.ARROW_RIGHT:case R.KEY_D:t.handleInput(uf.RIGHT);break;case R.SPACE:t.handleInput(uf.SPACE)}}))},i.handleInput=function(t){var e=Date.now(),i=this.lastInputTime.get(t);if(!(e-i<this.inputDebounceTime)){this.lastInputTime.set(t,e);var n=this.inputCallbacks.get(t);n&&n.forEach((function(t){return t(e)})),console.log("Input detected: "+uf[t])}},i.registerInputCallback=function(t,e){var i=this.inputCallbacks.get(t);i&&i.push(e)},i.unregisterInputCallback=function(t,e){var i=this.inputCallbacks.get(t);if(i){var n=i.indexOf(e);-1!==n&&i.splice(n,1)}},i.setInputEnabled=function(t){this.isInputEnabled=t,console.log("Input "+(t?"enabled":"disabled"))},i.getInputEnabled=function(){return this.isInputEnabled},i.setInputDebounceTime=function(t){this.inputDebounceTime=t},i.getInputDebounceTime=function(){return this.inputDebounceTime},i.simulateInput=function(t,e){this.lastInputTime.set(t,e);var i=this.inputCallbacks.get(t);i&&i.forEach((function(t){return t(e)})),console.log("Simulated input: "+uf[t])},e}(r)).prototype,"leftInputArea",[Hd],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Yd=It(qd.prototype,"rightInputArea",[Ud],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),jd=It(qd.prototype,"spaceInputArea",[Gd],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Wd=qd))||Wd);t._RF.pop(),t._RF.push({},"dcf6eWvaXRMR72esUo9n+2S","AuditionNotePool",void 0);var pf,df,ff,gf,mf,vf=e.ccclass,yf=e.property,bf=function(t){return t[t.LEFT=0]="LEFT",t[t.RIGHT=1]="RIGHT",t}({}),_f=(Qd=vf("AuditionNotePool"),$d=yf(l),tf=yf(l),Qd((of=It((nf=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,Ot(e,"leftNotePrefab",of,Lt(e)),Ot(e,"rightNotePrefab",rf,Lt(e)),Ot(e,"initialPoolSize",af,Lt(e)),Ot(e,"expandPoolAmount",sf,Lt(e)),e.leftNotePool=[],e.rightNotePool=[],e.activeNotes=new Map,e.nextNoteId=0,e}Nt(e,t);var i=e.prototype;return i.onLoad=function(){this.initializePools()},i.initializePools=function(){this.leftNotePrefab&&this.createPool(bf.LEFT,this.initialPoolSize),this.rightNotePrefab&&this.createPool(bf.RIGHT,this.initialPoolSize)},i.createPool=function(t,e){var i=this.getPoolForType(t),n=this.getPrefabForType(t);if(n){for(var o=0;o<e;o++){var r=E(n);r.parent=this.node,r.active=!1,i.push(r)}console.log("Created pool for note type "+t+" with "+e+" notes")}else console.error("No prefab defined for note type: "+t)},i.getNote=function(t){var e=this.getPoolForType(t);0===e.length&&this.expandPool(t);var i=e.pop();if(!i)return console.error("Failed to get note of type "+t+" from pool"),null;i.active=!0;var n=this.nextNoteId++;return this.activeNotes.set(n,i),{id:n,node:i}},i.recycleNote=function(t){var e=this.activeNotes.get(t);if(e){e.active=!1,e.setPosition(0,0,0),e.setScale(1,1,1);var i=this.getNoteTypeFromNode(e);this.getPoolForType(i).push(e),this.activeNotes.delete(t)}else console.warn("Note with ID "+t+" not found in active notes")},i.recycleAllNotes=function(){var t=this;Array.from(this.activeNotes.keys()).forEach((function(e){return t.recycleNote(e)}))},i.expandPool=function(t){console.log("Expanding pool for note type "+t+" with "+this.expandPoolAmount+" more notes"),this.createPool(t,this.expandPoolAmount)},i.getPoolForType=function(t){switch(t){case bf.LEFT:return this.leftNotePool;case bf.RIGHT:return this.rightNotePool;default:return console.error("Unknown note type: "+t),null}},i.getPrefabForType=function(t){switch(t){case bf.LEFT:return this.leftNotePrefab;case bf.RIGHT:return this.rightNotePrefab;default:return console.error("Unknown note type: "+t),null}},i.getNoteTypeFromNode=function(t){return t.name.toLowerCase().includes("left")?bf.LEFT:bf.RIGHT},i.getActiveNoteCount=function(){return this.activeNotes.size},i.getAvailableNoteCount=function(t){var e=this.getPoolForType(t);return e?e.length:0},e}(r)).prototype,"leftNotePrefab",[$d],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),rf=It(nf.prototype,"rightNotePrefab",[tf],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),af=It(nf.prototype,"initialPoolSize",[yf],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 20}}),sf=It(nf.prototype,"expandPoolAmount",[yf],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 10}}),ef=nf))||ef);t._RF.pop(),t._RF.push({},"b06301HH+lNDJwPFjxXjoas","AuditionNote",void 0);var Sf,wf,Tf,Cf,Ef,Af,Pf,Mf,If,Nf,Of,Lf,Rf,xf,Ff,Df,zf,kf,Vf,Bf,Hf,Uf,Gf,Wf,qf,Zf,Yf,jf,Kf,Xf,Jf,Qf,$f,tg,eg,ig,ng,og=e.ccclass,rg=e.property,ag=(pf=og("AuditionNote"),df=rg(Vd),pf((mf=It((gf=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,Ot(e,"noteVisual",mf,Lt(e)),e.noteType=bf.LEFT,e.beatTime=0,e.targetY=0,e.startY=0,e.isMoving=!1,e.noteId=-1,e}Nt(e,t);var i=e.prototype;return i.initialize=function(t,e,i){switch(this.noteType=t,this.beatTime=e,this.noteId=i,this.noteVisual?this.noteVisual.initialize():console.warn("Note visual component is not assigned!"),this.noteType){case bf.LEFT:this.node.name="LeftNote";break;case bf.RIGHT:this.node.name="RightNote"}},i.playHitEffect=function(t){this.isMoving=!1,this.noteVisual&&this.noteVisual.showHitEffect()},i.playMissEffect=function(){this.isMoving=!1,this.noteVisual&&this.noteVisual.showMissEffect()},i.reset=function(){this.isMoving=!1,this.noteVisual&&this.noteVisual.reset(),this.node.active=!0},i.matchesInput=function(t){return this.noteType===t},i.getNoteId=function(){return this.noteId},i.getNoteType=function(){return this.noteType},e}(r)).prototype,"noteVisual",[df],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ff=gf))||ff);t._RF.pop(),t._RF.push({},"e8f01vW2ehGAbebHt2Bdk2+","AuditionBeatSystem",void 0);var sg,lg=e.ccclass,cg=e.property,ug=function(t){return t[t.PERFECT=0]="PERFECT",t[t.GOOD=1]="GOOD",t[t.MISS=2]="MISS",t}({}),hg=function(t){return t.OFF="off",t.LEVEL="lv",t.FINISH="finish",t}({}),pg=(Sf=lg("AuditionBeatSystem"),wf=cg({type:c,group:{name:"Visual Elements",id:"visual"}}),Tf=cg({type:c,group:{name:"Visual Elements",id:"visual"}}),Cf=cg({type:c,group:{name:"Visual Elements",id:"visual"}}),Ef=cg({type:c,group:{name:"Visual Elements",id:"visual"}}),Af=cg({type:f,group:{name:"Visual Elements",id:"visual"}}),Pf=cg({type:b,group:{name:"Visual Elements",id:"visual"}}),Mf=cg({type:y,group:{name:"Visual Elements",id:"visual"}}),If=cg({type:Jd,group:{name:"Visual Elements",id:"visual"}}),Nf=cg({type:hf,group:{name:"Input",id:"input"}}),Of=cg({group:{name:"Beat Settings",id:"beat"}}),Lf=cg({group:{name:"Beat Settings",id:"beat"}}),Rf=cg({group:{name:"Timing Windows",id:"timing"}}),xf=cg({group:{name:"Timing Windows",id:"timing"}}),Ff=cg({group:{name:"Timing Windows",id:"timing"}}),Df=cg({type:_f,group:{name:"Note Settings",id:"notes"}}),zf=cg({type:c,group:{name:"Note Settings",id:"notes"}}),kf=cg({type:rt,group:{name:"Note Settings",id:"notes"}}),Sf((Hf=It((Bf=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,Ot(e,"movingBeatNote",Hf,Lt(e)),Ot(e,"targetZone",Uf,Lt(e)),Ot(e,"startNode",Gf,Lt(e)),Ot(e,"endNode",Wf,Lt(e)),Ot(e,"heartBeatSprite",qf,Lt(e)),Ot(e,"opacityGameplay",Zf,Lt(e)),Ot(e,"levelLabel",Yf,Lt(e)),Ot(e,"audioManager",jf,Lt(e)),Ot(e,"inputHandler",Kf,Lt(e)),Ot(e,"bpm",Xf,Lt(e)),Ot(e,"beatsPerLoop",Jf,Lt(e)),Ot(e,"perfectWindow",Qf,Lt(e)),Ot(e,"goodWindow",$f,Lt(e)),Ot(e,"missWindow",tg,Lt(e)),Ot(e,"notePool",eg,Lt(e)),Ot(e,"nodeContainer",ig,Lt(e)),Ot(e,"nodeDistance",ng,Lt(e)),e.isPlaying=!1,e.timingWindows=new Map,e.currentLoop=0,e.lastBeatTime=0,e.songDuration=0,e.isAutoPlay=!1,e.scoringCallback=null,e.readyCallback=null,e.levelChangedCallback=null,e.startX=-500,e.endX=500,e.targetX=0,e.noteSpeed=0,e.noteDelay=0,e.currentLevel=0,e.currentLevelLoop=0,e.requiredNotes=0,e.currentNotes=0,e.isInDelay=!1,e.delayLoops=0,e.levelSequences=[],e.currentSequenceIndex=0,e.penaltyPatternLoops=0,e.activeNoteIds=[],e.noteSequence=[],e.currentSequenceNotes=[],e}Nt(e,t);var i=e.prototype;return i.onLoad=function(){this.timingWindows.set(ug.PERFECT,this.perfectWindow),this.timingWindows.set(ug.GOOD,this.goodWindow),this.timingWindows.set(ug.MISS,this.missWindow),this.startX=this.startNode.position.x,this.endX=this.endNode.position.x,this.targetX=this.targetZone.position.x,this.updateSpeed(),this.movingBeatNote?(this.movingBeatNote.position=new g(this.startX,this.startNode.position.y,this.startNode.position.z),this.heartBeatSprite&&(this.heartBeatSprite.node.scale=new g(1,1,1))):console.error("No note assigned to AuditionBeatSystem!")},i.updateSpeed=function(){var t=this.endX-this.startX,e=6e4/this.bpm/1e3*this.beatsPerLoop;this.noteSpeed=t/e;var i=this.endX-this.targetX;this.noteDelay=i/t*e},i.getCurrentTime=function(){return this.audioManager.getCurrentTime()},i.update=function(t){if(this.isPlaying&&this.movingBeatNote&&this.audioManager){var e=this.getCurrentTime(),i=6e4/this.bpm,n=i*this.beatsPerLoop;e-this.lastBeatTime>=n+this.missWindow&&(this.lastBeatTime=Math.round(e/n)*n,this.currentLoop++,this.updateLevelSystem()),this.updateBeatNoteMoving(e),this.updateHeartBeatEffect(e,i,n),this.handleAutoPlay()}},i.initializeLevelSequences=function(){this.levelSequences=[{type:hg.OFF,loop:3,notes:0},{type:hg.LEVEL,loop:1,notes:1},{type:hg.LEVEL,loop:1,notes:2},{type:hg.LEVEL,loop:1,notes:3},{type:hg.LEVEL,loop:1,notes:4},{type:hg.LEVEL,loop:1,notes:5},{type:hg.LEVEL,loop:4,notes:6,delay:1},{type:hg.LEVEL,loop:4,notes:7,delay:1},{type:hg.LEVEL,loop:4,notes:8,delay:1},{type:hg.LEVEL,loop:4,notes:9,delay:1},{type:hg.FINISH,loop:1,notes:9}]},i.startBeatSystem=function(t,e,i){var n=this;if(this.movingBeatNote&&(this.bpm=t,this.updateSpeed(),this.isPlaying=!0,this.songDuration=e,this.initializeLevelSequences(),this.currentSequenceIndex=0,this.currentLevel=0,this.currentNotes=0,this.penaltyPatternLoops=0,this.activeNoteIds=[],this.noteSequence=[],this.audioManager)){this.lastBeatTime=this.audioManager.getCurrentTime(),this.currentLoop=0,this.inputHandler&&(this.inputHandler.registerInputCallback(uf.SPACE,(function(t){return n.evaluateInput(t)})),this.inputHandler.registerInputCallback(uf.LEFT,(function(t){return n.handleNoteInput(bf.LEFT,t)})),this.inputHandler.registerInputCallback(uf.RIGHT,(function(t){return n.handleNoteInput(bf.RIGHT,t)}))),console.log("Beat system started with level sequences"),this.isInDelay=!1,this.delayLoops=0,this.currentLevelLoop=0,this.updateGameplayInteractableVisualize();var o=6e4/this.bpm/1e3*this.beatsPerLoop*4,r=Math.max(0,o-1);this.scheduleOnce((function(){n.readyCallback&&(n.readyCallback(),n.readyCallback=null)}),r)}},i.updateLevelSystem=function(){var t=this;if(this.noteSequence.length>0&&this.handleMiss(),this.clearLastNotes(),this.isInDelay)return this.delayLoops--,void(this.delayLoops<=0&&(this.isInDelay=!1));var e=function(e){t.isInPenalty&&t.penaltyPatternLoops--,t.startNextPattern(),e.delay&&(t.delayLoops=e.delay,t.isInDelay=!0)},i=this.levelSequences[this.currentSequenceIndex];if(this.currentLevelLoop>=i.loop){this.currentSequenceIndex++,this.currentSequenceIndex>=this.levelSequences.length&&(this.currentSequenceIndex=0,this.penaltyPatternLoops=0);var n=this.levelSequences[this.currentSequenceIndex];n.type===hg.OFF?(this.delayLoops=n.loop,this.currentLevelLoop=n.loop,this.isInDelay=!0):n.type===hg.LEVEL?(this.currentLevel=n.notes,this.currentLevelLoop=1,this.updateLevelTextNormal(this.currentLevel),this.levelChangedCallback&&this.levelChangedCallback(this.currentLevel,n.type),e(n)):n.type===hg.FINISH&&(this.currentLevelLoop=1,e(n),this.updateLevelTextFinish())}else this.currentLevelLoop++,i.type===hg.LEVEL&&e(i)},i.startNextPattern=function(){var t=this.levelSequences[this.currentSequenceIndex];this.requiredNotes=t.notes,this.currentNotes=0,this.noteSequence=[],this.currentSequenceNotes=[];for(var e=-this.nodeDistance*this.requiredNotes/2+this.nodeDistance/2,i=0;i<this.requiredNotes;i++){var n=Math.random()<.5?bf.LEFT:bf.RIGHT;this.noteSequence.push(n);var o=this.notePool.getNote(n),r=o.id,a=o.node;if(a.parent=this.nodeContainer,a){this.activeNoteIds.push(r);var s=a.getComponent(ag);s.initialize(n,this.lastBeatTime,r),this.currentSequenceNotes.push(s),a.setPosition(new g(e+i*this.nodeDistance,0,0))}}this.updateGameplayInteractableVisualize()},i.updateLevelTextNormal=function(t){this.levelLabel&&(this.levelLabel.string="Level "+t.toString(),this.levelLabel.shadowColor=t<=3?new X(0,0,0,255):t<=6?new X(0,0,128,255):t<=9?new X(128,0,128,255):new X(178,34,34,255)),this.levelLabel&&(at.stopAllByTarget(this.levelLabel.node),this.levelLabel.node.setScale(new g(1.5,1.5,1)),v(this.levelLabel.node).to(.3,{scale:new g(1,1,1)},{easing:"bounceOut"}).start())},i.updateLevelTextFinish=function(){this.levelLabel&&(this.levelLabel.string="Finish Move",this.levelLabel.shadowColor=new X(255,165,0,255),at.stopAllByTarget(this.levelLabel.node),this.levelLabel.node.setScale(new g(1,1,1)),v(this.levelLabel.node).to(.5,{scale:new g(1.2,1.2,1)}).to(.5,{scale:new g(1,1,1)}).union().repeatForever().start())},i.handleNoteInput=function(t,e){this.isPlaying&&!this.isInPenalty&&(this.currentNotes>=this.noteSequence.length||(this.currentNotes<this.noteSequence.length&&this.noteSequence[this.currentNotes]===t?(this.currentSequenceNotes[this.currentNotes].playHitEffect(ug.PERFECT),this.currentNotes++):(this.currentNotes=0,this.currentSequenceNotes.forEach((function(t){return t.reset()})))))},i.evaluateInput=function(t){if(this.isPlaying&&!this.isInPenalty&&0!=this.noteSequence.length&&this.audioManager){var e,i=this.getCurrentTime(),n=6e4/this.bpm*this.beatsPerLoop,o=(i-this.lastBeatTime)/n,r=Math.abs(1-o);e=r<=this.timingWindows.get(ug.PERFECT)/n?ug.PERFECT:r<=this.timingWindows.get(ug.GOOD)/n?ug.GOOD:ug.MISS,this.isMiss()||e==ug.MISS?this.handleMiss():this.handleScored(e)}},i.handleAutoPlay=function(){if(this.isAutoPlay&&this.isPlaying&&!this.isInPenalty){var t=this.getCurrentTime(),e=6e4/this.bpm*this.beatsPerLoop,i=(t-this.lastBeatTime)/e,n=Math.abs(1-i);if(this.noteSequence.length>0&&this.currentNotes<this.noteSequence.length&&this.inputHandler){var o=this.noteSequence[this.currentNotes];o===bf.LEFT?this.inputHandler.simulateInput(uf.LEFT,t):o===bf.RIGHT&&this.inputHandler.simulateInput(uf.RIGHT,t)}n<=this.timingWindows.get(ug.PERFECT)/e&&this.inputHandler&&this.inputHandler.simulateInput(uf.SPACE,t)}},i.clearLastNotes=function(){var t=this;this.activeNoteIds.forEach((function(e){return t.notePool.recycleNote(e)})),this.activeNoteIds=[],this.noteSequence=[],this.currentNotes=0},i.handleMiss=function(){this.isInPenalty||(this.penaltyPatternLoops=2,this.scoringCallback&&this.scoringCallback(ug.MISS),this.updateGameplayInteractableVisualize())},i.handleScored=function(t){this.clearLastNotes(),this.scoringCallback&&this.scoringCallback(t)},i.isMiss=function(){return this.currentNotes<this.requiredNotes},i.updateBeatNoteMoving=function(t){var e=(t-this.lastBeatTime)/1e3-this.noteDelay,i=this.startX;i=e>0?this.startX+this.noteSpeed*e:this.endX+this.noteSpeed*e,this.movingBeatNote.position=new g(i,this.movingBeatNote.position.y,this.movingBeatNote.position.z)},i.updateHeartBeatEffect=function(t,e,i){if(this.heartBeatSprite){var n=t-this.lastBeatTime,o=t%e,r=n>i-.5*e&&n<i+.5*e?Math.max(1,2*(1-o/e)):1;this.heartBeatSprite.node.setScale(new g(r,1,1));var a=Math.max(.5,1-o/e),s=this.heartBeatSprite.color.clone();s.a=255*a,this.heartBeatSprite.color=s}},i.updateGameplayInteractableVisualize=function(){if(this.opacityGameplay){var t=!this.isInPenalty&&this.isPlaying;this.opacityGameplay.opacity=t?255:50}},i.stopBeatSystem=function(){var t=this;this.isPlaying=!1,this.isAutoPlay=!1,this.inputHandler&&(this.inputHandler.unregisterInputCallback(uf.SPACE,(function(e){return t.evaluateInput(e)})),this.inputHandler.unregisterInputCallback(uf.LEFT,(function(e){return t.handleNoteInput(bf.LEFT,e)})),this.inputHandler.unregisterInputCallback(uf.RIGHT,(function(e){return t.handleNoteInput(bf.RIGHT,e)}))),console.log("Beat system stopped")},i.setScoreCallback=function(t){this.scoringCallback=t},i.setReadyCallback=function(t){this.readyCallback=t},i.setLevelChangedCallback=function(t){this.levelChangedCallback=t},i.getBPM=function(){return this.bpm},i.setBPM=function(t){this.bpm=Math.max(60,Math.min(200,t)),console.log("BPM set to "+this.bpm)},i.getBeatsPerLoop=function(){return this.beatsPerLoop},i.setBeatsPerLoop=function(t){this.beatsPerLoop=Math.max(1,Math.min(8,t)),console.log("Beats per loop set to "+this.beatsPerLoop)},i.setAutoPlay=function(t){this.isAutoPlay=t,console.log("Auto-play "+(t?"enabled":"disabled"))},i.isAutoPlayEnabled=function(){return this.isAutoPlay},Ft(e,[{key:"isInPenalty",get:function(){return this.penaltyPatternLoops>0}}]),e}(r)).prototype,"movingBeatNote",[wf],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Uf=It(Bf.prototype,"targetZone",[Tf],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Gf=It(Bf.prototype,"startNode",[Cf],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Wf=It(Bf.prototype,"endNode",[Ef],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),qf=It(Bf.prototype,"heartBeatSprite",[Af],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Zf=It(Bf.prototype,"opacityGameplay",[Pf],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Yf=It(Bf.prototype,"levelLabel",[Mf],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),jf=It(Bf.prototype,"audioManager",[If],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Kf=It(Bf.prototype,"inputHandler",[Nf],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Xf=It(Bf.prototype,"bpm",[Of],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 120}}),Jf=It(Bf.prototype,"beatsPerLoop",[Lf],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 4}}),Qf=It(Bf.prototype,"perfectWindow",[Rf],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 50}}),$f=It(Bf.prototype,"goodWindow",[xf],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 100}}),tg=It(Bf.prototype,"missWindow",[Ff],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 200}}),eg=It(Bf.prototype,"notePool",[Df],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ig=It(Bf.prototype,"nodeContainer",[zf],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ng=It(Bf.prototype,"nodeDistance",[kf],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 65}}),Vf=Bf))||Vf);t._RF.pop(),t._RF.push({},"b36e0MayvRDhqtAvXGvTrjp","AuditionBeatmap",void 0);var dg,fg,gg=e.ccclass;e.property,gg("AuditionBeatmap")(sg=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).currentBeatmap=null,e}Nt(e,t);var i=e.prototype;return i.generateBeatmap=function(t,e,i,n){var o=this;return new Promise((function(r){for(var a=[],s=6e4/e*n,l=1e3,c=i-2e3;l<c;)a.push({time:l,type:2}),l+=s;var u={songId:t,bpm:e,offset:0,notes:a,difficulty:2,creator:"System",version:"1.0"};o.currentBeatmap=u,console.log("Beatmap generated successfully: "+u.songId),r(u)}))},i.getCurrentBeatmap=function(){return this.currentBeatmap},i.getNotesInTimeRange=function(t,e){return this.currentBeatmap&&this.currentBeatmap.notes?this.currentBeatmap.notes.filter((function(i){return i.time>=t&&i.time<=e})):[]},i.getNotesToSpawn=function(t,e){return this.getNotesInTimeRange(t,t+e)},i.getTotalNoteCount=function(){var t;return(null==(t=this.currentBeatmap)||null==(t=t.notes)?void 0:t.length)||0},e}(r));t._RF.pop(),t._RF.push({},"5d9e2TkgsBGdK4Et+YVimdr","AuditionCharacterAnimationData",void 0);var mg,vg,yg,bg,_g,Sg,wg,Tg,Cg,Eg,Ag=e.ccclass,Pg=(e.property,function(t){return t.FIRST_STAND="first_stand",t.LAST_STAND="last_stand",t.BOY_START="boy_start",t.GIRL_START="girl_start",t.DANCE_START="dance_start",t.DANCE_END="dance_end",t.BOY_WIN="boy_win",t.BOY_LOSE="boy_lose",t.GIRL_WIN="girl_win",t.GIRL_LOSE="girl_lose",t.END1="end1",t.END2="end2",t.END3="end3",t.END4="end4",t.MISS="miss",t}({})),Mg=Ag("AuditionCharacterAnimationData")(((fg=function(){function t(){}return t.initialize=function(){this.specialStates.clear(),this.danceStates.clear(),this.currentSequence=[],this.initializeSpecialStates()},t.initializeSpecialStates=function(){this.specialStates.set(Pg.FIRST_STAND,{speed:1,motion:"first_stand",transitions:[{srcState:"first_stand",destState:"boy_start",transitionDuration:.2,transitionOffset:0,exitTime:.9}],isLooping:!1}),this.specialStates.set(Pg.LAST_STAND,{speed:1,motion:"last_stand",transitions:[],isLooping:!0}),this.specialStates.set(Pg.BOY_START,{speed:1,motion:"boy_start",transitions:[{srcState:"boy_start",destState:"dance_start",transitionDuration:.2,transitionOffset:0,exitTime:.9}],isLooping:!1}),this.specialStates.set(Pg.GIRL_START,{speed:1,motion:"girl_start",transitions:[{srcState:"girl_start",destState:"dance_start",transitionDuration:.2,transitionOffset:0,exitTime:.9}],isLooping:!1}),this.specialStates.set(Pg.DANCE_START,{speed:1,motion:"dance_start",transitions:[{srcState:"dance_start",destState:"default_dance",transitionDuration:.2,transitionOffset:0,exitTime:.9}],isLooping:!1}),this.specialStates.set(Pg.DANCE_END,{speed:1,motion:"dance_end",transitions:[],isLooping:!1}),this.specialStates.set(Pg.BOY_WIN,{speed:1,motion:"boy_win",transitions:[{srcState:"boy_win",destState:"last_stand",transitionDuration:.2,transitionOffset:0,exitTime:.9}],isLooping:!1}),this.specialStates.set(Pg.BOY_LOSE,{speed:1,motion:"boy_lose",transitions:[{srcState:"boy_lose",destState:"last_stand",transitionDuration:.2,transitionOffset:0,exitTime:.9}],isLooping:!1}),this.specialStates.set(Pg.GIRL_WIN,{speed:1,motion:"girl_win",transitions:[{srcState:"girl_win",destState:"last_stand",transitionDuration:.2,transitionOffset:0,exitTime:.9}],isLooping:!1}),this.specialStates.set(Pg.GIRL_LOSE,{speed:1,motion:"girl_lose",transitions:[{srcState:"girl_lose",destState:"last_stand",transitionDuration:.2,transitionOffset:0,exitTime:.9}],isLooping:!1}),this.specialStates.set(Pg.MISS,{speed:1,motion:"miss",transitions:[],isLooping:!1})},t.loadDanceData=function(t){var e=this;return new Promise((function(i,n){$e.loadRes("audition/dances/"+t,st,(function(t,o){if(t)return console.error("Failed to load dance data:",t),void n(t);e.parseDanceData(o.text),i()}))}))},t.parseDanceData=function(t){var e=this,i=t.split("\n"),n="",o=[];this.beginDanceState="";for(var r=0;r<i.length;r++){var a=i[r].trim();if(a)if(a.startsWith("DefaultState:"))this.defaultState=a.split(":")[1].trim();else if(a.startsWith("[")&&a.endsWith("]")){var s=Array.from(this.specialStates.keys()).some((function(t){return e.specialStates.get(t).motion===n}));n&&!s&&(this.saveState(n,o),o=[]),n=a.slice(1,-1).trim()}else if(n){var l=Array.from(this.specialStates.keys()).some((function(t){return e.specialStates.get(t).motion===n}));if(a.startsWith("Speed:")){var c=parseFloat(a.split(":")[1].trim());l?this.updateSpecialStateSpeed(n,c):this.updateStateSpeed(n,c)}else if(a.startsWith("Motion:")){var u=a.split(":")[1].trim();l?this.updateSpecialStateMotion(n,u):(this.updateStateMotion(n,u),this.beginDanceState||this.specialStates.has(u)||(this.beginDanceState=n))}else if(a.startsWith("Transition:")){var h=this.parseTransition(i,r);h&&(l?this.updateSpecialStateTransitions(n,h):o.push(h))}else if(a.startsWith("IsLooping:")){var p="true"===a.split(":")[1].trim().toLowerCase();l?this.updateSpecialStateLooping(n,p):this.updateStateLooping(n,p)}else if(a.startsWith("NextState:")){var d=a.split(":")[1].trim();l||this.updateStateNext(n,d)}}}this.buildDanceSequence(),console.log("Loaded "+this.danceStates.size+" dance states")},t.buildDanceSequence=function(){this.currentSequence=[];for(var t=this.defaultState;t;){this.currentSequence.push(t);var e=this.danceStates.get(t);if(!e||!e.nextState)break;t=e.nextState}},t.getAllDanceStates=function(){return Array.from(this.danceStates.values())},t.parseTransition=function(t,e){for(var i={srcState:"",destState:"",transitionDuration:0,transitionOffset:0,exitTime:0},n=e+1;n<t.length&&t[n].startsWith("\t");){var o=t[n].trim();if(o.startsWith("SrcState:"))i.srcState=o.split(":")[1].trim();else if(o.startsWith("DestState:"))i.destState=o.split(":")[1].trim();else if(o.startsWith("TransitionDuration:"))i.transitionDuration=parseFloat(o.split(":")[1].trim());else if(o.startsWith("TransitionOffset:"))i.transitionOffset=parseFloat(o.split(":")[1].trim());else if(o.startsWith("ExitTime:"))i.exitTime=parseFloat(o.split(":")[1].trim());else if(o.startsWith("Condition:")){var r=o.split(":")[1].trim();i.condition=this.parseCondition(r)}n++}return i},t.parseCondition=function(t){return new Function("combo","accuracy","return "+t)},t.saveState=function(t,e){var i=this.danceStates.get(t)||{speed:1,motion:t,transitions:[],isLooping:!1};i.transitions=e,this.danceStates.set(t,i)},t.updateStateSpeed=function(t,e){var i=this.danceStates.get(t)||{speed:1,motion:t,transitions:[],isLooping:!1};i.speed=e,this.danceStates.set(t,i)},t.updateStateMotion=function(t,e){var i=this.danceStates.get(t)||{speed:1,motion:t,transitions:[],isLooping:!1};i.motion=e,this.danceStates.set(t,i)},t.updateStateLooping=function(t,e){var i=this.danceStates.get(t)||{speed:1,motion:t,transitions:[],isLooping:!1};i.isLooping=e,this.danceStates.set(t,i)},t.updateStateNext=function(t,e){var i=this.danceStates.get(t)||{speed:1,motion:t,transitions:[],isLooping:!1};i.nextState=e,this.danceStates.set(t,i)},t.getDanceState=function(t){return this.danceStates.get(t)||null},t.getDefaultState=function(){return this.defaultState},t.getBeginDanceState=function(){return this.beginDanceState},t.getSpecialState=function(t){return this.specialStates.get(t)||null},t.getDanceSequence=function(){return[].concat(this.currentSequence)},t.getAllAnimationNames=function(){var t=Array.from(this.danceStates.keys()),e=Array.from(this.specialStates.values()).map((function(t){return t.motion}));return t.concat(e)},t.updateSpecialStateSpeed=function(t,e){for(var i,n=Dt(this.specialStates.entries());!(i=n()).done;){var o=i.value,r=o[0],a=o[1];if(a.motion===t){a.speed=e,this.specialStates.set(r,a);break}}},t.updateSpecialStateMotion=function(t,e){for(var i,n=Dt(this.specialStates.entries());!(i=n()).done;){var o=i.value,r=o[0],a=o[1];if(a.motion===t){a.motion=e,this.specialStates.set(r,a);break}}},t.updateSpecialStateTransitions=function(t,e){for(var i,n=Dt(this.specialStates.entries());!(i=n()).done;){var o=i.value,r=o[0],a=o[1];if(a.motion===t){a.transitions.push(e),this.specialStates.set(r,a);break}}},t.updateSpecialStateLooping=function(t,e){for(var i,n=Dt(this.specialStates.entries());!(i=n()).done;){var o=i.value,r=o[0],a=o[1];if(a.motion===t){a.isLooping=e,this.specialStates.set(r,a);break}}},t}()).specialStates=new Map,fg.danceStates=new Map,fg.defaultState="",fg.beginDanceState="",fg.currentSequence=[],dg=fg))||dg;t._RF.pop(),t._RF.push({},"1e7b6TmLYNOJqHH2ZZSRUXY","AuditionCharacterAnimation",void 0);var Ig,Ng,Og,Lg,Rg,xg,Fg,Dg,zg,kg,Vg,Bg,Hg,Ug,Gg,Wg=e.ccclass,qg=e.property,Zg=(mg=Wg("AuditionCharacterAnimation"),vg=qg(c),yg=qg(it),mg((Sg=It((_g=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,Ot(e,"character",Sg,Lt(e)),Ot(e,"animationController",wg,Lt(e)),Ot(e,"transitionDuration",Tg,Lt(e)),Ot(e,"comboThreshold",Cg,Lt(e)),Ot(e,"inputHistorySize",Eg,Lt(e)),e.currentCombo=0,e.inputHistory=[],e.isMale=!0,e.animMap=new Map,e.animNames=[],e.allDanceStates=[],e.currentDanceIndex=0,e.musicSpeed=1,e}Nt(e,t);var i=e.prototype;return i.loadDanceData=function(t){var e=this;return!this.animationController&&this.character&&(this.animationController=this.character.getComponent(it)),new Promise((function(i,n){Mg.initialize();var o=t+"_Dance";Mg.loadDanceData(o).then((function(){return e.animNames=Mg.getAllAnimationNames(),console.log("Animation names to be loaded:"),e.animNames.forEach((function(t,e){console.log(e+1+". "+t)})),console.log("Loading "+e.animNames.length+" dance animations for song: "+t),e.loadDanceAnims(e.animNames)})).then((function(t){console.log("Successfully loaded "+t.length+" dance animations"),e.setClips(t,e.animNames),e.allDanceStates=Mg.getAllDanceStates(),e.currentDanceIndex=-1,e.playSpecialAnimation(Pg.FIRST_STAND),i("success")})).catch((function(t){console.error("Failed to load dance: "+t),n(t)}))}))},i.setClips=function(t,e){for(var i=0;i<t.length;i++){var n=t[i],o=e[i];this.animationController.createState(n,o)}},i.testLoadDanceAnim=function(){this.loadDanceAnim("Breakdance")},i.loadDanceAnims=function(){var t=Rt(xt().mark((function t(e){var i,n,o,r,a;return xt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:for(i=[],n=Dt(e);!(o=n()).done;)r=o.value,i.push(this.loadDanceAnim(r));return t.prev=2,t.next=5,Promise.all(i);case 5:return a=t.sent,t.abrupt("return",a);case 9:throw t.prev=9,t.t0=t.catch(2),console.error("Failed to load multiple dance animations:",t.t0),t.t0;case 13:case"end":return t.stop()}}),t,this,[[2,9]])})));return function(e){return t.apply(this,arguments)}}(),i.loadDanceAnim=function(){var t=Rt(xt().mark((function t(e){var i=this;return xt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t,n){$e.loadRes("audition/anims/"+e,l,(function(o,r){if(o)return console.error("Failed to load character as  nimation prefab:",o),void n(o);try{var a=E(r),s=a.getComponent(lt);if(!s)return console.error("No SkeletalAnimation component found in prefab: "+e),a.destroy(),void n(new Error("Missing SkeletalAnimation component"));var l=s.clips[0];if(!l)return console.error("No animation clips found in prefab: "+e),a.destroy(),void n(new Error("No animation clips found"));a.destroy(),console.log("Successfully loaded and setup animation prefab: "+e),l.name=e,i.animMap.set(e,l),t(l)}catch(t){console.error("Error processing animation prefab:",t),n(t)}}))})));case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),i.setGender=function(t){this.isMale=t},i.reactToInput=function(t,e){if(console.log("reactToInput: "+t+" "+e),this.currentCombo=e,this.recordInput(t),t===ug.MISS)return this.playMissAnimation(),void this.nextDanceState();this.playNextDanceState()},i.nextDanceState=function(){this.currentDanceIndex=++this.currentDanceIndex%this.allDanceStates.length},i.playNextDanceState=function(){this.nextDanceState();var t=this.allDanceStates[this.currentDanceIndex].transitions[0].srcState;this.playAnimation(t,this.allDanceStates[this.currentDanceIndex],1)},i.playSpecialAnimation=function(t,e){var i=Mg.getSpecialState(t);i?this.playAnimation(i.motion,i,i.speed,e):console.error("Special animation state not found: "+t)},i.playMissAnimation=function(){var t=Mg.getSpecialState(Pg.MISS);this.playAnimation(t.motion,t,t.speed)},i.setMusicSpeed=function(t){this.musicSpeed=t/100},i.playAnimation=function(t,e,i,n){if(void 0===i&&(i=1),this.animationController){var o=this.animationController.getState(t);if(o){if(o.speed=i*this.musicSpeed,e&&e.transitions&&e.transitions.length>0){var r=e.transitions[0].exitTime||.95;this.animationController.crossFade(t,r)}else this.animationController.crossFade(t,.3);n&&o.on("finished",n,this)}else console.error("Animation state not found: "+t)}},i.recordInput=function(t){this.inputHistory.push({accuracyRating:t,timestamp:Date.now()}),this.inputHistory.length>this.inputHistorySize&&this.inputHistory.shift()},i.endDanceSequence=function(t){var e,i=this;e=this.isMale?t?Pg.END2:Pg.END1:t?Pg.END4:Pg.END3,this.playSpecialAnimation(e,(function(){i.playSpecialAnimation(Pg.LAST_STAND)}))},i.resetToIdle=function(){this.currentCombo=0,this.inputHistory=[],this.playSpecialAnimation(Pg.FIRST_STAND)},e}(r)).prototype,"character",[vg],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),wg=It(_g.prototype,"animationController",[yg],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Tg=It(_g.prototype,"transitionDuration",[qg],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.2}}),Cg=It(_g.prototype,"comboThreshold",[qg],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 10}}),Eg=It(_g.prototype,"inputHistorySize",[qg],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 20}}),bg=_g))||bg);t._RF.pop(),t._RF.push({},"2ce00HNOcFEMZsuE2WXEEkB","AuditionScoringSystem",void 0);var Yg,jg,Kg,Xg,Jg,Qg,$g,tm,em,im,nm,om,rm,am,sm,lm,cm,um,hm,pm,dm,fm,gm,mm,vm,ym,bm,_m,Sm,wm,Tm,Cm,Em,Am,Pm,Mm,Im,Nm,Om,Lm,Rm,xm,Fm,Dm=e.ccclass,zm=e.property,km=(Ig=Dm("AuditionScoringSystem"),Ng=zm(Jd),Ig((Rg=It((Lg=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,Ot(e,"perfectScore",Rg,Lt(e)),Ot(e,"goodScore",xg,Lt(e)),Ot(e,"missScore",Fg,Lt(e)),Ot(e,"comboMultiplierIncrement",Dg,Lt(e)),Ot(e,"maxComboMultiplier",zg,Lt(e)),Ot(e,"comboBreakPenalty",kg,Lt(e)),Ot(e,"patternComplexityMultiplier",Vg,Lt(e)),Ot(e,"consecutivePatternBonus",Bg,Lt(e)),Ot(e,"finishMoveMultiplier",Hg,Lt(e)),Ot(e,"patternSkipPenalty",Ug,Lt(e)),Ot(e,"audioManager",Gg,Lt(e)),e.patternsCompleted=0,e.consecutivePatterns=0,e.finishMovesCompleted=0,e.patternsSkipped=0,e.totalScore=0,e.currentCombo=0,e.maxCombo=0,e.patternMultiplier=1,e.accuracyStats={perfect:0,good:0,miss:0,total:0},e.onScoreUpdateCallback=null,e.onComboUpdateCallback=null,e.onPatternMultiplierUpdateCallback=null,e}Nt(e,t);var i=e.prototype;return i.reset=function(){this.totalScore=0,this.currentCombo=0,this.maxCombo=0,this.patternMultiplier=1,this.patternsCompleted=0,this.consecutivePatterns=0,this.finishMovesCompleted=0,this.patternsSkipped=0,this.accuracyStats={perfect:0,good:0,miss:0,total:0},this.onScoreUpdateCallback&&this.onScoreUpdateCallback(this.totalScore),this.onComboUpdateCallback&&this.onComboUpdateCallback(this.currentCombo),this.onPatternMultiplierUpdateCallback&&this.onPatternMultiplierUpdateCallback(this.patternMultiplier),console.log("Scoring system reset")},i.processNoteResult=function(t,e){this.accuracyStats.total++;var i=0;switch(t){case ug.PERFECT:this.accuracyStats.perfect++,i=this.perfectScore,this.updateCombo(!0);var n=1===this.currentCombo?"perfect":"perfect"+Math.min(this.currentCombo,5);this.audioManager.playSound(n);break;case ug.GOOD:this.accuracyStats.good++,i=this.goodScore,this.updateCombo(!1),this.audioManager.playSound("good");break;case ug.MISS:this.accuracyStats.miss++,i=this.missScore,this.updateCombo(!1),this.audioManager.playSound("miss")}var o=1+Math.min(this.maxComboMultiplier-1,this.comboMultiplierIncrement*(this.currentCombo-1)),r=t===ug.MISS?i:Math.floor(i*o);this.totalScore+=r,this.onScoreUpdateCallback&&this.onScoreUpdateCallback(this.totalScore),console.log("Note result: "+ug[t]+", Score: "+this.totalScore+", Combo: "+this.currentCombo+", Points earned: "+r)},i.processPatternResult=function(t,e,i){if(t===ug.MISS)return this.patternsSkipped++,this.consecutivePatterns=0,this.resetPatternMultiplier(),this.totalScore=Math.max(0,this.totalScore-this.patternSkipPenalty),void console.log("Pattern missed! Score: "+this.totalScore+", Skipped: "+this.patternsSkipped);var n=50*e;t===ug.PERFECT&&(n*=1.5);var o=Math.floor(n*this.patternMultiplier);if(this.patternsCompleted++,this.consecutivePatterns++,i){this.finishMovesCompleted++;var r=Math.floor(o*(this.finishMoveMultiplier-1));this.totalScore+=o+r,console.log("Finish move completed! Base: "+o+", Bonus: "+r)}else if(this.totalScore+=o,this.consecutivePatterns>1){var a=this.consecutivePatternBonus*(this.consecutivePatterns-1);this.totalScore+=a,console.log("Consecutive pattern bonus: +"+a)}this.increasePatternMultiplier(),this.onScoreUpdateCallback&&this.onScoreUpdateCallback(this.totalScore),console.log("Pattern completed! Complexity: "+e+", Score added: "+o+", Total: "+this.totalScore+", Pattern multiplier: "+this.patternMultiplier.toFixed(1)+"x")},i.updateCombo=function(t){t?(this.currentCombo++,this.currentCombo>this.maxCombo&&(this.maxCombo=this.currentCombo)):(this.comboBreakPenalty>0&&(this.totalScore=Math.max(0,this.totalScore-this.comboBreakPenalty)),this.currentCombo=0),this.onComboUpdateCallback&&this.onComboUpdateCallback(this.currentCombo)},i.onScoreUpdate=function(t){this.onScoreUpdateCallback=t},i.onComboUpdate=function(t){this.onComboUpdateCallback=t},i.onPatternMultiplierUpdate=function(t){this.onPatternMultiplierUpdateCallback=t},i.increasePatternMultiplier=function(){this.patternMultiplier+=.1,this.onPatternMultiplierUpdateCallback&&this.onPatternMultiplierUpdateCallback(this.patternMultiplier)},i.resetPatternMultiplier=function(){this.patternMultiplier=1,this.onPatternMultiplierUpdateCallback&&this.onPatternMultiplierUpdateCallback(this.patternMultiplier)},i.handlePatternBreak=function(){this.consecutivePatterns=0,this.resetPatternMultiplier(),this.updateCombo(!1)},i.getScore=function(){return this.totalScore},i.getCombo=function(){return this.currentCombo},i.getMaxCombo=function(){return this.maxCombo},i.getAccuracyStats=function(){return zt({},this.accuracyStats)},i.getAccuracyPercentage=function(){return 0===this.accuracyStats.total?0:(1*this.accuracyStats.perfect+.5*this.accuracyStats.good+0*this.accuracyStats.miss)/this.accuracyStats.total*100},i.getGrade=function(){var t=this.getAccuracyPercentage();return t>=95?"S":t>=90?"A":t>=80?"B":t>=70?"C":t>=60?"D":"F"},i.calculateExperiencePoints=function(){return Math.floor(this.totalScore/100)+Math.floor(this.getAccuracyPercentage()/10)+Math.floor(this.maxCombo/10)+2*this.patternsCompleted+10*this.finishMovesCompleted},i.getPatternStats=function(){return{completed:this.patternsCompleted,skipped:this.patternsSkipped,finishMoves:this.finishMovesCompleted}},e}(r)).prototype,"perfectScore",[zm],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 100}}),xg=It(Lg.prototype,"goodScore",[zm],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 50}}),Fg=It(Lg.prototype,"missScore",[zm],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Dg=It(Lg.prototype,"comboMultiplierIncrement",[zm],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.1}}),zg=It(Lg.prototype,"maxComboMultiplier",[zm],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 3}}),kg=It(Lg.prototype,"comboBreakPenalty",[zm],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Vg=It(Lg.prototype,"patternComplexityMultiplier",[zm],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.2}}),Bg=It(Lg.prototype,"consecutivePatternBonus",[zm],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 50}}),Hg=It(Lg.prototype,"finishMoveMultiplier",[zm],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 2}}),Ug=It(Lg.prototype,"patternSkipPenalty",[zm],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 100}}),Gg=It(Lg.prototype,"audioManager",[Ng],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Og=Lg))||Og);t._RF.pop(),t._RF.push({},"04144GbENxMebPIzsW6q1M6","AuditionUIManager",void 0);var Vm,Bm,Hm,Um,Gm,Wm,qm,Zm,Ym,jm,Km,Xm,Jm,Qm,$m,tv,ev,iv,nv,ov,rv,av,sv,lv,cv,uv=e.ccclass,hv=e.property,pv=function(t){return t[t.MAIN_MENU=0]="MAIN_MENU",t[t.SONG_SELECTION=1]="SONG_SELECTION",t[t.GAMEPLAY=2]="GAMEPLAY",t[t.RESULTS=3]="RESULTS",t[t.SETTINGS=4]="SETTINGS",t}(pv||{}),dv=function(t){return t[t.PERFECT=0]="PERFECT",t[t.GREAT=1]="GREAT",t[t.COOL=2]="COOL",t[t.MISS=3]="MISS",t}({}),fv=(Yg=uv("AuditionUIManager"),jg=hv({type:Jd,group:{name:"Audio Manager",id:"audioManager"}}),Kg=hv({type:c,group:{name:"UI Screens",id:"screens"}}),Xg=hv({type:c,group:{name:"UI Screens",id:"screens"}}),Jg=hv({type:c,group:{name:"UI Screens",id:"screens"}}),Qg=hv({type:c,group:{name:"UI Screens",id:"screens"}}),$g=hv({type:c,group:{name:"UI Screens",id:"screens"}}),tm=hv({type:y,group:{name:"Gameplay UI",id:"gameplay"}}),em=hv({type:y,group:{name:"Gameplay UI",id:"gameplay"}}),im=hv({type:f,group:{name:"Gameplay UI",id:"gameplay"}}),nm=hv({type:it,group:{name:"Gameplay UI",id:"gameplay"}}),om=hv({type:y,group:{name:"Results UI",id:"results"}}),rm=hv({type:y,group:{name:"Results UI",id:"results"}}),am=hv({type:y,group:{name:"Results UI",id:"results"}}),sm=hv({type:y,group:{name:"Results UI",id:"results"}}),lm=hv({type:y,group:{name:"Song Info",id:"songInfo"}}),cm=hv({type:y,group:{name:"Song Info",id:"songInfo"}}),um=hv({type:y,group:{name:"Song Info",id:"songInfo"}}),hm=hv({type:[c],tooltip:"Feedback animation nodes in order: perfect, good, cool, miss"}),pm=hv(ct),dm=hv({type:it,group:{name:"Feedback",id:"feedback"}}),Yg((mm=It((gm=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,Ot(e,"audioManager",mm,Lt(e)),Ot(e,"mainMenuScreen",vm,Lt(e)),Ot(e,"songSelectionScreen",ym,Lt(e)),Ot(e,"gameplayScreen",bm,Lt(e)),Ot(e,"resultsScreen",_m,Lt(e)),Ot(e,"settingsScreen",Sm,Lt(e)),Ot(e,"scoreLabel",wm,Lt(e)),Ot(e,"comboCountLabel",Tm,Lt(e)),Ot(e,"progressBar",Cm,Lt(e)),Ot(e,"readyGoAnimation",Em,Lt(e)),Ot(e,"finalScoreLabel",Am,Lt(e)),Ot(e,"accuracyLabel",Pm,Lt(e)),Ot(e,"maxComboLabel",Mm,Lt(e)),Ot(e,"gradeLabel",Im,Lt(e)),Ot(e,"songNameLabel",Nm,Lt(e)),Ot(e,"artistNameLabel",Om,Lt(e)),Ot(e,"bpmLabel",Lm,Lt(e)),Ot(e,"feedbackNodes",Rm,Lt(e)),Ot(e,"particleSystemPerfectFragments",xm,Lt(e)),Ot(e,"animScoreFeedBacks",Fm,Lt(e)),e.currentUIState=pv.MAIN_MENU,e.feedbackTween=null,e.comboTween=null,e.feedbackAnimNames=["perfect","great","cool","miss"],e}Nt(e,t);var i=e.prototype;return i.showMainMenu=function(){this.hideAllScreens(),this.mainMenuScreen&&(this.mainMenuScreen.active=!0,this.currentUIState=pv.MAIN_MENU),console.log("Showing main menu")},i.showSongSelection=function(){this.hideAllScreens(),this.songSelectionScreen&&(this.songSelectionScreen.active=!0,this.currentUIState=pv.SONG_SELECTION),console.log("Showing song selection")},i.showGameplay=function(t){this.hideAllScreens(),this.gameplayScreen&&(this.gameplayScreen.active=!0,this.currentUIState=pv.GAMEPLAY),console.log("Showing gameplay"),this.songNameLabel&&(this.songNameLabel.string=t.title),this.artistNameLabel&&(this.artistNameLabel.string=t.artist),this.bpmLabel&&(this.bpmLabel.string=t.bpm.toString()+" BPM")},i.showResults=function(){this.hideAllScreens(),this.resultsScreen&&(this.resultsScreen.active=!0,this.currentUIState=pv.RESULTS),console.log("Showing results")},i.showSettings=function(){this.hideAllScreens(),this.settingsScreen&&(this.settingsScreen.active=!0,this.currentUIState=pv.SETTINGS),console.log("Showing settings")},i.hideAllScreens=function(){this.mainMenuScreen&&(this.mainMenuScreen.active=!1),this.songSelectionScreen&&(this.songSelectionScreen.active=!1),this.gameplayScreen&&(this.gameplayScreen.active=!1),this.resultsScreen&&(this.resultsScreen.active=!1),this.settingsScreen&&(this.settingsScreen.active=!1)},i.updateScore=function(t){this.scoreLabel&&(this.scoreLabel.string=this.formatNumberWithZeros(t,8))},i.updateCombo=function(t){this.comboCountLabel&&(this.comboCountLabel.string="x"+t.toString(),this.comboCountLabel.node.active=t>1)},i.updateProgress=function(t){this.progressBar&&(this.progressBar.fillRange=Math.max(0,Math.min(1,t)))},i.playReadyGoAnimation=function(){var t=this;this.readyGoAnimation.node.active=!0,this.readyGoAnimation.play(),this.audioManager.playSound("s_ready"),this.scheduleOnce((function(){t.audioManager.playSound("s_go")}),1)},i.updateResults=function(t,e,i,n){this.finalScoreLabel&&(this.finalScoreLabel.string=this.formatNumberWithZeros(t,8)),this.accuracyLabel&&(this.accuracyLabel.string=e.toFixed(2)+"%"),this.maxComboLabel&&(this.maxComboLabel.string=""+i),this.gradeLabel&&(this.gradeLabel.string=n,this.setGradeColor(n))},i.setGradeColor=function(t){switch(t){case"S":this.gradeLabel.color=new X(255,215,0,255);break;case"A":this.gradeLabel.color=new X(0,191,255,255);break;case"B":this.gradeLabel.color=new X(50,205,50,255);break;case"C":this.gradeLabel.color=new X(255,165,0,255);break;case"D":this.gradeLabel.color=new X(255,69,0,255);break;case"F":this.gradeLabel.color=new X(128,128,128,255)}},i.formatNumberWithZeros=function(t,e){for(var i=t.toString();i.length<e;)i="0"+i;return i},i.getCurrentUIState=function(){return this.currentUIState},i.showFeedback=function(t){for(var e,i=Dt(this.feedbackNodes);!(e=i()).done;){e.value.active=!1}this.feedbackNodes[t]&&(this.feedbackNodes[t].active=!0);var n=this.feedbackAnimNames[t];this.animScoreFeedBacks.play(n)},Ft(e,[{key:"perfectAnimNode",get:function(){return this.feedbackNodes[0]}},{key:"goodNode",get:function(){return this.feedbackNodes[1]}},{key:"coolNode",get:function(){return this.feedbackNodes[2]}},{key:"missNode",get:function(){return this.feedbackNodes[3]}}]),e}(r)).prototype,"audioManager",[jg],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),vm=It(gm.prototype,"mainMenuScreen",[Kg],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ym=It(gm.prototype,"songSelectionScreen",[Xg],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),bm=It(gm.prototype,"gameplayScreen",[Jg],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_m=It(gm.prototype,"resultsScreen",[Qg],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Sm=It(gm.prototype,"settingsScreen",[$g],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),wm=It(gm.prototype,"scoreLabel",[tm],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Tm=It(gm.prototype,"comboCountLabel",[em],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Cm=It(gm.prototype,"progressBar",[im],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Em=It(gm.prototype,"readyGoAnimation",[nm],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Am=It(gm.prototype,"finalScoreLabel",[om],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Pm=It(gm.prototype,"accuracyLabel",[rm],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Mm=It(gm.prototype,"maxComboLabel",[am],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Im=It(gm.prototype,"gradeLabel",[sm],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Nm=It(gm.prototype,"songNameLabel",[lm],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Om=It(gm.prototype,"artistNameLabel",[cm],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Lm=It(gm.prototype,"bpmLabel",[um],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Rm=It(gm.prototype,"feedbackNodes",[hm],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),xm=It(gm.prototype,"particleSystemPerfectFragments",[pm],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Fm=It(gm.prototype,"animScoreFeedBacks",[dm],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),fm=gm))||fm);t._RF.pop(),t._RF.push({},"88430rgcWxFCqXyHcVl7nDY","AuditionGameplayController",void 0);var gv,mv,vv,yv,bv,_v,Sv,wv,Tv,Cv,Ev,Av,Pv,Mv,Iv,Nv,Ov,Lv,Rv,xv,Fv,Dv,zv,kv,Vv,Bv,Hv,Uv,Gv,Wv,qv,Zv,Yv,jv,Kv,Xv,Jv,Qv,$v,ty,ey,iy,ny,oy=function(t){return t[t.INIT=0]="INIT",t[t.PLAYING=1]="PLAYING",t[t.PAUSED=2]="PAUSED",t[t.GAME_OVER=3]="GAME_OVER",t}(oy||{}),ry=e.ccclass,ay=e.property;Vm=ry("AuditionGameplayController"),Bm=ay(pg),Hm=ay(km),Um=ay(Zg),Gm=ay(x),Wm=ay(c),qm=ay(x),Zm=ay(x),Ym=ay(x),jm=ay(ut),Km=ay(Jd),Xm=ay(fv),Vm(($m=It((Qm=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,Ot(e,"beatSystem",$m,Lt(e)),Ot(e,"scoringSystem",tv,Lt(e)),Ot(e,"characterAnimation",ev,Lt(e)),Ot(e,"pauseButton",iv,Lt(e)),Ot(e,"pauseMenu",nv,Lt(e)),Ot(e,"resumeButton",ov,Lt(e)),Ot(e,"restartButton",rv,Lt(e)),Ot(e,"quitButton",av,Lt(e)),Ot(e,"songProgressBar",sv,Lt(e)),Ot(e,"audioManager",lv,Lt(e)),Ot(e,"uimanager",cv,Lt(e)),e.gameState=oy.INIT,e.songStartTime=0,e.songDuration=0,e.notesProcessed=0,e.currentSong=null,e.availableSongs=[{id:"DauCoLoiLam_ATVNCG_Full",title:"Đâu Có Lỗi Lầm",artist:"ATVNCG",difficulty:1,bpm:128,musicPath:"DauCoLoiLam_ATVNCG_Full",previewStart:35e3,previewEnd:5e4},{id:"TrongCom_ATVNCG",title:"Trống Cơm",artist:"ATVNCG",difficulty:2,bpm:86,musicPath:"TrongCom_ATVNCG",previewStart:35e3,previewEnd:5e4}],e}Nt(e,t);var i=e.prototype;return i.getAvailableSongs=function(){return this.availableSongs},i.getUnlockedSongs=function(){return this.availableSongs},i.getHighScore=function(t){return 0},i.isSongUnlocked=function(t){return!0},i.start=function(){if(this.setupButtonEvents(),this.scoringSystem&&(this.scoringSystem.reset(),this.scoringSystem.onScoreUpdate(this.updateScoreDisplay.bind(this)),this.scoringSystem.onComboUpdate(this.updateComboDisplay.bind(this)),this.beatSystem.setScoreCallback(this.onScoringProcessed.bind(this))),this.characterAnimation&&this.characterAnimation.resetToIdle(),this.availableSongs&&this.availableSongs.length>0){var t=Math.floor(Math.random()*this.availableSongs.length),e=this.availableSongs[t];this.startSong(e.id),console.log("Starting random song: "+e.id)}else console.error("No available songs found")},i.startSong=function(t){this.gameState=oy.INIT,console.log("Starting song: "+t);var e=this.availableSongs.find((function(e){return e.id===t}));e?(this.currentSong=e,this.initGameplay(),this.uimanager.showGameplay(this.currentSong)):console.error("Song with id "+t+" not found")},i.initGameplay=function(){var t=this;this.audioManager&&this.beatSystem?this.currentSong?Promise.all([this.audioManager.loadSong(ed.getMusicPath(this.currentSong)),this.characterAnimation.loadDanceData(this.currentSong.id)]).then((function(e){e[0],e[1];return console.log("Song and dance data loaded successfully"),t.songDuration=t.audioManager.getDuration(),t.characterAnimation.setMusicSpeed(t.currentSong.bpm),t.startGameplay(),t.songDuration})).catch((function(t){throw console.error("Failed to load song or dance data:",t),t})):console.error("No song selected"):console.error("Required components not found")},i.startGameplay=function(){var t=this;this.beatSystem.setReadyCallback((function(){t.uimanager.playReadyGoAnimation()})),this.songStartTime=Date.now(),this.audioManager.playSong(),this.beatSystem.startBeatSystem(this.currentSong.bpm,this.songDuration),this.gameState=oy.PLAYING,console.log("Gameplay started")},i.setupButtonEvents=function(){this.pauseButton&&this.pauseButton.node.on(x.EventType.CLICK,this.onPauseButtonClicked,this),this.resumeButton&&this.resumeButton.node.on(x.EventType.CLICK,this.onResumeButtonClicked,this),this.restartButton&&this.restartButton.node.on(x.EventType.CLICK,this.onRestartButtonClicked,this),this.quitButton&&this.quitButton.node.on(x.EventType.CLICK,this.onQuitButtonClicked,this),this.pauseMenu&&(this.pauseMenu.active=!1)},i.update=function(t){this.gameState===oy.PLAYING&&(this.updateProgressBar(),this.audioManager&&this.audioManager.getCurrentTime()>=this.songDuration&&this.songStartTime>0&&this.endGameplay())},i.updateProgressBar=function(){if(this.songProgressBar&&!(this.songDuration<=0)&&this.audioManager){var t=this.audioManager.getCurrentTime(),e=.9*Math.min(1,t/this.songDuration);this.songProgressBar.progress=e+.1,this.uimanager.updateProgress(e)}},i.onScoringProcessed=function(t,e){var i;switch(this.notesProcessed++,this.scoringSystem.processNoteResult(t,e),this.characterAnimation.reactToInput(t,this.scoringSystem.getCombo()),t){case ug.PERFECT:i=dv.PERFECT;break;case ug.GOOD:i=dv.GREAT;break;case ug.MISS:i=dv.MISS;break;default:i=dv.MISS}this.uimanager.showFeedback(i)},i.updateScoreDisplay=function(t){this.uimanager.updateScore(t)},i.updateComboDisplay=function(t){this.uimanager.updateCombo(t)},i.endGameplay=function(){if(this.gameState=oy.GAME_OVER,this.audioManager){this.audioManager.stopSong(),this.beatSystem.stopBeatSystem();var t=this.scoringSystem.getScore(),e=this.scoringSystem.getMaxCombo(),i=this.scoringSystem.getAccuracyPercentage(),n=this.scoringSystem.getGrade();this.uimanager.showResults(),this.uimanager.updateResults(t,i,e,n),console.log("Gameplay ended. Score: "+t+", Accuracy: "+i.toFixed(2)+"%, Max Combo: "+e+", Grade: "+n)}},i.onPauseButtonClicked=function(){this.pauseGame()},i.onResumeButtonClicked=function(){this.resumeGame()},i.onRestartButtonClicked=function(){this.pauseMenu&&(this.pauseMenu.active=!1),this.audioManager&&(this.audioManager.stopSong(),this.beatSystem.stopBeatSystem(),this.gameState=oy.INIT,M.loadScene(M.getScene().name))},i.onQuitButtonClicked=function(){this.audioManager&&(this.audioManager.stopSong(),this.beatSystem.stopBeatSystem(),this.gameState=oy.INIT)},i.pauseGame=function(){this.gameState===oy.PLAYING&&(this.gameState=oy.PAUSED,this.audioManager&&(this.audioManager.pauseSong(),this.pauseMenu&&(this.pauseMenu.active=!0)))},i.resumeGame=function(){this.gameState===oy.PAUSED&&(this.gameState=oy.PLAYING,this.audioManager&&(this.audioManager.resumeSong(),this.pauseMenu&&(this.pauseMenu.active=!1)))},e}(r)).prototype,"beatSystem",[Bm],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),tv=It(Qm.prototype,"scoringSystem",[Hm],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ev=It(Qm.prototype,"characterAnimation",[Um],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),iv=It(Qm.prototype,"pauseButton",[Gm],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),nv=It(Qm.prototype,"pauseMenu",[Wm],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ov=It(Qm.prototype,"resumeButton",[qm],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),rv=It(Qm.prototype,"restartButton",[Zm],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),av=It(Qm.prototype,"quitButton",[Ym],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),sv=It(Qm.prototype,"songProgressBar",[jm],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),lv=It(Qm.prototype,"audioManager",[Km],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),cv=It(Qm.prototype,"uimanager",[Xm],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Jm=Qm));t._RF.pop(),t._RF.push({},"13564WRJ8BHHoVT5R2hp2xb","AuditionGameplayUI",void 0);var sy,ly,cy,uy,hy,py,dy,fy,gy,my,vy,yy,by,_y,Sy,wy,Ty,Cy,Ey,Ay,Py=e.ccclass,My=e.property;gv=Py("AuditionGameplayUI"),mv=My(y),vv=My(y),yv=My(y),bv=My(c),_v=My(y),Sv=My(c),wv=My([c]),Tv=My(c),Cv=My(c),Ev=My(c),Av=My(y),Pv=My(c),Mv=My(c),Iv=My(c),Nv=My(X),Ov=My(X),Lv=My(X),Rv=My(X),xv=My(X),Fv=My(X),gv((kv=It((zv=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,Ot(e,"scoreLabel",kv,Lt(e)),Ot(e,"comboLabel",Vv,Lt(e)),Ot(e,"multiplierLabel",Bv,Lt(e)),Ot(e,"accuracyFeedbackNode",Hv,Lt(e)),Ot(e,"accuracyLabel",Uv,Lt(e)),Ot(e,"patternDisplay",Gv,Lt(e)),Ot(e,"patternDots",Wv,Lt(e)),Ot(e,"patternProgressBar",qv,Lt(e)),Ot(e,"syncPointIndicator",Zv,Lt(e)),Ot(e,"finishMoveIndicator",Yv,Lt(e)),Ot(e,"finishMoveLabel",jv,Lt(e)),Ot(e,"leftButton",Kv,Lt(e)),Ot(e,"rightButton",Xv,Lt(e)),Ot(e,"spaceButton",Jv,Lt(e)),Ot(e,"leftButtonColor",Qv,Lt(e)),Ot(e,"rightButtonColor",$v,Lt(e)),Ot(e,"spaceButtonColor",ty,Lt(e)),Ot(e,"perfectColor",ey,Lt(e)),Ot(e,"goodColor",iy,Lt(e)),Ot(e,"missColor",ny,Lt(e)),e.currentSequence=[],e.currentProgress=0,e.activeFeedbackAnimation=null,e}Nt(e,t);var i=e.prototype;return i.onLoad=function(){this.resetUI()},i.resetUI=function(){this.updateScore(0),this.updateCombo(0),this.updateMultiplier(1),this.accuracyFeedbackNode&&(this.accuracyFeedbackNode.active=!1),this.clearPatternDisplay(),this.finishMoveIndicator&&(this.finishMoveIndicator.active=!1),this.resetButtons()},i.updateScore=function(t){this.scoreLabel&&(this.scoreLabel.string=t.toString())},i.updateCombo=function(t){this.comboLabel&&(t>0?(this.comboLabel.node.active=!0,this.comboLabel.string="Combo: "+t,this.pulseNode(this.comboLabel.node)):this.comboLabel.node.active=!1)},i.updateMultiplier=function(t){this.multiplierLabel&&(this.multiplierLabel.string="x"+t.toFixed(1),this.multiplierLabel.color=t>2?this.perfectColor:t>1.5?this.goodColor:X.WHITE)},i.showAccuracyFeedback=function(t){var e=this;if(this.accuracyFeedbackNode&&this.accuracyLabel){var i,n;switch(this.activeFeedbackAnimation&&this.activeFeedbackAnimation.stop(),t){case ug.PERFECT:i="PERFECT",n=this.perfectColor;break;case ug.GOOD:i="GOOD",n=this.goodColor;break;case ug.MISS:i="MISS",n=this.missColor}this.accuracyLabel.string=i,this.accuracyLabel.color=n,this.accuracyFeedbackNode.active=!0;var o=this.accuracyFeedbackNode.scale.clone();this.accuracyFeedbackNode.setScale(0,0,1);var r=this.accuracyFeedbackNode.getComponent(b)||this.accuracyFeedbackNode.addComponent(b);r.opacity=255,this.activeFeedbackAnimation=v(this.accuracyFeedbackNode).to(.2,{scale:new g(1.2,1.2,1)}).to(.1,{scale:o}).delay(.5).to(.3,{scale:new g(.8,.8,1)}).parallel(v(r).to(.3,{opacity:0})).call((function(){e.accuracyFeedbackNode.active=!1,e.accuracyFeedbackNode.setScale(o)})).start()}},i.updatePatternDisplay=function(t){var e=this;if(this.patternDisplay){if(this.patternDisplay.active=!0,this.currentSequence=t,this.currentProgress=0,this.patternDots.forEach((function(i,n){var o=i.getComponent(f);n<t.length?(o.color=e.getColorForInput(t[n]),i.active=!0):i.active=!1})),this.syncPointIndicator&&(this.syncPointIndicator.active=!0,t.length>0&&t.length<=this.patternDots.length)){var i=this.patternDots[t.length-1].position;this.syncPointIndicator.setPosition(i.x+60,i.y,i.z)}this.updatePatternProgress(0,t.length)}},i.updatePatternProgress=function(t,e){if(this.patternProgressBar){this.currentProgress=t;var i=e>0?t/e:0,n=this.patternProgressBar.getComponent(f);n&&(n.fillRange=i);for(var o=0;o<this.patternDots.length;o++)if(o<this.currentSequence.length){var r=this.patternDots[o].getComponent(f);r.color=o<t?this.perfectColor:this.getColorForInput(this.currentSequence[o])}if(t===e&&this.syncPointIndicator){var a=this.syncPointIndicator.getComponent(f);a&&(a.color=this.perfectColor,this.pulseNode(this.syncPointIndicator))}}},i.clearPatternDisplay=function(){this.currentSequence=[],this.currentProgress=0,this.patternDisplay&&(this.patternDisplay.active=!1),this.syncPointIndicator&&(this.syncPointIndicator.active=!1),this.patternDots.forEach((function(t){t.active=!1}))},i.showButtonPress=function(t,e){var i=null;switch(t){case uf.LEFT:i=this.leftButton;break;case uf.RIGHT:i=this.rightButton;break;case uf.SPACE:i=this.spaceButton}if(i){var n=i.getComponent(f);if(n){var o=n.color.clone();n.color=e?this.perfectColor:this.missColor;var r=i.scale.clone();v(i).to(.05,{scale:new g(.9*r.x,.9*r.y,r.z)}).to(.1,{scale:r}).call((function(){n.color=o})).start()}}},i.resetButtons=function(){if(this.leftButton){this.leftButton.setScale(1,1,1);var t=this.leftButton.getComponent(f);t&&(t.color=this.leftButtonColor)}if(this.rightButton){this.rightButton.setScale(1,1,1);var e=this.rightButton.getComponent(f);e&&(e.color=this.rightButtonColor)}if(this.spaceButton){this.spaceButton.setScale(1,1,1);var i=this.spaceButton.getComponent(f);i&&(i.color=this.spaceButtonColor)}},i.showFinishMoveEffect=function(){var t=this;if(this.finishMoveIndicator&&this.finishMoveLabel){this.finishMoveIndicator.active=!0,this.finishMoveLabel.string="FINISH MOVE!";var e=this.finishMoveIndicator.getComponent(it);e?e.play("finish_move_flash"):(this.pulseNode(this.finishMoveIndicator,1.5,.5),setTimeout((function(){t.finishMoveIndicator.active=!1}),3e3))}},i.getColorForInput=function(t){switch(t){case uf.LEFT:return this.leftButtonColor;case uf.RIGHT:return this.rightButtonColor;case uf.SPACE:return this.spaceButtonColor;default:return X.WHITE}},i.pulseNode=function(t,e,i){if(void 0===e&&(e=1.2),void 0===i&&(i=.3),t){var n=t.scale.clone();v(t).to(i/2,{scale:new g(n.x*e,n.y*e,n.z)}).to(i/2,{scale:n}).start()}},i.showPatternSkipEffect=function(){var t=this;if(this.patternDisplay){var e=this.patternDisplay.getComponent(b)||this.patternDisplay.addComponent(b);e.opacity=255;var i=this.patternDisplay.position.clone();v(this.patternDisplay).to(.1,{position:new g(i.x+20,i.y,i.z)}).to(.1,{position:new g(i.x-200,i.y,i.z)}).parallel(v(e).to(.2,{opacity:0})).call((function(){t.patternDisplay.setPosition(i),t.patternDisplay.active=!1})).start()}},i.showPatternCompleteEffect=function(t){var e=this;if(void 0===t&&(t=!1),this.patternDisplay){t&&this.showFinishMoveEffect();var i=this.patternDisplay.getComponent(b)||this.patternDisplay.addComponent(b);i.opacity=255,v(i).to(.5,{opacity:0}).call((function(){e.patternDisplay.active=!1})).start()}},e}(r)).prototype,"scoreLabel",[mv],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Vv=It(zv.prototype,"comboLabel",[vv],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Bv=It(zv.prototype,"multiplierLabel",[yv],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Hv=It(zv.prototype,"accuracyFeedbackNode",[bv],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Uv=It(zv.prototype,"accuracyLabel",[_v],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Gv=It(zv.prototype,"patternDisplay",[Sv],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Wv=It(zv.prototype,"patternDots",[wv],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),qv=It(zv.prototype,"patternProgressBar",[Tv],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Zv=It(zv.prototype,"syncPointIndicator",[Cv],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Yv=It(zv.prototype,"finishMoveIndicator",[Ev],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),jv=It(zv.prototype,"finishMoveLabel",[Av],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Kv=It(zv.prototype,"leftButton",[Pv],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Xv=It(zv.prototype,"rightButton",[Mv],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Jv=It(zv.prototype,"spaceButton",[Iv],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Qv=It(zv.prototype,"leftButtonColor",[Nv],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new X(79,195,247)}}),$v=It(zv.prototype,"rightButtonColor",[Ov],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new X(255,112,67)}}),ty=It(zv.prototype,"spaceButtonColor",[Lv],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new X(255,235,59)}}),ey=It(zv.prototype,"perfectColor",[Rv],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new X(120,255,120)}}),iy=It(zv.prototype,"goodColor",[xv],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new X(255,193,7)}}),ny=It(zv.prototype,"missColor",[Fv],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new X(211,47,47)}}),Dv=zv));t._RF.pop(),t._RF.push({},"89cd9G0+vdPI7ElDHJDudjd","AuditionMainMenuController",void 0);var Iy,Ny,Oy,Ly,Ry,xy=e.ccclass,Fy=e.property;sy=xy("AuditionMainMenuController"),ly=Fy(x),cy=Fy(x),uy=Fy(x),hy=Fy(x),py=Fy(c),dy=Fy(y),fy=Fy(y),sy((vy=It((my=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,Ot(e,"playButton",vy,Lt(e)),Ot(e,"customizeButton",yy,Lt(e)),Ot(e,"optionsButton",by,Lt(e)),Ot(e,"exitButton",_y,Lt(e)),Ot(e,"logoNode",Sy,Lt(e)),Ot(e,"playerLevelLabel",wy,Lt(e)),Ot(e,"versionLabel",Ty,Lt(e)),Ot(e,"backgroundMusicPath",Cy,Lt(e)),Ot(e,"buttonSound",Ey,Lt(e)),Ot(e,"animateElements",Ay,Lt(e)),e}Nt(e,t);var i=e.prototype;return i.onLoad=function(){this.setupButtonEvents(),this.animateElements&&this.initializeAnimations(),this.versionLabel&&(this.versionLabel.string="v0.1.0 Alpha")},i.start=function(){this.playBackgroundMusic()},i.setupButtonEvents=function(){this.playButton&&this.playButton.node.on(x.EventType.CLICK,this.onPlayButtonClicked,this),this.customizeButton&&this.customizeButton.node.on(x.EventType.CLICK,this.onCustomizeButtonClicked,this),this.optionsButton&&this.optionsButton.node.on(x.EventType.CLICK,this.onOptionsButtonClicked,this),this.exitButton&&this.exitButton.node.on(x.EventType.CLICK,this.onExitButtonClicked,this)},i.initializeAnimations=function(){this.logoNode&&(this.logoNode.scale=new g(1.2,1.2,1),v(this.logoNode).to(2,{scale:new g(1.1,1.1,1)}).to(2,{scale:new g(1.2,1.2,1)}).union().repeatForever().start()),[this.playButton,this.customizeButton,this.optionsButton,this.exitButton].forEach((function(t,e){if(t){var i=t.node.scale.clone();t.node.on(c.EventType.MOUSE_ENTER,(function(){v(t.node).to(.2,{scale:new g(1.1*i.x,1.1*i.y,1)}).start()})),t.node.on(c.EventType.MOUSE_LEAVE,(function(){v(t.node).to(.2,{scale:i}).start()})),t.node.setPosition(t.node.position.x,t.node.position.y-50);var n=t.node.getComponent(b);n||(n=t.node.addComponent(b)),n.opacity=0,v(t.node).delay(.2+.1*e).to(.5,{position:new g(t.node.position.x,t.node.position.y+50,0)},{easing:"backOut"}).start(),v(n).delay(.2+.1*e).to(.5,{opacity:255}).start()}}))},i.playBackgroundMusic=function(){},i.onPlayButtonClicked=function(){},i.onCustomizeButtonClicked=function(){console.log("Customize button clicked - Feature coming soon")},i.onOptionsButtonClicked=function(){console.log("Options button clicked - Feature coming soon")},i.onExitButtonClicked=function(){console.log("Exit button clicked")},i.onDestroy=function(){},e}(r)).prototype,"playButton",[ly],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),yy=It(my.prototype,"customizeButton",[cy],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),by=It(my.prototype,"optionsButton",[uy],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_y=It(my.prototype,"exitButton",[hy],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Sy=It(my.prototype,"logoNode",[py],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),wy=It(my.prototype,"playerLevelLabel",[dy],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ty=It(my.prototype,"versionLabel",[fy],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Cy=It(my.prototype,"backgroundMusicPath",[Fy],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"audition/audio/menu_music"}}),Ey=It(my.prototype,"buttonSound",[Fy],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"click"}}),Ay=It(my.prototype,"animateElements",[Fy],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),gy=my));t._RF.pop(),t._RF.push({},"9c847FTTeVHTLgt1NPmkCyR","AuditionRandomBackground",void 0);var Dy,zy,ky,Vy,By,Hy,Uy,Gy,Wy,qy,Zy,Yy,jy,Ky,Xy,Jy,Qy,$y,tb=e.ccclass,eb=e.property;Iy=tb("AuditionRandomBackground"),Ny=eb([i]),Iy((Ry=It((Ly=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,Ot(e,"backgroundFrames",Ry,Lt(e)),e.meshRenderer=null,e}Nt(e,t);var i=e.prototype;return i.onLoad=function(){if(this.meshRenderer=this.getComponent(ht),this.meshRenderer){if(this.backgroundFrames.length>0){var t=o(0,this.backgroundFrames.length),e=this.backgroundFrames[t];this.meshRenderer.material&&this.meshRenderer.material.setProperty("mainTexture",e.texture)}}else console.error("MeshRenderer component not found on AuditionRandomBackground")},i.update=function(t){},e}(r)).prototype,"backgroundFrames",[Ny],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Oy=Ly));t._RF.pop(),t._RF.push({},"2c315k/8UpN5rJQH/P/zdLe","AuditionResultsController",void 0);var ib,nb,ob,rb,ab,sb,lb,cb,ub,hb,pb,db,fb,gb,mb,vb,yb,bb=e.ccclass,_b=e.property;Dy=bb("AuditionResultsController"),zy=_b(x),ky=_b(x),Vy=_b(x),By=_b(c),Hy=_b(c),Uy=_b(y),Dy((qy=It((Wy=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,Ot(e,"retryButton",qy,Lt(e)),Ot(e,"nextButton",Zy,Lt(e)),Ot(e,"mainMenuButton",Yy,Lt(e)),Ot(e,"resultsContent",jy,Lt(e)),Ot(e,"expGainDisplay",Ky,Lt(e)),Ot(e,"expGainLabel",Xy,Lt(e)),Ot(e,"backgroundMusicPath",Jy,Lt(e)),Ot(e,"buttonClickSound",Qy,Lt(e)),Ot(e,"resultsSound",$y,Lt(e)),e.isAnimatingResults=!1,e}Nt(e,t);var i=e.prototype;return i.onLoad=function(){if(fv.instance.showResults(),this.setupButtonEvents(),this.resultsContent){this.resultsContent.scale=new g(.8,.8,1);var t=this.resultsContent.getComponent(b);t||(t=this.resultsContent.addComponent(b)),t.opacity=0}this.expGainDisplay&&(this.expGainDisplay.active=!1)},i.start=function(){var t=this;this.playBackgroundMusic(),this.scheduleOnce((function(){t.animateResults()}),.5)},i.setupButtonEvents=function(){this.retryButton&&(this.retryButton.node.on(x.EventType.CLICK,this.onRetryButtonClicked,this),this.retryButton.interactable=!1),this.nextButton&&(this.nextButton.node.on(x.EventType.CLICK,this.onNextButtonClicked,this),this.nextButton.interactable=!1),this.mainMenuButton&&(this.mainMenuButton.node.on(x.EventType.CLICK,this.onMainMenuButtonClicked,this),this.mainMenuButton.interactable=!1)},i.playBackgroundMusic=function(){},i.animateResults=function(){var t=this;if(this.resultsContent){this.isAnimatingResults=!0,this.resultsContent.active=!0,v(this.resultsContent).to(.5,{scale:new g(1,1,1)}).start();var e=this.resultsContent.getComponent(b)||this.resultsContent.addComponent(b);e&&v(e).to(.5,{opacity:255}).call((function(){t.scheduleOnce((function(){t.showExperienceGain()}),1)})).start()}},i.showExperienceGain=function(){var t=this;if(this.expGainDisplay&&this.expGainLabel){this.expGainLabel&&(this.expGainLabel.string="+100 EXP"),this.expGainDisplay.active=!0,this.expGainDisplay.scale=new g(.5,.5,1),v(this.expGainDisplay).to(.3,{scale:new g(1.2,1.2,1)}).to(.2,{scale:new g(1,1,1)}).call((function(){t.enableButtons(),t.isAnimatingResults=!1})).start()}},i.enableButtons=function(){this.retryButton&&(this.retryButton.interactable=!0),this.nextButton&&(this.nextButton.interactable=!0),this.mainMenuButton&&(this.mainMenuButton.interactable=!0)},i.onRetryButtonClicked=function(){},i.onNextButtonClicked=function(){},i.onMainMenuButtonClicked=function(){},i.onDestroy=function(){},e}(r)).prototype,"retryButton",[zy],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Zy=It(Wy.prototype,"nextButton",[ky],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Yy=It(Wy.prototype,"mainMenuButton",[Vy],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),jy=It(Wy.prototype,"resultsContent",[By],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ky=It(Wy.prototype,"expGainDisplay",[Hy],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Xy=It(Wy.prototype,"expGainLabel",[Uy],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Jy=It(Wy.prototype,"backgroundMusicPath",[_b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"audition/audio/results_music"}}),Qy=It(Wy.prototype,"buttonClickSound",[_b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"click"}}),$y=It(Wy.prototype,"resultsSound",[_b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"results"}}),Gy=Wy));t._RF.pop(),t._RF.push({},"6a29cIl249M9qUzgX5Tgjl0","AuditionSongItemComponent",void 0);var Sb,wb,Tb,Cb,Eb,Ab,Pb,Mb,Ib,Nb,Ob,Lb,Rb,xb,Fb,Db,zb,kb,Vb,Bb,Hb,Ub,Gb,Wb,qb,Zb,Yb,jb,Kb=e.ccclass,Xb=e.property;ib=Kb("AuditionSongItemComponent"),nb=Xb(y),ob=Xb(y),rb=Xb(y),ab=Xb(y),sb=Xb(f),lb=Xb(x),cb=Xb(c),ib((pb=It((hb=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,Ot(e,"titleLabel",pb,Lt(e)),Ot(e,"artistLabel",db,Lt(e)),Ot(e,"difficultyLabel",fb,Lt(e)),Ot(e,"highScoreLabel",gb,Lt(e)),Ot(e,"lockIcon",mb,Lt(e)),Ot(e,"selectButton",vb,Lt(e)),Ot(e,"selectedIndicator",yb,Lt(e)),e.songId="",e.unlocked=!1,e.onSelect=null,e}Nt(e,t);var i=e.prototype;return i.setup=function(t){if(this.songId=t.id,this.unlocked=t.unlocked,this.titleLabel&&(this.titleLabel.string=t.title),this.artistLabel&&(this.artistLabel.string=t.artist),this.difficultyLabel){for(var e="",i=0;i<t.difficulty;i++)e+="★";this.difficultyLabel.string=e}this.highScoreLabel&&(this.highScoreLabel.string=t.highScore>0?t.highScore.toString():"-"),this.lockIcon&&(this.lockIcon.node.active=!t.unlocked),this.selectButton&&(this.selectButton.interactable=t.unlocked,this.selectButton.node.on(x.EventType.CLICK,this.onButtonClicked,this)),this.selectedIndicator&&(this.selectedIndicator.active=!1)},i.onButtonClicked=function(){this.unlocked&&(this.onSelect&&this.onSelect(this.songId),this.selectedIndicator&&(this.selectedIndicator.active=!0))},i.setSelected=function(t){this.selectedIndicator&&(this.selectedIndicator.active=t)},e}(r)).prototype,"titleLabel",[nb],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),db=It(hb.prototype,"artistLabel",[ob],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),fb=It(hb.prototype,"difficultyLabel",[rb],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),gb=It(hb.prototype,"highScoreLabel",[ab],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),mb=It(hb.prototype,"lockIcon",[sb],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),vb=It(hb.prototype,"selectButton",[lb],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),yb=It(hb.prototype,"selectedIndicator",[cb],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ub=hb));t._RF.pop(),t._RF.push({},"1e799boHRpGq74bdTFaeFfD","AuditionSongSelectionController",void 0);var Jb,Qb=e.ccclass,$b=e.property;Sb=Qb("AuditionSongSelectionController"),wb=$b(x),Tb=$b(pt),Cb=$b(c),Eb=$b(l),Ab=$b(y),Pb=$b(y),Mb=$b(y),Ib=$b(y),Nb=$b(y),Ob=$b(x),Lb=$b(Jd),Sb((Fb=It((xb=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,Ot(e,"backButton",Fb,Lt(e)),Ot(e,"songListScrollView",Db,Lt(e)),Ot(e,"songListContent",zb,Lt(e)),Ot(e,"songItemPrefab",kb,Lt(e)),Ot(e,"songTitleLabel",Vb,Lt(e)),Ot(e,"artistLabel",Bb,Lt(e)),Ot(e,"difficultyLabel",Hb,Lt(e)),Ot(e,"bpmLabel",Ub,Lt(e)),Ot(e,"highScoreLabel",Gb,Lt(e)),Ot(e,"playButton",Wb,Lt(e)),Ot(e,"backgroundMusicPath",qb,Lt(e)),Ot(e,"previewVolume",Zb,Lt(e)),Ot(e,"buttonSound",Yb,Lt(e)),Ot(e,"audioManager",jb,Lt(e)),e.selectedSongId=null,e.previewTimer=null,e}Nt(e,t);var i=e.prototype;return i.onLoad=function(){this.setupButtonEvents(),this.playBackgroundMusic()},i.start=function(){this.populateSongList(),this.clearSongSelection()},i.setupButtonEvents=function(){this.backButton&&this.backButton.node.on(x.EventType.CLICK,this.onBackButtonClicked,this),this.playButton&&(this.playButton.node.on(x.EventType.CLICK,this.onPlayButtonClicked,this),this.playButton.interactable=!1)},i.playBackgroundMusic=function(){},i.populateSongList=function(){var t=this;this.songListContent&&this.songListContent.removeAllChildren();[].forEach((function(e){if(t.songItemPrefab){var i,n=E(t.songItemPrefab),o=null==(i=n.getChildByName("SongName"))?void 0:i.getComponent(y);o&&(o.string=e.title);var r=n.getChildByName("Difficulty");if(r)for(var a=r.children,s=0;s<a.length;s++)a[s].active=s<e.difficulty;t.songListContent.addChild(n)}}));var e=this.songListContent.getComponent($);e&&e.updateLayout()},i.onSongSelected=function(t){this.selectedSongId=t;var e={id:t,title:"Song Title",artist:"Artist Name",difficulty:1,bpm:120,audioPath:"audition/audio/song.mp3",previewStart:0,previewEnd:100};if(e){if(this.songTitleLabel&&(this.songTitleLabel.string=e.title),this.artistLabel&&(this.artistLabel.string=e.artist),this.difficultyLabel&&(this.difficultyLabel.string="Difficulty: "+e.difficulty),this.bpmLabel&&(this.bpmLabel.string="BPM: "+e.bpm),this.highScoreLabel){this.highScoreLabel.string="No records yet"}this.playButton&&(this.playButton.interactable=!0),this.playPreview(e)}},i.playPreview=function(t){var e=this;this.audioManager&&(this.stopPreview(),this.audioManager.loadSong(t.audioPath).then((function(){e.audioManager.setMusicVolume(e.previewVolume),e.audioManager.playSong(t.previewStart);var i=t.previewEnd-t.previewStart;e.previewTimer=setTimeout((function(){e.stopPreview(),e.playBackgroundMusic()}),i)})).catch((function(t){console.error("Failed to play song preview:",t)})))},i.stopPreview=function(){this.previewTimer&&(clearTimeout(this.previewTimer),this.previewTimer=null),this.audioManager&&this.audioManager.stopSong()},i.clearSongSelection=function(){this.selectedSongId=null,this.songTitleLabel&&(this.songTitleLabel.string="Select a Song"),this.artistLabel&&(this.artistLabel.string=""),this.difficultyLabel&&(this.difficultyLabel.string=""),this.bpmLabel&&(this.bpmLabel.string=""),this.highScoreLabel&&(this.highScoreLabel.string=""),this.playButton&&(this.playButton.interactable=!1)},i.onBackButtonClicked=function(){},i.onPlayButtonClicked=function(){this.selectedSongId},i.onDestroy=function(){},e}(r)).prototype,"backButton",[wb],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Db=It(xb.prototype,"songListScrollView",[Tb],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),zb=It(xb.prototype,"songListContent",[Cb],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),kb=It(xb.prototype,"songItemPrefab",[Eb],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Vb=It(xb.prototype,"songTitleLabel",[Ab],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Bb=It(xb.prototype,"artistLabel",[Pb],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Hb=It(xb.prototype,"difficultyLabel",[Mb],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ub=It(xb.prototype,"bpmLabel",[Ib],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Gb=It(xb.prototype,"highScoreLabel",[Nb],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Wb=It(xb.prototype,"playButton",[Ob],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),qb=It(xb.prototype,"backgroundMusicPath",[$b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"audition/audio/selection_music"}}),Zb=It(xb.prototype,"previewVolume",[$b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),Yb=It(xb.prototype,"buttonSound",[$b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"click"}}),jb=It(xb.prototype,"audioManager",[Lb],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Rb=xb));t._RF.pop(),t._RF.push({},"e50e6LGYARIrKzmtafJs/JO","Character",void 0);var t_,e_,i_,n_,o_,r_=e.ccclass;e.property,r_("Character")(Jb=function(t){function e(){return t.apply(this,arguments)||this}Nt(e,t);var i=e.prototype;return i.start=function(){},i.update=function(t){},e}(r));t._RF.pop(),t._RF.push({},"9470cSQRxtAIYqQT5Sm+ZX6","AnimationGraph",void 0);var a_,s_=e.ccclass,l_=e.property,c_=(t_=s_("AnimationGraph"),e_=l_(U),t_((o_=It((n_=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this)._graph=void 0,Ot(e,"isPose",o_,Lt(e)),e}Nt(e,t);var i=e.prototype;return i.start=function(){if(this._graph=this.getComponent(dt.AnimationController),void 0===this._graph||null===this._graph)throw new Error(this.node.name+" can not find AnimationController")},i.play=function(t,e){this.setValue(t,e)},i.setValue=function(t,e){var i;this.isPose?this._graph.setValue_experimental(t,e):null==(i=this._graph)||i.setValue(t,e)},i.setLayer=function(t,e){this._graph.setLayerWeight(t,e)},i.update=function(t){},e}(r)).prototype,"isPose",[e_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),i_=n_))||i_);t._RF.pop(),t._RF.push({},"61dcf57FUBJ8oXIVFbL/HTv","AnimationGraphGroup",void 0);var u_,h_=e.ccclass;e.property,h_("AnimationGraphGroup")(a_=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this)._groups=void 0,e.curActiveKey="",e}Nt(e,t);var i=e.prototype;return i.__preload=function(){if(this._groups=this.getComponentsInChildren(c_),void 0===this._groups||null===this._groups)throw new Error(this.node.name+" node not find AnimationGraph")},i.play=function(t,e){if(this.curActiveKey!==t){this.curActiveKey=t;try{for(var i=0;i<this._groups.length;i++)this._groups[i].play(t,e)}catch(t){ye.LOG&&console.log(t)}}},i.setLayer=function(t,e){for(var i=0;i<this._groups.length;i++)this._groups[i].setLayer(t,e)},e}(r));t._RF.pop(),t._RF.push({},"2d25eUq/olFcqr07UVxslCs","AnimatorController",void 0);var p_,d_=e.ccclass;e.property,d_("AnimatorController")(u_=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this)._anim=Object.create(null),e._data=Object.create(null),e}Nt(e,t);var i=e.prototype;return i.init=function(t){this._data=t,this._anim=this.getComponent(lt)},i.play=function(t){var e=this._data[t];this._anim.play(e[0])},e}(r));t._RF.pop(),t._RF.push({},"d570fjSILJE1p55LwtRI8Hp","ButtonBackToHome",void 0);var f_,g_,m_,v_=e.ccclass;e.property,v_("ButtonBackToHome")(p_=function(t){function e(){return t.apply(this,arguments)||this}return Nt(e,t),e.prototype.onTouch_Home=function(){M.loadScene(Lp)},e}(r));t._RF.pop(),t._RF.push({},"4a695abDKBOU7c/73mimyQe","EffectBase",void 0);var y_,b_,__,S_,w_,T_,C_=e.ccclass,E_=e.property,A_=C_("EffectBase")((m_=It((g_=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).define="",e.recycleMe=null,Ot(e,"sound",m_,Lt(e)),e}Nt(e,t);var i=e.prototype;return i.init=function(t,e,i){this.define=t,this.recycleMe=e,this.sound&&ji.instance.playSound(this.sound)},i.putToPool=function(){var t;null==this||null==(t=this.recycleMe)||t.call(this,this)},e}(r)).prototype,"sound",[E_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),f_=g_))||f_;t._RF.pop(),t._RF.push({},"f1faaHNgYdAgqUp6WWlyLaO","EffectController",void 0);var P_,M_,I_,N_,O_,L_,R_,x_,F_=e.ccclass,D_=e.property,z_=(y_=F_("EffectController"),b_=D_(c),y_(((T_=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).preloadPrefabNames=[],Ot(e,"uiEffectContainer",w_,Lt(e)),e.effectPoolMap=new Map,e}Nt(e,t);var i=e.prototype;return i.onLoad=function(){e.instance=this,this.initPool(),this.preloadEffects()},i.onDestroy=function(){e.instance=null},i.start=function(){this.initPool()},i.preloadEffects=function(){var t=this;this.preloadPrefabNames.forEach((function(e){0==t.effectPoolMap.has(e)&&$e.loadEffectRes(e).then((function(i){t.effectPoolMap.set(e,t.createPool(i,t.uiEffectContainer,A_))})).catch((function(t){ye.LOG&&console.error(t,e)}))}))},i.initPool=function(){},i.createPool=function(t,e,i,n){if(void 0===n&&(n=1),!t||!e)return null;var o=new ie((function(){var e=E(t).getComponent(i);return e||(console.warn("Component of the specified class not found in prefab."),null)}),e);return o.init(n),o},i.putEffects=function(t,e){var i;null==(i=this.effectPoolMap.get(e))||i.putAll(t)},i.spawnResourceEffectAt=function(t,e,i,n,o){var r=this;void 0===i&&(i=null),void 0===n&&(n=null),void 0===o&&(o=function(){});var a=function(){var a,s=null==(a=r.effectPoolMap)||null==(a=a.get(e))?void 0:a.get(),l=e;null!=i&&(s.node.parent=i),s.node.setWorldPosition(t),setTimeout((function(){s.init(l,(function(t){var e;null==(e=r.effectPoolMap)||null==(e=e.get(l))||e.put(t)}),n),null==o||o(s)}))};0==this.effectPoolMap.has(e)?$e.loadEffectRes(e).then((function(t){r.effectPoolMap.set(e,r.createPool(t,r.uiEffectContainer,A_)),a()})).catch((function(t){ye.LOG&&console.error(t,e),null==o||o(null,"could not find the effect prefab")})):a()},e}(r)).instance=null,w_=It((S_=T_).prototype,"uiEffectContainer",[b_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),__=S_))||__);t._RF.pop(),t._RF.push({},"b11edLPNrlIvrzI4yYh6uVF","EffectTime",void 0);var k_,V_,B_,H_,U_,G_,W_,q_=e.ccclass,Z_=e.property,Y_=(P_=q_("EffectTime"),M_=Z_(ft),I_=Z_([ct]),P_((L_=It((O_=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,Ot(e,"delayKillTime",L_,Lt(e)),Ot(e,"particleSystems",R_,Lt(e)),Ot(e,"particleSystem2ds",x_,Lt(e)),e}return Nt(e,t),e.prototype.init=function(e,i,n){var o,r,a=this;t.prototype.init.call(this,e,i,n),null==(o=this.particleSystems)||o.forEach((function(t){null==t||t.play()})),null==(r=this.particleSystem2ds)||r.forEach((function(t){t.resetSystem()})),this.scheduleOnce((function(){a.putToPool()}),this.delayKillTime)},e}(A_)).prototype,"delayKillTime",[Z_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),R_=It(O_.prototype,"particleSystems",[M_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),x_=It(O_.prototype,"particleSystem2ds",[I_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),N_=O_))||N_);t._RF.pop(),t._RF.push({},"8ca3fmen/FAube9ooAPgxCz","EffectAnimation",void 0);var j_,K_,X_,J_,Q_,$_,tS,eS,iS,nS=e.ccclass,oS=e.property;k_=nS("EffectAnimation"),V_=oS(it),k_((U_=It((H_=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,Ot(e,"animMain",U_,Lt(e)),Ot(e,"animName",G_,Lt(e)),Ot(e,"delay",W_,Lt(e)),e}Nt(e,t);var i=e.prototype;return i.onLoad=function(){this.animMain.node.active=!1},i.init=function(e,i,n){var o=this;t.prototype.init.call(this,e,i,n),this.scheduleOnce((function(){o.animMain.play(o.animName)}),this.delay)},e}(Y_)).prototype,"animMain",[V_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),G_=It(H_.prototype,"animName",[oS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),W_=It(H_.prototype,"delay",[oS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),B_=H_));t._RF.pop(),t._RF.push({},"4dd0e4qDG1PXZh+cEHXUaeh","EffectMovingObject",void 0);var rS,aS,sS,lS,cS,uS,hS=e.ccclass,pS=e.property,dS=(j_=hS("EffectMovingObject"),K_=pS(f),X_=pS(y),J_=pS(c),j_((tS=It(($_=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,Ot(e,"sprtMain",tS,Lt(e)),Ot(e,"lbMain",eS,Lt(e)),Ot(e,"nodeFollow",iS,Lt(e)),e.data=null,e.movingValue={value:0},e.tweenValue=null,e.startPoint=null,e.endPoint=null,e.controlPoint1=null,e.controlPoint2=null,e.scaleTime=.05,e.holdTime=.15,e.movingTime=.23,e.finalScale=.5,e}Nt(e,t);var i=e.prototype;return i.onDisable=function(){var t;null==(t=this.tweenValue)||t.stop()},i.init=function(e,i,n){var r,a,s=this;t.prototype.init.call(this,e,i,n),this.data=n,this.movingValue.value=0;var l=function(t,e){void 0===e&&(e=1),s.lbMain&&(s.lbMain.string=null!=t?t:"",s.lbMain.node.scale=m(1.5*e,1.5*e),v(s.lbMain.node).to(.2,{scale:m(e,e)}).start())};this.sprtMain&&this.data.spriteFrame&&(this.sprtMain.spriteFrame=this.data.spriteFrame),this.startPoint=this.node.worldPosition.clone(),this.endPoint=this.data.destination.clone();var c=this.calculateControlPoints(this.startPoint,this.endPoint,o(100,250)*(gt()>=.5?1:-1));this.controlPoint1=c[0],this.controlPoint2=c[1],l(null!=(r=null==(a=this.data)?void 0:a.text)?r:""),this.data.text2&&this.scheduleOnce((function(){l(s.data.text2,1.5)}),this.scaleTime+this.holdTime/2),this.doEffectSpriteMain(),this.doEffectMoving()},i.getTotalTime=function(){return this.scaleTime+this.holdTime+this.movingTime},i.setActive=function(t){this.node.active=t,this.nodeFollow&&(this.nodeFollow.active=!1)},i.setParentForFollowNode=function(t){this.nodeFollow&&(this.nodeFollow.parent=t,this.nodeFollow.setSiblingIndex(99))},i.doEffectSpriteMain=function(){this.node.scale=g.ZERO,v(this.node).to(this.scaleTime,{scale:m(1.5,1.5,1.5)},{easing:_.backOut}).delay(this.holdTime).to(this.movingTime,{scale:m(this.finalScale,this.finalScale,this.finalScale)},{easing:_.quartIn}).start()},i.doEffectFade=function(){},i.doEffectMoving=function(){var t=this;this.tweenValue=v(this.movingValue).delay(this.scaleTime+this.holdTime).call((function(){t.nodeFollow&&(t.nodeFollow.active=!0)})).to(this.movingTime,{value:1},{easing:_.quartIn}).call((function(){t.movingValue.value=1,t.tweenValue=null,null==t.data.onEnd||t.data.onEnd(),t.putToPool()})).start()},i.update=function(t){this.updatePosition()},i.updatePosition=function(){this.tweenValue&&(this.node.worldPosition=this.cubicBezierPoint(this.startPoint,this.controlPoint1,this.controlPoint2,this.endPoint,this.movingValue.value),this.nodeFollow&&(this.nodeFollow.worldPosition=this.node.worldPosition))},i.cubicBezierPoint=function(t,e,i,n,o){var r=1-o,a=o*o,s=r*r,l=s*r,c=a*o,u=new g;return u.set(l*t.x+3*s*o*e.x+3*r*a*i.x+c*n.x,l*t.y+3*s*o*e.y+3*r*a*i.y+c*n.y,l*t.z+3*s*o*e.z+3*r*a*i.z+c*n.z),u},i.calculateControlPoints=function(t,e,i){var n=e.clone().subtract(t).normalize(),o=new g(-n.y,n.x);return[t.clone().add(o.clone().multiplyScalar(i)),e.clone().add(o.clone().multiplyScalar(i))]},e}(A_)).prototype,"sprtMain",[K_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),eS=It($_.prototype,"lbMain",[X_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),iS=It($_.prototype,"nodeFollow",[J_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Q_=$_))||Q_);t._RF.pop(),t._RF.push({},"79538OeyiNCXKnP2hHWrfF9","EffectMultiMovingObject",void 0);var fS,gS,mS,vS,yS,bS=e.ccclass,_S=e.property;rS=bS("EffectMultiMovingObject"),aS=_S([dS]),rS((cS=It((lS=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,Ot(e,"childs",cS,Lt(e)),Ot(e,"soundEachEmitterReached",uS,Lt(e)),e.data=null,e.isInited=!1,e}return Nt(e,t),e.prototype.init=function(e,i,n){var o=this;t.prototype.init.call(this,e,i,n),this.data=n,n.randomDuration||(n.randomDuration=0),this.isInited||(this.isInited=!0,this.childs.length<=0&&(this.childs=this.node.getComponentsInChildren(dS),this.childs.forEach((function(t){return t.setParentForFollowNode(o.node)}))));for(var r=function(){var t=a<n.number,e=mt(.3,.65),i=mt(.1,.3),r=1-e-i;if(o.childs[a].setActive(t),t){var s=o.childs[a],l=mt(n.duration-n.randomDuration,n.duration+n.randomDuration);s.movingTime=e*l,s.scaleTime=i*l;var c=r*l;s.holdTime=0,n.spreadDistance<=0&&(s.movingTime+=c,s.movingTime+=s.scaleTime,s.scaleTime=0,c=0),s.finalScale=0,s.sprtMain&&(s.sprtMain.node.active=!0,o.data.isRandomRotation&&(s.sprtMain.node.angle=mt(0,360))),n.spriteFrame&&s.sprtMain&&(s.sprtMain.spriteFrame=n.spriteFrame),s.node.position=g.ZERO,v(s.node).to(c,{position:m(mt(-n.spreadDistance,n.spreadDistance),mt(-n.spreadDistance,n.spreadDistance))}).call((function(){s.init("",null,{onEnd:function(){s.sprtMain&&(s.sprtMain.node.active=!1),null==n.onEachObject||n.onEachObject(s),o.soundEachEmitterReached&&ji.instance.playSound(o.soundEachEmitterReached)},destination:n.end,spriteFrame:n.spriteFrame,text:"",text2:""})})).start()}},a=0;a<this.childs.length;a++)r();this.scheduleOnce((function(){null==n.onEnd||n.onEnd()}),n.duration+n.randomDuration),this.scheduleOnce((function(){o.putToPool()}),1.5*(n.duration+n.randomDuration))},e}(A_)).prototype,"childs",[aS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),uS=It(lS.prototype,"soundEachEmitterReached",[_S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),sS=lS));t._RF.pop(),t._RF.push({},"52b3dLzk9pE2JwkxnQV/APT","EffectParticle",void 0);var SS,wS=e.ccclass,TS=e.property;fS=wS("EffectParticle"),gS=TS(ft),fS((yS=It((vS=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,Ot(e,"particleSystems",yS,Lt(e)),e}Nt(e,t);var i=e.prototype;return i.init=function(e,i,n){var o;t.prototype.init.call(this,e,i,n),null==(o=this.particleSystems)||o.forEach((function(t){null==t||t.play()}))},i.stopParticle=function(t){var e,i=this;void 0===t&&(t=4),null==(e=this.particleSystems)||e.forEach((function(t){null==t||t.stopEmitting()})),this.scheduleOnce((function(){i.putToPool()}),t)},e}(A_)).prototype,"particleSystems",[gS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),mS=vS));t._RF.pop(),t._RF.push({},"c2301FhRClBM7qSV+ZoQLbZ","EffectPoints",void 0);var CS,ES,AS,PS,MS,IS,NS,OS=e.ccclass;e.property,OS("EffectMovingObject")(SS=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).data=null,e.movingValue={value:0},e.tweenValue=null,e.startPoint=null,e.endPoint=null,e.controlPoint1=null,e.controlPoint2=null,e}Nt(e,t);var i=e.prototype;return i.onDisable=function(){var t;null==(t=this.tweenValue)||t.stop()},i.init=function(e,i,n){var o=this;t.prototype.init.call(this,e,i,n),this.data=n,this.startPoint=this.node.worldPosition.clone(),this.endPoint=this.data.destination.clone();var r=this.calculateControlPoints(this.startPoint,this.endPoint,500);this.controlPoint1=r[0],this.controlPoint2=r[1],this.node.scale=g.ZERO;v(this.node).to(.25,{scale:m(1.5,1.5,1.5)},{easing:_.backOut}).delay(.5).to(.75,{scale:m(.5,.5,.5)},{easing:_.quartIn}).start(),this.tweenValue=v(this.movingValue).delay(.75).to(.75,{value:1},{easing:_.quartIn}).call((function(){o.movingValue.value=1,o.tweenValue=null,null==o.data.onEnd||o.data.onEnd(),o.putToPool()})).start()},i.update=function(t){this.updatePosition()},i.updatePosition=function(){this.tweenValue&&(this.node.worldPosition=this.cubicBezierPoint(this.startPoint,this.controlPoint1,this.controlPoint2,this.endPoint,this.movingValue.value))},i.cubicBezierPoint=function(t,e,i,n,o){var r=1-o,a=o*o,s=r*r,l=s*r,c=a*o,u=new g;return u.set(l*t.x+3*s*o*e.x+3*r*a*i.x+c*n.x,l*t.y+3*s*o*e.y+3*r*a*i.y+c*n.y,l*t.z+3*s*o*e.z+3*r*a*i.z+c*n.z),u},i.calculateControlPoints=function(t,e,i){var n=e.clone().subtract(t).normalize(),o=new g(-n.y,n.x);return[t.clone().add(o.clone().multiplyScalar(i)),e.clone().add(o.clone().multiplyScalar(i))]},e}(A_));t._RF.pop(),t._RF.push({},"4bb4ddfy3ZF7IT9EWgZoUId","EffectText",void 0);var LS,RS,xS,FS,DS,zS,kS,VS=e.ccclass,BS=e.property;CS=VS("EffectText"),ES=BS(y),AS=BS(b),CS((IS=It((MS=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,Ot(e,"lbMain",IS,Lt(e)),Ot(e,"opMain",NS,Lt(e)),e}return Nt(e,t),e.prototype.init=function(e,i,n){t.prototype.init.call(this,e,i,n);var o=n.text,r=n.color,a=n.time,s=n.size,l=n.distance;this.lbMain.string=null!=o?o:"NULL",this.lbMain.color=null!=r?r:X.WHITE,this.lbMain.fontSize=null!=s?s:60,this.node.scale=m(1.2,1.2),this.opMain.opacity=255;var c=null!=a?a:.5,u=null!=l?l:100;v(this.node).to(c,{scale:g.ONE},{easing:_.quadIn}).start(),v(this.node).by(c,{worldPosition:m(0,u,0)},{easing:_.quadIn}).start(),v(this.opMain).to(c,{opacity:0},{easing:_.quartIn}).start()},e}(Y_)).prototype,"lbMain",[ES],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),NS=It(MS.prototype,"opMain",[AS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),PS=MS));t._RF.pop(),t._RF.push({},"6e75aYdfoVM5bOfW6DB+f+a","FacialEmotionController",void 0);var HS,US,GS,WS,qS,ZS,YS,jS,KS=e.ccclass,XS=e.property,JS=function(t){return t.NEUTRAL="neutral",t.HAPPY="happy",t.SAD="sad",t.ANGRY="angry",t.SURPRISED="surprised",t.FEAR="fear",t.DISGUST="disgust",t}({}),QS=(LS=KS("FacialEmotionController"),RS=XS({type:vt}),xS=XS({tooltip:"Define emotions with blend shape weights"}),LS((zS=It((DS=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,Ot(e,"faceRenderer",zS,Lt(e)),Ot(e,"emotions",kS,Lt(e)),e.currentEmotion=JS.NEUTRAL,e.isTransitioning=!1,e.transitionTime=0,e.transitionDuration=.5,e.fromWeights=new Map,e.toWeights=new Map,e.blendShapeNames=[],e.faceMaterial=null,e}Nt(e,t);var i=e.prototype;return i.start=function(){this.faceRenderer?(this.faceRenderer.material&&(this.faceMaterial=this.faceRenderer.material),this.blendShapeNames=this.getBlendShapeNames(),this.setEmotion(JS.NEUTRAL)):console.error("Face renderer not assigned!")},i.getBlendShapeNames=function(){return["eyeBrowUp","eyeBrowDown","eyeClose","mouthOpen","mouthSmile","mouthFrown"]},i.update=function(t){if(this.isTransitioning&&this.faceMaterial){this.transitionTime+=t;for(var e,i=Math.min(this.transitionTime/this.transitionDuration,1),n=Dt(this.blendShapeNames);!(e=n()).done;){var o=e.value,r=this.fromWeights.get(o)||0,a=this.toWeights.get(o)||0,s=this.lerp(r,a,this.easeInOutQuad(i));this.applyBlendShapeWeight(o,s)}this.transitionTime>=this.transitionDuration&&(this.isTransitioning=!1)}},i.applyBlendShapeWeight=function(t,e){if(this.faceMaterial){var i="blendShape_"+t;this.faceMaterial.setProperty(i,e)}},i.setEmotion=function(t,e){if(void 0===e&&(e=.5),this.faceMaterial){var i=this.emotions.find((function(e){return e.name===t}));if(i){if(e>0){this.fromWeights.clear();for(var n,o=Dt(this.blendShapeNames);!(n=o()).done;){var r=n.value,a=this.getCurrentBlendShapeWeight(r);this.fromWeights.set(r,a)}this.toWeights.clear();for(var s,l=Dt(i.blendShapes);!(s=l()).done;){var c=s.value;this.toWeights.set(c.name,c.weight)}this.isTransitioning=!0,this.transitionTime=0,this.transitionDuration=e}else{for(var u,h=Dt(this.blendShapeNames);!(u=h()).done;){var p=u.value;this.applyBlendShapeWeight(p,0)}for(var d,f=Dt(i.blendShapes);!(d=f()).done;){var g=d.value;this.applyBlendShapeWeight(g.name,g.weight)}}this.currentEmotion=t}else console.warn('Emotion "'+t+'" not found')}},i.getCurrentBlendShapeWeight=function(t){if(!this.faceMaterial)return 0;var e="blendShape_"+t;try{var i=this.faceMaterial.getProperty(e);return"number"==typeof i?i:0}catch(t){return 0}},i.getCurrentEmotion=function(){return this.currentEmotion},i.lerp=function(t,e,i){return t+(e-t)*i},i.easeInOutQuad=function(t){return t<.5?2*t*t:1-Math.pow(-2*t+2,2)/2},e}(r)).prototype,"faceRenderer",[RS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),kS=It(DS.prototype,"emotions",[xS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),FS=DS))||FS);t._RF.pop(),t._RF.push({},"72db6UNpkhFOa4J9jHDXQ/n","FacialEmotionDemo",void 0);var $S,tw,ew,iw,nw,ow,rw,aw,sw,lw,cw,uw,hw,pw,dw=e.ccclass,fw=e.property;HS=dw("FacialEmotionDemo"),US=fw(QS),GS=fw(c),HS((ZS=It((qS=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,Ot(e,"faceController",ZS,Lt(e)),Ot(e,"emotionButtonsContainer",YS,Lt(e)),Ot(e,"transitionDuration",jS,Lt(e)),e.emotionButtons=new Map,e}Nt(e,t);var i=e.prototype;return i.start=function(){this.faceController?(this.emotionButtonsContainer&&this.setupEmotionButtons(),this.setEmotion(JS.NEUTRAL)):console.error("Face controller not assigned!")},i.setupEmotionButtons=function(){var t=this;if(this.emotionButtonsContainer)for(var e,i=this.emotionButtonsContainer.getComponentsInChildren(x),n=function(){var i=e.value,n=i.node.name.toLowerCase(),o=[JS.NEUTRAL,JS.HAPPY,JS.SAD,JS.ANGRY,JS.SURPRISED,JS.FEAR,JS.DISGUST].find((function(t){return n.includes(t.toLowerCase())}));if(o){t.emotionButtons.set(o,i);var r=new F;r.target=t.node,r.component="FacialEmotionDemo",r.handler="onEmotionButtonClicked",r.customEventData=o,i.clickEvents.push(r)}},o=Dt(i);!(e=o()).done;)n()},i.onEmotionButtonClicked=function(t,e){this.setEmotion(e)},i.setEmotion=function(t){this.faceController&&(console.log("Setting emotion: "+t),this.faceController.setEmotion(t,this.transitionDuration),this.updateButtonStates(t))},i.updateButtonStates=function(t){this.emotionButtons.forEach((function(e,i){e.interactable=i!==t;var n=i===t?1.2:1;e.node.setScale(new g(n,n,n))}))},i.triggerEmotionBasedOnEvent=function(t){switch(t){case"victory":this.setEmotion(JS.HAPPY);break;case"defeat":this.setEmotion(JS.SAD);break;case"damage":this.setEmotion(JS.ANGRY);break;case"surprise":this.setEmotion(JS.SURPRISED);break;case"scary":this.setEmotion(JS.FEAR);break;case"disgust":this.setEmotion(JS.DISGUST);break;default:this.setEmotion(JS.NEUTRAL)}},i.playEmotionSequence=function(){var t=this,e=[{emotion:JS.SURPRISED,duration:1},{emotion:JS.HAPPY,duration:2},{emotion:JS.NEUTRAL,duration:1}],i=0;e.forEach((function(e){t.scheduleOnce((function(){t.setEmotion(e.emotion)}),i),i+=e.duration}))},e}(r)).prototype,"faceController",[US],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),YS=It(qS.prototype,"emotionButtonsContainer",[GS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),jS=It(qS.prototype,"transitionDuration",[fw],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),WS=qS));t._RF.pop(),t._RF.push({},"58916U7dudCXZ4FreIgnM5F","GameEnviromentSetter",void 0);var gw,mw,vw,yw,bw,_w=e.ccclass,Sw=e.property;$S=_w("GameEnviromentSetter"),tw=Sw(c),ew=Sw(f),iw=Sw(lo),nw=Sw(y),$S((aw=It((rw=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,Ot(e,"API",aw,Lt(e)),Ot(e,"LOG",sw,Lt(e)),Ot(e,"FAKEDATA",lw,Lt(e)),Ot(e,"sckContainer",cw,Lt(e)),Ot(e,"sprtProcessBar",uw,Lt(e)),Ot(e,"popupError",hw,Lt(e)),Ot(e,"lbError",pw,Lt(e)),e.sceneName=Lp,e.retryCount=0,e}Nt(e,t);var i=e.prototype;return i.onLoad=function(){var t;t={API:this.API,LOG:this.LOG},ye=t,this.init(),this.initGameProcess()},i.init=function(){var t;t=ye.API,jp.setBaseURL(t)},i.initGameProcess=function(){var t=this;Promise.all([this.step_ProcessData(),this.step_ProcessPreloadSceneAssets()]).then((function(e){t.loadGame()})).catch((function(e){t.showError(e)}))},i.retry=function(){++this.retryCount>3?this.lbError.string="Please try again later!":(this.popupError.doHide(),this.initGameProcess())},i.showError=function(t){this.lbError.string=t,this.popupError.doShow()},i.step_ProcessData=function(){var t=this;return new Promise((function(e,i){t.step_initManagers().then((function(t){e("success")})).catch((function(t){i(t)}))}))},i.step_initManagers=function(){return new Promise((function(t,e){ji.instance=new ji,ao.instance=new ao,z_.instance=new z_,t("success")}))},i.step_ProcessPreloadSceneAssets=function(){var t=this;return new Promise((function(e,i){M.preloadScene(t.sceneName,(function(e,i,n){t.sprtProcessBar&&(t.sprtProcessBar.fillRange=e/i*.95)}),(function(n,o){if(n)return ye.LOG&&console.error("Failed to preload scene "+t.sceneName+":",n),void i("Failed to load assets. Please retry. If retrying doesn't help, please clear the cache and try again.");e("loaded assets done")}))}))},i.loadGame=function(){var t=this;this.sprtProcessBar.fillRange=1,ye.LOG&&console.log("doneLoadAssets"),M.loadScene(this.sceneName,(function(){ye.LOG&&console.log("Scene "+t.sceneName+" loaded successfully")}))},i.onTouch_Retry=function(){this.retry()},e}(r)).prototype,"API",[Sw],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),sw=It(rw.prototype,"LOG",[Sw],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),lw=It(rw.prototype,"FAKEDATA",[Sw],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),cw=It(rw.prototype,"sckContainer",[tw],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),uw=It(rw.prototype,"sprtProcessBar",[ew],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),hw=It(rw.prototype,"popupError",[iw],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),pw=It(rw.prototype,"lbError",[nw],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ow=rw));t._RF.pop(),t._RF.push({},"af638cDGFlB4L/26jmCHP0n","PitchBase",void 0);var ww,Tw,Cw,Ew,Aw,Pw,Mw,Iw,Nw,Ow,Lw,Rw,xw,Fw,Dw,zw,kw,Vw=e.ccclass,Bw=e.property,Hw=(gw=Vw("PitchBase"),mw=Bw({range:[0,1],slide:!0,tooltip:"Minimum volume level to detect pitch",group:{name:"Detection Settings",id:"detection"}}),gw((bw=It((yw=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).eventTarget=new yt,e.audioContext=null,e.analyzer=null,e.microphone=null,e.microphoneStream=null,e.analyzerBuffer=null,e.bufferSize=2048,e.isDetecting=!1,e.detectionInterval=null,e.detectionIntervalMs=50,e.smoothingFactor=.6,e.lastFrequency=0,Ot(e,"volumeThreshold",bw,Lt(e)),e}Nt(e,t);var i=e.prototype;return i.on=function(t,e,i){var n;null==(n=this.eventTarget)||n.on(t,e,i)},i.off=function(t,e,i){var n;null==(n=this.eventTarget)||n.off(t,e,i)},i.emit=function(t,e,i,n,o,r){var a;null==(a=this.eventTarget)||a.emit(t,e,i,n,o,r)},i.onDestroy=function(){this.stopDetection(),this.microphoneStream&&(this.microphoneStream.getTracks().forEach((function(t){return t.stop()})),this.microphoneStream=null),this.audioContext&&(this.audioContext.close(),this.audioContext=null)},i.initialize=function(){var t=Rt(xt().mark((function t(){var e;return xt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,window.AudioContext||window.webkitAudioContext){t.next=4;break}return console.error("AudioContext is not supported in this browser"),t.abrupt("return",!1);case 4:return e=window.AudioContext||window.webkitAudioContext,this.audioContext=new e,this.analyzer=this.audioContext.createAnalyser(),this.analyzer.fftSize=this.bufferSize,this.analyzer.smoothingTimeConstant=.8,this.analyzerBuffer=new Float32Array(this.analyzer.frequencyBinCount),console.log("Pitch detection system initialized"),t.abrupt("return",!0);case 14:return t.prev=14,t.t0=t.catch(0),console.error("Failed to initialize pitch detection system:",t.t0),t.abrupt("return",!1);case 18:case"end":return t.stop()}}),t,this,[[0,14]])})));return function(){return t.apply(this,arguments)}}(),i.requestMicrophoneAccess=function(){var t=this;return new Promise(Rt(xt().mark((function e(i,n){var o,r,a;return xt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?o=navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices):(r=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia)&&(o=function(t){return new Promise((function(e,i){r(t,e,i)}))}),o){e.next=6;break}return console.error("getUserMedia is not supported in this browser"),i(!1),e.abrupt("return");case 6:return a={audio:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!1}},e.next=9,o(a);case 9:if(t.microphoneStream=e.sent,!t.audioContext||"suspended"!==t.audioContext.state){e.next=13;break}return e.next=13,t.audioContext.resume();case 13:t.microphone=t.audioContext.createMediaStreamSource(t.microphoneStream),t.microphone.connect(t.analyzer),console.log("Microphone access granted"),i(!0),e.next=23;break;case 19:e.prev=19,e.t0=e.catch(0),console.error("Failed to access microphone:",e.t0),i(!1);case 23:case"end":return e.stop()}}),e,null,[[0,19]])}))))},i.startDetection=function(){var t=this;this.isDetecting||(this.audioContext&&"suspended"===this.audioContext.state&&this.audioContext.resume(),this.isDetecting=!0,this.detectionInterval=setInterval((function(){t.detectPitch()}),this.detectionIntervalMs),console.log("Pitch detection started"))},i.stopDetection=function(){this.isDetecting&&(this.isDetecting=!1,null!==this.detectionInterval&&(clearInterval(this.detectionInterval),this.detectionInterval=null),console.log("Pitch detection stopped"))},i.detectPitch=function(){},i.detectPitchAutocorrelation=function(){for(var t=this.analyzerBuffer,e=t.length,i=0,n=0;n<e;n++)i+=t[n]*t[n];if((i=Math.sqrt(i/e))<this.volumeThreshold)return console.log("Autocorrelation RMS below threshold"),0;for(var o=new Float32Array(e),r=0;r<e;r++){o[r]=0;for(var a=0;a<e-r;a++)o[r]+=t[a]*t[a+r]}for(var s=-1,l=1;l<e/2;l++)if(o[l]<o[l-1]&&o[l]<o[l+1]){s=l;break}s<=1&&(s=1);for(var c=s,u=s+1;u<e/2;u++)o[u]>o[c]&&(c=u);if(o[c]<=0||0===c)return 0;var h=c;if(c>0&&c<e-1){var p=o[c],d=o[c-1],f=o[c+1],g=.5*(d-f)/(d-2*p+f);isFinite(g)&&(h+=g)}var m=0;return h>0?m=this.audioContext.sampleRate/h:console.log("Autocorrelation: Refined peak is zero or negative."),m},i.getVolumeLevel=function(){if(!this.analyzer)return 0;this.analyzer.getFloatTimeDomainData(this.analyzerBuffer);for(var t=0,e=0;e<this.analyzerBuffer.length;e++)t+=this.analyzerBuffer[e]*this.analyzerBuffer[e];return Math.sqrt(t/this.analyzerBuffer.length)},i.getAnalyzerData=function(){if(!this.analyzer||!this.analyzerBuffer)return null;this.analyzer.getFloatFrequencyData(this.analyzerBuffer);for(var t=new Float32Array(this.analyzerBuffer.length),e=0;e<this.analyzerBuffer.length;e++)t[e]=(this.analyzerBuffer[e]+100)/100;return t},i.setVolumeThreshold=function(t){this.volumeThreshold=Math.max(0,Math.min(1,t))},i.getVolumeThreshold=function(){return this.volumeThreshold},e}(r)).prototype,"volumeThreshold",[mw],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.005}}),vw=yw))||vw);t._RF.pop(),t._RF.push({},"ad490byc41ARIRcM3dgPh7C","PitchWaveform",void 0);var Uw,Gw=e.ccclass,Ww=e.property,qw=(ww=Gw("PitchWaveform"),Tw=Ww({type:[c],group:{name:"Visualization",id:"visualization"}}),Cw=Ww({type:Number,group:{name:"Visualization",id:"visualization"}}),Ew=Ww({type:Number,group:{name:"Visualization",id:"visualization"}}),Aw=Ww({type:Number,group:{name:"Visualization",id:"visualization"}}),Pw=Ww({type:Number,group:{name:"Visualization",id:"visualization"}}),Mw=Ww({type:l,group:{name:"Visualization",id:"visualization"}}),Iw=Ww({type:c,group:{name:"Visualization",id:"visualization"}}),ww((Lw=It((Ow=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,Ot(e,"waveformLines",Lw,Lt(e)),Ot(e,"numVisualizerLines",Rw,Lt(e)),Ot(e,"visualizerRadius",xw,Lt(e)),Ot(e,"visualizerMinScale",Fw,Lt(e)),Ot(e,"visualizerMaxScale",Dw,Lt(e)),Ot(e,"waveformLinePrefab",zw,Lt(e)),Ot(e,"microphoneNode",kw,Lt(e)),e.lineTweens=[],e.previousScales=[],e.SCALE_CHANGE_THRESHOLD=.01,e.TWEEN_DURATION=.1,e}Nt(e,t);var i=e.prototype;return i.initialize=function(t){if(void 0===t&&(t=null),t&&(this.microphoneNode=t),this.microphoneNode&&this.waveformLinePrefab){this.clearWaveformVisualization();for(var e=0;e<this.numVisualizerLines;e++){var i=E(this.waveformLinePrefab);if(i){var n=e/this.numVisualizerLines*Math.PI*2,o=Math.cos(n)*this.visualizerRadius,r=Math.sin(n)*this.visualizerRadius;i.setPosition(new g(o,r,0)),i.setRotationFromEuler(0,0,n*(180/Math.PI)),i.setScale(new g(0,1,1)),this.microphoneNode.addChild(i),i.setSiblingIndex(0),this.waveformLines.push(i),this.previousScales[e]=this.visualizerMinScale,this.lineTweens[e]=null}}}},i.clearWaveformVisualization=function(){this.lineTweens.forEach((function(t){t&&t.stop()})),this.lineTweens=[],this.previousScales=[],this.waveformLines.forEach((function(t){t&&t.destroy()})),this.waveformLines=[]},i.updateWaveformVisualization=function(t,e,i){if(this.microphoneNode&&0!==this.waveformLines.length){var n=i.getAnalyzerData();if(n)for(var o=Math.floor(n.length/this.numVisualizerLines),r=0;r<this.waveformLines.length;r++){var a=this.waveformLines[r];if(a){for(var s=Math.min(r*o,n.length-1),l=0,c=0;c<3;c++){l+=n[Math.min(s+c,n.length-1)]}l/=3;var u=this.visualizerMinScale+l*(this.visualizerMaxScale-this.visualizerMinScale)*Math.max(.3,Math.min(1,2*t));Math.abs(u-this.previousScales[r])>this.SCALE_CHANGE_THRESHOLD&&(this.lineTweens[r]&&this.lineTweens[r].stop(),this.lineTweens[r]=v(a).to(this.TWEEN_DURATION,{scale:new g(u,1,1)},{easing:"quadOut"}).start(),this.previousScales[r]=u)}}}},e}(r)).prototype,"waveformLines",[Tw],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Rw=It(Ow.prototype,"numVisualizerLines",[Cw],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 64}}),xw=It(Ow.prototype,"visualizerRadius",[Ew],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 100}}),Fw=It(Ow.prototype,"visualizerMinScale",[Aw],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.3}}),Dw=It(Ow.prototype,"visualizerMaxScale",[Pw],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1.5}}),zw=It(Ow.prototype,"waveformLinePrefab",[Mw],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),kw=It(Ow.prototype,"microphoneNode",[Iw],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Nw=Ow))||Nw);t._RF.pop(),t._RF.push({},"7be4edEMP9G4o2PKnJZVUkm","HomeController",void 0);var Zw=e.ccclass;e.property,Zw("HomeController")(Uw=function(t){function e(){return t.apply(this,arguments)||this}Nt(e,t);var i=e.prototype;return i.start=function(){},i.update=function(t){},i.onPitchGameClicked=function(){M.loadScene(Fp)},i.onKaraokeGameClicked=function(){M.loadScene(Dp)},i.onMagicTilesGameClicked=function(){M.loadScene(xp)},i.onAuditionGameClicked=function(){M.loadScene(Rp)},e}(r));t._RF.pop(),t._RF.push({},"0c271suebVCeo75bOBDa20C","KaraokeConstants",void 0);var Yw,jw,Kw,Xw,Jw,Qw,$w,tT,eT,iT,nT,oT=function(t){return t[t.INIT=0]="INIT",t[t.LOADING=1]="LOADING",t[t.READY=2]="READY",t[t.PLAYING=3]="PLAYING",t[t.PAUSED=4]="PAUSED",t[t.FINISHED=5]="FINISHED",t}({}),rT=function(t){return t[t.MISS=0]="MISS",t[t.GOOD=1]="GOOD",t[t.PERFECT=2]="PERFECT",t}({}),aT=function(){};aT.ANIMATION_IDLE="idle",aT.ANIMATION_SINGING="singing",aT.ANIMATION_TRANSITION_TIME=.3,aT.PITCH_DETECTION_INTERVAL_MS=50,aT.ACCURACY_THRESHOLDS={PERFECT:5,GOOD:15},aT.MAX_SCORE=100,aT.EVENTS={PITCH_DETECTED:"karaoke_pitch_detected",LYRICS_UPDATED:"karaoke_lyrics_updated",SCORE_UPDATED:"karaoke_score_updated",SONG_LOADED:"karaoke_song_loaded",SONG_ENDED:"karaoke_song_ended",SONG_STARTED:"karaoke_song_started",STATE_CHANGED:"karaoke_state_changed"},aT.SUPPORTED_AUDIO_FORMATS=["mp3","wav","ogg"],t._RF.pop(),t._RF.push({},"3935b3+6EJPYKeh0BN4/l9C","KaraokeAudioManager",void 0);var sT,lT,cT,uT,hT,pT,dT,fT,gT,mT,vT,yT,bT,_T=e.ccclass,ST=e.property,wT=(Yw=_T("KaraokeAudioManager"),jw=ST({type:N,tooltip:"Audio source for music playback",group:{name:"Audio",id:"audio"}}),Kw=ST({tooltip:"Volume for music playback (0-1)",range:[0,1],slide:!0,group:{name:"Audio",id:"audio"}}),Xw=ST({tooltip:"Fade in duration in seconds",group:{name:"Audio",id:"audio"}}),Jw=ST({tooltip:"Fade out duration in seconds",group:{name:"Audio",id:"audio"}}),Yw((tT=It(($w=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).eventTarget=new yt,Ot(e,"musicSource",tT,Lt(e)),Ot(e,"musicVolume",eT,Lt(e)),Ot(e,"fadeInDuration",iT,Lt(e)),Ot(e,"fadeOutDuration",nT,Lt(e)),e.currentAudioClip=null,e.isPlaying=!1,e.isPaused=!1,e.currentTime=0,e.duration=0,e.fadeInterval=null,e}Nt(e,t);var i=e.prototype;return i.onLoad=function(){this.musicSource||(this.musicSource=this.addComponent(N)),this.musicSource.volume=this.musicVolume},i.update=function(t){this.isPlaying&&!this.isPaused&&(this.currentTime=this.musicSource.currentTime,this.isPlaying&&!this.isPaused&&(this.duration>0&&this.currentTime>this.duration-.5||0==this.musicSource.playing)&&this.handlePlaybackEnd())},i.onDestroy=function(){this.stopPlayback(),this.clearFadeInterval()},i.loadAudio=function(t){var e=this;return new Promise((function(i){e.stopPlayback(),$e.loadRes(t,O,(function(n,o){if(n)return console.error("Failed to load audio: "+t,n),void i(!1);e.currentAudioClip=o,e.musicSource.clip=o,void 0!==e.musicSource.duration?e.duration=e.musicSource.duration:(console.warn("Could not determine duration for "+t+", using estimate"),e.duration=180),console.log("Loaded audio: "+t+", duration: "+e.duration+"s"),e.emit(aT.EVENTS.SONG_LOADED,{path:t,duration:e.duration}),i(!0)}))}))},i.startPlayback=function(t){void 0===t&&(t=!1),this.isPlaying&&!this.isPaused||(this.currentAudioClip?(this.isPaused?(this.musicSource.play(),this.isPaused=!1):(this.currentTime=0,this.musicSource.currentTime=0,t?(this.musicSource.volume=0,this.fadeIn()):this.musicSource.volume=this.musicVolume,this.musicSource.play()),this.isPlaying=!0,console.log("Audio playback started"),this.emit(aT.EVENTS.SONG_STARTED)):console.warn("No audio loaded"))},i.stopPlayback=function(t){var e=this;void 0===t&&(t=!0),this.isPlaying&&(t?this.fadeOut((function(){e.musicSource.stop(),e.finishStopPlayback()})):(this.musicSource.stop(),this.finishStopPlayback()))},i.pausePlayback=function(){this.isPlaying&&!this.isPaused&&(this.musicSource.pause(),this.isPaused=!0,console.log("Audio playback paused"))},i.resumePlayback=function(){this.isPaused&&(this.musicSource.play(),this.isPaused=!1,console.log("Audio playback resumed"))},i.seekTo=function(t){this.currentAudioClip&&(t=Math.max(0,Math.min(t,this.duration)),this.currentTime=t,this.musicSource.currentTime=t,console.log("Seeked to "+t+"s"))},i.getCurrentTime=function(){return this.musicSource.currentTime},i.getDuration=function(){return this.duration},i.setVolume=function(t){this.musicVolume=Math.max(0,Math.min(1,t)),this.musicSource.volume=this.musicVolume},i.getVolume=function(){return this.musicVolume},i.isAudioPlaying=function(){return this.isPlaying&&!this.isPaused},i.isAudioPaused=function(){return this.isPaused},i.clearFadeInterval=function(){this.fadeInterval&&(clearInterval(this.fadeInterval),this.fadeInterval=null)},i.handlePlaybackEnd=function(){this.isPlaying&&(console.log("Audio playback ended"),this.isPlaying=!1,this.isPaused=!1,this.emit(aT.EVENTS.SONG_ENDED))},i.finishStopPlayback=function(){this.clearFadeInterval(),this.isPlaying=!1,this.isPaused=!1,this.currentTime=0,console.log("Audio playback stopped")},i.fadeIn=function(){var t=this;this.fadeInterval&&clearInterval(this.fadeInterval);var e=0,i=this.musicVolume/(10*this.fadeInDuration);console.log("Fade in starting with step: "+i+", target volume: "+this.musicVolume+", duration: "+this.fadeInDuration),this.fadeInterval=setInterval((function(){e+=i,console.log("Fade in: current volume="+e.toFixed(2)),e>=t.musicVolume&&(e=t.musicVolume,clearInterval(t.fadeInterval),t.fadeInterval=null,console.log("Fade in completed")),t.musicSource.volume=e}),100)},i.fadeOut=function(t){var e=this;this.fadeInterval&&clearInterval(this.fadeInterval);var i=this.musicSource.volume,n=i/(10*this.fadeOutDuration);this.fadeInterval=setInterval((function(){(i-=n)<=0&&(i=0,clearInterval(e.fadeInterval),e.fadeInterval=null,t&&t()),e.musicSource.volume=i}),100)},i.on=function(t,e,i){var n;null==(n=this.eventTarget)||n.on(t,e,i)},i.off=function(t,e,i){var n;null==(n=this.eventTarget)||n.off(t,e,i)},i.emit=function(t,e,i,n,o,r){var a;null==(a=this.eventTarget)||a.emit(t,e,i,n,o,r)},e}(r)).prototype,"musicSource",[jw],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),eT=It($w.prototype,"musicVolume",[Kw],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.7}}),iT=It($w.prototype,"fadeInDuration",[Xw],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),nT=It($w.prototype,"fadeOutDuration",[Jw],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),Qw=$w))||Qw);t._RF.pop(),t._RF.push({},"25fe0RiSF5NqKgyxyLlEbpj","KaraokeCharacterAnimator",void 0);var TT,CT=e.ccclass,ET=e.property,AT=(sT=CT("KaraokeCharacterAnimator"),lT=ET({type:c,tooltip:"Character model node",group:{name:"Character",id:"character"}}),cT=ET({type:it,tooltip:"Character animation component",group:{name:"Character",id:"character"}}),uT=ET({tooltip:"Transition time between animations in seconds",group:{name:"Animation",id:"animation"}}),hT=ET({tooltip:"Name of the idle animation",group:{name:"Animation",id:"animation"}}),pT=ET({tooltip:"Name of the singing animation",group:{name:"Animation",id:"animation"}}),sT((gT=It((fT=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,Ot(e,"characterNode",gT,Lt(e)),Ot(e,"animationComponent",mT,Lt(e)),Ot(e,"transitionDuration",vT,Lt(e)),Ot(e,"idleAnimationName",yT,Lt(e)),Ot(e,"singingAnimationName",bT,Lt(e)),e.currentAnimation="",e.isTransitioning=!1,e.availableAnimations=new Set,e}Nt(e,t);var i=e.prototype;return i.onLoad=function(){this.initializeAnimations()},i.start=function(){this.playAnimation(this.idleAnimationName)},i.onDestroy=function(){},i.initializeAnimations=function(){var t=this;if(this.animationComponent){var e=this.animationComponent.clips;e.forEach((function(e){e&&t.availableAnimations.add(e.name)})),console.log("Initialized "+e.length+" animations for character")}else console.error("Animation component not found")},i.playIdle=function(){this.playAnimation(this.idleAnimationName)},i.playSinging=function(){this.playAnimation(this.singingAnimationName)},i.playAnimation=function(t,e){var i,n=this;if(this.animationComponent&&(this.currentAnimation!==t||this.isTransitioning)){this.currentAnimation=t;var o=null!=(i=null==e?void 0:e.transitionTime)?i:this.transitionDuration;if(this.isTransitioning=!0,!this.hasAnimation(t))return console.warn("Animation '"+t+"' not found"),void(this.isTransitioning=!1);this.animationComponent.crossFade(t,o),!1!==(null==e?void 0:e.loop)&&this.animationComponent.crossFade(t,o),setTimeout((function(){n.isTransitioning=!1}),1e3*o)}},i.stopAllAnimations=function(){this.animationComponent&&(this.animationComponent.stop(),this.currentAnimation="",this.isTransitioning=!1)},i.hasAnimation=function(t){return this.availableAnimations.has(t)},i.getCurrentAnimation=function(){return this.currentAnimation},i.isAnimationPlaying=function(t){return this.currentAnimation===t&&!this.isTransitioning},e}(r)).prototype,"characterNode",[lT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),mT=It(fT.prototype,"animationComponent",[cT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),vT=It(fT.prototype,"transitionDuration",[uT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return aT.ANIMATION_TRANSITION_TIME}}),yT=It(fT.prototype,"idleAnimationName",[hT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return aT.ANIMATION_IDLE}}),bT=It(fT.prototype,"singingAnimationName",[pT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return aT.ANIMATION_SINGING}}),dT=fT))||dT);t._RF.pop(),t._RF.push({},"b03016mcKVCqoyFHAN44X+M","KaraokePitchDetectionSystem",void 0);var PT,MT=e.ccclass,IT=(e.property,MT("KaraokePitchDetectionSystem")(TT=function(t){function e(){return t.apply(this,arguments)||this}Nt(e,t);var i=e.prototype;return i.onLoad=function(){this.detectionIntervalMs=aT.PITCH_DETECTION_INTERVAL_MS},i.detectPitch=function(){if(this.analyzer&&this.isDetecting){var t=this.getVolumeLevel();t<this.volumeThreshold?this.emitPitchDetected(0,!1,rT.MISS,t):this.emitPitchDetected(0,!0,1,t)}},i.calculateAccuracy=function(t){return t>0?rT.GOOD:rT.MISS},i.emitPitchDetected=function(t,e,i,n){var o={frequency:t,detected:e,accuracy:i,volume:n};this.emit(aT.EVENTS.PITCH_DETECTED,o)},i.getAnalyzerData=function(){if(!this.analyzer||!this.analyzerBuffer)return null;this.analyzer.getFloatFrequencyData(this.analyzerBuffer);for(var t=new Float32Array(this.analyzerBuffer.length),e=0;e<this.analyzerBuffer.length;e++)t[e]=(this.analyzerBuffer[e]+100)/100;return t},i.setVolumeThreshold=function(t){this.volumeThreshold=Math.max(0,Math.min(1,t))},i.getVolumeThreshold=function(){return this.volumeThreshold},e}(Hw))||TT);t._RF.pop(),t._RF.push({},"138ba6c4ppO4b8IaeAlyk0V","KaraokeLyricsManager",void 0);var NT,OT=e.ccclass,LT=(e.property,OT("KaraokeLyricsManager")(PT=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).eventTarget=new yt,e.lyrics=[],e.currentLyricIndex=-1,e.lyricUpdateInterval=null,e.currentTime=0,e.isPlaying=!1,e}Nt(e,t);var i=e.prototype;return i.onLoad=function(){},i.onDestroy=function(){this.stopLyricUpdates()},i.loadLyrics=function(t){var e=this;return new Promise((function(i,n){if(!t||!t.lyricPath)return console.error("Song or lyricPath is missing"),void n(new Error("Song or lyricPath is missing"));var o=Jp.getLyricPath(t);$e.loadRes(o,bt,(function(r,a){if(r)return console.error("Failed to load lyrics from path: "+o,r),void n(r);try{var s=a.json,l=s.segments.map((function(t){return{text:t.text,startTime:t.start,endTime:t.end,completed:!1}}));e.lyrics=l||[],e.resetLyrics();var c=zt({},t,{lyrics:l,duration:s.duration||t.duration});console.log("Loaded "+e.lyrics.length+" lyric segments"),i(c)}catch(t){console.error("Error parsing lyrics JSON:",t),n(t)}}))}))},i.setLyrics=function(t){this.lyrics=t||[],this.resetLyrics(),console.log("Set "+this.lyrics.length+" lyric segments")},i.startPlayback=function(){var t=this;this.isPlaying||(this.isPlaying=!0,this.currentTime=0,this.currentLyricIndex=-1,this.lyricUpdateInterval=setInterval((function(){t.updateLyrics()}),100),console.log("Lyrics playback started"))},i.stopPlayback=function(){this.isPlaying&&(this.isPlaying=!1,this.stopLyricUpdates(),this.resetLyrics(),console.log("Lyrics playback stopped"))},i.pausePlayback=function(){this.isPlaying&&(this.isPlaying=!1,this.stopLyricUpdates(),console.log("Lyrics playback paused"))},i.resumePlayback=function(){this.isPlaying||(this.isPlaying=!0,console.log("Lyrics playback resumed"))},i.updateTime=function(t){this.currentTime=t,this.lyricUpdateInterval||this.updateLyrics()},i.getCurrentLyric=function(){return this.currentLyricIndex<0||this.currentLyricIndex>=this.lyrics.length?null:this.lyrics[this.currentLyricIndex]},i.getNextLyric=function(){var t=this.currentLyricIndex+1;return t>=this.lyrics.length?null:this.lyrics[t]},i.isLyricActive=function(){var t=this.getCurrentLyric();return!!t&&(this.currentTime>=t.startTime&&this.currentTime<=t.endTime)},i.updateLyrics=function(){if(this.isPlaying&&0!==this.lyrics.length){var t=this.findLyricIndexAtTime(this.currentTime);if(t!==this.currentLyricIndex){var e=this.currentLyricIndex;this.currentLyricIndex=t,e>=0&&e<this.lyrics.length&&t>e&&(this.lyrics[e].completed=!0),this.emitLyricUpdated()}this.lyricUpdateInterval&&(this.currentTime+=.1)}},i.findLyricIndexAtTime=function(t){if(0===this.lyrics.length)return-1;if(t<this.lyrics[0].startTime)return-1;for(var e=0;e<this.lyrics.length;e++){var i=this.lyrics[e];if(t>=i.startTime&&t<=i.endTime)return e}if(t>this.lyrics[this.lyrics.length-1].endTime)return this.lyrics.length-1;for(var n=0;n<this.lyrics.length-1;n++)if(t>this.lyrics[n].endTime&&t<this.lyrics[n+1].startTime)return n;return-1},i.stopLyricUpdates=function(){this.lyricUpdateInterval&&(clearInterval(this.lyricUpdateInterval),this.lyricUpdateInterval=null)},i.resetLyrics=function(){this.currentLyricIndex=-1,this.currentTime=0,this.lyrics.forEach((function(t){t.completed=!1}))},i.emitLyricUpdated=function(){var t=this.getCurrentLyric(),e=this.getNextLyric();this.emit(aT.EVENTS.LYRICS_UPDATED,{currentLyric:t,nextLyric:e,currentLyricIndex:this.currentLyricIndex,totalLyrics:this.lyrics.length})},i.on=function(t,e,i){var n;null==(n=this.eventTarget)||n.on(t,e,i)},i.off=function(t,e,i){var n;null==(n=this.eventTarget)||n.off(t,e,i)},i.emit=function(t,e,i,n,o,r){var a;null==(a=this.eventTarget)||a.emit(t,e,i,n,o,r)},e}(r))||PT);t._RF.pop(),t._RF.push({},"6638fPOlQNMEYIE+ff0PAqW","KaraokeScoringSystem",void 0);var RT,xT,FT,DT,zT,kT,VT,BT,HT,UT,GT,WT,qT,ZT,YT,jT,KT,XT,JT,QT,$T,tC,eC,iC,nC,oC,rC,aC,sC,lC,cC,uC,hC,pC,dC,fC,gC,mC,vC,yC,bC,_C,SC,wC,TC,CC=e.ccclass,EC=(e.property,CC("KaraokeScoringSystem")(NT=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).eventTarget=new yt,e.validDuration=0,e.totalInteractionDuration=0,e.isRecording=!1,e.isPitchDetected=!1,e.isLyricActive=!1,e}Nt(e,t);var i=e.prototype;return i.onDestroy=function(){},i.startScoring=function(){this.isRecording||(this.isRecording=!0,this.resetScore(),console.log("Score recording started"))},i.stopScoring=function(){this.isRecording&&(this.isRecording=!1,this.emitScoreUpdated(),console.log("Score recording stopped"))},i.updateTime=function(t){},i.updatePitchDetection=function(t){this.isRecording&&(this.isPitchDetected=t.detected,this.isPitchDetected&&this.isLyricActive&&(this.validDuration+=aT.PITCH_DETECTION_INTERVAL_MS/1e3*1.3,console.log("valid duration: "+this.validDuration)))},i.updateLyricStatus=function(t){this.isLyricActive=t},i.resetScore=function(){this.validDuration=0,this.emitScoreUpdated()},i.getScore=function(){return{validDuration:this.validDuration,totalInteractionDuration:this.totalInteractionDuration,score:this.calculateScore()}},i.getScorePercentage=function(){return this.calculateScore()},i.setTotalLyricsDuration=function(t){this.totalInteractionDuration=t},i.calculateScore=function(){return Math.round(100*Math.min(this.validDuration/this.totalInteractionDuration,1))-o(0,10)},i.emitScoreUpdated=function(){var t=this.getScore();this.emit(aT.EVENTS.SCORE_UPDATED,{score:t})},i.on=function(t,e,i){var n;null==(n=this.eventTarget)||n.on(t,e,i)},i.off=function(t,e,i){var n;null==(n=this.eventTarget)||n.off(t,e,i)},i.emit=function(t,e,i,n,o,r){var a;null==(a=this.eventTarget)||a.emit(t,e,i,n,o,r)},e}(r))||NT);t._RF.pop(),t._RF.push({},"60dfd1+5blL1J3Dxf5ZMKYQ","KaraokeUIManager",void 0);var AC,PC,MC,IC,NC,OC,LC,RC,xC,FC,DC,zC,kC,VC,BC,HC,UC,GC,WC,qC=e.ccclass,ZC=e.property,YC=(RT=qC("KaraokeUIManager"),xT=ZC({type:y,tooltip:"Label component to display the countdown time",group:{name:"Timer",id:"timer"}}),FT=ZC({tooltip:"Format to display timer (s = seconds only, mm:ss = minutes and seconds)",group:{name:"Timer",id:"timer"}}),DT=ZC({type:c,tooltip:"Container node for lyric labels",group:{name:"Lyrics",id:"lyrics"}}),zT=ZC({type:l,tooltip:"Prefab for lyric items",group:{name:"Lyrics",id:"lyrics"}}),kT=ZC({tooltip:"Maximum characters per line",group:{name:"Lyrics",id:"lyrics"}}),VT=ZC({tooltip:"Maximum lines per segment",group:{name:"Lyrics",id:"lyrics"}}),BT=ZC({tooltip:"Scroll speed multiplier",group:{name:"Lyrics",id:"lyrics"}}),HT=ZC({tooltip:"Number of preloaded lyric items for pooling",group:{name:"Lyrics",id:"lyrics"}}),UT=ZC({tooltip:"Viewport height for recycling lyrics",group:{name:"Lyrics",id:"lyrics"}}),GT=ZC({type:c,tooltip:"Microphone icon node",group:{name:"Microphone",id:"mic"}}),WT=ZC({type:c,tooltip:"Sound wave container node",group:{name:"Microphone",id:"mic"}}),qT=ZC({type:[c],tooltip:"Wave bar nodes",group:{name:"Microphone",id:"mic"}}),ZT=ZC({tooltip:"Color when microphone is active",group:{name:"Microphone",id:"mic"}}),YT=ZC({tooltip:"Color when microphone is inactive",group:{name:"Microphone",id:"mic"}}),jT=ZC({tooltip:"Animation speed for wave bars",group:{name:"Microphone",id:"mic"}}),KT=ZC({tooltip:"Volume threshold for activity",group:{name:"Microphone",id:"mic"}}),XT=ZC({type:qw,tooltip:"Node containing PitchWaveform component",group:{name:"Microphone",id:"mic"}}),JT=ZC({type:y,tooltip:"Label component to display the countdown time",group:{name:"UI",id:"ui"}}),QT=ZC({type:y,tooltip:"Label component to display the countdown time",group:{name:"UI",id:"ui"}}),$T=ZC({type:y,tooltip:"Label component to display the score",group:{name:"UI",id:"ui"}}),tC=ZC({type:tn,tooltip:"Animation panel viewEndGame",group:{name:"UI",id:"ui"}}),RT((nC=It((iC=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,Ot(e,"timeLabel",nC,Lt(e)),Ot(e,"timerFormat",oC,Lt(e)),Ot(e,"lyricsContainer",rC,Lt(e)),Ot(e,"lyricPrefab",aC,Lt(e)),Ot(e,"maxCharsPerLine",sC,Lt(e)),Ot(e,"maxLinesPerSegment",lC,Lt(e)),Ot(e,"scrollSpeedMultiplier",cC,Lt(e)),Ot(e,"poolSize",uC,Lt(e)),Ot(e,"viewportHeight",hC,Lt(e)),Ot(e,"micIcon",pC,Lt(e)),Ot(e,"waveContainer",dC,Lt(e)),Ot(e,"waveBars",fC,Lt(e)),Ot(e,"activeColor",gC,Lt(e)),Ot(e,"inactiveColor",mC,Lt(e)),Ot(e,"animationSpeed",vC,Lt(e)),Ot(e,"volumeThreshold",yC,Lt(e)),Ot(e,"waveformVisualizer",bC,Lt(e)),Ot(e,"lbCountdown",_C,Lt(e)),Ot(e,"lbPressButton",SC,Lt(e)),Ot(e,"lbScore",wC,Lt(e)),Ot(e,"animationpanelViewEndGame",TC,Lt(e)),e.totalDuration=0,e.remainingTime=0,e.isTimerActive=!1,e.lyricPool=[],e.activeLyrics=[],e.currentLyricIndex=-1,e.targetScrollPosition=0,e.isScrolling=!1,e.lastScrollPosition=0,e.allLyrics=[],e.lastCreatedLyricIndex=-1,e.initialLyricCount=5,e.yOffsetForNewLyrics=0,e.isMicActive=!1,e.currentAnimations=[],e}Nt(e,t);var i=e.prototype;return i.start=function(){this.setupUIElements(),this.updateTimerDisplay(0),this.initLyricPool(),this.setMicActiveState(!1),this.waveformVisualizer&&this.waveformVisualizer.initialize(this.micIcon)},i.update=function(t){this.updateLyricsScrolling(t)},i.onDestroy=function(){this.stopAllAnimations(),this.clearLyricLabels(),this.lyricPool=[]},i.setupUIElements=function(){},i.showLoadingState=function(t){},i.showReadyState=function(){this.lbPressButton&&(this.lbPressButton.node.active=!0)},i.showPlayingState=function(){this.lbPressButton&&(this.lbPressButton.node.active=!1)},i.showPausedState=function(){},i.showFinishedState=function(t){var e=this;this.animationpanelViewEndGame.show((function(){})),this.lbScore.node.active=!0;var i=t||0,n=0;this.lbScore.string="0";var o=Math.min(2,.5+i/100*1.5);v(this.lbScore.node).call((function(){v(e.lbScore.node).to(.2,{scale:new g(1.2,1.2,1.2)}).to(.2,{scale:new g(1,1,1)}).start()})).to(o,{},{onUpdate:function(t,o){n=Math.floor(i*o),e.lbScore.string=n.toString()}}).call((function(){e.lbScore.string=i.toString(),v(e.lbScore.node).to(.1,{scale:new g(1.3,1.3,1.3)}).to(.2,{scale:new g(1,1,1)}).start()})).start()},i.startCountdown=function(t){var e=this;if(this.lbCountdown){this.lbCountdown.node.active=!0,this.lbPressButton&&(this.lbPressButton.node.active=!1);var i=[3,2,1,"Bắt đầu"],n=0;!function o(){if(n<i.length){e.lbCountdown.string=i[n].toString();var r=e.lbCountdown.node;v(r).to(.1,{scale:new g(2,2,2)}).to(.3,{scale:new g(1,1,1)}).call((function(){++n<i.length?o():setTimeout((function(){e.lbCountdown.node.active=!1,t()}),600)})).start()}}()}else t()},i.updateTimer=function(t,e){this.isTimerActive&&(this.remainingTime=Math.max(0,this.totalDuration-e),this.updateTimerDisplay(this.remainingTime),this.remainingTime<=0&&(this.isTimerActive=!1))},i.formatTime=function(t){if(t=Math.floor(t),"s"===this.timerFormat)return t+"s";var e=Math.floor(t/60),i=t%60;return(e<10?"0"+e:""+e)+":"+(i<10?"0"+i:""+i)},i.startTimer=function(t){this.totalDuration=t,this.remainingTime=t,this.isTimerActive=!0,this.updateTimerDisplay(this.remainingTime)},i.stopTimer=function(){this.isTimerActive=!1},i.pauseTimer=function(){this.isTimerActive=!1},i.resumeTimer=function(){this.isTimerActive=!0},i.updateTimerDisplay=function(t){this.timeLabel&&(this.timeLabel.string=this.formatTime(t))},i.initLyricPool=function(){if(this.lyricPrefab&&this.lyricsContainer){var t=new c("LyricPool");t.active=!1,this.node.addChild(t);for(var e=0;e<this.poolSize;e++){var i=E(this.lyricPrefab),n=i.getComponent("KaraokeUILyric");i.active=!1,t.addChild(i),n&&this.lyricPool.push(n)}}},i.getLyricFromPool=function(){for(var t,e=Dt(this.lyricPool);!(t=e()).done;){var i=t.value;if(!i.isInUse())return i.node.active=!0,i}var n=E(this.lyricPrefab);n.active=!0;var o=n.getComponent("KaraokeUILyric");return o?(this.lyricPool.push(o),o):null},i.updateLyricsScrolling=function(t){if(this.isScrolling&&this.lyricsContainer){var e=this.lyricsContainer.position,i=this.lerpValue(e.y,this.targetScrollPosition,5*t*this.scrollSpeedMultiplier);this.lastScrollPosition=e.y,this.lyricsContainer.setPosition(new g(e.x,i,e.z)),Math.abs(i-this.targetScrollPosition)<.1&&(this.isScrolling=!1)}},i.lerpValue=function(t,e,i){return t+(e-t)*Math.min(1,i)},i.updateLyrics=function(t){t!==this.currentLyricIndex&&(this.currentLyricIndex=t,this.highlightCurrentLyric(t))},i.createLyricLabels=function(t){this.lyricsContainer&&this.lyricPrefab&&(this.clearLyricLabels(),this.lyricsContainer.setPosition(new g(0,0,0)),this.targetScrollPosition=0,this.isScrolling=!1,this.lastScrollPosition=0,this.allLyrics=t,this.lastCreatedLyricIndex=-1,this.yOffsetForNewLyrics=0,this.createInitialLyrics())},i.createInitialLyrics=function(){for(var t=0,e=0;t<this.initialLyricCount&&this.lastCreatedLyricIndex+1<this.allLyrics.length;){var i=this.lastCreatedLyricIndex+1,n=this.allLyrics[i],o=this.processLyricText(n.text),r=this.createLyricLabel(o,i);if(r){var a=r.getHeight();r.node.setPosition(new g(0,e,0)),this.lyricsContainer.addChild(r.node),this.activeLyrics.push(r),e-=a+20,this.lastCreatedLyricIndex=i,t++}}this.yOffsetForNewLyrics=e},i.createNextLyric=function(){if(this.lastCreatedLyricIndex+1>=this.allLyrics.length)return!1;var t=this.lastCreatedLyricIndex+1,e=this.allLyrics[t],i=this.processLyricText(e.text),n=this.createLyricLabel(i,t);if(!n)return!1;var o=n.getHeight();return n.node.setPosition(new g(0,this.yOffsetForNewLyrics,0)),this.lyricsContainer.addChild(n.node),this.activeLyrics.push(n),this.yOffsetForNewLyrics-=o+20,this.lastCreatedLyricIndex=t,!0},i.processLyricText=function(t){for(var e,i=t.split(" "),n=[],o="",r=Dt(i);!(e=r()).done;){var a=e.value;if((o+" "+a).length>this.maxCharsPerLine&&o.length>0){if(n.push(o),o=a,n.length>=this.maxLinesPerSegment)break}else o=0===o.length?a:o+" "+a}return o.length>0&&n.length<this.maxLinesPerSegment&&n.push(o),n.join("\n")},i.createLyricLabel=function(t,e){var i=this.getLyricFromPool();return i?(i.init(t,e),e===this.currentLyricIndex?i.setHighlightState("current"):e<this.currentLyricIndex?i.setHighlightState("past"):i.setHighlightState("future"),i):null},i.clearLyricLabels=function(){this.activeLyrics.forEach((function(t){t&&t.isInUse()&&(t.recycle(),t.node.active=!1,t.node.removeFromParent())})),this.activeLyrics=[],this.currentLyricIndex=-1},i.highlightCurrentLyric=function(t){var e=this;if(!(t<0)){if(!this.activeLyrics.some((function(e){return e.getIndex()===t}))&&this.lastCreatedLyricIndex<this.allLyrics.length-1)for(;this.createNextLyric()&&!this.activeLyrics.some((function(e){return e.getIndex()===t})););if(this.activeLyrics.forEach((function(i){if(i&&i.isInUse()){var n=i.getIndex();n===t?i.setHighlightState("current"):n<t?(i.setHighlightState("past"),e.scheduleLyricRecycling(i)):i.setHighlightState("future")}})),this.lyricsContainer){var i=this.activeLyrics.find((function(e){return e.getIndex()===t}));i&&(this.targetScrollPosition=-i.node.position.y,this.isScrolling=!0)}}},i.scheduleLyricRecycling=function(t){var e=this;t&&t.isInUse()&&t.fadeOut((function(){var i=e.activeLyrics.indexOf(t);-1!==i&&(e.activeLyrics.splice(i,1),t.recycle(),t.node.active=!1,t.node.removeFromParent(),e.createNextLyric())}))},i.hideLyricHighlight=function(){var t=this;this.activeLyrics.forEach((function(e){e&&e.isInUse()&&(e.getIndex()===t.currentLyricIndex&&e.setHighlightState("future"))}))},i.updateMicVisualization=function(t,e){var i=t.detected&&t.volume>this.volumeThreshold;this.setMicActiveState(i),i&&this.animateWaveBars(t.volume),this.waveformVisualizer&&this.waveformVisualizer.updateWaveformVisualization(t.volume,t.frequency,e)},i.setMicActiveState=function(t){if(this.isMicActive!==t){if(this.isMicActive=t,this.micIcon){var e=this.micIcon.getComponent(f);e&&(e.color=t?this.activeColor:this.inactiveColor)}this.waveContainer&&(this.waveContainer.active=t),t||this.stopAllAnimations()}},i.animateWaveBars=function(t){var e=this;if(this.waveBars&&0!==this.waveBars.length){this.stopAllAnimations();var i=Math.min(1,2*t);this.waveBars.forEach((function(t,n){if(t){var o=.5+i*Math.random()*.5,r=e.animationSpeed+.2*Math.random(),a=.05*n,s=v(t).delay(a).to(r,{scale:new g(1,o,1)}).to(r,{scale:new g(1,.5,1)}).union().repeat(3).start();e.currentAnimations.push(s)}}))}},i.stopAllAnimations=function(){this.currentAnimations.forEach((function(t){t&&t.stop()})),this.currentAnimations=[],this.waveBars.forEach((function(t){t&&t.setScale(new g(1,.5,1))}))},e}(r)).prototype,"timeLabel",[xT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),oC=It(iC.prototype,"timerFormat",[FT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"s"}}),rC=It(iC.prototype,"lyricsContainer",[DT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),aC=It(iC.prototype,"lyricPrefab",[zT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),sC=It(iC.prototype,"maxCharsPerLine",[kT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 90}}),lC=It(iC.prototype,"maxLinesPerSegment",[VT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 2}}),cC=It(iC.prototype,"scrollSpeedMultiplier",[BT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),uC=It(iC.prototype,"poolSize",[HT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 20}}),hC=It(iC.prototype,"viewportHeight",[UT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 600}}),pC=It(iC.prototype,"micIcon",[GT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),dC=It(iC.prototype,"waveContainer",[WT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),fC=It(iC.prototype,"waveBars",[qT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),gC=It(iC.prototype,"activeColor",[ZT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new X(255,0,255,255)}}),mC=It(iC.prototype,"inactiveColor",[YT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new X(150,150,150,255)}}),vC=It(iC.prototype,"animationSpeed",[jT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.3}}),yC=It(iC.prototype,"volumeThreshold",[KT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.01}}),bC=It(iC.prototype,"waveformVisualizer",[XT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_C=It(iC.prototype,"lbCountdown",[JT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),SC=It(iC.prototype,"lbPressButton",[QT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),wC=It(iC.prototype,"lbScore",[$T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),TC=It(iC.prototype,"animationpanelViewEndGame",[tC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),eC=iC))||eC);t._RF.pop(),t._RF.push({},"45a40DVOmVEmZ1gYYVdrIOV","KaraokeGameplayController",void 0);var jC,KC,XC,JC,QC,$C,tE,eE,iE,nE,oE,rE,aE,sE=e.ccclass,lE=e.property;AC=sE("KaraokeGameplayController"),PC=lE({type:IT,tooltip:"Node containing KaraokePitchDetectionSystem component",group:{name:"Systems",id:"systems"}}),MC=lE({type:LT,tooltip:"Node containing KaraokeLyricsManager component",group:{name:"Systems",id:"systems"}}),IC=lE({type:wT,tooltip:"Node containing KaraokeAudioManager component",group:{name:"Systems",id:"systems"}}),NC=lE({type:AT,tooltip:"Node containing KaraokeCharacterAnimator component",group:{name:"Systems",id:"systems"}}),OC=lE({type:EC,tooltip:"Node containing KaraokeScoringSystem component",group:{name:"Systems",id:"systems"}}),LC=lE({type:YC,tooltip:"Node containing KaraokeUIManager component",group:{name:"Systems",id:"systems"}}),RC=lE({tooltip:"Whether to autostart microphone access on initialization",group:{name:"Config",id:"config"}}),xC=lE({tooltip:"Path to default song to load (can be empty)",group:{name:"Config",id:"config"}}),AC((zC=It((DC=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,Ot(e,"pitchDetection",zC,Lt(e)),Ot(e,"lyricsManager",kC,Lt(e)),Ot(e,"audioManager",VC,Lt(e)),Ot(e,"characterAnimator",BC,Lt(e)),Ot(e,"scoringSystem",HC,Lt(e)),Ot(e,"uiManager",UC,Lt(e)),Ot(e,"autoInitMicrophone",GC,Lt(e)),Ot(e,"defaultSongPath",WC,Lt(e)),e.state=oT.INIT,e.currentSong=null,e.microphoneInitialized=!1,e.isLyricActive=!1,e.availableSongs=[{id:"TrongCom_ATVNCG",title:"Trống Cơm",artist:"ATVNCG",bpm:86,musicPath:"TrongCom_ATVNCG",lyricPath:"trongcom",lyrics:[],duration:254,difficulty:1,previewStart:0,previewEnd:1e4}],e}Nt(e,t);var i=e.prototype;return i.onLoad=function(){var t=Rt(xt().mark((function t(){return xt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.initializeSubsystems(),this.setupEventListeners(),this.changeState(oT.INIT),!this.autoInitMicrophone){t.next=6;break}return t.next=6,this.initializeMicrophone();case 6:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),i.start=function(){this.loadSong(this.availableSongs[0])},i.onDestroy=function(){this.removeEventListeners()},i.update=function(t){if(this.audioManager&&this.state===oT.PLAYING){var e=this.audioManager.getCurrentTime();this.lyricsManager&&this.lyricsManager.updateTime(e),this.scoringSystem&&this.scoringSystem.updateTime(e),this.uiManager&&this.uiManager.updateTimer(e,this.getCurrentPlaybackTime())}},i.initializeMicrophone=function(){var t=Rt(xt().mark((function t(){return xt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.microphoneInitialized){t.next=2;break}return t.abrupt("return",!0);case 2:if(this.pitchDetection){t.next=5;break}return console.error("Pitch detection system not found"),t.abrupt("return",!1);case 5:return t.prev=5,t.next=8,this.pitchDetection.initialize();case 8:if(t.sent){t.next=12;break}return console.error("Failed to initialize pitch detection"),t.abrupt("return",!1);case 12:return t.next=14,this.pitchDetection.requestMicrophoneAccess();case 14:if(t.sent){t.next=18;break}return console.error("Failed to access microphone"),t.abrupt("return",!1);case 18:return this.microphoneInitialized=!0,t.abrupt("return",!0);case 22:return t.prev=22,t.t0=t.catch(5),console.error("Error initializing microphone:",t.t0),t.abrupt("return",!1);case 26:case"end":return t.stop()}}),t,this,[[5,22]])})));return function(){return t.apply(this,arguments)}}(),i.loadSong=function(){var t=Rt(xt().mark((function t(e){var i,n,o,r,a,s;return xt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.changeState(oT.LOADING),t.prev=1,i=e){t.next=6;break}return this.changeState(oT.INIT),t.abrupt("return",!1);case 6:return t.prev=6,t.next=9,this.lyricsManager.loadLyrics(i);case 9:if(n=t.sent,this.currentSong=n,o=0,n.lyrics&&n.lyrics.length>0)for(r=Dt(n.lyrics);!(a=r()).done;)s=a.value,o+=s.endTime-s.startTime;return this.scoringSystem&&this.scoringSystem.setTotalLyricsDuration(o),console.log("Total lyrics interaction duration: "+o.toFixed(2)+" seconds"),t.next=17,this.audioManager.loadAudio(Jp.getBeatmapPath(n));case 17:return this.uiManager&&this.uiManager.createLyricLabels(n.lyrics),this.changeState(oT.READY),t.abrupt("return",!0);case 22:return t.prev=22,t.t0=t.catch(6),console.error("Error loading lyrics:",t.t0),this.currentSong=i,this.lyricsManager.setLyrics([]),t.next=29,this.audioManager.loadAudio(Jp.getBeatmapPath(i));case 29:return this.changeState(oT.READY),t.abrupt("return",!0);case 31:t.next=38;break;case 33:return t.prev=33,t.t1=t.catch(1),console.error("Error loading song:",t.t1),this.changeState(oT.INIT),t.abrupt("return",!1);case 38:case"end":return t.stop()}}),t,this,[[1,33],[6,22]])})));return function(e){return t.apply(this,arguments)}}(),i.startPlayback=function(){var t=this;this.state===oT.READY||this.state===oT.PAUSED?this.microphoneInitialized?this.uiManager&&this.state===oT.READY?this.uiManager.startCountdown((function(){t.actuallyStartPlayback()})):this.actuallyStartPlayback():console.warn("Microphone not initialized, cannot start playback"):console.warn("Cannot start playback in current state")},i.actuallyStartPlayback=function(){this.pitchDetection.startDetection(),this.audioManager.startPlayback(),this.lyricsManager.startPlayback(),this.scoringSystem.startScoring(),this.uiManager&&this.currentSong&&this.uiManager.startTimer(this.currentSong.duration),this.changeState(oT.PLAYING)},i.pausePlayback=function(){this.state===oT.PLAYING?(this.audioManager.pausePlayback(),this.lyricsManager.pausePlayback(),this.changeState(oT.PAUSED)):console.warn("Cannot pause playback in current state")},i.resumePlayback=function(){this.state===oT.PAUSED?(this.audioManager.resumePlayback(),this.lyricsManager.resumePlayback(),this.changeState(oT.PLAYING)):console.warn("Cannot resume playback in current state")},i.stopPlayback=function(){this.state===oT.PLAYING||this.state===oT.PAUSED?(this.pitchDetection.stopDetection(),this.audioManager.stopPlayback(),this.lyricsManager.stopPlayback(),this.scoringSystem.stopScoring(),this.characterAnimator.playIdle(),this.uiManager&&this.uiManager.stopTimer(),this.changeState(oT.READY)):console.warn("Cannot stop playback in current state")},i.getState=function(){return this.state},i.getCurrentSong=function(){return this.currentSong},i.getCurrentPlaybackTime=function(){return!this.audioManager||this.state!==oT.PLAYING&&this.state!==oT.PAUSED?0:this.audioManager.getCurrentTime()},i.handleExitRequest=function(){this.state!==oT.PLAYING&&this.state!==oT.PAUSED||this.stopPlayback(),console.log("Exiting karaoke mode")},i.initializeSubsystems=function(){this.pitchDetection||console.warn("Pitch detection system not found"),this.lyricsManager||console.warn("Lyrics manager not found"),this.audioManager||console.warn("Audio manager not found"),this.characterAnimator||console.warn("Character animator not found"),this.scoringSystem||console.warn("Scoring system not found"),this.uiManager||console.warn("UI manager not found")},i.setupEventListeners=function(){this.pitchDetection.on(aT.EVENTS.PITCH_DETECTED,this.onPitchDetected,this),this.lyricsManager.on(aT.EVENTS.LYRICS_UPDATED,this.onLyricsUpdated,this),this.audioManager.on(aT.EVENTS.SONG_ENDED,this.onSongEnded,this)},i.removeEventListeners=function(){this.pitchDetection.off(aT.EVENTS.PITCH_DETECTED,this.onPitchDetected,this),this.lyricsManager.off(aT.EVENTS.LYRICS_UPDATED,this.onLyricsUpdated,this),this.audioManager.off(aT.EVENTS.SONG_ENDED,this.onSongEnded,this)},i.changeState=function(t){if(t!==this.state&&(console.log("Karaoke state changed: "+oT[this.state]+" -> "+oT[t]),this.state=t,this.uiManager))switch(t){case oT.INIT:case oT.LOADING:this.uiManager.showLoadingState(!0);break;case oT.READY:this.uiManager.showLoadingState(!1),this.uiManager.showReadyState(),this.uiManager.stopTimer();break;case oT.PLAYING:this.uiManager.showPlayingState(),this.uiManager.resumeTimer();break;case oT.PAUSED:this.uiManager.showPausedState(),this.uiManager.pauseTimer();break;case oT.FINISHED:this.uiManager.showFinishedState(this.scoringSystem.getScore().score),this.uiManager.stopTimer()}},i.onPitchDetected=function(t){this.scoringSystem&&this.scoringSystem.updatePitchDetection(t),this.characterAnimator&&(t.detected?this.characterAnimator.playSinging():this.characterAnimator.playIdle()),this.uiManager&&this.uiManager.updateMicVisualization(t,this.pitchDetection)},i.onLyricsUpdated=function(t){var e=t.currentLyric,i=t.currentLyricIndex;this.isLyricActive=null!==e&&this.lyricsManager.isLyricActive(),this.scoringSystem&&this.scoringSystem.updateLyricStatus(this.isLyricActive),this.uiManager&&(this.isLyricActive?this.uiManager.updateLyrics(i):this.uiManager.hideLyricHighlight())},i.onSongEnded=function(){this.pitchDetection.stopDetection(),this.lyricsManager.stopPlayback(),this.scoringSystem.stopScoring(),this.characterAnimator.playIdle(),this.uiManager&&this.uiManager.stopTimer(),this.changeState(oT.FINISHED)},e}(r)).prototype,"pitchDetection",[PC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),kC=It(DC.prototype,"lyricsManager",[MC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),VC=It(DC.prototype,"audioManager",[IC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),BC=It(DC.prototype,"characterAnimator",[NC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),HC=It(DC.prototype,"scoringSystem",[OC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),UC=It(DC.prototype,"uiManager",[LC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),GC=It(DC.prototype,"autoInitMicrophone",[RC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),WC=It(DC.prototype,"defaultSongPath",[xC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),FC=DC));t._RF.pop(),t._RF.push({},"b6ce0GHy0pHfJFBAfxbueVI","KaraokeUILyric",void 0);var cE,uE,hE,pE,dE,fE,gE,mE,vE,yE,bE,_E,SE,wE=e.ccclass,TE=e.property;jC=wE("KaraokeUILyric"),KC=TE({type:y,tooltip:"Label component for the lyric"}),XC=TE({tooltip:"Duration of fade out animation in seconds"}),JC=TE({tooltip:"Color for current lyric"}),QC=TE({tooltip:"Color for past lyric"}),$C=TE({tooltip:"Color for future lyric"}),jC((iE=It((eE=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,Ot(e,"label",iE,Lt(e)),Ot(e,"fadeOutDuration",nE,Lt(e)),Ot(e,"currentColor",oE,Lt(e)),Ot(e,"pastColor",rE,Lt(e)),Ot(e,"futureColor",aE,Lt(e)),e._index=-1,e._isInUse=!1,e._currentTween=null,e._uiOpacity=null,e}Nt(e,t);var i=e.prototype;return i.onLoad=function(){this._uiOpacity=this.getComponent(b),this._uiOpacity||(this._uiOpacity=this.addComponent(b))},i.init=function(t,e){this._index=e,this._isInUse=!0,this.stopFadeAnimation(),this._uiOpacity&&(this._uiOpacity.opacity=255),this.label&&(this.label.string=t)},i.setHighlightState=function(t){if(this.label)switch(t){case"current":this.label.color=this.currentColor,this.label.isBold=!0;break;case"past":this.label.color=this.pastColor,this.label.isBold=!1;break;case"future":this.label.color=this.futureColor,this.label.isBold=!1}},i.fadeOut=function(t){var e=this;this.stopFadeAnimation(),this._uiOpacity||(this._uiOpacity=this.getComponent(b),this._uiOpacity||(this._uiOpacity=this.addComponent(b))),this._currentTween=v(this._uiOpacity).to(this.fadeOutDuration,{opacity:0}).call((function(){e._currentTween=null,t&&t()})).start()},i.stopFadeAnimation=function(){this._currentTween&&(this._currentTween.stop(),this._currentTween=null)},i.getHeight=function(){return this.getAccurateHeight()},i.getAccurateHeight=function(){this.label&&this.label.updateRenderData(!0);var t=this.getComponent(B);return t?t.height:50},i.getIndex=function(){return this._index},i.isInUse=function(){return this._isInUse},i.recycle=function(){this.stopFadeAnimation(),this._uiOpacity&&(this._uiOpacity.opacity=255),this._isInUse=!1,this._index=-1},i.getHeightNextFrame=function(t){var e=this;this.scheduleOnce((function(){var i=e.getComponent(B),n=i?i.height:50;t(n)}),0)},e}(r)).prototype,"label",[KC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),nE=It(eE.prototype,"fadeOutDuration",[XC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),oE=It(eE.prototype,"currentColor",[JC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new X(255,255,255,255)}}),rE=It(eE.prototype,"pastColor",[QC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new X(136,136,136,255)}}),aE=It(eE.prototype,"futureColor",[$C],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new X(204,204,204,255)}}),tE=eE));t._RF.pop(),t._RF.push({},"dd74eu3S4NEpap53qs6fEO1","MTItemSong",void 0);var CE,EE,AE=e.ccclass,PE=e.property,ME=(cE=AE("MTItemSong"),uE=PE(y),hE=PE(y),pE=PE(y),dE=PE(x),fE=PE(f),cE((vE=It((mE=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,Ot(e,"songNameLabel",vE,Lt(e)),Ot(e,"artistLabel",yE,Lt(e)),Ot(e,"difficultyLabel",bE,Lt(e)),Ot(e,"selectButton",_E,Lt(e)),Ot(e,"coverSprite",SE,Lt(e)),e.songData=null,e.selectionCallback=null,e}Nt(e,t);var i=e.prototype;return i.start=function(){this.selectButton&&this.selectButton.node.on("click",this.onSongSelected,this)},i.setSongData=function(t,e){this.songData=t,this.selectionCallback=e,this.songNameLabel&&(this.songNameLabel.string=t.title||"Unknown Title"),this.artistLabel&&(this.artistLabel.string=t.artist||"Unknown Artist"),this.difficultyLabel&&(this.difficultyLabel.string="Difficulty: 'Medium'"),this.coverSprite&&t.thumbnail},i.onSongSelected=function(){this.selectionCallback&&this.songData&&this.selectionCallback(this.songData)},i.update=function(t){},e}(r)).prototype,"songNameLabel",[uE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),yE=It(mE.prototype,"artistLabel",[hE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),bE=It(mE.prototype,"difficultyLabel",[pE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_E=It(mE.prototype,"selectButton",[dE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),SE=It(mE.prototype,"coverSprite",[fE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),gE=mE))||gE);t._RF.pop(),t._RF.push({},"f80292EF6FHTqlNZTog+XHg","MTAudioManager",void 0);var IE,NE,OE=e.ccclass,LE=(e.property,OE("MTAudioManager")(((EE=function(){function t(){this.commonAudioManager=ji.instance,this._beatmapAudioSource=null,this._currentBeatmap=null,this._beatCallbacks=[],this._isBuffering=!1,this._playbackTimer=0,this.audioTimeEstimation=0,this.lastSystemTime=0,this._timeCheckCounter=0,this._timeCheckInterval=30,this.init()}var e=t.prototype;return e.init=function(){var t=new c("beatmap-audio");M.getScene().addChild(t),this._beatmapAudioSource=t.addComponent(N)},e.loadBeatmapAudioData=function(){var t=Rt(xt().mark((function t(e,i,n){var o,r,a;return xt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return void 0===n&&(n=1),this._isBuffering=!0,t.prev=2,t.next=5,Promise.all([this.loadAudioClip(e),de(i,n)]);case 5:return o=t.sent,r=o[0],a=o[1],this._currentBeatmap={clip:r,trackInfo:a,totalDuration:r.getDuration(),currentTime:0,isPlaying:!1,isPaused:!1},this._beatmapAudioSource.clip=r,this._beatmapAudioSource.volume=1,this._isBuffering=!1,t.abrupt("return",this._currentBeatmap);case 15:return t.prev=15,t.t0=t.catch(2),console.error("Failed to load beatmap audio:",t.t0),this._isBuffering=!1,t.abrupt("return",null);case 20:case"end":return t.stop()}}),t,this,[[2,15]])})));return function(e,i,n){return t.apply(this,arguments)}}(),e.setCurrentBeatmap=function(t){this._currentBeatmap=t,this._beatmapAudioSource.clip=t.clip,this._beatmapAudioSource.volume=1,this._isBuffering=!1},e.loadAudioClip=function(t){return new Promise((function(e,i){$e.loadRes(t,O,(function(t,n){t?i(t):e(n)}))}))},e.playBeatmapAudio=function(t){void 0===t&&(t=0),this._currentBeatmap&&!this._isBuffering?(this._currentBeatmap.currentTime=t,this._currentBeatmap.isPlaying=!0,this._currentBeatmap.isPaused=!1,this._beatmapAudioSource.currentTime=t,this._beatmapAudioSource.play()):console.warn("No beatmap loaded or still buffering")},e.getEstimatedAudioTime=function(){var t=Date.now()/1e3;if(!this.lastSystemTime)return this.lastSystemTime=t,this.audioTimeEstimation=this._beatmapAudioSource.currentTime,this.audioTimeEstimation;var e=t-this.lastSystemTime;if(this.audioTimeEstimation+=e,this._timeCheckCounter++%this._timeCheckInterval==0){var i=this._beatmapAudioSource.currentTime;this.audioTimeEstimation=.95*this.audioTimeEstimation+.05*i}return this.lastSystemTime=t,this.audioTimeEstimation},e.getAudioTime=function(){return this._beatmapAudioSource.currentTime},e.pauseBeatmapAudio=function(){this._currentBeatmap&&this._currentBeatmap.isPlaying&&(this._beatmapAudioSource.pause(),this._currentBeatmap.isPaused=!0,this._currentBeatmap.isPlaying=!1)},e.resumeBeatmapAudio=function(){this._currentBeatmap&&this._currentBeatmap.isPaused&&(this._beatmapAudioSource.play(),this._currentBeatmap.isPaused=!1,this._currentBeatmap.isPlaying=!0)},e.stopBeatmapAudio=function(){this._currentBeatmap&&(this._beatmapAudioSource.stop(),this._currentBeatmap.isPlaying=!1,this._currentBeatmap.isPaused=!1,this._currentBeatmap.currentTime=0)},e.getCurrentTime=function(){return this._currentBeatmap?this._beatmapAudioSource.currentTime:0},e.getTotalDuration=function(){return this._currentBeatmap?this._currentBeatmap.totalDuration:0},e.onBeat=function(t){this._beatCallbacks.push(t)},e.offBeat=function(t){var e=this._beatCallbacks.indexOf(t);-1!==e&&this._beatCallbacks.splice(e,1)},e.startBeatTracking=function(){var t=this;if(this._currentBeatmap&&this._currentBeatmap.trackInfo.notes){this.stopBeatTracking();var e=this._currentBeatmap.trackInfo.notes,i=0;requestAnimationFrame((function n(){if(t._currentBeatmap&&t._currentBeatmap.isPlaying){for(var o=t._beatmapAudioSource.currentTime;i<e.length&&e[i].time<=o;)t._beatCallbacks.forEach((function(t){t(e[i])})),i++;requestAnimationFrame(n)}}))}},e.stopBeatTracking=function(){this._currentBeatmap&&(this._currentBeatmap.isPlaying=!1)},e.setMusicVolume=function(t){this._beatmapAudioSource.volume=t},e.getMusicVolume=function(){return this._beatmapAudioSource.volume},e.isBuffering=function(){return this._isBuffering},e.isPlaying=function(){return!!this._currentBeatmap&&this._currentBeatmap.isPlaying},e.isPaused=function(){return!!this._currentBeatmap&&this._currentBeatmap.isPaused},e.playSound=function(t,e){var i;return void 0===e&&(e=1),null==(i=this.commonAudioManager)?void 0:i.playSound(t,e)},e.createBeatmapAudioDataFromAssets=function(){var t=Rt(xt().mark((function t(e,i){return xt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this._isBuffering=!0,t.prev=1,this._currentBeatmap={clip:e,trackInfo:i,totalDuration:e.getDuration(),currentTime:0,isPlaying:!1,isPaused:!1},this._beatmapAudioSource.clip=e,this._beatmapAudioSource.volume=1,this._isBuffering=!1,t.abrupt("return",this._currentBeatmap);case 9:return t.prev=9,t.t0=t.catch(1),console.error("Failed to create beatmap audio from assets:",t.t0),this._isBuffering=!1,t.abrupt("return",null);case 14:case"end":return t.stop()}}),t,this,[[1,9]])})));return function(e,i){return t.apply(this,arguments)}}(),e.deinit=function(){this._beatmapAudioSource&&this._beatmapAudioSource.stop(),this._currentBeatmap=null,this._beatCallbacks=[],this._isBuffering=!1,this._playbackTimer=0,this.audioTimeEstimation=0,this.lastSystemTime=0,this._timeCheckCounter=0,t._instance=null},Ft(t,null,[{key:"instance",get:function(){return this._instance||(this._instance=new t),this._instance}}]),t}())._instance=null,CE=EE))||CE);t._RF.pop(),t._RF.push({},"f0997PWuMBCn4LtP5qegoPj","BeatmapManager",void 0);var RE,xE,FE,DE,zE,kE,VE,BE,HE,UE,GE,WE,qE,ZE,YE,jE,KE,XE,JE,QE,$E,tA,eA,iA,nA=e.ccclass,oA=(e.property,nA("BeatmapManager")(((NE=function(){function t(){this.audioManager=LE.instance,this.beatmaps=new Map,this.activeBeatmap=null,this.beatmapDirectory="magic_tiles/beatmaps",this.maxLanes=4,this.init()}var e=t.prototype;return e.init=function(){console.log("BeatmapManager initialized")},e.loadSong=function(){var t=Rt(xt().mark((function t(e){var i;return xt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.beatmaps.has(e.id)){t.next=3;break}return this.activeBeatmap=this.beatmaps.get(e.id),t.abrupt("return",this.activeBeatmap);case 3:return t.prev=3,i=this.validateBeatmap(e),this.beatmaps.set(e.id,i),this.activeBeatmap=i,t.abrupt("return",i);case 10:return t.prev=10,t.t0=t.catch(3),console.error("Failed to load beatmap "+e.id+":",t.t0),t.abrupt("return",null);case 14:case"end":return t.stop()}}),t,this,[[3,10]])})));return function(e){return t.apply(this,arguments)}}(),e.validateBeatmap=function(t){return{song:t,notes:[]}},e.updateNotes=function(t,e){if(this.beatmaps.has(t)){var i=this.beatmaps.get(t);return i.notes=this.convertNotes(e,i.notes),this.beatmaps.set(t,i),i}return null},e.convertNotes=function(t,e){void 0===e&&(e=[]);var i,n=t.length;if(e.length>=n){for(var o=0;o<n;o++){var r=t[o];e[o].midi=r.midi,e[o].time=r.time,e[o].lane=this.getLandById(r.midi),e[o].duration=r.duration,e[o].durationTicks=r.durationTicks,e[o].velocity=r.velocity,e[o].type=this.getNoteType(r)}e.length>n&&(e.length=n),i=e}else{i=new Array(n);for(var a=0;a<n;a++){var s=t[a];a<e.length?(i[a]=e[a],i[a].midi=s.midi,i[a].time=s.time,i[a].lane=this.getLandById(s.midi),i[a].duration=s.duration,i[a].durationTicks=s.durationTicks,i[a].velocity=s.velocity,i[a].type=this.getNoteType(s)):i[a]={midi:s.midi,time:s.time,lane:this.getLandById(s.midi),duration:s.duration,durationTicks:s.durationTicks,velocity:s.velocity,type:this.getNoteType(s)}}}i.sort((function(t,e){return t.time-e.time}));for(var l=0;l<i.length-1;l++){var c=i[l],u=i[l+1];u.time===c.time&&l+2<i.length&&(u=i[l+2]),c.type!==Cd.HOLD&&(c.duration=Math.min(u.time-c.time,.23))}if(i.length>0){var h=i[i.length-1];h.type!==Cd.HOLD&&h.duration<=0&&(h.duration=.2)}return i},e.getLandById=function(t){return t-96},e.getNoteType=function(t){return t.duration>.3?Cd.HOLD:Cd.TAP},e.loadJsonAsset=function(t){return new Promise((function(e,i){$e.loadRes(t,bt,(function(n,o){n?i(n):o?e(o.json):i(new Error("JSON asset not found at path: "+t))}))}))},e.loadBeatmapAudioData=function(){var t=Rt(xt().mark((function t(){var e;return xt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.activeBeatmap){t.next=3;break}return console.error("No active beatmap to load audio for"),t.abrupt("return",null);case 3:return t.prev=3,e=this.activeBeatmap.song,t.next=7,this.audioManager.loadBeatmapAudioData(ed.getMusicPath(e),td.getMidiPath(e));case 7:return t.abrupt("return",t.sent);case 10:return t.prev=10,t.t0=t.catch(3),console.error("Failed to load beatmap audio:",t.t0),t.abrupt("return",null);case 14:case"end":return t.stop()}}),t,this,[[3,10]])})));return function(){return t.apply(this,arguments)}}(),e.getActiveBeatmap=function(){return this.activeBeatmap},e.getNotes=function(){return this.activeBeatmap?this.activeBeatmap.notes:[]},e.calculateDifficulty=function(t){var e=t.notes;if(!e.length)return 1;for(var i=e[e.length-1].time-e[0].time,n=e.length/(i||1),o=e.filter((function(t){return t.type!==Cd.TAP})).length/e.length,r=0,a=1;a<e.length;a++)e[a].lane!==e[a-1].lane&&r++;for(var s=r/(e.length-1),l=0,c=1;c<e.length;c++){e[c].time-e[c-1].time<.3&&l++}var u=1+.5*n+2*o+2*s+3*(l/(e.length-1));return Math.min(Math.round(10*u)/10,10)},e.getBeatmapPreview=function(t){var e=this.beatmaps.get(t);if(!e)return[];var i=e.song,n=i.previewStart,o=i.previewEnd;return e.notes.filter((function(t){return t.time>=n&&t.time<=o}))},e.validateCustomBeatmap=function(t){try{return this.validateBeatmap(t)}catch(t){return console.error("Invalid custom beatmap format:",t),null}},e.addTempBeatmap=function(t,e){return this.beatmaps.set(t,e),this.activeBeatmap=e,e},e.deinit=function(){this.beatmaps.clear(),this.activeBeatmap=null,console.log("BeatmapManager deinitializing..."),t._instance=null},Ft(t,null,[{key:"instance",get:function(){return this._instance||(this._instance=new t),this._instance}}]),t}())._instance=null,IE=NE))||IE);t._RF.pop(),t._RF.push({},"0693cAdL+JB3Jn4GXrhDvzS","Tile",void 0);var rA,aA,sA,lA,cA,uA,hA,pA,dA,fA,gA,mA,vA,yA,bA,_A,SA,wA,TA,CA,EA,AA,PA,MA,IA,NA,OA,LA,RA,xA,FA,DA,zA,kA,VA,BA,HA,UA,GA,WA,qA,ZA,YA,jA,KA,XA,JA,QA,$A,tP,eP,iP,nP=e.ccclass,oP=e.property,rP=function(t){return t[t.WAITING=0]="WAITING",t[t.ACTIVE=1]="ACTIVE",t[t.HOLDING=2]="HOLDING",t[t.HIT=3]="HIT",t[t.MISSED=4]="MISSED",t[t.EXPIRED=5]="EXPIRED",t}({}),aP=function(t){return t[t.PERFECT=0]="PERFECT",t[t.GREAT=1]="GREAT",t[t.COOL=2]="COOL",t[t.MISS=3]="MISS",t}({}),sP=(RE=nP("Tile"),xE=oP(f),FE=oP(B),DE=oP(b),zE=oP(c),kE=oP({type:c,group:{name:"Long Press"}}),VE=oP({type:c,group:{name:"Long Press"}}),BE=oP({type:B,group:{name:"Long Press"}}),RE(((iA=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,Ot(e,"background",GE,Lt(e)),Ot(e,"transform",WE,Lt(e)),Ot(e,"opacity",qE,Lt(e)),Ot(e,"bufferHeight",ZE,Lt(e)),Ot(e,"nodeBeginning",YE,Lt(e)),Ot(e,"nodeLongPress",jE,Lt(e)),Ot(e,"nodeHoldEffect",KE,Lt(e)),Ot(e,"holdEffectTransform",XE,Lt(e)),Ot(e,"normalColor",JE,Lt(e)),Ot(e,"holdColor",QE,Lt(e)),Ot(e,"slideColor",$E,Lt(e)),Ot(e,"hitColor",tA,Lt(e)),Ot(e,"missColor",eA,Lt(e)),e.noteData=null,e.status=rP.WAITING,e.startY=0,e.targetY=0,e.lane=0,e.scrollSpeed=0,e.spawnTime=0,e.hitTime=0,e.touchStartTime=0,e.touchEndTime=0,e.isTouching=!1,e.isLongPress=!1,e.isSliding=!1,e.moveTween=null,e.scaleTween=null,e.opacityTween=null,e.holdRating=aP.MISS,e.movementStartTime=0,e.movementDuration=0,e.movementStartY=0,e.movementTargetY=0,e.isMovementActive=!1,e.tempVec3=new g,e.updatePriority=0,e.frameCounter=0,e.holdRange=0,e}Nt(e,t);var i=e.prototype;return i.onLoad=function(){this.background||(this.background=this.getComponent(f)),this.transform||(this.transform=this.getComponent(B)),this.opacity||(this.opacity=this.getComponent(b)),this.nodeHoldEffect&&!this.holdEffectTransform&&(this.holdEffectTransform=this.nodeHoldEffect.getComponent(B))},i.init=function(t,e,i,n,o,r,a){this.noteData=t,this.lane=e,this.startY=i,this.targetY=n,this.scrollSpeed=r,this.status=rP.WAITING,this.holdRange=0,this.isTouching=!1,this.touchStartTime=0,this.touchEndTime=0,this.node.position=new g(0,i,0),this.moveTween&&(this.moveTween.stop(),this.moveTween=null),this.scaleTween&&(this.scaleTween.stop(),this.scaleTween=null),this.opacityTween&&(this.opacityTween.stop(),this.opacityTween=null),this.background.color=this.normalColor,this.opacity.opacity=255;var s=t.duration*r;this.transform.contentSize=new tt(o,Math.max(s,a)),this.transform.node.position=new g(0,-this.bufferHeight,0),this.nodeBeginning.active=!1,t.type===Cd.HOLD&&t.duration>0?(this.isLongPress=!0,this.setLongPressNodeActive(!0),this.nodeHoldEffect&&(this.nodeHoldEffect.active=!1),this.holdEffectTransform&&(this.holdEffectTransform.height=0)):(this.isLongPress=!1,this.setLongPressNodeActive(!1)),t.type===Cd.SLIDE?this.isSliding=!0:this.isSliding=!1,this.node.active=!0},i.setBeginningNodeActive=function(t){this.nodeBeginning.active=t},i.setLongPressNodeActive=function(t){this.nodeLongPress.active=t},i.getTileHeight=function(){return this.transform.contentSize.height},i.setBufferHeight=function(t){this.bufferHeight=t,this.transform.node.position=new g(0,-this.bufferHeight,0)},i.startMovement=function(t,e){this.status=rP.ACTIVE,this.spawnTime=Date.now()/1e3;var i=this.targetY-(t*this.scrollSpeed-(this.startY-this.targetY));this.movementStartTime=e,this.movementDuration=t,this.movementStartY=this.node.position.y,this.movementTargetY=i,this.isMovementActive=!0,this.moveTween&&(this.moveTween.stop(),this.moveTween=null)},i.setUpdatePriority=function(t){this.updatePriority=t},i.update=function(t){this.updatePriority>0&&(this.frameCounter=(this.frameCounter+1)%(this.updatePriority+1),0!==this.frameCounter)||(this.isMovementActive&&this.updateTileMovement(),this.status===rP.HOLDING&&this.isLongPress&&this.nodeHoldEffect&&this.updateHoldEffect(t))},i.updateTileMovement=function(){var t=this.calculateCurrentTime()-this.movementStartTime,e=Math.min(1,t/this.movementDuration),i=this.movementStartY+(this.movementTargetY-this.movementStartY)*e;return this.tempVec3.set(0,i,0),this.node.position=this.tempVec3,e>=1&&(this.isMovementActive=!1),i},i.calculateCurrentTime=function(){return Date.now()/1e3-this.spawnTime+this.movementStartTime},i.tap=function(t){if(!this.noteData||this.status!==rP.ACTIVE)return aP.MISS;this.touchStartTime=t,this.isTouching=!0;var e,i=this.noteData.time,n=Math.abs(t-i),o=I.deltaTime,r=Math.min(Math.max(o/(1/60),1),3),a=.3*r,s=.5*r;return e=n<.1*r?aP.PERFECT:n<a?aP.GREAT:n<s?aP.COOL:aP.MISS,this.noteData.type===Cd.TAP?this.completeHit(e):this.noteData.type===Cd.HOLD&&this.triggerLongPress(e),e},i.release=function(t){if(!this.isTouching||!this.isLongPress||!this.noteData)return aP.MISS;if(this.touchEndTime=t,this.isTouching=!1,this.noteData.type===Cd.HOLD){var e=this.noteData.duration,i=this.touchEndTime-this.touchStartTime,n=I.deltaTime,o=Math.min(Math.max(n/(1/60),1),2),r=aP.COOL,a=i/e,s=.8/o;return a>=.95/o?r=aP.PERFECT:a>=s&&(r=aP.GREAT),this.completeHit(r),r}return aP.MISS},i.completeHit=function(t){t!==aP.MISS?(this.status=rP.HIT,this.playHitAnimation()):this.miss()},i.triggerLongPress=function(t){if(t!==aP.MISS){if(this.status=rP.HOLDING,this.holdRating=t,this.holdRange=Math.abs(this.node.position.y-this.targetY),this.nodeHoldEffect&&(this.nodeHoldEffect.active=!0,this.holdEffectTransform)){var e=this.holdEffectTransform.contentSize;this.holdEffectTransform.contentSize=new tt(e.width,0)}this.background.color=this.holdColor}else this.miss()},i.playHitAnimation=function(){this.background.color=this.normalColor,this.opacity.opacity=100},i.miss=function(){this.status=rP.MISSED,e.missCount++,this.background.color=this.missColor,this.opacityTween=v(this.opacity).to(.3,{opacity:100}).start()},i.getNote=function(){return this.noteData},i.getStatus=function(){return this.status},i.getLane=function(){return this.lane},i.isLongPressType=function(){return this.isLongPress},i.isSlideType=function(){return this.isSliding},i.recycle=function(){this.moveTween&&(this.moveTween.stop(),this.moveTween=null),this.scaleTween&&(this.scaleTween.stop(),this.scaleTween=null),this.opacityTween&&(this.opacityTween.stop(),this.opacityTween=null),this.status=rP.WAITING,this.noteData=null,this.isTouching=!1,this.isLongPress=!1,this.isSliding=!1,this.holdRange=0,this.nodeHoldEffect&&(this.nodeHoldEffect.active=!1),this.isMovementActive=!1,this.node.active=!1},i.updateHoldEffect=function(t){if(this.isTouching){this.holdRange=Math.min(this.holdRange+this.scrollSpeed*t,this.transform.contentSize.height-this.bufferHeight),this.nodeHoldEffect.active||(this.nodeHoldEffect.active=!0);var e=this.nodeHoldEffect.position,i=this.holdRange+this.bufferHeight;if(this.nodeHoldEffect.position=new g(e.x,i,e.z),this.holdEffectTransform){var n=this.holdEffectTransform.contentSize;this.holdEffectTransform.contentSize=new tt(n.width,i)}}},e}(r)).missCount=0,GE=It((UE=iA).prototype,"background",[xE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),WE=It(UE.prototype,"transform",[FE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),qE=It(UE.prototype,"opacity",[DE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ZE=It(UE.prototype,"bufferHeight",[oP],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 200}}),YE=It(UE.prototype,"nodeBeginning",[zE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),jE=It(UE.prototype,"nodeLongPress",[kE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),KE=It(UE.prototype,"nodeHoldEffect",[VE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),XE=It(UE.prototype,"holdEffectTransform",[BE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),JE=It(UE.prototype,"normalColor",[oP],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new X(0,0,0,255)}}),QE=It(UE.prototype,"holdColor",[oP],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new X(50,50,200,255)}}),$E=It(UE.prototype,"slideColor",[oP],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new X(50,200,50,255)}}),tA=It(UE.prototype,"hitColor",[oP],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new X(200,200,200,255)}}),eA=It(UE.prototype,"missColor",[oP],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new X(200,50,50,255)}}),HE=UE))||HE);t._RF.pop(),t._RF.push({},"974fdPppslMoKLXs565FEx6","MTUIManager",void 0);var lP,cP,uP,hP,pP,dP,fP,gP,mP,vP,yP,bP,_P,SP,wP,TP,CP=e.ccclass,EP=e.property,AP=function(t){return t[t.NONE=0]="NONE",t[t.MAIN_MENU=1]="MAIN_MENU",t[t.SONG_SELECT=2]="SONG_SELECT",t[t.GAMEPLAY=3]="GAMEPLAY",t[t.PAUSE_MENU=4]="PAUSE_MENU",t[t.RESULTS=5]="RESULTS",t[t.SETTINGS=6]="SETTINGS",t[t.TUTORIAL=7]="TUTORIAL",t[t.SHOP=8]="SHOP",t}({}),PP=(rA=CP("MTUIManager"),aA=EP(c),sA=EP(c),lA=EP(c),cA=EP(c),uA=EP(c),hA=EP(c),pA=EP(c),dA=EP(c),fA=EP(c),gA=EP(y),mA=EP(y),vA=EP(y),yA=EP(ut),bA=EP(f),_A=EP(y),SA=EP(y),wA=EP(y),TA=EP(y),CA=EP(y),EA=EP(y),AA=EP(y),PA=EP(y),MA=EP(y),rA(((iP=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,Ot(e,"mainMenuScreen",OA,Lt(e)),Ot(e,"songSelectScreen",LA,Lt(e)),Ot(e,"gameplayScreen",RA,Lt(e)),Ot(e,"pauseMenuScreen",xA,Lt(e)),Ot(e,"resultsScreen",FA,Lt(e)),Ot(e,"settingsScreen",DA,Lt(e)),Ot(e,"tutorialScreen",zA,Lt(e)),Ot(e,"shopScreen",kA,Lt(e)),Ot(e,"loadingScreen",VA,Lt(e)),Ot(e,"scoreLabel",BA,Lt(e)),Ot(e,"songTimeLabel",HA,Lt(e)),Ot(e,"comboLabel",UA,Lt(e)),Ot(e,"progressBar",GA,Lt(e)),Ot(e,"healthBar",WA,Lt(e)),Ot(e,"songTitleLabel",qA,Lt(e)),Ot(e,"songArtistLabel",ZA,Lt(e)),Ot(e,"finalScoreLabel",YA,Lt(e)),Ot(e,"accuracyLabel",jA,Lt(e)),Ot(e,"maxComboLabel",KA,Lt(e)),Ot(e,"perfectCountLabel",XA,Lt(e)),Ot(e,"goodCountLabel",JA,Lt(e)),Ot(e,"okCountLabel",QA,Lt(e)),Ot(e,"missCountLabel",$A,Lt(e)),Ot(e,"transitionDuration",tP,Lt(e)),Ot(e,"popupScaleDuration",eP,Lt(e)),e.currentUIState=AP.NONE,e.previousUIState=AP.NONE,e.isTransitioning=!1,e.audioManager=null,e.screenWidth=0,e.screenHeight=0,e.safeAreaTop=0,e.safeAreaBottom=0,e.isPortrait=!0,e}Nt(e,t);var i=e.prototype;return i.onLoad=function(){e._instance=this,this.audioManager=LE.instance,this.initializeUI(),Y.on("design-resolution-changed",this.onScreenResize,this),Y.on("canvas-resize",this.onScreenResize,this),this.onScreenResize()},i.onDestroy=function(){Y.off("design-resolution-changed",this.onScreenResize,this),Y.off("canvas-resize",this.onScreenResize,this),e._instance===this&&(e._instance=null)},i.initializeUI=function(){this.hideAllScreens(),this.changeUIState(AP.MAIN_MENU)},i.onScreenResize=function(){var t=Y.getVisibleSize();if(this.screenWidth=t.width,this.screenHeight=t.height,this.isPortrait=this.screenHeight>this.screenWidth,S.platform===S.Platform.MOBILE_BROWSER||S.platform===S.Platform.IOS||S.platform===S.Platform.ANDROID){var e=S.getSafeAreaRect();this.safeAreaTop=e.y,this.safeAreaBottom=t.height-(e.y+e.height)}this.adjustLayoutForScreenSize()},i.adjustLayoutForScreenSize=function(){this.updateWidgetsInNode(this.node),this.isPortrait?this.applyPortraitLayout():this.applyLandscapeLayout()},i.applyPortraitLayout=function(){if(this.scoreLabel&&(this.scoreLabel.node.position=new g(0,.4*this.screenHeight,0)),this.comboLabel&&(this.comboLabel.node.position=new g(0,.3*this.screenHeight,0)),this.progressBar){var t=this.progressBar.getComponent(B);t&&(t.width=.8*this.screenWidth)}console.log("Applied portrait layout")},i.applyLandscapeLayout=function(){if(this.scoreLabel&&(this.scoreLabel.node.position=new g(.3*this.screenWidth,.4*this.screenHeight,0)),this.comboLabel&&(this.comboLabel.node.position=new g(.3*this.screenWidth,.3*this.screenHeight,0)),this.progressBar){var t=this.progressBar.getComponent(B);t&&(t.width=.6*this.screenWidth)}console.log("Applied landscape layout")},i.updateWidgetsInNode=function(t){var e=t.getComponent(Z);e&&e.updateAlignment();for(var i=0;i<t.children.length;i++)this.updateWidgetsInNode(t.children[i])},i.changeUIState=function(t){var e=this;if(!this.isTransitioning&&t!==this.currentUIState){this.isTransitioning=!0,this.previousUIState=this.currentUIState,this.currentUIState=t;var i=this.getScreenForState(this.previousUIState);if(i)v(i).to(this.transitionDuration/2,{scale:new g(.9,.9,1)}).call((function(){i.active=!1;var n=e.getScreenForState(t);n?(n.active=!0,n.scale=new g(.9,.9,1),v(n).to(e.transitionDuration/2,{scale:new g(1,1,1)}).call((function(){e.isTransitioning=!1,e.onUIStateChanged(t)})).start()):e.isTransitioning=!1})).start();else{var n=this.getScreenForState(t);n?(n.active=!0,n.scale=new g(.9,.9,1),v(n).to(this.transitionDuration/2,{scale:new g(1,1,1)}).call((function(){e.isTransitioning=!1,e.onUIStateChanged(t)})).start()):this.isTransitioning=!1}}},i.getScreenForState=function(t){switch(t){case AP.MAIN_MENU:return this.mainMenuScreen;case AP.SONG_SELECT:return this.songSelectScreen;case AP.GAMEPLAY:return this.gameplayScreen;case AP.PAUSE_MENU:return this.pauseMenuScreen;case AP.RESULTS:return this.resultsScreen;case AP.SETTINGS:return this.settingsScreen;case AP.TUTORIAL:return this.tutorialScreen;case AP.SHOP:return this.shopScreen;default:return null}},i.onUIStateChanged=function(t){switch(t){case AP.MAIN_MENU:this.audioManager.playSound("menu_music");break;case AP.SONG_SELECT:break;case AP.GAMEPLAY:this.updateGameplayUI();break;case AP.RESULTS:}},i.hideAllScreens=function(){this.mainMenuScreen&&(this.mainMenuScreen.active=!1),this.songSelectScreen&&(this.songSelectScreen.active=!1),this.gameplayScreen&&(this.gameplayScreen.active=!1),this.pauseMenuScreen&&(this.pauseMenuScreen.active=!1),this.resultsScreen&&(this.resultsScreen.active=!1),this.settingsScreen&&(this.settingsScreen.active=!1),this.tutorialScreen&&(this.tutorialScreen.active=!1),this.shopScreen&&(this.shopScreen.active=!1),this.loadingScreen&&(this.loadingScreen.active=!1)},i.showLoadingScreen=function(t){this.loadingScreen&&(this.loadingScreen.active=t)},i.updateGameplayUI=function(){},i.updateScoreDisplay=function(t){this.scoreLabel&&(this.scoreLabel.string=t.toLocaleString())},i.updateSongTimeDisplay=function(t){this.songTimeLabel&&(this.songTimeLabel.string=this.formatTime(t))},i.formatTime=function(t){var e=Math.floor(t/60),i=Math.floor(t%60);return e+":"+(i<10?"0"+i:i)},i.updateComboDisplay=function(t){this.comboLabel&&(t>1?(this.comboLabel.string=t+"x",this.comboLabel.node.active=!0,v(this.comboLabel.node).to(.1,{scale:new g(1.2,1.2,1)}).to(.1,{scale:new g(1,1,1)}).start()):(this.comboLabel.string="",this.comboLabel.node.active=!1))},i.updateProgressBar=function(t){this.progressBar&&(this.progressBar.progress=t)},i.updateHealthBar=function(t){},i.prepareResultsScreen=function(t,e,i,n){if(void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n={perfect:0,good:0,ok:0,miss:0}),this.resultsScreen){this.finalScoreLabel&&(this.finalScoreLabel.string=t.toLocaleString()),this.accuracyLabel&&(this.accuracyLabel.string=e.toFixed(2)+"%"),this.maxComboLabel&&(this.maxComboLabel.string=i+"x"),this.perfectCountLabel&&(this.perfectCountLabel.string=n.perfect.toString()),this.goodCountLabel&&(this.goodCountLabel.string=n.good.toString()),this.okCountLabel&&(this.okCountLabel.string=n.ok.toString()),this.missCountLabel&&(this.missCountLabel.string=n.miss.toString());var o=this.resultsScreen.getChildByName("HighScoreLabel");o&&(o.active=!1)}},i.showPopup=function(t,e,i){var n,o,r,a;void 0===e&&(e=""),void 0===i&&(i="OK");var s=this.node.getChildByName("PopupTemplate");if(s){var l=E(s);l.parent=this.node,l.active=!0;var c=null==(n=l.getChildByName("Title"))?void 0:n.getComponent(y),u=null==(o=l.getChildByName("Message"))?void 0:o.getComponent(y),h=null==(r=l.getChildByName("OkButton"))?void 0:r.getComponent(x),p=null==h||null==(a=h.node.getChildByName("Label"))?void 0:a.getComponent(y);if(c&&(c.string=e,c.node.active=e.length>0),u&&(u.string=t),p&&(p.string=i),h){var d=new F;d.target=l,d.component="UIManager",d.handler="onPopupButtonClicked",h.clickEvents.push(d)}return l.scale=new g(.8,.8,1),v(l).to(this.popupScaleDuration,{scale:new g(1,1,1)}).start(),l}},i.closePopup=function(t){v(t).to(this.popupScaleDuration,{scale:new g(.8,.8,1)}).call((function(){t.destroy()})).start()},i.onPopupButtonClicked=function(t,e){var i=t.target;if(i){var n=i.parent;n&&this.closePopup(n)}},i.navigateToMainMenu=function(){this.changeUIState(AP.MAIN_MENU)},i.navigateToSongSelect=function(){this.changeUIState(AP.SONG_SELECT)},i.navigateToSettings=function(){this.changeUIState(AP.SETTINGS)},i.navigateToTutorial=function(){this.changeUIState(AP.TUTORIAL)},i.navigateToShop=function(){this.changeUIState(AP.SHOP)},i.handleBackNavigation=function(){switch(this.currentUIState){case AP.SONG_SELECT:case AP.SETTINGS:case AP.TUTORIAL:case AP.SHOP:this.navigateToMainMenu();break;case AP.GAMEPLAY:case AP.PAUSE_MENU:break;case AP.RESULTS:this.navigateToSongSelect()}},Ft(e,null,[{key:"instance",get:function(){return e._instance?e._instance:null}}]),e}(r))._instance=null,OA=It((NA=iP).prototype,"mainMenuScreen",[aA],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),LA=It(NA.prototype,"songSelectScreen",[sA],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),RA=It(NA.prototype,"gameplayScreen",[lA],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),xA=It(NA.prototype,"pauseMenuScreen",[cA],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),FA=It(NA.prototype,"resultsScreen",[uA],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),DA=It(NA.prototype,"settingsScreen",[hA],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),zA=It(NA.prototype,"tutorialScreen",[pA],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),kA=It(NA.prototype,"shopScreen",[dA],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),VA=It(NA.prototype,"loadingScreen",[fA],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),BA=It(NA.prototype,"scoreLabel",[gA],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),HA=It(NA.prototype,"songTimeLabel",[mA],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),UA=It(NA.prototype,"comboLabel",[vA],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),GA=It(NA.prototype,"progressBar",[yA],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),WA=It(NA.prototype,"healthBar",[bA],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),qA=It(NA.prototype,"songTitleLabel",[_A],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ZA=It(NA.prototype,"songArtistLabel",[SA],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),YA=It(NA.prototype,"finalScoreLabel",[wA],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),jA=It(NA.prototype,"accuracyLabel",[TA],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),KA=It(NA.prototype,"maxComboLabel",[CA],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),XA=It(NA.prototype,"perfectCountLabel",[EA],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),JA=It(NA.prototype,"goodCountLabel",[AA],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),QA=It(NA.prototype,"okCountLabel",[PA],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),$A=It(NA.prototype,"missCountLabel",[MA],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),tP=It(NA.prototype,"transitionDuration",[EP],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.3}}),eP=It(NA.prototype,"popupScaleDuration",[EP],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.2}}),IA=NA))||IA);t._RF.pop(),t._RF.push({},"bf871T6LV9LXZ2T/yZkKnKK","TileManager",void 0);var MP,IP,NP,OP,LP,RP,xP=e.ccclass,FP=e.property,DP=(lP=xP("TileManager"),cP=FP(l),uP=FP([c]),lP((dP=It((pP=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,Ot(e,"tilePrefab",dP,Lt(e)),Ot(e,"laneContainers",fP,Lt(e)),Ot(e,"spawnPositionY",gP,Lt(e)),Ot(e,"targetPositionY",mP,Lt(e)),Ot(e,"recyclePositionY",vP,Lt(e)),Ot(e,"lookAheadTime",yP,Lt(e)),Ot(e,"defaultScrollSpeed",bP,Lt(e)),e.scrollSpeed=600,Ot(e,"laneWidth",_P,Lt(e)),Ot(e,"maxPoolSize",SP,Lt(e)),e.beatmapManager=null,e.audioManager=null,e.tilePool=[],e.activeTiles=[],e.nextNoteIndex=0,e.gameTime=0,e.gameState="stopped",e._updateScheduled=!1,Ot(e,"isAutoplay",wP,Lt(e)),Ot(e,"missThreshold",TP,Lt(e)),e.touchedTiles=new Map,e.minTileHeight=300,e.laneArrays=[],e.tempVec3=new g,e.lanePositionVec3=new g,e.tilePositionsY=null,e.tileIndices=new Map,e.nextTileIndex=0,e}Nt(e,t);var i=e.prototype;return i.initialize=function(t,e){this.beatmapManager=t,this.audioManager=e,this.initTilePool()},i.onLoad=function(){this.beatmapManager||(this.beatmapManager=oA.instance),this.audioManager||(this.audioManager=LE.instance),this.initTilePool()},i.start=function(){this.ensureLaneContainers()},i.initTilePool=function(){var t;this.tilePool=[];var e=null==(t=this.beatmapManager)?void 0:t.getNotes();if(e&&e.length>0){var i=this.spawnPositionY-this.recyclePositionY,n=e[e.length-1].time-e[0].time,o=this.scrollSpeed||this.defaultScrollSpeed,r=Math.ceil(e.length*(i/(o*Math.max(.1,n))));this.maxPoolSize=Math.max(this.maxPoolSize,r+10),console.log("Dynamic pool size calculated: "+this.maxPoolSize+" (estimated visible: "+r+")")}for(var a=0;a<this.maxPoolSize;a++){var s=E(this.tilePrefab),l=s.getComponent(sP);s.active=!1,this.tilePool.push(l)}this.tilePositionsY=new Float32Array(this.maxPoolSize),this.tileIndices=new Map,this.nextTileIndex=0,this.initLaneArrays()},i.initLaneArrays=function(){var t=Math.max(4,this.laneContainers.length);this.laneArrays=new Array(t);for(var e=0;e<t;e++)this.laneArrays[e]=[]},i.ensureLaneContainers=function(){if(this.laneContainers.length<4){console.warn("TileManager needs 4 lane containers, but only "+this.laneContainers.length+" were provided.");for(var t=this.laneContainers.length;t<4;t++){var e=new c("Lane_"+t);e.parent=this.node,this.lanePositionVec3.set((t-2+.5)*this.laneWidth,0,0),e.position=this.lanePositionVec3,this.laneContainers.push(e)}}this.laneWidth=this.laneContainers[0].getComponent(B).width,this.initLaneArrays()},i.initGame=function(){this.clearActiveTiles(),this.nextNoteIndex=0,this.gameTime=0,this.activeTiles=[],this.touchedTiles.clear();for(var t=0;t<this.laneArrays.length;t++)this.laneArrays[t].length=0;this.calculateDynamicScrollSpeed()},i.startGame=function(){this.gameState="playing",this._updateScheduled||(M.getScheduler().schedule(this.update,this,0),this._updateScheduled=!0)},i.stopGame=function(){this.gameState="stopped",this._updateScheduled&&(M.getScheduler().unschedule(this.update,this),this._updateScheduled=!1),this.clearActiveTiles()},i.pauseGame=function(){this.gameState="paused"},i.resumeGame=function(){this.gameState="playing",this._updateScheduled||(M.getScheduler().schedule(this.update,this,0),this._updateScheduled=!0)},i.update=function(t){"playing"===this.gameState&&(this.gameTime=this.audioManager.getEstimatedAudioTime(),Math.random()<.03&&PP.instance.updateSongTimeDisplay(this.gameTime),this.spawnTiles(),this.balancedUpdateActiveTiles())},i.spawnTiles=function(){var t=this.beatmapManager.getNotes();if(t.length)for(var e=this.gameTime+this.lookAheadTime;this.nextNoteIndex<t.length&&t[this.nextNoteIndex].time<=e;)this.spawnTile(t[this.nextNoteIndex]),this.nextNoteIndex++},i.updateTilePosition=function(t,e){this.tempVec3.set(0,e,0),t.node.position=this.tempVec3},i.spawnTile=function(t){var e=this.getTileFromPool();if(e){var i=t.lane;if(i<0||i>=this.laneContainers.length)console.error("Invalid lane "+i+" for note "+t.midi);else{var n=this.laneContainers[i];e.node.parent=n,e.init(t,i,this.spawnPositionY,this.targetPositionY,this.laneWidth,this.scrollSpeed,this.minTileHeight),e.setBufferHeight(this.minTileHeight/2);var o=this.nextTileIndex%this.maxPoolSize;this.tileIndices.set(e,o),this.tilePositionsY[o]=this.spawnPositionY,this.nextTileIndex++,this.updateTilePosition(e,this.spawnPositionY);var r=this.spawnPositionY-this.recyclePositionY+e.getTileHeight()+500,a=(this.spawnPositionY-this.targetPositionY)/this.scrollSpeed,s=r/this.scrollSpeed,l=t.time-a;if(l<=this.gameTime)e.startMovement(s,l);else{var c=l-this.gameTime;this.scheduleOnce((function(){e.node.active&&e.startMovement(s,l)}),c)}this.activeTiles.push(e),i>=0&&i<this.laneArrays.length&&this.laneArrays[i].push(e)}}else console.warn("Tile pool exhausted, cannot spawn more tiles")},i.balancedUpdateActiveTiles=function(){this.isAutoplay&&this.handleAutoplay();for(var t=0;t<this.activeTiles.length;){var e=this.activeTiles[t];if(e.getStatus()===rP.ACTIVE&&e.node.position.y<=this.missThreshold&&e.miss(),e.node.position.y+e.getTileHeight()<=this.recyclePositionY){e.getStatus()===rP.HOLDING&&e.isLongPressType()&&e.release(this.gameTime),this.returnTileToPool(e),this.activeTiles[t]=this.activeTiles[this.activeTiles.length-1],this.activeTiles.pop();break}t++}},i.handleAutoplay=function(){var t=this;if(this.isAutoplay){for(var e,i=this.activeTiles.filter((function(e){if(e.getStatus()!==rP.ACTIVE)return!1;var i=e.getNote();return!!i&&i.time-t.gameTime<=.05})),n=Dt(i);!(e=n()).done;){var o=e.value,r=o.getLane();if(o.getNote())if(o.isLongPressType()){if(!this.touchedTiles.has(r))o.tap(this.gameTime)!==aP.MISS&&this.touchedTiles.set(r,o)}else o.tap(this.gameTime)}this.touchedTiles.forEach((function(e,i){var n=e.getNote();n&&e.getStatus()===rP.HOLDING?n.time+n.duration<=t.gameTime&&(e.release(t.gameTime),t.touchedTiles.delete(i)):t.touchedTiles.delete(i)}))}},i.toggleAutoplay=function(t){this.isAutoplay=void 0!==t?t:!this.isAutoplay,console.log("Autoplay "+(this.isAutoplay?"enabled":"disabled"))},i.isAutoplayEnabled=function(){return this.isAutoplay},i.clearActiveTiles=function(){for(var t,e=Dt(this.activeTiles);!(t=e()).done;){var i=t.value;this.returnTileToPool(i)}this.activeTiles=[]},i.getTileFromPool=function(){if(0===this.tilePool.length)return this.activeTiles.length<this.maxPoolSize?E(this.tilePrefab).getComponent(sP):null;var t=this.tilePool.pop();return t.node.active=!0,t},i.returnTileToPool=function(t){var e=t.getLane();if(this.touchedTiles.has(e)&&this.touchedTiles.get(e)===t&&(t.getStatus()===rP.HOLDING&&t.release(this.gameTime),this.touchedTiles.delete(e)),t.recycle(),this.tilePool.push(t),e>=0&&e<this.laneArrays.length){var i=this.laneArrays[e],n=i.indexOf(t);-1!==n&&(i[n]=i[i.length-1],i.pop())}this.tileIndices.delete(t)},i.handleLaneTouch=function(t,e){var i=this;if(!e){var n=this.touchedTiles.get(t);if(n&&n.isLongPressType())return this.touchedTiles.delete(t),n.release(this.gameTime)}var o=(t>=0&&t<this.laneArrays.length?this.laneArrays[t]:[]).filter((function(t){return t.getStatus()===rP.ACTIVE}));if(o.sort((function(t,e){var n=t.getNote(),o=e.getNote();return n&&o?Math.abs(n.time-i.gameTime)-Math.abs(o.time-i.gameTime):0})),0===o.length)return aP.MISS;var r=o[0];if(e){var a=r.tap(this.gameTime);return r.isLongPressType()&&a!==aP.MISS&&this.touchedTiles.set(t,r),a}return aP.MISS},i.setScrollSpeed=function(t){this.scrollSpeed;this.scrollSpeed=t},i.getScrollSpeed=function(){return this.scrollSpeed},i.getActiveTileCount=function(){return this.activeTiles.length},i.getGameTime=function(){return this.gameTime},i.setGameTime=function(t){this.gameTime=t},i.calculateDynamicScrollSpeed=function(){var t=this.beatmapManager.getNotes();if(!t||t.length<2)this.scrollSpeed=this.defaultScrollSpeed;else{for(var e=.5*this.defaultScrollSpeed,i=1.5*this.defaultScrollSpeed,n=!0,o=1;o<t.length;o++)if(t[o].time<t[o-1].time){n=!1;break}for(var r=n?t:[].concat(t).sort((function(t,e){return t.time-e.time})),a=Number.MAX_VALUE,s=0,l=0,c=0,u=1;u<r.length;u++){var h=r[u].time-r[u-1].time;h>0&&(h<a&&(a=h),s+=h,l++);var p=r[u].duration;p>c&&(c=p)}var d=l>0?s/l:1;a===Number.MAX_VALUE&&(a=1);var f=Math.min(1,.7*a+.3),g=Math.min(1,.5*d+.5),m=1;c>0&&(m=Math.max(.7,1-.1*c));var v=e+(i-e)*(.6*f+.25*g+.15*m);this.setScrollSpeed(2.5*v)}},i.setupBeginningTile=function(){this.clearActiveTiles(),this.gameState="paused";var t=Math.min(Math.floor(this.laneContainers.length/2),this.laneContainers.length-1);this.createBeginningTile(t)},i.createBeginningTile=function(t){var e=this.getTileFromPool();if(e){var i={midi:60,time:0,lane:t,type:0,duration:.3,durationTicks:0,velocity:100},n=this.laneContainers[t];e.node.parent=n;var o=this.targetPositionY;e.init(i,t,o,o,this.laneWidth,this.scrollSpeed,this.minTileHeight),e.setBufferHeight(this.minTileHeight/2),e.setBeginningNodeActive(!0),e.node.name="beginning_tile",this.activeTiles.push(e),t>=0&&t<this.laneArrays.length&&this.laneArrays[t].push(e)}else console.error("Failed to create beginning tile - pool empty")},i.checkBeginningTileTap=function(t){for(var e=0;e<this.activeTiles.length;e++){var i=this.activeTiles[e];if("beginning_tile"===i.node.name&&i.getLane()===t)return i.startMovement(1,this.gameTime),!0}return!1},i.removeTile=function(t){var e=this.activeTiles.indexOf(t);e>=0&&this.activeTiles.splice(e,1);var i=t.getLane();if(i>=0&&i<this.laneArrays.length){var n=this.laneArrays[i].indexOf(t);n>=0&&this.laneArrays[i].splice(n,1)}this.returnTileToPool(t)},e}(r)).prototype,"tilePrefab",[cP],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),fP=It(pP.prototype,"laneContainers",[uP],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),gP=It(pP.prototype,"spawnPositionY",[FP],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1200}}),mP=It(pP.prototype,"targetPositionY",[FP],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-400}}),vP=It(pP.prototype,"recyclePositionY",[FP],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-1500}}),yP=It(pP.prototype,"lookAheadTime",[FP],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 4}}),bP=It(pP.prototype,"defaultScrollSpeed",[FP],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 600}}),_P=It(pP.prototype,"laneWidth",[FP],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 160}}),SP=It(pP.prototype,"maxPoolSize",[FP],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 50}}),wP=It(pP.prototype,"isAutoplay",[FP],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),TP=It(pP.prototype,"missThreshold",[FP],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-450}}),hP=pP))||hP);t._RF.pop(),t._RF.push({},"7032aoU25dAwZKrnbS2Peig","TapValidator",void 0);var zP,kP,VP,BP,HP,UP,GP,WP,qP,ZP,YP,jP,KP,XP,JP,QP,$P=e.ccclass,tM=e.property,eM=$P("TapValidator")((NP=It((IP=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,Ot(e,"audioOffset",NP,Lt(e)),Ot(e,"perfectWindow",OP,Lt(e)),Ot(e,"goodWindow",LP,Lt(e)),Ot(e,"okWindow",RP,Lt(e)),e.beatmapManager=null,e.combo={count:0,maxCount:0,lastRating:aP.MISS,perfectCount:0,goodCount:0,okCount:0,missCount:0},e.onComboChangeCallbacks=[],e.onRatingCallbacks=[],e}Nt(e,t);var i=e.prototype;return i.onLoad=function(){this.resetCombo(),this.beatmapManager=oA.instance},i.validateTap=function(t,e,i){return this.updateCombo(i),this.onRatingCallbacks.forEach((function(e){return e(t,i)})),i},i.updateCombo=function(t){var e=this;switch(t){case aP.PERFECT:this.combo.perfectCount++,this.combo.count++;break;case aP.GREAT:this.combo.goodCount++,this.combo.count=0;break;case aP.COOL:this.combo.okCount++,this.combo.count=0;break;case aP.MISS:this.combo.missCount++,this.combo.count=0}this.combo.count>this.combo.maxCount&&(this.combo.maxCount=this.combo.count),this.combo.lastRating=t,this.onComboChangeCallbacks.forEach((function(t){return t(e.combo.count)}))},i.resetCombo=function(){this.combo={count:0,maxCount:0,lastRating:aP.MISS,perfectCount:0,goodCount:0,okCount:0,missCount:0},this.onComboChangeCallbacks.forEach((function(t){return t(0)}))},i.getCombo=function(){return this.combo.count},i.getMaxCombo=function(){return this.combo.maxCount},i.getAccuracy=function(){var t=this.combo.perfectCount+this.combo.goodCount+this.combo.okCount+this.combo.missCount;if(0===t)return 100;var e=100*this.combo.perfectCount+80*this.combo.goodCount+50*this.combo.okCount;return Math.round(e/(100*t)*100)},i.getRatingCounts=function(){return{perfect:this.combo.perfectCount,good:this.combo.goodCount,ok:this.combo.okCount,miss:this.combo.missCount}},i.getTotalNotes=function(){return this.combo.perfectCount+this.combo.goodCount+this.combo.okCount+this.combo.missCount},i.onComboChange=function(t){this.onComboChangeCallbacks.push(t)},i.offComboChange=function(t){var e=this.onComboChangeCallbacks.indexOf(t);-1!==e&&this.onComboChangeCallbacks.splice(e,1)},i.onRating=function(t){this.onRatingCallbacks.push(t)},i.offRating=function(t){var e=this.onRatingCallbacks.indexOf(t);-1!==e&&this.onRatingCallbacks.splice(e,1)},i.setAudioOffset=function(t){this.audioOffset=t},i.getAudioOffset=function(){return this.audioOffset},i.setHitWindows=function(t,e,i){this.perfectWindow=t,this.goodWindow=e,this.okWindow=i},i.isComboMilestone=function(t){return this.combo.count===t},i.calculateScore=function(){var t=Math.min(this.combo.maxCount/10,100),e=this.getAccuracy(),i=1e3*this.combo.perfectCount+500*this.combo.goodCount+100*this.combo.okCount;return Math.round(i*(1+t/100+e/100))},e}(r)).prototype,"audioOffset",[tM],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),OP=It(IP.prototype,"perfectWindow",[tM],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.05}}),LP=It(IP.prototype,"goodWindow",[tM],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.1}}),RP=It(IP.prototype,"okWindow",[tM],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.15}}),MP=IP))||MP;t._RF.pop(),t._RF.push({},"19aa5JfAPNMBLEL5AtzqFm7","InputManager",void 0);var iM,nM,oM,rM,aM,sM,lM,cM,uM,hM,pM,dM,fM,gM,mM,vM,yM,bM,_M,SM,wM,TM,CM,EM,AM,PM,MM,IM,NM,OM,LM,RM,xM,FM,DM,zM,kM,VM,BM,HM,UM=e.ccclass,GM=e.property,WM=(zP=UM("InputManager"),kP=GM([c]),VP=GM(c),BP=GM(c),HP=GM(DP),UP=GM(eM),GP=GM(_t),zP((ZP=It((qP=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,Ot(e,"tapFeedbackNodes",ZP,Lt(e)),Ot(e,"hitLineNode",YP,Lt(e)),Ot(e,"laneContainer",jP,Lt(e)),Ot(e,"tileManager",KP,Lt(e)),Ot(e,"tapValidator",XP,Lt(e)),Ot(e,"camera",JP,Lt(e)),Ot(e,"tapFeedbackDuration",QP,Lt(e)),e.isEnabled=!0,e.laneWidth=0,e.laneCount=4,e.laneStartX=0,e.activeTouches=new Map,e.nodeOpacities=[],e._laneTapCallback=null,e.activeKeyLanes=new Map,e.transNode=null,e}Nt(e,t);var i=e.prototype;return i.onLoad=function(){this.initTapFeedback(),this.transNode=this.node.getComponent(B),this.registerEvents()},i.start=function(){this.initLaneInfo()},i.initLaneInfo=function(){if(this.laneContainer){var t=this.laneContainer.getComponent(B);t?(this.laneCount=4,this.laneWidth=t.width/this.laneCount,this.laneStartX=0):console.error("Lane container doesn't have a UITransform component")}else console.error("Lane container is not assigned to InputManager")},i.initTapFeedback=function(){if(this.tapFeedbackNodes.length<this.laneCount){console.warn("Need "+this.laneCount+" tap feedback nodes, but only "+this.tapFeedbackNodes.length+" were provided.");for(var t=this.tapFeedbackNodes.length;t<this.laneCount;t++){var e=new c("TapFeedback_"+t);e.parent=this.node,e.addComponent(f).color=new X(255,255,255,120);var i=e.addComponent(b);i.opacity=0,this.nodeOpacities.push(i),this.tapFeedbackNodes.push(e)}}for(var n=0;n<this.laneCount;n++){var o=this.tapFeedbackNodes[n],r=o.getComponent(B)||o.addComponent(B);r.width=.9*this.laneWidth,r.height=100;var a=this.laneStartX+(n+.5)*this.laneWidth,s=this.hitLineNode?this.hitLineNode.position.y:0;o.position=new g(a,s,0)}},i.registerEvents=function(){D.on(z.EventType.TOUCH_START,this.onTouchStart,this),D.on(z.EventType.TOUCH_MOVE,this.onTouchMove,this),D.on(z.EventType.TOUCH_END,this.onTouchEnd,this),D.on(z.EventType.TOUCH_CANCEL,this.onTouchCancel,this),D.on(z.EventType.KEY_DOWN,this.onKeyDown,this),D.on(z.EventType.KEY_UP,this.onKeyUp,this)},i.onDestroy=function(){D.off(z.EventType.TOUCH_START,this.onTouchStart,this),D.off(z.EventType.TOUCH_MOVE,this.onTouchMove,this),D.off(z.EventType.TOUCH_END,this.onTouchEnd,this),D.off(z.EventType.TOUCH_CANCEL,this.onTouchCancel,this),D.off(z.EventType.KEY_DOWN,this.onKeyDown,this),D.off(z.EventType.KEY_UP,this.onKeyUp,this)},i.onTouchStart=function(t){if(this.isEnabled)for(var e,i=t.getTouches(),n=Dt(i);!(e=n()).done;){var o=e.value,r=o.getLocation(),a=this.convertToWorldSpace(r.x,r.y),s=this.getLaneFromPosition(a.x);if(s>=0){var l={id:o.getID(),lane:s,startTime:Date.now()/1e3,position:a,active:!0,node:this.tapFeedbackNodes[s]};this.activeTouches.set(o.getID(),l),this.showTapFeedback(s),this._laneTapCallback&&this._laneTapCallback(s);var c=this.tileManager.getGameTime(),u=this.tileManager.handleLaneTouch(s,!0);this.tapValidator.validateTap(s,c,u)}}},i.onTouchMove=function(t){this.isEnabled},i.onTouchEnd=function(t){if(this.isEnabled)for(var e,i=t.getTouches(),n=Dt(i);!(e=n()).done;){var o=e.value.getID();if(this.activeTouches.has(o)){var r=this.activeTouches.get(o);this.tileManager.getGameTime(),this.tileManager.handleLaneTouch(r.lane,!1);this.hideTapFeedback(r.lane),this.activeTouches.delete(o)}}},i.onTouchCancel=function(t){this.onTouchEnd(t)},i.onMouseDown=function(t){if(this.isEnabled){var e=t.getLocation(),i=this.convertToWorldSpace(e.x,e.y),n=this.getLaneFromPosition(i.x);if(n>=0){var o={id:0,lane:n,startTime:Date.now()/1e3,position:i,active:!0,node:this.tapFeedbackNodes[n]};this.activeTouches.set(0,o),this.showTapFeedback(n);var r=this.tileManager.getGameTime(),a=this.tileManager.handleLaneTouch(n,!0);this.tapValidator.validateTap(n,r,a)}}},i.onMouseMove=function(t){if(this.isEnabled&&this.activeTouches.has(0)){var e=this.activeTouches.get(0),i=t.getLocation(),n=this.convertToWorldSpace(i.x,i.y);e.position=n;var o=this.getLaneFromPosition(n.x);if(o>=0&&o!==e.lane){this.tileManager.handleLaneTouch(e.lane,!1),this.hideTapFeedback(e.lane),e.lane=o,e.node=this.tapFeedbackNodes[o],this.showTapFeedback(o);var r=this.tileManager.getGameTime(),a=this.tileManager.handleLaneTouch(o,!0);this.tapValidator.validateTap(o,r,a)}}},i.onMouseUp=function(t){if(this.isEnabled&&this.activeTouches.has(0)){var e=this.activeTouches.get(0);this.tileManager.getGameTime(),this.tileManager.handleLaneTouch(e.lane,!1);this.hideTapFeedback(e.lane),this.activeTouches.delete(0)}},i.showTapFeedback=function(t){var e=this;if(!(t<0||t>=this.tapFeedbackNodes.length)){var i=this.nodeOpacities[t];i&&(i.opacity=255,this.scheduleOnce((function(){e.hideTapFeedback(t)}),this.tapFeedbackDuration))}},i.hideTapFeedback=function(t){if(!(t<0||t>=this.tapFeedbackNodes.length)){var e=this.nodeOpacities[t];e&&(e.opacity=0)}},i.convertToWorldSpace=function(t,e){var i=this.camera;if(!i){var n=this.transNode.width,o=this.transNode.height;return new g(t-n/2,e-o/2,0)}var r=new g(t,e,0);return i.screenToWorld(r)},i.getLaneFromPosition=function(t){var e=t-this.laneStartX;return e<0||e>=this.laneWidth*this.laneCount?-1:Math.floor(e/this.laneWidth)},i.setEnabled=function(t){if(this.isEnabled=t,!t){this.activeTouches.clear();for(var e=0;e<this.tapFeedbackNodes.length;e++)this.hideTapFeedback(e)}},i.isInputEnabled=function(){return this.isEnabled},i.getActiveTouchInLane=function(t){for(var e,i=Dt(this.activeTouches);!(e=i()).done;){var n=e.value,o=(n[0],n[1]);if(o.lane===t)return o}return null},i.getActiveTouchCount=function(){return this.activeTouches.size},i.onLaneTap=function(t){this._laneTapCallback=t},i.removeOnLaneTap=function(t){this._laneTapCallback===t&&(this._laneTapCallback=null)},i.onKeyDown=function(t){if(this.isEnabled){var e=-1;switch(t.keyCode){case R.KEY_A:e=0;break;case R.KEY_S:e=1;break;case R.KEY_D:e=2;break;case R.KEY_F:e=3}if(e>=0&&e<this.laneCount){this.activeKeyLanes.set(t.keyCode,e),this.showTapFeedback(e),this._laneTapCallback&&this._laneTapCallback(e);var i=this.tileManager.getGameTime(),n=this.tileManager.handleLaneTouch(e,!0);this.tapValidator.validateTap(e,i,n)}}},i.onKeyUp=function(t){if(this.isEnabled&&this.activeKeyLanes.has(t.keyCode)){var e=this.activeKeyLanes.get(t.keyCode);this.tileManager.getGameTime(),this.tileManager.handleLaneTouch(e,!1);this.hideTapFeedback(e),this.activeKeyLanes.delete(t.keyCode)}},e}(r)).prototype,"tapFeedbackNodes",[kP],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),YP=It(qP.prototype,"hitLineNode",[VP],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),jP=It(qP.prototype,"laneContainer",[BP],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),KP=It(qP.prototype,"tileManager",[HP],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),XP=It(qP.prototype,"tapValidator",[UP],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),JP=It(qP.prototype,"camera",[GP],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),QP=It(qP.prototype,"tapFeedbackDuration",[GM],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.2}}),WP=qP))||WP);t._RF.pop(),t._RF.push({},"38482d0oyNDQos3rad3oDFt","FeedbackManager",void 0);var qM,ZM,YM,jM,KM,XM,JM,QM,$M,tI,eI,iI,nI,oI,rI,aI=e.ccclass,sI=e.property,lI=function(t){return t[t.PERFECT=0]="PERFECT",t[t.GREAT=1]="GREAT",t[t.COOL=2]="COOL",t[t.MISS=3]="MISS",t}(lI||{}),cI=(iM=aI("FeedbackManager"),nM=sI(l),oM=sI(l),rM=sI(l),aM=sI(l),sM=sI(it),lM=sI({type:[c],tooltip:"Feedback animation nodes in order: perfect, good, cool, miss"}),cM=sI(ct),uM=sI(y),hM=sI(l),pM=sI(c),dM=sI(_t),fM=sI(c),gM=sI([Number]),mM=sI(l),vM=sI(l),iM((_M=It((bM=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,Ot(e,"perfectPrefab",_M,Lt(e)),Ot(e,"greatPrefab",SM,Lt(e)),Ot(e,"coolPrefab",wM,Lt(e)),Ot(e,"missPrefab",TM,Lt(e)),Ot(e,"animScoreFeedBacks",CM,Lt(e)),Ot(e,"feedbackNodes",EM,Lt(e)),Ot(e,"particleSystemPerfectFragments",AM,Lt(e)),Ot(e,"comboLabel",PM,Lt(e)),Ot(e,"comboPopupPrefab",MM,Lt(e)),Ot(e,"feedbackContainer",IM,Lt(e)),Ot(e,"gameCamera",NM,Lt(e)),Ot(e,"cameraShakeNode",OM,Lt(e)),e.audioManager=null,Ot(e,"perfectSoundEffect",LM,Lt(e)),Ot(e,"greatSoundEffect",RM,Lt(e)),Ot(e,"coolSoundEffect",xM,Lt(e)),Ot(e,"missSoundEffect",FM,Lt(e)),Ot(e,"comboSoundEffect",DM,Lt(e)),Ot(e,"comboMilestones",zM,Lt(e)),e.lanePositions=[],Ot(e,"feedbackDuration",kM,Lt(e)),Ot(e,"feedbackScaleMultiplier",VM,Lt(e)),Ot(e,"scorePopupPrefab",BM,Lt(e)),Ot(e,"messagePopupPrefab",HM,Lt(e)),e.feedbackAnimNames=["perfect","great","cool","miss"],e._scorePopupPool=[],e._messagePopupPool=[],e._scorePopupTemplate=null,e._messagePopupTemplate=null,e._poolRoot=null,e.comboTween=null,e}Nt(e,t);var i=e.prototype;return i.onLoad=function(){this.audioManager=LE.instance,this.comboLabel&&(this.comboLabel.string="",this.comboLabel.node.active=!1),this.feedbackContainer||(this.feedbackContainer=new c("FeedbackContainer"),this.feedbackContainer.parent=this.node),this.perfectPrefab&&Op.instance.preloadPool(this.perfectPrefab,10),this.greatPrefab&&Op.instance.preloadPool(this.greatPrefab,10),this.coolPrefab&&Op.instance.preloadPool(this.coolPrefab,10),this.missPrefab&&Op.instance.preloadPool(this.missPrefab,5),this.comboPopupPrefab&&Op.instance.preloadPool(this.comboPopupPrefab,3),this.scorePopupPrefab?Op.instance.preloadPool(this.scorePopupPrefab,1):this.createScorePopupPrefab(),this.messagePopupPrefab?Op.instance.preloadPool(this.messagePopupPrefab,1):this.createMessagePopupPrefab()},i.createScorePopupPrefab=function(){var t=new c("ScorePopup"),e=t.addComponent(y);e.fontSize=36,e.color=new X(255,255,100,255),t.addComponent(b),this._poolRoot||(this._poolRoot=new c("PoolContainer"),this._poolRoot.parent=this.node,this._poolRoot.active=!1),this._scorePopupPool||(this._scorePopupPool=[]);for(var i=0;i<10;i++){var n=E(t);n.parent=this._poolRoot,n.active=!1,this._scorePopupPool.push(n)}this._scorePopupTemplate=t,t.parent=this._poolRoot,t.active=!1},i.createMessagePopupPrefab=function(){var t=new c("Message"),e=t.addComponent(y);e.fontSize=48,e.color=new X(255,255,255,255),t.addComponent(b),this._poolRoot||(this._poolRoot=new c("PoolContainer"),this._poolRoot.parent=this.node,this._poolRoot.active=!1),this._messagePopupPool||(this._messagePopupPool=[]);for(var i=0;i<3;i++){var n=E(t);n.parent=this._poolRoot,n.active=!1,this._messagePopupPool.push(n)}this._messagePopupTemplate=t,t.parent=this._poolRoot,t.active=!1},i.getScorePopupFromPool=function(){var t;return(t=this._scorePopupPool.length>0?this._scorePopupPool.pop():E(this._scorePopupTemplate)).active=!0,t},i.putScorePopupToPool=function(t){t&&(t.active=!1,t.removeFromParent(),this._scorePopupPool.push(t))},i.getMessagePopupFromPool=function(){var t;return(t=this._messagePopupPool.length>0?this._messagePopupPool.pop():E(this._messagePopupTemplate)).active=!0,t},i.putMessagePopupToPool=function(t){t&&(t.active=!1,t.removeFromParent(),this._messagePopupPool.push(t))},i.setLanePositions=function(t){this.lanePositions=t},i.showRatingFeedback=function(t,e){var i=this.getLanePosition(t),n=null,o="";switch(e){case aP.PERFECT:n=this.perfectPrefab,o=this.perfectSoundEffect,this.showFeedback(lI.PERFECT),this.particleSystemPerfectFragments.resetSystem();break;case aP.GREAT:n=this.greatPrefab,o=this.greatSoundEffect,this.showFeedback(lI.GREAT);break;case aP.COOL:n=this.coolPrefab,o=this.coolSoundEffect,this.showFeedback(lI.COOL);break;case aP.MISS:n=this.missPrefab,o=this.missSoundEffect,this.showFeedback(lI.MISS)}o&&this.audioManager.playSound(o),n&&this.showFeedbackPrefab(n,i)},i.showFeedbackPrefab=function(t,e){var i=Op.instance.getNode(t,this.feedbackContainer);i.position=e;var n=i.getComponent(b)||i.addComponent(b);n.opacity=255,i.scale=new g(1,1,1),v(i).to(.3*this.feedbackDuration,{scale:new g(this.feedbackScaleMultiplier,this.feedbackScaleMultiplier,1)}).to(.7*this.feedbackDuration,{position:new g(e.x,e.y+50,e.z)}).start(),v(n).delay(.3*this.feedbackDuration).to(.7*this.feedbackDuration,{opacity:0}).call((function(){Op.instance.putNode(i)})).start()},i.updateCombo=function(t){this.comboLabel&&(t>1?(this.comboLabel.string="x"+t,this.comboLabel.node.active=!0,this.comboTween&&this.comboTween.stop(),this.comboLabel.node.scale=new g(0,0,0),this.comboTween=v(this.comboLabel.node).to(.1,{scale:new g(1.2,1.2,1)}).delay(.5).to(.35,{scale:g.ZERO},{easing:_.backIn}).start(),this.isComboMilestone(t)&&this.showComboMilestone(t)):(this.comboLabel.string="",this.comboLabel.node.active=!1))},i.isComboMilestone=function(t){return this.comboMilestones.indexOf(t)>=0},i.showComboMilestone=function(t){if(this.audioManager.playSound(this.comboSoundEffect),this.comboPopupPrefab){var e=Op.instance.getNode(this.comboPopupPrefab,this.feedbackContainer);e.position=new g(0,0,0),e.scale=new g(1,1,1);var i=e.getComponentInChildren(y);i&&(i.string=t+" COMBO!"),v(e).to(.2,{scale:new g(1.5,1.5,1)}).to(.2,{scale:new g(1,1,1)}).delay(1).to(.3,{position:new g(0,100,0)}).call((function(){Op.instance.putNode(e)})).start(),this.shakeCamera(.2,t/300)}},i.shakeCamera=function(t,e){if(void 0===e&&(e=.5),this.gameCamera||this.cameraShakeNode){if(this.cameraShakeNode){var i=this.cameraShakeNode.getComponent(it);if(i)return i.play(),void this.scheduleOnce((function(){i.stop()}),t)}for(var n=this.cameraShakeNode||this.gameCamera.node,o=n.position.clone(),r=10*e,a=Math.floor(t/.05),s=v(n),l=0;l<a;l++){var c=(2*Math.random()-1)*r,u=(2*Math.random()-1)*r;s=s.to(.05,{position:new g(o.x+c,o.y+u,o.z)})}s.to(.1,{position:o}).start()}},i.showScorePopup=function(t,e){var i=this;if(void 0===e&&(e=new g(0,0,0)),this.scorePopupPrefab){var n=Op.instance.getNode(this.scorePopupPrefab,this.feedbackContainer);n.position=e;var o=n.getComponent(y);o&&(o.string="+"+t);var r=n.getComponent(b);r&&(r.opacity=255),v(n).to(.5,{position:new g(e.x,e.y+80,e.z)}).delay(.2).to(.3,{position:new g(e.x,e.y+120,e.z)}).call((function(){Op.instance.putNode(n)})).start()}else if(this._scorePopupTemplate){var a=this.getScorePopupFromPool();a.parent=this.feedbackContainer,a.position=e;var s=a.getComponent(y);s&&(s.string="+"+t);var l=a.getComponent(b);l&&(l.opacity=255),v(a).to(.5,{position:new g(e.x,e.y+80,e.z)}).delay(.2).to(.3,{position:new g(e.x,e.y+120,e.z)}).call((function(){i.putScorePopupToPool(a)})).start()}else{var u=new c("ScorePopup");u.parent=this.feedbackContainer,u.position=e;var h=u.getComponent(y)||u.addComponent(y);h.string="+"+t,h.fontSize=36,h.color=new X(255,255,100,255),v(u).to(.5,{position:new g(e.x,e.y+80,e.z)}).delay(.2).to(.3,{position:new g(e.x,e.y+120,e.z)}).call((function(){u.removeFromParent(),u.destroy()})).start()}},i.getLanePosition=function(t){return t>=0&&t<this.lanePositions.length?this.lanePositions[t]:new g(0,0,0)},i.showMessage=function(t,e,i){var n=this;if(void 0===e&&(e=2),void 0===i&&(i=80),this.messagePopupPrefab){var o=Op.instance.getNode(this.messagePopupPrefab,this.feedbackContainer);o.position=new g(0,0,0);var r=o.getComponent(y);r&&(r.string=t,r.fontSize=i,r.lineHeight=i);var a=o.getComponent(b);a&&(a.opacity=0,v(a).to(.3,{opacity:255}).delay(e-.6).to(.3,{opacity:0}).call((function(){Op.instance.putNode(o)})).start())}else if(this._messagePopupTemplate){var s=this.getMessagePopupFromPool();s.parent=this.feedbackContainer,s.position=new g(0,0,0);var l=s.getComponent(y);l&&(l.string=t,l.fontSize=i,l.lineHeight=i);var u=s.getComponent(b);u&&(u.opacity=0,v(u).to(.3,{opacity:255}).delay(e-.6).to(.3,{opacity:0}).call((function(){n.putMessagePopupToPool(s)})).start())}else{var h=new c("Message");h.parent=this.feedbackContainer,h.position=new g(0,0,0);var p=h.getComponent(y)||h.addComponent(y);p.string=t,p.fontSize=i,p.color=new X(255,255,255,255);var d=h.getComponent(b)||h.addComponent(b);d.opacity=0,v(d).to(.3,{opacity:255}).delay(e-.6).to(.3,{opacity:0}).call((function(){h.removeFromParent(),h.destroy()})).start()}},i.playHapticFeedback=function(t){if(void 0===t&&(t=.5),"navigator"in globalThis&&"vibrate"in navigator){var e=Math.floor(10+90*t);navigator.vibrate(e)}},i.showFeedback=function(t){for(var e,i=Dt(this.feedbackNodes);!(e=i()).done;){e.value.active=!1}this.feedbackNodes[t]&&(this.feedbackNodes[t].active=!0);var n=this.feedbackAnimNames[t];this.animScoreFeedBacks.play(n)},i.showPerfect=function(){this.showFeedback(lI.PERFECT)},i.showGood=function(){this.showFeedback(lI.GREAT)},i.showCool=function(){this.showFeedback(lI.COOL)},i.showMiss=function(){this.showFeedback(lI.MISS)},i.onDestroy=function(){this._scorePopupPool&&(this._scorePopupPool.forEach((function(t){t&&t.isValid&&t.destroy()})),this._scorePopupPool=[]),this._messagePopupPool&&(this._messagePopupPool.forEach((function(t){t&&t.isValid&&t.destroy()})),this._messagePopupPool=[]),this._scorePopupTemplate&&this._scorePopupTemplate.isValid&&(this._scorePopupTemplate.destroy(),this._scorePopupTemplate=null),this._messagePopupTemplate&&this._messagePopupTemplate.isValid&&(this._messagePopupTemplate.destroy(),this._messagePopupTemplate=null),this._poolRoot&&this._poolRoot.isValid&&(this._poolRoot.destroy(),this._poolRoot=null)},Ft(e,[{key:"perfectAnimNode",get:function(){return this.feedbackNodes[0]}},{key:"goodNode",get:function(){return this.feedbackNodes[1]}},{key:"coolNode",get:function(){return this.feedbackNodes[2]}},{key:"missNode",get:function(){return this.feedbackNodes[3]}}]),e}(r)).prototype,"perfectPrefab",[nM],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),SM=It(bM.prototype,"greatPrefab",[oM],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),wM=It(bM.prototype,"coolPrefab",[rM],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),TM=It(bM.prototype,"missPrefab",[aM],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),CM=It(bM.prototype,"animScoreFeedBacks",[sM],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),EM=It(bM.prototype,"feedbackNodes",[lM],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),AM=It(bM.prototype,"particleSystemPerfectFragments",[cM],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),PM=It(bM.prototype,"comboLabel",[uM],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),MM=It(bM.prototype,"comboPopupPrefab",[hM],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),IM=It(bM.prototype,"feedbackContainer",[pM],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),NM=It(bM.prototype,"gameCamera",[dM],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),OM=It(bM.prototype,"cameraShakeNode",[fM],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),LM=It(bM.prototype,"perfectSoundEffect",[sI],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"perfect"}}),RM=It(bM.prototype,"greatSoundEffect",[sI],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"good"}}),xM=It(bM.prototype,"coolSoundEffect",[sI],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"ok"}}),FM=It(bM.prototype,"missSoundEffect",[sI],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"miss"}}),DM=It(bM.prototype,"comboSoundEffect",[sI],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"combo"}}),zM=It(bM.prototype,"comboMilestones",[gM],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[50,100,200,300,500]}}),kM=It(bM.prototype,"feedbackDuration",[sI],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.7}}),VM=It(bM.prototype,"feedbackScaleMultiplier",[sI],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1.5}}),BM=It(bM.prototype,"scorePopupPrefab",[mM],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),HM=It(bM.prototype,"messagePopupPrefab",[vM],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),yM=bM))||yM);t._RF.pop(),t._RF.push({},"9daf9azaSJIKJ3U9ri2+dcr","ScoreManager",void 0);var uI,hI,pI,dI,fI,gI,mI,vI,yI,bI,_I,SI,wI,TI,CI,EI,AI,PI,MI,II,NI,OI=e.ccclass,LI=e.property,RI=(qM=OI("ScoreManager"),ZM=LI(eM),YM=LI(y),jM=LI(y),qM((JM=It((XM=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,Ot(e,"tapValidator",JM,Lt(e)),Ot(e,"scoreLabel",QM,Lt(e)),Ot(e,"accuracyLabel",$M,Lt(e)),Ot(e,"perfectScore",tI,Lt(e)),Ot(e,"goodScore",eI,Lt(e)),Ot(e,"okScore",iI,Lt(e)),Ot(e,"missScore",nI,Lt(e)),Ot(e,"maxComboBonus",oI,Lt(e)),Ot(e,"accuracyBonus",rI,Lt(e)),e.currentScore=0,e.finalScore=0,e.isTracking=!1,e.highScores=new Map,e.onScoreChangedCallback=null,e}Nt(e,t);var i=e.prototype;return i.onLoad=function(){this.updateScoreDisplay(),this.tapValidator&&this.tapValidator.onRating(this.onRatingEvent.bind(this))},i.startTracking=function(){this.resetScore(),this.isTracking=!0},i.pauseTracking=function(){this.isTracking=!1},i.resumeTracking=function(){this.isTracking=!0},i.stopTracking=function(){this.isTracking=!1,this.finalizeScore()},i.resetScore=function(){this.currentScore=0,this.finalScore=0,this.updateScoreDisplay()},i.onRatingEvent=function(t,e){if(this.isTracking){var i=0;switch(e){case aP.PERFECT:i=this.perfectScore;break;case aP.GREAT:i=this.goodScore;break;case aP.COOL:i=this.okScore;break;case aP.MISS:i=this.missScore}var n=this.tapValidator.getCombo();if(n>1){var o=1+Math.min(n/100,.5);i=Math.round(i*o)}this.addScore(i)}},i.addScore=function(t){this.isTracking&&(this.currentScore+=t,this.updateScoreDisplay(),this.onScoreChangedCallback&&this.onScoreChangedCallback(this.currentScore))},i.updateScoreDisplay=function(){if(this.scoreLabel&&(this.scoreLabel.string=this.formatScore(this.currentScore)),this.accuracyLabel&&this.tapValidator){var t=this.tapValidator.getAccuracy();this.accuracyLabel.string=t+"%"}},i.formatScore=function(t){return t.toLocaleString()},i.finalizeScore=function(){if(this.tapValidator){var t=this.tapValidator.getAccuracy(),e=this.tapValidator.getMaxCombo(),i=(this.tapValidator.getRatingCounts(),this.tapValidator.getTotalNotes()),n=this.currentScore,o=i>0?e/i:0,r=Math.round(this.maxComboBonus*o),a=Math.round(this.accuracyBonus*(t/100));this.finalScore=n+r+a,console.log("Score Breakdown:"),console.log("Base Score: "+n),console.log("Combo Bonus ("+e+"x): "+r),console.log("Accuracy Bonus ("+t+"%): "+a),console.log("Final Score: "+this.finalScore),this.checkHighScore()}else this.finalScore=this.currentScore},i.checkHighScore=function(){var t="current";return(!this.highScores.has(t)||this.finalScore>this.highScores.get(t))&&(this.highScores.set(t,this.finalScore),!0)},i.getCurrentScore=function(){return this.currentScore},i.getFinalScore=function(){return this.finalScore},i.onScoreChanged=function(t){this.onScoreChangedCallback=t},i.getHighScore=function(t){return this.highScores.get(t)||0},i.saveHighScores=function(){var t={};this.highScores.forEach((function(e,i){t[i]=e}));var e=JSON.stringify(t);localStorage.setItem("magicTilesHighScores",e)},i.loadHighScores=function(){var t=localStorage.getItem("magicTilesHighScores");if(t)try{var e=JSON.parse(t);for(var i in this.highScores.clear(),e)Object.prototype.hasOwnProperty.call(e,i)&&this.highScores.set(i,e[i])}catch(t){console.error("Failed to parse high scores:",t)}},e}(r)).prototype,"tapValidator",[ZM],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),QM=It(XM.prototype,"scoreLabel",[YM],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),$M=It(XM.prototype,"accuracyLabel",[jM],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),tI=It(XM.prototype,"perfectScore",[LI],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1e3}}),eI=It(XM.prototype,"goodScore",[LI],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 500}}),iI=It(XM.prototype,"okScore",[LI],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 100}}),nI=It(XM.prototype,"missScore",[LI],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),oI=It(XM.prototype,"maxComboBonus",[LI],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1e4}}),rI=It(XM.prototype,"accuracyBonus",[LI],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1e4}}),KM=XM))||KM);t._RF.pop(),t._RF.push({},"b4fc9FZUXxGj6ZQ8DWe5h2y","MTGameplayManager",void 0);var xI,FI,DI,zI,kI,VI,BI,HI=e.ccclass,UI=e.property,GI=function(t){return t[t.NONE=0]="NONE",t[t.LOADING=1]="LOADING",t[t.WAITING_FOR_START=2]="WAITING_FOR_START",t[t.PLAYING=3]="PLAYING",t[t.PAUSED=4]="PAUSED",t[t.COMPLETED=5]="COMPLETED",t[t.FAILED=6]="FAILED",t}({}),WI=(uI=HI("MTGameplayManager"),hI=UI(DP),pI=UI(WM),dI=UI(cI),fI=UI(eM),gI=UI(RI),mI=UI(k),uI((bI=It((yI=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).gameState=GI.NONE,Ot(e,"tileManager",bI,Lt(e)),Ot(e,"inputManager",_I,Lt(e)),Ot(e,"feedbackManager",SI,Lt(e)),Ot(e,"tapValidator",wI,Lt(e)),Ot(e,"scoreManager",TI,Lt(e)),Ot(e,"toggleAutoPlay",CI,Lt(e)),Ot(e,"countdownDuration",EI,Lt(e)),Ot(e,"minSurvivalHP",AI,Lt(e)),Ot(e,"maxSurvivalHP",PI,Lt(e)),Ot(e,"missHPPenalty",MI,Lt(e)),Ot(e,"badHitHPPenalty",II,Lt(e)),Ot(e,"perfectHPRecovery",NI,Lt(e)),e.survivalHP=100,e.currentSong=null,e.elapsedTime=0,e.notesPassed=0,e.totalNotes=0,e.autoPlay=!1,e.isPaused=!1,e.onGameStateChangedCallback=null,e.onSurvivalHPChangedCallback=null,e.audioManager=null,e.beatmapManager=null,e}Nt(e,t);var i=e.prototype;return i.onLoad=function(){this.audioManager||(this.audioManager=LE.instance),this.beatmapManager||(this.beatmapManager=oA.instance),this.tapValidator&&this.tapValidator.onRating(this.onRatingEvent.bind(this))},i.loadSong=function(){var t=Rt(xt().mark((function t(e){var i,n,o;return xt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.resetGameState(),this.currentSong=e,this.setGameState(GI.LOADING),t.prev=3,t.next=6,this.beatmapManager.loadSong(e);case 6:if(i=t.sent){t.next=10;break}return console.error("Failed to load beatmap: "+e),t.abrupt("return",!1);case 10:return t.next=12,this.beatmapManager.loadBeatmapAudioData();case 12:if(n=t.sent){t.next=16;break}return console.error("Failed to load beatmap audio"),t.abrupt("return",!1);case 16:return null==i.notes||0==i.notes.length?(o=this.beatmapManager.updateNotes(e.id,n.trackInfo.notes),this.totalNotes=o.notes.length):this.totalNotes=i.notes.length,this.tileManager.initGame(),this.createBeginningTile(),t.abrupt("return",!0);case 22:return t.prev=22,t.t0=t.catch(3),console.error("Error starting game:",t.t0),t.abrupt("return",!1);case 26:case"end":return t.stop()}}),t,this,[[3,22]])})));return function(e){return t.apply(this,arguments)}}(),i.startPlaying=function(){this.setAutoPlay(this.toggleAutoPlay.isChecked),this.tapValidator.resetCombo(),this.scoreManager.resetScore(),this.scoreManager.startTracking(),this.inputManager.setEnabled(!0),this.tileManager.startGame(),this.audioManager.playBeatmapAudio(),this.setGameState(GI.PLAYING),this.schedule(this.gameUpdate,0)},i.pauseGame=function(){this.gameState===GI.PLAYING&&(this.audioManager.pauseBeatmapAudio(),this.tileManager.pauseGame(),this.inputManager.setEnabled(!1),this.scoreManager.pauseTracking(),this.isPaused=!0,this.setGameState(GI.PAUSED),this.unschedule(this.gameUpdate))},i.resumeGame=function(){this.gameState===GI.PAUSED&&(this.audioManager.resumeBeatmapAudio(),this.tileManager.resumeGame(),this.inputManager.setEnabled(!0),this.scoreManager.resumeTracking(),this.isPaused=!1,this.setGameState(GI.PLAYING),this.schedule(this.gameUpdate,0))},i.gameUpdate=function(t){if(this.elapsedTime+=t,this.audioManager.isPlaying()){var e=this.audioManager.getCurrentTime();this.tileManager.setGameTime(e)}this.survivalHP<=0?this.failGame():this.notesPassed>=this.totalNotes&&0===this.tileManager.getActiveTileCount()&&this.completeGame()},i.onRatingEvent=function(t,e){switch(this.feedbackManager.showRatingFeedback(t,e),this.feedbackManager.updateCombo(this.tapValidator.getCombo()),this.notesPassed++,e){case aP.PERFECT:this.changeSurvivalHP(this.perfectHPRecovery);break;case aP.GREAT:break;case aP.COOL:this.changeSurvivalHP(-this.badHitHPPenalty);break;case aP.MISS:this.changeSurvivalHP(-this.missHPPenalty)}},i.changeSurvivalHP=function(t){this.survivalHP=Math.max(0,Math.min(this.maxSurvivalHP,this.survivalHP+t)),this.onSurvivalHPChangedCallback&&this.onSurvivalHPChangedCallback(this.survivalHP)},i.completeGame=function(){this.stopGameplay(),this.setGameState(GI.COMPLETED),this.feedbackManager.showMessage("LEVEL COMPLETE!");var t=this.scoreManager.getFinalScore(),e=this.tapValidator.getAccuracy(),i=this.tapValidator.getMaxCombo();console.log("Game completed! Score: "+t+", Accuracy: "+e+"%, Max Combo: "+i),this.scheduleOnce((function(){console.log("Show results screen")}),2)},i.failGame=function(){this.stopGameplay(),this.setGameState(GI.FAILED),this.feedbackManager.showMessage("GAME OVER"),this.feedbackManager.shakeCamera(.3,.8),this.scheduleOnce((function(){console.log("Show fail screen")}),2)},i.stopGameplay=function(){this.audioManager.stopBeatmapAudio(),this.tileManager.stopGame(),this.inputManager.setEnabled(!1),this.scoreManager.stopTracking(),this.unschedule(this.gameUpdate)},i.resetGameState=function(){this.gameState=GI.NONE,this.survivalHP=this.maxSurvivalHP,this.elapsedTime=0,this.notesPassed=0,this.totalNotes=0,this.isPaused=!1},i.setGameState=function(t){this.gameState=t,this.onGameStateChangedCallback&&this.onGameStateChangedCallback(t)},i.onGameStateChanged=function(t){this.onGameStateChangedCallback=t},i.onSurvivalHPChanged=function(t){this.onSurvivalHPChangedCallback=t},i.getGameState=function(){return this.gameState},i.getSurvivalHP=function(){return this.survivalHP},i.getProgress=function(){return 0===this.totalNotes?0:this.notesPassed/this.totalNotes},i.setAutoPlay=function(t){this.autoPlay=t,this.tileManager.toggleAutoplay(t)},i.isAutoPlayEnabled=function(){return this.autoPlay},i.togglePause=function(){this.isPaused?this.resumeGame():this.pauseGame()},i.restartGame=function(){this.currentSong&&this.loadSong(this.currentSong)},i.exitGame=function(){this.stopGameplay(),this.resetGameState(),console.log("Exit to menu")},i.createBeginningTile=function(){this.setGameState(GI.WAITING_FOR_START),this.feedbackManager.showMessage("Tap to Start",0,140),this.tileManager&&this.tileManager.setupBeginningTile(),this.inputManager.setEnabled(!0),this.inputManager.onLaneTap(this.onBeginningTileTap.bind(this))},i.onBeginningTileTap=function(t){this.gameState===GI.WAITING_FOR_START&&(this.tileManager.checkBeginningTileTap(t)&&(this.inputManager.removeOnLaneTap(this.onBeginningTileTap.bind(this)),this.startPlaying()))},i.onDestroy=function(){this.unscheduleAllCallbacks(),this.audioManager&&this.audioManager.deinit(),this.beatmapManager&&this.beatmapManager.deinit()},e}(r)).prototype,"tileManager",[hI],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_I=It(yI.prototype,"inputManager",[pI],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),SI=It(yI.prototype,"feedbackManager",[dI],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),wI=It(yI.prototype,"tapValidator",[fI],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),TI=It(yI.prototype,"scoreManager",[gI],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),CI=It(yI.prototype,"toggleAutoPlay",[mI],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),EI=It(yI.prototype,"countdownDuration",[UI],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 3}}),AI=It(yI.prototype,"minSurvivalHP",[UI],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 40}}),PI=It(yI.prototype,"maxSurvivalHP",[UI],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 100}}),MI=It(yI.prototype,"missHPPenalty",[UI],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 10}}),II=It(yI.prototype,"badHitHPPenalty",[UI],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 5}}),NI=It(yI.prototype,"perfectHPRecovery",[UI],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 2}}),vI=yI))||vI);t._RF.pop(),t._RF.push({},"3828eDIEe1G/rr9u6tsVC3f","PopupMTSongSelection",void 0);var qI,ZI,YI,jI,KI,XI,JI,QI=e.ccclass,$I=e.property;xI=QI("PopupMTSongSelection"),FI=$I(c),DI=$I(c),xI((VI=It((kI=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,Ot(e,"contentNode",VI,Lt(e)),Ot(e,"itemSongPrefab",BI,Lt(e)),e.gameplayManager=null,e.songs=[{id:"DauCoLoiLam",title:"Dẫu có lỗi lầm - bestcut",artist:"ATVNCG",bpm:95,difficulty:3,level:5,previewStart:6e4,previewEnd:9e4,musicPath:"DauCoLoiLam_ATVNCG_bestcut",midiPath:"DauCoLoiLam_ATVNCG_bestcut",backgroundImage:"magic_tiles/images/Perfect_EdSheeran_background",thumbnail:"magic_tiles/images/Perfect_EdSheeran_cover"},{id:"Lang",title:"Lặng",artist:"Rhymastic",bpm:85,difficulty:3,level:5,previewStart:6e4,previewEnd:9e4,musicPath:"Lang_Rhymastic_ATVNCG",midiPath:"Lang_Rhymastic_ATVNCG",backgroundImage:"magic_tiles/images/Lang_background",thumbnail:"magic_tiles/images/Lang_cover"},{id:"DauCoLoiLamFull",title:"Đâu Có Lỗi Lầm",artist:"ATVNCG",bpm:95,difficulty:3,level:5,previewStart:6e4,previewEnd:9e4,musicPath:"DauCoLoiLam_ATVNCG_Full",midiPath:"DauCoLoiLam_ATVNCG_Full",backgroundImage:"magic_tiles/images/DauCoLoiLam_background",thumbnail:"magic_tiles/images/DauCoLoiLam_cover"},{id:"TrongCom",title:"Trống Cơm",artist:"ATVNCG",bpm:100,difficulty:4,level:6,previewStart:6e4,previewEnd:9e4,musicPath:"TrongCom_ATVNCG",midiPath:"TrongCom_ATVNCG",backgroundImage:"magic_tiles/images/TrongCom_background",thumbnail:"magic_tiles/images/TrongCom_cover"},{id:"GiaNhu",title:"Giá Như",artist:"SOOBIN",bpm:90,difficulty:2,level:4,previewStart:6e4,previewEnd:9e4,musicPath:"GiaNhu_SOOBIN_ATVNCG",midiPath:"GiaNhu_SOOBIN_ATVNCG",backgroundImage:"magic_tiles/images/GiaNhu_background",thumbnail:"magic_tiles/images/GiaNhu_cover"}],e}Nt(e,t);var i=e.prototype;return i.start=function(){this.gameplayManager=M.getScene().getComponentInChildren(WI),this.createSongItems(this.songs)},i.createSongItems=function(t){var e=this;this.contentNode.removeAllChildren(),t.forEach((function(t){var i=E(e.itemSongPrefab);i.active=!0;var n=i.getComponent(ME);n&&(n.setSongData(t,e.onSongSelected.bind(e)),e.contentNode.addChild(i))}))},i.onSongSelected=function(t){var e=this;this.gameplayManager?this.gameplayManager.loadSong(t).then((function(i){i?e.hide():console.error("Failed to load beatmap: "+t.id)})):console.error("GameplayManager not found")},e}(lo)).prototype,"contentNode",[FI],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),BI=It(kI.prototype,"itemSongPrefab",[DI],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),zI=kI));t._RF.pop(),t._RF.push({},"04c89d3uFxCxYqeuP2zDazt","MTDragAndDropTool",void 0);var tN,eN,iN,nN,oN,rN=e.ccclass,aN=e.property;qI=rN("MTDragAndDropTool"),ZI=aN(c),YI=aN(y),qI((XI=It((KI=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,Ot(e,"notificationNode",XI,Lt(e)),Ot(e,"notificationLabel",JI,Lt(e)),e._midiFile=null,e._audioFile=null,e._tempBeatmapId=null,e._tempAssets=null,e._dropOverlay=null,e}Nt(e,t);var i=e.prototype;return i.onLoad=function(){this.createDragOverlay(),this.initialize()},i.onDestroy=function(){this._dropOverlay&&this._dropOverlay.parentNode&&this._dropOverlay.parentNode.removeChild(this._dropOverlay)},i.createDragOverlay=function(){if(S.isBrowser){var t=document.createElement("div");t.style.position="fixed",t.style.top="0",t.style.left="0",t.style.width="100%",t.style.height="100%",t.style.backgroundColor="rgba(0, 100, 255, 0.3)",t.style.display="none",t.style.zIndex="9999",t.style.justifyContent="center",t.style.alignItems="center",t.style.fontSize="24px",t.style.color="white",t.style.textShadow="0 0 5px black",t.innerHTML='<div style="background: rgba(0,0,0,0.7); padding: 20px; border-radius: 10px;">Drop MIDI and Audio files here<br><small>(Need both files to start)</small></div>',document.body.appendChild(t),this._dropOverlay=t}},i.initialize=function(){var t=this;if(S.isBrowser){var e=document.body;e.addEventListener("dragover",(function(e){e.preventDefault(),e.stopPropagation(),t._dropOverlay&&(t._dropOverlay.style.display="flex")})),e.addEventListener("dragleave",(function(i){i.preventDefault(),i.stopPropagation();var n=e.getBoundingClientRect();(i.clientX<=n.left||i.clientX>=n.right||i.clientY<=n.top||i.clientY>=n.bottom)&&t._dropOverlay&&(t._dropOverlay.style.display="none")})),e.addEventListener("drop",(function(e){e.preventDefault(),e.stopPropagation(),t._dropOverlay&&(t._dropOverlay.style.display="none"),t.handleFileDrop(e.dataTransfer.files)})),console.log("MTDragAndDropTool: Initialized drag and drop handlers")}else console.warn("MTDragAndDropTool: Drag and drop is only supported in browser environments")},i.handleFileDrop=function(t){var e=this;if(t&&0!==t.length){for(var i=!1,n=0;n<t.length;n++){var o=t[n];if(o.name.toLowerCase().endsWith(".mid")||o.name.toLowerCase().endsWith(".midi")){this._midiFile=o,i=!0,console.log("MTDragAndDropTool: MIDI file dropped:",o.name);break}}i?(this.notifyNextStep("MIDI file received! Processing..."),this.scheduleOnce((function(){e.processFiles()}),0)):this.notifyNextStep("Please drop a MIDI file (.mid/.midi).")}},i.processFiles=function(){var t=Rt(xt().mark((function t(){var e,i,n,o,r,a,s,l,c,u,h;return xt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,this.notifyNextStep("Processing files..."),this._tempBeatmapId="temp_"+Date.now(),e=this._midiFile.name.replace(/\.(mid|midi)$/i,""),i="magic_tiles/audios/"+e,console.log("Attempting to load audio from resources: "+i),t.prev=6,t.next=9,this.loadAudioFromResources(i);case 9:n=t.sent,console.log("Successfully loaded audio from resources:",n.name),t.next=19;break;case 13:return t.prev=13,t.t0=t.catch(6),console.error("Failed to load audio resource at "+i+":",t.t0),this.notifyNextStep('Could not find matching audio file in resources. Please ensure audio file "'+e+'.mp3" exists in magic_tiles/audios folder.'),this.resetFiles(),t.abrupt("return");case 19:return o=URL.createObjectURL(this._midiFile),t.next=22,fe(o);case 22:if(r=t.sent,a={id:this._tempBeatmapId,title:e,artist:"Unknown Artist",bpm:r.tempo||120,difficulty:3,level:5,previewStart:0,previewEnd:30,musicPath:null,midiPath:null,backgroundImage:"magic_tiles/images/default_background",thumbnail:"magic_tiles/images/default_cover"},s={song:a,notes:[]},!r||!r.notes){t.next=32;break}l=[],l=oA.instance.convertNotes(r.notes,l),s.notes=l,console.log("Processed "+s.notes.length+" notes from MIDI data"),t.next=36;break;case 32:return console.warn("No valid MIDI tracks found in the file"),this.notifyNextStep("MIDI file doesn't contain valid note data. Please try another file."),this.resetFiles(),t.abrupt("return");case 36:c=oA.instance,u=LE.instance,console.log("AudioClip details:",{name:n.name,duration:n.getDuration(),isValid:n.loaded,type:typeof n._nativeAsset}),h={clip:n,trackInfo:r,totalDuration:n.getDuration()||180,currentTime:0,isPlaying:!1,isPaused:!1},u.setCurrentBeatmap(h),c.addTempBeatmap(this._tempBeatmapId,s),this.startGame(),t.next=50;break;case 45:t.prev=45,t.t1=t.catch(0),console.error("MTDragAndDropTool: Error processing files:",t.t1),this.notifyNextStep("Error processing files: "+t.t1.message),this.resetFiles();case 50:case"end":return t.stop()}}),t,this,[[0,45],[6,13]])})));return function(){return t.apply(this,arguments)}}(),i.startGame=function(){var t=this.findGameplayManager();if(!t)return console.error("MTDragAndDropTool: GameplayManager not found"),void this.notifyNextStep("Cannot start game. Please try loading files from the game menu.");this.notifyNextStep("Starting game..."),t.resetGameState(),t.setGameState(GI.LOADING),t.tileManager.initGame(),t.createBeginningTile(),this.resetFiles()},i.findGameplayManager=function(){return M.getScene().getComponentInChildren(WI)},i.loadAudioFromResources=function(t){return new Promise((function(e,i){$e.loadRes(t,O,(function(t,n){if(t)return console.error("Failed to load audio from resources:",t),void i(t);n&&n instanceof O?(console.log("Successfully loaded AudioClip from resources:",n),e(n)):(console.error("Invalid AudioClip received:",n),i("Invalid AudioClip received"))}))}))},i.resetFiles=function(){this._midiFile&&URL.revokeObjectURL(URL.createObjectURL(this._midiFile)),this._midiFile=null,this._tempBeatmapId=null,this._tempAssets=null},i.notifyNextStep=function(t){var e=this;console.log("MTDragAndDropTool: "+t),this.notificationNode&&this.notificationLabel?(this.notificationNode.active=!0,this.notificationLabel.string=t,this.scheduleOnce((function(){e.notificationNode.active=!1}),3)):this.showTemporaryNotification(t)},i.showTemporaryNotification=function(t){if(S.isBrowser){var e=document.createElement("div");e.style.position="fixed",e.style.bottom="20px",e.style.left="50%",e.style.transform="translateX(-50%)",e.style.backgroundColor="rgba(0, 0, 0, 0.7)",e.style.color="white",e.style.padding="10px 20px",e.style.borderRadius="5px",e.style.zIndex="10000",e.innerText=t,document.body.appendChild(e),setTimeout((function(){e.parentNode&&e.parentNode.removeChild(e)}),3e3)}},e}(r)).prototype,"notificationNode",[ZI],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),JI=It(KI.prototype,"notificationLabel",[YI],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),jI=KI));t._RF.pop(),t._RF.push({},"60fa6arq75JzaMOMyrnUyBF","PitchConstants",void 0);var sN=function(t){return t[t.DO=0]="DO",t[t.RE=1]="RE",t[t.MI=2]="MI",t[t.FA=3]="FA",t[t.SOL=4]="SOL",t[t.LA=5]="LA",t[t.SI=6]="SI",t}({}),lN=function(t){return t[t.INIT=0]="INIT",t[t.CALIBRATING=1]="CALIBRATING",t[t.WAIT_FOR_FIRST_NOTE=2]="WAIT_FOR_FIRST_NOTE",t[t.PLAYING=3]="PLAYING",t[t.PAUSED=4]="PAUSED",t[t.GAME_OVER=5]="GAME_OVER",t}({}),cN=function(t){return t[t.MISS=0]="MISS",t[t.GOOD=1]="GOOD",t[t.PERFECT=2]="PERFECT",t}({}),uN=function(t){return t[t.PERFECT=0]="PERFECT",t[t.GOOD=1]="GOOD",t[t.MISS=2]="MISS",t[t.TIME_WARNING=3]="TIME_WARNING",t}({}),hN=function(){};hN.GAME_DURATION=60,hN.WARNING_TIME_1=30,hN.WARNING_TIME_2=10,hN.NOTE_FREQUENCIES=((tN={})[sN.DO]=[251.63,271.63],tN[sN.RE]=[283.66,303.66],tN[sN.MI]=[319.63,339.63],tN[sN.FA]=[339.23,359.23],tN[sN.SOL]=[382,402],tN[sN.LA]=[430,450],tN[sN.SI]=[483.88,503.88],tN),hN.NOTE_NAMES=["Do","Re","Mi","Fa","Sol","La","Si"],hN.CENTER_FREQUENCIES=((eN={})[sN.DO]=261.63,eN[sN.RE]=293.66,eN[sN.MI]=329.63,eN[sN.FA]=349.23,eN[sN.SOL]=392,eN[sN.LA]=440,eN[sN.SI]=493.88,eN),hN.FREQUENCY_RANGES=((iN={})[sN.DO]=[247.22,277.18],iN[sN.RE]=[277.18,311.13],iN[sN.MI]=[311.13,349.23],iN[sN.FA]=[329.63,369.99],iN[sN.SOL]=[369.99,415.3],iN[sN.LA]=[415.3,466.16],iN[sN.SI]=[466.16,523.25],iN),hN.ANIMATIONS=((nN={})[sN.DO]="do_animation",nN[sN.RE]="re_animation",nN[sN.MI]="mi_animation",nN[sN.FA]="fa_animation",nN[sN.SOL]="sol_animation",nN[sN.LA]="la_animation",nN[sN.SI]="si_animation",nN),hN.NOTE_ANIMATIONS=((oN={})[sN.DO]="do_animation",oN[sN.RE]="re_animation",oN[sN.MI]="mi_animation",oN[sN.FA]="fa_animation",oN[sN.SOL]="sol_animation",oN[sN.LA]="la_animation",oN[sN.SI]="si_animation",oN),hN.EVENTS={PITCH_DETECTED:"pitch_detected",TIME_WARNING:"time_warning",GAME_OVER:"game_over",NOTE_MATCHED:"note_matched",SEQUENCE_COMPLETE:"sequence_complete"},hN.ACCURACY_THRESHOLDS={PERFECT:3,GOOD:7},t._RF.pop(),t._RF.push({},"dfe631CLPRPBowoQTyI/2P8","PitchNoteSequence",void 0);var pN,dN,fN,gN,mN,vN,yN,bN,_N,SN,wN=function(){function t(t,e,i,n){this.id=void 0,this.name=void 0,this.difficulty=void 0,this.notes=void 0,this.id=t,this.name=e,this.difficulty=i,this.notes=n}var e=t.prototype;return e.getTotalDuration=function(){return this.notes.reduce((function(t,e){return t+e.duration}),0)},e.getNoteCount=function(){return this.notes.length},t}(),TN=function(){function t(){}return t.initialize=function(){this.addSequence(new wN("sequence_1","Basic Scale",1,[{note:sN.DO,duration:1.5},{note:sN.RE,duration:1},{note:sN.MI,duration:1.5},{note:sN.FA,duration:1},{note:sN.SOL,duration:2},{note:sN.LA,duration:1.5},{note:sN.SI,duration:1},{note:sN.DO,duration:2},{note:sN.SI,duration:1},{note:sN.LA,duration:1.5},{note:sN.SOL,duration:1},{note:sN.FA,duration:1.5},{note:sN.MI,duration:1},{note:sN.RE,duration:1.5},{note:sN.DO,duration:2}])),this.addSequence(new wN("sequence_2","Simple Melody",2,[{note:sN.DO,duration:1},{note:sN.MI,duration:1},{note:sN.SOL,duration:1},{note:sN.MI,duration:1},{note:sN.DO,duration:2}])),this.addSequence(new wN("sequence_3","Advanced Pattern",3,[{note:sN.DO,duration:1},{note:sN.MI,duration:1},{note:sN.SOL,duration:1},{note:sN.SI,duration:1},{note:sN.LA,duration:1},{note:sN.FA,duration:1},{note:sN.RE,duration:1},{note:sN.DO,duration:2}])),this.addSequence(new wN("sequence_4","Expert Challenge",5,[{note:sN.DO,duration:.5},{note:sN.RE,duration:.5},{note:sN.MI,duration:.5},{note:sN.FA,duration:.5},{note:sN.SOL,duration:.5},{note:sN.LA,duration:.5},{note:sN.SI,duration:.5},{note:sN.LA,duration:.5},{note:sN.SOL,duration:.5},{note:sN.FA,duration:.5},{note:sN.MI,duration:.5},{note:sN.RE,duration:.5},{note:sN.DO,duration:1}]))},t.addSequence=function(t){this.sequences.set(t.id,t)},t.getSequenceById=function(t){return this.sequences.get(t)||null},t.getAllSequences=function(){return Array.from(this.sequences.values())},t.getSequencesByDifficulty=function(t){return Array.from(this.sequences.values()).filter((function(e){return e.difficulty===t}))},t}();TN.sequences=new Map,t._RF.pop(),t._RF.push({},"2e7c57Ev6lF8Ih44/MNJsG1","PitchCharacterAnimator",void 0);var CN,EN=e.ccclass,AN=e.property,PN=(pN=EN("PitchCharacterAnimator"),dN=AN(c),fN=AN(it),gN=AN(lt),pN((yN=It((vN=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,Ot(e,"characterNode",yN,Lt(e)),Ot(e,"animationComponent",bN,Lt(e)),Ot(e,"skeletalAnimation",_N,Lt(e)),Ot(e,"transitionDuration",SN,Lt(e)),e.currentNote=null,e.isAnimating=!1,e.animationClips=new Map,e.idleAnimationClip=null,e.IDLE_ANIMATION="Idle",e}Nt(e,t);var i=e.prototype;return i.onLoad=function(){!this.animationComponent&&this.characterNode&&(this.animationComponent=this.characterNode.getComponent(it)),!this.skeletalAnimation&&this.characterNode&&(this.skeletalAnimation=this.characterNode.getComponent(lt))},i.start=function(){this.loadAnimationClips()},i.loadAnimationClips=function(){var t=this;$e.loadRes("pitch/animations/"+this.IDLE_ANIMATION,nt,(function(e,i){e?console.error("Failed to load idle animation: "+e):(t.idleAnimationClip=i,t.registerAnimationClip(t.IDLE_ANIMATION,i),console.log("Idle animation loaded"),t.playIdleAnimation())}));for(var e=function(){var e=i,n=hN.NOTE_ANIMATIONS[e];$e.loadRes("pitch/animations/"+n,nt,(function(i,o){i?console.error("Failed to load animation for note "+hN.NOTE_NAMES[e]+": "+i):(t.animationClips.set(e,o),t.registerAnimationClip(n,o),console.log("Animation for note "+hN.NOTE_NAMES[e]+" loaded"))}))},i=0;i<7;i++)e()},i.registerAnimationClip=function(t,e){this.animationComponent&&(this.animationComponent.getState(t)||this.animationComponent.createState(e,t))},i.playNoteAnimation=function(t,e){var i=this;if(this.animationComponent&&null!==t){var n=hN.NOTE_ANIMATIONS[t],o=this.animationComponent.getState(n);o?this.currentNote===t&&this.isAnimating||(this.currentNote=t,this.isAnimating=!0,this.animationComponent.crossFade(n,this.transitionDuration),console.log("Playing animation for note "+hN.NOTE_NAMES[t]),o.once("finished",(function(){i.isAnimating=!1,i.playIdleAnimation()}))):console.warn("Animation state not found for note "+hN.NOTE_NAMES[t])}},i.playIdleAnimation=function(){this.animationComponent&&(this.animationComponent.getState(this.IDLE_ANIMATION)?(this.currentNote=null,this.isAnimating=!1,this.animationComponent.crossFade(this.IDLE_ANIMATION,this.transitionDuration),console.log("Playing idle animation")):console.warn("Idle animation state not found"))},i.playSpecialAnimation=function(t,e,i){var n=this;void 0===e&&(e=!1),this.animationComponent&&$e.loadRes("pitch/animations/"+t,nt,(function(o,r){if(o)console.error("Failed to load special animation "+t+": "+o);else{n.registerAnimationClip(t,r);var a=n.animationComponent.getState(t);a?(n.currentNote=null,n.isAnimating=!0,a.wrapMode=e?2:1,n.animationComponent.crossFade(t,n.transitionDuration),console.log("Playing special animation: "+t),!e&&i&&a.once("finished",i)):console.warn("Special animation state not found: "+t)}}))},i.stopAllAnimations=function(){this.animationComponent&&(this.animationComponent.stop(),this.playIdleAnimation(),console.log("All animations stopped"))},i.isAnimationPlaying=function(){return this.isAnimating},i.getCurrentNote=function(){return this.currentNote},e}(r)).prototype,"characterNode",[dN],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),bN=It(vN.prototype,"animationComponent",[fN],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_N=It(vN.prototype,"skeletalAnimation",[gN],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),SN=It(vN.prototype,"transitionDuration",[AN],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.3}}),mN=vN))||mN);t._RF.pop(),t._RF.push({},"f8ec1Ju28VBfoeISSQmPsrE","PitchDetectionSystem",void 0);var MN,IN,NN,ON,LN,RN=e.ccclass,xN=(e.property,RN("PitchDetectionSystem")(CN=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).noteStabilityCounter=new Map,e.noteStabilityThreshold=2,e.isCalibrating=!1,e.calibrationCallback=null,e}Nt(e,t);var i=e.prototype;return i.onLoad=function(){for(var t=0;t<7;t++)this.noteStabilityCounter.set(t,0)},i.detectPitch=function(){if(this.analyzer&&this.isDetecting){this.analyzer.getFloatTimeDomainData(this.analyzerBuffer);for(var t=0,e=0;e<this.analyzerBuffer.length;e++)t+=this.analyzerBuffer[e]*this.analyzerBuffer[e];var i=Math.sqrt(t/this.analyzerBuffer.length);if(Math.random()<.1&&console.log("Current volume:",i.toFixed(4),"Threshold:",this.volumeThreshold),i<this.volumeThreshold)return this.resetNoteStability(),void this.emitPitchDetected(0,null,cN.MISS,i);var n=this.detectPitchAutocorrelation(),o=this.smoothingFactor*this.lastFrequency+(1-this.smoothingFactor)*n;this.lastFrequency=o,Math.random()<.1&&console.log("Smoothed frequency:",o.toFixed(2),"Hz");var r=this.mapFrequencyToNote(o),a=r.note,s=r.accuracy;null!==a?(this.updateNoteStability(a),Math.random()<.1&&console.log("Note stability counter:",{note:hN.NOTE_NAMES[a],count:this.noteStabilityCounter.get(a),threshold:this.noteStabilityThreshold}),this.noteStabilityCounter.get(a)>=this.noteStabilityThreshold&&this.emitPitchDetected(o,a,s,i)):(this.resetNoteStability(),this.emitPitchDetected(o,null,cN.MISS,i))}},i.detectPitchAutocorrelation=function(){for(var t=this.analyzerBuffer,e=t.length,i=0,n=0;n<e;n++)i+=t[n]*t[n];if((i=Math.sqrt(i/e))<this.volumeThreshold)return console.log("Autocorrelation RMS below threshold"),0;for(var o=new Float32Array(e),r=0;r<e;r++){o[r]=0;for(var a=0;a<e-r;a++)o[r]+=t[a]*t[a+r]}for(var s=-1,l=1;l<e/2;l++)if(o[l]<o[l-1]&&o[l]<o[l+1]){s=l;break}s<=1&&(s=1);for(var c=s,u=s+1;u<e/2;u++)o[u]>o[c]&&(c=u);if(o[c]<=0||0===c)return 0;var h=c;if(c>0&&c<e-1){var p=o[c],d=o[c-1],f=o[c+1],g=.5*(d-f)/(d-2*p+f);isFinite(g)&&(h+=g)}var m=0;return h>0&&(m=this.audioContext.sampleRate/h),m},i.mapFrequencyToNote=function(t){if(t<=0)return console.log("Invalid frequency detected:",t),{note:null,accuracy:cN.MISS};console.log("Detected frequency:",t.toFixed(2),"Hz");for(var e=0;e<7;e++){var i=e,n=hN.FREQUENCY_RANGES[i],o=n[0],r=n[1],a=hN.CENTER_FREQUENCIES[i];if(t>=o&&t<=r){var s=Math.abs(t-a),l=s/a*100;console.log("Note "+hN.NOTE_NAMES[i]+" detected:",{frequency:t.toFixed(2),centerFreq:a.toFixed(2),diffFromCenter:s.toFixed(2),percentDiff:l.toFixed(2)+"%",range:"["+o.toFixed(2)+", "+r.toFixed(2)+"]"});return{note:i,accuracy:l<=1?cN.PERFECT:l<=2.5?cN.GOOD:cN.MISS}}}return{note:null,accuracy:cN.MISS}},i.updateNoteStability=function(t){for(var e=0;e<7;e++)e!==t&&this.noteStabilityCounter.set(e,0);var i=this.noteStabilityCounter.get(t)||0;this.noteStabilityCounter.set(t,i+1)},i.resetNoteStability=function(){for(var t=0;t<7;t++)this.noteStabilityCounter.set(t,0)},i.emitPitchDetected=function(t,e,i,n){var o={frequency:t,note:e,accuracy:i,volume:n};this.emit(hN.EVENTS.PITCH_DETECTED,o)},i.startCalibration=function(t){var e=this;this.isCalibrating||(this.isCalibrating=!0,this.calibrationCallback=t,setTimeout((function(){e.isCalibrating=!1,e.calibrationCallback&&(e.calibrationCallback(!0),e.calibrationCallback=null)}),2e3),console.log("Calibration started"))},e}(Hw))||CN);t._RF.pop(),t._RF.push({},"34dfdy0Mg9MWooFmqWcRhjg","PitchTimer",void 0);var FN,DN,zN,kN,VN,BN,HN,UN,GN,WN,qN,ZN,YN,jN,KN,XN,JN,QN,$N,tO,eO,iO,nO,oO,rO,aO,sO,lO,cO,uO,hO,pO,dO,fO=e.ccclass,gO=e.property,mO=fO("PitchTimer")((NN=It((IN=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).eventTarget=new yt,Ot(e,"duration",NN,Lt(e)),Ot(e,"warningTime1",ON,Lt(e)),Ot(e,"warningTime2",LN,Lt(e)),e.isRunning=!1,e.isPaused=!1,e.startTime=0,e.pauseTime=0,e.pausedDuration=0,e.remainingTime=0,e.warningEmitted1=!1,e.warningEmitted2=!1,e}Nt(e,t);var i=e.prototype;return i.startTimer=function(t){this.isRunning||(void 0!==t&&(this.duration=t),this.isRunning=!0,this.isPaused=!1,this.startTime=Date.now(),this.pausedDuration=0,this.remainingTime=this.duration,this.warningEmitted1=!1,this.warningEmitted2=!1,console.log("Timer started with duration: "+this.duration+"s"))},i.pauseTimer=function(){this.isRunning&&!this.isPaused&&(this.isPaused=!0,this.pauseTime=Date.now(),console.log("Timer paused"))},i.resumeTimer=function(){this.isRunning&&this.isPaused&&(this.isPaused=!1,this.pausedDuration+=Date.now()-this.pauseTime,console.log("Timer resumed"))},i.stopTimer=function(){this.isRunning&&(this.isRunning=!1,this.isPaused=!1,console.log("Timer stopped"))},i.resetTimer=function(){this.isRunning=!1,this.isPaused=!1,this.startTime=0,this.pauseTime=0,this.pausedDuration=0,this.remainingTime=this.duration,this.warningEmitted1=!1,this.warningEmitted2=!1,console.log("Timer reset")},i.getRemainingTime=function(){return this.remainingTime},i.getElapsedTime=function(){return this.duration-this.remainingTime},i.getProgress=function(){return 1-this.remainingTime/this.duration},i.setDuration=function(t){this.isRunning?console.warn("Cannot change duration while timer is running"):(this.duration=t,this.remainingTime=t)},i.addTime=function(t){this.isRunning&&(this.remainingTime+=t,this.remainingTime>this.warningTime1&&(this.warningEmitted1=!1),this.remainingTime>this.warningTime2&&(this.warningEmitted2=!1),console.log("Added "+t+"s to timer. Remaining time: "+this.remainingTime.toFixed(1)+"s"))},i.update=function(t){if(this.isRunning&&!this.isPaused){var e=(Date.now()-this.startTime-this.pausedDuration)/1e3;this.remainingTime=Math.max(0,this.duration-e),!this.warningEmitted1&&this.remainingTime<=this.warningTime1&&(this.warningEmitted1=!0,this.emit(hN.EVENTS.TIME_WARNING,this.remainingTime),console.log("Time warning 1: "+this.remainingTime.toFixed(1)+"s remaining")),!this.warningEmitted2&&this.remainingTime<=this.warningTime2&&(this.warningEmitted2=!0,this.emit(hN.EVENTS.TIME_WARNING,this.remainingTime),console.log("Time warning 2: "+this.remainingTime.toFixed(1)+"s remaining")),this.remainingTime<=0&&(this.isRunning=!1,this.emit(hN.EVENTS.GAME_OVER),console.log("Time's up!"))}},i.on=function(t,e,i){this.eventTarget.on(t,e,i)},i.off=function(t,e,i){var n;null==(n=this.eventTarget)||n.off(t,e,i)},i.emit=function(t,e,i,n,o,r){var a;null==(a=this.eventTarget)||a.emit(t,e,i,n,o,r)},e}(r)).prototype,"duration",[gO],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return hN.GAME_DURATION}}),ON=It(IN.prototype,"warningTime1",[gO],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return hN.WARNING_TIME_1}}),LN=It(IN.prototype,"warningTime2",[gO],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return hN.WARNING_TIME_2}}),MN=IN))||MN;t._RF.pop(),t._RF.push({},"eaf8ab4I6VMYr2n+WmMAYid","PitchUIManager",void 0);var vO,yO,bO,_O,SO,wO,TO,CO,EO,AO,PO,MO=e.ccclass,IO=e.property,NO=(FN=MO("PitchUIManager"),DN=IO({type:c,group:{name:"UI Screens",id:"screens"}}),zN=IO({type:c,group:{name:"UI Screens",id:"screens"}}),kN=IO({type:c,group:{name:"UI Screens",id:"screens"}}),VN=IO({type:c,group:{name:"UI Screens",id:"screens"}}),BN=IO({type:c,group:{name:"Gameplay UI",id:"gameplay"}}),HN=IO({type:y,group:{name:"Gameplay UI",id:"gameplay"}}),UN=IO({type:y,group:{name:"Gameplay UI",id:"gameplay"}}),GN=IO({type:y,group:{name:"Gameplay UI",id:"gameplay"}}),WN=IO({type:[c],group:{name:"Feedback",id:"feedback"}}),qN=IO({type:it,group:{name:"Feedback",id:"feedback"}}),ZN=IO({type:y,group:{name:"Results UI",id:"results"}}),YN=IO({type:y,group:{name:"Results UI",id:"results"}}),jN=IO({type:y,group:{name:"Results UI",id:"results"}}),KN=IO({type:x,group:{name:"Results UI",id:"results"}}),XN=IO({type:x,group:{name:"Results UI",id:"results"}}),FN(($N=It((QN=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,Ot(e,"mainMenuScreen",$N,Lt(e)),Ot(e,"gameplayScreen",tO,Lt(e)),Ot(e,"resultsScreen",eO,Lt(e)),Ot(e,"calibrationScreen",iO,Lt(e)),Ot(e,"progressLine",nO,Lt(e)),Ot(e,"timerLabel",oO,Lt(e)),Ot(e,"currentNoteLabel",rO,Lt(e)),Ot(e,"targetNoteLabel",aO,Lt(e)),Ot(e,"feedbackNodes",sO,Lt(e)),Ot(e,"feedbackAnimation",lO,Lt(e)),Ot(e,"resultsTitleLabel",cO,Lt(e)),Ot(e,"resultsTimeLabel",uO,Lt(e)),Ot(e,"resultsAccuracyLabel",hO,Lt(e)),Ot(e,"retryButton",pO,Lt(e)),Ot(e,"mainMenuButton",dO,Lt(e)),e.PROGRESS_LINE_MOVE_DURATION=.5,e.currentGameState=lN.INIT,e}Nt(e,t);var i=e.prototype;return i.hideAllScreens=function(){this.mainMenuScreen&&(this.mainMenuScreen.active=!1),this.gameplayScreen&&(this.gameplayScreen.active=!1),this.resultsScreen&&(this.resultsScreen.active=!1),this.calibrationScreen&&(this.calibrationScreen.active=!1)},i.showMainMenu=function(){this.hideAllScreens(),this.mainMenuScreen&&(this.mainMenuScreen.active=!0,this.currentGameState=lN.INIT)},i.showGameplay=function(t){this.hideAllScreens(),this.gameplayScreen&&(this.gameplayScreen.active=!0,this.currentGameState=lN.PLAYING,this.initializeGameplayUI())},i.showCalibration=function(){this.hideAllScreens(),this.calibrationScreen&&(this.calibrationScreen.active=!0,this.currentGameState=lN.CALIBRATING)},i.showResults=function(t,e,i){this.hideAllScreens(),this.resultsScreen&&(this.resultsScreen.active=!0,this.currentGameState=lN.GAME_OVER,this.resultsTitleLabel&&(this.resultsTitleLabel.string=t?"Success!":"Time's Up!"),this.resultsTimeLabel&&(this.resultsTimeLabel.string="Time: "+e.toFixed(1)+"s remaining"),this.resultsAccuracyLabel&&(this.resultsAccuracyLabel.string="Accuracy: "+i.toFixed(1)+"%"))},i.initializeGameplayUI=function(){this.progressLine&&this.progressLine.setPosition(new g(-200,0,0)),this.currentNoteLabel&&(this.currentNoteLabel.string=""),this.timerLabel&&(this.timerLabel.string=hN.GAME_DURATION+"s")},i.updateTargetNoteLabel=function(t){if(this.targetNoteLabel)if(null!==t){var e=hN.NOTE_NAMES[t];this.targetNoteLabel.string="Target: "+e}else this.targetNoteLabel.string=""},i.updateCurrentNoteLabel=function(t){if(this.currentNoteLabel)if(null!==t){var e=hN.NOTE_NAMES[t];this.currentNoteLabel.string="Current: "+e}else this.currentNoteLabel.string="Current: -"},i.updateTimer=function(t){this.timerLabel&&(this.timerLabel.string=Math.ceil(t)+"s",this.timerLabel.color=t<=hN.WARNING_TIME_2?new X(255,0,0,255):t<=hN.WARNING_TIME_1?new X(255,165,0,255):new X(255,255,255,255))},i.showFeedback=function(t){if(this.feedbackNodes&&this.feedbackAnimation){for(var e,i=Dt(this.feedbackNodes);!(e=i()).done;){e.value.active=!1}t>=0&&t<this.feedbackNodes.length&&(this.feedbackNodes[t].active=!0);var n=["perfect","good","miss","timeWarning"][t];this.feedbackAnimation.play(n)}},i.showTimeWarning=function(t){this.timerLabel&&this.timerLabel.node&&v(this.timerLabel.node).to(.2,{scale:new g(1.5,1.5,1.5)}).to(.2,{scale:new g(1,1,1)}).repeat(2).start(),this.showFeedback(uN.TIME_WARNING)},i.getGameState=function(){return this.currentGameState},e}(r)).prototype,"mainMenuScreen",[DN],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),tO=It(QN.prototype,"gameplayScreen",[zN],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),eO=It(QN.prototype,"resultsScreen",[kN],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),iO=It(QN.prototype,"calibrationScreen",[VN],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),nO=It(QN.prototype,"progressLine",[BN],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),oO=It(QN.prototype,"timerLabel",[HN],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),rO=It(QN.prototype,"currentNoteLabel",[UN],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),aO=It(QN.prototype,"targetNoteLabel",[GN],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),sO=It(QN.prototype,"feedbackNodes",[WN],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),lO=It(QN.prototype,"feedbackAnimation",[qN],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),cO=It(QN.prototype,"resultsTitleLabel",[ZN],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),uO=It(QN.prototype,"resultsTimeLabel",[YN],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),hO=It(QN.prototype,"resultsAccuracyLabel",[jN],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),pO=It(QN.prototype,"retryButton",[KN],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),dO=It(QN.prototype,"mainMenuButton",[XN],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),JN=QN))||JN);t._RF.pop(),t._RF.push({},"2f22b6bD+5Kq6ollwy3qJJ9","PitchTile",void 0);var OO,LO,RO,xO,FO,DO,zO,kO,VO,BO,HO,UO,GO,WO,qO,ZO,YO,jO,KO,XO,JO,QO,$O,tL,eL,iL,nL,oL,rL,aL,sL,lL,cL,uL,hL,pL=e.ccclass,dL=e.property,fL=(vO=pL("PitchTile"),yO=dL(f),bO=dL(B),_O=dL(f),SO=dL(B),vO((CO=It((TO=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,Ot(e,"sprite",CO,Lt(e)),Ot(e,"transform",EO,Lt(e)),Ot(e,"progressSprite",AO,Lt(e)),Ot(e,"progressTransform",PO,Lt(e)),e.note=null,e.duration=0,e.scrollSpeed=0,e.currentProgress=0,e.isActive=!1,e.gradientColors=[new X(0,255,0,150),new X(255,255,0,150),new X(0,0,0,150)],e.gradientStops=[0,.8,1],e}Nt(e,t);var i=e.prototype;return i.initialize=function(t,e,i){this.note=t,this.duration=e,this.scrollSpeed=i,this.currentProgress=0,this.isActive=!1;var n=e*i;this.transform&&this.transform.setContentSize(n,this.transform.height),this.updateDurationProgress(0)},i.setActive=function(t){this.isActive=t,this.progressSprite&&(this.progressSprite.color=t?this.gradientColors[2]:this.gradientColors[0])},i.getGradientColor=function(t){for(var e=0,i=0,n=0,o=0;o<this.gradientStops.length-1;o++)if(t>=this.gradientStops[o]&&t<=this.gradientStops[o+1]){e=o,i=o+1,n=(t-this.gradientStops[o])/(this.gradientStops[o+1]-this.gradientStops[o]);break}var r=this.gradientColors[e],a=this.gradientColors[i];return new X(r.r+(a.r-r.r)*n,r.g+(a.g-r.g)*n,r.b+(a.b-r.b)*n,255)},i.getProgress=function(){return this.currentProgress},i.isComplete=function(){return this.currentProgress>=1},i.getNote=function(){return this.note},i.getDuration=function(){return this.duration},i.updateDurationProgress=function(t){if(t=1-t,this.progressTransform&&this.transform){var e=this.transform.width*t;this.progressTransform.setContentSize(e,this.progressTransform.height),this.progressSprite&&(this.progressSprite.color=this.getGradientColor(t))}},e}(r)).prototype,"sprite",[yO],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),EO=It(TO.prototype,"transform",[bO],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),AO=It(TO.prototype,"progressSprite",[_O],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),PO=It(TO.prototype,"progressTransform",[SO],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),wO=TO))||wO);t._RF.pop(),t._RF.push({},"ed6fbHqK/JJv6q+lwtbCqxi","PitchGameplayController",void 0);var gL,mL,vL,yL,bL,_L=e.ccclass,SL=e.property;OO=_L("PitchGameplayController"),LO=SL(xN),RO=SL(PN),xO=SL(mO),FO=SL(qw),DO=SL({type:c,group:{name:"Gameplay UI",id:"gameplay"}}),zO=SL({type:[c],group:{name:"Gameplay UI",id:"gameplay"}}),kO=SL({type:c,group:{name:"Gameplay UI",id:"gameplay"}}),VO=SL({type:c,group:{name:"Gameplay UI",id:"gameplay"}}),BO=SL({type:NO,group:{name:"Gameplay UI",id:"gameplay"}}),HO=SL({type:c,group:{name:"Gameplay UI",id:"gameplay"}}),UO=SL({type:c,group:{name:"Gameplay UI",id:"gameplay"}}),GO=SL({type:ct,group:{name:"Feedback",id:"feedback"}}),WO=SL({type:l,group:{name:"Scrolling",id:"scrolling"}}),qO=SL({type:c,group:{name:"Scrolling",id:"scrolling"}}),ZO=SL({type:Number,group:{name:"Scrolling",id:"scrolling"}}),YO=SL({type:Number,group:{name:"Scrolling",id:"scrolling"}}),OO((XO=It((KO=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,Ot(e,"detectionSystem",XO,Lt(e)),Ot(e,"characterAnimator",JO,Lt(e)),Ot(e,"timer",QO,Lt(e)),Ot(e,"waveformVisualizer",$O,Lt(e)),Ot(e,"musicalStaff",tL,Lt(e)),Ot(e,"noteIndicators",eL,Lt(e)),Ot(e,"progressLine",iL,Lt(e)),Ot(e,"microphone",nL,Lt(e)),Ot(e,"pitchUIManager",oL,Lt(e)),e.gameState=lN.INIT,e.currentSequence=null,e.totalNotesMatched=0,e.totalAccuracy=0,e.currentNoteIndex=0,e.currentNoteStartTime=0,e.currentNoteDuration=0,e.PERFECT_DURATION_THRESHOLD=.8,e.PROGRESS_LINE_MOVE_DURATION=.5,Ot(e,"butterfly",rL,Lt(e)),Ot(e,"butterflyCamera",aL,Lt(e)),Ot(e,"butterflyParticles",sL,Lt(e)),e.BUTTERFLY_MOVE_DURATION=1,e.BUTTERFLY_CAMERA_SPEED=300,e.butterflyTween=null,e.butterflyTargetY=-150,e.isFirstNoteCorrect=!1,e.transNotes=[],e.noteYPositions=[],Ot(e,"pitchTilePrefab",lL,Lt(e)),Ot(e,"scrollingContainer",cL,Lt(e)),Ot(e,"scrollSpeed",uL,Lt(e)),Ot(e,"tileStartX",hL,Lt(e)),e.activeTiles=[],e.tilePositions=[],e.containerPosition=0,e.targetScrollingPositionX=0,e.isScrolling=!1,e.noteIndexToTileMap=new Map,e.SCROLL_SMOOTHING_FACTOR=.1,e}Nt(e,t);var i=e.prototype;return i.onLoad=function(){var t=this;this.waveformVisualizer&&this.waveformVisualizer.initialize(this.microphone),TN.initialize(),this.transNotes=this.noteIndicators.map((function(t){return t.getComponent(B)}));var e=this.transNotes[0].height;this.noteYPositions=this.noteIndicators.map((function(i){return i.position.y+t.musicalStaff.position.y+e/2}))},i.start=function(){this.setupEventListeners(),this.startGame("sequence_1")},i.setupEventListeners=function(){this.detectionSystem.on(hN.EVENTS.PITCH_DETECTED,this.onPitchDetected,this),this.timer.on(hN.EVENTS.TIME_WARNING,this.onTimeWarning,this),this.timer.on(hN.EVENTS.GAME_OVER,this.onTimeUp,this)},i.extendSequenceToFillDuration=function(t){var e=hN.GAME_DURATION,i=t.getTotalDuration();if(i>=e)return t;for(var n=[].concat(t.notes),o=i;o<e;){var r=Math.floor(7*Math.random()),a=1+Math.random();n.push({note:r,duration:a}),o+=a}return new wN(t.id+"_extended",t.name+" (Extended)",t.difficulty,n)},i.startGame=function(t){var e=this,i=TN.getSequenceById(t);i?(this.currentSequence=this.extendSequenceToFillDuration(i),this.totalNotesMatched=0,this.totalAccuracy=0,this.currentNoteIndex=0,this.isScrolling=!1,this.containerPosition=0,this.pitchUIManager.showGameplay(this.currentSequence),this.setupNoteIndicators(),this.initializeScrolling(),this.detectionSystem.initialize().then((function(){return e.detectionSystem.requestMicrophoneAccess()})).then((function(t){t?(e.gameState=lN.WAIT_FOR_FIRST_NOTE,e.detectionSystem.startDetection(),console.log("Game started, waiting for first note")):console.error("Failed to access microphone")})).catch((function(t){console.error("Error starting game:",t)}))):console.error("Sequence with ID "+t+" not found")},i.pauseGame=function(){this.gameState===lN.PLAYING&&(this.gameState=lN.PAUSED,this.timer.pauseTimer(),this.detectionSystem.stopDetection(),this.isScrolling=!1,console.log("Game paused"))},i.resumeGame=function(){this.gameState===lN.PAUSED&&(this.gameState=lN.PLAYING,this.timer.resumeTimer(),this.detectionSystem.startDetection(),this.isScrolling=!0,console.log("Game resumed"))},i.endGame=function(t){this.gameState=lN.GAME_OVER,this.timer.stopTimer(),this.detectionSystem.stopDetection(),this.stopScrolling();var e=this.totalNotesMatched>0?this.totalAccuracy/this.totalNotesMatched*100:0;this.pitchUIManager.showResults(t,this.timer.getRemainingTime(),e),console.log("Game ended. Success: "+t+", Accuracy: "+e.toFixed(2)+"%")},i.startCalibration=function(){var t=this;this.gameState=lN.CALIBRATING,this.pitchUIManager.showCalibration(),this.detectionSystem.initialize().then((function(){return t.detectionSystem.requestMicrophoneAccess()})).then((function(e){e?t.detectionSystem.startCalibration((function(e){e?(console.log("Calibration completed successfully"),t.pitchUIManager.showMainMenu(),t.gameState=lN.INIT):console.error("Calibration failed")})):console.error("Failed to access microphone")})).catch((function(t){console.error("Error starting calibration:",t)}))},i.onPitchDetected=function(t){if(this.gameState===lN.PLAYING||this.gameState===lN.WAIT_FOR_FIRST_NOTE){this.waveformVisualizer&&this.waveformVisualizer.updateWaveformVisualization(t.volume,t.frequency,this.detectionSystem),this.pitchUIManager.updateCurrentNoteLabel(t.note),this.moveButterfly(t.note,t.volume,t.frequency);var e=this.getCurrentTargetNote();if(null!==e&&t.note===e){var i;this.gameState===lN.WAIT_FOR_FIRST_NOTE&&(this.transitionToPlaying(),console.log("First note matched, starting timer"));var n=I.totalTime/1e3-this.currentNoteStartTime;this.currentNoteStartTime=I.totalTime/1e3,this.currentNoteDuration+=n;var o=this.currentSequence.notes[this.currentNoteIndex].duration,r=this.currentNoteDuration/o,a=(null==(i=this.tilePositions[this.currentNoteIndex])?void 0:i.x)||0,s=o*this.scrollSpeed*r;this.targetScrollingPositionX=-a-s,this.currentNoteDuration>=o?(this.updateDurationProgress(1),this.currentNoteDuration=0,this.onNoteMatched(t.note,this.calculateDurationAccuracy(o))):this.updateDurationProgress(this.currentNoteDuration/o)}else this.currentNoteStartTime=I.totalTime/1e3,this.targetScrollingPositionX=this.containerPosition}},i.calculateDurationAccuracy=function(t){return this.currentNoteDuration/t>=this.PERFECT_DURATION_THRESHOLD?cN.PERFECT:cN.GOOD},i.updateDurationProgress=function(t){var e=this.noteIndexToTileMap.get(this.currentNoteIndex);e&&e.updateDurationProgress(t)},i.onNoteMatched=function(t,e){var i;switch(this.characterAnimator.playNoteAnimation(t,e),e){case cN.PERFECT:i=uN.PERFECT;break;case cN.GOOD:i=uN.GOOD;break;default:i=uN.MISS}this.pitchUIManager.showFeedback(i),this.totalNotesMatched++,this.totalAccuracy+=e===cN.PERFECT?1:e===cN.GOOD?.7:.3,this.advanceProgressLine(),this.advanceToNextNote()||this.endGame(!0)},i.transitionToPlaying=function(){this.gameState=lN.PLAYING,this.timer.startTimer(),this.isScrolling=!0,this.activeTiles.length>0&&this.activeTiles[0].setActive(!0)},i.checkNoteDuration=function(t){if(!this.currentSequence||this.currentNoteIndex>=this.currentSequence.notes.length)return!1;var e=this.currentSequence.notes[this.currentNoteIndex];return e.note===t&&this.currentNoteDuration>=e.duration},i.onTimeWarning=function(t){this.gameState===lN.PLAYING&&this.pitchUIManager.showTimeWarning(t)},i.onTimeUp=function(){this.gameState===lN.PLAYING&&this.endGame(!1)},i.update=function(t){if(this.gameState===lN.PLAYING){if(this.pitchUIManager.updateTimer(this.timer.getRemainingTime()),this.updateScrolling(t),this.isFirstNoteCorrect&&this.butterflyCamera){var e=this.butterflyCamera.position;this.butterflyCamera.setPosition(new g(e.x+this.BUTTERFLY_CAMERA_SPEED*t,e.y,e.z))}if(this.butterfly){var i=this.butterfly.position,n=i.y+(this.butterflyTargetY-i.y)*t*2;this.butterfly.setPosition(new g(i.x,n,i.z))}}},i.returnToMainMenu=function(){this.gameState!==lN.PLAYING&&this.gameState!==lN.PAUSED||(this.timer.stopTimer(),this.detectionSystem.stopDetection(),this.stopScrolling()),this.gameState=lN.INIT,this.currentSequence=null,this.currentNoteIndex=0,this.totalNotesMatched=0,this.totalAccuracy=0,this.pitchUIManager.showMainMenu()},i.restartGame=function(){this.currentSequence&&(this.gameState!==lN.PLAYING&&this.gameState!==lN.PAUSED||(this.timer.stopTimer(),this.detectionSystem.stopDetection(),this.stopScrolling()),this.startGame(this.currentSequence.id))},i.onDestroy=function(){this.detectionSystem.off(hN.EVENTS.PITCH_DETECTED,this.onPitchDetected,this),this.timer.off(hN.EVENTS.TIME_WARNING,this.onTimeWarning,this),this.timer.off(hN.EVENTS.GAME_OVER,this.onTimeUp,this)},i.moveButterfly=function(t,e,i){if(void 0===i&&(i=0),this.butterfly&&this.noteIndicators&&this.butterflyCamera){this.butterflyTween&&(this.butterflyTween.stop(),this.butterflyTween=null);var n=-150;if(null!==t){if(t>=0&&t<this.noteIndicators.length){var o=this.noteIndicators[t];o&&o.active&&(n=this.noteYPositions[t])}this.butterflyParticles&&(this.butterflyParticles.enabled=!0,this.butterflyParticles.emissionRate=100*e)}else{if(this.noteIndicators[0]&&this.noteIndicators[6]){var r=this.noteYPositions[0]-100,a=247.22;n=r+(this.noteYPositions[6]+100-r)*Math.max(0,Math.min(1,(i-a)/276.03))}this.butterflyParticles&&(this.butterflyParticles.enabled=!1)}this.butterflyTargetY=n,this.isFirstNoteCorrect||t!==this.getCurrentTargetNote()||(this.isFirstNoteCorrect=!0,v(this.butterfly).to(this.BUTTERFLY_MOVE_DURATION,{position:new g(0,n,-20)},{easing:"cubicOut"}).start())}},i.initializeScrolling=function(){if(this.currentSequence&&this.scrollingContainer){this.clearTiles(),this.containerPosition=0,this.scrollingContainer.setPosition(new g(0,0,0));for(var t=this.currentSequence.notes,e=0;e<t.length;e++)this.createTile(t[e],e);this.isScrolling=!1,this.currentNoteStartTime=0}},i.createTile=function(t,e){if(this.pitchTilePrefab&&this.scrollingContainer){var i=E(this.pitchTilePrefab);this.scrollingContainer.addChild(i);var n=i.getComponent(fL);if(n){n.initialize(t.note,t.duration,this.scrollSpeed);var o=this.tileStartX;if(e>0&&this.tilePositions.length>0){var r=this.activeTiles[e-1];o=this.tilePositions[e-1].x+r.getDuration()*this.scrollSpeed}var a=this.noteIndicators[t.note].position.y;this.tilePositions.push({x:o,y:a}),i.setPosition(new g(o,a,0)),this.activeTiles.push(n),this.noteIndexToTileMap.set(e,n)}}},i.clearTiles=function(){for(var t,e=Dt(this.activeTiles);!(t=e()).done;){var i=t.value;i&&i.node&&i.node.destroy()}this.activeTiles=[],this.tilePositions=[],this.noteIndexToTileMap.clear()},i.updateScrolling=function(t){this.isScrolling&&this.scrollingContainer&&(this.containerPosition+=(this.targetScrollingPositionX-this.containerPosition)*this.SCROLL_SMOOTHING_FACTOR,this.scrollingContainer.setPosition(new g(this.containerPosition,0,0)))},i.stopScrolling=function(){this.isScrolling=!1;for(var t,e=Dt(this.activeTiles);!(t=e()).done;){var i=t.value;i&&i.setActive(!1)}},i.advanceToNextNote=function(){if(!this.currentSequence)return!1;if(this.currentNoteIndex++,this.currentNoteIndex<this.currentSequence.notes.length){this.pitchUIManager.updateTargetNoteLabel(this.getCurrentTargetNote()),this.highlightNoteIndicator(this.currentSequence.notes[this.currentNoteIndex].note);var t=this.noteIndexToTileMap.get(this.currentNoteIndex);return t&&t.setActive(!0),!0}return this.stopScrolling(),!1},i.advanceProgressLine=function(){if(this.progressLine&&this.currentSequence){var t=this.currentSequence.notes.length,e=400*((this.currentNoteIndex+1)/t)-200,i=this.progressLine.position;v(this.progressLine).to(this.PROGRESS_LINE_MOVE_DURATION,{position:new g(e,i.y,i.z)},{easing:"cubicOut"}).start()}},i.getCurrentTargetNote=function(){return!this.currentSequence||this.currentNoteIndex>=this.currentSequence.notes.length?null:this.currentSequence.notes[this.currentNoteIndex].note},i.getCurrentSequence=function(){return this.currentSequence},i.getGameState=function(){return this.gameState},i.getCurrentNoteIndex=function(){return this.currentNoteIndex},i.getTotalNotes=function(){return this.currentSequence?this.currentSequence.notes.length:0},i.setupNoteIndicators=function(){if(this.noteIndicators){var t=this.getCurrentSequence();if(t){for(var e,i=Dt(this.noteIndicators);!(e=i()).done;){e.value.active=!1}for(var n=t.notes,o=0;o<n.length&&o<this.noteIndicators.length;o++){var r=n[o].note;r>=0&&r<this.noteIndicators.length&&(this.noteIndicators[r].active=!0)}this.highlightNoteIndicator(n[0].note)}}},i.highlightNoteIndicator=function(t){if(this.noteIndicators){for(var e=0;e<this.noteIndicators.length;e++){var i=this.noteIndicators[e];if(i&&i.active){var n=i.getComponent(f);n&&(n.color=new X(255,255,255,0))}}if(t>=0&&t<this.noteIndicators.length){var o=this.noteIndicators[t];if(o&&o.active){var r=o.getComponent(f);r&&(r.color=new X(255,255,0,125))}}}},e}(r)).prototype,"detectionSystem",[LO],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),JO=It(KO.prototype,"characterAnimator",[RO],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),QO=It(KO.prototype,"timer",[xO],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),$O=It(KO.prototype,"waveformVisualizer",[FO],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),tL=It(KO.prototype,"musicalStaff",[DO],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),eL=It(KO.prototype,"noteIndicators",[zO],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),iL=It(KO.prototype,"progressLine",[kO],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),nL=It(KO.prototype,"microphone",[VO],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),oL=It(KO.prototype,"pitchUIManager",[BO],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),rL=It(KO.prototype,"butterfly",[HO],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),aL=It(KO.prototype,"butterflyCamera",[UO],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),sL=It(KO.prototype,"butterflyParticles",[GO],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),lL=It(KO.prototype,"pitchTilePrefab",[WO],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),cL=It(KO.prototype,"scrollingContainer",[qO],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),uL=It(KO.prototype,"scrollSpeed",[ZO],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 100}}),hL=It(KO.prototype,"tileStartX",[YO],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 200}}),jO=KO));t._RF.pop(),t._RF.push({},"f3854cZ+7tJvbx0v7anFQPX","PopupLoading",void 0);var wL,TL,CL,EL,AL,PL,ML,IL,NL,OL=e.ccclass,LL=e.property;gL=OL("PopupLoading"),mL=LL(y),gL((bL=It((yL=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,Ot(e,"lbDetail",bL,Lt(e)),e}Nt(e,t);var i=e.prototype;return i.show=function(e,i){var n;t.prototype.show.call(this,e,i);var o=null!=(n=e)?n:"";this.lbDetail.string=o},i.setLoadingDetail=function(t){this.lbDetail.string=t},e}(lo)).prototype,"lbDetail",[mL],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),vL=yL));t._RF.pop(),t._RF.push({},"7cf33btXkBJaJszpFBOgTb7","PopupMessage",void 0);var RL,xL=e.ccclass,FL=e.property;wL=xL("PopupMessage"),TL=FL(y),CL=FL(y),EL=FL(y),wL((ML=It((PL=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,Ot(e,"lbContent",ML,Lt(e)),Ot(e,"lbTitle",IL,Lt(e)),Ot(e,"lbButtonText",NL,Lt(e)),e.confirmCallback=null,e}Nt(e,t);var i=e.prototype;return i.show=function(e,i){var n,o;t.prototype.show.call(this,e,i),e&&(this.confirmCallback=e.buttonCallback,this.lbContent.string=e.message,this.lbTitle.string=null!=(n=e.title)?n:"",this.lbButtonText.string=null!=(o=e.buttonText)?o:"OK")},i.onTouch_Confirm=function(){var t;null==(t=this.confirmCallback)||t.call(this),this.doUImanagerHide()},e}(lo)).prototype,"lbContent",[TL],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),IL=It(PL.prototype,"lbTitle",[CL],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),NL=It(PL.prototype,"lbButtonText",[EL],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),AL=PL));t._RF.pop(),t._RF.push({},"be613BiyadMYYQcjSzr/JtE","Bullet",void 0);var DL=e.ccclass,zL=(e.property,DL("Bullet")(RL=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).gravity=-18,e.elapsedTime=0,e.initialVelocity=new g(0,0,0),e.initialPosition=new g,e}Nt(e,t);var i=e.prototype;return i.shootWithVelocity=function(t){this.gravity=-ve.GAME.PHYSIC_GRAVITY,this.elapsedTime=0,this.initialVelocity=t,this.initialPosition.set(this.node.position)},i.stop=function(){this.initialVelocity=g.ZERO.clone()},i.update=function(t){this.elapsedTime+=t;var e=this.calculatePosition(this.elapsedTime);this.node.setPosition(e)},i.calculatePosition=function(t){var e=new g;return e.x=this.initialPosition.x+this.initialVelocity.x*t,e.y=this.initialPosition.y+this.initialVelocity.y*t+.5*this.gravity*t*t,e.z=this.initialPosition.z+this.initialVelocity.z*t,e},e}(r))||RL);t._RF.pop(),t._RF.push({},"ac60c1uuSNLz566NcMsAduq","MathUtil",void 0);var kL,VL,BL,HL,UL,GL,WL,qL,ZL,YL,jL,KL,XL,JL,QL,$L,tR,eR=180/Math.PI,iR=Math.PI/180,nR=function(){function t(){}return t.radiansToDegrees=function(t){return t*eR},t.degreesToRadians=function(t){return t*iR},t.clamp=function(t,e,i){return t<e?e:t>i?i:t},t.clamp01=function(e){return t.clamp(e,0,1)},t.lerp=function(e,i,n){return e+(i-e)*t.clamp01(n)},t.step=function(t,e){return e<t?0:1},t.smoothStep=function(e,i,n){return i*(n=-2*(n=t.clamp01(n))*n*n+3*n*n)+e*(1-n)},t.smoothDamp=function(e,i,n,o,r,a){r=null!=r?r:Number.POSITIVE_INFINITY,a=null!=a?a:I.deltaTime;var s=2/(o=Math.max(1e-4,o)),l=s*a,c=1/(1+l+.47999998927116394*l*l+.23499999940395355*l*l*l),u=e-i,h=i,p=r*o,d=t.clamp(u,-p,p),f=(n+s*d)*a,g=(n-s*f)*c,m=(i=e-d)+(d+f)*c;return h-e>0==m>h&&(g=((m=h)-h)/a),{value:m,velocity:g}},Ft(t,null,[{key:"rad2Deg",get:function(){return eR}},{key:"deg2Rad",get:function(){return iR}}]),t}();t._RF.pop(),t._RF.push({},"ee594FJk7xOGo9n2U0Qsd54","CameraController",void 0);var oR=e.ccclass,rR=e.property;kL=oR("CameraController"),VL=rR({type:c,displayName:"摄像机节点"}),BL=rR({type:c,displayName:"目标节点"}),HL=rR({displayName:"最小距离"}),UL=rR({displayName:"最大距离"}),GL=rR({displayName:"平滑时间"}),WL=rR({displayName:"鼠标滚轮敏感度"}),qL=rR({displayName:"双指触摸敏感度"}),kL((jL=It((YL=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,Ot(e,"cameraNode",jL,Lt(e)),Ot(e,"targetNode",KL,Lt(e)),Ot(e,"minDistance",XL,Lt(e)),Ot(e,"maxDistance",JL,Lt(e)),Ot(e,"smoothTime",QL,Lt(e)),Ot(e,"mouseSensitivity",$L,Lt(e)),Ot(e,"touchSensitivity",tR,Lt(e)),e.currentValue=0,e.targetValue=0,e.currentVelocity=0,e.lastTouchesDistance=null,e.tempVec3=new g,e}Nt(e,t);var i=e.prototype;return i.onLoad=function(){this.init(),this.registerEvent()},i.onDestroy=function(){this.unregisterEvent()},i.registerEvent=function(){S.platform===S.Platform.MOBILE_BROWSER?(D.on(z.EventType.TOUCH_MOVE,this.onTouchMove,this),D.on(z.EventType.TOUCH_END,this.onTouchEnd,this)):D.on(z.EventType.MOUSE_WHEEL,this.onMouseWheel,this)},i.unregisterEvent=function(){S.platform===S.Platform.MOBILE_BROWSER?(D.off(z.EventType.TOUCH_MOVE,this.onTouchMove,this),D.off(z.EventType.TOUCH_END,this.onTouchEnd,this)):D.off(z.EventType.MOUSE_WHEEL,this.onMouseWheel,this)},i.init=function(){var t;this.cameraNode.lookAt(this.targetNode.getWorldPosition()),t=S.platform===S.Platform.MOBILE_BROWSER?15:8,this.setTarget(t)},i.onMouseWheel=function(t){var e=t.getScrollY()*this.mouseSensitivity;this.setTarget(this.targetValue-e)},i.onTouchMove=function(t){var e=t.getAllTouches();if(!(e.length<2)){var i=K.distance(e[0].getLocation(),e[1].getLocation());if(null!==this.lastTouchesDistance){var n=(i-this.lastTouchesDistance)*this.touchSensitivity;this.setTarget(this.targetValue-n)}this.lastTouchesDistance=i}},i.onTouchEnd=function(t){this.lastTouchesDistance=null},i.update=function(t){if(this.currentValue!==this.targetValue){var e=nR.smoothDamp(this.currentValue,this.targetValue,this.currentVelocity,this.smoothTime);this.currentVelocity=e.velocity,this.setCurrent(e.value)}},i.setCurrent=function(t){var e=g.subtract(this.tempVec3,this.cameraNode.getWorldPosition(),this.targetNode.getWorldPosition());e.normalize().multiplyScalar(t),this.cameraNode.setWorldPosition(e),this.currentValue=t},i.setTarget=function(t){this.targetValue=nR.clamp(t,this.minDistance,this.maxDistance)},e}(r)).prototype,"cameraNode",[VL],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),KL=It(YL.prototype,"targetNode",[BL],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),XL=It(YL.prototype,"minDistance",[HL],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 5}}),JL=It(YL.prototype,"maxDistance",[UL],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 50}}),QL=It(YL.prototype,"smoothTime",[GL],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.1}}),$L=It(YL.prototype,"mouseSensitivity",[WL],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.05}}),tR=It(YL.prototype,"touchSensitivity",[qL],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.05}}),ZL=YL));t._RF.pop(),t._RF.push({},"cc22b8mSmVF0q6lb6/6cNhf","ProjectileMath",void 0);var aR=180/Math.PI,sR=Math.PI/180,lR=function(){function t(){}return t.calculateTotalTime=function(t,e,i){var n=e*sR;return t/(i*Math.cos(n))},t.calculateAngleAtMoment=function(e,i,n,o){void 0===o&&(o=!1);var r=t.gravity,a=e*sR,s=i*Math.cos(a),l=i*Math.sin(a)-r*n,c=Math.atan(l/s);return o?c:c*aR},t.calculateDisplacementAtMoment=function(e,i,n){var o=t.gravity,r=e*sR;return{x:i*Math.cos(r)*n,y:i*Math.sin(r)*n-.5*o*Math.pow(n,2)}},t.calculateWithAngle=function(t,e,i){var n=ve.GAME.PHYSIC_GRAVITY,o=i*sR,r=2*t*Math.sin(o)*Math.cos(o)-2*e*Math.pow(Math.cos(o),2);return r<0?NaN:Math.sqrt(n*Math.pow(t,2)/r)},t.calculateWithVelocity=function(e,i,n){var o=t.gravity,r=n,a=Math.pow(r,2),s=Math.pow(r,4)-o*(o*Math.pow(e,2)+2*i*a);if(s<0)return{angle1:NaN,angle2:NaN};var l=Math.sqrt(s),c=Math.atan((-a+l)/(-o*e)),u=Math.atan((-a-l)/(-o*e));return{angle1:c*aR,angle2:u*aR}},t.calculateWithMaxHeight=function(e,i,n){var o=t.gravity,r=n;if(r<0||r-i<0)return{angle:NaN,velocity:NaN,time:NaN};var a=Math.sqrt(2*o*r),s=Math.sqrt(2*o*(r-i)),l=(-a+s)/-o,c=(-a-s)/-o,u=Math.max(l,c),h=Math.atan(a*u/e),p=a/Math.sin(h);return{angle:h*aR,velocity:p,time:u}},Ft(t,null,[{key:"gravity",get:function(){return ve.GAME.PHYSIC_GRAVITY}}]),t}();t._RF.pop(),t._RF.push({},"59f54A7NwlOiY/boc9L5zON","VectorUtil",void 0);var cR,uR,hR,pR,dR,fR,gR,mR,vR,yR=180/Math.PI,bR=new g,_R=function(){function t(){}return t.projectOnPlane=function(t,e){var i=g.dot(t,e),n=bR.set(e).multiplyScalar(i);return g.subtract(new g,t,n)},t.signedAngle=function(e,i,n){var o=t.projectOnPlane(e,n),r=t.projectOnPlane(i,n),a=o.normalize(),s=r.normalize(),l=g.cross(new g,a,s).normalize(),c=g.dot(l,n);return Math.acos(g.dot(a,s))*c*yR},t}();t._RF.pop(),t._RF.push({},"01c94oOie9EDZDjFFfzDe9j","TrajectoryDrawer",void 0);var SR,wR,TR,CR,ER,AR,PR,MR,IR,NR,OR,LR,RR,xR,FR,DR,zR,kR,VR,BR,HR,UR,GR,WR,qR,ZR,YR,jR=e.ccclass,KR=e.property,XR=(cR=jR("TrajectoryDrawer"),uR=KR({type:l,displayName:"prefab"}),hR=KR({displayName:"fixedQuantity"}),pR=KR({visible:function(){return this.fixedQuantity},displayName:"quantity"}),cR((gR=It((fR=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,Ot(e,"prefab",gR,Lt(e)),Ot(e,"fixedQuantity",mR,Lt(e)),Ot(e,"quantity",vR,Lt(e)),e.points=[],e.nodePool=new et,e.tempVec3=new g,e.tempQuat=new St,e}Nt(e,t);var i=e.prototype;return i.draw=function(t,e,i,n,o,r){var a,s=g.subtract(new g,e,t),l=_R.projectOnPlane(s,g.UP),c=null!=o?o:l.length(),u=lR.calculateTotalTime(c,i,n)/(a=this.fixedQuantity?Math.ceil(this.quantity):Math.max(8,Math.ceil(3*c)));this.producePoints(a);for(var h=l.normalize(),p=this.points,d=this.tempVec3,f=this.tempQuat,m=0;m<a;m++){var v=p[m];v.active=!0;var y=(m+1)*u,b=lR.calculateDisplacementAtMoment(i,n,y),_=b.x,S=b.y,w=t.clone();w.add(d.set(h).multiplyScalar(_)),w.add(d.set(g.UP).multiplyScalar(S)),v.setWorldPosition(w);var T=St.fromViewUp(f,h,g.UP),C=-lR.calculateAngleAtMoment(i,n,y,!0);St.rotateX(T,T,C),v.setWorldRotation(T)}},i.clear=function(){this.producePoints(0)},i.setColor=function(t){var e=this.prefab.data.getComponent(ht);e||(e=this.prefab.data.getComponentInChildren(ht)),e&&e.sharedMaterial.setProperty("mainColor",t)},i.producePoints=function(t){var e=this.points;if(e.length<t)for(var i=t-e.length;i>0;)e.push(this.getPoint()),i--;else if(e.length>t)for(var n=e.length-t;n>0;)this.putPoint(e.pop()),n--},i.getPoint=function(){var t;return(t=this.nodePool.size()>0?this.nodePool.get():E(this.prefab)).setParent(this.node),t},i.putPoint=function(t){this.nodePool.size()<50?this.nodePool.put(t):t.destroy()},e}(r)).prototype,"prefab",[uR],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),mR=It(fR.prototype,"fixedQuantity",[hR],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),vR=It(fR.prototype,"quantity",[pR],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 20}}),dR=fR))||dR);t._RF.pop(),t._RF.push({},"af3dac0xL5BLrK8YABTwvI2","Cannon",void 0);var JR,QR,$R,tx,ex,ix,nx,ox=e.ccclass,rx=e.property,ax=function(t){return t[t.FIXED_ALL=1]="FIXED_ALL",t[t.FIXED_PITCH_ANGLE=2]="FIXED_PITCH_ANGLE",t[t.FIXED_VELOCITY=3]="FIXED_VELOCITY",t[t.UNFIXED=4]="UNFIXED",t}(ax||{}),sx=(SR=ox("Cannon"),wR=rx({type:c,displayName:"yawAxis",group:{name:"Configs",id:"1"}}),TR=rx({type:c,displayName:"pitchAxis",group:{name:"Configs",id:"1"}}),CR=rx({type:c,displayName:"firePoint",group:{name:"Configs",id:"1"}}),ER=rx({type:l,displayName:"bulletPrefab",group:{name:"model",id:"2"}}),AR=rx({type:c,group:{name:"model",id:"2"}}),PR=rx({type:L(ax),displayName:"mode",group:{name:"settings",id:"3"}}),MR=rx({displayName:"fixedPitchAngle",visible:function(){return this.mode===ax.FIXED_PITCH_ANGLE||this.mode===ax.FIXED_ALL},group:{name:"settings",id:"3"}}),IR=rx({displayName:"fixedVelocity",visible:function(){return this.mode===ax.FIXED_VELOCITY||this.mode===ax.FIXED_ALL},group:{name:"settings",id:"3"}}),NR=rx({displayName:"useSmallPitchAngle",visible:function(){return this.mode===ax.FIXED_VELOCITY},group:{name:"settings",id:"3"}}),OR=rx({type:XR,displayName:"trajectoryDrawer",group:{name:"trajectory",id:"4"}}),LR=rx({displayName:"showTrajectory",visible:function(){return null!=this.trajectoryDrawer},group:{name:"trajectory",id:"4"}}),RR=rx({type:[lt],group:{name:"Animation",id:"5"}}),SR((DR=It((FR=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,Ot(e,"yawAxis",DR,Lt(e)),Ot(e,"pitchAxis",zR,Lt(e)),Ot(e,"firePoint",kR,Lt(e)),Ot(e,"bulletPrefab",VR,Lt(e)),Ot(e,"bulletContainer",BR,Lt(e)),Ot(e,"mode",HR,Lt(e)),Ot(e,"fixedPitchAngle",UR,Lt(e)),Ot(e,"fixedVelocity",GR,Lt(e)),Ot(e,"useSmallPitchAngle",WR,Lt(e)),Ot(e,"trajectoryDrawer",qR,Lt(e)),Ot(e,"_showTrajectory",ZR,Lt(e)),e.velocity=0,e.curTargetPos=new g(0,.753,-7.671),Ot(e,"shootAnimations",YR,Lt(e)),e.shootAnimationState=[],e}Nt(e,t);var i=e.prototype;return i.rotateTo=function(t,e){this.pitch=t,this.yaw=e},i.aim=function(t){this.curTargetPos.set(t);var e=g.subtract(new g,t,this.mainPosition),i=-_R.signedAngle(e,this.mainForward,this.mainUp),n=NaN,o=NaN,r=NaN,a=!1;switch(this.mode){case ax.FIXED_ALL:n=this.fixedPitchAngle,r=this.fixedVelocity,a=!0;break;case ax.FIXED_PITCH_ANGLE:n=this.fixedPitchAngle,r=this.calculateVelocity(t,-n);break;case ax.FIXED_VELOCITY:r=this.fixedVelocity;var s=this.calculateAngle(t,r),l=s.angle1,c=s.angle2;isNaN(l)||isNaN(c)?a=!0:n=this.useSmallPitchAngle?-Math.min(l,c):-Math.max(l,c);break;case ax.UNFIXED:var u=this.calculateWithMaxHeight(t);n=-u.angle,r=u.velocity,o=u.time}return isNaN(n)&&(n=this.pitch),this.rotateTo(n,i),isNaN(r)||(this.velocity=r),this.trajectoryDrawer&&this.drawTrajectory(t,-this.pitch,this.velocity,a),{time:o,velocity:r,pitchAngle:n}},i.fire=function(t){var e=0;t&&(e=this.aim(t).time);var i=this.shoot(this.velocity);return v(this.yawAxis).to(.1,{position:m(0,-.1,.035)}).to(.35,{position:m(0,0,0)},{easing:_.quartOut}).start(),{flyTime:e,bullet:i}},i.shoot=function(t){var e=this.generateBullet(),i=e.forward.negative();i.multiplyScalar(t);var n=e.getComponent(zL);return n.shootWithVelocity(i),n},i.drawTrajectory=function(t,e,i,n){var o=this.firePoint.getWorldPosition();if(n){var r=lR.calculateDisplacementAtMoment(e,i,2).x;this.trajectoryDrawer.draw(o,t,e,i,r)}else this.trajectoryDrawer.draw(o,t,e,i)},i.generateBullet=function(){var t=E(this.bulletPrefab);return M.getScene().addChild(t),t.setWorldPosition(this.firePoint.getWorldPosition()),t.setWorldRotation(this.firePoint.getWorldRotation()),t},i.calculateDisplacement=function(t){var e=this.firePoint.getWorldPosition(),i=g.subtract(new g,t,e),n=i.y;return{horizontal:_R.projectOnPlane(i,g.UP).length(),vertical:n}},i.calculateVelocity=function(t,e){var i=this.calculateDisplacement(t),n=i.horizontal,o=i.vertical;return lR.calculateWithAngle(n,o,e)},i.calculateAngle=function(t,e){var i=this.calculateDisplacement(t),n=i.horizontal,o=i.vertical;return lR.calculateWithVelocity(n,o,e)},i.calculateWithMaxHeight=function(t){var e=this.calculateDisplacement(t),i=e.horizontal,n=e.vertical,o=Math.max(.5,n+.3*i);return lR.calculateWithMaxHeight(i,n,o)},i.fireWithAnimation=function(t,e){var i=this;this.shootAnimationState=[],this.shootAnimations.forEach((function(t){var e=t.getState("Shoot");e.speed=1,e.time=0,e.play(),i.shootAnimationState.push(e)})),this.scheduleOnce((function(){var n=i.fire(t),o=n.flyTime,r=n.bullet;i.scheduleOnce((function(){null==e||e(r)}),o),ji.instance.playSound("sfx_CannonWars_Shoot")}),.6)},Ft(e,[{key:"showTrajectory",get:function(){return this._showTrajectory},set:function(t){this._showTrajectory=t,this.trajectoryDrawer&&(t?this.curTargetPos&&this.aim(this.curTargetPos):this.trajectoryDrawer.clear())}},{key:"pitch",get:function(){return this.pitchAxis.eulerAngles.x},set:function(t){this.pitchAxis.setRotationFromEuler(t,0,0)}},{key:"yaw",get:function(){return this.yawAxis.eulerAngles.y},set:function(t){this.yawAxis.setRotationFromEuler(0,t,0)}},{key:"mainPosition",get:function(){return this.yawAxis.getWorldPosition()}},{key:"mainForward",get:function(){return this.yawAxis.parent.forward.negative()}},{key:"mainUp",get:function(){return this.yawAxis.up}}],[{key:"Mode",get:function(){return ax}}]),e}(r)).prototype,"yawAxis",[wR],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),zR=It(FR.prototype,"pitchAxis",[TR],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),kR=It(FR.prototype,"firePoint",[CR],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),VR=It(FR.prototype,"bulletPrefab",[ER],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),BR=It(FR.prototype,"bulletContainer",[AR],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),HR=It(FR.prototype,"mode",[PR],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return ax.FIXED_PITCH_ANGLE}}),UR=It(FR.prototype,"fixedPitchAngle",[MR],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-45}}),GR=It(FR.prototype,"fixedVelocity",[IR],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 5}}),WR=It(FR.prototype,"useSmallPitchAngle",[NR],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),qR=It(FR.prototype,"trajectoryDrawer",[OR],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ZR=It(FR.prototype,"_showTrajectory",[rx],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),It(FR.prototype,"showTrajectory",[LR],Object.getOwnPropertyDescriptor(FR.prototype,"showTrajectory"),FR.prototype),YR=It(FR.prototype,"shootAnimations",[RR],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),xR=FR))||xR);t._RF.pop(),t._RF.push({},"3e784wgXb5FD6qDmQMPWi5v","Cursor",void 0);var lx,cx,ux,hx,px,dx,fx,gx=e.ccclass,mx=e.property,vx=(JR=gx("Cursor"),QR=mx({displayName:"adaptToSurface"}),$R=mx({type:c,displayName:"referNode",visible:function(){return this.adaptToSurface}}),JR((ix=It((ex=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,Ot(e,"_adaptToSurface",ix,Lt(e)),Ot(e,"referNode",nx,Lt(e)),e.tempVec3=new g,e.tempQuat=new St,e}return Nt(e,t),e.prototype.set=function(t,e){if(this.node.setWorldPosition(t),this.adaptToSurface&&e){var i,n,o=null!=(i=null==(n=this.referNode)?void 0:n.getWorldPosition())?i:g.ZERO,r=g.subtract(this.tempVec3,t,o),a=_R.projectOnPlane(r,e).normalize(),s=St.fromViewUp(this.tempQuat,a,e);this.node.setWorldRotation(s)}},Ft(e,[{key:"adaptToSurface",get:function(){return this._adaptToSurface},set:function(t){this._adaptToSurface=t,t||this.node.setWorldRotation(St.fromEuler(new St,0,0,0))}}]),e}(r)).prototype,"_adaptToSurface",[mx],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),It(ex.prototype,"adaptToSurface",[QR],Object.getOwnPropertyDescriptor(ex.prototype,"adaptToSurface"),ex.prototype),nx=It(ex.prototype,"referNode",[$R],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),tx=ex))||tx);t._RF.pop(),t._RF.push({},"b1385xAyyhPB6TsvEBSW4MY","EffectManger",void 0);var yx,bx,_x,Sx,wx,Tx,Cx,Ex,Ax,Px=e.ccclass,Mx=e.property,Ix=e.executionOrder;lx=Px("EffectManger"),cx=Ix(-1),ux=Mx({type:l,displayName:"炮弹爆炸效果预制体"}),lx(hx=cx(((fx=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,Ot(e,"bulletExplosionPrefab",dx,Lt(e)),e}Nt(e,t);var i=e.prototype;return i.onLoad=function(){e._instance=this},i.onDestroy=function(){e._instance===this&&(e._instance=null)},i.playBulletExplosion=function(t){var e=E(this.bulletExplosionPrefab);M.getScene().addChild(e),e.setWorldPosition(t),this.scheduleOnce((function(){return e.destroy()}),1)},Ft(e,null,[{key:"instance",get:function(){return this._instance}}]),e}(r))._instance=null,dx=It((px=fx).prototype,"bulletExplosionPrefab",[ux],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),hx=px))||hx);t._RF.pop(),t._RF.push({},"065763s9dBIZrOHBYD+VlHO","ProjectileController",void 0);var Nx,Ox,Lx,Rx,xx,Fx,Dx,zx=e.ccclass,kx=e.property;yx=zx("ProjectileController"),bx=kx({type:_t}),_x=kx({type:sx}),Sx=kx({type:vx}),yx((Cx=It((Tx=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,Ot(e,"camera",Cx,Lt(e)),Ot(e,"cannon",Ex,Lt(e)),Ot(e,"cursor",Ax,Lt(e)),e.isActive=!1,e.aimValue={value:0},e.tweenAim=null,e.beginAimPosition=null,e.targetAimPosition=null,e}Nt(e,t);var i=e.prototype;return i.onLoad=function(){},i.onDestroy=function(){},i.update=function(t){this.updateAimPosition(t)},i.registerEvent=function(){S.platform===S.Platform.MOBILE_BROWSER?(D.on(z.EventType.TOUCH_START,this.onTouchStart,this),D.on(z.EventType.TOUCH_MOVE,this.onTouchMove,this),D.on(z.EventType.TOUCH_END,this.onTouchEnd,this)):(D.on(z.EventType.MOUSE_DOWN,this.onMouseDown,this),D.on(z.EventType.MOUSE_MOVE,this.onMouseMove,this),D.on(z.EventType.MOUSE_UP,this.onMouseUp,this))},i.unregisterEvent=function(){S.platform===S.Platform.MOBILE_BROWSER?(D.off(z.EventType.TOUCH_START,this.onTouchStart,this),D.off(z.EventType.TOUCH_MOVE,this.onTouchMove,this),D.off(z.EventType.TOUCH_END,this.onTouchEnd,this)):(D.off(z.EventType.MOUSE_DOWN,this.onMouseDown,this),D.off(z.EventType.MOUSE_MOVE,this.onMouseMove,this),D.off(z.EventType.MOUSE_UP,this.onMouseUp,this))},i.onTouchStart=function(t){t.getAllTouches().length>1||this.aimWithScreenPos(t.getLocation())},i.onTouchMove=function(t){t.getAllTouches().length>1||this.aimWithScreenPos(t.getLocation())},i.onTouchEnd=function(t){t.getAllTouches().length>0||(this.aimWithScreenPos(t.getLocation()),this.fire())},i.onMouseDown=function(t){this.aimWithScreenPos(t.getLocation())},i.onMouseMove=function(t){this.aimWithScreenPos(t.getLocation())},i.onMouseUp=function(t){this.fire()},i.aimWithScreenPos=function(t){if(this.isActive){var e=this.camera.screenPointToRay(t.x,t.y);if(wt.instance.raycastClosest(e)){var i=wt.instance.raycastClosestResult,n=i.hitPoint,o=i.hitNormal;this.cannon.aim(n),this.cursor.set(n,o)}}},i.aimToPosition=function(t,e,i){var n,o=this;if(void 0===e&&(e=0),void 0===i&&(i=null),e<=0)return this.cannon.aim(t),void this.cursor.set(t,g.FORWARD);this.aimValue.value=0,this.beginAimPosition=this.cannon.curTargetPos.clone(),this.targetAimPosition=t.clone(),null==(n=this.tweenAim)||n.stop(),this.tweenAim=v(this.aimValue).to(e,{value:1}).call((function(){o.tweenAim=null,o.cannon.aim(o.targetAimPosition),o.cursor.set(o.targetAimPosition,g.FORWARD),null==i||i()})).start()},i.updateAimPosition=function(t){if(null!==this.tweenAim){var e=g.lerp(new g,this.beginAimPosition,this.targetAimPosition,this.aimValue.value);this.cannon.aim(e),this.cursor.set(e,g.FORWARD)}},i.fire=function(){this.cannon.fire()},e}(r)).prototype,"camera",[bx],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ex=It(Tx.prototype,"cannon",[_x],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ax=It(Tx.prototype,"cursor",[Sx],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),wx=Tx));t._RF.pop(),t._RF.push({},"a48dbUuDTJPDp+LzPEDK4rA","ClickToLoadUrl",void 0);var Vx,Bx,Hx,Ux,Gx,Wx,qx,Zx,Yx,jx,Kx,Xx,Jx,Qx,$x,tF,eF,iF,nF,oF,rF,aF,sF,lF=e.ccclass,cF=e.property;Nx=lF("ClickToLoadUrl"),Ox=cF({multiline:!0}),Lx=cF({tooltip:"是否使用新窗口打开"}),Nx((Fx=It((xx=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,Ot(e,"url",Fx,Lt(e)),Ot(e,"openInNewTap",Dx,Lt(e)),e}Nt(e,t);var i=e.prototype;return i.onLoad=function(){this.registerEvent()},i.onDestroy=function(){this.unregisterEvent()},i.registerEvent=function(){this.node.on(c.EventType.TOUCH_END,this.onClick,this)},i.unregisterEvent=function(){this.node.off(c.EventType.TOUCH_END,this.onClick,this)},i.onClick=function(){var t=this.url;t&&""!==t&&(this.openInNewTap?window.open(t):window.location.href=t)},e}(r)).prototype,"url",[Ox],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"https://gitee.com/ifaswind"}}),Dx=It(xx.prototype,"openInNewTap",[Lx],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Rx=xx));t._RF.pop(),t._RF.push({},"1b4097H5s5E1YZkd5DJRPR9","HUD_Options",void 0);var uF,hF,pF,dF,fF,gF=e.ccclass,mF=e.property;Vx=gF("HUD_Options"),Bx=mF({type:c}),Hx=mF({type:c}),Ux=mF({type:Tt}),Gx=mF({type:Ct}),Wx=mF({type:Ct}),qx=mF({type:k}),Zx=mF({type:k}),Yx=mF({type:k}),jx=mF({type:sx}),Kx=mF({type:vx}),Vx((Qx=It((Jx=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,Ot(e,"content",Qx,Lt(e)),Ot(e,"arrow",$x,Lt(e)),Ot(e,"cannonModeToggleContainer",tF,Lt(e)),Ot(e,"cannonAngleEditBox",eF,Lt(e)),Ot(e,"cannonVelocityEditBox",iF,Lt(e)),Ot(e,"cannonTrajectoryToggle",nF,Lt(e)),Ot(e,"bulletExplodeToggle",oF,Lt(e)),Ot(e,"cursorAdaptToggle",rF,Lt(e)),Ot(e,"cannon",aF,Lt(e)),Ot(e,"cursor",sF,Lt(e)),e}Nt(e,t);var i=e.prototype;return i.onLoad=function(){this.init(),this.registerEvent()},i.onDestroy=function(){this.unregisterEvent()},i.registerEvent=function(){this.node.on(c.EventType.TOUCH_END,this.onTouchEnd,this)},i.unregisterEvent=function(){this.node.off(c.EventType.TOUCH_END,this.onTouchEnd,this)},i.onTouchEnd=function(t){this.changeState(!this.content.active)},i.init=function(){S.platform===S.Platform.MOBILE_BROWSER?this.node.setScale(new g(2,2,1)):this.node.setScale(new g(1,1,1)),this.changeState(!0);for(var t=sx.Mode[this.cannon.mode],e=this.cannonModeToggleContainer.toggleItems,i=0;i<e.length;i++)e[i].node.name===t&&(e[i].isChecked=!0);this.cannonAngleEditBox.string=this.cannon.fixedPitchAngle.toString(),this.cannonAngleEditBox.placeholder=this.cannon.fixedPitchAngle.toString(),this.cannonVelocityEditBox.string=this.cannon.fixedVelocity.toString(),this.cannonVelocityEditBox.placeholder=this.cannon.fixedVelocity.toString(),this.cannonTrajectoryToggle.isChecked=this.cannon.showTrajectory,this.bulletExplodeToggle.isChecked=zL.triggerExplode,this.cursorAdaptToggle.isChecked=this.cursor.adaptToSurface,this.changeState(!1)},i.changeState=function(t){this.content.active=t,this.arrow.angle=t?180:0},i.onCannonModeToggleChanged=function(t){switch(this.cannonModeToggleContainer.activeToggles()[0].node.name){case"FIXED_ALL":this.cannon.mode=sx.Mode.FIXED_ALL,this.cannonAngleEditBox.node.parent.active=!0,this.cannonVelocityEditBox.node.parent.active=!0;break;case"FIXED_PITCH_ANGLE":this.cannon.mode=sx.Mode.FIXED_PITCH_ANGLE,this.cannonAngleEditBox.node.parent.active=!0,this.cannonVelocityEditBox.node.parent.active=!1;break;case"FIXED_VELOCITY":this.cannon.mode=sx.Mode.FIXED_VELOCITY,this.cannonAngleEditBox.node.parent.active=!1,this.cannonVelocityEditBox.node.parent.active=!0;break;case"UNFIXED":this.cannon.mode=sx.Mode.UNFIXED,this.cannonAngleEditBox.node.parent.active=!1,this.cannonVelocityEditBox.node.parent.active=!1}},i.onCannonAngleEditBoxChanged=function(t){var e=Number(this.cannonAngleEditBox.string);isNaN(e)||e>0?this.cannonAngleEditBox.string=this.cannon.fixedPitchAngle.toString():this.cannon.fixedPitchAngle=e},i.onCannonVelocityEditBoxChanged=function(t){var e=Number(this.cannonVelocityEditBox.string);isNaN(e)||e<=0?this.cannonVelocityEditBox.string=this.cannon.fixedVelocity.toString():this.cannon.fixedVelocity=e},i.onCannonTrajectoryToggleChanged=function(t){var e=this.cannonTrajectoryToggle.isChecked;this.cannon.showTrajectory=e},i.onBulletExplodeToggleChanged=function(t){var e=this.bulletExplodeToggle.isChecked;zL.triggerExplode=e},i.onCursorAdaptToggleChanged=function(t){var e=this.cursorAdaptToggle.isChecked;this.cursor.adaptToSurface=e},e}(r)).prototype,"content",[Bx],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),$x=It(Jx.prototype,"arrow",[Hx],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),tF=It(Jx.prototype,"cannonModeToggleContainer",[Ux],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),eF=It(Jx.prototype,"cannonAngleEditBox",[Gx],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),iF=It(Jx.prototype,"cannonVelocityEditBox",[Wx],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),nF=It(Jx.prototype,"cannonTrajectoryToggle",[qx],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),oF=It(Jx.prototype,"bulletExplodeToggle",[Zx],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),rF=It(Jx.prototype,"cursorAdaptToggle",[Yx],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),aF=It(Jx.prototype,"cannon",[jx],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),sF=It(Jx.prototype,"cursor",[Kx],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Xx=Jx));t._RF.pop(),t._RF.push({},"8d90ax9dDlNL5GpGoJYpjmB","HUD_Tips",void 0);var vF=e.ccclass,yF=e.property;uF=vF("HUD_Tips"),hF=yF({type:y}),uF((fF=It((dF=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return e=t.call.apply(t,[this].concat(n))||this,Ot(e,"label",fF,Lt(e)),e}Nt(e,t);var i=e.prototype;return i.onLoad=function(){this.init()},i.init=function(){S.platform===S.Platform.MOBILE_BROWSER?(this.node.setScale(new g(1.5,1.5,1)),this.label.string="双指滑动可以调整摄像机距离"):(this.node.setScale(new g(1,1,1)),this.label.string="鼠标滚轮可以调整摄像机距离")},e}(r)).prototype,"label",[hF],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),pF=dF));t._RF.pop(),t._RF.push({},"298c3IQrZBP6Lx7XE+N393z","type",void 0);var bF=function(t){return t[t.Min=0]="Min",t[t.Max=1]="Max",t[t.Fixed=2]="Fixed",t[t.Texture=3]="Texture",t}({});bF._name="ConcretePrecisionType";var _F=function(t){return t[t.Texture2D=100]="Texture2D",t[t.TextureCube=101]="TextureCube",t}({});_F._name="TextureConcretePrecision";var SF=function(t){return t[t.Local=0]="Local",t[t.View=1]="View",t[t.World=2]="World",t}({});SF._name="PositionSpace";var wF=function(t){return t[t.Local=0]="Local",t[t.View=1]="View",t[t.World=2]="World",t}({});wF._name="NormalSpace";var TF=function(t){return t[t.Local=0]="Local",t[t.View=1]="View",t[t.World=2]="World",t}({});TF._name="ViewDirSpace",t._RF.pop(),t._RF.push({},"7ceabXBz/tABa7CTXDAMxJn","utils",void 0);var CF=globalThis.electron,EF=CF&&globalThis.require("fs-extra"),AF=CF&&globalThis.require("path");function PF(t){if("number"!=typeof t)return t;var e=t+"";return e.includes(".")||(e+="."),e}var MF=["x","y","z","w"],IF=["r","g","b","a"],NF=["e00","e01","e02","e03"];function OF(t,e){return PF(function(t,e){return"number"==typeof t?t:(void 0!==t.x?i=MF:void 0!==t.r?i=IF:void 0!==t.e00&&(i=NF),t[i[e]]||0);var i}(t,e))}function LF(t){var e=1;return"object"==typeof t&&(void 0!==t.w||void 0!==t.a?e=4:void 0!==t.z||void 0!==t.b?e=3:void 0!==t.y||void 0!==t.g?e=2:void 0!==t.m_SerializedTexture?e=_F.Texture2D:void 0!==t.m_SerializedCubemap&&(e=_F.TextureCube)),e}function RF(t,e){var i="";return"boolean"===e?i="bool":1===t?i="float":2===t?i="vec2":3===t?i="vec3":4===t?i="vec4":t===_F.Texture2D?i="sampler2D":t===_F.TextureCube&&(i="samplerCube"),i}function xF(t,e,i,n,o){void 0===o&&(o={});var r={display:t,default:e,type:i,connectType:n};return Object.assign(r,o),r}function FF(t,e,i,n){void 0===n&&(n={});var o={display:t,default:e,type:i};return Object.assign(o,n),o}function DF(t,e){return("CC_"+t._name.replace("Space","")+"_"+t[e]).toUpperCase()}function zF(t,e){return"#define "+DF(t,e)+" 1"}function kF(t,e){var i,n;return(i=t,n=Object.getOwnPropertyNames(i),n.filter((function(t){return Number.isNaN(Number.parseFloat(t))&&"_name"!==t}))).forEach((function(i){var n=DF(t,t[i]);e.includes(n)||(e+="#define "+n+" 0\n")})),e}t._RF.pop(),t._RF.push({},"b05a8ea74hDTb7wArT51Kxn","property",void 0);var VF=function(t){return t.Float="Float",t.Boolean="Boolean",t.Vector2="Vector2",t.Vector3="Vector3",t.Vector4="Vector4",t.Color="Color",t.Texture2D="Texture2D",t.TextureCube="TextureCube",t}({}),BF=function(){function t(t){this.details={menu:"",style:{headerColor:"#ec7063"}},this.name="",this.type=VF.Float,this.value=0,this.outputs=[],this.type="string"==typeof t?VF[t]:t,this.name=VF[t],this.details.menu=this.name,this.updateDefaultValue()}var e=t.prototype;return e.setValue=function(t){this.value instanceof Et?this.value.set(t):this.type===VF.Texture2D||this.type===VF.TextureCube?this.value._uuid=t.uuid:this.value=t},e.updateDefaultValue=function(){switch(this.type){case VF.Float:this.value=0,this.outputs=[xF("Out",this.value,"float","vector")];break;case VF.Boolean:this.value=!1,this.outputs=[xF("Out",this.value,"boolean","boolean")];break;case VF.Vector2:this.value=new K,this.outputs=[xF("Out",this.value,"vec2","vector")];break;case VF.Vector3:this.value=new g,this.outputs=[xF("Out",this.value,"vec3","vector")];break;case VF.Vector4:this.value=new Pt,this.outputs=[xF("Out",this.value,"vec4","vector")];break;case VF.Color:this.value=new X,this.outputs=[xF("Out",this.value,"color","vector")];break;case VF.Texture2D:this.value=new p,this.outputs=[xF("Out",this.value,"texture2D","texture2D")];break;case VF.TextureCube:this.value=new At,this.outputs=[xF("Out",this.value,"textureCube","textureCube")]}},e.isTexture=function(){switch(this.type){case VF.Texture2D:case VF.TextureCube:return!0}return!1},Ft(t,[{key:"concretePrecision",get:function(){return LF(this.value)}}]),t}();t._RF.pop(),t._RF.push({},"663baRF6QZFi6zhc8Qt66NF","register",void 0);var HF=new Map,UF=new Map,GF=new Map;function WF(t){return function(e){var i=new e,n=Object.getPrototypeOf(i.constructor).name,o={type:i.type,extend:n,details:t,node:i.data};"PropertyNode"===i.type&&function(t){for(var e in UF.clear(),VF){var i=VF[e];if("string"==typeof i){var n=new BF(i);n.type=i,UF.set(i,{type:i,declareType:t,name:n.name,outputs:n.outputs,default:n.value,details:n.details})}}}(i.type),GF.set(i.type,e),HF.set(i.type,o)}}t._RF.pop(),t._RF.push({},"ca808INO7FLGrJCNKRU+Sjn","index",void 0),t._RF.pop(),t._RF.push({},"130e0LrRvNOq7GOFf5/5IGV","context",void 0);var qF=new(function(){function t(){this.shaderTemplatesDir=void 0,this.allNodes=[],this.properties=[],this.localVars=[],this.getLocalVars=[]}return t.prototype.reset=function(){this.allNodes.length=0,this.properties.length=0,this.localVars.length=0,this.getLocalVars.length=0},t}());t._RF.pop(),t._RF.push({},"37bc8lcJkpAuZFrukwcAg+H","slot",void 0);var ZF=0,YF=function(t){return t[t.Input=0]="Input",t[t.Output=1]="Output",t}({}),jF=function(){function t(t,e){this.data=void 0,this.globalID=0,this.id=0,this.displayName="",this.type=YF.Input,this.defaultValue=void 0,this.value=void 0,this.connectSlots=[],this.node=void 0,this._concretePrecision=-1,this.displayName=t.display,this.defaultValue=t.default,t.default instanceof Et?this.value=t.default.clone():this.value=t.default,this.data=t,this.node=e,this.globalID=ZF++}return Ft(t,[{key:"connectSlot",get:function(){var t=this.connectSlots[0];return t&&qF.getLocalVars.includes(t.node)?qF.localVars.find((function(e){return e.name===t.node.name})).inputs[0].connectSlot:this.connectSlots[0]},set:function(t){this.connectSlots.length=0,t&&(this.connectSlots[0]=t)}},{key:"connectNode",get:function(){return this.connectSlot&&this.connectSlot.node}},{key:"varName",get:function(){var t;return null!=(t=this.node)&&t.isPropertyNode?this.node.name:"var_"+this.globalID}},{key:"varDefine",get:function(){var t=RF(this.concretePrecision,this.data.type);return t&&(t+=" "),t+this.varName}},{key:"precisionName",get:function(){return RF(this.concretePrecision,this.data.type)}},{key:"isVector",get:function(){return"vector"===this.data.connectType}},{key:"slotValue",get:function(){var t=this.defaultConcretePrecision,e=this.concretePrecision,i="";if(this.connectSlot){if(t=this.connectSlot.concretePrecision,i=this.connectSlot.varName,this.isVector&&e!==t)if(e<t)1===e?i+=".x":2===e?i+=".xy":3===e&&(i+=".xyz");else if(1!==t){for(var n=e-t,o=[],r=0;r<n;r++)o.push("0.");i+=", "+o.join(", ")}}else{var a=this.value;if(this.isVector){var s=OF(a,0),l=OF(a,1),c=OF(a,2),u=OF(a,3);"object"!=typeof a&&(s=PF(a)),t=LF(a);for(var h=[s,l,c,u],p=[],d=0;d<e;d++)p.push(void 0===h[d]?0:h[d]);i=p.join(", ")}else i=a}var f=""+i;return this.isVector&&(2===e?f="vec2("+i+")":3===e?f="vec3("+i+")":4===e&&(f="vec4("+i+")")),f}},{key:"defaultConcretePrecision",get:function(){var t=1,e=this.defaultValue;return"object"==typeof e&&(void 0!==e.w?t=4:void 0!==e.z?t=3:void 0!==e.y&&(t=2)),t}},{key:"concretePrecision",get:function(){if(-1===this._concretePrecision){var t,e=this.defaultValue;if(void 0===e)null!=(t=this.node)&&t.isPropertyNode&&(e=this.node.property.value);void 0===e&&console.error("Slot Value is undefined, concrete precision maybe wrong."),this._concretePrecision=LF(e)}return this._concretePrecision}}]),t}();t._RF.pop(),t._RF.push({},"d0751arZzVMdrvnQr4rAMJC","base",void 0);var KF,XF=function(t,e){this.value=void 0,this.data=void 0,this.value=t instanceof Et?t.clone():t,this.data=e},JF=function(){function t(){this.priority=0,this.uuid="",this.slots=[],this.depChunks=[],this.defines=[],this.isMasterNode=!1,this.isPropertyNode=!1,this.concretePrecisionType=bF.Min,this.fixedConcretePrecision=0,this.inputs=[],this.outputs=[],this.props=new Map,this.data={}}var e=t.prototype;return e.init=function(){var t=this;this.slots.length=0,this.inputs.length=0,this.outputs.length=0,this.data.inputs&&this.data.inputs.forEach((function(e){var i=new jF(e,t);t.inputs.push(i),t.slots.push(i)})),this.data.outputs&&this.data.outputs.forEach((function(e){var i=new jF(e,t);t.outputs.push(i),t.slots.push(i)})),this.data.props&&this.data.props.forEach((function(e){var i=new XF(e.default,e);t.props.set(e.display,i)}))},e.beforeGenreateCode=function(){},e.addDependency=function(t){t!==this&&(this.deps.includes(t)||this.deps.push(t))},e.calcConcretePrecision=function(){var t=this;if(this.fixedConcretePrecision>0&&this.slots.forEach((function(e){e._concretePrecision=t.fixedConcretePrecision})),this.concretePrecisionType!==bF.Fixed){var e=1;this.concretePrecisionType===bF.Min?(e=999,this.inputs.forEach((function(t){var i=t.concretePrecision;t.connectSlot&&(i=t.connectSlot.concretePrecision),e=Math.min(e,i)}))):this.concretePrecisionType===bF.Max?(e=-999,this.inputs.forEach((function(t){var i=t.concretePrecision;t.connectSlot&&(i=t.connectSlot.concretePrecision),e=Math.max(e,i)}))):this.concretePrecisionType===bF.Texture?e=_F.Texture2D:console.error("Not supported ConcretePrecisionType : "+this.concretePrecisionType),this.slots.forEach((function(t){t._concretePrecision=e}))}},e.setPriority=function(t){this.priority=Math.max(t,this.priority);for(var e=0;e<this.deps.length;e++)this.deps[e].setPriority(this.priority+1)},e.getPropWithName=function(t){var e;return this.props&&(e=this.props.get(t)),e||new XF(null,null)},e.getSlotWithSlotName=function(t){return this.slots.find((function(e){return e.displayName===t}))},e.getOutputSlotWithSlotName=function(t){return this.outputs.find((function(e){return e.displayName===t}))},e.getOutputVarName=function(t){return this.outputs[t].varName},e.getOutputVarDefine=function(t){return this.outputs[t].varDefine},e.getInputValue=function(t){return this.inputs[t].slotValue},e.generateCode=function(){return""},Ft(t,[{key:"type",get:function(){return this.constructor.name}},{key:"deps",get:function(){var t=[];return this.inputs.forEach((function(e){e.connectSlot&&t.push(e.connectSlot.node)})),t}}]),t}();t._RF.pop(),t._RF.push({},"21fbes9bMJN6oBb3TRVMZZ3","boolean",void 0);var QF;WF({menu:"Input/Basic/Boolean",title:"Boolean"})(KF=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).concretePrecisionType=bF.Fixed,e.data={inputs:[xF("In",0,"float","vector")],outputs:[xF("Out",0,"float","vector")]},e}Nt(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0);return"\n            "+this.getOutputVarDefine(0)+" = "+t+";\n        "},e}(JF));t._RF.pop(),t._RF.push({},"68e4bUVUSRHKo5B3bmMbsMV","float",void 0);var $F;WF({menu:"Input/Basic/Float",title:"Float"})(QF=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).concretePrecisionType=bF.Fixed,e.data={inputs:[xF("In",0,"float","vector")],outputs:[xF("Out",0,"float","vector")]},e}Nt(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0);return"\n            "+this.getOutputVarDefine(0)+" = "+t+";\n        "},e}(JF));t._RF.pop(),t._RF.push({},"263a8VilSVCp4Eyo8YtLJnX","slider",void 0);var tD;WF({menu:"Input/Basic/Slider",title:"Slider"})($F=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).concretePrecisionType=bF.Fixed,e.data={inputs:[xF("In",0,"float","vector")],outputs:[xF("Out",0,"float","vector")]},e}Nt(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0);return"\n            "+this.getOutputVarDefine(0)+" = "+t+";\n        "},Ft(e,[{key:"type",get:function(){return"Slider"}}]),e}(JF));t._RF.pop(),t._RF.push({},"7f058nmp+ZIQ6FPIyLJ3wpK","vector2",void 0);var eD;WF({menu:"Input/Basic/Vector2",title:"Vector2"})(tD=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).concretePrecisionType=bF.Fixed,e.data={inputs:[xF("X",0,"float","vector"),xF("Y",0,"float","vector")],outputs:[xF("Out",K.ZERO,"vec2","vector")]},e}Nt(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0),e=this.getInputValue(1);return"\n            "+this.getOutputVarDefine(0)+" = vec2("+t+", "+e+");\n        "},e}(JF));t._RF.pop(),t._RF.push({},"99486WpmApIPoULZGXK9dCS","vector3",void 0);var iD;WF({menu:"Input/Basic/Vector3",title:"Vector3"})(eD=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).concretePrecisionType=bF.Fixed,e.data={inputs:[xF("X",0,"float","vector"),xF("Y",0,"float","vector"),xF("Z",0,"float","vector")],outputs:[xF("Out",g.ZERO,"vec3","vector")]},e}Nt(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0),e=this.getInputValue(1),i=this.getInputValue(2);return"\n            "+this.getOutputVarDefine(0)+" = vec3("+t+", "+e+", "+i+");\n        "},e}(JF));t._RF.pop(),t._RF.push({},"4e4e9VghSdMAohxS4AJDF0m","vector4",void 0);var nD;WF({menu:"Input/Basic/Vector4",title:"Vector4"})(iD=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).concretePrecisionType=bF.Fixed,e.data={inputs:[xF("X",0,"float","vector"),xF("Y",0,"float","vector"),xF("Z",0,"float","vector"),xF("W",0,"float","vector")],outputs:[xF("Out",Pt.ZERO,"vec4","vector")]},e}Nt(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0),e=this.getInputValue(1),i=this.getInputValue(2),n=this.getInputValue(3);return"\n            "+this.getOutputVarDefine(0)+" = vec4("+t+", "+e+", "+i+", "+n+");\n        "},e}(JF));t._RF.pop(),t._RF.push({},"bf087/OgI9HIaIKP+ZWp/tU","absolute",void 0);var oD;WF({menu:"Math/Advanced/Absolute",title:"Absolute"})(nD=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[xF("In",Pt.ZERO,"vec4","vector")],outputs:[xF("Out",Pt.ZERO,"vec4","vector")]},e}Nt(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0);return"\n            "+this.getOutputVarDefine(0)+" = abs("+t+");\n        "},e}(JF));t._RF.pop(),t._RF.push({},"5c4913KTCJGjqbcTxcC/UmQ","exponential",void 0);var rD;WF({menu:"Math/Advanced/Exponential",title:"Exponential"})(oD=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[xF("In",Pt.ZERO,"vec4","vector")],outputs:[xF("Out",Pt.ZERO,"vec4","vector")]},e}Nt(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0);return"\n            "+this.getOutputVarDefine(0)+" = exp("+t+");\n        "},e}(JF));t._RF.pop(),t._RF.push({},"d16658ODu5NPKUU74aU5bA5","length",void 0);var aD;WF({menu:"Math/Advanced/Length",title:"Length"})(rD=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[xF("In",Pt.ZERO,"vec4","vector")],outputs:[xF("Out",Pt.ZERO,"vec4","vector")]},e}Nt(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0);return"\n            "+this.getOutputVarDefine(0)+" = length("+t+");\n        "},e}(JF));t._RF.pop(),t._RF.push({},"40ca6yOjaJE8J+qRdu62/Jd","log",void 0);var sD;WF({menu:"Math/Advanced/Log",title:"Log"})(aD=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[xF("In",Pt.ZERO,"vec4","vector")],outputs:[xF("Out",Pt.ZERO,"vec4","vector")]},e}Nt(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0);return"\n            "+this.getOutputVarDefine(0)+" = log("+t+");\n        "},e}(JF));t._RF.pop(),t._RF.push({},"20807G1bipGRriFOGyGJxbW","modulo",void 0);var lD;WF({menu:"Math/Advanced/Modulo",title:"Modulo"})(sD=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[xF("A",Pt.ZERO,"vec4","vector"),xF("B",Pt.ZERO,"vec4","vector")],outputs:[xF("Out",Pt.ZERO,"vec4","vector")]},e}Nt(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0),e=this.getInputValue(1);return"\n            "+this.getOutputVarDefine(0)+" = mod("+t+", "+e+");\n        "},e}(JF));t._RF.pop(),t._RF.push({},"1b741yPEQlEVL911xSY0qGi","negate",void 0);var cD;WF({menu:"Math/Advanced/Negate",title:"Negate"})(lD=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[xF("In",Pt.ZERO,"vec4","vector")],outputs:[xF("Out",Pt.ZERO,"vec4","vector")]},e}Nt(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0);return"\n            "+this.getOutputVarDefine(0)+" = -"+t+";\n        "},e}(JF));t._RF.pop(),t._RF.push({},"00775HyBCRKYqjtgTFMEtIo","normalize",void 0);var uD;WF({menu:"Math/Advanced/Normalize",title:"Normalize"})(cD=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[xF("In",Pt.ZERO,"vec4","vector")],outputs:[xF("Out",Pt.ZERO,"vec4","vector")]},e}Nt(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0);return"\n            "+this.getOutputVarDefine(0)+" = normalize("+t+");\n        "},e}(JF));t._RF.pop(),t._RF.push({},"83ac4Oj/INHY7tCCfwuaa6d","posterize",void 0);var hD;WF({menu:"Math/Advanced/Posterize",title:"Posterize"})(uD=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[xF("In",Pt.ZERO,"vec4","vector"),xF("Steps",Pt.ZERO,"vec4","vector")],outputs:[xF("Out",Pt.ZERO,"vec4","vector")]},e}Nt(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0),e=this.getInputValue(1);return"\n            "+this.getOutputVarDefine(0)+" = floor("+t+" / (1. / "+e+")) * (1. / "+e+");\n        "},e}(JF));t._RF.pop(),t._RF.push({},"eae1erXirxEXq46sl0FpxV0","reciprocal-square",void 0);var pD;WF({menu:"Math/Advanced/ReciprocalSquare",title:"ReciprocalSquare"})(hD=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[xF("In",Pt.ZERO,"vec4","vector")],outputs:[xF("Out",Pt.ZERO,"vec4","vector")]},e}Nt(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0);return"\n            "+this.getOutputVarDefine(0)+" = 1. / ("+t+" * "+t+");\n        "},e}(JF));t._RF.pop(),t._RF.push({},"5e330r2wGBAfouLL0jpsqul","reciprocal",void 0);var dD;WF({menu:"Math/Advanced/Reciprocal",title:"Reciprocal"})(pD=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[xF("In",Pt.ZERO,"vec4","vector")],outputs:[xF("Out",Pt.ZERO,"vec4","vector")]},e}Nt(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0);return"\n            "+this.getOutputVarDefine(0)+" = 1. / "+t+";\n        "},e}(JF));t._RF.pop(),t._RF.push({},"37762nev7BLgIRh9U7rJXkP","add",void 0);var fD;WF({menu:"Math/Basic/Add",title:"Add"})(dD=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).concretePrecisionType=bF.Max,e.data={inputs:[xF("A",Pt.ZERO,"vec4","vector"),xF("B",Pt.ZERO,"vec4","vector")],outputs:[xF("Out",Pt.ZERO,"vec4","vector")]},e}Nt(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0),e=this.getInputValue(1);return"\n            "+this.getOutputVarDefine(0)+" = "+t+" + "+e+";\n        "},e}(JF));t._RF.pop(),t._RF.push({},"027926d68NB7rx2YRTbh0wu","divide",void 0);var gD;WF({menu:"Math/Basic/Divide",title:"Divide"})(fD=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).concretePrecisionType=bF.Max,e.data={inputs:[xF("A",Pt.ZERO,"vec4","vector"),xF("B",Pt.ZERO,"vec4","vector")],outputs:[xF("Out",Pt.ZERO,"vec4","vector")]},e}Nt(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0),e=this.getInputValue(1);return"\n            "+this.getOutputVarDefine(0)+" = "+t+" / "+e+";\n        "},e}(JF));t._RF.pop(),t._RF.push({},"eb609R33glDfpL2KytmHUQe","multiply",void 0);var mD;WF({menu:"Math/Basic/Multiply",title:"Multiply"})(gD=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).concretePrecisionType=bF.Max,e.data={inputs:[xF("A",Pt.ZERO,"vec4","vector"),xF("B",Pt.ZERO,"vec4","vector")],outputs:[xF("Out",Pt.ZERO,"vec4","vector")]},e}Nt(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0),e=this.getInputValue(1);return"\n            "+this.getOutputVarDefine(0)+" = "+t+" * "+e+";\n        "},e}(JF));t._RF.pop(),t._RF.push({},"94eaaC4omdHcaTHrDX60+tq","power",void 0);var vD;WF({menu:"Math/Basic/Power",title:"Power"})(mD=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).concretePrecisionType=bF.Fixed,e.data={inputs:[xF("A",Pt.ZERO,"vec4","vector"),xF("B",Pt.ZERO,"vec4","vector")],outputs:[xF("Out",Pt.ZERO,"vec4","vector")]},e}Nt(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0),e=this.getInputValue(1);return"\n            "+this.getOutputVarDefine(0)+" = pow("+t+", "+e+");\n        "},e}(JF));t._RF.pop(),t._RF.push({},"861eejAxE9Kk5MHkzbOdXlI","square",void 0);var yD;WF({menu:"Math/Basic/Square",title:"Square"})(vD=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[xF("A",Pt.ZERO,"vec4","vector")],outputs:[xF("Out",Pt.ZERO,"vec4","vector")]},e}Nt(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0);return"\n            "+this.getOutputVarDefine(0)+" = sqrt("+t+");\n        "},e}(JF));t._RF.pop(),t._RF.push({},"5fbb9DNFjJODZFHdbDe+csv","substract",void 0);var bD;WF({menu:"Math/Basic/Substract",title:"Substract"})(yD=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).concretePrecisionType=bF.Max,e.data={inputs:[xF("A",Pt.ZERO,"vec4","vector"),xF("B",Pt.ZERO,"vec4","vector")],outputs:[xF("Out",Pt.ZERO,"vec4","vector")]},e}Nt(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0),e=this.getInputValue(1);return"\n            "+this.getOutputVarDefine(0)+" = "+t+" - "+e+";\n        "},e}(JF));t._RF.pop(),t._RF.push({},"a9e8cu/8AxJgqL6Mn6GY7sg","ddx",void 0);var _D;WF({menu:"Math/Derivative/DDX",title:"DDX"})(bD=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[xF("In",Pt.ZERO,"vec4","vector")],outputs:[xF("Out",Pt.ZERO,"vec4","vector")]},e}Nt(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0);return"\n            "+this.getOutputVarDefine(0)+" = dFdx("+t+");\n        "},e}(JF));t._RF.pop(),t._RF.push({},"ec1afn79wpEi5T7OYFN+OIo","ddxy",void 0);var SD;WF({menu:"Math/Derivative/DDXY",title:"DDXY"})(_D=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[xF("In",Pt.ZERO,"vec4","vector")],outputs:[xF("Out",Pt.ZERO,"vec4","vector")]},e}Nt(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0);return"\n            "+this.getOutputVarDefine(0)+" = abs(dFdx("+t+")) + abs(dFdy("+t+"));\n        "},e}(JF));t._RF.pop(),t._RF.push({},"8231cetsI5JAKl/k454/49j","ddy",void 0);var wD;WF({menu:"Math/Derivative/DDY",title:"DDY"})(SD=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[xF("In",Pt.ZERO,"vec4","vector")],outputs:[xF("Out",Pt.ZERO,"vec4","vector")]},e}Nt(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0);return"\n            "+this.getOutputVarDefine(0)+" = dFdy("+t+");\n        "},e}(JF));t._RF.pop(),t._RF.push({},"c589fRsjwlOb5Fzx0G64yl/","inverse-lerp",void 0);var TD;WF({menu:"Math/Interpolation/InverseLerp",title:"InverseLerp"})(wD=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[xF("A",Pt.ZERO,"vec4","vector"),xF("B",Pt.ZERO,"vec4","vector"),xF("T",Pt.ZERO,"vec4","vector")],outputs:[xF("Out",Pt.ZERO,"vec4","vector")]},e}Nt(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0),e=this.getInputValue(1),i=this.getInputValue(2);return"\n            "+this.getOutputVarDefine(0)+" = ("+i+" - "+t+") / ("+e+" - "+t+");\n        "},e}(JF));t._RF.pop(),t._RF.push({},"0583aaFcfFDfr3SugrLLX4t","lerp",void 0);var CD;WF({menu:"Math/Interpolation/Lerp",title:"Lerp"})(TD=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).concretePrecisionType=bF.Max,e.data={inputs:[xF("A",Pt.ZERO,"vec4","vector"),xF("B",Pt.ZERO,"vec4","vector"),xF("T",Pt.ZERO,"vec4","vector")],outputs:[xF("Out",Pt.ZERO,"vec4","vector")]},e}Nt(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0),e=this.getInputValue(1),i=this.getInputValue(2);return"\n            "+this.getOutputVarDefine(0)+" = mix("+t+", "+e+", "+i+");\n        "},e}(JF));t._RF.pop(),t._RF.push({},"d4d9cMuNpBHKICVJVXTyXRO","smoothstep",void 0);var ED;WF({menu:"Math/Interpolation/Smoothstep",title:"Smoothstep"})(CD=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[xF("Edge1",Pt.ZERO,"vec4","vector"),xF("Edge2",Pt.ZERO,"vec4","vector"),xF("In",Pt.ZERO,"vec4","vector")],outputs:[xF("Out",Pt.ZERO,"vec4","vector")]},e}Nt(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0),e=this.getInputValue(1),i=this.getInputValue(2);return"\n            "+this.getOutputVarDefine(0)+" = smoothstep("+t+", "+e+", "+i+");\n        "},e}(JF));t._RF.pop(),t._RF.push({},"4637audjsFPEKaBJvnUsO5t","clamp",void 0);var AD;WF({menu:"Math/Range/Clamp",title:"Clamp"})(ED=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[xF("In",Pt.ZERO,"vec4","vector"),xF("Min",Pt.ZERO,"vec4","vector"),xF("Max",Pt.ZERO,"vec4","vector")],outputs:[xF("Out",Pt.ZERO,"vec4","vector")]},e}Nt(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0),e=this.getInputValue(1),i=this.getInputValue(2);return"\n            "+this.getOutputVarDefine(0)+" = clamp("+t+", "+e+", "+i+");\n        "},e}(JF));t._RF.pop(),t._RF.push({},"1be9a5SW39Pr7Ypuq6zuC9D","fraction",void 0);var PD;WF({menu:"Math/Range/Fraction",title:"Fraction"})(AD=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[xF("In",Pt.ZERO,"vec4","vector")],outputs:[xF("Out",Pt.ZERO,"vec4","vector")]},e}Nt(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0);return"\n            "+this.getOutputVarDefine(0)+" = fract("+t+");\n        "},e}(JF));t._RF.pop(),t._RF.push({},"6e8a0vJMJZHLaTkO3zIBxfl","max",void 0);var MD;WF({menu:"Math/Range/Max",title:"Max"})(PD=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[xF("A",Pt.ZERO,"vec4","vector"),xF("B",Pt.ZERO,"vec4","vector")],outputs:[xF("Out",Pt.ZERO,"vec4","vector")]},e}Nt(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0),e=this.getInputValue(1);return"\n            "+this.getOutputVarDefine(0)+" = max("+t+", "+e+");\n        "},e}(JF));t._RF.pop(),t._RF.push({},"65629wgX7ZFlosarXfPMufw","min",void 0);var ID;WF({menu:"Math/Range/Min",title:"Min"})(MD=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[xF("A",Pt.ZERO,"vec4","vector"),xF("B",Pt.ZERO,"vec4","vector")],outputs:[xF("Out",Pt.ZERO,"vec4","vector")]},e}Nt(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0),e=this.getInputValue(1);return"\n            "+this.getOutputVarDefine(0)+" = min("+t+", "+e+");\n        "},e}(JF));t._RF.pop(),t._RF.push({},"cd61fVd7UJBB6ngXO+30nVS","one-minus",void 0);var ND;WF({menu:"Math/Range/OneMinus",title:"OneMinus"})(ID=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[xF("In",Pt.ZERO,"vec4","vector")],outputs:[xF("Out",Pt.ZERO,"vec4","vector")]},e}Nt(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0);return"\n            "+this.getOutputVarDefine(0)+" = 1. - "+t+";\n        "},e}(JF));t._RF.pop(),t._RF.push({},"33710RUTT1JXZDzqyhgRRxS","random-range",void 0);var OD;WF({menu:"Math/Range/RandomRange",title:"RandomRange"})(ND=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).concretePrecisionType=bF.Fixed,e.depChunks=["range"],e.data={inputs:[xF("seed",K.ZERO,"vec2","vector"),xF("minv",0,"float","vector"),xF("maxv",0,"float","vector")],outputs:[xF("Out",0,"float","vector")]},e}Nt(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0),e=this.getInputValue(1),i=this.getInputValue(2);return this.getOutputVarDefine(0)+" = RandomRange("+t+", "+e+", "+i+");"},e}(JF));t._RF.pop(),t._RF.push({},"c8987U3zUlCXZn8OW+mTz8j","remap",void 0);var LD;WF({menu:"Math/Range/Remap",title:"Remap"})(OD=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).concretePrecisionType=bF.Max,e.data={inputs:[xF("In",Pt.ZERO,"vec4","vector"),xF("InMinMax",K.ZERO,"vec2","vector"),xF("OutMinMax",K.ZERO,"vec2","vector")],outputs:[xF("Out",Pt.ZERO,"vec4","vector")]},e}Nt(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0),e=this.getInputValue(1),i=this.getInputValue(2);return"\n            "+this.getOutputVarDefine(0)+" = "+i+".x + ("+t+" - "+e+".x) * ("+i+".y - "+i+".x) / ("+e+".y - "+e+".x);\n        "},e}(JF));t._RF.pop(),t._RF.push({},"28c0baw9D1DwrDezfnwuGKN","saturate",void 0);var RD;WF({menu:"Math/Range/Saturate",title:"Saturate"})(LD=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[xF("In",Pt.ZERO,"vec4","vector")],outputs:[xF("Out",Pt.ZERO,"vec4","vector")]},e}Nt(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0);return"\n            "+this.getOutputVarDefine(0)+" = saturate("+t+");\n        "},e}(JF));t._RF.pop(),t._RF.push({},"9c519gjpitF6YbEaQTLOEve","ceil",void 0);var xD;WF({menu:"Math/Round/Ceil",title:"Ceil"})(RD=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[xF("In",Pt.ZERO,"vec4","vector")],outputs:[xF("Out",Pt.ZERO,"vec4","vector")]},e}Nt(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0);return"\n            "+this.getOutputVarDefine(0)+" = ceil("+t+");\n        "},e}(JF));t._RF.pop(),t._RF.push({},"ee049iD/ZRMAqYgcXswPl0X","floor",void 0);var FD;WF({menu:"Math/Round/Floor",title:"Floor"})(xD=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[xF("In",Pt.ZERO,"vec4","vector")],outputs:[xF("Out",Pt.ZERO,"vec4","vector")]},e}Nt(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0);return"\n            "+this.getOutputVarDefine(0)+" = floor("+t+");\n        "},e}(JF));t._RF.pop(),t._RF.push({},"62b43+zJdRCqaCEyKSYFKtF","round",void 0);var DD;WF({menu:"Math/Round/Round",title:"Round"})(FD=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[xF("In",Pt.ZERO,"vec4","vector")],outputs:[xF("Out",Pt.ZERO,"vec4","vector")]},e}Nt(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0);return"\n            "+this.getOutputVarDefine(0)+" = floor("+t+" + 0.5);\n        "},e}(JF));t._RF.pop(),t._RF.push({},"48af6KxjgJDrLG+h1577MoC","sign",void 0);var zD;WF({menu:"Math/Round/Sign",title:"Sign"})(DD=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[xF("In",Pt.ZERO,"vec4","vector")],outputs:[xF("Out",Pt.ZERO,"vec4","vector")]},e}Nt(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0);return"\n            "+this.getOutputVarDefine(0)+" = sign("+t+");\n        "},e}(JF));t._RF.pop(),t._RF.push({},"2b4cb9lBRBMqrQTPqc1e+XN","step",void 0);var kD;WF({menu:"Math/Round/Step",title:"Step"})(zD=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[xF("Edge",Pt.ZERO,"vec4","vector"),xF("In",Pt.ZERO,"vec4","vector")],outputs:[xF("Out",Pt.ZERO,"vec4","vector")]},e}Nt(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0),e=this.getInputValue(1);return"\n            "+this.getOutputVarDefine(0)+" = step("+t+", "+e+");\n        "},e}(JF));t._RF.pop(),t._RF.push({},"96ddfY+NwRNKa+F0/nHJXIw","truncate",void 0);var VD;WF({menu:"Math/Round/Truncate",title:"Truncate"})(kD=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[xF("In",Pt.ZERO,"vec4","vector")],outputs:[xF("Out",Pt.ZERO,"vec4","vector")]},e}Nt(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0);return"\n            "+this.getOutputVarDefine(0)+" = trunc("+t+");\n        "},e}(JF));t._RF.pop(),t._RF.push({},"d296eo8ejhAz4SJ+Afh3Ceo","arccosine",void 0);var BD;WF({menu:"Math/Trigonometry/Arccosine",title:"Arccosine"})(VD=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[xF("In",Pt.ZERO,"vec4","vector")],outputs:[xF("Out",Pt.ZERO,"vec4","vector")]},e}Nt(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0);return"\n            "+this.getOutputVarDefine(0)+" = acos("+t+");\n        "},e}(JF));t._RF.pop(),t._RF.push({},"63135dmizRJ4Jf8BpVKF+Wm","arcsine",void 0);var HD;WF({menu:"Math/Trigonometry/Arcsine",title:"Arcsine"})(BD=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[xF("In",Pt.ZERO,"vec4","vector")],outputs:[xF("Out",Pt.ZERO,"vec4","vector")]},e}Nt(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0);return"\n            "+this.getOutputVarDefine(0)+" = asin("+t+");\n        "},e}(JF));t._RF.pop(),t._RF.push({},"2986999N5lOG433MyYF3lBY","arctangent",void 0);var UD;WF({menu:"Math/Trigonometry/Arctangent",title:"Arctangent"})(HD=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[xF("In",Pt.ZERO,"vec4","vector")],outputs:[xF("Out",Pt.ZERO,"vec4","vector")]},e}Nt(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0);return"\n            "+this.getOutputVarDefine(0)+" = atan("+t+");\n        "},e}(JF));t._RF.pop(),t._RF.push({},"2a9c8rn4+VHWa4BXpsUBf1R","arctangent2",void 0);var GD;WF({menu:"Math/Trigonometry/Arctangent2",title:"Arctangent2"})(UD=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[xF("A",Pt.ZERO,"vec4","vector"),xF("B",Pt.ZERO,"vec4","vector")],outputs:[xF("Out",Pt.ZERO,"vec4","vector")]},e}Nt(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0),e=this.getInputValue(1);return"\n            "+this.getOutputVarDefine(0)+" = atan2("+t+", "+e+");\n        "},e}(JF));t._RF.pop(),t._RF.push({},"2e9b7mUik5Cj7/HtwG5GjOg","cosine",void 0);var WD;WF({menu:"Math/Trigonometry/Cosine",title:"Cosine"})(GD=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[xF("In",Pt.ZERO,"vec4","vector")],outputs:[xF("Out",Pt.ZERO,"vec4","vector")]},e}Nt(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0);return"\n            "+this.getOutputVarDefine(0)+" = cos("+t+");\n        "},e}(JF));t._RF.pop(),t._RF.push({},"54cccLnyalN+rGU9RVdf0Ob","degrees-to-radians",void 0);var qD;WF({menu:"Math/Trigonometry/DegreesToRadians",title:"DegreesToRadians"})(WD=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[xF("In",Pt.ZERO,"vec4","vector")],outputs:[xF("Out",Pt.ZERO,"vec4","vector")]},e}Nt(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0);return"\n            "+this.getOutputVarDefine(0)+" = radians("+t+");\n        "},e}(JF));t._RF.pop(),t._RF.push({},"d1158zUxl5K7KSvlL2F7+wS","hyperbolic-cosine",void 0);var ZD;WF({menu:"Math/Trigonometry/HyperbolicCosine",title:"HyperbolicCosine"})(qD=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[xF("In",Pt.ZERO,"vec4","vector")],outputs:[xF("Out",Pt.ZERO,"vec4","vector")]},e}Nt(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0);return"\n            "+this.getOutputVarDefine(0)+" = cosh("+t+");\n        "},e}(JF));t._RF.pop(),t._RF.push({},"d0e30ycExdAl4oLI765JfTS","hyperbolic-sine",void 0);var YD;WF({menu:"Math/Trigonometry/HyperbolicSine",title:"HyperbolicSine"})(ZD=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[xF("In",Pt.ZERO,"vec4","vector")],outputs:[xF("Out",Pt.ZERO,"vec4","vector")]},e}Nt(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0);return"\n            "+this.getOutputVarDefine(0)+" = sinh("+t+");\n        "},e}(JF));t._RF.pop(),t._RF.push({},"b180bsrU6dCOKdx5slTh5p9","hyperbolic",void 0);var jD;WF({menu:"Math/Trigonometry/Hyperbolic",title:"Hyperbolic"})(YD=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[xF("In",Pt.ZERO,"vec4","vector")],outputs:[xF("Out",Pt.ZERO,"vec4","vector")]},e}Nt(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0);return"\n            "+this.getOutputVarDefine(0)+" = tanh("+t+");\n        "},e}(JF));t._RF.pop(),t._RF.push({},"122290sL5ZBopCyAP2bpg8T","radians-to-degrees",void 0);var KD;WF({menu:"Math/Trigonometry/RadiansToDegrees",title:"RadiansToDegrees"})(jD=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[xF("In",Pt.ZERO,"vec4","vector")],outputs:[xF("Out",Pt.ZERO,"vec4","vector")]},e}Nt(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0);return"\n            "+this.getOutputVarDefine(0)+" = degrees("+t+");\n        "},e}(JF));t._RF.pop(),t._RF.push({},"203ea3iMklAUK9FzJeavWJF","sine",void 0);var XD;WF({menu:"Math/Trigonometry/Sine",title:"Sine"})(KD=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[xF("In",Pt.ZERO,"vec4","vector")],outputs:[xF("Out",Pt.ZERO,"vec4","vector")]},e}Nt(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0);return"\n            "+this.getOutputVarDefine(0)+" = sin("+t+");\n        "},e}(JF));t._RF.pop(),t._RF.push({},"adcb4trf/1C6627yz7YeTXn","tangent",void 0);var JD;WF({menu:"Math/Trigonometry/Tangent",title:"Tangent"})(XD=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[xF("In",Pt.ZERO,"vec4","vector")],outputs:[xF("Out",Pt.ZERO,"vec4","vector")]},e}Nt(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0);return"\n            "+this.getOutputVarDefine(0)+" = tan("+t+");\n        "},e}(JF));t._RF.pop(),t._RF.push({},"13009pA4vlKI5jSuhV9uAJV","cross-product",void 0);var QD;WF({menu:"Math/Vector/CrossProduct",title:"CrossProduct"})(JD=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[xF("A",Pt.ZERO,"vec4","vector"),xF("B",Pt.ZERO,"vec4","vector")],outputs:[xF("Out",Pt.ZERO,"vec4","vector")]},e}Nt(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0),e=this.getInputValue(1);return"\n            "+this.getOutputVarDefine(0)+" = cross("+t+", "+e+");\n        "},e}(JF));t._RF.pop(),t._RF.push({},"1d67fgjFt5PYIIoSIE7uP03","distance",void 0);var $D;WF({menu:"Math/Vector/Distance",title:"Distance"})(QD=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).concretePrecisionType=bF.Fixed,e.data={inputs:[xF("A",Pt.ZERO,"vec4","vector"),xF("B",Pt.ZERO,"vec4","vector")],outputs:[xF("Out",0,"float","vector")]},e}Nt(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0),e=this.getInputValue(1);return"\n            "+this.getOutputVarDefine(0)+" = distance("+t+", "+e+");\n        "},e}(JF));t._RF.pop(),t._RF.push({},"fe81frs65tLqqp2QPfF1tCJ","dot-product",void 0);var tz;WF({menu:"Math/Vector/DotProduct",title:"DotProduct"})($D=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).concretePrecisionType=bF.Fixed,e.data={inputs:[xF("A",Pt.ZERO,"vec4","vector"),xF("B",Pt.ZERO,"vec4","vector")],outputs:[xF("Out",0,"float","vector")]},e}Nt(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0),e=this.getInputValue(1);return"\n            "+this.getOutputVarDefine(0)+" = dot("+t+", "+e+");\n        "},e}(JF));t._RF.pop(),t._RF.push({},"861c8JYxalKB66ptbnD6WdM","fresnel",void 0);var ez;WF({menu:"Math/Vector/Fresnel",title:"Fresnel"})(tz=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).concretePrecisionType=bF.Fixed,e.data={inputs:[xF("Normal",g.ZERO,"vec3","vector"),xF("ViewDir",g.ZERO,"vec3","vector"),xF("Power",0,"float","vector")],outputs:[xF("Out",0,"float","vector")]},e}Nt(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0),e=this.getInputValue(1),i=this.getInputValue(2);return"\n            "+this.getOutputVarDefine(0)+" = pow((1.0 - saturate(dot(normalize("+t+"), normalize("+e+")))), "+i+");\n        "},e}(JF));t._RF.pop(),t._RF.push({},"76ce8feSIBML7x6UxKZ/iDJ","projection",void 0);var iz;WF({menu:"Math/Vector/Projection",title:"Projection"})(ez=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[xF("A",Pt.ZERO,"vec4","vector"),xF("B",Pt.ZERO,"vec4","vector")],outputs:[xF("Out",Pt.ZERO,"vec4","vector")]},e}Nt(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0),e=this.getInputValue(1);return"\n            "+this.getOutputVarDefine(0)+" = "+e+" * dot("+t+", "+e+") / dot("+e+", "+e+");\n        "},e}(JF));t._RF.pop(),t._RF.push({},"83264s8H2BKlb81PIs6fbLm","reflection",void 0);var nz;WF({menu:"Math/Vector/Reflection",title:"Reflection"})(iz=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[xF("In",Pt.ZERO,"vec4","vector"),xF("Normal",Pt.ZERO,"vec4","vector")],outputs:[xF("Out",Pt.ZERO,"vec4","vector")]},e}Nt(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0),e=this.getInputValue(1);return"\n            "+this.getOutputVarDefine(0)+" = reflect("+t+", "+e+");\n        "},e}(JF));t._RF.pop(),t._RF.push({},"36176dcQhhIm7tg8pihGhm0","rejection",void 0);var oz;WF({menu:"Math/Vector/Rejection",title:"Rejection"})(nz=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[xF("A",Pt.ZERO,"vec4","vector"),xF("B",Pt.ZERO,"vec4","vector")],outputs:[xF("Out",Pt.ZERO,"vec4","vector")]},e}Nt(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0),e=this.getInputValue(1);return"\n            "+this.getOutputVarDefine(0)+" = "+t+" - ("+e+" * dot("+t+", "+e+") / dot("+e+", "+e+"))\n        "},e}(JF));t._RF.pop(),t._RF.push({},"2fd4cAU0iRIFbD4p8meWHjx","sphere-mask",void 0);var rz;WF({menu:"Math/Vector/SphereMask",title:"SphereMask"})(oz=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[xF("Coords",Pt.ZERO,"vec4","vector"),xF("Center",Pt.ZERO,"vec4","vector"),xF("Radius",0,"float","vector"),xF("Hardness",0,"float","vector")],outputs:[xF("Out",Pt.ZERO,"vec4","vector")]},e}Nt(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0),e=this.getInputValue(1),i=this.getInputValue(2),n=this.getInputValue(3);return"\n            "+this.getOutputVarDefine(0)+" = 1 - saturate((distance("+t+", "+e+") - "+i+") / (1 - "+n+"));\n        "},e}(JF));t._RF.pop(),t._RF.push({},"fdd3afGjspKIb7t04FDpYVl","noise-sine-wave",void 0);var az;WF({menu:"Math/Wave/NoiseSineWave",title:"NoiseSineWave"})(rz=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[xF("In",Pt.ZERO,"vec4","vector"),xF("MinMax",K.ZERO,"vec2","vector")],outputs:[xF("Out",Pt.ZERO,"vec4","vector")]},e}Nt(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0),e=this.getInputValue(1);return"\n            float sinIn = sin("+t+");\n            float sinInOffset = sin("+t+" + 1.0);\n            float randomno =  frac(sin((sinIn - sinInOffset) * (12.9898 + 78.233))*43758.5453);\n            float noise = lerp("+e+".x, "+e+".y, randomno);\n            "+this.getOutputVarDefine(0)+" = sinIn + noise;\n        "},e}(JF));t._RF.pop(),t._RF.push({},"00c7bwAaf9HZYpgf9WzhbZa","sawtooth-wave",void 0);var sz;WF({menu:"Math/Wave/SawtoothWave",title:"SawtoothWave"})(az=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[xF("In",Pt.ZERO,"vec4","vector")],outputs:[xF("Out",Pt.ZERO,"vec4","vector")]},e}Nt(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0);return"\n            "+this.getOutputVarDefine(0)+" = 2 * ("+t+" - floor(0.5 + "+t+"));\n        "},e}(JF));t._RF.pop(),t._RF.push({},"d9905hEvfVIh6Iwo+//rZfV","square-wave",void 0);var lz;WF({menu:"Math/Wave/SquareWave",title:"SquareWave"})(sz=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[xF("In",Pt.ZERO,"vec4","vector")],outputs:[xF("Out",Pt.ZERO,"vec4","vector")]},e}Nt(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0);return"\n            "+this.getOutputVarDefine(0)+" = 1.0 - 2.0 * round(frac("+t+"));\n        "},e}(JF));t._RF.pop(),t._RF.push({},"92a3eZPGhZGbpxgWBNEKAGs","triangle-wave",void 0);var cz;WF({menu:"Math/Wave/TriangleWave",title:"TriangleWave"})(lz=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[xF("In",Pt.ZERO,"vec4","vector")],outputs:[xF("Out",Pt.ZERO,"vec4","vector")]},e}Nt(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0);return"\n            "+this.getOutputVarDefine(0)+" = 2.0 * abs( 2 * ("+t+" - floor(0.5 + "+t+")) ) - 1.0;\n        "},e}(JF));t._RF.pop(),t._RF.push({},"5ccd4lVn2JLsKN+1DWNpIFz","gradient-noise",void 0);var uz;WF({menu:"Procedural/Noise/GradientNoise",title:"GradientNoise"})(cz=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).concretePrecisionType=bF.Fixed,e.depChunks=["noise"],e.data={inputs:[xF("uv",K.ZERO,"vec2","vector"),xF("scale",0,"float","vector")],outputs:[xF("Out",0,"float","vector")]},e}Nt(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0);this.inputs[0].connectSlot||(t="v_uv.xy");var e=this.getInputValue(1);return this.getOutputVarDefine(0)+" = GradientNoise("+t+", "+e+");"},e}(JF));t._RF.pop(),t._RF.push({},"35746vutFFE/Y01CS8ARMHq","simple-noise",void 0);var hz;WF({menu:"Procedural/Noise/SimpleNoise",title:"SimpleNoise"})(uz=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).concretePrecisionType=bF.Fixed,e.depChunks=["noise"],e.data={inputs:[xF("uv",K.ZERO,"vec2","vector"),xF("scale",0,"float","vector")],outputs:[xF("Out",0,"float","vector")]},e}Nt(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0);this.inputs[0].connectSlot||(t="v_uv.xy");var e=this.getInputValue(1);return this.getOutputVarDefine(0)+" = SimpleNoise("+t+", "+e+");"},e}(JF));t._RF.pop(),t._RF.push({},"71cb8o0v7xEvJDEaB1PCHhM","ellipse",void 0);var pz;WF({menu:"Procedural/Shape/Ellipse",title:"Ellipse"})(hz=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).concretePrecisionType=bF.Fixed,e.depChunks=["shape"],e.data={inputs:[xF("uv",K.ZERO,"vec2","vector"),xF("width",.5,"float","vector"),xF("height",.5,"float","vector")],outputs:[xF("Out",0,"float","vector")]},e}Nt(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0);this.inputs[0].connectSlot||(t="v_uv.xy");var e=this.getInputValue(1),i=this.getInputValue(2);return this.getOutputVarDefine(0)+" = Ellipse("+t+", "+e+", "+i+");"},e}(JF));t._RF.pop(),t._RF.push({},"c5bfexyH39Fw4zoC+a2iqVE","rectangle",void 0);var dz;WF({menu:"Procedural/Shape/Rectangle",title:"Rectangle"})(pz=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).concretePrecisionType=bF.Fixed,e.depChunks=["shape"],e.data={inputs:[xF("uv",K.ZERO,"vec2","vector"),xF("width",.5,"float","vector")],outputs:[xF("Out",0,"float","vector")]},e}Nt(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0);this.inputs[0].connectSlot||(t="v_uv.xy");var e=this.getInputValue(1);return this.getOutputVarDefine(0)+" = Rectangle("+t+", "+e+");"},e}(JF));t._RF.pop(),t._RF.push({},"ce89b57LA5CTpEIa3CV7imi","round-rectangle",void 0);var fz;WF({menu:"Procedural/Shape/RoundRectangle",title:"RoundRectangle"})(dz=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).concretePrecisionType=bF.Fixed,e.depChunks=["shape"],e.data={inputs:[xF("uv",K.ZERO,"vec2","vector"),xF("width",.5,"float","vector"),xF("radius",.1,"float","vector")],outputs:[xF("Out",0,"float","vector")]},e}Nt(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0);this.inputs[0].connectSlot||(t="v_uv.xy");var e=this.getInputValue(1),i=this.getInputValue(2);return this.getOutputVarDefine(0)+" = RoundRectangle("+t+", "+e+", "+i+");"},e}(JF));t._RF.pop(),t._RF.push({},"db427Xs0q5CMbRASs8quHqY","polar-coordinates",void 0);var gz;WF({menu:"Uv/PolarCoordinates",title:"PolarCoordinates"})(fz=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).concretePrecisionType=bF.Fixed,e.depChunks=["uv"],e.data={inputs:[xF("uv",K.ZERO,"vec2","vector"),xF("center",K.ZERO,"vec2","vector"),xF("radialScale",0,"float","vector"),xF("lengthScale",0,"float","vector")],outputs:[xF("Out",K.ZERO,"vec2","vector")]},e}Nt(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0);this.inputs[0].connectSlot||(t="v_uv.xy");var e=this.getInputValue(1),i=this.getInputValue(2),n=this.getInputValue(3);return this.getOutputVarDefine(0)+" = PolarCoordinates("+t+", "+e+", "+i+", "+n+");"},e}(JF));t._RF.pop(),t._RF.push({},"d6912eLcHVBjrq4U/b1qppk","rotate-coordinates",void 0);var mz;WF({menu:"Uv/RotateCoordinates",title:"RotateCoordinates"})(gz=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).concretePrecisionType=bF.Fixed,e.depChunks=["uv"],e.data={inputs:[xF("uv",K.ZERO,"vec2","vector"),xF("center",K.ZERO,"vec2","vector"),xF("rotation",0,"float","vector")],outputs:[xF("Out",K.ZERO,"vec2","vector")]},e}Nt(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0);this.inputs[0].connectSlot||(t="v_uv.xy");var e=this.getInputValue(1),i=this.getInputValue(2);return this.getOutputVarDefine(0)+" = RotateCoordinates("+t+", "+e+", "+i+");"},e}(JF));t._RF.pop(),t._RF.push({},"5f40e+RWa9OQYJs/kAgd0eT","tilling-and-offset",void 0);var vz;WF({menu:"Uv/TillingAndOffset",title:"TillingAndOffset"})(mz=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).concretePrecisionType=bF.Fixed,e.depChunks=["uv"],e.data={inputs:[xF("uv",K.ZERO,"vec2","vector"),xF("tilling",K.ZERO,"vec2","vector"),xF("offset",K.ZERO,"vec2","vector")],outputs:[xF("Out",K.ZERO,"vec2","vector")]},e}Nt(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0);this.inputs[0].connectSlot||(t="v_uv.xy");var e=this.getInputValue(1),i=this.getInputValue(2);return"\n            "+this.getOutputVarDefine(0)+" = "+t+" * "+e+" + "+i+";\n        "},e}(JF));t._RF.pop(),t._RF.push({},"ce045mF1/xFUKqKc7YUTgo5","index",void 0),t._RF.pop(),t._RF.push({},"c9cd7cUxzJGfqrBxyo6i9Gm","combine",void 0);var yz;WF({menu:"Channel/Combine",title:"Combine"})(vz=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).concretePrecisionType=bF.Fixed,e.data={inputs:[xF("R",0,"float","vector"),xF("G",0,"float","vector"),xF("B",0,"float","vector"),xF("A",0,"float","vector")],outputs:[xF("RGBA",Pt.ZERO,"vec4","vector"),xF("RGB",g.ZERO,"vec3","vector"),xF("RG",K.ZERO,"vec2","vector")]},e}return Nt(e,t),e.prototype.generateCode=function(){var t=this.getSlotWithSlotName("R"),e=this.getSlotWithSlotName("G"),i=this.getSlotWithSlotName("B"),n=this.getSlotWithSlotName("A"),o=this.getSlotWithSlotName("RGBA"),r=this.getSlotWithSlotName("RGB"),a=this.getSlotWithSlotName("RG"),s="";return o&&o.connectSlot&&(s+=(null==o?void 0:o.varDefine)+" = vec4("+(null==t?void 0:t.slotValue)+", "+(null==e?void 0:e.slotValue)+", "+(null==i?void 0:i.slotValue)+", "+(null==n?void 0:n.slotValue)+");\n"),r&&r.connectSlot&&(s+=(null==r?void 0:r.varDefine)+" = vec3("+(null==t?void 0:t.slotValue)+", "+(null==e?void 0:e.slotValue)+", "+(null==i?void 0:i.slotValue)+");\n"),a&&a.connectSlot&&(s+=(null==a?void 0:a.varDefine)+" = vec2("+(null==t?void 0:t.slotValue)+", "+(null==e?void 0:e.slotValue)+");\n"),s},e}(JF));t._RF.pop(),t._RF.push({},"3da06y4hU1Ow4fHMuaVh9Ox","split",void 0);WF({menu:"Channel/Split",title:"Split"})(yz=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).concretePrecisionType=bF.Fixed,e.data={inputs:[xF("Vector",new Pt,"vec4","vector")],outputs:[xF("R",0,"float","vector"),xF("G",0,"float","vector"),xF("B",0,"float","vector"),xF("A",0,"float","vector")]},e}return Nt(e,t),e.prototype.generateCode=function(){var t=this,e=this.getInputValue(0),i=[];return this.data.outputs.forEach((function(n){var o=t.getOutputSlotWithSlotName(n.display);o&&o.connectSlot&&i.push("float "+(null==o?void 0:o.varName)+" = "+e+"."+n.display.toLowerCase()+";")})),i.join("\n")},e}(JF));t._RF.pop(),t._RF.push({},"fcee9eMBvJBt5SDLbWEpbbO","input-node",void 0);var bz,_z=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).concretePrecisionType=bF.Fixed,e}return Nt(e,t),e}(JF);t._RF.pop(),t._RF.push({},"93194csMENJ+oWCPxFCx+9c","property-node",void 0);var Sz;WF({style:{headerColor:"#ec7063"}})(bz=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).concretePrecisionType=bF.Fixed,e.property=null,e.name="",e.data={outputs:[xF("Out",{},"any","any")]},e.isPropertyNode=!0,e}Nt(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){var t=this,e=0;switch(qF.properties.find((function(e){return e.name===t.name})).type){case VF.Float:case VF.Boolean:e=1;break;case VF.Vector2:e=2;break;case VF.Vector3:e=4;break;case VF.Vector4:case VF.Color:e=4}this.slots[0]._concretePrecision=e},i.generateCode=function(){return""},e}(JF));t._RF.pop(),t._RF.push({},"08b1ekFRoNLQ5UDBj6YtBOO","all",void 0);var wz;WF({menu:"Logic/All",title:"All"})(Sz=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).concretePrecisionType=bF.Min,e.data={inputs:[xF("In",Pt.ZERO,"vec4","vector")],outputs:[xF("Out",!1,"boolean","boolean")]},e}Nt(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){for(var t=this.getInputValue(0),e=this.getOutputVarDefine(0),i=["x","y","z","w"],n=[],o=this.slots[0].concretePrecision,r=0;r<o;r++)n.push("("+t+"."+i[r]+" > 0.)");return"\n            "+e+" = ("+n.join(" && ")+");\n        "},e}(JF));t._RF.pop(),t._RF.push({},"ad796qaJ35K1pVtAoiLAQwn","and",void 0);var Tz;WF({menu:"Logic/And",title:"And"})(wz=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).concretePrecisionType=bF.Max,e.data={inputs:[xF("A",!1,"boolean","boolean"),xF("B",!1,"boolean","boolean")],outputs:[xF("Out",!1,"boolean","boolean")]},e}Nt(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0),e=this.getInputValue(1);return"\n            "+this.getOutputVarDefine(0)+" = ("+t+" && "+e+");\n        "},e}(JF));t._RF.pop(),t._RF.push({},"c213eN4ql1Fo5ECkorGOGam","any",void 0);var Cz;WF({menu:"Logic/Any",title:"Any"})(Tz=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).concretePrecisionType=bF.Min,e.data={inputs:[xF("In",Pt.ZERO,"vec4","vector")],outputs:[xF("Out",!1,"boolean","boolean")]},e}Nt(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){for(var t=this.getInputValue(0),e=this.getOutputVarDefine(0),i=["x","y","z","w"],n=[],o=this.slots[0].concretePrecision,r=0;r<o;r++)n.push("("+t+"."+i[r]+" > 0.)");return"\n            "+e+" = ("+n.join(" || ")+");\n        "},e}(JF));t._RF.pop(),t._RF.push({},"2f31f/lK6hGfInMVVNdS8Sy","branch",void 0);var Ez;WF({menu:"Logic/Branch",title:"Branch"})(Cz=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).concretePrecisionType=bF.Max,e.data={inputs:[xF("Predicate",!1,"boolean","boolean"),xF("True",Pt.ZERO,"vec4","vector"),xF("False",Pt.ZERO,"vec4","vector")],outputs:[xF("Out",Pt.ZERO,"vec4","vector")]},e}Nt(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0),e=this.getInputValue(1),i=this.getInputValue(2);return"\n            "+this.getOutputVarDefine(0)+" = ("+t+") ? ("+e+") : ("+i+");\n        "},e}(JF));t._RF.pop(),t._RF.push({},"29cf0dWHHJIo4dVJcv8q6Ik","comparison",void 0);var Az,Pz=function(t){return t[t.Equal=0]="Equal",t[t.NotEqual=1]="NotEqual",t[t.Less=2]="Less",t[t.LessOrEqual=3]="LessOrEqual",t[t.Greater=4]="Greater",t[t.GreaterOrEqual=5]="GreaterOrEqual",t}(Pz||{});WF({menu:"Logic/Comparison",title:"Comparison"})(Ez=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).concretePrecisionType=bF.Fixed,e.fixedConcretePrecision=1,e.data={props:[FF("Type",Pz.Equal,"enum",{enum:Pz})],inputs:[xF("A",0,"float","vector"),xF("B",0,"float","vector")],outputs:[xF("Out",0,"boolean","boolean")]},e}Nt(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0),e=this.getInputValue(1),i=this.getOutputVarDefine(0),n="";switch(this.getPropWithName("Type").value){case Pz.Equal:n="("+t+" == "+e+")";break;case Pz.NotEqual:n="("+t+" != "+e+")";break;case Pz.Less:n="("+t+" < "+e+")";break;case Pz.LessOrEqual:n="("+t+" <= "+e+")";break;case Pz.Greater:n="("+t+" > "+e+")";break;case Pz.GreaterOrEqual:n="("+t+" >= "+e+")"}return"\n            "+i+" = "+n+";\n        "},e}(JF));t._RF.pop(),t._RF.push({},"c8ed6hsGT1HOKJ9Qr9y8+aM","is-nan",void 0);var Mz;WF({menu:"Logic/IsNan",title:"IsNan"})(Az=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).concretePrecisionType=bF.Fixed,e.fixedConcretePrecision=1,e.data={inputs:[xF("In",0,"float","vector")],outputs:[xF("Out",!1,"boolean","boolean")]},e}Nt(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0);return"\n            "+this.getOutputVarDefine(0)+" = isnan("+t+");\n        "},e}(JF));t._RF.pop(),t._RF.push({},"aad29jVDvZJX7eHgVCkzuSx","not",void 0);var Iz;WF({menu:"Logic/Not",title:"Not"})(Mz=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).concretePrecisionType=bF.Max,e.data={inputs:[xF("In",!1,"boolean","boolean")],outputs:[xF("Out",!1,"boolean","boolean")]},e}Nt(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0);return"\n            "+this.getOutputVarDefine(0)+" = (!"+t+");\n        "},e}(JF));t._RF.pop(),t._RF.push({},"a2b3fR0/g9EC7haT+6NqTEL","or",void 0);WF({menu:"Logic/Or",title:"Or"})(Iz=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).concretePrecisionType=bF.Max,e.data={inputs:[xF("A",!1,"boolean","boolean"),xF("B",!1,"boolean","boolean")],outputs:[xF("Out",!1,"boolean","boolean")]},e}Nt(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0),e=this.getInputValue(1);return"\n            "+this.getOutputVarDefine(0)+" = ("+t+" || "+e+");\n        "},e}(JF));t._RF.pop(),t._RF.push({},"1eab7ptCA1KiK+C6tmMVON/","MasterNode",void 0);var Nz=function(t){return t[t.Vertex=0]="Vertex",t[t.Fragment=1]="Fragment",t}({});function Oz(t,e){if(t.connectSlot){var i=t.connectNode;if(i){if(e.includes(i))return;i.inputs.forEach((function(t){Oz(t,e)})),e.push(i)}}}var Lz,Rz=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).isMasterNode=!0,e.concretePrecisionType=bF.Fixed,e.properties=[],e.data={inputs:[]},e}Nt(e,t);var i=e.prototype;return i.getConnectNodes=function(t){var e=[];return t.forEach((function(t){Oz(t,e)})),e.sort((function(t,e){return e.priority-t.priority})),e},i.generatePropertiesCode=function(){var t="\n",e="\n",i="",n=qF.properties;n.sort((function(t,e){return e.concretePrecision-t.concretePrecision}));var o=0;return n.forEach((function(n){var r="",a="",s=n.value,l=n.type===VF.Color,c=s.x,u=s.y,h=s.z,p=s.w;if(n.type===VF.Texture2D)r="sampler2D",a="white";else if(n.type===VF.TextureCube)r="samplerCube",a="white";else{var d=n.concretePrecision;1===d?(r="float",a=""+s):2===d?(r="vec2",a="["+c+", "+u+"]"):3===d?(r="vec4",a="["+c+", "+u+", "+h+", 0]"):4===d&&(r="vec4",a="["+c+", "+u+", "+h+",  "+p+"]")}var f=l?", editor: { type: color }":"";n.isTexture()?i+="  uniform "+r+" "+n.name+";\n":(t+="    "+r+" "+n.name+";\n",o++),e+="        "+n.name+": { value: "+a+" "+f+"}\n"})),0===o&&(t+="    vec4 empty_value;\n"),{uniform:t,uniformSampler:i,mtl:e}},i.replaceChunks=function(t){var e=["common"];qF.allNodes.forEach((function(t){for(var i=0;i<t.depChunks.length;i++)e.includes(t.depChunks[i])||e.push(t.depChunks[i])}));var i="\n",n="\n";return e.forEach((function(t){var e=AF.join(qF.shaderTemplatesDir,"chunks/"+t+".chunk"),o=EF.readFileSync(e,"utf-8");o?(n+=o+"\n",i+="  #include <shader_graph_"+t+">\n"):console.error("Can not find chunk with path ["+e+"]")})),t=(t=(t=t.replace("{{chunks}}",n)).replace("{{vs_chunks}}",i)).replace("{{fs_chunks}}",i)},i.generateDefines=function(t){var e=[];qF.allNodes.forEach((function(t){t.defines.forEach((function(t){e.includes(t)||e.push(t)}))}));var i="";e.forEach((function(t){i+=t+"\n"})),i=kF(wF,i),i=kF(SF,i);var n=(i=kF(TF,i)).split("\n");return n=n.map((function(t){return"  "+t})),i=n.join("\n"),t.replace(/{{defines}}/g,i)},i.generateSlotsCode=function(t){var e=["\n"];return this.getConnectNodes(t).forEach((function(t){t.calcConcretePrecision(),t.generateCode().split("\n").forEach((function(i){i&&(i+=" // "+t.constructor.name,e.push("    "+i))}))})),e.join("\n")},i.generateCodeChunk=function(t){var e=this,i=[];return this.inputs.forEach((function(t){var e=t.data;i[e.codeChunk]||(i[e.codeChunk]=[]),i[e.codeChunk].push(t)})),i.forEach((function(i,n){var o=e.generateSlotsCode(i);t=t.replace("{{code_chunk_"+n+"}}",o)})),t},i.generateCode=function(){var t=EF.readFileSync(this.templatePath,"utf-8");t=this.generateCodeChunk(t),t=this.generateDefines(t),t=this.replaceChunks(t),qF.properties&&0!==qF.properties.length||(t=(t=t.replace(/properties: &props/g,"")).replace(/properties: \*props/g,""));var e=this.generatePropertiesCode();t=(t=(t=t.replace("{{properties}}",e.uniform)).replace("{{properties_sampler}}",e.uniformSampler)).replace("{{properties_mtl}}",e.mtl);var i=["Vertex Position","Vertex Normal","Vertex Tangent","Position"];return this.inputs.forEach((function(e){var n,o="slot_"+e.displayName.replace(/ /g,"_");i.includes(e.displayName)||"Normal"===e.displayName?e.connectSlot&&(n=e.slotValue):n=e.slotValue;var r=new RegExp("{{"+o+" *= *(.*)}}","g");if(void 0===n){var a=r.exec(t);a&&(n=a[1])}t=t.replace(r,n)})),t},i.createMaterial=function(){var t=Rt(xt().mark((function t(e){var i,n,o,r;return xt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=this.generateCode(),n=new Mt,"shader-graph-preview.effect",t.next=5,e("shader-graph-preview.effect",i);case 5:return o=t.sent,r=new cc.EffectAsset,Object.assign(r,o),r.onLoaded(),n.initialize({effectAsset:o}),t.next=12,Promise.all(qF.properties.map(Rt(xt().mark((function t(e){var i;return xt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.type!==VF.Texture2D&&e.type!==VF.TextureCube){t.next=3;break}return i=e.value.uuid,t.abrupt("return",new Promise((function(t){u.loadAny(i,(function(i,o){if(i)return console.error(i),t(null);n.setProperty(e.name,o),t(null)}))})));case 3:case"end":return t.stop()}}),t)})))));case 12:return t.abrupt("return",n);case 13:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}(),Ft(e,[{key:"templatePath",get:function(){return""}}]),e}(JF);t._RF.pop(),t._RF.push({},"3dc0bllbkxAsKzvUgvzcrgb","SurfaceMasterNode",void 0);var xz;WF({title:"Surface",master:!0})(Lz=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[xF("Vertex Position",g.ZERO,"vec3","vector",{slotType:Nz.Vertex,codeChunk:0}),xF("Vertex Normal",g.ZERO,"vec3","vector",{slotType:Nz.Vertex,codeChunk:0}),xF("Vertex Tangent",g.ZERO,"vec3","vector",{slotType:Nz.Vertex,codeChunk:0}),xF("Albedo",new Pt(.5,.5,.5,.5),"color","vector",{slotType:Nz.Fragment,codeChunk:3}),xF("Normal",g.ZERO,"vec3","vector",{slotType:Nz.Fragment,codeChunk:3}),xF("Emission",g.ZERO,"vec3","vector",{slotType:Nz.Fragment,codeChunk:3}),xF("Metallic",.6,"float","vector",{slotType:Nz.Fragment,codeChunk:3}),xF("Roughness",.5,"float","vector",{slotType:Nz.Fragment,codeChunk:3}),xF("Occlusion",1,"float","vector",{slotType:Nz.Fragment,codeChunk:3}),xF("SpecularIntensity",.5,"float","vector",{slotType:Nz.Fragment,codeChunk:3}),xF("Alpha",1,"float","vector",{slotType:Nz.Fragment,codeChunk:3}),xF("AlphaClipThreshold",.5,"float","vector",{slotType:Nz.Fragment,codeChunk:3}),xF("AnisotropyRotation",0,"float","vector",{slotType:Nz.Fragment,codeChunk:3}),xF("AnisotropyShape",1,"float","vector",{slotType:Nz.Fragment,codeChunk:3})]},e}return Nt(e,t),e.prototype.generateCode=function(){var e,i;null==(e=this.getSlotWithSlotName("AnisotropyRotation"))||e.connectSlot,null==(i=this.getSlotWithSlotName("AnisotropyShape"))||i.connectSlot;return t.prototype.generateCode.call(this)},Ft(e,[{key:"templatePath",get:function(){return AF.join(qF.shaderTemplatesDir,"master/SurfaceMasterNode.effect")}}]),e}(Rz));t._RF.pop(),t._RF.push({},"f3fa2kI6ulBJKyUfbfTCT2P","UnlitMasterNode",void 0);var Fz;WF({title:"Unlit",master:!0})(xz=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[xF("Vertex Position",g.ZERO,"vec3","vector",{slotType:Nz.Vertex,codeChunk:0}),xF("Vertex Normal",g.ZERO,"vec3","vector",{slotType:Nz.Vertex,codeChunk:0}),xF("Vertex Tangent",g.ZERO,"vec3","vector",{slotType:Nz.Vertex,codeChunk:0}),xF("BaseColor",new Pt(.5,.5,.5,.5),"color","vector",{slotType:Nz.Fragment,codeChunk:3}),xF("Alpha",1,"float","vector",{slotType:Nz.Fragment,codeChunk:3}),xF("AlphaClipThreshold",0,"float","vector",{slotType:Nz.Fragment,codeChunk:3})]},e}return Nt(e,t),e.generatePreviewCode=function(t){var i=new e;i.init();var n=i.getSlotWithSlotName("BaseColor");return n&&(n.connectSlots[0]=t.outputs[0]),i.generateCode()},Ft(e,[{key:"templatePath",get:function(){return AF.join(qF.shaderTemplatesDir,"master/UnlitMasterNode.effect")}}]),e}(Rz));t._RF.pop(),t._RF.push({},"159abqfjclCYp0gqjzKIy69","SubGraphNode",void 0);var Dz;WF({style:{headerColor:"#757575"}})(Fz=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[xF("In",0,"any","any")],outputs:[xF("Out",0,"any","any")]},e}return Nt(e,t),e}(JF));t._RF.pop(),t._RF.push({},"a7a1dWl92NFI7N6B5WUHBcO","SubGraphOutputNode",void 0);var zz;WF({title:"Output",master:!0,style:{headerColor:"#81ff2f"}})(Dz=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[xF("Out",0,"any","any")]},e}return Nt(e,t),e}(JF));t._RF.pop(),t._RF.push({},"f8b0fdliVNBereLRNhLivTf","PreviewNode",void 0),t._RF.pop(),t._RF.push({},"e3d34kNDmBJC7P5ldMA5yga","color",void 0);var kz;WF({menu:"Input/Basic/Color",title:"Color"})(zz=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).fixedConcretePrecision=4,e.data={props:[FF("Color",new Pt,"color")],outputs:[xF("Out",new Pt,"vec4","vector")]},e}return Nt(e,t),e.prototype.generateCode=function(){var t=this.getPropWithName("Color").value;return"vec4 "+this.getOutputVarName(0)+" = vec4("+t.x+", "+t.y+", "+t.z+", "+t.w+");"},e}(_z));t._RF.pop(),t._RF.push({},"d78e7iowiJHXbVo2J+jhSXo","time",void 0);var Vz;WF({menu:"Input/Basic/Time",title:"Time"})(kz=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).data={outputs:[xF("Time",0,"float","vector"),xF("Sine Time",0,"float","vector"),xF("Cosine Time",0,"float","vector"),xF("Delta Time",0,"float","vector"),xF("Smooth Delta",0,"float","vector")]},e}return Nt(e,t),e.prototype.generateCode=function(){var t=this.getOutputSlotWithSlotName("Time"),e=this.getOutputSlotWithSlotName("Sine Time"),i=this.getOutputSlotWithSlotName("Cosine Time"),n=this.getOutputSlotWithSlotName("Delta Time"),o=this.getOutputSlotWithSlotName("Smooth Delta"),r="";return null!=t&&t.connectSlot&&(r+="float "+t.varName+" = cc_time.x;"),null!=e&&e.connectSlot&&(r+="float "+e.varName+" = sin(cc_time.x);"),null!=i&&i.connectSlot&&(r+="float "+i.varName+" = cos(cc_time.x);"),null!=n&&n.connectSlot&&(r+="float "+n.varName+" = cc_time.y;"),null!=o&&o.connectSlot&&(console.warn("Not support smooth delta time"),r+="float "+o.varName+" = cc_time.y;"),r},e}(_z));t._RF.pop(),t._RF.push({},"f4d52tjGCZK1JsKsZ4QUDNC","normal-vector",void 0);var Bz;WF({menu:"Input/Geometry/NormalVector",title:"NormalVector"})(Vz=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).concretePrecisionType=bF.Fixed,e.fixedConcretePrecision=3,e.data={props:[FF("Space",wF.World,"enum",{enum:wF})],outputs:[xF("Normal",g.ZERO,"vec3","vector")]},e}return Nt(e,t),e.prototype.generateCode=function(){var t=this.getPropWithName("Space"),e="normal";return t.value===wF.Local?e="normal":t.value===wF.View?e="viewNormal":t.value===wF.World&&(e="worldNormal"),this.defines=[zF(wF,t.value)],this.getOutputVarDefine(0)+" = "+e+";"},e}(JF));t._RF.pop(),t._RF.push({},"c4117F5YClIWKQl+GltCNqQ","position",void 0);var Hz;WF({menu:"Input/Geometry/Position",title:"Position"})(Bz=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).concretePrecisionType=bF.Fixed,e.fixedConcretePrecision=3,e.data={props:[FF("Space",SF.World,"enum",{enum:SF})],outputs:[xF("Position",new g,"vec3","vector")]},e}return Nt(e,t),e.prototype.generateCode=function(){var t=this.getPropWithName("Space"),e="position";return t.value===SF.Local?e="position":t.value===SF.View?e="viewPos":t.value===SF.World&&(e="worldPos"),this.defines=[zF(SF,t.value)],this.getOutputVarDefine(0)+" = "+e+".xyz;"},e}(JF));t._RF.pop(),t._RF.push({},"95b7bSNki1Ba5Pk4AQXXcG5","uv",void 0);var Uz;WF({menu:"Input/Geometry/UV",title:"UV"})(Hz=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).concretePrecisionType=bF.Fixed,e.fixedConcretePrecision=2,e.data={props:[FF("Channel",0,"float")],outputs:[xF("UV",new K,"vec2","vector")]},e}return Nt(e,t),e.prototype.generateCode=function(){var t=this.getPropWithName("Channel");if(!t)return console.warn("UV Node generate code undefined"),"";var e="v_uv"+(t.value>0?t.value:"");return this.getOutputVarDefine(0)+" = "+e+";"},e}(JF));t._RF.pop(),t._RF.push({},"57f73xnQclNJoH/LZDbCo8N","vertex-color",void 0);var Gz;WF({menu:"Input/Geometry/VertexColor",title:"VertexColor"})(Uz=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).concretePrecisionType=bF.Fixed,e.fixedConcretePrecision=4,e.data={outputs:[xF("Out",new Pt,"vec4","vector")]},e}return Nt(e,t),e.prototype.generateCode=function(){return this.getOutputVarDefine(0)+" = FSInput_vertexColor;"},e}(JF));t._RF.pop(),t._RF.push({},"fbe73AP6NxBTqOrL07ng2zD","view-direction",void 0);var Wz;WF({menu:"Input/Geometry/ViewDirection",title:"ViewDirection"})(Gz=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).concretePrecisionType=bF.Fixed,e.fixedConcretePrecision=3,e.data={props:[FF("Space",TF.World,"enum",{enum:TF})],outputs:[xF("ViewDirection",new g,"vec3","vector")]},e}return Nt(e,t),e.prototype.generateCode=function(){var t=this.getPropWithName("Space"),e="view";return t.value===TF.Local?e="view":t.value===TF.View?e="viewView":t.value===TF.World&&(e="worldView"),this.defines=[zF(TF,t.value)],this.getOutputVarDefine(0)+" = "+e+";"},Ft(e,[{key:"type",get:function(){return"ViewDirection"}}]),e}(JF));t._RF.pop(),t._RF.push({},"ae6c5dYR/dM3qMNrhlBY9Hs","texture-asset",void 0),t._RF.pop(),t._RF.push({},"f593b68ejRHboYTcPDL7dZe","cubemap-asset",void 0),t._RF.pop(),t._RF.push({},"6f28a7ED/hGlLSDg1Rd/nOf","sample-cubemap",void 0),t._RF.pop(),t._RF.push({},"5895aMpjJJED5bYGNm0JmUq","sample-texture2d",void 0);var qz,Zz=function(t){return t[t.Default=0]="Default",t[t.Normal=1]="Normal",t}(Zz||{}),Yz=function(t){return t[t.Tangent=0]="Tangent",t[t.Object=1]="Object",t}(Yz||{});WF({menu:"Input/Texture/SampleTexture2D",title:"SampleTexture2D"})(Wz=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).data={props:[FF("TextureType",Zz.Default,"enum",{enum:Zz}),FF("NormalSpace",Yz.Tangent,"enum",{enum:Yz})],inputs:[xF("Texture",new p,"texture2D","texture2D"),xF("UV",K.ZERO,"vec2","vector")],outputs:[xF("RGBA",Pt.ZERO,"vec4","vector"),xF("R",0,"float","vector"),xF("G",0,"float","vector"),xF("B",0,"float","vector"),xF("A",0,"float","vector")]},e}return Nt(e,t),e.prototype.generateCode=function(){var t,e,i=this.getSlotWithSlotName("Texture"),n=this.getSlotWithSlotName("UV"),o=this.getSlotWithSlotName("RGBA"),r=null==o?void 0:o.varName;null!=i&&i.connectSlot?(e=n.connectSlot?n.slotValue:"v_uv",t="vec4 "+r+" = texture("+(null==i?void 0:i.connectSlot.varName)+", "+e+");\n"):t="vec4 "+r+" = vec4(1.);\n";var a=this.getPropWithName("TextureType"),s=this.getPropWithName("NormalSpace");a.value===Zz.Normal&&s.value===Yz.Tangent&&(t+=r+".xyz -= vec3(0.5);\n",t+=r+".xyz = \n",t+="  "+r+".x * normalize(worldTangent) +\n",t+="  "+r+".y * normalize(worldBinormal) +\n",t+="  "+r+".z * normalize(worldNormal);\n",this.defines.push("CC_SURFACES_USE_TANGENT_SPACE"));var l=this.getSlotWithSlotName("R");l&&l.connectSlot&&(t+="float "+l.varName+" = "+r+".r;\n");var c=this.getSlotWithSlotName("G");c&&c.connectSlot&&(t+="float "+c.varName+" = "+r+".g;\n");var u=this.getSlotWithSlotName("B");u&&u.connectSlot&&(t+="float "+u.varName+" = "+r+".b;\n");var h=this.getSlotWithSlotName("A");return h&&h.connectSlot&&(t+="float "+h.varName+" = "+r+".a;\n"),t},e}(_z));t._RF.pop(),t._RF.push({},"1e7d5h/dpNKOKPycPdVfiDZ","texture2d-asset",void 0),t._RF.pop(),t._RF.push({},"30feaYkdKtOs5doShMcgDKA","get-local-var",void 0);var jz;WF({menu:"Input/Variable/GetLocalVar",title:"GetLocalVar"})(qz=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).data={props:[FF("Name","local_var","dynamicEnum",{registerEnum:{type:"RegisterLocalVarName",property:"Name"}})],outputs:[xF("Out",Pt.ZERO,"vec4","vector")]},e}return Nt(e,t),e.prototype.generateCode=function(){return this.inputs[0].connectSlot.precisionName+" "+this.name+"= "+this.getInputValue(0)+";"},Ft(e,[{key:"name",get:function(){var t=this.getPropWithName("Name");return t&&t.value},set:function(t){this.getPropWithName("Name").value=t}}]),e}(JF));t._RF.pop(),t._RF.push({},"b61a9DvFcxESK2/fNFtqY0h","register-local-var",void 0);WF({menu:"Input/Variable/RegisterLocalVar",title:"RegisterLocalVar"})(jz=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),o=0;o<i;o++)n[o]=arguments[o];return(e=t.call.apply(t,[this].concat(n))||this).isRegisterLocalVar=!0,e.data={props:[FF("Name","local_var","string",{registerEnumType:"RegisterLocalVarName"})],inputs:[xF("In",Pt.ZERO,"vec4","vector")]},e}return Nt(e,t),e.prototype.generateCode=function(){return""},Ft(e,[{key:"name",get:function(){return this.getPropWithName("Name").value},set:function(t){this.getPropWithName("Name").value=t}}]),e}(JF));t._RF.pop(),t._RF.push({},"00450ydLIRBS6bzTCNNRjmm","index",void 0),t._RF.pop(),t._RF.push({},"c03d0yZbI5CPJyIvpnia5dO","shadergraph",void 0),t._RF.pop()}}}));

(function(r) {
  r('virtual:///prerequisite-imports/main', 'chunks:///main.js'); 
})(function(mid, cid) {
    System.register(mid, [cid], function (_export, _context) {
    return {
        setters: [function(_m) {
            var _exportObj = {};

            for (var _key in _m) {
              if (_key !== "default" && _key !== "__esModule") _exportObj[_key] = _m[_key];
            }
      
            _export(_exportObj);
        }],
        execute: function () { }
    };
    });
});