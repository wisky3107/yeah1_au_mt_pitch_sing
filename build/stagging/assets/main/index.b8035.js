System.register("chunks:///main.js",["cc","./rollupPluginModLoBabelHelpers-2a4540ca.js"],(function(){var t,e,i,n,r,o,a,s,l,c,u,h,p,d,f,g,m,v,y,b,_,S,w,T,E,A,C,P,M,I,N,L,O,R,x,F,D,z,k,V,B,H,U,G,W,q,Z,Y,j,K,X,J,Q,$,tt,et,it,nt,rt,ot,at,st,lt,ct,ut,ht,pt,dt,ft,gt,mt,vt,yt,bt,_t,St,wt,Tt,Et,At,Ct,Pt,Mt,It,Nt,Lt,Ot,Rt,xt,Ft,Dt;return{setters:[function(Mt){t=Mt.cclegacy,e=Mt._decorator,i=Mt.SpriteFrame,n=Mt.math,r=Mt.randomRangeInt,o=Mt.Component,a=Mt.resources,s=Mt.Asset,l=Mt.Prefab,c=Mt.Node,u=Mt.assetManager,h=Mt.SpriteAtlas,p=Mt.Texture2D,d=Mt.ImageAsset,f=Mt.Sprite,g=Mt.Vec3,m=Mt.v3,v=Mt.tween,y=Mt.Label,b=Mt.UIOpacity,_=Mt.easing,S=Mt.sys,w=Mt.native,T=Mt.log,E=Mt.error,A=Mt.instantiate,C=Mt.find,P=Mt.isValid,M=Mt.director,I=Mt.game,N=Mt.AudioSource,L=Mt.AudioClip,O=Mt.Enum,R=Mt.KeyCode,x=Mt.Button,F=Mt.EventHandler,D=Mt.input,z=Mt.Input,k=Mt.Toggle,V=Mt.NodeEventType,B=Mt.UITransform,H=Mt.rect,U=Mt.CCBoolean,G=Mt.CCInteger,W=Mt.v2,q=Mt.screen,Z=Mt.Widget,Y=Mt.view,j=Mt.Slider,K=Mt.Vec2,X=Mt.Color,J=Mt.EventTouch,Q=Mt.macro,$=Mt.Layout,tt=Mt.Size,et=Mt.EditBox,it=Mt.Tween,nt=Mt.NodePool,rt=Mt.Game,ot=Mt.CCFloat,at=Mt.TextAsset,st=Mt.SkeletalAnimation,lt=Mt.Animation,ct=Mt.ParticleSystem2D,ut=Mt.ProgressBar,ht=Mt.MeshRenderer,pt=Mt.ScrollView,dt=Mt.animation,ft=Mt.ParticleSystem,gt=Mt.random,mt=Mt.randomRange,vt=Mt.SkinnedMeshRenderer,yt=Mt.EventTarget,bt=Mt.JsonAsset,_t=Mt.Camera,St=Mt.Quat,wt=Mt.PhysicsSystem,Tt=Mt.ToggleContainer,Et=Mt.ValueType,At=Mt.TextureCube,Ct=Mt.Vec4,Pt=Mt.Material},function(t){Mt=t._,It=t.a,Nt=t.b,Lt=t.c,Ot=t.d,Rt=t.e,xt=t.f,Ft=t.g,Dt=t.h}],execute:function(){var zt,kt;t._RF.push({},"a3605ZRcydAsqLfvt2I7n/+","CSVLoader",void 0),t._RF.pop(),t._RF.push({},"f3654C79/FGx7RDXCjGKZLE","ClientEvent",void 0);var Vt,Bt=e.ccclass,Ht=(e.property,Bt("clientEvent")(((kt=function(){function t(){}return t.on=function(e,i,n){var r={handler:i,target:n},o=t._handlers[e];o||(o=[],t._handlers[e]=o);for(var a=0;a<o.length;a++)if(!o[a])return o[a]=r,a;return o.push(r),o.length},t.off=function(e,i,n){var r=t._handlers[e];if(r)for(var o=0;o<r.length;o++){var a=r[o];if(a.handler===i&&(!n||n===a.target)){r.splice(o,1);break}}},t.dispatchEvent=function(e){for(var i=arguments.length,n=new Array(i>1?i-1:0),r=1;r<i;r++)n[r-1]=arguments[r];var o,a=t._handlers[e],s=[];for(o=1;o<arguments.length;o++)s.push(arguments[o]);if(a)for(o=0;o<a.length;o++){var l=a[o];l.handler&&l.handler.apply(l.target,s)}},t}())._handlers={},zt=kt))||zt);t._RF.pop(),t._RF.push({},"bebeaAU60hJjpSfuLpkpTPQ","ComponentPool",void 0);var Ut,Gt,Wt,qt,Zt,Yt,jt,Kt,Xt,Jt,Qt,$t,te=e.ccclass,ee=(e.property,te("ComponentPool")(Vt=function(){function t(t,e){this.pool=void 0,this.factory=void 0,this.parentNode=void 0,this.pool=[],this.factory=t,this.parentNode=e}var e=t.prototype;return e.init=function(t){for(var e=0;e<t;e++){var i=this.factory();i.node.parent=this.parentNode,this.put(i)}},e.get=function(){if(this.pool.length>0){var t=this.pool.pop();return t.node.active=!0,t}var e=this.factory();return e.node.parent=this.parentNode,e},e.put=function(t){t.node.active=!1,t.node.parent=this.parentNode,this.pool.push(t)},e.putAll=function(t){var e=this;t.forEach((function(t){return e.put(t)}))},e.clear=function(){this.pool.forEach((function(t){t.node.destroy()})),this.pool=[]},t}())||Vt);t._RF.pop(),t._RF.push({},"449f63urB5BrqfvzhGei/dM","ImageLoader",void 0);var ie,ne,re,oe,ae,se,le,ce=e.ccclass,ue=e.property,he=(Ut=ce("ImageLoader"),Gt=ue([i]),Wt=ue([i]),qt=ue(i),Zt=ue(i),Ut((($t=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return e=t.call.apply(t,[this].concat(n))||this,Nt(e,"preloadSpriteFrames",Kt,Lt(e)),Nt(e,"avatarSpriteframe",Xt,Lt(e)),Nt(e,"sfDiamonds",Jt,Lt(e)),Nt(e,"sfCoins",Qt,Lt(e)),e.spriteFrameMap=new Map,e}It(e,t);var i=e.prototype;return i.onLoad=function(){e.instance=this,this.initSpriteFrames()},i.initSpriteFrames=function(){var t=this;this.preloadSpriteFrames.forEach((function(e){t.spriteFrameMap.set(e.name,e)}))},i.getSpriteFrame=function(t){return this.spriteFrameMap.has(t)?this.spriteFrameMap.get(t):(console.error("Unknown sprite"+t),null)},i.getAvatar=function(t){var e=(Number(t)%1e3).toString(),i=function(t){try{var i;return parseInt(null!=(i=e[e.length-t])?i:"0")}catch(t){return 0}};try{var r=i(1),o=i(2),a=n.clamp(r+o,0,this.avatarSpriteframe.length-1);return this.avatarSpriteframe[a]}catch(t){return null}},i.getRandomCapyImage=function(){return this.avatarSpriteframe[r(0,this.avatarSpriteframe.length)]},e}(o)).instance=null,Kt=Mt((jt=$t).prototype,"preloadSpriteFrames",[Gt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Xt=Mt(jt.prototype,"avatarSpriteframe",[Wt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Jt=Mt(jt.prototype,"sfDiamonds",[qt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Qt=Mt(jt.prototype,"sfCoins",[Zt],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Yt=jt))||Yt);function pe(t,e){return void 0===e&&(e=1),new Promise((function(i,n){a.load(t,(function(t,r){if(t)return console.error("Error loading asset:",t),void n(t);if(!(r instanceof s)){var o=new Error("Invalid asset type loaded");return console.error(o.message,r),void n(o)}var a=r.nativeUrl,l=new XMLHttpRequest;l.open("GET",a,!0),l.responseType="arraybuffer",l.onload=function(){if(200===l.status){var t=l.response,r=new Uint8Array(t);try{var o=new Midi(r.buffer);console.log("MIDI file loaded successfully:",o),e>=0&&o.tracks&&o.tracks.length>e?i(o.tracks[e]):i(o)}catch(t){console.error("Error parsing MIDI data:",t),n(t)}}else{var a=new Error("Error loading binary data: "+l.statusText);console.error(a.message),n(a)}},l.onerror=function(t){n(new Error("Network error during MIDI file loading"))},l.send()}))}))}function de(t,e){return void 0===e&&(e=1),new Promise((function(i,n){var r=new XMLHttpRequest;r.open("GET",t,!0),r.responseType="arraybuffer",r.onload=function(){if(200===r.status){var t=r.response,o=new Uint8Array(t);try{if("undefined"!=typeof window&&window.Midi){var a=new window.Midi(o.buffer);console.log("MIDI file loaded successfully:",a);var s=a.tracks&&a.tracks.length>e?a.tracks[e]:null;i(s||a)}else n(new Error("Midi parser not available"))}catch(t){console.error("Error parsing MIDI data:",t),n(t)}}else n(new Error("Error loading binary data: "+r.statusText))},r.onerror=function(){n(new Error("Network error during MIDI file loading"))},r.send()}))}t._RF.pop(),t._RF.push({},"1b61cY0MSxGRrqa3QwVp8IO","MidiReader",void 0),t._RF.pop(),t._RF.push({},"6de52PO/FFI4qh57HrWi8RF","ObjectPoolData",void 0);var fe=e.ccclass,ge=e.property;ie=fe("ObjectPoolData"),ne=ge(l),re=ge(c),ie((se=Mt((ae=function(){Nt(this,"prefab",se,this),Nt(this,"container",le,this)}).prototype,"prefab",[ne],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),le=Mt(ae.prototype,"container",[re],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),oe=ae));t._RF.pop(),t._RF.push({},"5f860beWrBGtbckv8i95YZU","Constants",void 0);var me={EVENT_NAME:{GAME_INITED:"GAME_INITED_DONE",USERDATA_UPDATED:"USERDATA_UPDATED",USERCOIN_UPDATED:"USERCOIN_UPDATED"},RESOURCE_PATH:{GAME_MAIN_PATH:"prefab/Game"},SOUND_FILES:{SFX_PATH:"sounds/sfx/"},CAMERA_CONFIG:{MIN_SIZE:200},CAMERA_ZOOM_THRESHOLD:500,AUTO_TIME:3,STORAGE_KEY:{BGM_VOLUME:"BGM_VOLUME",SFX_VOLUME:"SFX_VOLUME",USER_MODIFIER:"USER_MODIFIER"},EFFECT:{MOVING_UI_OBJECT:"moving",UI_COINS:"coins",UI_TURNS:"turns",LEVLEUP_SMALL:"levelup_small",LEVLEUP_BIG:"levelup_big",CONFETTI:"confetti",TEXT:"text"},GAME:{PHYSIC_GRAVITY:18},VIEW:{TOPHUB:"ViewTopHub"}},ve={API:"",LOG:!0};t._RF.pop(),t._RF.push({},"ad288/O58VDkJlgQZZZjRwu","assetRemoteUtil",void 0);var ye,be=function(){function t(){}return t.loadBundle=function(t,e){u.loadBundle(t,null,(function(t,i){if(t)return console.error(t),void e(t,null);e(null,i)}))},t.loadAltas=function(t,e,i){this.loadBundle(t,(function(t,n){t?null==i||i(t,null):n.load(e,h,(function(t,e){if(t)return console.error(t),void(null==i||i(t,null));null==i||i(null,e)}))}))},t.loadRemoteImage=function(){var t=Ot(Rt().mark((function t(e){var n,r,o,a,s,l;return Rt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,e="https://cors-anywhere.herokuapp.com/"+e,t.next=4,fetch(e);case 4:if((n=t.sent).ok){t.next=7;break}throw new Error("HTTP error! Status: "+n.status);case 7:return t.next=9,n.blob();case 9:return r=t.sent,(o=new Image).crossOrigin="Anonymous",a=new Promise((function(t,e){o.onload=function(){return t(o)},o.onerror=function(){return e(new Error("Failed to load image element"))}})),o.src=URL.createObjectURL(r),t.next=16,a;case 16:return(s=new p).image=new d(o),(l=new i).texture=s,t.abrupt("return",l);case 23:throw t.prev=23,t.t0=t.catch(0),new Error("Failed to load remote image: "+t.t0.message);case 26:case"end":return t.stop()}}),t,null,[[0,23]])})));return function(e){return t.apply(this,arguments)}}(),t.fetchImage=function(){var t=Ot(Rt().mark((function t(e){var i,n,r;return Rt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e){t.next=2;break}throw new Error("Failed to fetch image: URL is null or empty.");case 2:return t.prev=2,t.next=5,fetch(e);case 5:return i=t.sent,t.t0=Uint8Array,t.next=9,i.arrayBuffer();case 9:return t.t1=t.sent,n=new t.t0(t.t1),r=this.bufferToBase64(n),t.abrupt("return",this.convertBase64ToSpriteFrame(r));case 15:throw t.prev=15,t.t2=t.catch(2),new Error("Failed to get SpriteFrame: "+t.t2.message);case 18:case"end":return t.stop()}}),t,this,[[2,15]])})));return function(e){return t.apply(this,arguments)}}(),t.bufferToBase64=function(t){var e=Array.from(t).map((function(t){return String.fromCharCode(t)})).join("");return btoa(e)},t.convertBase64ToSpriteFrame=function(){var t=Ot(Rt().mark((function t(e){return Rt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",new Promise((function(t,n){var r=new Image;r.onload=function(){var e=new p;e.image=new d(r);var n=new i;n.texture=e,t(n),URL.revokeObjectURL(r.src)},r.onerror=function(){n(new Error("Failed to load base64 image")),URL.revokeObjectURL(r.src)},r.src="data:image/png;base64,"+e})));case 1:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),t.loadAndListenAvatar=function(t,e){var i=this;if(this.spriteFrameMap.has(t))null==e||e(this.spriteFrameMap.get(t));else if(this.spriteCallbacks.has(t)||this.spriteCallbacks.set(t,[]),this.spriteCallbacks.get(t).push(e),!(this.loadingSprites.indexOf(t)>=0)){this.loadingSprites.push(t);var n=function(e){i.spriteFrameMap.set(t,e),i.spriteCallbacks.get(t).forEach((function(t){return t(e)})),i.spriteCallbacks.set(t,[]),i.loadingSprites=i.loadingSprites.filter((function(e){return e!==t})),i.spriteFrameMap.size>100&&(i.spriteFrameMap.clear(),ve.LOG&&console.log("SpriteFrameMap cache cleared due to exceeding 100 records.")),ve.LOG&&console.log("Total loaded avatar: ",i.spriteFrameMap.size)};this.fetchImage(t).then((function(t){n(t)})).catch((function(t){n(null)}))}},t.removeListenAvatar=function(t,e){0!=this.spriteCallbacks.has(t)&&this.spriteCallbacks.set(t,this.spriteCallbacks.get(t).filter((function(t){return t!=e})))},t}();be.spriteFrameMap=new Map,be.loadingSprites=[],be.spriteCallbacks=new Map,be.loadedImages=[],be.loadedTextures=[],t._RF.pop(),t._RF.push({},"03f5c6o2sJBCL/VJkJmJTZA","UIAvatar",void 0);var _e,Se=e.ccclass,we=(e.property,e.requireComponent),Te=Se("UIAvatar")(ye=we(f)(ye=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).sprite=null,e.data=null,e.url=null,e.id=null,e.loadAvatarFunction=null,e}It(e,t);var i=e.prototype;return i.onLoad=function(){this.sprite=this.getComponent(f)},i.onDisable=function(){this.loadAvatarFunction&&be.removeListenAvatar(this.url,this.loadAvatarFunction)},i.setData=function(t,e){this.sprite&&(this.sprite.spriteFrame=he.instance.getAvatar(this.id),this.id=e,this.url=t,this.loadAvatarFunction=this.onLoadedAvatar.bind(this),be.loadAndListenAvatar(t,this.loadAvatarFunction))},i.onLoadedAvatar=function(t){this.sprite.spriteFrame=null!=t?t:he.instance.getAvatar(this.id),this.loadAvatarFunction=null},i.clear=function(){this.sprite.spriteFrame=null},e}(o))||ye)||ye;t._RF.pop(),t._RF.push({},"60a69bp1SlI3LOxXGNq+M1o","UICashAnimation",void 0);var Ee,Ae,Ce=e.ccclass;e.property,Ce("UICashAnimation")(_e=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).posY=[],e.sprites=[],e.tweens=[],e}It(e,t);var i=e.prototype;return i.init=function(){var t=this;this.sprites=this.getComponentsInChildren(f),this.sprites.forEach((function(e){t.posY.push(e.node.position.y),t.tweens.push(null)}))},i.setVisible=function(t,e,i,n){var r=this;if(void 0===n&&(n=-1),this.sprites.length<=0&&this.init(),n=n<0?this.sprites.length:Math.min(this.sprites.length,n),t){this.sprites.forEach((function(t){return t.node.position=g.ZERO}));for(var o=e/n,a=function(){var t,a=s*o,l=s;if(r.sprites[l].node.active=!0,e<=0)return r.sprites[l].node.position=m(0,r.posY[l]),1;null==(t=r.tweens[l])||t.stop(),r.tweens[l]=v(r.sprites[l].node).to(a,{position:m(0,r.posY[l])}).call((function(){l==n-1&&(null==i||i())})).start()},s=0;s<n;s++)a()}else for(var l=function(){var t,n=c;if(e<=0)return r.sprites[n].node.active=!1,1;null==(t=r.tweens[n])||t.stop(),r.tweens[n]=v(r.sprites[n].node).to(e,{position:g.ZERO}).call((function(){r.sprites[n].node.active=!1,n==r.sprites.length-1&&(null==i||i())})).start()},c=0;c<this.sprites.length;c++)l()},e}(o));t._RF.pop(),t._RF.push({},"f17deAL74VOroYmPuGafWvU","Utils",void 0),Number.prototype.clamp=function(t,e){return Math.min(Math.max(this.valueOf(),t),e)},Number.prototype.pingPong=function(t,e){var i=e-t,n=(this.valueOf()-t)/i,r=Math.floor(n),o=n-r;return r%2==0?t+i*o:e-i*o},Number.prototype.randomInt=function(t,e){return Math.floor(Math.random()*(e-t)+t)},Array.prototype.shuffle=function(){for(var t=this.length-1;t>0;t--){var e=Math.floor(Math.random()*(t+1)),i=[this[e],this[t]];this[t]=i[0],this[e]=i[1]}return this},Array.prototype.distinct=function(){return this.filter((function(t,e,i){return i.findIndex((function(e){return e.id===t.id}))===e}))},Array.prototype.randomElement=function(){return this.length<=0?null:this[Math.floor(Math.random()*this.length)]};var Pe,Me=e.ccclass,Ie=(e.property,Me("util")(((Ae=function(){function t(){}return t.formatNumber=function(t,e,i){if(void 0===e&&(e=0),void 0===i&&(i=2),!t)return"0";for(var n=["","K","M","B","T","Qa","Qi","Sx","Sp","Oc","No","Dc","Ud","Dd","Td","Qua","Qui","Sx","Sp","Oc","No","Vi","Dv","Tv","Qaa","Qaq","Qap","Qaop","Qit"],r=0;t>=1e3&&(t/=1e3,!(++r>=n.length-1)););return 0==r?this.toFixed(t,e):""+this.toFixed(t,i).replace(".",",")+n[r]},t.toFixed=function(t,e){return t.toFixed(e).replace(/(\.\d*?[1-9])0+$|\.0*$/,"$1")},t.commaNumber=function(t){return t?t.toString().replace(/\B(?=(\d{3})+(?!\d))/g,","):"0"},t.mapAbbreviationToWord=function(t){return{"":" ",K:"Thousand",M:"Million",B:"Billion",T:"Trillion",Qa:"Quadrillion",Qi:"Quintillion",Sx:"Sextillion",Sp:"Septillion",Oc:"Octillion",No:"Nonillion",Dc:"Decillion",Ud:"Undecillion",Dd:"Duodecillion",Td:"Tredecillion",Qua:"Quattuordecillion",Qui:"Quindecillion",Vi:"Sexdecillion",Dv:"Septendecillion",Tv:"Octodecillion",Qaa:"Novemdecillion",Qaq:"Vigintillion",Qap:"Unvigintillion",Qaop:"Duovigintillion",Qit:"Tresvigintillion"}[t]||""},t.getTokenParam=function(){return this.getUrlkeyValue("tk")},t.getRefreshTokenParam=function(){return this.getUrlkeyValue("rtk")},t.getDeviceKeyParam=function(){return this.getUrlkeyValue("dk")},t.getIdPasswordUrl=function(){return{username:this.getUrlkeyValue("username"),password:this.getUrlkeyValue("password")}},t.WaitFor=function(t,e){t()?e():setTimeout(this.WaitFor.bind(null,t,e),100)},t.loadScript=function(t,e){var i=document.createElement("script");i.type="text/javascript",i.src=t,e&&(i.onload=e),document.head.appendChild(i)},t.clone=function(t){if(null===t||"object"!=typeof t)return t;var e={};for(var i in t.constructor===Array&&(e=[]),t)t.hasOwnProperty(i)&&(e[i]=this.clone(t[i]));return e},t.objectToArray=function(t){var e=[];for(var i in t)t.hasOwnProperty(i)&&e.push(t[i]);return e},t.arrayToObject=function(t,e){var i={};for(var n in t)t.hasOwnProperty(n)&&t[n][e]&&(i[t[n][e]]=t[n]);return i},t.getWeightRandIndex=function(t,e){for(var i=Math.floor(Math.random()*e),n=0,r=0;r<t.length&&!(i<(n+=t[r]));r++);return r},t.getRandomNFromM=function(t,e){for(var i=[],n=0,r=0;r<e&&!(r>=t+1);){n=this.getRandomInt(0,t);for(var o=0,a=0;a<r;a++)if(i[a]===n){o=1;break}0===o&&(i[r]=n,r++)}return i},t.getRandomInt=function(t,e){var i=Math.random()*(e-t+1)+t;return Math.floor(i)},t.getStringLength=function(t){for(var e=t,i=0,n=0,r=e.length;n<r;n++){i+=e.charCodeAt(n)<=255?1:2}return Math.ceil(i/2)},t.isEmptyObject=function(t){var e=!0;if(t&&t.constructor===Object){for(var i in t)if(t.hasOwnProperty(i)){e=!1;break}}else e=!1;return e},t.isNewDay=function(t){var e=new Date(t),i=new Date,n=e.getYear(),r=e.getMonth(),o=e.getDate(),a=i.getYear(),s=i.getMonth(),l=i.getDate();return a>n||(s>r||l>o)},t.getPropertyCount=function(t){var e,i=0;for(e in t)t.hasOwnProperty(e)&&i++;return i},t.difference=function(t,e){var i=[];if(t.constructor!==Array||e.constructor!==Array)return i;for(var n=t.length,r=0;r<n;r++)-1===e.indexOf(t[r])&&i.push(t[r]);return i},t._stringToArray=function(t){var e,i="\\ufe0e\\ufe0f",n="\\u0300-\\u036f\\ufe20-\\ufe2f\\u20d0-\\u20ff",r=RegExp("[\\u200d\\ud800-\\udfff"+n+i+"]"),o="\\ud83c[\\udffb-\\udfff]",a="[\\ufe0e\\ufe0f]?",s="["+n+"]",l="(?:"+s+"|"+o+")"+"?",c="[\\ud800-\\udfff]",u="[^\\ud800-\\udfff]",h="(?:\\ud83c[\\udde6-\\uddff]){2}",p="[\\ud800-\\udbff][\\udc00-\\udfff]",d=a+l+("(?:\\u200d(?:"+[u,h,p].join("|")+")"+a+l+")*"),f="(?:"+[u+s+"?",s,h,p,c].join("|")+")",g=RegExp(o+"(?="+o+")|"+f+d,"g");return e=t,r.test(e)?function(t){return t.match(g)||[]}(t):function(t){return t.split("")}(t)},t.simulationUUID=function(){function t(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return t()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t()},t.trim=function(t){return t.replace(/(^\s*)|(\s*$)/g,"")},t.isNowValid=function(t,e){var i=new Date(t),n=new Date(e),r=!1;if(i.getDate()+""!="NaN"&&n.getDate()+""!="NaN"){var o=new Date;r=o<n&&o>i}return r},t.getDeltaDays=function(t,e){t=new Date(t),e=new Date(e);var i=t.getFullYear(),n=t.getMonth()+1,r=t.getDate(),o=e.getFullYear(),a=e.getMonth()+1,s=e.getDate();t=new Date(i+"/"+n+"/"+r+" GMT+0800").getTime();var l=(e=new Date(o+"/"+a+"/"+s+" GMT+0800").getTime())-t;return Math.floor(l/864e5)},t.getUserTimezone=function(){var t=(new Date).getTimezoneOffset(),e=Math.abs(t/60),i=Math.abs(t%60);return"GMT"+(t>0?"-":"+")+String(e)+String(i)},t.getMin=function(t){var e=null;if(t.constructor===Array)for(var i=t.length,n=0;n<i;n++)e=0===n?Number(t[0]):e>Number(t[n])?Number(t[n]):e;return e},t.formatTwoDigits=function(t){return(Array(2).join(0)+t).slice(-2)},t.getRemainingTime=function(t,e){if(!e)return{string:"",isZero:!0,remainSeconds:0};var i=1e3,n=6e4,r=36e5,o=864e5,a=e.getTime()-t.getTime(),s=Math.floor(a/o),l=Math.floor(a%o/r),c=Math.floor(a%r/n),u=Math.floor(a%n/i),h=a<=0,p=function(t){return t<10?"0"+t:t+""},d=(s>0?p(s)+":":"")+p(l)+":"+p(c)+":"+p(u);return s<=0&&l<=0&&c<=0&&u<=10&&(d=p(u)),{string:d,isZero:h,remainSeconds:a/i}},t.formatDate=function(t,e){e.includes("MMMM")?e=e.replace("MMMM",["January","February","March","April","May","June","July","August","September","October","November","December"][t.getMonth()]):e.includes("MMM")&&(e=e.replace("MMM",["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"][t.getMonth()]));var i={"Y+":t.getFullYear(),"M+":t.getMonth()+1,"d+":t.getDate(),"h+":t.getHours(),"m+":t.getMinutes(),"s+":t.getSeconds(),"q+":Math.floor((t.getMonth()+3)/3),S:t.getMilliseconds()};for(var n in/(y+)/.test(e)&&(e=e.replace(RegExp.$1,(t.getFullYear()+"").substr(4-RegExp.$1.length))),i)new RegExp("("+n+")").test(e)&&(e=e.replace(RegExp.$1,1===RegExp.$1.length?i[n].toString():("00"+i[n]).substr((""+i[n]).length)));return e},t.getDay=function(){var t=new Date;return t.getFullYear()+"-"+(t.getMonth()+1)+"-"+t.getDate()},t.formatName=function(t,e){e=e||6;var i=this._stringToArray(t),n="";if(i.length>e){for(var r=0;r<e;r++)n+=i[r];n+="..."}else n=t;return n},t.formatMoney=function(t){for(var e=["","K","M","G","T","P","E","Z","Y","B","N","D"],i="",n=0;n<e.length;n++){if(!(t>=1e4)){i=Math.floor(t).toLocaleString()+e[n];break}t/=1e3}return""===i&&(i=Math.floor(t)+"U"),i.replace(/\B(?=(\d{3})+(?!\d))/g,",")},t.formatValue=function(t){for(var e=[],i="",n=0;n<26;n++)e.push(String.fromCharCode(97+n));for(var r=0;r<e.length;r++){if(!(t>=1e4)){i=Math.floor(t)+e[r];break}t/=1e3}return i},t.formatTimeForSecond=function(t,e){void 0===e&&(e=!1);var i="",n=t%60,r=Math.floor(t/60);r=r<0?0:r;var o=Math.floor(r/60),a=r%60;return o>0?(i+=o>9?o.toString():"0"+o,i+=":"):i+="00:",i+=a>9?a.toString():"0"+a,e||(i+=":",i+=n>9?n.toString():"0"+n),i},t.formatTimeForMillisecond=function(t){var e=Math.floor(t/1e3%60),i=Math.floor(t/1e3/60%60);return{hour:Math.floor(t/1e3/60/60),minute:i,second:e}},t.rand=function(t){for(var e=this.clone(t),i=e.length-1;i>=0;i--){var n=Math.floor(Math.random()*(i+1)),r=e[n];e[n]=e[i],e[i]=r}return e},t.getOffsetMimutes=function(t,e){var i=e-t;return Math.floor(i%36e5/6e4)},t.formatNumToFixed=function(t,e){return void 0===e&&(e=0),Number(t.toFixed(e))},t.lerp=function(t,e,i){void 0===i&&(i=.25);var n=e;return t>e?n=e+(t-e)*i:t<e&&(n=e-(e-t)*i),n},t.decrypt=function(t){var e=6;t.length%2==0&&(e=7);for(var i="",n=0;n<t.length-e;n+=2)i+=t[n+1],i+=t[n];return i+=t.slice(t.length-e+1),i=this._base64Decode(i)},t.encrypt=function(t){var e=this._base64encode(t),i=6;e.length%2==0&&(i=7);for(var n="",r=0;r<(e.length-i+1)/2;r++)n+=e[2*r+1],n+=e[2*r];return n+=e.slice(e.length-i+1)},t._base64encode=function(t){var e,i,n,r,o,a,s,l="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",c="",u=0;for(t=this._utf8Encode(t);u<t.length;)r=(e=t.charCodeAt(u++))>>2,o=(3&e)<<4|(i=t.charCodeAt(u++))>>4,a=(15&i)<<2|(n=t.charCodeAt(u++))>>6,s=63&n,isNaN(i)?a=s=64:isNaN(n)&&(s=64),c=c+l.charAt(r)+l.charAt(o)+l.charAt(a)+l.charAt(s);return c},t._utf8Encode=function(t){t=t.replace(/\r\n/g,"\n");for(var e="",i=0;i<t.length;i++){var n=t.charCodeAt(i);n<128?e+=String.fromCharCode(n):n>127&&n<2048?(e+=String.fromCharCode(n>>6|192),e+=String.fromCharCode(63&n|128)):(e+=String.fromCharCode(n>>12|224),e+=String.fromCharCode(n>>6&63|128),e+=String.fromCharCode(63&n|128))}return e},t._utf8Decode=function(t){for(var e="",i=0,n=0,r=0,o=0;i<t.length;)(n=t.charCodeAt(i))<128?(e+=String.fromCharCode(n),i++):n>191&&n<224?(r=t.charCodeAt(i+1),e+=String.fromCharCode((31&n)<<6|63&r),i+=2):(r=t.charCodeAt(i+1),o=t.charCodeAt(i+2),e+=String.fromCharCode((15&n)<<12|(63&r)<<6|63&o),i+=3);return e},t._base64Decode=function(t){var e,i,n,r,o,a,s="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",l="",c=0;for(t=t.replace(/[^A-Za-z0-9\+\/\=]/g,"");c<t.length;)e=s.indexOf(t.charAt(c++))<<2|(r=s.indexOf(t.charAt(c++)))>>4,i=(15&r)<<4|(o=s.indexOf(t.charAt(c++)))>>2,n=(3&o)<<6|(a=s.indexOf(t.charAt(c++))),l+=String.fromCharCode(e),64!=o&&(l+=String.fromCharCode(i)),64!=a&&(l+=String.fromCharCode(n));return l=this._utf8Decode(l)},t.checkIsLowPhone=function(){if(window.wx){var t=-1,e=window.wx.getSystemInfoSync();if(e.system.indexOf("iOS")>=0){for(var i=e.model,n=["iPhone1,1","iPhone1,2","iPhone2,1","iPhone3,1","iPhone3,3","iPhone4,1","iPhone5,1","iPhone5,2","iPhone5,3","iPhone5,4","iPhone6,1","iPhone6,2"],r=["iPhone6,2","iPhone7,1","iPhone7,2","iPhone8,1","iPhone8,2","iPhone8,4"],o=["iPhone9,1","iPhone9,2","iPhone9,3","iPhone9,4","iPhone10,1","iPhone10,2","iPhone10,3","iPhone10,4","iPhone10,5","iPhone10,6"],a=["iPhone11,2","iPhone11,4","iPhone11,6","iPhone11,8","iPhone12,1","iPhone12,3","iPhone12,5","iPhone12,8"],s=0;s<n.length;s++)i.indexOf(n[s])>=0&&(t=5);for(var l=0;l<r.length;l++)i.indexOf(r[l])>=0&&(t=10);for(var c=0;c<o.length;c++)i.indexOf(o[c])>=0&&(t=20);for(var u=0;u<a.length;u++)i.indexOf(a[u])>=0&&(t=30)}else t=e.benchmarkLevel;return t<22}return!1},t.truncateString=function(t,e,i,n){return void 0===e&&(e=15),void 0===i&&(i=5),void 0===n&&(n=5),t.length<=e?t:t.slice(0,i)+"..."+t.slice(-n)},t.getVectorString=function(t){return t.x.toFixed(2)+"-"+t.y.toFixed(2)},t.getCoorKey=function(t,e){return t+"_"+e},t}()).getUrlkeyValue=function(t){var e=window.location.href,i=new URL(e);return i.searchParams.has(t)?i.searchParams.get(t):""},Ae.getAngle=function(t){return t<0?360+t%360:t>360?t%360:t},Ae.getPointText=function(t,e){return e<=0?t+"":t+"(<color=green>"+e+"</color>)"},Ae.getGuildShortName=function(t){var e=t.split(" "),i="";return e.forEach((function(t){return i+=t[0]})),i.toUpperCase()},Ae.capitalizeWords=function(t){return t.toLowerCase().replace(/\b\w/g,(function(t){return t.toUpperCase()}))},Ee=Ae))||Ee);t._RF.pop(),t._RF.push({},"d3e939wqpFGLblmd/OMduC5","UITimer",void 0);var Ne,Le,Oe,Re,xe,Fe=e.ccclass,De=(e.property,e.requireComponent);Fe("UITimer")(Pe=De(y)(Pe=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).label=null,e.endTime=0,e.callback=null,e.scheduleCountingDown=-1,e}It(e,t);var i=e.prototype;return i.onLoad=function(){this.label=this.getComponent(y)},i.onEnable=function(){this.endTime>0&&this.startCountingDown(this.endTime,this.callback)},i.onDisable=function(){this.stopCountingEventDown()},i.startCountingDown=function(t,e){var i=this;this.endTime=t,this.callback=e;var n=t-Date.now();if(n<=0)null==e||e();else{var r=Math.round(n/1e3)+1;this.stopCountingEventDown(),function t(){if(--r<0)null==e||e();else{var n=Ie.formatTimeForSecond(r);i.label&&(i.label.string=n),i.scheduleCountingDown=setTimeout((function(){t()}),1e3)}}()}},i.stopCountingEventDown=function(){clearTimeout(this.scheduleCountingDown)},e}(o))||Pe);t._RF.pop(),t._RF.push({},"c5c0fR4sOtBf6AVBLMy1WNE","VisiblePanel",void 0);var ze=e.ccclass,ke=e.property,Ve=(Ne=ze("VisiblePanel"),Le=ke({type:c,group:"VisiblePanel"}),Ne((xe=Mt((Re=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return e=t.call.apply(t,[this].concat(n))||this,Nt(e,"indicator",xe,Lt(e)),e.opMain=null,e.onVisibleChanged=void 0,e.tweenOpacity=null,e}It(e,t);var i=e.prototype;return i.setPanelVisible=function(t,e,i){var n,r=this;void 0===e&&(e=.35),void 0===i&&(i=!0),this.opMain||(this.opMain=this.getComponent(b),null==this.opMain&&(this.opMain=this.addComponent(b))),e<=0&&(this.opMain.opacity=t?255:0),t&&i&&(this.node.active=!0,this.indicator&&(this.indicator.active=!0)),this.opMain.opacity=t?0:255,null==(n=this.tweenOpacity)||n.stop(),this.tweenOpacity=v(this.opMain).to(e,{opacity:t?255:0}).call((function(){!t&&i&&(r.node.active=!1,r.indicator&&(r.indicator.active=!1)),r.visibleChanged(t)})).start()},i.visibleChanged=function(t){var e;null==(e=this.onVisibleChanged)||e.call(this,t)},e}(o)).prototype,"indicator",[Le],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Oe=Re))||Oe);t._RF.pop(),t._RF.push({},"6cbe82sbBRJZ5dw448hn0pZ","Defines",void 0);var Be=function(t){return t[t.NONE=0]="NONE",t[t.TOUCH=1]="TOUCH",t[t.DRAG=2]="DRAG",t[t.ZOOM=3]="ZOOM",t[t.SWIPE=4]="SWIPE",t[t.HOVER=5]="HOVER",t[t.DOUBLE_TOUCH=6]="DOUBLE_TOUCH",t[t.END_INTERACTED=7]="END_INTERACTED",t}({}),He=function(t){return t[t.NONE=0]="NONE",t[t.HIDE=1]="HIDE",t[t.SHOW=2]="SHOW",t[t.INSTANCE_SHOW=3]="INSTANCE_SHOW",t[t.INSTANCE_HIDE=4]="INSTANCE_HIDE",t}({});t._RF.pop(),t._RF.push({},"996b7qdfwFAPbtK5uluV2M2","easing",void 0);var Ue,Ge,We=function(t){return t[t.Linear=0]="Linear",t[t.SineIn=1]="SineIn",t[t.SineOut=2]="SineOut",t[t.SineInOut=3]="SineInOut",t[t.QuadIn=4]="QuadIn",t[t.QuadOut=5]="QuadOut",t[t.QuadInOut=6]="QuadInOut",t[t.CubicIn=7]="CubicIn",t[t.CubicOut=8]="CubicOut",t[t.CubicInOut=9]="CubicInOut",t[t.QuartIn=10]="QuartIn",t[t.QuartOut=11]="QuartOut",t[t.QuartInOut=12]="QuartInOut",t[t.QuintIn=13]="QuintIn",t[t.QuintOut=14]="QuintOut",t[t.QuintInOut=15]="QuintInOut",t[t.ExpoIn=16]="ExpoIn",t[t.ExpoOut=17]="ExpoOut",t[t.ExpoInOut=18]="ExpoInOut",t[t.CircIn=19]="CircIn",t[t.CircOut=20]="CircOut",t[t.CircInOut=21]="CircInOut",t[t.ElasticIn=22]="ElasticIn",t[t.ElasticOut=23]="ElasticOut",t[t.ElasticInOut=24]="ElasticInOut",t[t.BackIn=25]="BackIn",t[t.BackOut=26]="BackOut",t[t.BackInOut=27]="BackInOut",t[t.BounceIn=28]="BounceIn",t[t.BounceOut=29]="BounceOut",t[t.BounceInOut=30]="BounceInOut",t}({});function qe(t){var e;return((e={})[We.Linear]=_.linear,e[We.SineIn]=_.sineIn,e[We.SineOut]=_.sineOut,e[We.SineInOut]=_.sineInOut,e[We.QuadIn]=_.quadIn,e[We.QuadOut]=_.quadOut,e[We.QuadInOut]=_.quadInOut,e[We.CubicIn]=_.cubicIn,e[We.CubicOut]=_.cubicOut,e[We.CubicInOut]=_.cubicInOut,e[We.QuartIn]=_.quartIn,e[We.QuartOut]=_.quartOut,e[We.QuartInOut]=_.quartInOut,e[We.QuintIn]=_.quintIn,e[We.QuintOut]=_.quintOut,e[We.QuintInOut]=_.quintInOut,e[We.ExpoIn]=_.expoIn,e[We.ExpoOut]=_.expoOut,e[We.ExpoInOut]=_.expoInOut,e[We.CircIn]=_.circIn,e[We.CircOut]=_.circOut,e[We.CircInOut]=_.circInOut,e[We.ElasticIn]=_.elasticIn,e[We.ElasticOut]=_.elasticOut,e[We.ElasticInOut]=_.elasticInOut,e[We.BackIn]=_.backIn,e[We.BackOut]=_.backOut,e[We.BackInOut]=_.backInOut,e[We.BounceIn]=_.bounceIn,e[We.BounceOut]=_.bounceOut,e[We.BounceInOut]=_.bounceInOut,e)[t]}t._RF.pop(),t._RF.push({},"5e557ZxbcNFsbXuz8xq4hnD","storageManager",void 0);var Ze,Ye,je=e.ccclass,Ke=(e.property,je("StorageManager")(((Ge=function(){function t(){this._jsonData={},this._path=null,this.KEY_CONFIG="coindfo",this._markSave=!1,this._saveTimer=-1}var e=t.prototype;return e.start=function(){var t;(this._jsonData={userId:""},this._path=this._getConfigPath(),S.isNative)?t=w.fileUtils.getValueMapFromFile(this._path)[this.KEY_CONFIG]:t=S.localStorage.getItem(this.KEY_CONFIG);if(t&&t.length){t.startsWith("@")&&(t=t.substring(1),t=Ie.decrypt(t));try{var e=JSON.parse(t);this._jsonData=e}catch(t){}}},e.setConfigDataWithoutSave=function(t,e){var i=this._jsonData.userId;this._jsonData[i]?this._jsonData[i][t]=e:console.error("no account can not save")},e.setConfigData=function(t,e){this.setConfigDataWithoutSave(t,e),this._markSave=!0},e.getConfigData=function(t){var e=this._jsonData.userId;if(this._jsonData[e]){var i=this._jsonData[e][t];return i||""}return T("no account can not load"),""},e.removeGlobalData=function(t){delete this._jsonData[t]},e.setGlobalData=function(t,e){this._jsonData[t]=e,this.save()},e.getGlobalData=function(t){return this._jsonData[t]},e.setUserId=function(t){this._jsonData.userId=t,this._jsonData[t]||(this._jsonData[t]={}),this.save()},e.getUserId=function(){return this._jsonData.userId},e.scheduleSave=function(){this._markSave&&this.save()},e.markModified=function(){this._markSave=!0},e.save=function(){var t=JSON.stringify(this._jsonData),e="@"+Ie.encrypt(t);if(this._markSave=!1,S.isNative){var i={};i[this.KEY_CONFIG]=e,w.fileUtils.writeValueMapToFile(i,this._getConfigPath())}else{S.localStorage.setItem(this.KEY_CONFIG,e)}},e._getConfigPath=function(){var t=S.platform,e="";return t===S.OS.WINDOWS?e="src/conf":t===S.OS.LINUX?e="./conf":S.isNative?(e=w.fileUtils.getWritablePath(),e+="conf"):e="src/conf",e},xt(t,null,[{key:"instance",get:function(){return this._instance||(this._instance=new t,this._instance.start()),this._instance}}]),t}())._instance=void 0,Ue=Ge))||Ue);t._RF.pop(),t._RF.push({},"f11da56ne5J4oRL4Avag26V","resourceUtil",void 0);var Xe,Je,Qe=(0,e.ccclass)("resourceUtil")(((Ye=function(){function t(){}return t.loadRes=function(t,e,i){var n=this;void 0===i&&(i=function(){}),this.resLoadedMap.has(t)?i&&i(null,this.resLoadedMap.get(t)):a.load(t,(function(e,r){return e?(E(e.message||e),void i(e,r)):r?(n.resLoadedMap.set(t,r),void(i&&i(null,r))):(E("res not found"),void i("res not found",r))}))},t.loadResNoCache=function(t,e,i){var n=this;void 0===i&&(i=function(){}),a.load(t,(function(e,r){if(e)return E(e.message||e),void i(e,r);n.resLoadedMap.set(t,r),i&&i(null,r)}))},t.loadEffectRes=function(t){var e=this;return new Promise((function(i,n){e.loadRes("prefab/effect/"+t,l,(function(e,r){if(e)return console.error("effect load failed",t),void(n&&n());i&&i(r)}))}))},t.loadModelResArr=function(t,e,i,n){var r=e.map((function(e){return t+"/"+e}));a.load(r,l,i,n)},t.loadResArr=function(t,e,i){a.load(t,l,e,i)},t.loadSpriteFrameRes=function(t){var e=this;return new Promise((function(n,r){e.loadRes(t,i,(function(e,o){if(e)return console.error("spriteFrame load failed!",t,e),void(r&&r());var a=new p;a.image=o;var s=new i;s.texture=a,n&&n(s)}))}))},t.getMap=function(t,e){var i="map";i+=t>=100?t:t>=10?"0"+t:"00"+t,this.loadRes("map/config/"+i,null,(function(t,i){if(t)e(t,i);else{var n="";if(i._file){window.LZString&&(n=window.LZString.decompressFromEncodedURIComponent(i._file));var r=JSON.parse(n);e(null,r)}else if(i.text){window.LZString&&(n=window.LZString.decompressFromEncodedURIComponent(i.text));r=JSON.parse(n);e(null,r)}else i.json?e(null,i.json):e("failed")}}))},t.getMapObj=function(t,e,i,n){for(var r=[],o=0;o<e.length;o++)r.push("map/"+t+"/"+e[o]);a.load(r,l,i,n)},t.getUIPrefabRes=function(t,e){this.loadRes("prefab/ui/"+t,l,e)},t.createUI=function(t,e,i,n){void 0===n&&(n="Canvas/Popup"),this.getUIPrefabRes(t,(function(t,r){if(!t){var o=A(r);o.setPosition(0,0,0),i||(i=C(n))||((i=C("Canvas"))||(i=C("/Canvas")),i||console.error("Canvas node not found in the scene")),i?(i.addChild(o),e&&e(null,o)):e&&e(null,o)}}))},t.preloadUI=function(t,e){this.getUIPrefabRes(t,(function(t,i){if(t)e&&e(t,null);else{var n=A(i);e&&e(null,n)}}))},t.getJsonData=function(t,e){this.loadRes("datas/"+t,null,(function(t,i){t?E(t.message||t):i.json?e(t,i.json):e("failed!!!")}))},t.getTextData=function(t,e){this.loadRes("datas/"+t,null,(function(t,i){if(t)E(t.message||t);else{var n=i.text;e(t,n)}}))},t.setSpriteFrame=function(t,e,i){a.load(t,(function(t,n){if(t)return E(t.message||t),void i(t,n);e&&P(e)&&(e.spriteFrame=n,null==i||i(null))}))},t.setSpriteFrameFromAtlas=function(t,e,i,n){a.load(t,h,(function(r,o){if(r)return console.error("set sprite frame form atlas failed! err:",t,r),void(null==n||n(r));if(i&&P(i)){var a=o.getSpriteFrame(e);i.spriteFrame=a,null==n||n(null)}}))},t.setSpriteFrameFromAutoAtlas=function(t,e,n,r){a.load(t+"/"+e,i,(function(e,i){if(e)return console.error("set sprite frame form atlas failed! err:",t,e),void(null==r||r(e));n&&P(n)&&(n.spriteFrame=i,null==r||r(null))}))},t.loadAndConvertSpriteFrame=function(t,e,n){this.loadRes(t,i,(function(r,o){if(r)return console.error("set sprite frame failed! err:",t,r),void(null==n||n(r));var a=new p;a.image=o;var s=new i;s.texture=a,s&&P(s)&&(e.spriteFrame=s,null==n||n(null))}))},t.setSpriteFrameRenderer=function(t,e,n){this.loadRes(t,i,(function(r,o){if(r)return console.error("set sprite frame failed! err:",t,r),void(null==n||n(r));var a=new p;a.image=o;var s=new i;s.texture=a,s&&P(s)&&(e.spriteFrame=s,null==n||n(null))}))},t.loadAllResources=function(t,e){a.loadDir(t,(function(t,i){t?console.error("Error loading resources: ",t):e(i)}))},t.loadAllSprites=function(t,e){a.loadDir(t,(function(t,n){if(t)console.error("Error loading resources: ",t);else{var r=n.filter((function(t){return t instanceof i}));e(r)}}))},t}()).resLoadedMap=new Map,Ze=Ye))||Ze;t._RF.pop(),t._RF.push({},"d7ecda770NLF4OP1Afz5O5u","audioManager",void 0);var $e,ti,ei,ii,ni,ri,oi,ai,si,li,ci,ui,hi,pi,di,fi,gi,mi,vi,yi,bi,_i,Si,wi,Ti,Ei,Ai,Ci,Pi,Mi,Ii,Ni,Li,Oi,Ri,xi,Fi,Di,zi,ki,Vi,Bi,Hi,Ui,Gi,Wi,qi,Zi=e.ccclass,Yi=(e.property,Zi("AudioManager")(((Je=function(){function t(){this.audioMap=new Map,this._persistRootNode=null,this._audioSources=[],this.dictWeaponSoundIndex={},this.bgmVolume=.8,this.sfxVolume=1,this.audios={},this.arrSound=[],this.BGM_VOLUME=.35,this.SFX_VOLUME=.75,this.asMusic=null,this.curGetSFXSourceIndex=0,this.tweenFadeMusic=null,this.init()}var e=t.prototype;return e.init=function(){if(!this._persistRootNode){this._persistRootNode=new c("audio"),M.getScene().addChild(this._persistRootNode),I.addPersistRootNode(this._persistRootNode),this.asMusic=this._persistRootNode.addComponent(N);for(var t=0;t<15;t++)this._audioSources.push(this._persistRootNode.addComponent(N));this.bgmVolume=this.getAudioSetting(!0),this.sfxVolume=this.getAudioSetting(!1),this.audioMap.clear()}},e.getAudioSetting=function(t){var e,i,n;t?e=null!=(i=Ke.instance.getGlobalData(me.STORAGE_KEY.BGM_VOLUME))?i:this.BGM_VOLUME:e=null!=(n=Ke.instance.getGlobalData(me.STORAGE_KEY.SFX_VOLUME))?n:this.SFX_VOLUME;return e},e.setBGMProgress=function(t){this.bgmVolume=t*this.BGM_VOLUME,Ke.instance.setGlobalData(me.STORAGE_KEY.BGM_VOLUME,this.bgmVolume)},e.setSFXProgress=function(t){this.sfxVolume=t*this.SFX_VOLUME,Ke.instance.setGlobalData(me.STORAGE_KEY.SFX_VOLUME,this.sfxVolume)},e.getSound=function(t){return this.audioMap.has(t)?this.audioMap.get(t):null},e.playMusic=function(t,e){var i=this,n=this.asMusic,r="sounds/bgm/"+t;return Qe.loadRes(r,L,(function(r,o){if(r)ve.LOG&&console.error(r);else{if(!o)return null;var a={source:n,isMusic:!0};i.audios[t]=a,n.stop(),n.clip=o,n.volume=i.bgmVolume,n.loop=e,n.play()}})),n},e.setMusicFade=function(t,e,i){var n,r=this;void 0===e&&(e=.5),void 0===i&&(i=null);var o=t?0:1,a=t?1:0,s=a-o,l={value:o};null==(n=this.tweenFadeMusic)||n.stop(),this.tweenFadeMusic=v(l).to(e,{value:a},{easing:_.linear,progress:function(t,e,i,n){var a;return a=o+n*s,r.asMusic&&r.bgmVolume&&(r.asMusic.volume=r.bgmVolume*a),0}}).call((function(){return null==i?void 0:i()})).start()},e.dimAllSounds=function(){this._audioSources.forEach((function(t){t.volume=0}))},e.playSound=function(t,e){var i=this;if(void 0===e&&(e=1),this.sfxVolume){this.curGetSFXSourceIndex=++this.curGetSFXSourceIndex%this._audioSources.length;var n=this._audioSources[this.curGetSFXSourceIndex],r="sounds/sfx/"+t;return Qe.loadRes(r,L,(function(t,r){t?ve.LOG&&console.error(t):r&&(n.stop(),n.clip=r,n.currentTime=0,n.volume=i.sfxVolume*e,n.play())})),n}},e.stop=function(t){if(this.audios.hasOwnProperty(t)){var e=this.audios[t];e.source.stop(),e.source.volume=0}},e.stopAll=function(){for(var t in this.audios)if(this.audios.hasOwnProperty(t)){var e=this.audios[t];e.source.stop(),e.source.clip=null}this.asMusic.stop(),this.asMusic.clip=null},e.getMusicVolume=function(){return this.bgmVolume},e.setMusic=function(t){var e=t*this.BGM_VOLUME;Ke.instance.setGlobalData(me.STORAGE_KEY.BGM_VOLUME,e),this.bgmVolume=e,this.asMusic.volume=this.bgmVolume},e.pauseAll=function(){for(var t in ve.LOG&&console.log("pause all music!!!"),this.audios){if(this.audios.hasOwnProperty(t))this.audios[t].source.pause()}},e.resumeAll=function(){for(var t in this.audios){if(this.audios.hasOwnProperty(t))this.audios[t].source.play()}},e.setSound=function(t){var e=t*this.SFX_VOLUME;for(var i in Ke.instance.setGlobalData(me.STORAGE_KEY.SFX_VOLUME,e),this.sfxVolume=e,this.audios){if(this.audios.hasOwnProperty(i)&&!this.audios[i].isMusic)this.audios[i].source.volume=this.sfxVolume}for(var n=0;n<this.arrSound.length;n++){this.arrSound[n].source.volume=this.sfxVolume}},e.stopSingleSound=function(t){this.audios.hasOwnProperty(t)&&!this.audios[t].isMusic&&this.audios[t].source.stop()},xt(t,[{key:"bgmProgress",get:function(){return this.bgmVolume/this.BGM_VOLUME}},{key:"sfxProgress",get:function(){return this.sfxVolume/this.SFX_VOLUME}}]),t}()).instance=void 0,Xe=Je))||Xe);t._RF.pop(),t._RF.push({},"0ade8jDYZpLPZyun6PIe4u6","AnimationPanel",void 0);var ji,Ki,Xi,Ji=e.ccclass,Qi=e.property,$i=($e=Ji("AnimationPanel"),ti=Qi({group:{name:"Animation Settings",id:"animation"},tooltip:"Enable to customize animation settings"}),ei=Qi({type:O(He),group:{name:"Animation Settings",id:"animation"},tooltip:"Initial state of the panel",visible:function(){return this.isShowPopupsetting}}),ii=Qi({type:g,group:{name:"Animation Settings",id:"animation"},tooltip:"Initial position of the panel",visible:function(){return this.isShowPopupsetting}}),ni=Qi({group:{name:"Show Animation",id:"show"},tooltip:"Starting X position for show animation",visible:function(){return this.isShowPopupsetting}}),ri=Qi({group:{name:"Show Animation",id:"show"},tooltip:"Starting Y position for show animation",visible:function(){return this.isShowPopupsetting}}),oi=Qi({group:{name:"Show Animation",id:"show"},tooltip:"Starting scale for show animation",visible:function(){return this.isShowPopupsetting}}),ai=Qi({type:O(We),group:{name:"Show Animation",id:"show"},tooltip:"Easing function for show animation",visible:function(){return this.isShowPopupsetting}}),si=Qi({group:{name:"Hide Animation",id:"hide"},tooltip:"Ending X position for hide animation",visible:function(){return this.isShowPopupsetting}}),li=Qi({group:{name:"Hide Animation",id:"hide"},tooltip:"Ending Y position for hide animation",visible:function(){return this.isShowPopupsetting}}),ci=Qi({group:{name:"Hide Animation",id:"hide"},tooltip:"Ending scale for hide animation",visible:function(){return this.isShowPopupsetting}}),ui=Qi({type:O(We),group:{name:"Hide Animation",id:"hide"},tooltip:"Easing function for hide animation",visible:function(){return this.isShowPopupsetting}}),hi=Qi({group:{name:"Additional Settings",id:"additional"},tooltip:"Duration of show animation in seconds",visible:function(){return this.isShowPopupsetting}}),pi=Qi({group:{name:"Additional Settings",id:"additional"},tooltip:"Duration of hide animation in seconds",visible:function(){return this.isShowPopupsetting}}),di=Qi({group:{name:"Additional Settings",id:"additional"},tooltip:"Enable rotation animation",visible:function(){return this.isShowPopupsetting}}),fi=Qi({group:{name:"Additional Settings",id:"additional"},tooltip:"Starting rotation for show animation (in degrees)",visible:function(){return this.isShowPopupsetting&&this.enableRotation}}),gi=Qi({group:{name:"Additional Settings",id:"additional"},tooltip:"Ending rotation for hide animation (in degrees)",visible:function(){return this.isShowPopupsetting&&this.enableRotation}}),mi=Qi({group:{name:"Additional Settings",id:"additional"},tooltip:"Enable opacity animation",visible:function(){return this.isShowPopupsetting}}),vi=Qi({group:{name:"Additional Settings",id:"additional"},tooltip:"Starting opacity for show animation (0-255)",visible:function(){return this.isShowPopupsetting&&this.enableOpacity}}),yi=Qi({group:{name:"Additional Settings",id:"additional"},tooltip:"Ending opacity for hide animation (0-255)",visible:function(){return this.isShowPopupsetting&&this.enableOpacity}}),bi=Qi({type:Ve,group:{name:"Background Settings",id:"background"},tooltip:"Background panel that dims when this panel is shown",visible:function(){return this.isShowPopupsetting}}),_i=Qi({group:{name:"Background Settings",id:"background"},tooltip:"Duration of background dim animation in seconds",visible:function(){return this.isShowPopupsetting}}),Si=Qi({group:{name:"Audio Settings",id:"audio"},tooltip:"Sound effect to play when panel is shown"}),$e((Ei=Mt((Ti=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return e=t.call.apply(t,[this].concat(n))||this,Nt(e,"isShowPopupsetting",Ei,Lt(e)),Nt(e,"beginType",Ai,Lt(e)),Nt(e,"beginPosition",Ci,Lt(e)),Nt(e,"showFromPosX",Pi,Lt(e)),Nt(e,"showFromPosY",Mi,Lt(e)),Nt(e,"showFromScale",Ii,Lt(e)),Nt(e,"showEasingType",Ni,Lt(e)),Nt(e,"hideToPosX",Li,Lt(e)),Nt(e,"hideToPosY",Oi,Lt(e)),Nt(e,"hideToScale",Ri,Lt(e)),Nt(e,"hideEasingType",xi,Lt(e)),Nt(e,"showDuration",Fi,Lt(e)),Nt(e,"hideDuration",Di,Lt(e)),Nt(e,"enableRotation",zi,Lt(e)),Nt(e,"showFromRotation",ki,Lt(e)),Nt(e,"hideToRotation",Vi,Lt(e)),Nt(e,"enableOpacity",Bi,Lt(e)),Nt(e,"showFromOpacity",Hi,Lt(e)),Nt(e,"hideToOpacity",Ui,Lt(e)),Nt(e,"dimNode",Gi,Lt(e)),Nt(e,"dimDuration",Wi,Lt(e)),Nt(e,"shownAudioName",qi,Lt(e)),e.opMain=null,e.visibleIndex=-1,e.visibleTween=null,e.scheduleDim=null,e}It(e,t);var i=e.prototype;return i.onLoad=function(){var t,e,i,n;switch(this.node.setPosition(this.beginPosition),this.beginType){case He.NONE:this.visibleIndex=-1;break;case He.HIDE:this.setAnimVisible(!1,null,this.hideDuration),null==(t=this.dimNode)||t.setPanelVisible(!1,0);break;case He.SHOW:this.setAnimVisible(!0,null,this.showDuration),null==(e=this.dimNode)||e.setPanelVisible(!0,0);break;case He.INSTANCE_SHOW:this.setAnimVisible(!0,null,.02),null==(i=this.dimNode)||i.setPanelVisible(!0,0);break;case He.INSTANCE_HIDE:this.setAnimVisible(!1,null,.02),null==(n=this.dimNode)||n.setPanelVisible(!1,0)}},i.setAnimVisible=function(t,e,i){void 0===e&&(e=null),void 0===i&&(i=.35),this.visibleIndex!=(t?1:0)?(this.visibleIndex=t?1:0,t?this.showAnimation(e,i):this.hideAnimation(e,i)):null==e||e()},i.showAnimation=function(t,e){var i;(this.node.active=!0,this.node.position=m(this.showFromPosX,this.showFromPosY,0),this.node.setScale(m(this.showFromScale,this.showFromScale,this.showFromScale)),this.enableRotation&&this.node.setRotationFromEuler(0,0,this.showFromRotation),this.enableOpacity&&(this.opMain=this.getComponent(b)||this.addComponent(b),this.opMain.opacity=this.showFromOpacity),0===e)?(this.node.position=this.beginPosition,this.node.setScale(g.ONE),this.enableRotation&&this.node.setRotationFromEuler(0,0,0),this.enableOpacity&&(this.opMain.opacity=255),null==t||t()):(null==(i=this.visibleTween)||i.stop(),this.visibleTween=v(this.node),this.visibleTween.to(e,{position:this.beginPosition},{easing:this.getEasingShowAnim()}),this.visibleTween.to(e,{scale:g.ONE},{easing:this.getEasingShowAnim()}),this.enableRotation&&this.visibleTween.to(e,{eulerAngles:new g(0,0,0)},{easing:this.getEasingShowAnim()}),this.enableOpacity&&v(this.opMain).to(e,{opacity:255},{easing:this.getEasingShowAnim()}).start(),this.visibleTween.call((function(){return null==t?void 0:t()})).start());this.setDimBackground(!0,e,this.dimDuration)},i.hideAnimation=function(t,e){var i,n=this;0===e?(this.node.position=m(this.hideToPosX,this.hideToPosY,0),this.node.setScale(m(this.hideToScale,this.hideToScale,this.hideToScale)),this.enableRotation&&this.node.setRotationFromEuler(0,0,this.hideToRotation),this.enableOpacity&&(this.opMain.opacity=this.hideToOpacity),this.node.active=!1,null==t||t()):(null==(i=this.visibleTween)||i.stop(),this.visibleTween=v(this.node),this.visibleTween.to(e,{position:m(this.hideToPosX,this.hideToPosY,0)},{easing:this.getEasingHideAnim()}),this.visibleTween.to(e,{scale:m(this.hideToScale,this.hideToScale,this.hideToScale)},{easing:this.getEasingHideAnim()}),this.enableRotation&&this.visibleTween.to(e,{eulerAngles:new g(0,0,this.hideToRotation)},{easing:this.getEasingHideAnim()}),this.enableOpacity&&v(this.opMain).to(e,{opacity:this.hideToOpacity},{easing:this.getEasingHideAnim()}).start(),this.visibleTween.call((function(){n.node.active=!1,null==t||t()})).start());this.setDimBackground(!1,0,this.dimDuration)},i.getEasingShowAnim=function(){return qe(this.showEasingType)},i.getEasingHideAnim=function(){return qe(this.hideEasingType)},i.setDimBackground=function(t,e,i){var n=this;void 0===i&&(i=.2),null!=this.dimNode&&(null!=this.scheduleDim&&this.unschedule(this.scheduleDim),this.scheduleDim=this.scheduleOnce((function(){return n.dimNode.setPanelVisible(t,i)}),e))},i.show=function(t,e){var i=this;this.shownAudioName&&1!=this.visibleIndex&&Yi.instance.playSound(this.shownAudioName),this.setAnimVisible(!0,(function(){i.shown(),null==e||e()}),this.showDuration)},i.doShow=function(){this.show(null,void 0)},i.doHide=function(){this.hide(void 0)},i.hide=function(t){var e=this;this.setAnimVisible(!1,(function(){e.hided(),null==t||t()}),this.hideDuration)},i.shown=function(){},i.hided=function(){},i.onKeyDown=function(t){0!=this.isEscable&&t.keyCode===R.ESCAPE&&this.doHide()},i.onTouch_Close=function(){this.doHide()},xt(e,[{key:"isShowing",get:function(){return 1==this.visibleIndex}},{key:"isEscable",get:function(){return!1}}]),e}(Ve)).prototype,"isShowPopupsetting",[ti],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Ai=Mt(Ti.prototype,"beginType",[ei],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return He.NONE}}),Ci=Mt(Ti.prototype,"beginPosition",[ii],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return m(0,0,0)}}),Pi=Mt(Ti.prototype,"showFromPosX",[ni],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-1080}}),Mi=Mt(Ti.prototype,"showFromPosY",[ri],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Ii=Mt(Ti.prototype,"showFromScale",[oi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),Ni=Mt(Ti.prototype,"showEasingType",[ai],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return We.BackOut}}),Li=Mt(Ti.prototype,"hideToPosX",[si],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1080}}),Oi=Mt(Ti.prototype,"hideToPosY",[li],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Ri=Mt(Ti.prototype,"hideToScale",[ci],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),xi=Mt(Ti.prototype,"hideEasingType",[ui],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return We.BackIn}}),Fi=Mt(Ti.prototype,"showDuration",[hi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.35}}),Di=Mt(Ti.prototype,"hideDuration",[pi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.25}}),zi=Mt(Ti.prototype,"enableRotation",[di],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),ki=Mt(Ti.prototype,"showFromRotation",[fi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-45}}),Vi=Mt(Ti.prototype,"hideToRotation",[gi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 45}}),Bi=Mt(Ti.prototype,"enableOpacity",[mi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Hi=Mt(Ti.prototype,"showFromOpacity",[vi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Ui=Mt(Ti.prototype,"hideToOpacity",[yi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Gi=Mt(Ti.prototype,"dimNode",[bi],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Wi=Mt(Ti.prototype,"dimDuration",[_i],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.2}}),qi=Mt(Ti.prototype,"shownAudioName",[Si],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),wi=Ti))||wi);t._RF.pop(),t._RF.push({},"9bf359IqNNOdo7v0PQCju2a","ButtonAutoSound",void 0);var tn,en,nn,rn,on,an=e.ccclass,sn=e.property;an("ButtonAutoSound")((Xi=Mt((Ki=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return e=t.call.apply(t,[this].concat(n))||this,Nt(e,"audioName",Xi,Lt(e)),e}It(e,t);var i=e.prototype;return i.onLoad=function(){var t=this.getComponent(x);if(t){var e=new F;e.target=this.node,e.component="ButtonAutoSound",e.handler="onButtonClicked",t.clickEvents.push(e)}},i.onButtonClicked=function(){var t;null==(t=Yi.instance)||t.playSound(this.audioName)},e}(o)).prototype,"audioName",[sn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"A_Click_Menu"}}),ji=Ki));t._RF.pop(),t._RF.push({},"e01eb+jQTRNdbPwrEVkkCRc","HotKey",void 0);var ln,cn=e.ccclass,un=e.property,hn=(tn=cn("Hotkey"),en=un({type:[O(R)]}),tn((on=Mt((rn=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return e=t.call.apply(t,[this].concat(n))||this,Nt(e,"keys",on,Lt(e)),e.keyMap=new Map,e}It(e,t);var i=e.prototype;return i.onLoad=function(){var t=this;this.keys.forEach((function(e){return t.keyMap.set(e,!1)}))},i.getKeyString=function(){try{var t=R[this.keys[0]];if(t.length<=2)return t;var e=t.split("_");return e[e.length-1]}catch(t){return""}},i.onEnable=function(){D.on(z.EventType.KEY_DOWN,this.onKeyDown,this),D.on(z.EventType.KEY_UP,this.onKeyUp,this)},i.onDisable=function(){D.off(z.EventType.KEY_DOWN,this.onKeyDown,this),D.off(z.EventType.KEY_UP,this.onKeyUp,this)},i.onKeyDown=function(t){this.keyMap.has(t.keyCode)&&(this.keyMap.set(t.keyCode,!0),this.isKeyCombinationPressed()&&this.trigger())},i.onKeyUp=function(t){this.keyMap.has(t.keyCode)&&this.keyMap.set(t.keyCode,!1)},i.isKeyCombinationPressed=function(){var t=!0;return this.keyMap.forEach((function(e,i){e||(t=!1)})),t},i.trigger=function(){},e}(o)).prototype,"keys",[en],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),nn=rn))||nn);t._RF.pop(),t._RF.push({},"099f7MZV3JPrp3nEUGlRKH5","ButtonHotKey",void 0);var pn,dn,fn=e.ccclass,gn=(e.property,fn("ButtonHotKey")(ln=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).button=null,e}It(e,t);var i=e.prototype;return i.onLoad=function(){t.prototype.onLoad.call(this),this.button=this.getComponent(x)},i.trigger=function(){t.prototype.trigger.call(this),this.button&&this.button.clickEvents.forEach((function(t){t.emit(null)}))},e}(hn))||ln);t._RF.pop(),t._RF.push({},"2d53e8mnhxHI4l+waizfjCg","EscHotkey",void 0);var mn,vn=e.ccclass;e.property,vn("EscHotkey")(((dn=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).index=0,e}It(e,t);var i=e.prototype;return i.onLoad=function(){this.keys=[R.ESCAPE],t.prototype.onLoad.call(this)},i.onEnable=function(){e.escIndex+=1,this.index=e.escIndex,t.prototype.onEnable.call(this)},i.onDisable=function(){e.escIndex-=1,this.index=-1,t.prototype.onDisable.call(this)},i.trigger=function(){e.escIndex<0||this.index==e.escIndex&&t.prototype.trigger.call(this)},e}(gn)).escIndex=-1,pn=dn));t._RF.pop(),t._RF.push({},"37345Pr89dKxKXe+sjSuW5N","ToggleHotKey",void 0);var yn,bn,_n,Sn,wn,Tn,En,An=e.ccclass;e.property,An("ToggleHotKey")(mn=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).toggle=null,e}It(e,t);var i=e.prototype;return i.onLoad=function(){t.prototype.onLoad.call(this),this.toggle=this.getComponent(k)},i.trigger=function(){t.prototype.trigger.call(this),this.toggle&&(this.toggle.isChecked=!this.toggle.isChecked,this.toggle.checkEvents.forEach((function(t){t.emit(null)})))},e}(hn));t._RF.pop(),t._RF.push({},"3d20epSqOJE7Yu882uRz4oI","UIHotkeyLabel",void 0);var Cn,Pn,Mn,In,Nn,Ln=e.ccclass,On=e.property;yn=Ln("UIHotkeyLabel"),bn=On(c),_n=On(y),yn((Tn=Mt((wn=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return e=t.call.apply(t,[this].concat(n))||this,Nt(e,"nodeMain",Tn,Lt(e)),Nt(e,"lbMain",En,Lt(e)),e.hotkey=null,e}It(e,t);var i=e.prototype;return i.onLoad=function(){this.hotkey=this.node.getComponent(hn),this.hotkey?(this.lbMain.string=this.hotkey.getKeyString(),Ht.on(me.EVENT_NAME.HOTKEY_STATE_CHANGED,this.updateHotKeyState,this),this.updateHotKeyState()):console.error("UIHotkeylabel the hotkey is null")},i.onDestroy=function(){Ht.off(me.EVENT_NAME.HOTKEY_STATE_CHANGED,this.updateHotKeyState,this)},i.updateHotKeyState=function(){var t,e=null!=(t=Ke.instance.getGlobalData(me.STORAGE_KEY.HOTKEY))&&t;this.nodeMain.active=e},e}(o)).prototype,"nodeMain",[bn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),En=Mt(wn.prototype,"lbMain",[_n],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Sn=wn));t._RF.pop(),t._RF.push({},"05db20FCuhNgIZ/Of1+Usnv","InteractableItem",void 0);var Rn,xn=e.ccclass,Fn=e.property;Cn=xn("InteractableItem"),Pn=Fn(c),Cn((Nn=Mt((In=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return e=t.call.apply(t,[this].concat(n))||this,Nt(e,"nodeTouch",Nn,Lt(e)),e.onSelected=null,e.onStart=null,e.onDrag=null,e.onHover=null,e.onEndInteracted=null,e.isInteracting=!1,e.passThroughNode=null,e.dragCount=0,e.interactNode=null,e.transform=null,e}It(e,t);var i=e.prototype;return i.setInteractable=function(t,e){var i;void 0===e&&(e=null),this.passThroughNode=e;var n=null!=(i=this.nodeTouch)?i:this.node;t?(n.on(V.TOUCH_END,this.onTouchEnd,this),n.on(V.TOUCH_START,this.onTouchStart,this),n.on(V.TOUCH_MOVE,this.onTouchMove,this),n.on(V.MOUSE_ENTER,this.onMouseHover,this),n.on(V.MOUSE_LEAVE,this.onMouseLeave,this)):(n.off(V.TOUCH_END,this.onTouchEnd,this),n.off(V.TOUCH_START,this.onTouchStart,this),n.off(V.TOUCH_MOVE,this.onTouchMove,this),n.off(V.MOUSE_ENTER,this.onMouseHover,this),n.off(V.MOUSE_LEAVE,this.onMouseLeave,this))},i.getTransform=function(){var t;null==this.transform&&(this.interactNode=null!=(t=this.nodeTouch)?t:this.node,this.transform=this.interactNode.getComponent(B));return this.transform},i.isContainsPosition=function(t){var e=this.getTransform().contentSize;return H(this.interactNode.position.x-e.width/2,this.interactNode.position.y-e.height/2,e.width,e.height).contains(t)},i.onTouchEnd=function(t){var e,i;this.dragCount<=4&&(null==(i=this.onSelected)||i.call(this,this));this.dragCount=0,this.isInteracting=!1,this.checkPassThroughNode(V.TOUCH_END,t),null==(e=this.onEndInteracted)||e.call(this,this)},i.onTouchStart=function(t){var e;this.dragCount=0,this.isInteracting=!0,this.checkPassThroughNode(V.TOUCH_START,t),null==(e=this.onStart)||e.call(this,this)},i.onTouchMove=function(t){var e;(this.dragCount++,this.checkPassThroughNode(V.TOUCH_MOVE,t),this.dragCount>=4)&&(null==(e=this.onDrag)||e.call(this,this))},i.onMouseHover=function(t){var e;this.checkPassThroughNode(V.MOUSE_ENTER,t),null==(e=this.onHover)||e.call(this,this)},i.onMouseLeave=function(t){var e;this.checkPassThroughNode(V.MOUSE_ENTER,t),this.isInteracting=!1,null==(e=this.onEndInteracted)||e.call(this,this)},i.checkPassThroughNode=function(t,e){this.passThroughNode&&this.passThroughNode.emit(t,e)},e}(o)).prototype,"nodeTouch",[Pn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Mn=In));t._RF.pop(),t._RF.push({},"63b2flj0OJDBKxMBXVQtrFG","PageViewBaseItem",void 0);var Dn,zn=e.ccclass,kn=(e.property,zn("PageViewBaseItem")(Rn=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).onSelected=void 0,e}It(e,t);var i=e.prototype;return i.init=function(t,e){this.onSelected=e},i.onTouch_Main=function(){var t;null==(t=this.onSelected)||t.call(this,this)},e}(o))||Rn);t._RF.pop(),t._RF.push({},"1049b+/UgpATrtKU8hoqIHQ","PageViewBasePage",void 0);var Vn,Bn,Hn,Un,Gn,Wn,qn,Zn=e.ccclass,Yn=(e.property,Zn("PageViewBasePage")(Dn=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).items=[],e.itemData=[],e.onSelectItem=void 0,e.onCreatedItem=void 0,e}It(e,t);var i=e.prototype;return i.onLoad=function(){this.getChilds()},i.getChildNumber=function(){return this.items.length>0&&this.items.length,this.getChilds(),this.items.length},i.getChilds=function(){this.items.length>0||(this.items=this.getComponentsInChildren(kn))},i.init=function(t){var e=this;this.getChilds(),this.itemData=t;for(var i=0;i<this.items.length;i++){var n=this.items[i],r=i<t.length;if(n.node.active=r,r){var o,a=t[i];n.init(a,(function(t){null==e.onSelectItem||e.onSelectItem(t)})),null==(o=this.onCreatedItem)||o.call(this,n)}}},e}(o))||Dn);t._RF.pop(),t._RF.push({},"fe2875NRMFPRoZfEkgoBxVz","PageViewBase",void 0);var jn,Kn=e.ccclass,Xn=e.property;Vn=Kn("PageViewBase"),Bn=Xn(c),Hn=Xn(l),Vn((Wn=Mt((Gn=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return e=t.call.apply(t,[this].concat(n))||this,Nt(e,"content",Wn,Lt(e)),Nt(e,"prefabPageView",qn,Lt(e)),e.onSelectedItem=void 0,e.onCreatedItem=void 0,e.itemPerPage=0,e.firstPage=null,e.pages=[],e.items=[],e}It(e,t);var i=e.prototype;return i.init=function(t){t.length<=0||(this.items=t,this.createFristPage(),this.createPages(),this.setPageData())},i.createPages=function(){for(var t=Math.ceil(this.items.length/this.itemPerPage),e=this.pages.length;e<t;e++)this.createPage()},i.setPageData=function(){var t=this;if(!(this.pages.length<=0)){for(var e=0,i=0,n=function(e,i){e.node.active=!0,e.onSelectItem=t.onPageSelectItem.bind(t),e.onCreatedItem=t.onPageCreateItem.bind(t),e.init(i)},r=0;r<this.items.length;r+=this.itemPerPage){var o=this.items.slice(r,r+this.itemPerPage);n(this.pages[e],o),i=r+o.length,e++}if(i<this.items.length-1){var a=this.items.slice(i,this.items.length);n(this.pages[e],a)}for(var s=++e;s<this.pages.length;s++)this.pages[s].node.active=!1}},i.createFristPage=function(){var t;null==this.firstPage&&(this.firstPage=this.createPage(),this.itemPerPage=null==(t=this.firstPage)?void 0:t.getChildNumber())},i.createPage=function(){var t=A(this.prefabPageView);t.parent=this.content;var e=t.getComponent(Yn);return this.pages.push(e),e},i.onPageCreateItem=function(t){var e;null==(e=this.onCreatedItem)||e.call(this,t)},i.onPageSelectItem=function(t){var e;null==(e=this.onSelectedItem)||e.call(this,t)},e}(o)).prototype,"content",[Bn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),qn=Mt(Gn.prototype,"prefabPageView",[Hn],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Un=Gn));t._RF.pop(),t._RF.push({},"cf006zT+RZGvahsGniqfbWl","PersistentNode",void 0);var Jn=e.ccclass;e.property,Jn("PersistentNode")(jn=function(t){function e(){return t.apply(this,arguments)||this}return It(e,t),e.prototype.onLoad=function(){M.addPersistRootNode(this.node)},e}(o));t._RF.pop(),t._RF.push({},"508dcnFkVtIbZwwhiY9QURR","PopupDefine",void 0);var Qn,$n,tr="PopupMessage",er="PopupLoading";t._RF.pop(),t._RF.push({},"c34cbKAQZdEpJrFv/VJuh+B","uiManager",void 0);var ir,nr=e.ccclass,rr=(e.property,function(t){return t.LAYER_1="GlobalCanvas/Root/Layer1",t.LAYER_2="GlobalCanvas/Root/Layer2",t.LAYER_3="GlobalCanvas/Root/Layer3",t.LAYER_4="GlobalCanvas/Root/Layer4",t}({})),or=nr("UIManager")((($n=function(){function t(){this.preloadPrefabNames=[er,tr],this._dictSharedPanel={},this._dictLoading={},this._arrPopupDialog=[],this.layerNodeMap=new Map,this.blockNode=null,this.delayTimeoutDefine=0,this.popupLoading=null,this.popupLoadingData=null,this.preloadUIs()}var e=t.prototype;return e.preloadUIs=function(){var t=this;this.preloadPrefabNames.forEach((function(e){t.preloadDialog(e,null)}))},e.isDialogVisible=function(t){if(!this._dictSharedPanel.hasOwnProperty(t))return!1;var e=this._dictSharedPanel[t];return P(e)&&e.active&&P(e.parent)},e.getLayerNode=function(t){if(this.layerNodeMap.has(t)){var e=this.layerNodeMap.get(t);if(P(e))return e}var i=C(t);if(!i){i=new c;var n=t.split("/");i.name=n[n.length-1],i.parent=C("Game/Canvas")}return this.layerNodeMap.set(t,i),i},e.showDialog=function(t,e,i,n,r){var o=this;if(void 0===n&&(n=-1),void 0===r&&(r=rr.LAYER_1),!this._dictLoading[t]){var a=t.lastIndexOf("/"),s=t.slice(a+1);if(e||(e=[]),this._dictSharedPanel.hasOwnProperty(t)){var l=this._dictSharedPanel[t];if(P(l)&&P(l.parent))try{l.parent=this.getLayerNode(r),l.active=!0;var c=l.getComponent(s),u=l.getComponent(s.charAt(0).toUpperCase()+s.slice(1));if(c&&c.show)c.show.apply(c,e),i&&i(c);else{if(!u||!u.show)throw""+s;u.show.apply(u,e),i&&i(u)}return}catch(t){return void this.showMessage({message:"Error while showing dialog",title:"Error"})}}this.setLoading(!0,.5),this._dictLoading[t]=!0,Qe.createUI(t,(function(r,a){if(o.setLoading(!1),!r){var l=!1;o._dictLoading[t]||(l=!0),o._dictLoading[t]=!1,n>=0&&a.setSiblingIndex(n),o._dictSharedPanel[t]=a;var c=a.getComponent(s),u=a.getComponent(s.charAt(0).toUpperCase()+s.slice(1));if(c&&c.show)c.show.apply(c,e),i&&i(c);else{if(!u||!u.show)throw""+s;u.show.apply(u,e),i&&i(u)}l&&o.hideDialog(t)}}),null,r)}},e.preloadDialog=function(t,e){var i=this;this._dictLoading[t]=!0,Qe.preloadUI(t,(function(n,r){n?null==e||e(n):(i._dictLoading[t]=!1,i._dictSharedPanel[t]=r,r.parent=null,null==e||e(null))}))},e.hideDialog=function(t,e){if(this._dictSharedPanel.hasOwnProperty(t)){var i=this._dictSharedPanel[t];if(i&&P(i)){var n=i.getComponent("animationUI");n?n.close((function(){i.parent=null,e&&"function"==typeof e&&e()})):(i.parent=null,e&&"function"==typeof e&&e())}else e&&"function"==typeof e&&e()}this._dictLoading[t]=!1},e.hidePopup=function(t,e){if(this._dictSharedPanel.hasOwnProperty(t)){var i=this._dictSharedPanel[t];if(i&&P(i)){var n=i.getComponent(sr);n?n.hide((function(){i.parent=null,e&&"function"==typeof e&&e()})):(i.parent=null,e&&"function"==typeof e&&e())}else e&&"function"==typeof e&&e()}this._dictLoading[t]=!1},e.pushToPopupSeq=function(t,e,i){var n={panelPath:t,scriptName:e,param:i,isShow:!1};this._arrPopupDialog.push(n),this._checkPopupSeq()},e.insertToPopupSeq=function(t,e,i){var n={panelPath:e,param:i,isShow:!1};this._arrPopupDialog.splice(t,0,n)},e.shiftFromPopupSeq=function(t){var e=this;this.hideDialog(t,(function(){e._arrPopupDialog[0]&&e._arrPopupDialog[0].panelPath===t&&(e._arrPopupDialog.shift(),e._checkPopupSeq())}))},e._checkPopupSeq=function(){if(this._arrPopupDialog.length>0){var t=this._arrPopupDialog[0];t.isShow||(this.showDialog(t.panelPath,t.param),this._arrPopupDialog[0].isShow=!0)}},e.showMessage=function(t){this.showDialog(tr,[t],(function(t){}),9999,rr.LAYER_4)},e.setBlock=function(t){this.blockNode||(this.blockNode=C("GlobalCanvas/Block")),this.blockNode.active=t,this.blockNode.setSiblingIndex(999)},e.setLoading=function(t,e,i){var n=this;if(void 0===e&&(e=2),void 0===i&&(i=null),clearTimeout(this.delayTimeoutDefine),t){if(this.setBlock(!0),this.popupLoadingData=i,this.popupLoading)return void this.popupLoading.setLoadingDetail(i);this.delayTimeoutDefine=setTimeout((function(){n.showLoading()}),1e3*e)}else clearTimeout(this.delayTimeoutDefine),this.setBlock(!1),this.hidePopup(er),this.popupLoading=null,this.popupLoadingData=null},e.showLoading=function(){var t=this;this.showDialog(er,[this.popupLoadingData],(function(e){t.popupLoading=e}),1,rr.LAYER_3)},t}()).instance=void 0,Qn=$n))||Qn;t._RF.pop(),t._RF.push({},"60806q+/XRP8Yh7Fpwhr+Nd","PopupBase",void 0);var ar,sr=(0,e.ccclass)("PopupBase")(ir=function(t){function e(){return t.apply(this,arguments)||this}return It(e,t),e.prototype.doUImanagerHide=function(){var t=this;this.hide((function(){or.instance.hideDialog(t.node.name)}))},e}($i))||ir;t._RF.pop(),t._RF.push({},"24d73F5z1hKK5U8r6924kDc","ScrollViewBaseItem",void 0);var lr,cr=e.ccclass,ur=(e.property,cr("ScrollViewBaseItem")(ar=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).onSelected=void 0,e}It(e,t);var i=e.prototype;return i.init=function(t,e){this.onSelected=e},i.onTouch_Main=function(){var t;null==(t=this.onSelected)||t.call(this,this)},e}(o))||ar);t._RF.pop(),t._RF.push({},"4fd8fTpdO9H04vVXP8RzKRM","ScrollViewBaseLine",void 0);var hr,pr,dr,fr,gr,mr,vr,yr=(0,e.ccclass)("ScrollViewBaseLine")(lr=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).items=[],e.itemData=[],e.onSelectItem=void 0,e.onCreatedItem=void 0,e}It(e,t);var i=e.prototype;return i.onLoad=function(){this.getChilds()},i.getChildNumber=function(){return this.items.length>0&&this.items.length,this.getChilds(),this.items.length},i.getChilds=function(){this.items.length>0||(this.items=this.getComponentsInChildren(ur))},i.init=function(t){var e=this;this.getChilds(),this.itemData=t;for(var i=0;i<this.items.length;i++){var n=this.items[i],r=i<t.length;if(r&&(r=null!=t[0]),n.node.active=r,r){var o,a=t[i];n.init(a,(function(t){null==e.onSelectItem||e.onSelectItem(t)})),null==(o=this.onCreatedItem)||o.call(this,n)}}},e}(o))||lr;t._RF.pop(),t._RF.push({},"c6578BkEldD6Ymz3t6pB6h0","ScrollViewBase",void 0);var br,_r,Sr,wr,Tr=e.ccclass,Er=e.property;hr=Tr("ScrollViewBase"),pr=Er(c),dr=Er(l),hr((mr=Mt((gr=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return e=t.call.apply(t,[this].concat(n))||this,Nt(e,"content",mr,Lt(e)),Nt(e,"prefabLine",vr,Lt(e)),e.onSelectedItem=void 0,e.onCreatedItem=void 0,e.itemPerLine=0,e.firstLine=null,e.lines=[],e.items=[],e}It(e,t);var i=e.prototype;return i.init=function(t){t.length<=0||(this.items=t,this.createFristLine(),this.createLines(),this.setLineData())},i.createLines=function(){for(var t=Math.ceil(this.items.length/this.itemPerLine),e=this.lines.length;e<t;e++)this.createLine()},i.setLineData=function(){var t=this;if(!(this.lines.length<=0)){for(var e=0,i=0,n=function(e,i){e.node.active=!0,e.onSelectItem=t.onLineSelectItem.bind(t),e.onCreatedItem=t.onLineCreateItem.bind(t),e.init(i)},r=0;r<this.items.length;r+=this.itemPerLine){var o=this.items.slice(r,r+this.itemPerLine);n(this.lines[e],o),i=r+o.length,e++}if(i<this.items.length-1){var a=this.items.slice(i,this.items.length);n(this.lines[e],a)}for(var s=++e;s<this.lines.length;s++)this.lines[s].node.active=!1}},i.createFristLine=function(){var t;null==this.firstLine&&(this.firstLine=this.createLine(),this.itemPerLine=null==(t=this.firstLine)?void 0:t.getChildNumber())},i.createLine=function(){var t=A(this.prefabLine);t.parent=this.content;var e=t.getComponent(yr);return this.lines.push(e),e},i.onLineCreateItem=function(t){var e;null==(e=this.onCreatedItem)||e.call(this,t)},i.onLineSelectItem=function(t){var e;null==(e=this.onSelectedItem)||e.call(this,t)},e}(o)).prototype,"content",[pr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),vr=Mt(gr.prototype,"prefabLine",[dr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),fr=gr));t._RF.pop(),t._RF.push({},"36cdeVcYgBP746cVQn6km3N","ToggleAutoSound",void 0);var Ar,Cr,Pr,Mr,Ir,Nr=e.ccclass,Lr=e.property;Nr("ToggleAutoSound")((Sr=Mt((_r=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return e=t.call.apply(t,[this].concat(n))||this,Nt(e,"onAudioName",Sr,Lt(e)),Nt(e,"offAudioName",wr,Lt(e)),e.toggle=null,e}It(e,t);var i=e.prototype;return i.onLoad=function(){if(this.toggle=this.getComponent(k),this.toggle){var t=new F;t.target=this.node,t.component="ToggleAutoSound",t.handler="onToggleChanged",this.toggle.checkEvents.push(t)}},i.onToggleChanged=function(){this.toggle&&Yi.instance.playSound(this.toggle.isChecked?this.onAudioName:this.offAudioName)},e}(o)).prototype,"onAudioName",[Lr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"sfx_lobby_ui_01"}}),wr=Mt(_r.prototype,"offAudioName",[Lr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"sfx_lobby_ui_01_Low"}}),br=_r));t._RF.pop(),t._RF.push({},"ade5btidtpL5YVAIw3v0u9e","UIAutoVersion",void 0);var Or=e.ccclass,Rr=e.property;Ar=Or("UIAutoVersion"),Cr=Rr(y),Ar((Ir=Mt((Mr=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return e=t.call.apply(t,[this].concat(n))||this,Nt(e,"lbVersion",Ir,Lt(e)),e}It(e,t);var i=e.prototype;return i.start=function(){},i.onFocusInEditor=function(){},e}(o)).prototype,"lbVersion",[Cr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Pr=Mr));t._RF.pop(),t._RF.push({},"e2cc7nhdnVFF5CMWYmDA7HF","UserManager",void 0);var xr=function(){function t(){this.userdata=null,t.instance=this}return t.prototype.setUserData=function(t){this.userdata=t},xt(t,[{key:"id",get:function(){var t;return null!=(t=this.userdata.id)?t:""}},{key:"coins",get:function(){var t,e;return null!=(t=null==(e=this.userdata)?void 0:e.coin)?t:0}},{key:"characterId",get:function(){return"boy"}}]),t}();xr.instance=null;var Fr,Dr,zr,kr,Vr,Br;new xr;t._RF.pop(),t._RF.push({},"f56b3kOhzpA5qPzFsat65CR","UICoins",void 0);var Hr,Ur=e.ccclass,Gr=e.property,Wr=(Fr=Ur("UICoins"),Dr=Gr(c),Fr(((Br=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return e=t.call.apply(t,[this].concat(n))||this,Nt(e,"nodeIcon",Vr,Lt(e)),e.labelMain=null,e.showCoins={value:0},e.tweenMain=null,e.tweenNodeCoin=null,e}It(e,t);var i=e.prototype;return i.onEnable=function(){null==this.labelMain&&(this.labelMain=this.getComponent(y)),Ht.on(me.EVENT_NAME.USERCOIN_UPDATED,this.updateData,this),e.uistacks.push(this)},i.onDisable=function(){var t,i=this;Ht.off(me.EVENT_NAME.USERCOIN_UPDATED,this.updateData,this),e.uistacks=e.uistacks.filter((function(t){return t!=i})),null==(t=this.tweenMain)||t.stop(),this.tweenMain=null},i.updateData=function(){var t,e=this,i=xr.instance.coins;null==(t=this.tweenMain)||t.stop(),this.tweenMain=v(this.showCoins).to(.35,{value:i}).call((function(){var t;e.tweenMain=null,e.labelMain.string=Ie.formatNumber(Math.round(null==(t=e.showCoins)?void 0:t.value))})).start()},i.update=function(t){var e;if(null!=this.tweenMain){var i=Ie.formatNumber(Math.round(null==(e=this.showCoins)?void 0:e.value));this.labelMain.string!=i&&(this.labelMain.string=i)}},i.doSpriteEffect=function(){var t;this.nodeIcon&&(this.nodeIcon.scale=m(1.1,1.1),null==(t=this.tweenNodeCoin)||t.stop(),this.tweenNodeCoin=v(this.nodeIcon).to(.15,{scale:g.ONE},{easing:_.backIn}).start())},xt(e,null,[{key:"position",get:function(){try{return this.uistacks[this.uistacks.length-1].node.worldPosition}catch(t){return new g(0,0,0)}}},{key:"iconPosition",get:function(){try{return this.uistacks[this.uistacks.length-1].nodeIcon.worldPosition}catch(t){return new g(0,0,0)}}},{key:"current",get:function(){try{return this.uistacks[this.uistacks.length-1]}catch(t){return null}}}]),e}(o)).uistacks=[],Vr=Mt((kr=Br).prototype,"nodeIcon",[Dr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),zr=kr))||zr);t._RF.pop(),t._RF.push({},"4bf9dim3D5ES4wXF3TDJfmM","UINumberLabel",void 0);var qr,Zr,Yr,jr,Kr,Xr,Jr,Qr=(0,e.ccclass)("UINumberLabel")(Hr=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).showValue={value:0},e.tweenMain=null,e.isReformatNumber=!1,e.decimalNumberCount=0,e.format="",e}It(e,t);var i=e.prototype;return i.getNumber=function(t){return this.isReformatNumber?Ie.formatNumber(this.showValue.value,this.decimalNumberCount,this.decimalNumberCount):Ie.toFixed(t,3)},i.getString=function(t){var e=this.getNumber(t);return this.format?this.format.replace("value",e):e},i.onDisable=function(){this.stop()},i.setNumber=function(t,e,i,n,r,o){var a,s=this;if(void 0===e&&(e=.35),void 0===i&&(i=!0),void 0===n&&(n=null),void 0===r&&(r=""),void 0===o&&(o=2),this.isReformatNumber=i,this.decimalNumberCount=o,this.format=r,null==(a=this.tweenMain)||a.stop(),e<=0)return this.showValue.value=e,void(this.string=this.getString(this.showValue.value));this.tweenMain=v(this.showValue).to(e,{value:t}).call((function(){s.tweenMain=null,s.string=s.getString(s.showValue.value),null==n||n()})).start()},i.stop=function(){var t;null==(t=this.tweenMain)||t.stop(),this.tweenMain=null},i.update=function(t){if(null!=this.tweenMain){var e=this.getString(this.showValue.value);this.string!=e&&(this.string=e)}},e}(y))||Hr;t._RF.pop(),t._RF.push({},"64605hgPdJFkLm/270UV/jD","UICountdownNumber",void 0);var $r,to,eo,io,no,ro=e.ccclass,oo=e.property;qr=ro("UICountdownNumber"),Zr=oo(f),Yr=oo(U),qr((Xr=Mt((Kr=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return e=t.call.apply(t,[this].concat(n))||this,Nt(e,"sprtProgress",Xr,Lt(e)),Nt(e,"isProgressSpriteRevert",Jr,Lt(e)),e.startValue=0,e.onRoundNumberCallback=null,e.lastRoundNumberCall=0,e}It(e,t);var i=e.prototype;return i.startCountdownFrom=function(t,e,i,n){void 0===e&&(e=null),void 0===i&&(i=""),void 0===n&&(n=null),this.startValue=t,this.onRoundNumberCallback=n,this.lastRoundNumberCall=0,this.showValue.value=t,this.setNumber(0,t,!0,e,i,0)},i.update=function(e){if(t.prototype.update.call(this,e),this.sprtProgress){var i=n.clamp(this.showValue.value/this.startValue,0,1);this.isProgressSpriteRevert&&(i=1-i),this.sprtProgress.fillRange=i}this.checkCallRoundNumber()},i.checkCallRoundNumber=function(){var t,e=Math.round(this.showValue.value);e!=this.lastRoundNumberCall&&(this.lastRoundNumberCall=e,null==(t=this.onRoundNumberCallback)||t.call(this,this.lastRoundNumberCall))},e}(Qr)).prototype,"sprtProgress",[Zr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Jr=Mt(Kr.prototype,"isProgressSpriteRevert",[Yr],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),jr=Kr));t._RF.pop(),t._RF.push({},"0c915T7nLRFS43XBQpOPZlf","UIFastToggle",void 0);var ao,so,lo,co,uo,ho=e.ccclass,po=e.property;$r=ho("UIFastToggle"),to=po([c]),$r((no=Mt((io=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return e=t.call.apply(t,[this].concat(n))||this,Nt(e,"nodes",no,Lt(e)),e}It(e,t);var i=e.prototype;return i.onLoad=function(){var t=new F;t.target=this.node,t.component="UIFastToggle",t.handler="updateNodesState",this.checkEvents.push(t),this.updateNodesState()},i.updateNodesState=function(){var t=this;this.nodes.forEach((function(e){return e.active=t.isChecked}))},e}(k)).prototype,"nodes",[to],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),eo=io));t._RF.pop(),t._RF.push({},"4a84fL/AtlOh5ZYcK3uvEF8","UIName",void 0);var fo,go,mo,vo,yo,bo,_o,So,wo,To,Eo,Ao=e.ccclass,Co=e.property,Po=(ao=Ao("UIName"),so=Co(G),ao((uo=Mt((co=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return e=t.call.apply(t,[this].concat(n))||this,Nt(e,"limitChar",uo,Lt(e)),e}return It(e,t),e.prototype.setName=function(t){var e=Math.round((this.limitChar-3)/2);this.string=Ie.truncateString(t,this.limitChar,e,e)},e}(y)).prototype,"limitChar",[so],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 15}}),lo=co))||lo);t._RF.pop(),t._RF.push({},"5a859+X7W5OBYSIMvu0QJVW","UIItemUser",void 0);var Mo,Io,No,Lo,Oo,Ro,xo,Fo,Do,zo,ko,Vo=e.ccclass,Bo=e.property;fo=Vo("UIItemUser"),go=Bo({type:Po,group:{name:"User Info",id:"1"}}),mo=Bo({type:Po,group:{name:"User Info",id:"1"}}),vo=Bo({type:Wr,group:{name:"User Info",id:"1"}}),yo=Bo({type:Te,group:{name:"User Info",id:"1"}}),fo((So=Mt((_o=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return e=t.call.apply(t,[this].concat(n))||this,Nt(e,"lbUserName",So,Lt(e)),Nt(e,"lbUserUserName",wo,Lt(e)),Nt(e,"lbCoins",To,Lt(e)),Nt(e,"avatarUser",Eo,Lt(e)),e}It(e,t);var i=e.prototype;return i.setUserData=function(t){var e,i,n,r,o,a,s,l,c,u;if(!t)return null==(l=this.lbUserName)||l.setName(""),null==(c=this.lbUserUserName)||c.setName(""),void(null==(u=this.avatarUser)||u.setData(null,null));null==(e=this.lbUserName)||e.setName((null!=(i=null==t?void 0:t.first_name)?i:"")+" "+(null!=(n=null==t?void 0:t.last_name)?n:"")),null==(r=this.lbUserUserName)||r.setName("@"+(null!=(o=null==t?void 0:t.username)?o:"")),null==(a=this.lbCoins)||a.updateData(),null==(s=this.avatarUser)||s.setData(t.photo_url,"")},i.setFechtingData=function(t){void 0===t&&(t="loading..."),this.lbUserName&&this.lbUserName.setName(t),this.lbUserUserName&&this.lbUserUserName.setName(t),this.avatarUser&&this.avatarUser.setData("","")},i.setNullAvatar=function(){this.avatarUser&&this.avatarUser.clear()},e}(o)).prototype,"lbUserName",[go],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),wo=Mt(_o.prototype,"lbUserUserName",[mo],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),To=Mt(_o.prototype,"lbCoins",[vo],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Eo=Mt(_o.prototype,"avatarUser",[yo],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),bo=_o));t._RF.pop(),t._RF.push({},"63144Dta6NLH4Ot5UmPJL47","UINumberByImages",void 0);var Ho,Uo=e.ccclass,Go=e.property;Mo=Uo("UINumberByImages"),Io=Go([i]),No=Go([f]),Lo=Go([f]),Oo=Go(c),Mo((Fo=Mt((xo=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return e=t.call.apply(t,[this].concat(n))||this,Nt(e,"spriteframeNumbers",Fo,Lt(e)),Nt(e,"spriteNumbers",Do,Lt(e)),Nt(e,"spriteDecimals",zo,Lt(e)),Nt(e,"nodeDot",ko,Lt(e)),e.charMap=new Map,e}It(e,t);var i=e.prototype;return i.onLoad=function(){var t=this;this.spriteframeNumbers.forEach((function(e){return t.charMap.set(e.name,e)}))},i.getChar=function(t){return this.charMap.get(t)},i.setNumber=function(t){this.setNumberString(Ie.toFixed(t,5))},i.setNumberString=function(t){var e,i,n=t.split(".");this.nodeDot.active=n.length>1;for(var r=null!=(e=n[0])?e:"",o=0;o<this.spriteNumbers.length;o++){var a=r[o];this.spriteNumbers[o].node.active=!!a,a&&(this.spriteNumbers[o].spriteFrame=this.getChar(a))}for(var s=null!=(i=n[1])?i:"",l=0;l<this.spriteDecimals.length;l++){var c=s[l];this.spriteDecimals[l].node.active=!!c,c&&(this.spriteDecimals[l].spriteFrame=this.getChar(c))}},e}(o)).prototype,"spriteframeNumbers",[Io],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Do=Mt(xo.prototype,"spriteNumbers",[No],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),zo=Mt(xo.prototype,"spriteDecimals",[Lo],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),ko=Mt(xo.prototype,"nodeDot",[Oo],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ro=xo));t._RF.pop(),t._RF.push({},"3d366e1pk5BN6GTDW/fi9nd","UINumberLabelComponent",void 0);var Wo,qo,Zo,Yo,jo=e.ccclass,Ko=(e.property,e.requireComponent);jo("UINumberLabelComponent")(Ho=Ko(y)(Ho=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).showValue={value:0},e.tweenMain=null,e.isReformatNumber=!1,e.decimalNumberCount=0,e.format="",e.label=null,e}It(e,t);var i=e.prototype;return i.onLoad=function(){this.label=this.node.getComponent(y)},i.getNumber=function(t){return this.isReformatNumber?Ie.formatNumber(this.showValue.value,this.decimalNumberCount,this.decimalNumberCount):Ie.toFixed(t,3)},i.getString=function(t){var e=this.getNumber(t);return this.format?this.format.replace("value",e):e},i.onDisable=function(){this.stop()},i.setNumber=function(t,e,i,n,r,o){var a,s=this;if(void 0===e&&(e=.35),void 0===i&&(i=!0),void 0===n&&(n=null),void 0===r&&(r=""),void 0===o&&(o=2),this.isReformatNumber=i,this.decimalNumberCount=o,this.format=r,null==(a=this.tweenMain)||a.stop(),e<=0)return this.showValue.value=e,void(this.label.string=this.getString(this.showValue.value));this.tweenMain=v(this.showValue).to(e,{value:t}).call((function(){s.tweenMain=null,s.label.string=s.getString(s.showValue.value),null==n||n()})).start()},i.stop=function(){var t;null==(t=this.tweenMain)||t.stop(),this.tweenMain=null},i.update=function(t){if(null!=this.tweenMain){var e=this.getString(this.showValue.value);this.label.string!=e&&(this.label.string=e)}},e}(o))||Ho);t._RF.pop(),t._RF.push({},"35e18W5KnNNt7BMewSFb2bH","UIScaler",void 0);var Xo,Jo,Qo,$o,ta,ea,ia,na=e.ccclass,ra=e.property;na("UIScaler")((Zo=Mt((qo=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return e=t.call.apply(t,[this].concat(n))||this,Nt(e,"maxValue",Zo,Lt(e)),Nt(e,"minValue",Yo,Lt(e)),e}return It(e,t),e.prototype.onLoad=function(){var t=W(1080,1920),e=t.x/t.y,i=q.windowSize.width/q.windowSize.height,r=n.clamp(i/e,this.minValue,this.maxValue);this.node.setScale(m(r,r,r))},e}(o)).prototype,"maxValue",[ra],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),Yo=Mt(qo.prototype,"minValue",[ra],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),Wo=qo));t._RF.pop(),t._RF.push({},"30045XZ1HVFj77RL4VxNUVU","UIScreenScaler",void 0);var oa,aa,sa,la,ca,ua,ha,pa,da,fa=e.ccclass,ga=e.property;Xo=fa("UIScreenScaler"),Jo=ga(c),Xo((ta=Mt(($o=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return e=t.call.apply(t,[this].concat(n))||this,Nt(e,"targetNode",ta,Lt(e)),Nt(e,"designWidth",ea,Lt(e)),Nt(e,"designHeight",ia,Lt(e)),e.widget=null,e.transform=null,e}It(e,t);var i=e.prototype;return i.onLoad=function(){this.targetNode||(this.targetNode=this.node),this.widget=this.targetNode.getComponent(Z),this.transform=this.targetNode.getComponent(B),Y.on("design-resolution-changed",this.onScreenResize,this),Y.on("canvas-resize",this.onScreenResize,this),this.onScreenResize()},i.onDestroy=function(){Y.off("design-resolution-changed",this.onScreenResize,this),Y.off("canvas-resize",this.onScreenResize,this)},i.onScreenResize=function(){var t=Y.getVisibleSize();if(S.platform===S.Platform.MOBILE_BROWSER)this.widget.isAlignLeft=!0,this.widget.isAlignRight=!0,this.widget.isAlignTop=!0,this.widget.isAlignBottom=!0,this.widget.left=0,this.widget.right=0,this.widget.top=0,this.widget.bottom=0;else{var e=9/16;if(t.width/t.height>e){var i=t.height*e,n=(t.width-i)/2;this.widget.isAlignLeft=!0,this.widget.isAlignRight=!0,this.widget.isAlignTop=!0,this.widget.isAlignBottom=!0,this.widget.left=n,this.widget.right=n,this.widget.top=0,this.widget.bottom=0}else this.widget.isAlignLeft=!0,this.widget.isAlignRight=!0,this.widget.isAlignTop=!0,this.widget.isAlignBottom=!0,this.widget.left=0,this.widget.right=0,this.widget.top=0,this.widget.bottom=0}this.widget.updateAlignment()},e}(o)).prototype,"targetNode",[Jo],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ea=Mt($o.prototype,"designWidth",[ga],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1080}}),ia=Mt($o.prototype,"designHeight",[ga],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1920}}),Qo=$o));t._RF.pop(),t._RF.push({},"23aff/dfqZMeJFuAqFaQ5p2","UISlider",void 0);var ma,va,ya,ba,_a,Sa,wa,Ta=e.ccclass,Ea=e.property,Aa=(oa=Ta("UISlider"),aa=Ea(f),sa=Ea([c]),la=Ea([c]),oa((ha=Mt((ua=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return e=t.call.apply(t,[this].concat(n))||this,Nt(e,"spriteFiller",ha,Lt(e)),Nt(e,"objectsOff",pa,Lt(e)),Nt(e,"objectsOn",da,Lt(e)),e}It(e,t);var i=e.prototype;return i.start=function(){this.node.on("slide",this.onSliderChange,this),this.onSliderChange()},i.onSliderChange=function(){var t=this.progress;this.updateSpriteFiller(t),this.updateObjects(t)},i.updateSpriteFiller=function(t){this.spriteFiller&&this.spriteFiller.node.setScale(t,1,1)},i.updateObjects=function(t){for(var e,i=0===t,n=Ft(this.objectsOff);!(e=n()).done;){e.value.active=i}for(var r,o=Ft(this.objectsOn);!(r=o()).done;){r.value.active=!i}},e}(j)).prototype,"spriteFiller",[aa],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),pa=Mt(ua.prototype,"objectsOff",[sa],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),da=Mt(ua.prototype,"objectsOn",[la],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),ca=ua))||ca);t._RF.pop(),t._RF.push({},"92959RjXUxD97yy1ukHjcyM","UISliderRectSize",void 0);var Ca,Pa,Ma,Ia,Na,La,Oa,Ra,xa,Fa,Da,za,ka,Va,Ba,Ha=e.ccclass,Ua=e.property;ma=Ha("UISliderRectSize"),va=Ua(B),ya=Ua(B),ma((Sa=Mt((_a=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return e=t.call.apply(t,[this].concat(n))||this,Nt(e,"transSlider",Sa,Lt(e)),Nt(e,"transMain",wa,Lt(e)),e.originalWidth=0,e}It(e,t);var i=e.prototype;return i.start=function(){this.originalWidth=this.transSlider.width,t.prototype.start.call(this)},i.updateSpriteFiller=function(t){this.transMain.width=t*this.originalWidth},e}(Aa)).prototype,"transSlider",[va],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),wa=Mt(_a.prototype,"transMain",[ya],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ba=_a));t._RF.pop(),t._RF.push({},"59a6c9CvhtC0L3ZWOHqwOyc","UIToggleGroups",void 0);var Ga,Wa,qa,Za,Ya,ja,Ka,Xa,Ja,Qa,$a,ts,es,is,ns,rs=e.ccclass,os=e.property,as=(Ca=rs("ToggleData"),Pa=os(k),Ma=os([Ve]),Ca((La=Mt((Na=function(){function t(){Nt(this,"toggle",La,this),Nt(this,"visibleViews",Oa,this)}return t.prototype.updateVisible=function(){var t=this;this.visibleViews.forEach((function(e){return null==e?void 0:e.setPanelVisible(t.toggle.isChecked,.25,!0)}))},t}()).prototype,"toggle",[Pa],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Oa=Mt(Na.prototype,"visibleViews",[Ma],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Ia=Na))||Ia);Ra=rs("UIToggleGroups"),xa=os([as]),Fa=os(k),Ra((ka=Mt((za=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return e=t.call.apply(t,[this].concat(n))||this,Nt(e,"data",ka,Lt(e)),Nt(e,"default",Va,Lt(e)),Nt(e,"isAllowOffAll",Ba,Lt(e)),e.activeToggle=null,e}It(e,t);var i=e.prototype;return i.onLoad=function(){this.init()},i.init=function(){var t=this;this.data.forEach((function(e){var i=new F;i.target=t.node,i.component="UIToggleGroups",i.handler="onToggleChanged",e.toggle.checkEvents.push(i)})),this.default&&(this.default.isChecked=!0,this.onToggleChanged(this.default))},i.onToggleChanged=function(t){this.isAllowOffAll,this.activeToggle!=t&&(t.isChecked&&(this.activeToggle=t,this.activeToggle.interactable=!1),ve.LOG&&console.log("onToggleChanged"+t),t.isChecked&&this.data.forEach((function(e){e.toggle!=t&&(e.toggle.isChecked=!1,e.toggle.interactable=!0),e.updateVisible()})))},i.updateToggles=function(){this.data.forEach((function(t){t.updateVisible()}))},e}(o)).prototype,"data",[xa],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Va=Mt(za.prototype,"default",[Fa],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ba=Mt(za.prototype,"isAllowOffAll",[os],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Da=za));t._RF.pop(),t._RF.push({},"e1a51NjaFRBkoSdI6zruA8N","UIViewDrawer",void 0);var ss,ls,cs,us,hs,ps=e.ccclass,ds=e.property,fs=function(t){return t[t.HORIZONTAL=0]="HORIZONTAL",t[t.VERTICAL=1]="VERTICAL",t}({});Ga=ps("UIViewDrawer"),Wa=ds({type:O(He)}),qa=ds({type:O(fs)}),Za=ds(g),Ya=ds(c),ja=ds([c]),Ga((Ja=Mt((Xa=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return e=t.call.apply(t,[this].concat(n))||this,Nt(e,"beginType",Ja,Lt(e)),Nt(e,"direction",Qa,Lt(e)),Nt(e,"beginPosition",$a,Lt(e)),Nt(e,"drawerIndicator",ts,Lt(e)),Nt(e,"nodeVisibles",es,Lt(e)),Nt(e,"hidePosX",is,Lt(e)),Nt(e,"showPosX",ns,Lt(e)),e.visibleIndex=-1,e}It(e,t);var i=e.prototype;return i.setPosition=function(t,e){switch(this.direction){case fs.HORIZONTAL:t.x=e;break;case fs.VERTICAL:t.y=e}return t},i.addPosition=function(t,e){switch(this.direction){case fs.HORIZONTAL:t.x+=e;break;case fs.VERTICAL:t.y+=e}return t},i.onLoad=function(){switch(this.beginType){case He.NONE:break;case He.HIDE:this.nodeVisibles.forEach((function(t){return t.active=!1}));var t=this.beginPosition.clone();this.setPosition(t,this.hidePosX),this.node.setPosition(t),this.drawerIndicator&&(this.drawerIndicator.angle=0),this.visibleIndex=0;break;case He.SHOW:this.node.setPosition(this.beginPosition),this.nodeVisibles.forEach((function(t){return t.active=!0})),this.drawerIndicator&&(this.drawerIndicator.angle=180),this.visibleIndex=1}},i.setDrawerVisible=function(t,e,i){var n=this;if(void 0===e&&(e=null),void 0===i&&(i=.2),this.visibleIndex!=(t?1:0)){this.visibleIndex=t?1:0,t&&this.nodeVisibles.forEach((function(t){return t.active=!0}));var r=this.node.position.clone();this.setPosition(r,t?this.showPosX:this.hidePosX),v(this.node).stop(),v(this.node).to(i,{position:r},{easing:_.quartOut}).call((function(){0==t&&n.nodeVisibles.forEach((function(t){return t.active=!1})),null==e||e()})).start();var o=t?180:0;this.drawerIndicator&&(v(this.drawerIndicator).stop(),v(this.drawerIndicator).to(i,{angle:o},{easing:_.backOut}).start())}},i.show=function(t,e){var i=this;void 0===e&&(e=null),this.setDrawerVisible(!0,(function(){i.shown(),null==e||e()})),Yi.instance.playSound(me.SOUND_FILES.SLIDE_IN)},i.doShow=function(){this.show(null)},i.doHide=function(){this.hide()},i.hide=function(t){var e=this;void 0===t&&(t=null),this.setDrawerVisible(!1,(function(){e.hided(),null==t||t()})),Yi.instance.playSound(me.SOUND_FILES.SLIDE_OUT)},i.shown=function(){},i.hided=function(){},i.onTouch_ShowHide=function(){1==this.visibleIndex?this.doHide():this.doShow()},xt(e,[{key:"isShowing",get:function(){return 1==this.visibleIndex}}]),e}(o)).prototype,"beginType",[Wa],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return He.HIDE}}),Qa=Mt(Xa.prototype,"direction",[qa],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return fs.HORIZONTAL}}),$a=Mt(Xa.prototype,"beginPosition",[Za],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return m(0,0,0)}}),ts=Mt(Xa.prototype,"drawerIndicator",[Ya],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),es=Mt(Xa.prototype,"nodeVisibles",[ja],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),is=Mt(Xa.prototype,"hidePosX",[ds],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),ns=Mt(Xa.prototype,"showPosX",[ds],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Ka=Xa));t._RF.pop(),t._RF.push({},"6cc02rpxS1ESpwuMymGkGQL","UserInteractHandler",void 0);var gs=e.ccclass,ms=e.property,vs=function(){this.type=Be.NONE,this.data=null};ss=gs("TouchController"),ls=ms(c),ss((hs=Mt((us=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return e=t.call.apply(t,[this].concat(n))||this,Nt(e,"listenerNode",hs,Lt(e)),e.listeners={},e.initialDistance=null,e.startTouchPos=null,e.isTouchMoveTrigger=!1,e.lastDragPos=null,e}It(e,t);var i=e.prototype;return i.onLoad=function(){this.initInteracting()},i.onDestroy=function(){},i.addListener=function(t,e){this.listeners[t]||(this.listeners[t]=[]),this.listeners[t].push(e)},i.removeListener=function(t,e){if(this.listeners[t]){var i=this.listeners[t].indexOf(e);i>-1&&this.listeners[t].splice(i,1)}},i.dispatchEvent=function(t){this.listeners[t.type]&&this.listeners[t.type].forEach((function(e){return e(t.data)}))},i.resetValues=function(){this.startTouchPos=null,this.initialDistance=null,this.lastDragPos=null},i.initInteracting=function(){var t=this;this.listenerNode.on(V.MOUSE_WHEEL,(function(e){var i=new vs;i.type=Be.ZOOM,i.data=-e.getScrollY()/10,t.dispatchEvent(i)}),this),this.listenerNode.on(V.TOUCH_START,this.onTouchStart,this),this.listenerNode.on(V.TOUCH_MOVE,this.onTouchMove,this),this.listenerNode.on(V.TOUCH_END,this.onTouchEnd,this),this.listenerNode.on(V.TOUCH_CANCEL,this.onTouchEnd,this),this.listenerNode.on(V.MOUSE_ENTER,this.onHoverBackground,this)},i.onHoverBackground=function(t){var e=new vs;e.type=Be.HOVER,this.dispatchEvent(e)},i.onTouchStart=function(t){2===t.getTouches().length&&(this.initialDistance=this.getDistanceBetweenTouches(t)),1===t.getTouches().length&&(this.startTouchPos=t.getTouches()[0].getLocation()),this.isTouchMoveTrigger=!1},i.onTouchMove=function(t){if(2===t.getTouches().length){var e=this.getDistanceBetweenTouches(t)-this.initialDistance,i=new vs;i.type=Be.ZOOM;i.data=-.01*e,this.dispatchEvent(i),this.isTouchMoveTrigger=!0}else if(1===t.getTouches().length){var n=t.getTouches()[0].getLocation(),r=new vs;r.type=Be.DRAG,r.data={start:null==this.lastDragPos?this.startTouchPos:this.lastDragPos,current:n},this.dispatchEvent(r),this.isTouchMoveTrigger=!0,this.lastDragPos=n.clone()}},i.onTouchEnd=function(t){if(t.getTouches().length<2&&(this.initialDistance=null,this.lastDragPos=null,0==this.isTouchMoveTrigger)){var e=new vs;e.type=Be.TOUCH,e.data=this.startTouchPos,this.dispatchEvent(e)}if(0===t.getTouches().length&&this.startTouchPos){var i=t.getTouches()[0].getLocation();if(K.distance(i,this.startTouchPos)>100){var n=new vs;n.type=Be.SWIPE,n.data={start:this.startTouchPos,end:i},this.dispatchEvent(n)}}var r=new vs;r.type=Be.END_INTERACTED,this.dispatchEvent(r),this.startTouchPos=null},i.getDistanceBetweenTouches=function(t){var e=t.getTouches(),i=e[0].getLocation(),n=e[1].getLocation();return K.distance(i,n)},e}(o)).prototype,"listenerNode",[ls],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),cs=us));t._RF.pop(),t._RF.push({},"f34a2opKdlGHZC9qbc+L0O/","enum",void 0);var ys=function(t){return t[t.Vertical=0]="Vertical",t[t.Horizontal=1]="Horizontal",t}({}),bs=function(t){return t[t.Unrestricted=0]="Unrestricted",t[t.Elastic=1]="Elastic",t[t.Clamped=2]="Clamped",t}({}),_s=function(t){return t[t.Start=0]="Start",t[t.End=1]="End",t}({}),Ss=function(t){return t[t.Auto=0]="Auto",t[t.Header=1]="Header",t[t.Footer=2]="Footer",t[t.Center=3]="Center",t}({}),ws=function(t){return t[t.Lowest=0]="Lowest",t[t.Medium=1]="Medium",t[t.Highest=2]="Highest",t}({}),Ts=function(t){return t[t.Auto=0]="Auto",t[t.Wrap=1]="Wrap",t[t.Nowrap=2]="Nowrap",t}({}),Es=function(t){return t[t.Auto=0]="Auto",t[t.AlwaysAllow=1]="AlwaysAllow",t[t.Disabled=2]="Disabled",t}({}),As=function(t){return t[t.Header=0]="Header",t[t.Footer=1]="Footer",t}({}),Cs=function(t){return t[t.UpperLeft=0]="UpperLeft",t[t.UpperCenter=1]="UpperCenter",t[t.UpperRight=2]="UpperRight",t[t.MiddleLeft=3]="MiddleLeft",t[t.MiddleCenter=4]="MiddleCenter",t[t.MiddleRight=5]="MiddleRight",t[t.LowerLeft=6]="LowerLeft",t[t.LowerCenter=7]="LowerCenter",t[t.LowerRight=8]="LowerRight",t}({}),Ps=function(t){return t[t.Up=0]="Up",t[t.Down=1]="Down",t[t.Left=2]="Left",t[t.Right=3]="Right",t[t.None=4]="None",t}({}),Ms=function(t){return t[t.Top_To_Bottom=0]="Top_To_Bottom",t[t.Bottom_To_Top=1]="Bottom_To_Top",t[t.Left_To_Right=2]="Left_To_Right",t[t.Right_To_Left=3]="Right_To_Left",t}({}),Is=function(t){return t[t.Both=0]="Both",t[t.Header=1]="Header",t[t.Footer=2]="Footer",t}({}),Ns=function(t){return t[t.Auto=0]="Auto",t[t.Header=1]="Header",t[t.Footer=2]="Footer",t}({}),Ls=function(t){return t[t.Normal=0]="Normal",t[t.Button=1]="Button",t}({}),Os=function(t){return t[t.None=0]="None",t[t.ColorTint=1]="ColorTint",t[t.SpriteSwap=2]="SpriteSwap",t[t.Scale=3]="Scale",t}({}),Rs=function(t){return t.IDLE="IDLE",t.PULL="PULL",t.WAIT="WAIT",t.RELEASE="RELEASE",t}({}),xs=function(t){return t.CREATED="ADAPTER:HOLDER:CREATED",t.VISIBLE="ADAPTER:HOLDER:VISIBLE",t.DISABLE="ADAPTER:HOLDER:DISABLE",t}({}),Fs=function(t){return t.VISIBLE="ADAPTER:VIEW:VISIBLE",t.DISABLE="ADAPTER::VIEW:DISABLE",t}({});O(ys),O(bs),O(_s),O(Ss),O(As),O(Ms),O(Cs),O(Es),O(Ls),O(Os),t._RF.pop(),t._RF.push({},"745449vUL5G0oNZ/T6pUfiN","Group",void 0);var Ds=function(){function t(t){this._adapter=void 0,this._index=-1,this._models=[],this._size={x:0,y:0},this._oldSize={x:0,y:0},this._anchorPoint={x:.5,y:.5},this._position={x:0,y:0},this._oldPosition={x:0,y:0},this._totalMinSize={x:0,y:0},this._totalPreferredSize={x:0,y:0},this._totalFlexibleSize={x:0,y:0},this._isFixed=!1,this._fixedIndex=-1,this._adapter=t,this.internal_reset()}var e=t.prototype;return e.findModelIndex=function(t){return this.models.findIndex((function(e){return e.index==t}))},e.internal_reset=function(){this._models=[],this._size={x:0,y:0},this._oldSize={x:0,y:0},this._anchorPoint={x:.5,y:.5},this._position={x:0,y:0},this._oldPosition={x:0,y:0},this._totalMinSize={x:0,y:0},this._totalPreferredSize={x:0,y:0},this._totalFlexibleSize={x:0,y:0},this._isFixed=!1,this._fixedIndex=-1,this._setAnchorPoint()},e.internal_setPosition=function(t){var e=this.adapter.mainAxis;this.oldPosition[e]=this.position[e],this.position[e]=t},e.internal_setIndex=function(t){this._index=t},e.internal_insert=function(t,e,i){e.internal_reset();var n=this.models;if(this.internal_reset(),this._fixedIndex=t.fixedIndex,!i)for(var r=0;r<n.length;r++){var o=n[r];if(!(o.index<t.modelIndex))break;if(!this._insertHandler(o,e))return t.modelIndex=o.index,t.fixedIndex=this.isFixed?this.index:t.fixedIndex,!0}for(var a=t.modelIndex;a<this.adapter.modelManager.length;a++){var s=this.adapter.modelManager.get(a);if(!this._insertHandler(s,e))return t.modelIndex=s.index,t.fixedIndex=this.isFixed?this.index:t.fixedIndex,s.index}return!1},e.internal_includes=function(t){for(var e,i=this,n=function(){var e=t[r];if(-1!=i.models.findIndex((function(t){return t.data==e})))return{v:!0}},r=0;r<t.length;r++)if(e=n())return e.v;return!1},e._insertHandler=function(t,e){if(e.internal_isWrap(t,this))return e.internal_reset(),!1;e.internal_push(t),t.element.fixed&&(this._isFixed=!0,this._fixedIndex=-1);var i=this.adapter.mainAxis,n=this.adapter.crossAxis;return(!t.element.ignoreLayout||t.element.ignoreLayout&&t.element.placeholder)&&(this.size[i]=Math.max(this.size[i],t.size[i]*t.scale[i])),this.size[n]=this.adapter.crossAxisSize,this.oldSize[i]=this.size[i],this.oldSize[n]=this.size[n],this.models.push(t),!0},e._setAnchorPoint=function(){switch(this.adapter.viewManager.stretchDirection){case Ss.Center:this.anchorPoint[this.adapter.mainAxis]=.5;break;case Ss.Header:this.anchorPoint[this.adapter.mainAxis]=1-this.adapter.mainAxisAnchorPoint;break;default:this.anchorPoint[this.adapter.mainAxis]=this.adapter.mainAxisAnchorPoint}},xt(t,[{key:"adapter",get:function(){return this._adapter}},{key:"index",get:function(){return this._index}},{key:"models",get:function(){return this._models}},{key:"size",get:function(){return this._size}},{key:"oldSize",get:function(){return this._oldSize}},{key:"anchorPoint",get:function(){return this._anchorPoint}},{key:"position",get:function(){return this._position}},{key:"oldPosition",get:function(){return this._oldPosition}},{key:"totalMinSize",get:function(){return this._totalMinSize}},{key:"totalPreferredSize",get:function(){return this._totalPreferredSize}},{key:"totalFlexibleSize",get:function(){return this._totalFlexibleSize}},{key:"isFixed",get:function(){return this._isFixed}},{key:"fixedIndex",get:function(){return this._fixedIndex}}]),t}();t._RF.pop(),t._RF.push({},"9951cDVtORNYrBREEqRMzYS","helper",void 0);var zs,ks=function(){function t(){}return t.smoothStep=function(t,e,i){return e*(i=-2*(i=this.clamp01(i))*i*i+3*i*i)+t*(1-i)},t.smoothDamp=function(t,e,i,n,r,o){var a=2/(n=Math.max(1e-4,n)),s=a*o,l=1/(1+s+.48*s*s+.235*s*s*s),c=t-e,u=e,h=r*n,p=(i+a*(c=this.clamp(c,0-h,h)))*o;i=(i-a*p)*l;var d=(e=t-c)+(c+p)*l;return u-t>0==d>u&&(i=((d=u)-u)/o),{velocity:i,position:d}},t.clamp01=function(t){return this.clamp(t,0,1)},t.clamp=function(t,e,i){return void 0===e&&(e=0),void 0===i&&(i=1),Math.min(Math.max(t,e),i)},t.sign=function(t){return t>=0?1:-1},t.lerp=function(t,e,i){return t+(e-t)*this.clamp01(i)},t.approximately=function(t,e){return Math.abs(e-t)<Math.max(1e-4*Math.max(Math.abs(t),Math.abs(e)),8*this.Epsilon)},t.round=function(t,e){return Math.round(t*Math.pow(10,e))/Math.pow(10,e)},t.pingpang=function(t){var e=t;e=Math.abs(t);var i=Math.trunc(e);return i%2==0?e-=i:e=1-(e-i),e},t.isNumber=function(t){return"number"==typeof t&&!isNaN(t)},t.progress=function(t,e,i,n){return t+(e-t)*n},t.getGuid=function(){var t=(new Date).getTime();return window.performance&&"function"==typeof window.performance.now&&(t+=performance.now()),"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,(function(e){var i=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"==e?i:3&i|8).toString(16)}))},t}();ks.Epsilon=1401298e-51,ks.Infinity=1/0,t._RF.pop(),t._RF.push({},"2be49b5ffhLSZVXKWyATSqt","Manager",void 0);var Vs,Bs,Hs=e.ccclass,Us=(e.property,Hs("Manager")(zs=function(){function t(){this._inited=!1,this._eventMap=new Map,this._adapter=null}var e=t.prototype;return e.internal_create=function(t){this._adapter=t},e.internal_init=function(){this._inited||(this._inited=!0,this.onInit())},e.on=function(t,e,i,n){void 0===n&&(n=!1),this._eventMap.has(t)||this._eventMap.set(t,[]);var r=this._eventMap.get(t);null!=r&&r.find((function(t){return t.target==i&&t.callback==e}))||r.push({callback:e,target:i,once:n})},e.off=function(t,e,i){if(this._eventMap.has(t)){var n=this._eventMap.get(t),r=null==n?void 0:n.findIndex((function(t){return t.callback==e&&t.target==i}));-1!=r&&n.splice(r,1)}},e.emit=function(t){if(this._eventMap.has(t)){for(var e=this._eventMap.get(t),i=arguments.length,n=new Array(i>1?i-1:0),r=1;r<i;r++)n[r-1]=arguments[r];for(var o=0;o<e.length;o++){var a,s=e[o];(a=s.callback).call.apply(a,[s.target].concat(n)),s.once&&(e.splice(o,1),o--)}}},xt(t,[{key:"adapter",get:function(){return this._adapter}}]),t}())||zs);t._RF.pop(),t._RF.push({},"36ea76OAA9IiJKehmGOQ6xW","ModelManager",void 0);var Gs,Ws=e.ccclass,qs=(e.property,function(t){return t[t.ON_CLEAR=0]="ON_CLEAR",t[t.ON_INSERT=1]="ON_INSERT",t[t.ON_REMOVE=2]="ON_REMOVE",t[t.ON_MOVE=3]="ON_MOVE",t[t.ON_UPDATE=4]="ON_UPDATE",t[t.ON_CHANGE_BEFORE=5]="ON_CHANGE_BEFORE",t}(qs||{})),Zs=Ws("ModelManager")(((Bs=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this)._modelList=[],e._length=0,e}It(e,t);var i=e.prototype;return i.onInit=function(){},i.insert=function(){var t=Ot(Rt().mark((function t(e,i){var n;return Rt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:void 0===i&&(i=this.length),n=this._toArray(e),i=ks.clamp(i,0,this.length),this.emit(qs.ON_CHANGE_BEFORE),this._insertHandler(n,i),this._length=this._modelList.length,n.length>0&&this.emit(qs.ON_INSERT,i);case 7:case"end":return t.stop()}}),t,this)})));return function(e,i){return t.apply(this,arguments)}}(),i._insertHandler=function(t,e){var i=this,n=e;this._length=this._modelList.length;for(var r=[],o=function(t,e){return(p=i._getNewModel(t)).index=e,i._modelList.push(p),p},a=function(t){var e=i.get(n);if(e)r.push(i._copyModel(e,{})),e.data=t,e.index=n,i._initModel(e);else{var a=o(t,n);i._initModel(a)}n++},s=0,l=t.length;s<l;s++)a(t[s]);for(var c=0;c<r.length;c++){var u=r[c],h=n+c;if(this.get(h)){var p=this.get(h);r.push(this._copyModel(p,{})),this._copyModel(u,p)}else{var d=o(u.data,h);this._copyModel(u,d)}}},i.remove=function(t,e){if(void 0===e&&(e=1),0!=e&&!(t<0||t>=this.length)){var i=this.length;this.emit(qs.ON_CHANGE_BEFORE);for(var n=t;n<this.length;n++){var r=this.get(n),o=this.get(n+e);if(!o){i=n;break}this._copyModel(o,r),r.index=n}this._modelList.splice(i,this.length),this._length=this._modelList.length,this.emit(qs.ON_REMOVE,t)}},i.move=function(t,e,i){var n=this;if(!(t<0||e<=0)){this.emit(qs.ON_CHANGE_BEFORE);var r=this._modelList.map((function(t){return n._copyModel(t,{})})),o=r.splice(t,e);r.splice.apply(r,[i,0].concat(o));for(var a=0;a<r.length;a++)this._copyModel(r[a],this._modelList[a]);var s=Math.min(t,i);this.emit(qs.ON_MOVE,s)}},i.update=function(){this.emit(qs.ON_UPDATE)},i.clear=function(){this._modelList.length=0,this._length=0,this.emit(qs.ON_CLEAR)},i.has=function(t){return!!this._modelList[t]},i.get=function(t){return isNaN(t)?null:this._modelList[t]},i.slice=function(t,e){return 0==this.length?[]:this._modelList.slice(t,e)},i._toArray=function(t){return t?t instanceof Array?t:[t]:[]},i._getNewModel=function(t){return{data:t,index:-1,code:null,size:{x:0,y:0},layoutSize:{x:0,y:0},scale:{x:0,y:0},position:{x:0,y:0},anchorPoint:{x:0,y:0},element:{wrapBeforeMode:Ts.Wrap,wrapAfterMode:Ts.Nowrap,ignoreLayout:!1,placeholder:!1,minSize:{x:0,y:0},preferredSize:{x:0,y:0},flexibleSize:{x:0,y:0},layer:ws.Lowest,fixed:!1,fixedOffset:0,fixedSpacing:null,update:function(){}},isValid:!0,update:function(){}}},i._initModel=function(t){var e=this.adapter.getPrefab(t.data);if(!e)throw Error("预制体不能为空");if(e instanceof c){var i=e.getComponent(B);t.code=e.uuid,t.size={x:i.width,y:i.height},t.scale={x:i.node.scale.x,y:i.node.scale.y},t.anchorPoint={x:i.anchorPoint.x,y:i.anchorPoint.y}}else{var n=e.data.getComponent(B);t.code=e.data._prefab.fileId,t.size={x:n.width,y:n.height},t.scale={x:n.node.scale.x,y:n.node.scale.y},t.anchorPoint={x:n.anchorPoint.x,y:n.anchorPoint.y}}t.layoutSize={x:0,y:0},t.position={x:0,y:0},t.element={wrapBeforeMode:Ts.Wrap,wrapAfterMode:Ts.Nowrap,ignoreLayout:!1,placeholder:!1,minSize:{x:0,y:0},preferredSize:{x:0,y:0},flexibleSize:{x:0,y:0},layer:ws.Lowest,fixed:!1,fixedOffset:0,fixedSpacing:null,update:function(){}},this.adapter.initElement(t.element,t.data)},i._copyModel=function(t,e){t.element.update=function(){};return function t(e,i){for(var n in e){var r=e[n];"data"!=n?"index"!=n&&(null!=r&&"object"==typeof r?(i[n]={},t(r,i[n])):i[n]=r):i[n]=r}}(t,e),e},xt(e,[{key:"length",get:function(){return this._length}},{key:"modelList",get:function(){return this._modelList}}]),e}(Us)).Event=qs,Vs=Bs))||Vs;t._RF.pop(),t._RF.push({},"e143cqYQS9Lga09ceG48Qky","Holder",void 0);var Ys=e.ccclass,js=(e.property,Ys("Holder")(Gs=function(){function t(t,e,i){this._node=void 0,this._transform=void 0,this._code=void 0,this._adapter=void 0,this._model=void 0,this._view=void 0,this._fixedIndex=-1,this._oldData=null,this._oldElement=null,this._isCallCreated=!1,this._isLayout=!1,this._node=t,this._code=e,this._adapter=i,this._transform=this.node.getComponent(B)}var e=t.prototype;return e.internal_visible=function(t,e,i){var n=this;this._view=t,this._model=e,this._oldElement=Object.assign({},e.element),this._model.element.update=this._updateElement.bind(this),this._oldData=this.data,i&&(this.node.active=!0,this._isCallCreated||(this._isCallCreated=!0,this.onCreated()),this.element.fixed&&(this._fixedIndex=this.view.group.models.findIndex((function(t){return t.index==n.model.index}))),this.transform.setContentSize(this.model.size.x,this.model.size.y),this.node.setScale(this.model.scale.x,this.model.scale.y),this._register(),this.onVisible(),this._model.update=this._updateHandler.bind(this))},e._updateElement=function(){this._oldElement.layer!=this.element.layer&&(this.node.parent=this.adapter.scrollManager.getLayerNode(this.element.layer),this._oldElement.layer=this.element.layer),(this._oldElement.wrapAfterMode!=this.element.wrapAfterMode||this._oldElement.wrapBeforeMode!=this.element.wrapBeforeMode||this._oldElement.ignoreLayout!=this.element.ignoreLayout||this.element.ignoreLayout&&this._oldElement.placeholder!=this.element.placeholder)&&(this.adapter.viewManager.internal_updateVisibleView(this.model.index),this._oldElement.wrapAfterMode=this.element.wrapAfterMode,this._oldElement.wrapBeforeMode=this.element.wrapBeforeMode,this._oldElement.ignoreLayout=this.element.ignoreLayout,this._oldElement.placeholder=this.element.placeholder)},e._updateHandler=function(){this._model.update=function(){},this.onVisible(),this._model.update=this._updateHandler.bind(this)},e.internal_disable=function(){this.adapter.scrollManager.internal_disableTouchTarget(this.node),this.onDisable(),this._unregister(),this._model.update=function(){},this._model.element.update=function(){},this._view=null,this._model=null,this._fixedIndex=-1,this._isLayout=!1,this._oldData=null,this.node.active=!1},e.internal_layout=function(){var t={x:this.model.size.x,y:this.model.size.y};this.adapter.layoutManager.isControlMainAxisSize&&(t[this.adapter.mainAxis]=this.model.layoutSize[this.adapter.mainAxis]),this.adapter.layoutManager.isControlCrossAxisSize&&(t[this.adapter.crossAxis]=this.model.layoutSize[this.adapter.crossAxis]),this._isLayout=!0,this.transform.setContentSize(t.x,t.y),this._isLayout=!1,this.node.setPosition(this.model.position.x,this.model.position.y)},e._register=function(){this.node.on(c.EventType.SIZE_CHANGED,this._onSizeChanged,this),this.node.on(c.EventType.TRANSFORM_CHANGED,this._onScaleChanged,this),this.node.on(c.EventType.ANCHOR_CHANGED,this._onAnchorPointChanged,this),this._adapter.modelManager.on(Zs.Event.ON_UPDATE,this._updateHandler,this)},e._unregister=function(){this.node.off(c.EventType.SIZE_CHANGED,this._onSizeChanged,this),this.node.off(c.EventType.TRANSFORM_CHANGED,this._onScaleChanged,this),this.node.off(c.EventType.ANCHOR_CHANGED,this._onAnchorPointChanged,this),this._adapter.modelManager.off(Zs.Event.ON_UPDATE,this._updateHandler,this)},e._onSizeChanged=function(){if(!this._isLayout){var t=ks.approximately(this.model.size[this.adapter.mainAxis],this.transform.contentSize[this.adapter.mainAxis]),e=ks.approximately(this.model.size[this.adapter.crossAxis],this.transform.contentSize[this.adapter.crossAxis]);this.model.size.x=this.transform.width,this.model.size.y=this.transform.height,t&&e||this.view.internal_holderChanged(t)}},e._onScaleChanged=function(t){if(t==c.TransformBit.SCALE&&(this.adapter.layoutManager.controlScaleWidth||this.adapter.layoutManager.controlScaleHeight)){var e=ks.approximately(this.model.scale[this.adapter.mainAxis],this.node.scale[this.adapter.mainAxis]),i=ks.approximately(this.model.scale[this.adapter.crossAxis],this.node.scale[this.adapter.crossAxis]);this.model.scale.x=this.node.scale.x,this.model.scale.y=this.node.scale.y,e&&i||this.view.internal_holderChanged(e)}},e._onAnchorPointChanged=function(){var t=ks.approximately(this.model.anchorPoint[this.adapter.mainAxis],this.transform.anchorPoint[this.adapter.mainAxis]),e=ks.approximately(this.model.anchorPoint[this.adapter.crossAxis],this.transform.anchorPoint[this.adapter.crossAxis]);this.model.anchorPoint.x=this.transform.anchorPoint.x,this.model.anchorPoint.y=this.transform.anchorPoint.y,t&&e||this.view.internal_holderChanged(t)},xt(t,[{key:"node",get:function(){return this._node}},{key:"transform",get:function(){return this._transform}},{key:"code",get:function(){return this._code}},{key:"adapter",get:function(){return this._adapter}},{key:"model",get:function(){return this._model}},{key:"view",get:function(){return this._view}},{key:"data",get:function(){return this._model&&this._model.data}},{key:"fixedIndex",get:function(){return this._fixedIndex}},{key:"oldData",get:function(){return this._oldData}},{key:"element",get:function(){return this._model&&this._model.element}},{key:"index",get:function(){return this._model&&this._model.index}}]),t}())||Gs);t._RF.pop(),t._RF.push({},"a66bdQHmTxEUris3Jx+UGmB","debug",void 0);var Ks,Xs,Js,Qs,$s,tl,el,il,nl,rl,ol,al,sl,ll,cl,ul,hl,pl,dl,fl,gl,ml,vl,yl,bl;new X(238,124,55,255),new X(88,175,64,50),new X(56,120,94,255);t._RF.pop(),t._RF.push({},"9a8caWSYQZLqr6N7OEAXSa7","LayoutManager",void 0);var _l,Sl=e.ccclass,wl=e.property,Tl=function(t){return t[t.ON_LAYOUT_COMPLATED=0]="ON_LAYOUT_COMPLATED",t[t.ON_CHANGED_LAYOUT_STATE=1]="ON_CHANGED_LAYOUT_STATE",t}(Tl||{}),El=(Ks=Sl("LayoutManager"),Xs=wl({type:Cs}),Js=wl({type:Cs,tooltip:"布局元素的对齐方式"}),Qs=wl({tooltip:"元素交叉轴布局的间距"}),$s=wl({tooltip:"反转布局"}),tl=wl({tooltip:"延迟布局，开启后会统一在下一帧布局，建议开启"}),el=wl({group:{id:"0",name:"forceExpand"},tooltip:"是否强制布局元素宽度扩展以填充额外的可用空间"}),il=wl({group:{id:"0",name:"forceExpand"},tooltip:"是否强制布局元素高度扩展以填充额外的可用空间"}),nl=wl({group:{id:"0",name:"controlSize"},tooltip:"如果设置为 false，布局只会影响元素的位置，而不会影响宽度，在这种情况下你可以设置元素的宽度\n如果设置为 true，元素的宽度将由布局根据它们各自的 IElement.minSize、IElement.preferredSize、IElement.flexibleSize自动设置。如果元素的宽度应根据可用空间的大小而变化，应开启此功能。在这种情况下不能直接设置每个元素的宽度，但可以通过控制每个元素的IElement.minSize、IElement.preferredSize、IElement.flexibleSize来进行控制"}),rl=wl({group:{id:"0",name:"controlSize"},tooltip:"如果设置为 false，布局只会影响元素的位置，而不会影响高度，在这种情况下你可以设置元素的高度\n如果设置为 true，元素的高度将由布局根据它们各自的 IElement.minSize、IElement.preferredSize、IElement.flexibleSize自动设置。如果元素的高度应根据可用空间的大小而变化，应开启此功能。在这种情况下不能直接设置每个元素的高度，但可以通过控制每个元素的IElement.minSize、IElement.preferredSize、IElement.flexibleSize来进行控制"}),ol=wl({group:{id:"0",name:"controlScale"},tooltip:"是否使用 x 缩放计算宽度"}),al=wl({group:{id:"0",name:"controlScale"},tooltip:"是否使用 y 缩放计算高度"}),Ks(((bl=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return e=t.call.apply(t,[this].concat(n))||this,Nt(e,"_childAlignment",cl,Lt(e)),Nt(e,"_spacing",ul,Lt(e)),Nt(e,"_reverseArrangement",hl,Lt(e)),Nt(e,"delayLayout",pl,Lt(e)),Nt(e,"_forceExpandWidth",dl,Lt(e)),Nt(e,"_forceExpandHeight",fl,Lt(e)),Nt(e,"_controlSizeWidth",gl,Lt(e)),Nt(e,"_controlSizeHeight",ml,Lt(e)),Nt(e,"_controlScaleWidth",vl,Lt(e)),Nt(e,"_controlScaleHeight",yl,Lt(e)),e._isDirty=!1,e._layoutQueue=[],e}It(e,t);var i=e.prototype;return i.onInit=function(){},i.layout=function(t){t&&(this.delayLayout?(this.unLayout(t.index),this._layoutQueue.push(t),this._isDirty=!0):(this._layoutHandler(t),this.emit(Tl.ON_LAYOUT_COMPLATED,[t.index])))},i.unLayout=function(t){-1!=(t=this._layoutQueue.findIndex((function(e){return e.index==t})))&&this._layoutQueue.splice(t,1)},i._layoutHandler=function(t){this._calcAlongAxis(t,ys.Horizontal,this.adapter.isHorizontal),this._setChildrenAlongAxis(t,ys.Horizontal,this.adapter.isHorizontal),this._calcAlongAxis(t,ys.Vertical,this.adapter.isHorizontal),this._setChildrenAlongAxis(t,ys.Vertical,this.adapter.isHorizontal)},i._calcAlongAxis=function(t,e,i){for(var n=e==ys.Horizontal?this.horizontal:this.vertical,r=this._getControlSize(e),o=this._getControlScale(e),a=this._getForceExpandSize(e),s=n,l=n,c=0,u=i!=(e==ys.Vertical),h=this._getLayoutList(t.models),p=0;p<h.length;p++){var d=h[p],f=this._getChildSizes(d,e,r,a),g=f.min,m=f.preferred,v=f.flexible;if(o){var y=d.scale[this._getAxis(e)];g*=y,m*=y,v*=y}u?(s=Math.max(g+n,s),l=Math.max(m+n,l),c=Math.max(v,c)):(s+=g+this.spacing,l+=m+this.spacing,c+=v)}!u&&h.length>0&&(s-=this.spacing,l-=this.spacing),l=Math.max(s,l),this._setLayoutInputForAxis(t,s,l,c,e)},i._getControlSize=function(t){return t==ys.Horizontal?this.controlSizeWidth:this.controlSizeHeight},i._getControlScale=function(t){return t==ys.Horizontal?this.controlScaleWidth:this.controlScaleHeight},i._getForceExpandSize=function(t){return t==ys.Horizontal?this.forceExpandWidth:this.forceExpandHeight},i._setChildrenAlongAxis=function(t,e,i){var n=t.size[this._getAxis(e)],r=this._getControlSize(e),o=this._getControlScale(e),a=this._getForceExpandSize(e),s=this._getAlignmentOnAxis(e),l=this._getLayoutList(t.models),c=i!=(e==ys.Vertical),u=this.reverseArrangement?l.length-1:0,h=this.reverseArrangement?0:l.length,p=this.reverseArrangement?-1:1,d=this._getAxis(e);if(c)for(var f=n-(e==ys.Horizontal?this.horizontal:this.vertical),g=u;this.reverseArrangement?g>=h:g<h;g+=p){var m=l[g],v=this._getChildSizes(m,e,r,a),y=v.min,b=v.preferred,_=v.flexible,S=o?m.scale[d]:1,w=ks.clamp(f,y,_>0?n:b),T=this._getStartOffset(t,e,w*S);if(r)this._setChildAlongAxisWithScale(t,m,e,T,S,w);else{var E=(w-m.size[d])*s;E*=S,this._setChildAlongAxisWithScale(t,m,e,T+E,S)}}else{var A=e==ys.Horizontal?this.left:this.top,C=0,P=n-this._getTotalPreferredSize(t,e);P>0&&(0==this._getTotalFlexibleSize(t,e)?A=this._getStartOffset(t,e,this._getTotalPreferredSize(t,e)-(e==ys.Horizontal?this.horizontal:this.vertical)):this._getTotalFlexibleSize(t,e)>0&&(C=P/this._getTotalFlexibleSize(t,e)));var M=0;this._getTotalMinSize(t,e)!=this._getTotalPreferredSize(t,e)&&(M=ks.clamp01((n-this._getTotalMinSize(t,e))/(this._getTotalPreferredSize(t,e)-this._getTotalMinSize(t,e))));for(g=u;this.reverseArrangement?g>=h:g<h;g+=p){var I=l[g],N=this._getChildSizes(I,e,r,a),L=(y=N.min,b=N.preferred,_=N.flexible,o?I.scale[d]:1),O=ks.lerp(y,b,M);if(O+=_*C,r)this._setChildAlongAxisWithScale(t,I,e,A,L,O);else{E=(O-I.size[d])*s;this._setChildAlongAxisWithScale(t,I,e,A+E,L)}A+=O*L+this.spacing}}},i._setChildAlongAxisWithScale=function(t,e,i,n,r,o){if(null!=e){var a=this._getAxis(i),s=0;isNaN(o)?s=e.size[a]:(e.layoutSize[a]=o,s=o);var l={x:e.position.x,y:e.position.y},c=0;i==ys.Horizontal?(c=n+s*e.anchorPoint[a]*r,c-=t.size[a]*t.anchorPoint[a],c+=t.position[a]):(c=-n-s*(1-e.anchorPoint[a])*r,c+=t.size[a]*(1-t.anchorPoint[a]),c+=t.position[a]),l[a]=c,e.position=l}},i._getStartOffset=function(t,e,i){var n=i+(e==ys.Horizontal?this.horizontal:this.vertical),r=t.size[this._getAxis(e)]-n,o=this._getAlignmentOnAxis(e);return(e==ys.Horizontal?this.left:this.top)+r*o},i._setLayoutInputForAxis=function(t,e,i,n,r){var o=this._getAxis(r);t.totalMinSize[o]=e,t.totalPreferredSize[o]=i,t.totalFlexibleSize[o]=n},i._getAxis=function(t){return t==ys.Horizontal?"x":"y"},i._getMinSize=function(t,e){return t.minSize[this._getAxis(e)]},i._getPreferredSize=function(t,e){var i=this._getAxis(e);return Math.max(t.minSize[i],t.preferredSize[i])},i._getFlexibleSize=function(t,e){return t.flexibleSize[this._getAxis(e)]},i._getTotalMinSize=function(t,e){return t.totalMinSize[this._getAxis(e)]},i._getTotalPreferredSize=function(t,e){return t.totalPreferredSize[this._getAxis(e)]},i._getTotalFlexibleSize=function(t,e){return t.totalFlexibleSize[this._getAxis(e)]},i._getChildSizes=function(t,e,i,n){var r,o,a;return i?(r=this._getMinSize(t.element,e),o=this._getPreferredSize(t.element,e),a=this._getFlexibleSize(t.element,e)):(o=r=t.size[this._getAxis(e)],a=0),n&&(a=Math.max(a,1)),{min:r,preferred:o,flexible:a}},i._getAlignmentOnAxis=function(t){return t==ys.Horizontal?this.adapter.layoutManager.childAlignment%3*.5:.5*Math.floor(this.adapter.layoutManager.childAlignment/3)},i._getLayoutList=function(t){for(var e=[],i=0;i<t.length;i++){var n=t[i];n.element.ignoreLayout||e.push(n)}return e},i.internal_lateUpdate=function(t){if(this._isDirty){this._isDirty=!1;for(var e=[];this._layoutQueue.length>0;){var i=this._layoutQueue.shift();this._layoutHandler(i),e.push(i.index)}e.length>0&&this.emit(Tl.ON_LAYOUT_COMPLATED,e)}},xt(e,[{key:"childAlignment",get:function(){return this._childAlignment},set:function(t){t!=this._childAlignment&&(this._childAlignment=t,this.emit(Tl.ON_CHANGED_LAYOUT_STATE))}},{key:"spacing",get:function(){return this._spacing},set:function(t){t!=this._spacing&&(this._spacing=t,this.emit(Tl.ON_CHANGED_LAYOUT_STATE))}},{key:"reverseArrangement",get:function(){return this._reverseArrangement},set:function(t){t!=this._reverseArrangement&&(this._reverseArrangement=t,this.emit(Tl.ON_CHANGED_LAYOUT_STATE))}},{key:"forceExpandWidth",get:function(){return this._forceExpandWidth},set:function(t){t!=this._forceExpandWidth&&(this._forceExpandWidth=t,this.emit(Tl.ON_CHANGED_LAYOUT_STATE))}},{key:"forceExpandHeight",get:function(){return this._forceExpandHeight},set:function(t){t!=this._forceExpandHeight&&(this._forceExpandHeight=t,this.emit(Tl.ON_CHANGED_LAYOUT_STATE))}},{key:"controlSizeWidth",get:function(){return this._controlSizeWidth},set:function(t){t!=this._controlSizeWidth&&(this._controlSizeWidth=t,this.emit(Tl.ON_CHANGED_LAYOUT_STATE))}},{key:"controlSizeHeight",get:function(){return this._controlSizeHeight},set:function(t){t!=this._controlSizeHeight&&(this._controlSizeHeight=t,this.emit(Tl.ON_CHANGED_LAYOUT_STATE))}},{key:"controlScaleWidth",get:function(){return this._controlScaleWidth},set:function(t){t!=this._controlScaleWidth&&(this._controlScaleWidth=t,this.emit(Tl.ON_CHANGED_LAYOUT_STATE))}},{key:"controlScaleHeight",get:function(){return this._controlScaleHeight},set:function(t){t!=this._controlScaleHeight&&(this._controlScaleHeight=t,this.emit(Tl.ON_CHANGED_LAYOUT_STATE))}},{key:"top",get:function(){return this.adapter.isVertical?0:this.adapter.viewManager.top}},{key:"bottom",get:function(){return this.adapter.isVertical?0:this.adapter.viewManager.bottom}},{key:"left",get:function(){return this.adapter.isHorizontal?0:this.adapter.viewManager.left}},{key:"right",get:function(){return this.adapter.isHorizontal?0:this.adapter.viewManager.right}},{key:"horizontal",get:function(){return this.left+this.right}},{key:"vertical",get:function(){return this.top+this.bottom}},{key:"isControlMainAxisSize",get:function(){return this.adapter.isHorizontal&&this.controlSizeWidth||this.adapter.isVertical&&this.controlSizeHeight}},{key:"isControlCrossAxisSize",get:function(){return this.adapter.isHorizontal&&this.controlSizeHeight||this.adapter.isVertical&&this.controlSizeWidth}},{key:"isControlCrossAxisScale",get:function(){return this.adapter.isHorizontal&&this.controlScaleHeight||this.adapter.isVertical&&this.controlScaleWidth}}]),e}(Us)).Event=Tl,cl=Mt((ll=bl).prototype,"_childAlignment",[Xs],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Cs.UpperLeft}}),Mt(ll.prototype,"childAlignment",[Js],Object.getOwnPropertyDescriptor(ll.prototype,"childAlignment"),ll.prototype),ul=Mt(ll.prototype,"_spacing",[wl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Mt(ll.prototype,"spacing",[Qs],Object.getOwnPropertyDescriptor(ll.prototype,"spacing"),ll.prototype),hl=Mt(ll.prototype,"_reverseArrangement",[wl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Mt(ll.prototype,"reverseArrangement",[$s],Object.getOwnPropertyDescriptor(ll.prototype,"reverseArrangement"),ll.prototype),pl=Mt(ll.prototype,"delayLayout",[tl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),dl=Mt(ll.prototype,"_forceExpandWidth",[wl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Mt(ll.prototype,"forceExpandWidth",[el],Object.getOwnPropertyDescriptor(ll.prototype,"forceExpandWidth"),ll.prototype),fl=Mt(ll.prototype,"_forceExpandHeight",[wl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Mt(ll.prototype,"forceExpandHeight",[il],Object.getOwnPropertyDescriptor(ll.prototype,"forceExpandHeight"),ll.prototype),gl=Mt(ll.prototype,"_controlSizeWidth",[wl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Mt(ll.prototype,"controlSizeWidth",[nl],Object.getOwnPropertyDescriptor(ll.prototype,"controlSizeWidth"),ll.prototype),ml=Mt(ll.prototype,"_controlSizeHeight",[wl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Mt(ll.prototype,"controlSizeHeight",[rl],Object.getOwnPropertyDescriptor(ll.prototype,"controlSizeHeight"),ll.prototype),vl=Mt(ll.prototype,"_controlScaleWidth",[wl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Mt(ll.prototype,"controlScaleWidth",[ol],Object.getOwnPropertyDescriptor(ll.prototype,"controlScaleWidth"),ll.prototype),yl=Mt(ll.prototype,"_controlScaleHeight",[wl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Mt(ll.prototype,"controlScaleHeight",[al],Object.getOwnPropertyDescriptor(ll.prototype,"controlScaleHeight"),ll.prototype),sl=ll))||sl);t._RF.pop(),t._RF.push({},"2de05BThzdKpKfaXzu3wLES","View",void 0);var Al,Cl,Pl,Ml,Il,Nl,Ll,Ol,Rl,xl,Fl,Dl,zl,kl,Vl,Bl,Hl,Ul,Gl,Wl,ql,Zl,Yl,jl,Kl,Xl,Jl,Ql,$l,tc,ec,ic,nc,rc,oc,ac=e.ccclass,sc=(e.property,ac("View")(_l=function(){function t(t){this.__debug_graphics=void 0,this._adapter=void 0,this._total=0,this._innerSize=0,this._group=null,this._holderList=[],this._tempHolderList=[],this._isOverflowFixed=void 0,this._adapter=t,this.internal_reset(),this.__createDebug()}var e=t.prototype;return e.__createDebug=function(){},e.__drawDebug=function(){if(this.__debug_graphics&&this.group){this.__debug_graphics.clear();var t=this.adapter.mainAxis,e=this.adapter.crossAxis,i={x:0,y:0},n={x:this.group.size.x,y:this.group.size.y},r={x:this.group.anchorPoint.x,y:this.group.anchorPoint.y};i[t]=this.group.position[t]-n[t]*r[t],i[t]+=1.5,i[e]=this.group.position[e]-n[e]*(1-r[e]),i[e]+=1.5,n[t]-=3,n[e]-=3,this.__debug_graphics.roundRect(i.x,i.y,n.x,n.y,2),this.__debug_graphics.stroke()}},e.getFixedHolders=function(){if(!this.group.isFixed)return[];for(var t=[],e=this.holderList.length,i=0;i<e;i++){var n=this.holderList[i];n.model.element.fixed&&t.push(n)}return t},e.internal_isWrap=function(t,e){var i=!1,n=e&&e.models[e.models.length-1];if(n)switch(t.element.wrapBeforeMode){case Ts.Wrap:i=!0;break;case Ts.Nowrap:i=n.element.wrapAfterMode==Ts.Wrap;break;case Ts.Auto:(i=n.element.wrapAfterMode==Ts.Wrap)||(i=this._calculateInnerSize(t,e))}return i},e.internal_reset=function(){this._group=null,this._innerSize=0,this._total=0,this._holderList.length=0,this._isOverflowFixed=!0,this._tempHolderList.length=0,this.__debug_graphics&&this.__debug_graphics.clear()},e.internal_push=function(t){this._total++;var e=this.adapter.crossAxis;(!t.element.ignoreLayout||t.element.ignoreLayout&&t.element.placeholder)&&(0!=this._innerSize&&(this._innerSize+=this.adapter.layoutManager.spacing),this._innerSize+=t.size[e])},e.internal_recycleHolders=function(t){for(var e=0;e<this._holderList.length;e++){var i=this._holderList[e];i.internal_disable(),t(i)}this._holderList.length=0},e.internal_preVisible=function(t,e){return this._group=t,this._createHolders(e),this},e.internal_visible=function(){this.register();for(var t=0;t<this._tempHolderList.length;t++){var e=this._tempHolderList[t],i=e.holder,n=e.model,r=e.isNew;i.internal_visible(this,n,r)}this._tempHolderList.length=0,this.adapter.layoutManager.layout(this.group),this.onVisible()},e.internal_disable=function(){this.adapter.layoutManager.unLayout(this.index),this.unregister(),this.onDisable(),this.internal_reset()},e.internal_holderChanged=function(t){var e=!0,i=this.adapter.mainAxis,n=this.group.size[i];if(!t){for(var r=0,o=0;o<this.group.models.length;o++){var a=this.group.models[o],s=a.size[i];(this.adapter.isVertical&&this.adapter.layoutManager.controlScaleHeight||this.adapter.isHorizontal&&this.adapter.layoutManager.controlScaleWidth)&&(s*=a.scale[i]),r=Math.max(r,s)}ks.approximately(this.group.size[i],r)||(this.group.oldSize[i]=this.group.size[i],this.group.size[i]=r,e=!1)}e?this.adapter.layoutManager.layout(this.group):this.adapter.viewManager.internal_viewChanged(this,n)},e.register=function(){this.adapter.viewManager.on(Uc.Event.ON_SCROLL,this._onScroll,this),this.adapter.viewManager.on(Uc.Event.ON_LATEUPDATE,this._onLateUpdate,this),this.adapter.layoutManager.on(El.Event.ON_LAYOUT_COMPLATED,this._onLayoutComplated,this),this.adapter.layoutManager.on(El.Event.ON_CHANGED_LAYOUT_STATE,this._onChangedLayoutState,this)},e.unregister=function(){this.adapter.viewManager.off(Uc.Event.ON_SCROLL,this._onScroll,this),this.adapter.viewManager.off(Uc.Event.ON_LATEUPDATE,this._onLateUpdate,this),this.adapter.layoutManager.off(El.Event.ON_LAYOUT_COMPLATED,this._onLayoutComplated,this),this.adapter.layoutManager.off(El.Event.ON_CHANGED_LAYOUT_STATE,this._onChangedLayoutState,this)},e._createHolders=function(t){var e=this.adapter.mainAxis;this._tempHolderList.length=0;for(var i=0;i<this.group.models.length;i++){var n=this.group.models[i],r=!1,o=t&&t(n);o||(o=this.adapter.viewManager.internal_getHolder(n),r=!0),n.position[e]=this.group.position[e],this._holderList.push(o),this._tempHolderList.push({holder:o,model:n,isNew:r})}},e._calculateInnerSize=function(t,e){if(0==this._total)return!1;var i=t.size[this.adapter.crossAxis];return this._innerSize+i+this.adapter.layoutManager.spacing>e.size[this.adapter.crossAxis]},e._onLayoutComplated=function(t){if(-1!=t.indexOf(this.index)){for(var e=0;e<this.holderList.length;e++){this.holderList[e].internal_layout()}this.group.isFixed&&this._calcFixedPosition()}},e._calcFixedPosition=function(){for(var t=this._holderList.length,e=this.adapter.mainAxis,i=0;i<t;i++){var n=this._holderList[i];if(n.element.fixed){var r={x:n.model.position.x,y:n.model.position.y},o=0,a=this._getModelBoundary(n.model);if(this._isNeedFixed(a)){r[e]-=a;var s=this.adapter.viewManager.getNextFixedHolders(this.index);o=this._getRelativeNextHolderOffset(n,s)}r[e]+=o*this.adapter.multiplier,r[e]!=n.node.position[e]&&n.node.setPosition(r.x,r.y)}}},e._onChangedLayoutState=function(){this.adapter.layoutManager.layout(this.group)},e._onScroll=function(){this.group.isFixed&&0!=this._holderList.length&&this._calcFixedPosition()},e._onLateUpdate=function(t){},e._isNeedFixed=function(t){return 1==this.adapter.multiplier?t>=0:t<=0},e._getModelBoundary=function(t){var e=ks.isNumber(t.element.fixedOffset)?t.element.fixedOffset:0;return 1==this.adapter.multiplier?this._getModelHeaderBoundary(t)+e:this._getModelFooterBoundary(t)-e},e._getModelHeaderBoundary=function(t){var e=this.adapter.mainAxis;return t.position[e]+t.size[e]*(1-t.anchorPoint[e])*t.scale[e]+this.adapter.scrollManager.contentPosition},e._getModelFooterBoundary=function(t){var e=this.adapter.mainAxis;return t.position[e]-t.size[e]*t.anchorPoint[e]*t.scale[e]+this.adapter.scrollManager.contentPosition},e._getModelSizeWithSpacing=function(t){var e=this.adapter.mainAxis,i=ks.isNumber(t.element.fixedOffset)?t.element.fixedOffset:0,n=ks.isNumber(t.element.fixedSpacing)?t.element.fixedSpacing:this.adapter.viewManager.spacing;return t.size[e]*t.scale[e]+i+n},e._getReatureRelativeBoundary=function(t,e){var i=1==this.adapter.multiplier?this._getModelHeaderBoundary(t):this._getModelFooterBoundary(t),n=1==this.adapter.multiplier?i+e:e-i;return Math.min(n,e)},e._getRelativeNextHolderOffset=function(t,e){for(var i=e.length,n=this.adapter.crossAxis,r=this._getModelSizeWithSpacing(t.model),o=0,a=0;a<i;a++){var s=e[a],l=this._getReatureRelativeBoundary(s.model,r),c=t.model.scale[n]==s.model.scale[n],u=t.model.size[n]==s.model.size[n];if(t.fixedIndex==s.fixedIndex&&c&&u){o=l>0?l:0;break}l>0&&(o=Math.max(o,l))}return o},xt(t,[{key:"isOverflowFixed",get:function(){return this._isOverflowFixed}},{key:"adapter",get:function(){return this._adapter}},{key:"group",get:function(){return this._group}},{key:"holderList",get:function(){return this._holderList}},{key:"index",get:function(){return this.group?this.group.index:-1}}]),t}())||_l);t._RF.pop(),t._RF.push({},"f2204qKI49MuZnaH/naH4DF","ViewManager",void 0);var lc,uc,hc,pc,dc,fc,gc,mc,vc,yc,bc,_c,Sc,wc,Tc,Ec,Ac,Cc,Pc,Mc,Ic,Nc,Lc,Oc,Rc,xc,Fc,Dc,zc,kc,Vc=e.ccclass,Bc=e.property,Hc=function(t){return t[t.ON_SCROLL=0]="ON_SCROLL",t[t.ON_LATEUPDATE=1]="ON_LATEUPDATE",t[t.ON_CLEARVIEWS=2]="ON_CLEARVIEWS",t[t.ON_UPDATE_VIEWS=3]="ON_UPDATE_VIEWS",t[t.ON_CHANGED_VIRTUALSIZE=4]="ON_CHANGED_VIRTUALSIZE",t[t.ON_MAGNETIC=5]="ON_MAGNETIC",t[t.ON_CHANGED_OVERFLOWHEADER=6]="ON_CHANGED_OVERFLOWHEADER",t[t.ON_RESET_ALL_STATE=7]="ON_RESET_ALL_STATE",t[t.ON_CHANGED_SPACING=8]="ON_CHANGED_SPACING",t}(Hc||{}),Uc=(Al=Vc("ViewManager"),Cl=Bc({type:_s}),Pl=Bc({type:_s,tooltip:"主轴方向的排列方式\n        Start: 从上到下、从左到右\n        End: 从下到上、从右到左"}),Ml=Bc({type:Ss,tooltip:"当元素的尺寸、缩放改变时，受影响的其他元素应该如何计算新的位置\n        Auto: 以可视区域中心为起点，所有其他元素向两边延伸\n        Center: 以当前变化的元素为起点，所有其他元素向两边延伸\n        Header: 以当前变化的元素和它头部的所有元素向头部延伸\n        Footer: 以当前变化的元素和它尾部的所有元素向尾部延伸"}),Il=Bc({range:[0,1],slide:!0,step:.01,tooltip:"当元素移动到可视区域外偏移多少时才进行回收\n        比如元素的尺寸为100，当元素超出可视范围 100+100*0.3 时就会被回收\n        没有特殊需求时，默认值即可"}),Nl=Bc({range:[0,1],slide:!0,step:.01,tooltip:"此值会影响填充元素的时机\n        没有特殊需求时，默认值即可"}),Ll=Bc({tooltip:"主轴方向元素的间隙"}),Ol=Bc({group:{id:"padding",name:"padding"}}),Rl=Bc({group:{id:"padding",name:"padding"}}),xl=Bc({group:{id:"padding",name:"padding"}}),Fl=Bc({group:{id:"padding",name:"padding"}}),Dl=Bc({tooltip:"磁性停靠\n        开启后，会在增加数据时，根据设置进行自动滚动到顶部或底部"}),zl=Bc({type:As,visible:function(){return this.magnetic},tooltip:"停靠的方向"}),kl=Bc({visible:function(){return this.magnetic},tooltip:"停靠动画的时长"}),Vl=Bc({visible:function(){return this.magnetic},tooltip:"默认情况下，仅当添加数据时才会触发停靠\n        当开启时，元素的尺寸改变时,也会否触发停靠"}),Bl=Bc({tooltip:"头部循环"}),Hl=Bc({tooltip:"尾部循环"}),Al(((oc=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return e=t.call.apply(t,[this].concat(n))||this,Nt(e,"_arrangeAxis",Wl,Lt(e)),Nt(e,"stretchDirection",ql,Lt(e)),Nt(e,"overflowOffset",Zl,Lt(e)),Nt(e,"enterOffset",Yl,Lt(e)),Nt(e,"_spacing",jl,Lt(e)),Nt(e,"left",Kl,Lt(e)),Nt(e,"right",Xl,Lt(e)),Nt(e,"top",Jl,Lt(e)),Nt(e,"bottom",Ql,Lt(e)),Nt(e,"magnetic",$l,Lt(e)),Nt(e,"magneticDirection",tc,Lt(e)),Nt(e,"magneticDuration",ec,Lt(e)),Nt(e,"magneticSizeChanges",ic,Lt(e)),Nt(e,"loopHeader",nc,Lt(e)),Nt(e,"loopFooter",rc,Lt(e)),e._groupLength=0,e._cacheGroups=[],e._groups=[],e._disableViews=[],e._visibleViews=[],e._fixedViews=[],e._disableHolders=[],e._isFill=!1,e._headerIndex=-1,e._footerIndex=-1,e._virtualSize=0,e._overflowHeader=0,e._cacheHeadeDatas=[],e._cacheHeadePosition=void 0,e}It(e,t);var i=e.prototype;return i.onInit=function(){this.adapter.modelManager.on(Zs.Event.ON_CHANGE_BEFORE,this._onModelChangeBefore,this),this.adapter.modelManager.on(Zs.Event.ON_INSERT,this._updateGroups,this),this.adapter.modelManager.on(Zs.Event.ON_REMOVE,this._updateGroups,this),this.adapter.modelManager.on(Zs.Event.ON_MOVE,this._updateGroups,this),this.adapter.modelManager.on(Zs.Event.ON_CLEAR,this._onClearModel,this),this.adapter.scrollManager.on(ou.Event.ON_SCROLL,this._onScroll,this),this.adapter.scrollManager.on(ou.Event.ON_VIEW_SIZE_CHANGED,this._resetAllState,this),this.adapter.scrollManager.on(ou.Event.ON_CHANGED_ORIENTATION,this._resetAllState,this)},i._clearAll=function(){for(var t,e=0,i=this._visibleViews.length;e<i;e++)this._recycleViewToDisableViews(this._visibleViews[e]);(t=this._cacheGroups).push.apply(t,this._groups),this._clearFixedViews(),this._visibleViews.length=0,this._groups.length=0,this.virtualSize=0,this.overflowHeader=0},i._onClearModel=function(){this._clearAll(),this.emit(Hc.ON_CLEARVIEWS)},i._resetAllState=function(){this._clearAll(),this.internal_updateVisibleView(0),this.emit(Hc.ON_RESET_ALL_STATE)},i._onModelChangeBefore=function(){if(this.header&&this.virtualSize>this.adapter.mainAxisSize){var t=this.getVisibleIndexByGroupIndex(0);if(-1!=t){var e=this._visibleViews[t];this._cacheHeadeDatas=e.group.models.map((function(t){return t.data})),this._cacheHeadePosition={x:e.group.position.x,y:e.group.position.y}}else this._cacheHeadeDatas=this.header.group.models.map((function(t){return t.data})),this._cacheHeadePosition={x:this.header.group.position.x,y:this.header.group.position.y}}},i._updateGroups=function(t){var e,i=this,n=this._getViewFromDisibleViews(null),r=this.getGroupIndexByModelIndex(t);-1==r&&(r=this._groupLength-1);var o=null,a=!1,s={modelIndex:t,fixedIndex:-1},l=this._groups[r-1];for(l&&(s.fixedIndex=l.fixedIndex);;){(o=this._groups[r])||((o=this._getGroupFromCache()).internal_setIndex(this._groups.length),this._groups.push(o),r=this._groups.length);var c=o.internal_insert(s,n,a);if(r++,a=!0,!c)break}var u=this._groups.splice(r,this._groups.length);(e=this._cacheGroups).push.apply(e,u),this._groupLength=this._groups.length;var h=-1,p=0;this._cacheHeadeDatas.length>0&&(h=this._groups.findIndex((function(t){return t.internal_includes(i._cacheHeadeDatas)})));var d=this._groups[h];d&&(p+=d.size[this.adapter.mainAxis]+this.spacing,d.internal_setPosition(this._cacheHeadePosition[this.adapter.mainAxis]));for(var f=h-1;f>=0;f--){var g=this._groups[f];this._calcMainAxisPosition(g,d,As.Header),p+=g.size[this.adapter.mainAxis]+this.spacing,d=g}d=this._groups[h];for(var m=h+1;m<this.groupLength;m++){g=this._groups[m];this._calcMainAxisPosition(g,d,As.Footer),p+=g.size[this.adapter.mainAxis]+this.spacing,d=g}p-=this.spacing,this._virtualSize=Math.max(0,p),this._resetOverflowHeader(this._groups[0]),n.internal_reset(),this._disableViews.push(n),this.updateVisibles(h),this._cacheHeadeDatas=[],this._cacheHeadePosition=null},i.updateVisibles=function(t){var e=[];t=Math.max(0,t);for(var i=function(t){var i=e.findIndex((function(e){return e.oldData==t.data}));return-1!=i?e.splice(i,1)[0]:null},n=0;n<this._visibleViews.length;n++){var r=this._visibleViews[n];e=e.concat(r.holderList),r.internal_reset()}for(var o=this.adapter.mainAxisSize,a=0,s=this.visibleLength,l=t,c=this._groups.length;l<c;l++){var u=this._groups[l];if(this.getVisibleMainAxisSize()>=o&&s<=0)break;(p=this._visibleViews[a++])||(p=this._getViewFromDisibleViews(u.index),this._visibleViews.push(p)),p.internal_preVisible(u,i),s--}for(var h=this._visibleViews.length-1;h>=0;h--){var p;if((p=this._visibleViews[h]).holderList.length>0)break;this._disableFromVisibleViews(h)}for(var d=0,f=e.length;d<f;d++){var g=e[d];g.internal_disable(),this._disableHolders.push(g)}for(var m=0;m<this.visibleLength;m++)this._visibleViews[m].internal_visible();this._forceFill(),this._calcMagnetic(),this.emit(Hc.ON_UPDATE_VIEWS)},i._getGroupFromCache=function(){var t=this._cacheGroups.pop();return t||(t=new Ds(this.adapter)),t.internal_reset(),t},i._calcMagnetic=function(){if(this.magnetic&&this.header){var t=!1;0==this.adapter.scrollManager.velocity&&(this.magneticDirection==As.Footer?this.footer.index==this._groupLength-1&&(this.adapter.scrollManager.scrollToFooter(this.magneticDuration),t=!0):0==this.header.index&&(this.adapter.scrollManager.scrollToHeader(this.magneticDuration),t=!0)),this.emit(Hc.ON_MAGNETIC,t)}},i._calcMainAxisPosition=function(t,e,i){if(t)if(e){var n,r,o=this.adapter.mainAxis,a=this.adapter.multiplier,s=i==As.Footer?1:-1;i==As.Footer?(n=1==a?e.anchorPoint[o]:1-e.anchorPoint[o],r=1==a?1-t.anchorPoint[o]:t.anchorPoint[o]):(n=1==a?1-e.anchorPoint[o]:e.anchorPoint[o],r=1==a?t.anchorPoint[o]:1-t.anchorPoint[o]);var l=e.position[o];l-=e.size[o]*n*s*a,l-=this.spacing*a*s,l-=t.size[o]*r*s*a,t.internal_setPosition(l)}else t.internal_setPosition(this._getMainAxisHeaderPosition(t))},i._getMainAxisHeaderPosition=function(t){var e=0,i=0;return this.adapter.isVertical?(e=this.adapter.isArrangeAxisStart?-this.top:this.bottom,i=this.adapter.isArrangeAxisStart?1-t.anchorPoint[this.adapter.mainAxis]:t.anchorPoint[this.adapter.mainAxis]):(e=this.adapter.isArrangeAxisStart?this.left:-this.right,i=this.adapter.isArrangeAxisStart?t.anchorPoint[this.adapter.mainAxis]:1-t.anchorPoint[this.adapter.mainAxis]),e-=i*t.size[this.adapter.mainAxis]*this.adapter.multiplier},i._getViewFromDisibleViews=function(t){var e=null;if(null!=t){var i=this._fixedViews.findIndex((function(e){return e.index==t}));if(-1!=i){var n=this._fixedViews.splice(i,1)[0];this._recycleViewToDisableViews(n)}}return e||(e=this._disableViews.pop()),e||(e=this.adapter.getView()),e},i._getHolderFromDisableHolders=function(t){var e=this._disableHolders.findIndex((function(e){return e.code==t.code}));if(-1!=e)return this._disableHolders.splice(e,1)[0]},i._disableFromVisibleViews=function(t){var e=-1;e=t instanceof sc?this._visibleViews.findIndex((function(e){return e.index==t.index})):t,this._recycleViewToDisableViews(this._visibleViews[e]),this._visibleViews.splice(e,1)},i._recycleViewToDisableViews=function(t){var e=this;t&&(t.internal_recycleHolders((function(t){return e._disableHolders.push(t)})),t.internal_disable(),this._disableViews.push(t))},i._clearFixedViews=function(){for(var t=0,e=this._fixedViews.length;t<e;t++){var i=this._fixedViews[t];this._recycleViewToDisableViews(i)}this._fixedViews.length=0},i._checkHeaderInvisible=function(){this.header&&(this.loopFooter||this.footer.index!=this.groupLength-1)&&this._isOverflowHeader(this.header.group)&&(this._disableFromVisibleViews(0),this._checkHeaderInvisible())},i._checkFooterInvisible=function(){this.footer&&(this.loopHeader||0!=this.header.index)&&this._isOverflowFooter(this.footer.group)&&(this._disableFromVisibleViews(this._visibleViews.length-1),this._checkFooterInvisible())},i._isOverflowHeader=function(t,e){void 0===e&&(e=this.overflowOffset);var i=this.internal_getGroupFooterBoundary(t);return e*=t.size[this.adapter.mainAxis],1==this.adapter.multiplier?i>=e:i<=-e},i._isOverflowFooter=function(t,e){void 0===e&&(e=this.overflowOffset);var i=this.internal_getGroupHeaderBoundary(t);return e*=t.size[this.adapter.mainAxis],1==this.adapter.multiplier?i+this.adapter.mainAxisSize<=-e:i-this.adapter.mainAxisSize>=e},i._isEnterFooter=function(t){if(!t)return!1;var e=this.internal_getGroupFooterBoundary(t),i=this.enterOffset*t.size[this.adapter.mainAxis];return 1==this.adapter.multiplier?e+this.adapter.mainAxisSize+i>=0:e-this.adapter.mainAxisSize-i<=0},i._isEnterHeader=function(t){if(!t)return!1;var e=this.internal_getGroupHeaderBoundary(t),i=this.overflowOffset*t.size[this.adapter.mainAxis];return 1==this.adapter.multiplier?e-i<=0:e+i>=0},i._fillHeader=function(){var t=this._groups[this._headerIndex];if(this._isEnterHeader(t)){var e=this._accumTargetSizeTowardsHeader(t.index,this.internal_getInitHeaderSize(t)),i=e.index,n=e.size,r=this._groups[i];if(r&&-1==this.getVisibleIndexByGroupIndex(i)){var o=this.internal_convertSizeToHeaderPosition(n,r);r.internal_setPosition(o);var a=this._getViewFromDisibleViews(r.index);this._visibleViews.unshift(a),a.internal_preVisible(r).internal_visible(),0==a.index&&this._resetOverflowHeader(a.group),this._headerIndex=r.index,this._fillHeader()}}},i._fillFooter=function(){var t=this._groups[this._footerIndex];if(this._isEnterFooter(t)){var e=this._accumTargetSizeTowardsFooter(t.index,this.internal_getInitFooterSize(t)),i=e.index,n=e.size,r=this._groups[i];if(r&&-1==this.getVisibleIndexByGroupIndex(i)){var o=this.internal_convertSizeToFooterPosition(n,r);r.internal_setPosition(o);var a=this._getViewFromDisibleViews(r.index);this._visibleViews.push(a),a.internal_preVisible(r).internal_visible(),0==a.index&&this._resetOverflowHeader(a.group),this._footerIndex=r.index,this._fillFooter()}}},i._fillFixedView=function(){if(this.header&&(-1!=this.header.group.fixedIndex||this.header.group.isFixed))for(var t=this.header.index,e=this.adapter.mainAxis,i=this.internal_getInitHeaderSize(this.header.group),n=t-1;n>=0;n--){var r=this._groups[n];if(!r)return void console.error("_fillFixedView错误 找不到group",n);if(i+=r.size[e]+this.spacing,r.isFixed){var o=this.internal_convertSizeToHeaderPosition(i,r);if(-1!=this._fixedViews.findIndex((function(t){return t.index==r.index}))){ks.approximately(o,r.position[e])||(r.internal_setPosition(o),this.adapter.layoutManager.layout(r));break}this._clearFixedViews();o=this.internal_convertSizeToHeaderPosition(i,r);r.internal_setPosition(o);var a=this._getViewFromDisibleViews(r.index);a.internal_preVisible(r).internal_visible(),this._fixedViews.push(a);break}}},i._accumTargetSizeTowardsHeader=function(t,e){for(var i=this._groups.length;;){if(0==t&&this.loopHeader&&(t=i),0==t)return{index:t,size:e};if(t--,!this._groups[t])return{index:t,size:e};if((e+=this.internal_accumulationSize(t))>=0)return{index:t,size:e}}},i._accumTargetSizeTowardsFooter=function(t,e){for(var i=this._groups.length;;){if(t==i-1&&this.loopFooter&&(t=-1),t==i-1)return{index:t,size:e};if(t++,!this._groups[t])return{index:t,size:e};if((e+=this.internal_accumulationSize(t))>=0)return{index:t,size:e}}},i._fillFooterHandle=function(){this._checkHeaderInvisible(),this._fillFooter()},i._fillHeaderHandle=function(){this._checkFooterInvisible(),this._fillHeader()},i._forceFill=function(){this._updateHeaderFooterIndex(),this._fillHeaderHandle(),this._fillFooterHandle()},i._updateHeaderFooterIndex=function(){this._headerIndex=this.header?this.header.index:0,this._footerIndex=this.footer?this.footer.index:0},i._onScroll=function(t){if(0!=this._groups.length){switch(this._updateHeaderFooterIndex(),t){case Ps.Up:case Ps.Left:this.adapter.isArrangeAxisStart?this._fillFooterHandle():this._fillHeaderHandle();break;case Ps.Down:case Ps.Right:this.adapter.isArrangeAxisStart?this._fillHeaderHandle():this._fillFooterHandle()}this._fillFixedView(),this.emit(Hc.ON_SCROLL)}},i._stretchToHeader=function(t,e){for(var i=this._visibleViews[t],n=e;n>=0;n--){var r=this._visibleViews[n];i?(this._calcMainAxisPosition(r.group,i.group,As.Header),this.adapter.layoutManager.layout(r.group)):this.getVisibleMainAxisSize()<this.adapter.mainAxisSize&&this._calcMainAxisPosition(r.group,null,As.Header),i=r}},i._stretchToFooter=function(t,e){for(var i=this._visibleViews[t],n=e;n<this._visibleViews.length;n++){var r=this._visibleViews[n];i?(this._calcMainAxisPosition(r.group,i.group,As.Footer),this.adapter.layoutManager.layout(r.group)):this.getVisibleMainAxisSize()<this.adapter.mainAxisSize&&this._calcMainAxisPosition(r.group,null,As.Footer),i=r}},i._resetOverflowHeader=function(t){if(!t)return this.overflowHeader=0;var e=this.adapter.mainAxis,i=t.anchorPoint[e];i=1==this.adapter.multiplier?1-i:i;var n=t.position[e];n+=t.size[e]*i*this.adapter.multiplier,this.overflowHeader=n},i._calcOverflowHeader=function(t,e,i){var n=this.getVisibleIndexByGroupIndex(0);if(-1!=n){var r=this._visibleViews[n];return this._resetOverflowHeader(r.group)}var o=this.adapter.mainAxis,a=t.anchorPoint[o];a=1==this.adapter.multiplier?1-a:a;var s=t.oldSize[o],l=t.size[o],c=this.adapter.multiplier;switch(this.stretchDirection){case Ss.Header:var u=t.oldPosition[o]+s*a*c;(h=1==c?this.overflowHeader>=u:this.overflowHeader<=u)&&(this.overflowHeader+=(l-s)*c);break;case Ss.Footer:u=t.oldPosition[o]+s*a*c;(h=1==c?this.overflowHeader>=u:this.overflowHeader<=u)||(this.overflowHeader-=(l-s)*c);break;case Ss.Center:u=t.oldPosition[o]+s*a*c;(h=1==c?this.overflowHeader>=u:this.overflowHeader<=u)?this.overflowHeader+=.5*(l-s)*c:this.overflowHeader-=.5*(l-s)*c;break;case Ss.Auto:u=t.oldPosition[o]+s*a*c;var h=1==c?this.overflowHeader>=u:this.overflowHeader<=u;e<=i&&(u=t.oldPosition[o]+s*a*c,h=-1==c?this.overflowHeader>=u:this.overflowHeader<=u),h&&(e<=i?this.overflowHeader-=(l-s)*c:this.overflowHeader+=(l-s)*c)}},i.internal_lateUpdate=function(t){this._isFill&&(this._isFill=!1,this._forceFill()),this.emit(Hc.ON_LATEUPDATE,t)},i.internal_viewChanged=function(t,e){var i=t.group.size[this.adapter.mainAxis]-e;this.virtualSize+=i;var n=this.getVisibleIndexByGroupIndex(t.index),r=-1;if(this.getVisibleMainAxisSize()<this.adapter.mainAxisSize||this.stretchDirection==Ss.Footer){var o=n-1;this._visibleViews[o]||this.adapter.layoutManager.layout(t.group),this._stretchToFooter(o,n)}else if(this.stretchDirection==Ss.Header){var a=n+1;this._visibleViews[a]||this.adapter.layoutManager.layout(t.group),this._stretchToHeader(a,n)}else if(this.stretchDirection==Ss.Center)this.adapter.layoutManager.layout(t.group),this._stretchToHeader(n,n-1),this._stretchToFooter(n,n+1);else{if(-1==(r=this.adapter.centerManager.getCenterVisibleIndex()))throw Error("找不到中心索引"+t.index);var s=this._visibleViews[r];this.adapter.layoutManager.layout(s.group),this._stretchToHeader(r,r-1),this._stretchToFooter(r,r+1)}this._calcOverflowHeader(t.group,r,n),this.magneticSizeChanges&&this._calcMagnetic(),this._isFill=!0,this.emit(Hc.ON_CHANGED_VIRTUALSIZE)},i.internal_getHolder=function(t){var e=this._getHolderFromDisableHolders(t);if(!e){var i=this.adapter.getPrefab(t.data),n=A(i);e=this.adapter.getHolder(n,t.code)}return e.node.parent=this.adapter.scrollManager.getLayerNode(t.element.layer),e},i.internal_updateVisibleView=function(t){this._onModelChangeBefore(),this._updateGroups(t)},i.internal_getGroupFooterBoundary=function(t){if(!t)return 0;var e=t.anchorPoint[this.adapter.mainAxis];e=1==this.adapter.multiplier?e:1-e;var i=t.position[this.adapter.mainAxis];return i-=t.size[this.adapter.mainAxis]*e*this.adapter.multiplier,i+=this.adapter.scrollManager.contentPosition},i.internal_getGroupHeaderBoundary=function(t){if(!t)return 0;var e=t.anchorPoint[this.adapter.mainAxis];return e=1==this.adapter.multiplier?1-e:e,t.position[this.adapter.mainAxis]+this.adapter.scrollManager.contentPosition+e*t.size[this.adapter.mainAxis]*this.adapter.multiplier},i.internal_getInitHeaderSize=function(t){if(!t)return 0;var e=t.anchorPoint[this.adapter.mainAxis];e=1==this.adapter.multiplier?1-e:e;var i=-t.position[this.adapter.mainAxis]*this.adapter.multiplier;return i-=t.size[this.adapter.mainAxis]*e,i-=this.adapter.scrollManager.contentPosition*this.adapter.multiplier,i=this.adapter.mainAxisSize-i},i.internal_getInitFooterSize=function(t){if(!t)return 0;var e=t.anchorPoint[this.adapter.mainAxis];e=1==this.adapter.multiplier?e:1-e;var i=-t.position[this.adapter.mainAxis]*this.adapter.multiplier;return i+=t.size[this.adapter.mainAxis]*e,i-=this.adapter.scrollManager.contentPosition*this.adapter.multiplier},i.internal_accumulationSize=function(t){var e=this._groups[t];return e?e.size[this.adapter.mainAxis]+this.spacing:0},i.internal_convertSizeToFooterPosition=function(t,e){var i=e.anchorPoint[this.adapter.mainAxis];i=1==this.adapter.multiplier?i:1-i;var n=e.size[this.adapter.mainAxis]*i,r=-this.adapter.scrollManager.contentPosition;return r-=this.adapter.multiplier*t-this.adapter.multiplier*n},i.internal_convertSizeToHeaderPosition=function(t,e){var i=e.anchorPoint[this.adapter.mainAxis];i=1==this.adapter.multiplier?1-i:i;var n=e.size[this.adapter.mainAxis]*i,r=this.adapter.multiplier*t-this.adapter.multiplier*n;return r-=this.adapter.multiplier*this.adapter.mainAxisSize,r-=this.adapter.scrollManager.contentPosition},i.getGroup=function(t){return this._groups[t]},i.getVisibleView=function(t){return this._visibleViews[t]},i.getVisibleMainAxisSize=function(){if(0==this._visibleViews.length)return 0;for(var t=0,e=this.adapter.mainAxis,i=0,n=this._visibleViews.length;i<n;i++){var r=this._visibleViews[i];r.group&&(t+=r.group.size[e]+this.spacing)}return t-=this.spacing},i.getGroupIndexByModelIndex=function(t){for(var e=0,i=this._groups.length;e<i;e++){if(-1!=this._groups[e].findModelIndex(t))return e}return-1},i.getVisibleIndexByGroupIndex=function(t){return this._visibleViews.findIndex((function(e){return e.index==t}))},i.getNextFixedHolders=function(t){for(var e=[],i=this.getVisibleIndexByGroupIndex(t)+1,n=this._visibleViews.length;i<n;i++){var r=this._visibleViews[i];if(r.index!=t&&r.group.isFixed){e=r.getFixedHolders();break}}return e},i.getMagneticOffset=function(){if(!this.magnetic)return 0;var t=this.adapter.isHorizontal?-this.adapter.multiplier:this.adapter.multiplier;return this.magneticDirection==As.Footer?this.footer?Math.max(0,this.adapter.mainAxisSize-this.adapter.mainAxisPadding-this.getVisibleMainAxisSize())*t:this.adapter.mainAxisSize*t:0},xt(e,[{key:"arrangeAxis",get:function(){return this._arrangeAxis},set:function(t){t!=this._arrangeAxis&&(this._arrangeAxis=t,this._resetAllState())}},{key:"spacing",get:function(){return this._spacing},set:function(t){t!=this._spacing&&(this._spacing=t,this._resetAllState())}},{key:"header",get:function(){return this._visibleViews[0]}},{key:"footer",get:function(){return this._visibleViews[this._visibleViews.length-1]}},{key:"overflowHeader",get:function(){return this._overflowHeader},set:function(t){t!=this._overflowHeader&&(this._overflowHeader=t,this.emit(Hc.ON_CHANGED_OVERFLOWHEADER,t))}},{key:"virtualSize",get:function(){return this._virtualSize},set:function(t){t!=this._virtualSize&&(this._virtualSize=t,this.emit(Hc.ON_CHANGED_VIRTUALSIZE))}},{key:"groupLength",get:function(){return this._groupLength}},{key:"visibleLength",get:function(){return this._visibleViews.length}},{key:"min",get:function(){return this.header?this.adapter.isArrangeAxisStart?this.internal_getGroupFooterBoundary(this.footer.group):this.internal_getGroupHeaderBoundary(this.header.group):0}},{key:"max",get:function(){return this.header?this.adapter.isArrangeAxisStart?this.internal_getGroupHeaderBoundary(this.header.group):this.internal_getGroupFooterBoundary(this.footer.group):0}}]),e}(Us)).Event=Hc,Wl=Mt((Gl=oc).prototype,"_arrangeAxis",[Cl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return _s.Start}}),Mt(Gl.prototype,"arrangeAxis",[Pl],Object.getOwnPropertyDescriptor(Gl.prototype,"arrangeAxis"),Gl.prototype),ql=Mt(Gl.prototype,"stretchDirection",[Ml],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Ss.Auto}}),Zl=Mt(Gl.prototype,"overflowOffset",[Il],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.3}}),Yl=Mt(Gl.prototype,"enterOffset",[Nl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),jl=Mt(Gl.prototype,"_spacing",[Bc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Mt(Gl.prototype,"spacing",[Ll],Object.getOwnPropertyDescriptor(Gl.prototype,"spacing"),Gl.prototype),Kl=Mt(Gl.prototype,"left",[Ol],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Xl=Mt(Gl.prototype,"right",[Rl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Jl=Mt(Gl.prototype,"top",[xl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Ql=Mt(Gl.prototype,"bottom",[Fl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),$l=Mt(Gl.prototype,"magnetic",[Dl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),tc=Mt(Gl.prototype,"magneticDirection",[zl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return As.Header}}),ec=Mt(Gl.prototype,"magneticDuration",[kl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),ic=Mt(Gl.prototype,"magneticSizeChanges",[Vl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),nc=Mt(Gl.prototype,"loopHeader",[Bl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),rc=Mt(Gl.prototype,"loopFooter",[Hl],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Ul=Gl))||Ul);t._RF.pop(),t._RF.push({},"38125A9jl5DlJflB6yBKrYI","ScrollManager",void 0);var Gc,Wc,qc,Zc,Yc,jc,Kc,Xc,Jc,Qc,$c,tu=e.ccclass,eu=e.property,iu=new g,nu="__ADAPTER__",ru=function(t){return t[t.ON_SCROLL=0]="ON_SCROLL",t[t.ON_UPDATE_PERCENTAGE=1]="ON_UPDATE_PERCENTAGE",t[t.ON_VIEW_SIZE_CHANGED=2]="ON_VIEW_SIZE_CHANGED",t[t.ON_ABOUT_TO_STOP=3]="ON_ABOUT_TO_STOP",t[t.ON_SCROLL_START=4]="ON_SCROLL_START",t[t.ON_SCROLL_END=5]="ON_SCROLL_END",t[t.ON_SCROLL_CANCEL=6]="ON_SCROLL_CANCEL",t[t.ON_CHANGED_ORIENTATION=7]="ON_CHANGED_ORIENTATION",t[t.ON_SCROLL_TO_GROUPINDEX_BEFOR=8]="ON_SCROLL_TO_GROUPINDEX_BEFOR",t[t.ON_SCROLL_TO_GROUPINDEX_AFTER=9]="ON_SCROLL_TO_GROUPINDEX_AFTER",t[t.ON_SCROLL_TO_MODELINDEX_BEFOR=10]="ON_SCROLL_TO_MODELINDEX_BEFOR",t[t.ON_SCROLL_TO_MODELINDEX_AFTER=11]="ON_SCROLL_TO_MODELINDEX_AFTER",t}(ru||{}),ou=(lc=tu("ScrollManager"),uc=eu(B),hc=eu(B),pc=eu(B),dc=eu(B),fc=eu({type:ys}),gc=eu({type:ys}),mc=eu({type:Es,tooltip:"Auto: 当内容撑满可视区域或开启ReleaseManager时允许拖动\n        AlwaysAllow: 任何情况下都可以拖动，即使没有任何元素\n        Disabled: 任何情况下都禁用拖动\n        "}),vc=eu({type:bs}),yc=eu({range:[0,1],slide:!0,step:.001,visible:function(){return this.movementType==bs.Elastic}}),bc=eu({range:[0,1],slide:!0,step:.001,visible:function(){return this.inertia}}),_c=eu({tooltip:"当滚动速度小于这个值时，会发送ON_ABOUT_TO_STOP广播"}),Sc=eu({tooltip:"取消子节点的Button点击事件"}),wc=eu({range:[0,.5],slide:!0,step:.001,visible:function(){return this.inertia},tooltip:"嵌套时，当子元素的ScrollView拖动方向和当前拖动方向相同时，使用当前阈值进行计算由谁来处理拖动\n        无特殊需求时，默认值即可"}),Tc=eu({range:[.5,1],slide:!0,step:.001,visible:function(){return this.inertia},tooltip:"嵌套时，当子元素的ScrollView拖动方向和当前拖动方向相同时，使用当前阈值进行计算由谁来处理拖动\n        无特殊需求时，默认值即可"}),lc(((kc=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return e=t.call.apply(t,[this].concat(n))||this,Nt(e,"_view",Cc,Lt(e)),Nt(e,"_content",Pc,Lt(e)),Nt(e,"_orientation",Mc,Lt(e)),Nt(e,"touchMode",Ic,Lt(e)),Nt(e,"movementType",Nc,Lt(e)),Nt(e,"elasticity",Lc,Lt(e)),Nt(e,"inertia",Oc,Lt(e)),Nt(e,"decelerationRate",Rc,Lt(e)),Nt(e,"aboutToStopVelocity",xc,Lt(e)),Nt(e,"cancelInnerEvents",Fc,Lt(e)),Nt(e,"nestedMinThreshold",Dc,Lt(e)),Nt(e,"nestedMaxThreshold",zc,Lt(e)),e.__debug_graphics=void 0,e._boundaryOffset=0,e._viewWidget=null,e._parentAdapter=void 0,e._layerLowest=void 0,e._layerMedium=void 0,e._layerHighest=void 0,e._percentage=0,e._velocity=0,e._dragging=!1,e._scrolling=!1,e._isCanceledEvent=!1,e._contentStartPosition=new g,e._prevContentPosition=new g,e._nestedDirection=Is.Both,e._parentTouch=!1,e._stopCheckNested=!1,e._scrollHandlePercentage=null,e._scrollHandlePosition=null,e._isEmitAboutToStop=!1,e._isMyEventAndMoved=!1,e._scrollDirection=Ps.None,e._laseScrollDirection=Ps.None,e._touchEvent=null,e.test=!1,e}It(e,t);var i=e.prototype;return i.onInit=function(){var t=this;this._initView(),this._initContent(),this._parentAdapter=this.adapter.getParentAdapter(this.adapter.node.parent),this.view.node[nu]=!0,this.adapter.viewManager.on(Uc.Event.ON_UPDATE_VIEWS,this._onUpdateViews,this),this.adapter.viewManager.on(Uc.Event.ON_CHANGED_VIRTUALSIZE,this._onChangedVirtualSize,this),this.adapter.viewManager.on(Uc.Event.ON_CHANGED_OVERFLOWHEADER,this._onChangedOverflowHeader,this),this.adapter.viewManager.on(Uc.Event.ON_RESET_ALL_STATE,this._onResetAllState,this),this.adapter.viewManager.on(Uc.Event.ON_CLEARVIEWS,this._onResetAllState,this),this.adapter.node.on(c.EventType.SIZE_CHANGED,this._onAdapterSizeChanged,this),this.view.node.on(c.EventType.SIZE_CHANGED,this._onViewSizeChanged,this),this._registerTouchEvent(),this.__createDebug(),this.view.scheduleOnce((function(){t._updatePercentage()}))},i._initView=function(){if(!this.view)throw Error("ScrollManager view 参数为空！");var t={x:.5,y:.5};t[this.adapter.mainAxis]=this.adapter.mainAxisAnchorPoint,this.view.setAnchorPoint(t.x,t.y);var e=this.view.getComponent(Z);e||((e=this.view.addComponent(Z)).isAlignLeft=e.isAlignRight=e.isAlignTop=e.isAlignBottom=!0,e.left=e.right=e.top=e.bottom=0),e.updateAlignment(),this._viewWidget=e},i.__createDebug=function(){},i.__drawDebug=function(){if(this.__debug_graphics){this.__debug_graphics.clear();var t=this.adapter.mainAxis,e=this.adapter.crossAxis,i=this.adapter.multiplier,n={x:0,y:0},r={x:0,y:0};r[t]=this.adapter.viewManager.virtualSize,r[e]=this.adapter.crossAxisSize,n[t]=this.contentPosition-r[t]*this.content.anchorPoint[t]*i,n[t]+=this.adapter.viewManager.overflowHeader,n[e]-=r[e]*this.view.anchorPoint[e],this.__debug_graphics.fillRect(n.x,n.y,r.x,r.y),this.__debug_graphics.stroke()}},i._initContent=function(){if(!this.content)throw Error("ScrollManager content 参数为空！");this.content.setAnchorPoint(this.view.anchorPoint);var t={x:0,y:0};t[this.adapter.crossAxis]=this.view.contentSize[this.adapter.crossAxis],this.content.setContentSize(t.x,t.y),this._layerLowest||(this._layerLowest=new c("_layerLowest"),this._layerMedium=new c("_layerMedium"),this._layerHighest=new c("_layerHighest"),this.content.node.addChild(this._layerLowest),this.content.node.addChild(this._layerMedium),this.content.node.addChild(this._layerHighest)),this._updateContentPosition({x:0,y:0})},i._registerTouchEvent=function(){this.view.node.on(c.EventType.TOUCH_START,this._onTouchStart,this,!0),this.view.node.on(c.EventType.TOUCH_END,this._onTouchEnd,this,!0),this.view.node.on(c.EventType.TOUCH_CANCEL,this._onTouchCancel,this,!0),this.view.node.on(c.EventType.TOUCH_MOVE,this._onTouchMove,this,!0)},i._bubbleToParent=function(t){this._parentAdapter&&this._parentAdapter.scrollManager.view.node.dispatchEvent(t)},i._emitCancelEvent=function(t){if(!this._isCanceledEvent){var e=t.getUILocation();e.subtract(t.getUIStartLocation()),this.cancelInnerEvents&&e.length()>7&&t.target!==this.view.node&&(this._simulateEvent(t,c.EventType.MOUSE_LEAVE),this._simulateEvent(t,c.EventType.TOUCH_CANCEL),this._isCanceledEvent=!0)}},i._simulateEvent=function(t,e,i){if(void 0===i&&(i=!0),t){var n=new J(t.getTouches(),t.bubbles),r=t.target;n.type=e,n.touch=t.touch,n.simulate=i,r.dispatchEvent(n)}},i._onUpdateViews=function(){this._velocity=0,this._updatePercentage()},i._onChangedVirtualSize=function(){this._updatePercentage(),null!=this._scrollHandlePosition&&null!=this._scrollHandlePosition.change&&this._scrollHandlePosition.change()},i._onChangedOverflowHeader=function(t){this.__drawDebug()},i._onResetAllState=function(){this._velocity=0,this._scrolling=!1,this._dragging=!1,this._isMyEventAndMoved=!1,this._scrollDirection=Ps.None,this._percentage=0,this._isEmitAboutToStop=!1,this._boundaryOffset=0,this._isCanceledEvent=!1,this._parentTouch=!1,this._stopCheckNested=!1,this._scrollDirection=Ps.None,this._touchEvent=null,this.stopScroll(),this._initView(),this._initContent()},i._onAdapterSizeChanged=function(){this._viewWidget.updateAlignment()},i._onViewSizeChanged=function(){this.emit(ru.ON_VIEW_SIZE_CHANGED)},i._isMyEvent=function(t,e){return t.eventPhase==J.AT_TARGET||!e||e[0]==this.view.node&&!t.target[nu]},i._onTouchStart=function(t){this._velocity=0,this._dragging=!0,this._isMyEventAndMoved=!1,this._isCanceledEvent=!1,this._parentTouch=!1,this._stopCheckNested=!1,this._isEmitAboutToStop=!1,this._scrollDirection=Ps.None,this._contentStartPosition.set(this.content.node.position),this._touchEvent=t,this.stopScroll(),this._calcNestedDirection(),this.emit(ru.ON_SCROLL_START)},i._onTouchEnd=function(t,e){this._dragging=!1,this._touchEvent=null,this.emit(ru.ON_SCROLL_END,t)},i._onTouchCancel=function(t,e){t.simulate||(this._dragging=!1,this._touchEvent=null,this.emit(ru.ON_SCROLL_CANCEL,t))},i._onTouchMove=function(t,e){if(this._isMyEvent(t,e)){if(this._emitCancelEvent(t),this._parentTouch||!this.canTouch)return this._bubbleToParent(t);if(this._touchEvent){var i=this.adapter.mainAxis,n=t.getUILocation(),r=t.getUIStartLocation(),o=n.subtract(r);if(!o.equals2f(0,0)){var a={x:0,y:0};a[i]=this._contentStartPosition[i]+o[i];var s=a[i]-this.contentPosition,l=this.calcOffset(s),c=this.adapter.isHorizontal?-1:1;a[i]+=c*l,this.movementType==bs.Elastic&&0!=l&&(a[i]-=c*this._rubberDelta(l,this.adapter.mainAxisSize)),this._checkNested(t,a,this._parentAdapter),this._parentTouch?this._bubbleToParent(t):(this._isMyEventAndMoved=!0,this._updateContentPosition(a))}}}},i._calcNestedDirection=function(){this._parentAdapter&&(this.percentage<=this.nestedMinThreshold&&!this.adapter.viewManager.loopHeader?this._nestedDirection=1==this.adapter.multiplier?Is.Footer:Is.Header:this.percentage>=this.nestedMaxThreshold&&!this.adapter.viewManager.loopFooter?this._nestedDirection=1==this.adapter.multiplier?Is.Header:Is.Footer:this._nestedDirection=Is.Both)},i._checkNested=function(t,e,i){if(i&&!this._stopCheckNested){if(this.orientation==i.scrollManager.orientation){var n=e[this.adapter.mainAxis]-this._contentStartPosition[this.adapter.mainAxis];if(Math.abs(n)<=.1)return;this._nestedDirection==Is.Footer?n<0&&(this._parentTouch=!0):this._nestedDirection==Is.Header&&n>0&&(this._parentTouch=!0)}else{var r=0,o=0;if(t instanceof J){var a=t.getUIStartLocation(),s=t.getUILocation();r=Math.abs(a.x-s.x),o=Math.abs(a.y-s.y)}else r=Math.abs(t.getScrollX()),o=Math.abs(t.getScrollY());if(r==o)return;r>o?this.adapter.isVertical&&(this._parentTouch=!0):o>r&&this.adapter.isHorizontal&&(this._parentTouch=!0)}if(!this._parentTouch&&i.scrollManager.parentAdapter)return this._checkNested(t,e,i.scrollManager.parentAdapter);this._stopCheckNested=!0}},i._updateContentPosition=function(t,e){void 0===e&&(e=!0),this._updateScrollDirection(t),this.content.node.setPosition(t.x,t.y),this.emit(ru.ON_SCROLL,this._scrollDirection),e?this._updatePercentage():this.__drawDebug()},i._updatePrevContentPosition=function(){this._prevContentPosition.set(this.content.node.position)},i._calcPercentage=function(t,e){var i=this.internal_getHiddenSize(),n=this.adapter.viewManager.loopHeader,r=this.adapter.viewManager.loopFooter,o=this.adapter.multiplier,a=this.adapter.viewManager.overflowHeader,s=t*o;if(this.adapter.isHorizontal?s-=e*o:s+=e*o,r)s+=(a+(i+=this.adapter.viewManager.spacing)*o)*o,this.adapter.centerManager.enabled?s+=this.adapter.centerManager.getContainerOffset():s+=this.adapter.paddingHeader,s+=1,s%=i;else if(n){s+=this.adapter.mainAxisSize-1,this.adapter.centerManager.enabled?s-=this.adapter.centerManager.getContainerOffset():s-=this.adapter.paddingFooter,s+=(a+i*o)*o,t*-o>a*o&&(s+=this.adapter.viewManager.spacing),s%=i}else s+=a*o,this.adapter.centerManager.enabled?s+=this.adapter.centerManager.getContainerOffset():s+=this.adapter.paddingHeader,s>i&&(s=i);return s/i},i._updatePercentage=function(){var t=this.calcOffset();this.adapter.viewManager.virtualSize<=this.adapter.mainAxisSize?this._percentage=0:this._percentage=this._calcPercentage(this.contentPosition,t),this.emit(ru.ON_UPDATE_PERCENTAGE,this._percentage,t),this.__drawDebug()},i.internal_disableTouchTarget=function(t){if(this._touchEvent&&this._touchEvent.target==t){var e=this._touchEvent;this._simulateEvent(e,c.EventType.TOUCH_CANCEL,!1),this._simulateEvent(e,c.EventType.MOUSE_LEAVE,!1),this._touchEvent=null}},i.internal_getHiddenSize=function(){var t=this.adapter.viewManager.loopHeader,e=this.adapter.viewManager.loopFooter,i=this.adapter.viewManager.virtualSize;return t||e||this.adapter.centerManager.enabled||(i-=this.adapter.mainAxisSize,i+=this.adapter.mainAxisPadding),i},i._getContentMinBoundaryOffset=function(t,e){return!this.adapter.viewManager.header||!this.adapter.centerManager.enabled&&this.adapter.viewManager.virtualSize<=this.adapter.mainAxisSize?this.adapter.isHorizontal?e+this._defaultMax+t:e+this._defaultMin+t:this.adapter.viewManager.min+t},i._getContentMaxBoundaryOffset=function(t,e){return!this.adapter.viewManager.header||!this.adapter.centerManager.enabled&&this.adapter.viewManager.virtualSize<=this.adapter.mainAxisSize?this.adapter.isHorizontal?e+this._defaultMin+t:e+this._defaultMax+t:this.adapter.viewManager.max+t},i._getMaxBoundaryOffset=function(t){var e=this._viewMax;return this.adapter.isHorizontal?this.adapter.isArrangeAxisStart?t:e+t:this.adapter.isArrangeAxisStart?-t:e-t},i._getMinBoundaryOffset=function(t){var e=this._viewMin;return this.adapter.isHorizontal?this.adapter.isArrangeAxisStart?e+t:t:this.adapter.isArrangeAxisStart?e-t:-t},i._rubberDelta=function(t,e){return(1-1/(.55*Math.abs(t)/e+1))*e*Math.sign(t)},i._calcElastic=function(t,e,i){var n=this.adapter.mainAxis,r=this.elasticity;this._scrolling&&(r*=3);var o=this.adapter.isHorizontal?-1:1,a=ks.smoothDamp(this.contentPosition,this.contentPosition+o*e,this._velocity,r,ks.Infinity,t),s=a.velocity,l=a.position;Math.abs(s)<1&&(s=0),this._velocity=s,i[n]=l},i._calcInertia=function(t,e){this._velocity*=Math.pow(this.decelerationRate,t),Math.abs(this._velocity)<1&&(this._velocity=0),e[this.adapter.mainAxis]+=this._velocity*t},i._calcClamped=function(t){var e=this.adapter.mainAxis,i=t[e]-this.contentPosition,n=this.calcOffset(i);this.adapter.isHorizontal?t[e]-=n:t[e]+=n},i._updateScrollDirection=function(t){var e=t[this.adapter.mainAxis]-this.contentPosition;0!=e?(this.adapter.isHorizontal?this._scrollDirection=e>0?Ps.Right:Ps.Left:this._scrollDirection=e>0?Ps.Up:Ps.Down,this._laseScrollDirection=this._scrollDirection):this._scrollDirection=Ps.None},i.internal_setContentPosition=function(t,e){void 0===e&&(e=!0);var i={x:0,y:0};i[this.adapter.mainAxis]=t,this._updateContentPosition(i,e)},i.internal_lateUpdate=function(t){this.test||(this._autoScrolling(t),this._scrollHandler(t,this._scrollHandlePosition,this._scrollPositionHandler.bind(this)),this._scrollHandler(t,this._scrollHandlePercentage,this._scrollPercentageHandler.bind(this)))},i._autoScrolling=function(t){var e=this.calcOffset();if(this._boundaryOffset=e,this._dragging||0==e&&0==this._velocity||(this.content.node.getPosition(iu),this.movementType==bs.Elastic&&0!=e?this._calcElastic(t,e,iu):this.inertia?this._calcInertia(t,iu):this._velocity=0,this.movementType==bs.Clamped&&this._calcClamped(iu),this._updateContentPosition(iu)),this._dragging&&this.inertia){var i=(this.contentPosition-this._prevContentPosition[this.adapter.mainAxis])/t;this._velocity=ks.lerp(this._velocity,i,10*t)}this._prevContentPosition.equals(this.content.node.position)||this._updatePrevContentPosition(),!this._isEmitAboutToStop&&!this._dragging&&Math.abs(this._velocity)<=this.aboutToStopVelocity&&(this._scrollHandlePercentage||this._scrollHandlePosition||(this.emit(ru.ON_ABOUT_TO_STOP,this._velocity),this._isEmitAboutToStop=!0)),this._scrolling=!1},i._scrollHandler=function(t,e,i){if(null!=e){e.deltaTime+=t;var n=e.deltaTime/(e.duration>Q.FLT_EPSILON?e.duration:Q.FLT_EPSILON);n=ks.clamp01(n);var r=_.quintOut(n);e.current=ks.progress(e.from,e.to,e.current,r),i(e,n)}},i._scrollPercentageHandler=function(t,e){var i=this.percentage;if(this.setPercentage(t.current),1==e||i==this.percentage){var n=!0;this._scrollHandlePercentage.stop&&(n=this._scrollHandlePercentage.stop()),n&&(this._scrollHandlePercentage=null)}},i._scrollPositionHandler=function(t,e){var i={x:0,y:0};i[this.adapter.mainAxis]=t.current,this._setAutoScroll(i),(1==e||Math.abs(this.contentPosition-t.to)<=1e-4)&&(this._scrollHandlePosition.stop&&this._scrollHandlePosition.stop(),this._scrollHandlePosition=null)},i._setAutoScroll=function(t){var e=this,i=function(t){e._updateContentPosition(t),e._updatePrevContentPosition(),e._velocity=0};i(t);var n=this.calcOffset();if(0!=n){var r=this.adapter.isHorizontal?-1:1;return t[this.adapter.mainAxis]+=n*r,i(t),!1}return!0},i._scrollToPosition=function(t,e,i){var n=this;if(!this.canAutoScroll)return!1;var r=e();return!(null==r||Math.abs(this.contentPosition-r)<Q.FLT_EPSILON)&&(this._scrollHandlePercentage=null,this._scrollHandlePosition={current:0,from:this.contentPosition,to:r,deltaTime:0,duration:Math.max(0,t),change:function(){r=e(),n._scrollHandlePosition.to=r},stop:function(){i()}},!0)},i.getLayerNode=function(t){switch(t){case ws.Medium:return this._layerMedium;case ws.Highest:return this._layerHighest;default:return this._layerLowest}},i.scrollToModelIndex=function(t,e,i){var n=this,r=this.adapter.viewManager.getGroupIndexByModelIndex(e);if(-1!=r){var o=!1;this._scrollToPosition(t,(function(){var t=n.adapter.centerManager.getPositionByGroupIndex(r,i,o);return o=!0,t}),(function(){n.emit(ru.ON_SCROLL_TO_MODELINDEX_AFTER,e)}))&&this.emit(ru.ON_SCROLL_TO_MODELINDEX_BEFOR,e)}},i.scrollToGroupIndex=function(t,e,i){var n=this,r=!1;this._scrollToPosition(t,(function(){var t=n.adapter.centerManager.getPositionByGroupIndex(e,i,r);return r=!0,t}),(function(){n.emit(ru.ON_SCROLL_TO_GROUPINDEX_AFTER,e)}))&&this.emit(ru.ON_SCROLL_TO_GROUPINDEX_BEFOR,e)},i.scrollToHeader=function(t){this.scrollToGroupIndex(t,0)},i.scrollToFooter=function(t){this.scrollToGroupIndex(t,this.adapter.viewManager.groupLength-1)},i.scrollToPercentage=function(t,e){if(!this.canAutoScroll)return!1;Math.abs(this._percentage-e)<.001||(e=ks.clamp01(e),t=Math.max(0,t),this._scrollHandlePercentage=null,this._scrollHandlePercentage={deltaTime:0,duration:t,current:0,from:this._percentage,to:e})},i.stopVelocity=function(){this._velocity=0},i.setVelocity=function(t){this._velocity=t},i.stopScroll=function(){this._scrollHandlePosition=null,this._scrollHandlePercentage=null,this.stopVelocity()},i.setPercentage=function(t){for(var e=this.internal_getHiddenSize(),i={x:0,y:0},n=0,r=null;n<100;){n++;var o=this._percentage-t;if(null!=r&&this._percentage===r)break;if(Math.abs(o)<Q.FLT_EPSILON)break;r=this._percentage;var a=this.contentPosition-o*this.adapter.multiplier*e;if(i[this.adapter.mainAxis]=a,!this._setAutoScroll(i))break}100==n&&console.warn("Số vòng lặp đã đạt đến giá trị tối đa. Cố gắng không sửa đổi kích thước thường xuyên trong quá trình cuộn.")},i.calcOffset=function(t,e){void 0===t&&(t=0),void 0===e&&(e=this.contentPosition);var i=0;if(this.movementType==bs.Unrestricted)return i;var n=this._getContentMaxBoundaryOffset(t,e),r=this._getContentMinBoundaryOffset(t,e),o=this._getMaxBoundaryOffset(n),a=this._getMinBoundaryOffset(r);!this.adapter.centerManager.enabled&&this.adapter.viewManager.virtualSize>this.adapter.mainAxisSize&&(this.adapter.isVertical?(o-=this.adapter.viewManager.top,a+=this.adapter.viewManager.bottom):(o-=this.adapter.viewManager.left,a+=this.adapter.viewManager.right));var s=0,l=0;if(this.adapter.centerManager.enabled&&this.adapter.viewManager.groupLength>0)l=this.adapter.centerManager.max,s=this.adapter.centerManager.min;else{var c=this.adapter.viewManager.getMagneticOffset();o-=c,a-=c}return this.adapter.releaseManager.enabled&&(l=Math.max(l,this.adapter.releaseManager.max),s=Math.max(s,this.adapter.releaseManager.min)),o-=l,(a+=s)<-.001?i=a:o>.001&&(i=o),i},xt(e,[{key:"view",get:function(){return this._view},set:function(t){this._view=t}},{key:"content",get:function(){return this._content},set:function(t){this._content=t}},{key:"orientation",get:function(){return this._orientation},set:function(t){t!=this._orientation&&(this._orientation=t,this.emit(ru.ON_CHANGED_ORIENTATION))}},{key:"_viewMin",get:function(){return-this.adapter.mainAxisSize}},{key:"_viewMax",get:function(){return this.adapter.mainAxisSize}},{key:"_defaultMin",get:function(){return 1==this.adapter.multiplier?-this.adapter.mainAxisSize:0}},{key:"_defaultMax",get:function(){return 1==this.adapter.multiplier?0:this.adapter.mainAxisSize}},{key:"isMyEventAndMoved",get:function(){return this._isMyEventAndMoved}},{key:"velocity",get:function(){return this._velocity}},{key:"scrollDirection",get:function(){return this._scrollDirection}},{key:"laseScrollDirection",get:function(){return this._laseScrollDirection}},{key:"percentage",get:function(){return this._percentage}},{key:"dragging",get:function(){return this._dragging}},{key:"boundaryOffset",get:function(){return this._boundaryOffset}},{key:"parentAdapter",get:function(){return this._parentAdapter}},{key:"canAutoScroll",get:function(){return!this.dragging&&this.adapter.viewManager.virtualSize>this.adapter.mainAxisSize}},{key:"canTouch",get:function(){return this.touchMode==Es.AlwaysAllow||this.touchMode!=Es.Disabled&&(!!this.adapter.centerManager.enabled||(!!this.adapter.releaseManager.enabled||this.adapter.viewManager.virtualSize>this.adapter.mainAxisSize))}},{key:"contentPosition",get:function(){return this.content.node.position[this.adapter.mainAxis]}}]),e}(Us)).Event=ru,Cc=Mt((Ac=kc).prototype,"_view",[uc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Mt(Ac.prototype,"view",[hc],Object.getOwnPropertyDescriptor(Ac.prototype,"view"),Ac.prototype),Pc=Mt(Ac.prototype,"_content",[pc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Mt(Ac.prototype,"content",[dc],Object.getOwnPropertyDescriptor(Ac.prototype,"content"),Ac.prototype),Mc=Mt(Ac.prototype,"_orientation",[fc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return ys.Vertical}}),Mt(Ac.prototype,"orientation",[gc],Object.getOwnPropertyDescriptor(Ac.prototype,"orientation"),Ac.prototype),Ic=Mt(Ac.prototype,"touchMode",[mc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Es.Auto}}),Nc=Mt(Ac.prototype,"movementType",[vc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return bs.Elastic}}),Lc=Mt(Ac.prototype,"elasticity",[yc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.1}}),Oc=Mt(Ac.prototype,"inertia",[eu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Rc=Mt(Ac.prototype,"decelerationRate",[bc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.135}}),xc=Mt(Ac.prototype,"aboutToStopVelocity",[_c],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 100}}),Fc=Mt(Ac.prototype,"cancelInnerEvents",[Sc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Dc=Mt(Ac.prototype,"nestedMinThreshold",[wc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.001}}),zc=Mt(Ac.prototype,"nestedMaxThreshold",[Tc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.999}}),Ec=Ac))||Ec);t._RF.pop(),t._RF.push({},"e5ff40NmxhKAaD04pv29iQm","CenterManager",void 0);var au,su,lu,cu,uu,hu,pu,du,fu,gu,mu,vu,yu,bu,_u=e.ccclass,Su=e.property,wu=(Gc=_u("CenterManager"),Wc=Su("boolean"),qc=Su({visible:function(){return this.enabled},tooltip:"自动居中动画的时长"}),Zc=Su({range:[0,1],slide:!0,step:.1,tooltip:"容器(view)的锚点,当滚动停止时,元素锚点位置会和容器锚点位置重合"}),Yc=Su({range:[0,1],slide:!0,step:.1,tooltip:"元素(item)的锚点位置,当滚动停止时,元素锚点位置会和容器锚点位置重合"}),Gc((Xc=Mt((Kc=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return e=t.call.apply(t,[this].concat(n))||this,Nt(e,"_enabled",Xc,Lt(e)),Nt(e,"duration",Jc,Lt(e)),Nt(e,"containerAnchorPoint",Qc,Lt(e)),Nt(e,"elementAnchorPoint",$c,Lt(e)),e}It(e,t);var i=e.prototype;return i.getContainerOffset=function(t){void 0===t&&(t=this.containerAnchorPoint);var e=0;return e=this.adapter.isHorizontal?-1==this.adapter.multiplier?t:1-t:1==this.adapter.multiplier?t:1-t,this.adapter.mainAxisSize*e},i.getElementOffset=function(t){void 0===t&&(t=this.elementAnchorPoint);return this.adapter.isHorizontal?-1==this.adapter.multiplier?t:1-t:1==this.adapter.multiplier?t:1-t},i.onInit=function(){this.adapter.scrollManager.on(ou.Event.ON_ABOUT_TO_STOP,this._onAboutToStop,this),this.adapter.viewManager.on(Uc.Event.ON_UPDATE_VIEWS,this.scrollToCenter,this,!0)},i._onAboutToStop=function(){this.scrollToCenter()},i.scrollToCenter=function(t){if(void 0===t&&(t=this.duration),this.enabled){var e=this.getCenterVisibleIndex();if(-1!=e){var i=this.adapter.viewManager.getVisibleView(e);this.adapter.scrollManager.scrollToGroupIndex(t,i.index)}}},i.getCenterVisibleIndex=function(t,e){void 0===t&&(t=this.containerAnchorPoint),void 0===e&&(e=this.elementAnchorPoint);for(var i=this.adapter.mainAxis,n=this.getContainerOffset(t),r=-1,o=Number.MAX_SAFE_INTEGER,a=0;a<this.adapter.viewManager.visibleLength;a++){var s=this.adapter.viewManager.getVisibleView(a);if(!s||!s.group)break;var l={x:s.group.position.x,y:s.group.position.y};l[i]-=this.adapter.multiplier*s.group.size[i]*e;var c=this.adapter.scrollManager.content.convertToWorldSpaceAR(m(l.x,l.y)),u=this.adapter.scrollManager.view.convertToNodeSpaceAR(c),h=Math.abs(u[i]+this.adapter.multiplier*n);h<o&&(o=h,r=a)}return r},i.getPositionByGroupIndex=function(t,e,i){void 0===e&&(e=Ns.Auto),void 0===i&&(i=!1);var n=this.adapter.viewManager.getGroup(t);if(!n)return null;var r=null;if(e==Ns.Header&&this.adapter.viewManager.loopHeader)i&&(r=this._checkExists(t)),null==r&&(r=this._alwaysHeader(t,n));else if(e==Ns.Footer&&this.adapter.viewManager.loopFooter)i&&(r=this._checkExists(t)),null==r&&(r=this._alwaysFooter(t,n));else if(null==(r=this._checkExists(t))){var o=this.adapter.viewManager.header,a=this.adapter.viewManager.footer;o?t>a.index?r=this._calcTargetFooter(a.group,a.index+1,t,n):t<o.index&&(r=this._calcTargetHeader(o.group,o.index-1,t,n)):r={position:n.position[this.adapter.mainAxis],size:n.size[this.adapter.mainAxis],anchor:n.anchorPoint[this.adapter.mainAxis]}}return this._convertTargetToPosition(r)},i._convertTargetToPosition=function(t){var e=null;if(t){var i=this.adapter.multiplier,n=-1==i?t.anchor:1-t.anchor;e=-t.position,e-=this.getContainerOffset()*i,e-=t.size*n*i,e+=t.size*this.getElementOffset()*i}return e},i._checkExists=function(t){var e=this.adapter.viewManager.getVisibleIndexByGroupIndex(t);if(-1!=e){var i=this.adapter.viewManager.getVisibleView(e);return{position:i.group.position[this.adapter.mainAxis],size:i.group.size[this.adapter.mainAxis],anchor:i.group.anchorPoint[this.adapter.mainAxis]}}return null},i._calcTargetFooter=function(t,e,i,n){for(var r=this.adapter.viewManager.internal_getInitFooterSize(t),o=e;o<=i;o++)r+=this.adapter.viewManager.internal_accumulationSize(o);return{position:this.adapter.viewManager.internal_convertSizeToFooterPosition(r,n),size:n.size[this.adapter.mainAxis],anchor:n.anchorPoint[this.adapter.mainAxis]}},i._calcTargetHeader=function(t,e,i,n){for(var r=this.adapter.viewManager.internal_getInitHeaderSize(t),o=e;o>=i;o--)r+=this.adapter.viewManager.internal_accumulationSize(o);return{position:this.adapter.viewManager.internal_convertSizeToHeaderPosition(r,n),size:n.size[this.adapter.mainAxis],anchor:n.anchorPoint[this.adapter.mainAxis]}},i._alwaysHeader=function(t,e){var i=0,n=t,r=this.adapter.viewManager.header;return r&&(i=this.adapter.viewManager.internal_getInitHeaderSize(r.group),n=r.index),t!=n&&(i=this._calcSizeToHeader(n,t,i)),{position:this.adapter.viewManager.internal_convertSizeToHeaderPosition(i,e),size:e.size[this.adapter.mainAxis],anchor:e.anchorPoint[this.adapter.mainAxis]}},i._alwaysFooter=function(t,e){var i=0,n=t,r=this.adapter.viewManager.footer;return r&&(i=this.adapter.viewManager.internal_getInitFooterSize(r.group),n=r.index),t!=n&&(i=this._calcSizeToFooter(n,t,i)),{position:this.adapter.viewManager.internal_convertSizeToFooterPosition(i,e),size:e.size[this.adapter.mainAxis],anchor:e.anchorPoint[this.adapter.mainAxis]}},i._calcSizeToHeader=function(t,e,i){for(;;){if(--t<0){if(!this.adapter.viewManager.loopHeader)return i;t=this.adapter.viewManager.groupLength-1}if(i+=this.adapter.viewManager.internal_accumulationSize(t),e==t)return i}},i._calcSizeToFooter=function(t,e,i){for(;;){if(++t>=this.adapter.viewManager.groupLength){if(!this.adapter.viewManager.loopFooter)return i;t=0}if(i+=this.adapter.viewManager.internal_accumulationSize(t),t==e)return i}},xt(e,[{key:"enabled",get:function(){return this._enabled},set:function(t){t!=this._enabled&&(this._enabled=t)}},{key:"max",get:function(){var t=this.getContainerOffset(this.containerAnchorPoint);return this.adapter.isArrangeAxisStart?t:this.adapter.mainAxisSize-t}},{key:"min",get:function(){var t=this.getContainerOffset(this.containerAnchorPoint);return this.adapter.isArrangeAxisStart?this.adapter.mainAxisSize-t:t}}]),e}(Us)).prototype,"_enabled",[Su],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Mt(Kc.prototype,"enabled",[Wc],Object.getOwnPropertyDescriptor(Kc.prototype,"enabled"),Kc.prototype),Jc=Mt(Kc.prototype,"duration",[qc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),Qc=Mt(Kc.prototype,"containerAnchorPoint",[Zc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),$c=Mt(Kc.prototype,"elementAnchorPoint",[Yc],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),jc=Kc))||jc);t._RF.pop(),t._RF.push({},"e3a2d9kCydCzZKVh5E8qZ8J","PageViewManager",void 0);var Tu,Eu,Au,Cu,Pu,Mu,Iu,Nu,Lu,Ou,Ru,xu,Fu,Du,zu=e.ccclass,ku=e.property,Vu=function(t){return t[t.ON_PAGE_LENGTH_CHANGED=0]="ON_PAGE_LENGTH_CHANGED",t[t.ON_SCROLL_PAGE_BEFOR=1]="ON_SCROLL_PAGE_BEFOR",t[t.ON_SCROLL_PAGE_END=2]="ON_SCROLL_PAGE_END",t}(Vu||{}),Bu=(au=zu("PageViewManager"),su=ku("boolean"),lu=ku({range:[0,1],slide:!0,step:.01,visible:function(){return this.enabled},tooltip:"滚动临界值，默认单位百分比，当拖拽超出该数值时，松开会自动滚动下一页，小于时则还原"}),cu=ku({range:[0,1],slide:!0,step:.01,visible:function(){return this.enabled},tooltip:"设置 PageView PageTurning 事件的发送时机"}),uu=ku({visible:function(){return this.enabled},tooltip:"快速滑动翻页临界值\n        当用户快速滑动时，会根据滑动开始和结束的距离与时间计算出一个速度值\n        该值与此临界值相比较，如果大于临界值，则进行自动翻页"}),hu=ku({visible:function(){return this.enabled},tooltip:"每个页面翻页时所需时间。单位：秒"}),au(((bu=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return e=t.call.apply(t,[this].concat(n))||this,Nt(e,"_enabled",fu,Lt(e)),Nt(e,"scrollThreshold",gu,Lt(e)),Nt(e,"pageTurningEventTiming",mu,Lt(e)),Nt(e,"autoPageTurningThreshold",vu,Lt(e)),Nt(e,"pageTurningSpeed",yu,Lt(e)),e._currentIndex=0,e}It(e,t);var i=e.prototype;return i.onInit=function(){this._register()},i._register=function(){this.adapter&&this.enabled&&(this.adapter.scrollManager.on(ou.Event.ON_SCROLL_END,this._handleReleaseLogic,this),this.adapter.scrollManager.on(ou.Event.ON_SCROLL_CANCEL,this._handleReleaseLogic,this),this.adapter.scrollManager.on(ou.Event.ON_SCROLL_TO_GROUPINDEX_BEFOR,this._onScrollToIndex,this),this.adapter.viewManager.on(Uc.Event.ON_UPDATE_VIEWS,this._onUpdateViews,this,!0))},i._unregister=function(){this.adapter&&!this.enabled&&(this.adapter.scrollManager.off(ou.Event.ON_SCROLL_END,this._handleReleaseLogic,this),this.adapter.scrollManager.off(ou.Event.ON_SCROLL_CANCEL,this._handleReleaseLogic,this),this.adapter.scrollManager.off(ou.Event.ON_SCROLL_TO_GROUPINDEX_BEFOR,this._onScrollToIndex,this),this.adapter.viewManager.off(Uc.Event.ON_UPDATE_VIEWS,this._onUpdateViews,this))},i.scrollToPage=function(t,e,i){e<0||e>=this.length||e==this.currentIndex&&0!=this.adapter.scrollManager.calcOffset()||(this.adapter.scrollManager.scrollToGroupIndex(t,e,i),this.emit(Vu.ON_SCROLL_PAGE_BEFOR,e))},i.scrollToPrevPage=function(t,e){void 0===t&&(t=this.pageTurningSpeed),void 0===e&&(e=Ns.Header),0!=this._currentIndex?this.scrollToPage(t,this._currentIndex-1,e):this.adapter.viewManager.loopHeader&&this.scrollToPage(t,this.length-1,e)},i.scrollToNextPage=function(t,e){void 0===t&&(t=this.pageTurningSpeed),void 0===e&&(e=Ns.Footer),this._currentIndex>=this.length-1?this.adapter.viewManager.loopFooter&&this.scrollToPage(t,0,e):this.scrollToPage(t,this._currentIndex+1,e)},i._onUpdateViews=function(){this.emit(Vu.ON_PAGE_LENGTH_CHANGED),this._currentIndex=0,this.scrollToPage(this.pageTurningSpeed,this._currentIndex)},i._onScrollToIndex=function(t){this._currentIndex=t,this.emit(Vu.ON_SCROLL_PAGE_END,t)},i._handleReleaseLogic=function(t){if(this._enabled&&this.adapter.scrollManager.isMyEventAndMoved){var e=t.getUIStartLocation()[this.adapter.mainAxis]-t.getUILocation()[this.adapter.mainAxis],i=this._getNextIndex(e);this._isScrollable(e)||this._isQuicklyScrollable(this.adapter.scrollManager.velocity)?this.scrollToPage(this.pageTurningSpeed,i):this.scrollToPage(this.pageTurningSpeed,this._currentIndex)}},i._getNextIndex=function(t){var e=this._currentIndex;return this.adapter.isHorizontal?this.adapter.isArrangeAxisStart?t>0?e++:t<0&&e--:(t<0&&e++,t>0&&e--):this.adapter.isArrangeAxisStart?t<0?e++:t>0&&e--:t>0?e++:t<0&&e--,e>=this.length&&this.adapter.viewManager.loopFooter?e=0:e<0&&this.adapter.viewManager.loopHeader&&(e=this.length-1),(e<0||e>=this.length)&&(e=this._currentIndex),e},i._isScrollable=function(t){return Math.abs(t)>=this.adapter.mainAxisSize*this.scrollThreshold},i._isQuicklyScrollable=function(t){return Math.abs(t)>this.autoPageTurningThreshold},xt(e,[{key:"enabled",get:function(){return this._enabled},set:function(t){t!=this._enabled&&(this._enabled=t,this._enabled?this._register():this._unregister())}},{key:"currentIndex",get:function(){return this._currentIndex}},{key:"length",get:function(){return this.adapter.viewManager.groupLength}}]),e}(Us)).Event=Vu,fu=Mt((du=bu).prototype,"_enabled",[ku],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Mt(du.prototype,"enabled",[su],Object.getOwnPropertyDescriptor(du.prototype,"enabled"),du.prototype),gu=Mt(du.prototype,"scrollThreshold",[lu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),mu=Mt(du.prototype,"pageTurningEventTiming",[cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.1}}),vu=Mt(du.prototype,"autoPageTurningThreshold",[uu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 100}}),yu=Mt(du.prototype,"pageTurningSpeed",[hu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.3}}),pu=du))||pu);t._RF.pop(),t._RF.push({},"797a5chXbhC64OnuHlVCMHV","ReleaseManager",void 0);var Hu,Uu,Gu,Wu,qu,Zu,Yu,ju,Ku,Xu,Ju,Qu,$u,th,eh,ih=e.ccclass,nh=e.property,rh=function(t){return t[t.ON_PULL_UP=0]="ON_PULL_UP",t[t.ON_PULL_DOWN=1]="ON_PULL_DOWN",t[t.ON_PULL_LEFT=2]="ON_PULL_LEFT",t[t.ON_PULL_RIGHT=3]="ON_PULL_RIGHT",t}(rh||{}),oh=(Tu=ih("ReleaseManager"),Eu=nh("boolean"),Au=nh({range:[0,1],slide:!0,step:.01,visible:function(){return this.enabled},tooltip:"根据此阈值来切换state状态"}),Cu=nh({range:[0,1],slide:!0,step:.01,visible:function(){return this.enabled},tooltip:"根据此阈值来切换state状态"}),Pu=nh({range:[0,1],slide:!0,step:.01,visible:function(){return this.enabled},tooltip:"根据此阈值来切换state状态"}),Mu=nh({range:[0,1],slide:!0,step:.01,visible:function(){return this.enabled},tooltip:"根据此阈值来切换state状态"}),Tu(((Du=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return e=t.call.apply(t,[this].concat(n))||this,Nt(e,"_enabled",Lu,Lt(e)),Nt(e,"left",Ou,Lt(e)),Nt(e,"right",Ru,Lt(e)),Nt(e,"top",xu,Lt(e)),Nt(e,"bottom",Fu,Lt(e)),e._pullUp=void 0,e._pullDown=void 0,e._pullLeft=void 0,e._pullRight=void 0,e}It(e,t);var i=e.prototype;return i.onInit=function(){this.enabled&&(this._pullUp=new ah(this,rh.ON_PULL_UP,this.bottom),this._pullDown=new ah(this,rh.ON_PULL_DOWN,this.top),this._pullLeft=new ah(this,rh.ON_PULL_LEFT,this.right),this._pullRight=new ah(this,rh.ON_PULL_RIGHT,this.left),this.adapter.scrollManager.on(ou.Event.ON_SCROLL_START,this.onScrollStart,this),this.adapter.scrollManager.on(ou.Event.ON_SCROLL_END,this.onScrollEnd,this),this.adapter.scrollManager.on(ou.Event.ON_SCROLL_CANCEL,this.onScrollEnd,this),this.checkLoop())},i.checkLoop=function(){this.adapter.isHorizontal?this.adapter.isArrangeAxisStart?(this.left>0&&(this.adapter.viewManager.loopHeader=!1),this.right>0&&(this.adapter.viewManager.loopFooter=!1)):(this.left>0&&(this.adapter.viewManager.loopFooter=!1),this.right>0&&(this.adapter.viewManager.loopHeader=!1)):this.adapter.isArrangeAxisStart?(this.top>0&&(this.adapter.viewManager.loopHeader=!1),this.bottom>0&&(this.adapter.viewManager.loopFooter=!1)):(this.top>0&&(this.adapter.viewManager.loopFooter=!1),this.bottom>0&&(this.adapter.viewManager.loopHeader=!1))},i.onScrollStart=function(){this.adapter.isHorizontal?(this.left>0&&this._pullRight._setState(Rs.IDLE),this.right>0&&this._pullLeft._setState(Rs.IDLE)):(this.top>0&&this._pullDown._setState(Rs.IDLE),this.bottom>0&&this._pullUp._setState(Rs.IDLE))},i.onScrollEnd=function(){this.adapter.isHorizontal?(this.left>0&&this._pullRight._setState(Rs.RELEASE),this.right>0&&this._pullLeft._setState(Rs.RELEASE)):(this.top>0&&this._pullDown._setState(Rs.RELEASE),this.bottom>0&&this._pullUp._setState(Rs.RELEASE))},i.internal_lateUpdate=function(t){if(this.enabled){var e=this.adapter.scrollManager.boundaryOffset;this.adapter.scrollManager.dragging||(e=0),this.adapter.isHorizontal?(this.left>0&&this._pullRight._set(Math.max(-e,0),e<0),this.right>0&&this._pullLeft._set(Math.max(e,0),e>0)):(this.top>0&&this._pullDown._set(Math.max(e,0),e>0),this.bottom>0&&this._pullUp._set(Math.max(-e,0),e<0))}},xt(e,[{key:"enabled",get:function(){return this._enabled},set:function(t){t!=this._enabled&&(this._enabled=t)}},{key:"max",get:function(){return this.enabled?this.adapter.isHorizontal?this._pullLeft?this._pullLeft.expand:0:this._pullDown?this._pullDown.expand:0:0}},{key:"min",get:function(){return this.enabled?this.adapter.isHorizontal?this._pullRight?this._pullRight.expand:0:this._pullUp?this._pullUp.expand:0:0}}]),e}(Us)).Event=rh,Lu=Mt((Nu=Du).prototype,"_enabled",[nh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Mt(Nu.prototype,"enabled",[Eu],Object.getOwnPropertyDescriptor(Nu.prototype,"enabled"),Nu.prototype),Ou=Mt(Nu.prototype,"left",[Au],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Ru=Mt(Nu.prototype,"right",[Cu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),xu=Mt(Nu.prototype,"top",[Pu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Fu=Mt(Nu.prototype,"bottom",[Mu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Iu=Nu))||Iu),ah=function(){function t(t,e,i){this._expand=0,this._progress=0,this._offset=0,this._state=void 0,this._defaultPercentage=void 0,this._manager=void 0,this._event=void 0,this._stop=void 0,this._defaultPercentage=i,this._manager=t,this._event=e}var e=t.prototype;return e._set=function(t,e){e&&(this._stop=!1),this._stop||(this._offset=t,this._progress=t/(this._defaultPercentage*this._manager.adapter.mainAxisSize),this._stop=this._offset<=.1,this._setState(Rs.PULL),this._manager.emit(this._event,this))},e._setState=function(t){this._state!=Rs.WAIT&&(t==Rs.PULL&&this._state==Rs.RELEASE||(this._state=t))},e.wait=function(t){void 0===t&&(t=this._defaultPercentage*this._manager.adapter.mainAxisSize),this._expand=t,this._state=Rs.WAIT},e.release=function(){this._expand=0,this._state=Rs.IDLE,this.offset<=.1&&(this._offset=0,this._progress=0,this._manager.emit(this._event,this))},xt(t,[{key:"expand",get:function(){return this._expand}},{key:"progress",get:function(){return this._progress}},{key:"offset",get:function(){return this._offset}},{key:"state",get:function(){return this._state}}]),t}();t._RF.pop(),t._RF.push({},"4f9c5h5sDhP/78kLerCTNfA","ScrollAdapter",void 0);var sh,lh,ch,uh,hh,ph,dh,fh,gh,mh,vh,yh=e.ccclass,bh=e.property,_h=(Hu=yh("ScrollAdapter"),Uu=bh(ou),Gu=bh(Uc),Wu=bh(El),qu=bh(Bu),Zu=bh(oh),Yu=bh(wu),Hu((Xu=Mt((Ku=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return e=t.call.apply(t,[this].concat(n))||this,Nt(e,"scrollManager",Xu,Lt(e)),Nt(e,"viewManager",Ju,Lt(e)),Nt(e,"layoutManager",Qu,Lt(e)),Nt(e,"pageViewManager",$u,Lt(e)),Nt(e,"releaseManager",th,Lt(e)),Nt(e,"centerManager",eh,Lt(e)),e.modelManager=new Zs,e}It(e,t);var i=e.prototype;return i.initElement=function(t,e){},i.getView=function(){return new Sh(this)},i.getHolder=function(t,e){return new wh(t,e,this)},i.getParentAdapter=function(t){if(null!=t){var e=t.getComponent("ScrollAdapter");return e||this.getParentAdapter(t.parent)}},i.__preload=function(){this.scrollManager.internal_create(this),this.viewManager.internal_create(this),this.modelManager.internal_create(this),this.releaseManager.internal_create(this),this.layoutManager.internal_create(this),this.pageViewManager.internal_create(this),this.centerManager.internal_create(this),this.viewManager.internal_init(),this.releaseManager.internal_init(),this.layoutManager.internal_init(),this.pageViewManager.internal_init(),this.centerManager.internal_init(),this.scrollManager.internal_init(),this.modelManager.internal_init()},i.lateUpdate=function(t){this.scrollManager.internal_lateUpdate(t),this.viewManager.internal_lateUpdate(t),this.layoutManager.internal_lateUpdate(t),this.releaseManager.internal_lateUpdate(t)},xt(e,[{key:"isVertical",get:function(){return this.scrollManager.orientation==ys.Vertical}},{key:"isHorizontal",get:function(){return this.scrollManager.orientation==ys.Horizontal}},{key:"isArrangeAxisStart",get:function(){return this.viewManager.arrangeAxis==_s.Start}},{key:"mainAxis",get:function(){return this.isVertical?"y":"x"}},{key:"crossAxis",get:function(){return this.isVertical?"x":"y"}},{key:"mainAxisAnchorPoint",get:function(){var t=this.isVertical?1:0;return this.isArrangeAxisStart?t:1-t}},{key:"mainAxisSize",get:function(){return this.scrollManager.view.contentSize[this.mainAxis]}},{key:"crossAxisSize",get:function(){return this.scrollManager.view.contentSize[this.crossAxis]}},{key:"multiplier",get:function(){var t=this.isVertical?-1:1;return this.isArrangeAxisStart?-t:t}},{key:"paddingHeader",get:function(){return this.isHorizontal?this.isArrangeAxisStart?this.viewManager.left:this.viewManager.right:this.isArrangeAxisStart?this.viewManager.top:this.viewManager.bottom}},{key:"paddingFooter",get:function(){return this.isHorizontal?this.isArrangeAxisStart?this.viewManager.right:this.viewManager.left:this.isArrangeAxisStart?this.viewManager.bottom:this.viewManager.top}},{key:"mainAxisPadding",get:function(){return this.isHorizontal?this.viewManager.left+this.viewManager.right:this.viewManager.top+this.viewManager.bottom}}]),e}(o)).prototype,"scrollManager",[Uu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new ou}}),Ju=Mt(Ku.prototype,"viewManager",[Gu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Uc}}),Qu=Mt(Ku.prototype,"layoutManager",[Wu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new El}}),$u=Mt(Ku.prototype,"pageViewManager",[qu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new Bu}}),th=Mt(Ku.prototype,"releaseManager",[Zu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new oh}}),eh=Mt(Ku.prototype,"centerManager",[Yu],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new wu}}),ju=Ku))||ju),Sh=function(t){function e(){return t.apply(this,arguments)||this}It(e,t);var i=e.prototype;return i.onVisible=function(){this.adapter.node.emit(Fs.VISIBLE,this)},i.onDisable=function(){this.adapter.node.emit(Fs.DISABLE,this)},e}(sc),wh=function(t){function e(){return t.apply(this,arguments)||this}It(e,t);var i=e.prototype;return i.onCreated=function(){this.node.emit(xs.CREATED,this)},i.onVisible=function(){this.node.emit(xs.VISIBLE,this)},i.onDisable=function(){this.node.emit(xs.DISABLE,this)},e}(js);t._RF.pop(),t._RF.push({},"518d6bEinVOEZVOae09QC8Z","Indicator",void 0);var Th,Eh,Ah,Ch,Ph,Mh,Ih,Nh,Lh,Oh,Rh,xh,Fh,Dh,zh,kh,Vh,Bh,Hh,Uh,Gh,Wh,qh,Zh,Yh,jh,Kh,Xh,Jh,Qh,$h,tp,ep,ip,np,rp,op,ap,sp,lp,cp=e.ccclass,up=e.property;sh=cp("Indicator"),lh=up(_h),ch=up({type:i}),uh=up({type:Ls}),sh((dh=Mt((ph=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return e=t.call.apply(t,[this].concat(n))||this,Nt(e,"adapter",dh,Lt(e)),Nt(e,"spriteFrame",fh,Lt(e)),Nt(e,"indicatorMode",gh,Lt(e)),Nt(e,"cellSize",mh,Lt(e)),Nt(e,"spacing",vh,Lt(e)),e._indicators=[],e._layout=null,e._color=new X,e}It(e,t);var i=e.prototype;return i.__preload=function(){this.adapter&&(this.adapter.pageViewManager.on(Bu.Event.ON_PAGE_LENGTH_CHANGED,this._onPageLengthChanged,this),this.adapter.pageViewManager.on(Bu.Event.ON_SCROLL_PAGE_END,this._onScrollPageEnd,this))},i._onScrollPageEnd=function(){this.changedState()},i._onPageLengthChanged=function(){if(this.adapter){var t=this._indicators,e=this.adapter.viewManager.groupLength;if(e!==t.length){var i=0;if(e>t.length)for(i=0;i<e;++i)t[i]||(t[i]=this._createIndicator(i));else for(i=t.length-e;i>0;--i){var n=t[i-1];this.node.removeChild(n.node),t.splice(i-1,1)}this.layout&&this.layout.enabledInHierarchy&&this.layout.updateLayout(),this.changedState()}}},i._createIndicator=function(t){var e=new c;e.layer=this.node.layer;var i=e.addComponent(f);i.spriteFrame=this.spriteFrame,i.sizeMode=f.SizeMode.CUSTOM,e.parent=this.node;var n=e.getComponent(B);if(n.setContentSize(this.cellSize),this.indicatorMode==Ls.Button){var r=e.getComponent(x)||e.addComponent(x),o=new F;o.component="Indicator",o.handler="_click",o.target=this.node,o.customEventData=t,r.clickEvents.push(o)}return n},i._click=function(t,e){this.adapter.pageViewManager.scrollToPage(this.adapter.pageViewManager.pageTurningSpeed,e)},i.changedState=function(){var t=this._indicators;if(0!==t.length&&this.adapter){var e=this.adapter.pageViewManager.currentIndex;if(!(e>=t.length)){for(var i=0;i<t.length;++i){var n=t[i].getComponent(f);this._color.set(n.color),this._color.a=127.5,n.color=this._color}if(t[e]){var r=t[e].getComponent(f);this._color.set(r.color),this._color.a=255,r.color=this._color}}}},xt(e,[{key:"layout",get:function(){return null==this._layout&&(this._layout=this.getComponent($)||this.addComponent($),this.adapter.isHorizontal?(this._layout.type=$.Type.HORIZONTAL,this._layout.spacingX=this.spacing):(this._layout.type=$.Type.VERTICAL,this._layout.spacingY=this.spacing),this._layout.resizeMode=$.ResizeMode.CONTAINER),this._layout}}]),e}(o)).prototype,"adapter",[lh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),fh=Mt(ph.prototype,"spriteFrame",[ch],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),gh=Mt(ph.prototype,"indicatorMode",[uh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Ls.Normal}}),mh=Mt(ph.prototype,"cellSize",[up],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new tt(10,10)}}),vh=Mt(ph.prototype,"spacing",[up],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 10}}),hh=ph));t._RF.pop(),t._RF.push({},"67fa5ko0UJAJpbCzgGfagdw","Scrollbar",void 0);var hp,pp,dp,fp,gp,mp=e.ccclass,vp=e.property,yp=new X;Th=mp("Scrollbar"),Eh=vp(_h),Ah=vp(f),Ch=vp({type:Ms,tooltip:"滚动方向"}),Ph=vp({tooltip:"开启后会允许用户滑动进度条"}),Mh=vp({range:[0,1],slide:!0,step:.001,visible:function(){return this.interactable},tooltip:"可拖拽的最小限制，默认=0不限制,仅当你开启了循环,并且你的item会实时修改主轴尺寸时,那么你应该适当限制拖拽区域"}),Ih=vp({range:[0,1],slide:!0,step:.001,visible:function(){return this.interactable},tooltip:"可拖拽的最大限制，默认=1不限制,仅当你开启了循环,并且你的item会实时修改主轴尺寸时,那么你应该适当限制拖拽区域"}),Nh=vp({type:Os}),Lh=vp({type:Os,visible:function(){return this.interactable}}),Oh=vp({type:f,visible:function(){return this.transition!=Os.None&&this.interactable}}),Rh=vp({type:i,visible:function(){return this.transition==Os.SpriteSwap&&this.interactable}}),xh=vp({type:i,visible:function(){return this.transition==Os.SpriteSwap&&this.interactable}}),Fh=vp({visible:function(){return this.transition==Os.ColorTint&&this.interactable}}),Dh=vp({visible:function(){return this.transition==Os.ColorTint&&this.interactable}}),zh=vp({visible:function(){return this.transition==Os.Scale&&this.interactable}}),kh=vp({visible:function(){return this.transition==Os.Scale&&this.interactable}}),Vh=vp({visible:function(){return this.transition==Os.Scale||this.transition==Os.ColorTint&&this.interactable}}),Bh=vp({range:[0,11],slide:!0,step:1,tooltip:"用于进度的步数。值为 < 2 将禁用"}),Hh=vp({tooltip:"开启后会在滚动条无更新时自动隐藏"}),Uh=vp({visible:function(){return this.enableAutoHide},tooltip:"自动隐藏滚动条的时间"}),Th((qh=Mt((Wh=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return e=t.call.apply(t,[this].concat(n))||this,Nt(e,"adapter",qh,Lt(e)),Nt(e,"handle",Zh,Lt(e)),Nt(e,"direction",Yh,Lt(e)),Nt(e,"interactable",jh,Lt(e)),Nt(e,"dragMinLimit",Kh,Lt(e)),Nt(e,"dragMaxLimit",Xh,Lt(e)),Nt(e,"_transition",Jh,Lt(e)),Nt(e,"targetGraphic",Qh,Lt(e)),Nt(e,"hoverSprite",$h,Lt(e)),Nt(e,"pressedSprite",tp,Lt(e)),Nt(e,"hoverColor",ep,Lt(e)),Nt(e,"pressedColor",ip,Lt(e)),Nt(e,"hoverScale",np,Lt(e)),Nt(e,"pressedScale",rp,Lt(e)),Nt(e,"transitionDuration",op,Lt(e)),Nt(e,"numberOfSteps",ap,Lt(e)),Nt(e,"enableAutoHide",sp,Lt(e)),Nt(e,"autoHideTime",lp,Lt(e)),e._transitionInfo=void 0,e._targetEnter=void 0,e._targetStart=void 0,e._isDirty=!1,e._transform=void 0,e._handleTransform=void 0,e._size=0,e._value=-1,e._pointerEvent=void 0,e._offset=void 0,e._isHide=void 0,e._opacity=255,e._autoHideRemainingTime=void 0,e._rawTargetScale=void 0,e._rawTargetFrame=void 0,e._rawTargetColor=void 0,e}It(e,t);var i=e.prototype;return i.__preload=function(){this.transform.setAnchorPoint(.5,.5),this.handleTransform.setAnchorPoint(.5,.5),this.handle.node.setPosition(0,0),this.adapter&&(this.adapter.scrollManager.on(ou.Event.ON_UPDATE_PERCENTAGE,this._onUpdateScrollbar,this),this._updateVisuals()),this.targetGraphic&&(this._rawTargetScale=this.targetGraphic.node.getScale().clone(),this._rawTargetFrame=this.targetGraphic.spriteFrame,this._rawTargetColor=this.targetGraphic.color.clone()),this._openAutoHide(!0)},i.onEnable=function(){var t=this.node.getComponent(f);t&&(this._opacity=t.color.a),this.adapter&&(this.node[nu]=!0,this.node.on(c.EventType.TOUCH_START,this._onTouchStart,this),this.node.on(c.EventType.TOUCH_MOVE,this._onTouchMove,this),this.node.on(c.EventType.TOUCH_END,this._onTouchEnd,this),this.node.on(c.EventType.TOUCH_CANCEL,this._onTouchEnd,this),this.node.on(c.EventType.MOUSE_ENTER,this._mouseEnter,this),this.node.on(c.EventType.MOUSE_LEAVE,this._mouseLeave,this),this.targetGraphic&&(this.targetGraphic.node.on(c.EventType.MOUSE_ENTER,this._targetMouseEnter,this),this.targetGraphic.node.on(c.EventType.MOUSE_LEAVE,this._targetMouseLeave,this)))},i.onDisable=function(){this.node.off(c.EventType.TOUCH_START,this._onTouchStart,this),this.node.off(c.EventType.TOUCH_MOVE,this._onTouchMove,this),this.node.off(c.EventType.TOUCH_END,this._onTouchEnd,this),this.node.off(c.EventType.TOUCH_CANCEL,this._onTouchEnd,this),this.node.off(c.EventType.MOUSE_ENTER,this._mouseEnter,this),this.node.off(c.EventType.MOUSE_LEAVE,this._mouseLeave,this),this.targetGraphic&&(this.targetGraphic.node.off(c.EventType.MOUSE_ENTER,this._targetMouseEnter,this),this.targetGraphic.node.off(c.EventType.MOUSE_LEAVE,this._targetMouseLeave,this))},i._targetMouseEnter=function(){switch(this._targetEnter=!0,this._openAutoHide(!1),this.transition){case Os.Scale:this._transitionScale(this._targetStart?this.pressedScale:this.hoverScale);break;case Os.SpriteSwap:this._transitionSprite(this._targetStart?this.pressedSprite:this.hoverSprite);break;case Os.ColorTint:this._transitionColor(this._targetStart?this.pressedColor:this.hoverColor)}},i._targetMouseLeave=function(){switch(this._targetEnter=!1,this._openAutoHide(!0),this.transition){case Os.Scale:this._transitionScale(this._targetStart?this.pressedScale:this._rawTargetScale);break;case Os.SpriteSwap:this._transitionSprite(this._targetStart?this.pressedSprite:this._rawTargetFrame);break;case Os.ColorTint:this._transitionColor(this._targetStart?this.pressedColor:this._rawTargetColor)}},i._transitionScale=function(t){t&&this.targetGraphic&&(this._transitionInfo={time:0,from:this.targetGraphic.node.getScale().clone(),to:t})},i._transitionColor=function(t){t&&this.targetGraphic&&(this._transitionInfo={time:0,from:this.targetGraphic.color,to:t})},i._transitionSprite=function(t){t&&this.targetGraphic&&(this.targetGraphic.spriteFrame=t)},i._mouseEnter=function(t){this.interactable&&this._openAutoHide(!1)},i._mouseLeave=function(t){this.interactable&&this._openAutoHide(!0)},i._openAutoHide=function(t){this.enableAutoHide&&(this._autoHideRemainingTime=this.autoHideTime,this._isHide=t,t||this._setOpacity(this._opacity))},i._onTouchStart=function(t){if(this.interactable&&1!=this.size&&0!=this.size){this._openAutoHide(!1),this._pointerEvent=null,this._targetStart=!0;var e=t.getUIStartLocation();if(this._offset=this.handleTransform.convertToNodeSpaceAR(m(e.x,e.y)),Math.abs(this._offset[this.xy])>.5*this.handleTransform[this.wh]){this._offset=null,this._pointerEvent=t;var i=this._calcPercentage(t);this._setPercentage(i)}this.transition==Os.Scale?this._transitionScale(this.pressedScale):this.transition==Os.SpriteSwap?this._transitionSprite(this.pressedSprite):this.transition==Os.ColorTint&&this._transitionColor(this.pressedColor)}},i._onTouchMove=function(t){if(this.interactable&&1!=this.size&&0!=this.size&&this._offset){var e=this._calcPercentage(t,this._offset[this.xy]);this._setPercentage(e)}},i._onTouchEnd=function(t){if(this.interactable&&1!=this.size&&0!=this.size){switch(this._offset=null,this._pointerEvent=null,this._targetStart=!1,this.transition){case Os.Scale:this._transitionScale(this._targetEnter?this.hoverScale:this._rawTargetScale);break;case Os.SpriteSwap:this._transitionSprite(this._targetEnter?this.hoverSprite:this._rawTargetFrame);break;case Os.ColorTint:this._transitionColor(this._targetEnter?this.hoverColor:this._rawTargetColor)}this.adapter.centerManager.scrollToCenter()}},i._setPercentage=function(t){this.adapter.scrollManager.stopScroll(),this.adapter.scrollManager.setPercentage(t)},i._calcPercentage=function(t,e){void 0===e&&(e=0);var i=(this.axis==ys.Horizontal?this.transform.width:this.transform.height)*(1-this.size),n=t.getUILocation(),r=this.transform.convertToNodeSpaceAR(m(n.x,n.y))[this.xy]-e-.5*-this.transform[this.wh];r-=.5*this.handleTransform[this.wh];var o=this.adapter.scrollManager.percentage;switch(this.direction){case Ms.Right_To_Left:case Ms.Top_To_Bottom:o=ks.clamp(1-r/i,this.dragMinLimit,this.dragMaxLimit);break;case Ms.Left_To_Right:case Ms.Bottom_To_Top:o=ks.clamp(r/i,this.dragMinLimit,this.dragMaxLimit)}return this.getSteps(o)},i._onUpdateScrollbar=function(t,e){var i=0,n=0;this.adapter.viewManager.virtualSize>0&&(i=this.adapter.viewManager.virtualSize>=this.adapter.mainAxisSize?ks.clamp01((this.adapter.mainAxisSize-Math.abs(e))/this.adapter.viewManager.virtualSize):1),n=t,this.size=i,this.numberOfSteps>1&&(n=Math.round(n*(this.numberOfSteps-1))/(this.numberOfSteps-1),n=ks.clamp01(n)),this.value=n,this._autoHideRemainingTime=this.autoHideTime,this._setOpacity(this._opacity)},i._updateVisuals=function(){if(this.handleTransform&&this.adapter){var t={x:0,y:0},e={x:0,y:0},i=this.adapter.mainAxis,n=ks.clamp01(this.value)*(1-this.size);t[i]=n,e[i]=n+this.size;var r=this.transform.contentSize[this.wh]-e[i]*this.transform.contentSize[this.wh],o=t[i]*this.transform.contentSize[this.wh],a=this.handle.node.getPosition();switch(this.direction){case Ms.Bottom_To_Top:case Ms.Left_To_Right:a[this.xy]=.5*(o-r);break;case Ms.Top_To_Bottom:case Ms.Right_To_Left:a[this.xy]=.5*(r-o)}this.handleTransform[this.wh]=this.transform.contentSize[this.wh]-r-o,this.handle.node.setPosition(a)}},i.update=function(t){this._clearDirty(),this._autoHide(t),this._tranitionHandler(t)},i._clearDirty=function(){if(this._isDirty&&(this._isDirty=!1,this._updateVisuals(),this._pointerEvent)){var t=this._pointerEvent.getUILocation();this._offset=this.handleTransform.convertToNodeSpaceAR(m(t.x,t.y)),this._pointerEvent=null}},i._autoHide=function(t){if(this.enableAutoHide&&this._isHide&&!(this._autoHideRemainingTime<=0)&&(this._autoHideRemainingTime-=t,this._autoHideRemainingTime<=this.autoHideTime)){this._autoHideRemainingTime=Math.max(0,this._autoHideRemainingTime);var e=this._opacity*(this._autoHideRemainingTime/this.autoHideTime);this._setOpacity(e)}},i._tranitionHandler=function(t){var e=this.targetGraphic;if(this.transition!=Os.None&&e&&this._transitionInfo){this._transitionInfo.time+=t;var i=1;if(this.transitionDuration>0&&(i=this._transitionInfo.time/this.transitionDuration),i>=1&&(i=1),this.transition==Os.Scale){this._transitionInfo.current=e.node.getScale();var n=this._transitionInfo.from,r=this._transitionInfo.to;this._transitionInfo.current.x=ks.lerp(n.x,r.x,i),this._transitionInfo.current.y=ks.lerp(n.y,r.y,i),e.node.setScale(this._transitionInfo.current)}else if(this.transition==Os.ColorTint){var o=this._transitionInfo.from,a=this._transitionInfo.to;X.lerp(yp,o,a,i),e.color=yp}1===i&&(this._transitionInfo=null)}},i._setOpacity=function(t){if(this.handle){var e=function(e){e&&(yp.set(e.color),yp.a=t,e.color=yp)};e(this.node.getComponent(f)),e(this.handle.getComponent(f))}},i.getSteps=function(t){return this.numberOfSteps>1&&(t=Math.round(t*(this.numberOfSteps-1))/(this.numberOfSteps-1),t=ks.clamp(t,this.dragMinLimit,this.dragMaxLimit)),t},xt(e,[{key:"transition",get:function(){return this._transition},set:function(t){t!=this._transition&&(this._transition=t,t!=Os.None&&(this.targetGraphic||(this.targetGraphic=this.handle)))}},{key:"size",get:function(){return this._size},set:function(t){t!=this._size&&(this._size=ks.clamp(t,.01,1),this._isDirty=!0)}},{key:"value",get:function(){return this._value},set:function(t){t!=this._value&&(this._value=this.getSteps(t),this._isDirty=!0)}},{key:"stepSize",get:function(){return this.numberOfSteps>1?1/(this.numberOfSteps-1):.1}},{key:"transform",get:function(){return this._transform||(this._transform=this.node.getComponent(B)),this._transform}},{key:"handleTransform",get:function(){return this.handle?(this._handleTransform||(this._handleTransform=this.handle.node.getComponent(B)),this._handleTransform):null}},{key:"xy",get:function(){return this.axis==ys.Horizontal?"x":"y"}},{key:"wh",get:function(){return this.axis==ys.Horizontal?"width":"height"}},{key:"axis",get:function(){return this.direction==Ms.Left_To_Right||this.direction==Ms.Right_To_Left?ys.Horizontal:ys.Vertical}}]),e}(o)).prototype,"adapter",[Eh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Zh=Mt(Wh.prototype,"handle",[Ah],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Yh=Mt(Wh.prototype,"direction",[Ch],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Ms.Top_To_Bottom}}),jh=Mt(Wh.prototype,"interactable",[Ph],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Kh=Mt(Wh.prototype,"dragMinLimit",[Mh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Xh=Mt(Wh.prototype,"dragMaxLimit",[Ih],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),Jh=Mt(Wh.prototype,"_transition",[Nh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return Os.None}}),Mt(Wh.prototype,"transition",[Lh],Object.getOwnPropertyDescriptor(Wh.prototype,"transition"),Wh.prototype),Qh=Mt(Wh.prototype,"targetGraphic",[Oh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),$h=Mt(Wh.prototype,"hoverSprite",[Rh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),tp=Mt(Wh.prototype,"pressedSprite",[xh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ep=Mt(Wh.prototype,"hoverColor",[Fh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return X.WHITE.clone()}}),ip=Mt(Wh.prototype,"pressedColor",[Dh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new X(211,211,211,255)}}),np=Mt(Wh.prototype,"hoverScale",[zh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new K(1,1)}}),rp=Mt(Wh.prototype,"pressedScale",[kh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new K(1.2,1.2)}}),op=Mt(Wh.prototype,"transitionDuration",[Vh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.2}}),ap=Mt(Wh.prototype,"numberOfSteps",[Bh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),sp=Mt(Wh.prototype,"enableAutoHide",[Hh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),lp=Mt(Wh.prototype,"autoHideTime",[Uh],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),Gh=Wh));t._RF.pop(),t._RF.push({},"40680UcTm9G/ZhjtPkyAjKr","interface",void 0),t._RF.pop(),t._RF.push({},"0a2997sehVGrL8shCrZiUoV","index",void 0),t._RF.pop(),t._RF.push({},"1d7bcfD/S9Eh5YpiaRITuwz","card_item",void 0);var bp,_p,Sp,wp,Tp,Ep=e.ccclass,Ap=e.property,Cp=(hp=Ep("card_item"),pp=Ap(y),hp((gp=Mt((fp=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return e=t.call.apply(t,[this].concat(n))||this,Nt(e,"label",gp,Lt(e)),e._holder=void 0,e}It(e,t);var i=e.prototype;return i.show=function(t){this._holder=t,this.label.string=t.data.name,this.node.setScale(.3,.3)},i.hide=function(){},i.click=function(){this._holder.adapter.scrollManager.scrollToGroupIndex(1,this._holder.view.index)},i.update=function(){if(this._holder&&this._holder.model){var t=this._holder.adapter.scrollManager.content.convertToWorldSpaceAR(this.node.position),e=this._holder.adapter.scrollManager.view.convertToNodeSpaceAR(t),i=this._holder.adapter.centerManager.getContainerOffset(),n=Math.abs(e[this._holder.adapter.mainAxis])-i,r=Math.abs(n)/this._holder.adapter.mainAxisSize;r=1-r,r=ks.clamp(r,.3,1);var o=this.node.getScale();o[this._holder.adapter.mainAxis]=r,o[this._holder.adapter.crossAxis]=r,this.node.setScale(o)}},e}(o)).prototype,"label",[pp],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),dp=fp))||dp);t._RF.pop(),t._RF.push({},"0735ftw3EhKNYV9hDlICemd","card",void 0);var Pp,Mp,Ip,Np,Lp,Op,Rp,xp,Fp,Dp=e.ccclass,zp=e.property,kp=(bp=Dp("card"),_p=zp(c),bp((Tp=Mt((wp=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return e=t.call.apply(t,[this].concat(n))||this,Nt(e,"prefab",Tp,Lt(e)),e}It(e,t);var i=e.prototype;return i.getPrefab=function(t){return this.prefab},i.getHolder=function(t,e){return new Vp(t,e,this)},i.getView=function(){return new kp(this)},i.initElement=function(t,e){},i.start=function(){for(var t=[],e=0;e<100;e++)t.push({name:e+""});this.modelManager.insert(t)},i.home=function(){M.loadScene("home")},i.typeUpper=function(){this.layoutManager.childAlignment=Cs.UpperLeft},i.typeMiddle=function(){this.layoutManager.childAlignment=Cs.MiddleLeft},i.typeLower=function(){this.layoutManager.childAlignment=Cs.LowerLeft},e}(_h)).prototype,"prefab",[_p],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Sp=wp)),function(t){function e(){return t.apply(this,arguments)||this}It(e,t);var i=e.prototype;return i.onVisible=function(){},i.onDisable=function(){},e}(sc)),Vp=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this)._item=null,e}It(e,t);var i=e.prototype;return i.onCreated=function(){this._item=this.node.getComponent(Cp)},i.onVisible=function(){this._item.show(this)},i.onDisable=function(){this._item.hide()},e}(js);t._RF.pop(),t._RF.push({},"19731fEa31BrqGOk4ZQktW1","chat_Item",void 0);var Bp,Hp,Up,Gp,Wp,qp,Zp,Yp,jp,Kp,Xp,Jp,Qp,$p,td,ed,id,nd=e.ccclass,rd=e.property,od=(Pp=nd("chatItem"),Mp=rd(y),Ip=rd(y),Np=rd(B),Pp((Rp=Mt((Op=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return e=t.call.apply(t,[this].concat(n))||this,Nt(e,"nameLabel",Rp,Lt(e)),Nt(e,"messageLabel",xp,Lt(e)),Nt(e,"messageBg",Fp,Lt(e)),e._holder=null,e._messageLabelTr=void 0,e}It(e,t);var i=e.prototype;return i.onLoad=function(){this._messageLabelTr=this.messageLabel.getComponent(B)},i.onEnable=function(){this.messageLabel.node.on(c.EventType.SIZE_CHANGED,this.onMessageSizeChanged,this)},i.onDisable=function(){this.messageLabel.node.off(c.EventType.SIZE_CHANGED,this.onMessageSizeChanged,this)},i.show=function(t){this._holder=t,this._messageLabelTr.width=0,this.nameLabel.string=this._holder.data.name+"",this.showMessage()},i.hide=function(){this._messageLabelTr.width=0,this.messageBg.width=0},i.showMessage=function(){this.messageLabel.overflow=y.Overflow.NONE,this.messageLabel.string=this._holder.data.message},i.onMessageSizeChanged=function(){var t=this;if(!this._holder||!this.node.active)return console.error("没有显示");var e=this._holder.adapter.crossAxisSize-200;if(this._messageLabelTr.width>e)return this.messageLabel.overflow=y.Overflow.RESIZE_HEIGHT,void(this._messageLabelTr.width=e);this.scheduleOnce((function(){console.log("修改背景"),t.messageBg.setContentSize(t._messageLabelTr.width+40,t._messageLabelTr.height+30),t._holder.transform.height=Math.max(t.messageBg.height,100),t.messageBg.getComponent(Z).updateAlignment()}))},e}(o)).prototype,"nameLabel",[Mp],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),xp=Mt(Op.prototype,"messageLabel",[Ip],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Fp=Mt(Op.prototype,"messageBg",[Np],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Lp=Op))||Lp);t._RF.pop(),t._RF.push({},"26318xrl1JNC6F+BNJU9HS2","chat",void 0);var ad,sd,ld,cd,ud,hd=e.ccclass,pd=e.property,dd=(Bp=hd("chat"),Hp=pd(c),Up=pd(c),Gp=pd(B),Wp=pd(f),qp=pd(et),Zp=pd(c),Yp=pd(y),Bp((Xp=Mt((Kp=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return e=t.call.apply(t,[this].concat(n))||this,Nt(e,"myPrefab",Xp,Lt(e)),Nt(e,"youPrefab",Jp,Lt(e)),Nt(e,"header",Qp,Lt(e)),Nt(e,"loading",$p,Lt(e)),Nt(e,"input",td,Lt(e)),Nt(e,"newMsgButton",ed,Lt(e)),Nt(e,"newMsgLabel",id,Lt(e)),e._headerTween=void 0,e._loadTween=void 0,e._newMsgShowTween=void 0,e._newMsgHideTween=void 0,e._isHeaderPlay=!1,e._newMsgTotal=0,e._isShowNewMsg=void 0,e}It(e,t);var i=e.prototype;return i.getPrefab=function(t){return 0==t.type?this.myPrefab:this.youPrefab},i.getHolder=function(t,e){return new fd(t,e,this)},i.getView=function(){return new dd(this)},i.initElement=function(t,e){},i.start=function(){this.releaseManager.on(oh.Event.ON_PULL_DOWN,this.onPullDown,this),this._headerTween=new it(this.header).to(.518,{height:this.releaseManager.top*this.mainAxisSize},{easing:"elasticOut"}),this._loadTween=new it(this.loading.node).by(1,{angle:-360}).union().repeatForever(),this._newMsgShowTween=new it(this.newMsgButton).to(.218,{position:m(this.newMsgButton.position.x,60)},{easing:"smooth"}),this._newMsgHideTween=new it(this.newMsgButton).to(.218,{position:m(this.newMsgButton.position.x,-100)},{easing:"smooth"}),this.viewManager.on(Uc.Event.ON_MAGNETIC,this._onMagnetic,this)},i._onMagnetic=function(t){t?this._newMsgTotal=0:(this.newMsgLabel.string=""+this._newMsgTotal,!this._isShowNewMsg&&this._newMsgTotal>0&&(this._isShowNewMsg=!0,this._newMsgHideTween.stop(),this._newMsgShowTween.start()))},i.onSend=function(){if(0!=this.input.string.length){var t={name:"我",message:this.input.string,type:0};this._newMsgTotal++,this.modelManager.insert(t,0),this.unschedule(this.reply),this.scheduleOnce(this.reply,1)}},i.reply=function(){var t={name:"小娜",message:this.input.string,type:1};this._newMsgTotal++,this.modelManager.insert(t,0)},i.onPullDown=function(){var t=Ot(Rt().mark((function t(e){var i,n,r;return Rt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.state!=Rs.RELEASE){t.next=10;break}if(!this._isHeaderPlay){t.next=10;break}return this._loadTween.start(),e.wait(),t.next=6,this.loadMore();case 6:i=t.sent,this.modelManager.insert(i),this.scheduleOnce((function(){e.release()})),this._loadTween.stop();case 10:n=e.progress,e.state==Rs.WAIT&&(n=1.5),n>=1.5?this._isHeaderPlay||(this._headerTween=new it(this.header).to(.518,{height:this.releaseManager.top*this.mainAxisSize},{easing:"elasticOut"}),this._headerTween.start(),this._isHeaderPlay=!0):(this._headerTween.stop(),this._isHeaderPlay=!1,this.header.height=e.offset,(r=new X).set(this.loading.color),r.a=255*Math.min(n,1),this.loading.color=r),this.loading.node.angle=-360*e.progress;case 14:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}(),i.loadMore=function(){var t=this;return new Promise((function(e,i){for(var n=[],r=(t.modelManager.length,10),o=0;o<r;o++){var a={type:o%2,name:o%2==0?"我":"小娜",message:t.modelManager.length+o+" 历史记录历史记录历史记录历史记录历史记录历史记录历史记录历史记录历史记录历史记录历史记录历史记录历史记录历史记录历史记录！"};n.push(a)}t.scheduleOnce((function(){e(n)}),1)}))},i.scrollToHeader=function(){this.scrollManager.scrollToHeader(1)},i.home=function(){M.loadScene("home")},i.update=function(){this._isShowNewMsg&&this.scrollManager.percentage<.1&&(this._isShowNewMsg=!1,this._newMsgTotal=0,this._newMsgShowTween.stop(),this._newMsgHideTween.start())},e}(_h)).prototype,"myPrefab",[Hp],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Jp=Mt(Kp.prototype,"youPrefab",[Up],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Qp=Mt(Kp.prototype,"header",[Gp],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),$p=Mt(Kp.prototype,"loading",[Wp],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),td=Mt(Kp.prototype,"input",[qp],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ed=Mt(Kp.prototype,"newMsgButton",[Zp],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),id=Mt(Kp.prototype,"newMsgLabel",[Yp],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),jp=Kp)),function(t){function e(){return t.apply(this,arguments)||this}It(e,t);var i=e.prototype;return i.onVisible=function(){},i.onDisable=function(){},e}(sc)),fd=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this)._chatItem=null,e}It(e,t);var i=e.prototype;return i.onCreated=function(){this._chatItem=this.node.getComponent(od)},i.onVisible=function(){this._chatItem.show(this)},i.onDisable=function(){this._chatItem.hide()},e}(js);t._RF.pop(),t._RF.push({},"7afa7DiG+pHAIh2BaoQNrth","edit_item",void 0);var gd,md,vd,yd,bd,_d=e.ccclass,Sd=e.property,wd=(ad=_d("edit_item"),sd=Sd(y),ad((ud=Mt((cd=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return e=t.call.apply(t,[this].concat(n))||this,Nt(e,"label",ud,Lt(e)),e._holder=null,e._tween=void 0,e}It(e,t);var i=e.prototype;return i._onTouchMove=function(t){console.log("移动了我");var e=this.node.getPosition();e.add3f(t.getUIDelta().x,t.getUIDelta().y,0),this.node.setPosition(e)},i.show=function(t){this._holder=t,this.label.string=this._holder.data.name,this._holder.data.anim&&(this._holder.data.anim=!1,this.node.setScale(0,1,1),this._tween=new it(this.node).to(.5,{scale:m(1,1,1)},{easing:"backOut"}).start()),this.register()},i.hide=function(){this._tween&&this._tween.stop(),this.node.setScale(1,1,1),this._holder.data.anim=!1},i.updateData=function(){this._holder.data.name="已更新",this._holder.model.update()},i.updateWrap=function(){this._holder.element.wrapBeforeMode=Ts.Wrap,this._holder.element.update()},i.ignoreLayout=function(){this._holder.element.placeholder=!0,this._holder.element.ignoreLayout=!this._holder.element.ignoreLayout,this._holder.element.ignoreLayout?this._holder.element.layer=ws.Medium:this._holder.element.layer=ws.Lowest,this._holder.element.update(),this.register()},i.register=function(){this.node.off(c.EventType.TOUCH_MOVE,this._onTouchMove,this),this._holder.element.ignoreLayout?(this.node.on(c.EventType.TOUCH_MOVE,this._onTouchMove,this),this.node[nu]=!0):this.node[nu]=!1},i.update=function(){},e}(o)).prototype,"label",[sd],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ld=cd))||ld);t._RF.pop(),t._RF.push({},"40a4crgojVJYY/aveXbUFBt","edit",void 0);var Td,Ed,Ad,Cd,Pd,Md=e.ccclass,Id=e.property,Nd=(gd=Md("edit"),md=Id(c),gd((bd=Mt((yd=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return e=t.call.apply(t,[this].concat(n))||this,Nt(e,"prefab",bd,Lt(e)),e}It(e,t);var i=e.prototype;return i.getPrefab=function(t){return this.prefab},i.getView=function(){return new Nd(this)},i.getHolder=function(t,e){return new Ld(t,e,this)},i.initElement=function(t,e){t.wrapBeforeMode=Ts.Auto},i.start=function(){for(var t=[],e=0;e<50;e++)t.push({name:e});this.modelManager.insert(t)},i.home=function(){M.loadScene("home")},i.scrollToHeader=function(){this.scrollManager.scrollToPercentage(1,0)},i.scrollToFooter=function(){this.scrollManager.scrollToPercentage(1,1)},i.insert=function(){this.modelManager.insert({name:this.modelManager.length,anim:!0},0)},i.remove=function(){this.modelManager.remove(6,1)},i.move=function(){this.modelManager.move(this.modelManager.length-1,1,0)},i.clear=function(){this.modelManager.clear()},e}(_h)).prototype,"prefab",[md],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),vd=yd)),function(t){function e(){return t.apply(this,arguments)||this}It(e,t);var i=e.prototype;return i.onVisible=function(){},i.onDisable=function(){},e}(sc)),Ld=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this)._item=null,e}It(e,t);var i=e.prototype;return i.onCreated=function(){this._item=this.node.getComponent(wd)},i.onVisible=function(){this._item.show(this)},i.onDisable=function(){this._item.hide()},e}(js);t._RF.pop(),t._RF.push({},"20addg1z9tL24Mef9WIwM01","fixed_item",void 0);var Od,Rd,xd,Fd,Dd,zd,kd,Vd=e.ccclass,Bd=e.property,Hd=(Td=Vd("fixed_item"),Ed=Bd(y),Td((Pd=Mt((Cd=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return e=t.call.apply(t,[this].concat(n))||this,Nt(e,"label",Pd,Lt(e)),e._holder=void 0,e}It(e,t);var i=e.prototype;return i.show=function(t){this._holder=t,this.label.string=this._holder.data.name},i.hide=function(){},i.update=function(){},e}(o)).prototype,"label",[Ed],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ad=Cd))||Ad);t._RF.pop(),t._RF.push({},"a0c62+GGSVJfJkgAg7jeAZe","fixed",void 0);var Ud,Gd=e.ccclass,Wd=e.property,qd=(Od=Gd("fixed"),Rd=Wd(c),xd=Wd(c),Od((zd=Mt((Dd=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return e=t.call.apply(t,[this].concat(n))||this,Nt(e,"fixedPrefab",zd,Lt(e)),Nt(e,"normalPrefab",kd,Lt(e)),e}It(e,t);var i=e.prototype;return i.getPrefab=function(t){return t.fixed?this.fixedPrefab:this.normalPrefab},i.getView=function(){return new qd(this)},i.getHolder=function(t,e){return new Zd(t,e,this)},i.initElement=function(t,e){t.fixed=e.fixed,t.fixed&&(t.layer=ws.Medium)},i.home=function(){M.loadScene("home")},i.scrollToHeader=function(){this.scrollManager.scrollToPercentage(1,0)},i.scrollToFooter=function(){this.scrollManager.scrollToPercentage(1,1)},i.start=function(){for(var t=[],e=0;e<1e3;e++){var i={name:e,fixed:e%10==0};t.push(i)}this.modelManager.insert(t)},e}(_h)).prototype,"fixedPrefab",[Rd],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),kd=Mt(Dd.prototype,"normalPrefab",[xd],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Fd=Dd)),function(t){function e(){return t.apply(this,arguments)||this}It(e,t);var i=e.prototype;return i.onVisible=function(){},i.onDisable=function(){},e}(sc)),Zd=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this)._item=null,e}It(e,t);var i=e.prototype;return i.onCreated=function(){this._item=this.node.getComponent(Hd)},i.onVisible=function(){this._item.show(this)},i.onDisable=function(){this._item.hide()},e}(js);t._RF.pop(),t._RF.push({},"a402fmmXFtF6r0IWio7Y0gD","home",void 0);var Yd,jd,Kd,Xd,Jd,Qd=e.ccclass;e.property,Qd("home")(Ud=function(t){function e(){return t.apply(this,arguments)||this}It(e,t);var i=e.prototype;return i.start=function(){},i.go=function(t,e){M.loadScene(e)},e}(o));t._RF.pop(),t._RF.push({},"f2e355YhhRGGLGODyETS6Zp","horiznal_scale_card_item",void 0);var $d,tf,ef,nf,rf,of=e.ccclass,af=e.property,sf=(Yd=of("horiznal_scale_card_item"),jd=af(y),Yd((Jd=Mt((Xd=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return e=t.call.apply(t,[this].concat(n))||this,Nt(e,"label",Jd,Lt(e)),e._holder=void 0,e}It(e,t);var i=e.prototype;return i.start=function(){},i.show=function(t){this._holder=t,this.label.string=t.data.name},i.hide=function(){},i.click=function(){350==this._holder.transform.height?this._holder.transform.height=200:this._holder.transform.height=350},i.lateUpdate=function(){if(this._holder&&this._holder.model){this._holder.view.index;var t=this._holder.adapter.scrollManager.content.convertToWorldSpaceAR(this.node.position),e=this._holder.adapter.scrollManager.view.convertToNodeSpaceAR(t),i=this._holder.adapter.centerManager.getContainerOffset(),n=Math.abs(e[this._holder.adapter.mainAxis])-i,r=Math.abs(n)/this._holder.adapter.mainAxisSize;r=1-r,r=ks.clamp(r,.3,1);var o=this.node.getScale();o[this._holder.adapter.mainAxis]=r,this.node.setScale(o)}},e}(o)).prototype,"label",[jd],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Kd=Xd))||Kd);t._RF.pop(),t._RF.push({},"35843AWcvNIBYC11Ij8+wfZ","horiznal_scale_card",void 0);var lf,cf,uf,hf,pf,df,ff=e.ccclass,gf=e.property,mf=($d=ff("horiznal_scale_card"),tf=gf(l),$d((rf=Mt((nf=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return e=t.call.apply(t,[this].concat(n))||this,Nt(e,"prefab",rf,Lt(e)),e}It(e,t);var i=e.prototype;return i.getPrefab=function(t){return this.prefab},i.getHolder=function(t,e){return new vf(t,e,this)},i.getView=function(){return new mf(this)},i.initElement=function(t,e){},i.start=function(){for(var t=[],e=0;e<20;e++)t.push({name:e,index:e});this.modelManager.insert(t)},i.click=function(){this.scrollManager.scrollToHeader(0)},i.click2=function(){this.scrollManager.scrollToFooter(1)},e}(_h)).prototype,"prefab",[tf],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ef=nf)),function(t){function e(){return t.apply(this,arguments)||this}It(e,t);var i=e.prototype;return i.onVisible=function(){},i.onDisable=function(){},e}(sc)),vf=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this)._script=null,e}It(e,t);var i=e.prototype;return i.onCreated=function(){this._script=this.node.getComponent(sf)},i.onVisible=function(){this._script.show(this)},i.onDisable=function(){this._script.hide()},e}(js);t._RF.pop(),t._RF.push({},"144b8nb7VtKSKwcAg6xFiXY","page_item",void 0);var yf,bf,_f,Sf,wf,Tf,Ef,Af=e.ccclass,Cf=e.property,Pf=(lf=Af("page_item"),cf=Cf(y),lf((pf=Mt((hf=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return e=t.call.apply(t,[this].concat(n))||this,Nt(e,"label",pf,Lt(e)),Nt(e,"isScale",df,Lt(e)),e._holder=void 0,e}It(e,t);var i=e.prototype;return i.show=function(t){this._holder=t,this.label.string=this._holder.data.name},i.hide=function(){},i.click=function(){this.isScale&&this._holder.adapter.scrollManager.scrollToGroupIndex(1,this._holder.view.index)},i.update=function(){if(this.isScale&&this._holder&&this._holder.model){var t=this._holder.adapter.scrollManager.content.convertToWorldSpaceAR(this.node.position),e=this._holder.adapter.scrollManager.view.convertToNodeSpaceAR(t),i=this._holder.adapter.centerManager.getContainerOffset(),n=Math.abs(e[this._holder.adapter.mainAxis])-i,r=Math.abs(n)/this._holder.adapter.mainAxisSize;r=1-r,r=ks.clamp(r,.3,1);var o=this.node.getScale();o[this._holder.adapter.mainAxis]=r,o[this._holder.adapter.crossAxis]=r,this.node.setScale(o)}},e}(o)).prototype,"label",[cf],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),df=Mt(hf.prototype,"isScale",[Cf],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),uf=hf))||uf);t._RF.pop(),t._RF.push({},"333d6buM2ZC6ab6/F873WSZ","item_page",void 0);var Mf,If,Nf,Lf,Of,Rf,xf,Ff,Df,zf=e.ccclass,kf=e.property,Vf=(yf=zf("item_page"),bf=kf(y),_f=kf(c),yf((Tf=Mt((wf=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return e=t.call.apply(t,[this].concat(n))||this,Nt(e,"label",Tf,Lt(e)),Nt(e,"prefab",Ef,Lt(e)),e._holder=null,e}It(e,t);var i=e.prototype;return i.getPrefab=function(t){return this.prefab},i.getView=function(){return new Bf(this)},i.getHolder=function(t,e){return new Hf(t,e,this)},i.initElement=function(t,e){},i.show=function(t){this._holder=t,this.label.string=this._holder.data.name;for(var e=[],i=0;i<10;i++)e.push({name:i});this.modelManager.insert(e)},i.hide=function(){this.modelManager.clear()},e}(_h)).prototype,"label",[bf],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ef=Mt(wf.prototype,"prefab",[_f],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Sf=wf))||Sf),Bf=function(t){function e(){return t.apply(this,arguments)||this}It(e,t);var i=e.prototype;return i.onVisible=function(){},i.onDisable=function(){},e}(sc),Hf=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this)._item=null,e}It(e,t);var i=e.prototype;return i.onCreated=function(){this._item=this.node.getComponent(Pf)},i.onVisible=function(){this._item.show(this)},i.onDisable=function(){this._item.hide()},e}(js);t._RF.pop(),t._RF.push({},"58d34yHUJBMr6bNe9N2eji9","pageView_item",void 0);var Uf,Gf,Wf,qf,Zf,Yf,jf,Kf=e.ccclass,Xf=e.property,Jf=(Mf=Kf("pageView_item"),If=Xf(y),Nf=Xf(l),Lf=Xf(c),Mf((xf=Mt((Rf=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return e=t.call.apply(t,[this].concat(n))||this,Nt(e,"label",xf,Lt(e)),Nt(e,"prefab1",Ff,Lt(e)),Nt(e,"prefab2",Df,Lt(e)),e._holder=void 0,e}It(e,t);var i=e.prototype;return i.getPrefab=function(t){return 0==t.type?this.prefab1:this.prefab2},i.getView=function(){return new Qf(this)},i.getHolder=function(t,e){return new $f(t,e,this)},i.initElement=function(t,e){e.wrapAfter&&(t.wrapAfterMode=e.wrapAfter,t.wrapBeforeMode=e.wrapBefore)},i.show=function(t){this._holder=t,this.label.string=this._holder.data.name;for(var e=[],i=0;i<10;i++){var n={name:i+"",type:i%2};0==this._holder.data.type&&(n.wrapAfter=Ts.Nowrap,n.wrapBefore=i%2==1?Ts.Auto:Ts.Wrap),e.push(n)}this.modelManager.insert(e)},i.hide=function(){this.modelManager.clear()},e}(_h)).prototype,"label",[If],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ff=Mt(Rf.prototype,"prefab1",[Nf],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Df=Mt(Rf.prototype,"prefab2",[Lf],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Of=Rf))||Of),Qf=function(t){function e(){return t.apply(this,arguments)||this}It(e,t);var i=e.prototype;return i.onVisible=function(){},i.onDisable=function(){},e}(sc),$f=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this)._item=null,e}It(e,t);var i=e.prototype;return i.onCreated=function(){},i.onVisible=function(){0!=this.data.type?this._item=this.node.getComponent(Vf):this._item=this.node.getComponent(Pf),this._item.show(this)},i.onDisable=function(){this._item.hide()},e}(js);t._RF.pop(),t._RF.push({},"e19ce/HBJlJTqHa8oS0cj0o","pageView",void 0);var tg,eg,ig,ng,rg,og,ag,sg,lg,cg=e.ccclass,ug=e.property,hg=(Uf=cg("pageView"),Gf=ug(l),Wf=ug(l),Uf((Yf=Mt((Zf=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return e=t.call.apply(t,[this].concat(n))||this,Nt(e,"prefab1",Yf,Lt(e)),Nt(e,"prefab2",jf,Lt(e)),e}It(e,t);var i=e.prototype;return i.getPrefab=function(t){return 0==t.type?this.prefab1:this.prefab2},i.getHolder=function(t,e){return new pg(t,e,this)},i.getView=function(){return new hg(this)},i.initElement=function(t,e){},i.home=function(){M.loadScene("home")},i.start=function(){for(var t=[],e=0;e<10;e++)t.push({name:"# "+e,type:e%2});this.modelManager.insert(t)},i.scrollToPrevPage=function(){this.pageViewManager.scrollToPrevPage()},i.scrollToNextPage=function(){this.pageViewManager.scrollToNextPage()},e}(_h)).prototype,"prefab1",[Gf],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),jf=Mt(Zf.prototype,"prefab2",[Wf],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),qf=Zf)),function(t){function e(){return t.apply(this,arguments)||this}It(e,t);var i=e.prototype;return i.onVisible=function(){},i.onDisable=function(){},e}(sc)),pg=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this)._item=null,e}It(e,t);var i=e.prototype;return i.onCreated=function(){this._item=this.node.getComponent(Jf)},i.onVisible=function(){this._item.show(this)},i.onDisable=function(){this._item.hide()},e}(js);t._RF.pop(),t._RF.push({},"b0e6fDQf+9KYppqhBhEhkiD","summary",void 0);var dg,fg,gg,mg,vg,yg=e.ccclass,bg=e.property,_g=(tg=yg("Summary"),eg=bg(c),ig=bg(c),ng=bg(c),tg((ag=Mt((og=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return e=t.call.apply(t,[this].concat(n))||this,Nt(e,"fixedPrefab",ag,Lt(e)),Nt(e,"normalPrefab1",sg,Lt(e)),Nt(e,"normalPrefab2",lg,Lt(e)),e}It(e,t);var i=e.prototype;return i.getPrefab=function(t){return t.fixed?this.fixedPrefab:1==t.prefabType?this.normalPrefab1:this.normalPrefab2},i.getView=function(){return new _g(this)},i.getHolder=function(t,e){return new Sg(t,e,this)},i.initElement=function(t,e){t.fixed=e.fixed,t.fixed&&(t.layer=ws.Highest)},i.start=function(){for(var t=[],e=0;e<100;e++)t.push({fixed:e%10==0,prefabType:1});this.modelManager.insert(t)},e}(_h)).prototype,"fixedPrefab",[eg],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),sg=Mt(og.prototype,"normalPrefab1",[ig],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),lg=Mt(og.prototype,"normalPrefab2",[ng],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),rg=og)),function(t){function e(){return t.apply(this,arguments)||this}It(e,t);var i=e.prototype;return i.onVisible=function(){},i.onDisable=function(){},e}(sc)),Sg=function(t){function e(){return t.apply(this,arguments)||this}It(e,t);var i=e.prototype;return i.onCreated=function(){},i.onVisible=function(){},i.onDisable=function(){},e}(js);t._RF.pop(),t._RF.push({},"4989d/dj95LEbRXxYKodcL8","test",void 0);var wg,Tg,Eg,Ag,Cg,Pg=e.ccclass,Mg=e.property;dg=Pg("Test"),fg=Mg(c),dg((vg=Mt((mg=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return e=t.call.apply(t,[this].concat(n))||this,Nt(e,"prefab",vg,Lt(e)),e}It(e,t);var i=e.prototype;return i.getPrefab=function(t){return this.prefab},i.start=function(){for(var t=[],e=0;e<100;e++)t.push({name:e,index:e});this.modelManager.insert(t)},e}(_h)).prototype,"prefab",[fg],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),gg=mg));t._RF.pop(),t._RF.push({},"1f6f4j5hlJO1rdYdu2sckN1","test_item",void 0);var Ig,Ng,Lg,Og,Rg,xg,Fg,Dg=e.ccclass,zg=e.property;wg=Dg("TestItem"),Tg=zg(y),wg((Cg=Mt((Ag=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return e=t.call.apply(t,[this].concat(n))||this,Nt(e,"label",Cg,Lt(e)),e._holder=null,e}It(e,t);var i=e.prototype;return i.onLoad=function(){this.node.on(xs.CREATED,this.onCreated,this),this.node.on(xs.VISIBLE,this.onVisible,this),this.node.on(xs.DISABLE,this.onDisabled,this)},i.onCreated=function(){console.log("我收到了创建")},i.onVisible=function(t){console.log("我收到了显示",t.data),this._holder=t,this.label.string=t.data.name},i.onDisabled=function(t){console.log("我收到了隐藏",t)},i.click=function(){350==this._holder.transform.height?this._holder.transform.height=200:this._holder.transform.height=350},i.update=function(){},e}(o)).prototype,"label",[Tg],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Eg=Ag));t._RF.pop(),t._RF.push({},"98c46gtiQRCkYwWq6W0T1lW","time_item",void 0);var kg,Vg,Bg,Hg,Ug,Gg,Wg=e.ccclass,qg=e.property,Zg=(Ig=Wg("TimeItem"),Ng=qg(y),Lg=qg(b),Ig((xg=Mt((Rg=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return e=t.call.apply(t,[this].concat(n))||this,Nt(e,"label",xg,Lt(e)),Nt(e,"opacity",Fg,Lt(e)),e._holder=void 0,e}It(e,t);var i=e.prototype;return i.show=function(t){this._holder=t,this.label.string=this._holder.data.value+" "+this._holder.data.name},i.hide=function(){},i.click=function(){this._holder.adapter.scrollManager.scrollToGroupIndex(.5,this._holder.view.index)},i.lateUpdate=function(t){if(this._holder&&this._holder.model){var e=this._holder.adapter.scrollManager.content.convertToWorldSpaceAR(this.node.position),i=this._holder.adapter.scrollManager.view.convertToNodeSpaceAR(e),n=this._holder.adapter.centerManager.getContainerOffset(),r=i[this._holder.adapter.mainAxis]+n,o=(r=Math.abs(r))/(.85*this._holder.adapter.mainAxisSize);o=1-o;var a=this.node.getScale();a[this._holder.adapter.mainAxis]=o,this.node.setScale(a);var s=1-r/(.5*this._holder.adapter.mainAxisSize);this.opacity.opacity=255*s;var l=36*(1-o),c=.1*r-.1*r*o*Math.cos(l*Math.PI/180);0==this._holder.data.type?this.label.node.setPosition(m(c,0)):2==this._holder.data.type&&this.label.node.setPosition(m(-c,0))}},e}(o)).prototype,"label",[Ng],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Fg=Mt(Rg.prototype,"opacity",[Lg],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Og=Rg))||Og);t._RF.pop(),t._RF.push({},"4a4d813ttpCaZeKBWEWAuzf","time",void 0);var Yg,jg,Kg,Xg,Jg,Qg,$g,tm,em,im=e.ccclass,nm=e.property,rm=(kg=im("Time"),Vg=nm(c),kg((Ug=Mt((Hg=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return e=t.call.apply(t,[this].concat(n))||this,Nt(e,"prefab",Ug,Lt(e)),Nt(e,"type",Gg,Lt(e)),e}It(e,t);var i=e.prototype;return i.getPrefab=function(t){return this.prefab},i.getView=function(){return new om(this)},i.getHolder=function(t,e){return new am(t,e,this)},i.initElement=function(t,e){},i.onLoad=function(){var t=[];if(0==this.type)for(var e=0;e<2e3;e++)t.push({value:1850+e,name:"年",type:this.type});else if(1==this.type)for(var i=0;i<12;i++)t.push({value:i+1,name:"月",type:this.type});else if(2==this.type)for(var n=0;n<31;n++)t.push({value:n+1,name:"日",type:this.type});this.modelManager.insert(t)},i.scrollTo=function(t,e){var i=this.modelManager.modelList.findIndex((function(t){return t.data.value==e}));this.scrollManager.scrollToGroupIndex(t,i)},e}(_h)).prototype,"prefab",[Vg],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Gg=Mt(Hg.prototype,"type",[nm],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Bg=Hg))||Bg),om=function(t){function e(){return t.apply(this,arguments)||this}It(e,t);var i=e.prototype;return i.onVisible=function(){},i.onDisable=function(){},e}(sc),am=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this)._item=void 0,e}It(e,t);var i=e.prototype;return i.onCreated=function(){this._item=this.node.getComponent(Zg)},i.onVisible=function(){this._item.show(this)},i.onDisable=function(){this._item.hide()},e}(js);t._RF.pop(),t._RF.push({},"7bf76HowPBMDpYMlIy7LoYb","time_main",void 0);var sm,lm,cm=e.ccclass,um=e.property;Yg=cm("TimeMain"),jg=um(rm),Kg=um(rm),Xg=um(rm),Yg(($g=Mt((Qg=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return e=t.call.apply(t,[this].concat(n))||this,Nt(e,"timeYear",$g,Lt(e)),Nt(e,"timeMoon",tm,Lt(e)),Nt(e,"timeDay",em,Lt(e)),e}It(e,t);var i=e.prototype;return i.home=function(){M.loadScene("home")},i.now=function(){var t=new Date;this.timeYear.scrollTo(2,t.getFullYear()),this.timeMoon.scrollTo(1,t.getMonth()+1),this.timeDay.scrollTo(1,t.getDate())},i.start=function(){var t=this;this.scheduleOnce((function(){t.now()}))},e}(o)).prototype,"timeYear",[jg],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),tm=Mt(Qg.prototype,"timeMoon",[Kg],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),em=Mt(Qg.prototype,"timeDay",[Xg],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Jg=Qg));t._RF.pop(),t._RF.push({},"60302ameClCGbCam2xkotxy","csvManager",void 0);var hm,pm,dm=e.ccclass,fm=(e.property,[",",";","\t","|","^"]),gm=["\r\n","\r","\n"],mm=function(t,e,i,n){return i instanceof Array?"number"===i[e]?Number(n[e]):"boolean"===i[e]?"true"===n[e]||"t"===n[e]||"1"===n[e]:n[e]:isNaN(Number(t))?"false"==t||"true"==t||"t"==t||"f"==t?"true"===n[e]||"t"===n[e]||"1"===n[e]:n[e]:Number(n[e])},vm={STANDARD_DECODE_OPTS:{skip:0,limit:!1,header:!1,cast:!1,comment:""},STANDARD_ENCODE_OPTS:{delimiter:fm[0],newline:gm[0],skip:0,limit:!1,header:!1},quoteMark:'"',doubleQuoteMark:'""',quoteRegex:/"/g,assign:function(){for(var t=Array.prototype.slice.call(arguments),e=t[0],i=t.slice(1),n=0,r=i.length;n<r;n++)for(var o in i[n])e[o]=i[n][o];return e},map:function(t,e){for(var i=[],n=0,r=t.length;n<r;n++)i[n]=e(t[n],n);return i},getType:function(t){return Object.prototype.toString.call(t).slice(8,-1)},getLimit:function(t,e){return!1===t?e:t},buildObjectConstructor:function(t,e,i){return function(n){var r=new Object,o=function(t,e){return r[t]=e};return i?t.forEach((function(t,r){o(t,mm(e[r],r,i,n))})):t.forEach((function(t,i){o(t,mm(e[i],i,null,n))})),r}},buildArrayConstructor:function(t,e,i){return function(n){var r=new Array(e.length),o=function(t,e){return r[t]=e};return i?t.forEach((function(t,r){o(t,mm(e[r],r,i,n))})):t.forEach((function(t,i){o(t,mm(e[i],i,null,n))})),r}},frequency:function(t,e,i){void 0===i&&(i=!1);for(var n=0,r=0,o=this.getLimit(i,t.length);r<o&&-1!==(r=t.indexOf(e,r));)r+=1,n++;return n},mostFrequent:function(t,e,i){for(var n,r=e.length-1;r>=0;r--)this.frequency(t,e[r],i)>0&&(n=e[r]);return n||e[0]},unsafeParse:function(t,e,i){var n,r,o=t.split(e.newline);function a(t){var i=t.shift();if(i.indexOf('"')>=0){for(var n=0,r=0,o=0;t.length>0&&(-1!==(n=i.indexOf('"',r))||o%2!=0);)-1!==n?(r=n+1,o++):i=i+e.newline+t.shift();var a,s=[],l=0,c=0,u=0,h=i.length;for(var p in i)if(i.hasOwnProperty(p)){var d=parseInt(p),f=i[p];0===d&&'"'===f&&(l++,c=1),'"'===f&&(l++,i[d-1]===e.delimiter&&c===d&&c++),'"'===f&&l%2==0&&(i[d+1]!==e.delimiter&&d+1!==h||(u=d,a=i.substring(c,u),s.push(a),u=c=u+2)),f===e.delimiter&&l%2==0&&((u=d)>c?(a=i.substring(c,u),s.push(a),u=c=u+1):u===c&&(s.push(""),u=c=u+1))}return(u=h)>=c&&(a=i.substring(c,u),s.push(a)),s}return i.split(e.delimiter)}for(e.skip>0&&o.splice(e.skip),e.header?(!0===e.header?(e.comment=a(o),e.cast=a(o),n=a(o)):"Array"===this.getType(e.header)&&(n=e.header),r=this.buildObjectConstructor(n,o[0].split(e.delimiter),e.cast)):r=this.buildArrayConstructor(n,o[0].split(e.delimiter),e.cast);o.length>0;){var s=a(o);s.length>1&&i(r(s),n[0])}return!0},safeParse:function(t,e,i){e.delimiter;var n=e.newline,r=t.split(n);return e.skip>0&&r.splice(e.skip),!0},encodeCells:function(t,e,i){for(var n=t.slice(0),r=0,o=n.length;r<o;r++)-1!==n[r].indexOf(this.quoteMark)&&(n[r]=n[r].replace(this.quoteRegex,this.doubleQuoteMark)),-1===n[r].indexOf(e)&&-1===n[r].indexOf(i)||(n[r]=this.quoteMark+n[r]+this.quoteMark);return n.join(e)},encodeArrays:function(t,e,i){var n=e.delimiter,r=e.newline;e.header&&"Array"===this.getType(e.header)&&i(this.encodeCells(e.header,n,r));for(var o=0,a=this.getLimit(e.limit,t.length);o<a;o++)i(this.encodeCells(t[o],n,r));return!0},encodeObjects:function(t,e,i){var n,r,o=e.delimiter,a=e.newline;for(var s in n=[],r=[],t[0])n.push(s),r.push(t[0][s]);!0===e.header?i(this.encodeCells(n,o,a)):"Array"===this.getType(e.header)&&i(this.encodeCells(e.header,o,a)),i(this.encodeCells(r,o));for(var l=1,c=this.getLimit(e.limit,t.length);l<c;l++){r=[];for(var u=0,h=n.length;u<h;u++)r.push(t[l][n[u]]);i(this.encodeCells(r,o,a))}return!0},parse:function(t,e,i){var n;if("Function"===this.getType(e)?(i=e,e={}):"Function"!==this.getType(i)?i=(n=[]).push.bind(n):n=[],e=this.assign({},this.STANDARD_DECODE_OPTS,e),this.opts=e,!e.delimiter||!e.newline){var r=Math.min(48,Math.floor(t.length/20),t.length);e.delimiter=e.delimiter||this.mostFrequent(t,fm,r),e.newline=e.newline||this.mostFrequent(t,gm,r)}return this.unsafeParse(t,e,i)&&(!(n.length>0)||n)},encode:function(t,e,i){var n;return"Function"===this.getType(e)?(i=e,e={}):"Function"!==this.getType(i)&&(i=(n=[]).push.bind(n)),(e=this.assign({},this.STANDARD_ENCODE_OPTS,e)).skip>0&&(t=t.slice(e.skip)),("Array"===this.getType(t[0])?this.encodeArrays:this.encodeObjects)(t,e,i)&&(!(n.length>0)||n.join(e.newline))}},ym=dm("CSVManager")(((lm=function(){function t(){this._csvTables={},this._csvTableForArr={},this._tableCast={},this._tableComment={}}var e=t.prototype;return e.addTable=function(t,e,i){if(!this._csvTables[t]||i){var n={},r=[];vm.parse(e,{header:!0},(function(t,e){n[t[e]]=t,r.push(t)})),this._tableCast[t]=vm.opts.cast,this._tableComment[t]=vm.opts.comment,this._csvTables[t]=n,this._csvTableForArr[t]=r}},e.getTableArr=function(t){return this._csvTableForArr[t]},e.getTable=function(t){return this._csvTables[t]},e.queryOne=function(t,e,i){var n=this.getTable(t);if(!n)return null;if(!e)return n[i];for(var r in n)if(n.hasOwnProperty(r)&&n[r][e]===i)return n[r]},e.queryByID=function(t,e){return this.queryOne(t,null,e)},e.queryAll=function(t,e,i){var n=this.getTable(t);if(!n||!e)return null;var r={};for(var o in n)n.hasOwnProperty(o)&&n[o][e]===i&&(r[o]=n[o]);return r},e.queryIn=function(t,e,i){var n=this.getTable(t);if(!n||!e)return null;for(var r={},o=Object.keys(n),a=o.length,s=0;s<a;s++){var l=n[o[s]];i.indexOf(l[e])>-1&&(r[o[s]]=l)}return r},e.queryByCondition=function(t,e){if(e.constructor!==Object)return null;var i=this.getTable(t);if(!i)return null;for(var n={},r=Object.keys(i),o=r.length,a=Object.keys(e),s=a.length,l=0;l<o;l++){for(var c=i[r[l]],u=!0,h=0;h<s;h++){var p=a[h];u=u&&e[p]===c[p]&&!n[r[l]]}u&&(n[r[l]]=c)}return n},e.queryOneByCondition=function(t,e){if(e.constructor!==Object)return null;var i=this.getTable(t);if(!i)return null;var n=Object.keys(e),r=n.length;for(var o in i){for(var a=i[o],s=!0,l=0;l<r;l++){var c=n[l];s=s&&e[c]===a[c]}if(s)return a}return null},xt(t,null,[{key:"instance",get:function(){return this._instance||(this._instance=new t),this._instance}}]),t}())._instance=void 0,sm=lm))||sm;t._RF.pop(),t._RF.push({},"aca4damK49DYqlWPDNwTrSS","localConfig",void 0);var bm,_m,Sm=e.ccclass;e.property,Sm("LocalConfig")(((pm=function(){function t(){this._csvManager=new ym,this._callback=new Function,this._currentLoad=0,this._cntLoad=0}var e=t.prototype;return e.loadConfig=function(t){this._callback=t,this._loadCSV()},e._loadCSV=function(){var t=this;a.loadDir("datas",(function(e,i){if(!e){var n=i.filter((function(t){return".md"!==t._native}));t._cntLoad=n.length,n.length?n.forEach((function(e,i,n){Qe.getTextData(e.name,(function(i){t._csvManager.addTable(e.name,i),t._tryToCallbackOnFinished()}))})):t._tryToCallbackOnFinished()}}))},e.queryOne=function(t,e,i){return this._csvManager.queryOne(t,e,i)},e.queryByID=function(t,e){return this._csvManager.queryByID(t,e)},e.getTable=function(t){return this._csvManager.getTable(t)},e.getTableArr=function(t){return this._csvManager.getTableArr(t)},e.queryAll=function(t,e,i){return this._csvManager.queryAll(t,e,i)},e.queryIn=function(t,e,i){return this._csvManager.queryIn(t,e,i)},e.queryByCondition=function(t,e){return this._csvManager.queryByCondition(t,e)},e._tryToCallbackOnFinished=function(){this._callback&&(this._currentLoad++,this._currentLoad>=this._cntLoad&&this._callback())},xt(t,null,[{key:"instance",get:function(){return this._instance||(this._instance=new t),this._instance}}]),t}())._instance=void 0,hm=pm));t._RF.pop(),t._RF.push({},"6743cVJ1/1Ha68y/dyVx1hh","lodash",void 0);var wm,Tm;(0,e.ccclass)("lodash")(((_m=function(){function t(){}return t.find=function(e,i){var n;if(Array.isArray(e)||(e=t._toArray(e)),(n=e.filter(i)).length)return n[0]},t.forEach=function(e,i){Array.isArray(e)?e.forEach(i):t._toArrayKey(e).forEach((function(t,n,r){var o=t.key,a=t.value;i(a,o,e)}))},t.cloneDeep=function(e){if(null===e||"object"!=typeof e)return e;var i={};for(var n in e.constructor===Array&&(i=[]),e)e.hasOwnProperty(n)&&(i[n]=t.cloneDeep(e[n]));return i},t.map=function(e,i){Array.isArray(e)||(e=t._toArray(e));var n=[];return e.forEach((function(t,e,r){n.push(i(t,e,r))})),n},t._toArrayKey=function(t){var e=[];for(var i in t)t.hasOwnProperty(i)&&e.push({key:i,value:t[i]});return e},t._toArray=function(t){var e=[];for(var i in t)t.hasOwnProperty(i)&&e.push(t[i]);return e},t.filter=function(e,i){return Array.isArray(e)||(e=t._toArray(e)),e.filter(i)},t.isEqual=function(e,i){if(!(e instanceof Object)||!(i instanceof Object))return e===i;if(Object.keys(e).length!==Object.keys(i).length)return!1;for(var n in e){var r=e[n]instanceof Object,o=i[n]instanceof Object;if(r&&o)return t.isEqual(e[n],i[n]);if(e[n]!==i[n])return!1}return!0},t.pullAllWith=function(t,e,i){return e.forEach((function(e){t.filter((function(t){return i(t,e)})).forEach((function(e){var i=t.indexOf(e);-1!==t.indexOf(e)&&t.splice(i,1)}))})),t},t.now=function(){return Date.now()},t.pullAll=function(t,e){return e.forEach((function(e){var i=t.indexOf(e);-1!==t.indexOf(e)&&t.splice(i,1)})),t},t.forEachRight=function(e,i){Array.isArray(e)||(e=t._toArray(e));for(var n=e.length-1;n>=0;n--){if(!i(e[n]))break}},t.startsWith=function(t,e,i){return(t=t.substr(i)).startsWith(e)},t.endsWith=function(t,e,i){return(t=t.substr(i)).endsWith(e)},t.remove=function(e,i){var n=[],r=[];return e.forEach((function(t,e){i(t)&&(n.push(t),r.push(e))})),t._basePullAt(e,r),n},t._basePullAt=function(t,e){for(var i,n=t?e.length:0,r=n-1;n--;){var o=e[n];n!==r&&o===i||(i=o,Array.prototype.splice.call(t,o,1))}return t},t.findIndex=function(t,e,i){var n;if(t=t.slice(i),"function"==typeof e){for(n=0;n<t.length;n++)if(e(t[n]))return n}else if(Array.isArray(e))for(n=0;n<t.length;n++){var r=e[0],o=!0;if(e.length>1&&(o=e[1]),t[n][r]===o)return n}else for(n=0;n<t.length;n++)if(t[n]===e)return n;return-1},t.concat=function(){var t=arguments.length;if(!t)return[];for(var e=arguments[0],i=1;i<t;)e=e.concat(arguments[i]),i++;return e},t.isNumber=function(t){return"number"==typeof t},t.indexOf=function(t,e,i){return(t=t.slice(i)).indexOf(e)},t.join=function(t,e){if(null===t)return"";var i="";return t.forEach((function(t){i+=t+e})),i.substr(0,i.length-1)},t.split=function(t,e,i){return t.split(e,i)},t.max=function(t){if(t&&t.length){for(var e,i=0;i<t.length;i++)0===i?e=t[0]:e<t[i]&&(e=t[i]);return e}},t.drop=function(t,e){return(null===t?0:t.length)?t.slice(e):[]},t.flattenDeep=function(e){return e.reduce((function(e,i){return e.concat(Array.isArray(i)?t.flattenDeep(i):i)}),[])},t.uniq=function(t){var e=[];return t.forEach((function(t){-1===e.indexOf(t)&&e.push(t)})),e},t.isNaN=function(e){return t.isNumber(e)&&e!==+e},t.chunk=function(t,e){if(!(null===t?0:t.length)||e<1)return[];for(var i=[];t.length>e;)i.push(t.slice(0,e)),t=t.slice(e);return i.push(t),i},t.toFinite=function(t){var e=1/0;return t?(t=Number(t))===e||t===-1/0?17976931348623157e292*(t<0?-1:1):t==t?t:0:0===t?t:0},t.isObject=function(t){var e=typeof t;return null!==t&&("object"===e||"function"===e)},t.isLength=function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=t.MAX_SAFE_INTEGER},t._isArrayLike=function(e){return null!==e&&t.isLength(e.length)},t.maxBy=function(t,e){if(t&&t.length){for(var i,n,r=0;r<t.length;r++)0===r?(i=e(t[0]),n=t[0]):i<t[r]&&(i=t[r],n=t[r]);return n}},t.minBy=function(t,e){if(t&&t.length){for(var i,n,r=0;r<t.length;r++)0===r?(i=e(t[0]),n=t[0]):i>t[r]&&(i=e(t[r]),n=t[r]);return n}},t.sumBy=function(t,e){var i=0;for(var n in t)i+=e(t[n]);return i},t.countBy=function(t,e){var i={};for(var n in t){var r=e(n);i.hasOwnProperty(r)?i[r]+=1:i[r]=1}return i},t}()).MAX_SAFE_INTEGER=9007199254740991,bm=_m));t._RF.pop(),t._RF.push({},"411ad/aVKtGja0EX2BBJnVT","poolManager",void 0);var Em=e.ccclass;e.property,Em("PoolManager")(((Tm=function(){function t(){this._dictPool={},this._dictPrefab={}}var e=t.prototype;return e.getNode=function(t,e){var i=t.name;t.position||(i=t.data.name),this._dictPrefab[i]=t;var n=null;if(this._dictPool.hasOwnProperty(i)){var r=this._dictPool[i];n=r.size()>0?r.get():A(t)}else{var o=new nt;this._dictPool[i]=o,n=A(t)}return n.parent=e,n.active=!0,n.name=i,n},e.putNode=function(t){if(t){var e=t.name,i=null;this._dictPool.hasOwnProperty(e)?i=this._dictPool[e]:(i=new nt,this._dictPool[e]=i),i.put(t)}},e.clearPool=function(t){this._dictPool.hasOwnProperty(t)&&this._dictPool[t].clear()},e.preloadPool=function(t,e){var i=t.name;t.position||(i=t.data.name);var n=null;this._dictPool.hasOwnProperty(i)?n=this._dictPool[i]:(n=new nt,this._dictPool[i]=n);for(var r=0;r<e;r++){var o=A(t);n.put(o)}},xt(t,null,[{key:"instance",get:function(){return this._instance||(this._instance=new t),this._instance}}]),t}())._instance=void 0,wm=Tm));t._RF.pop(),t._RF.push({},"a4ed0rV6NNLHYnS0I+Yctb7","SceneDefine",void 0);var Am="Home",Cm="Audition",Pm="MagicTile",Mm="Pitch",Im="Karaoke";t._RF.pop(),t._RF.push({},"df029FPrM5K15UvE9hNRhmu","SkinDefine",void 0),t._RF.pop(),t._RF.push({},"f75e0dYk2hItL6AtoKH1J3L","SocketEventDefines",void 0),t._RF.pop(),t._RF.push({},"bb226P25spAXpqOG9j9rTka","SongConstant",void 0);var Nm="music";t._RF.pop(),t._RF.push({},"bc1d75XEItMOZF3HZi0EoA3","APIFakeData",void 0),t._RF.pop(),t._RF.push({},"3b325m3/clNb7s376jIQ9MJ","APIManager",void 0);var Lm=function(){function t(){var t=this;this.baseURL=void 0,this.timeout=void 0,this.MAX_RETAKE_TOKEN=5,this.retakeTokenTimesThisSession=0,this.retakeToken=null,this.onFailedCallback=null,this.isLog=!0,this.log=function(e){t.isLog&&ve.LOG&&console.log("[API] : ",e)},this.baseURL="",this.timeout=3e4}var e=t.prototype;return e.setBaseURL=function(t){this.baseURL=t},e.setTimeout=function(t){this.timeout=t},e.request=function(){var t=Ot(Rt().mark((function t(e,i,n,r,o){var a,s,l,c,u,h,p,d;return Rt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return void 0===o&&(o=null),a=null,s=!1,l=null,o||(o=Rm),t.prev=5,t.next=8,this.fetchWithRetry(e,i);case 8:if((c=t.sent).ok){t.next=11;break}throw{message:"Network response was not ok",statusCode:777};case 11:return t.next=13,c.json();case 13:a=t.sent,this.log("data:"+a),(l=a).statusCode&&200!=l.statusCode&&(s=!0,this.log("Server response ERROR:"+l.message),r(l),null==(u=this.onFailedCallback)||u.call(this,l)),t.next=25;break;case 19:t.prev=19,t.t0=t.catch(5),s=!0,this.log("ERROR:"+t.t0),r(t.t0),null==(h=this.onFailedCallback)||h.call(this,t.t0);case 25:if(!s){try{p=Om.AES.decrypt(l.data,o),d=p.toString(Om.enc.Utf8),l.data=JSON.parse(d)}catch(t){this.log("resData: ERROR"+t)}n(l)}case 26:case"end":return t.stop()}}),t,this,[[5,19]])})));return function(e,i,n,r,o){return t.apply(this,arguments)}}(),e.fetchWithRetry=function(){var t=Ot(Rt().mark((function t(e,i,n){var r,o,a;return Rt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:void 0===n&&(n=3),r=0;case 2:if(!(r<n)){t.next=28;break}return t.prev=3,o=this.baseURL+e,this.log("fetch "+o),t.next=8,this.timeoutPromise(fetch(o,i));case 8:if(401!=(a=t.sent).status||!this.retakeToken){t.next=16;break}if(this.log("try get new token"),!(++this.retakeTokenTimesThisSession<=this.MAX_RETAKE_TOKEN)){t.next=16;break}return t.next=14,this.retakeToken();case 14:t.sent&&(i.headers=Fm());case 16:if(!a.ok){t.next=18;break}return t.abrupt("return",a);case 18:t.next=24;break;case 20:if(t.prev=20,t.t0=t.catch(3),r!==n-1){t.next=24;break}throw t.t0;case 24:r++,this.log("retry attemptes:"+r),t.next=2;break;case 28:throw{message:"All retries failed",statusCode:666};case 29:case"end":return t.stop()}}),t,this,[[3,20]])})));return function(e,i,n){return t.apply(this,arguments)}}(),e.timeoutPromise=function(t){var e=this;return new Promise((function(i,n){var r=setTimeout((function(){return n(new Error("Request timed out"))}),e.timeout);t.then((function(t){clearTimeout(r),i(t)}),(function(t){clearTimeout(r),n(t)}))}))},t}(),Om=window.CryptoJS,Rm="",xm=new Lm;xm.onFailedCallback=function(t){},setInterval((function(){return}),3e5);var Fm=function(){return{Authorization:"Bearer ","Content-Type":"application/json"}};t._RF.pop(),t._RF.push({},"399f2AVXt9B5ozV4m+hAt4r","GameManager",void 0);var Dm=function(){function t(){this.userInfo=null,this.isNeedToReload=!1,this.isShouldSync=!0,this.initGameEvents()}var e=t.prototype;return e.initGameEvents=function(){I.on(rt.EVENT_HIDE,(function(){ve.LOG&&console.log("GameManager: on game hided")}))},e.setUserInfo=function(t){this.userInfo=t,this.isNeedToReload=!1,this.isShouldSync=!0},t}();Dm.instance=null,Dm.instance=new Dm,t._RF.pop(),t._RF.push({},"29ee18T099MnaDN9VHyT8uY","AuditionSongModel",void 0),t._RF.pop(),t._RF.push({},"af924z6pApFx55QJTlI1nlf","KaraokeTypes",void 0);var zm,km,Vm="karaoke/lyrics";t._RF.pop(),t._RF.push({},"5fc5f+jwVVKKZ2fyjN9A0/o","KaraokeSongModel",void 0),(km=zm||(zm={})).getLyricPath=function(t){return Vm+"/"+(t.lyricPath||t.id)},km.getBeatmapPath=function(t){return Nm+"/"+(t.musicPath||t.id)+"_beat"},t._RF.pop(),t._RF.push({},"12489oNGpZFfYaPjF1Ir4kw","MTDefines",void 0);var Bm,Hm,Um,Gm,Wm,qm,Zm,Ym,jm,Km,Xm,Jm,Qm,$m,tv,ev,iv,nv,rv,ov,av,sv,lv,cv="magic_tiles/midi",uv=function(t){return t[t.TAP=0]="TAP",t[t.HOLD=1]="HOLD",t[t.SLIDE=2]="SLIDE",t}({});t._RF.pop(),t._RF.push({},"27ac05hMORHgqIDpEPGG3ky","MTSongModel",void 0),(Bm||(Bm={})).getMidiPath=function(t){return cv+"/"+(t.midiPath||t.id)},t._RF.pop(),t._RF.push({},"6f301gGi7hEv5pCamsfrbSo","SongModel",void 0),(Hm||(Hm={})).getMusicPath=function(t){return Nm+"/"+(t.musicPath||t.id)},t._RF.pop(),t._RF.push({},"2863714705FO4J9mAWwN/3b","UserModel",void 0),t._RF.pop(),t._RF.push({},"3407dOpf11DQZytuXaeEQcr","AuditionNoteVisual",void 0);var hv,pv,dv,fv,gv,mv,vv,yv,bv,_v,Sv,wv,Tv=e.ccclass,Ev=e.property,Av=(Um=Tv("AuditionNoteVisual"),Gm=Ev(f),Wm=Ev(f),qm=Ev(b),Zm=Ev(X),Ym=Ev(X),jm=Ev(X),Km=Ev(X),Xm=Ev(X),Um(($m=Mt((Qm=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return e=t.call.apply(t,[this].concat(n))||this,Nt(e,"noteSprite",$m,Lt(e)),Nt(e,"glowSprite",tv,Lt(e)),Nt(e,"opacity",ev,Lt(e)),Nt(e,"pulseSpeed",iv,Lt(e)),Nt(e,"pulseIntensity",nv,Lt(e)),Nt(e,"leftNoteColor",rv,Lt(e)),Nt(e,"rightNoteColor",ov,Lt(e)),Nt(e,"perfectColor",av,Lt(e)),Nt(e,"goodColor",sv,Lt(e)),Nt(e,"missColor",lv,Lt(e)),e.hitAnimDuration=.2,e.missAnimDuration=.4,e.appearAnimDuration=.05,e.activeTweens=[],e.originalScale=new g(1,1,1),e.isHit=!1,e}It(e,t);var i=e.prototype;return i.onLoad=function(){this.node&&(this.originalScale=this.node.getScale().clone()),this.opacity||(this.opacity=this.getComponent(b),this.opacity||(this.opacity=this.addComponent(b)))},i.initialize=function(){this.isHit=!1,this.node.setScale(this.originalScale),this.node.setRotation(0,0,0,1),this.opacity&&(this.opacity.opacity=255)},i.playAppearAnimation=function(){var t=this;if(this.node){this.stopAllTweens(),this.node.setScale(0,0,1);var e=v(this.node).to(this.appearAnimDuration,{scale:this.originalScale},{easing:"backOut"}).call((function(){t.startPulseAnimation()})).start();this.activeTweens.push(e)}},i.startPulseAnimation=function(){if(this.node&&!this.isHit){this.stopAllTweens();var t=v(this.node).to(this.pulseSpeed/2,{scale:new g(this.originalScale.x*(1+this.pulseIntensity),this.originalScale.y*(1+this.pulseIntensity),this.originalScale.z)},{easing:"sineInOut"}).to(this.pulseSpeed/2,{scale:this.originalScale},{easing:"sineInOut"}).union().repeatForever().start();this.activeTweens.push(t)}},i.stopAllTweens=function(){this.activeTweens.forEach((function(t){return t.stop()})),this.activeTweens=[]},i.showHitEffect=function(){if(this.node){this.isHit=!0,this.stopAllTweens();var t=new g(1.5*this.originalScale.x,1.5*this.originalScale.y,this.originalScale.z),e=v(this.node).to(this.hitAnimDuration/3,{scale:t},{easing:"quadOut"}).to(2*this.hitAnimDuration/3,{scale:this.originalScale},{easing:"quadIn"}).start();if(this.activeTweens.push(e),this.opacity){var i=v(this.opacity).to(this.hitAnimDuration,{opacity:50}).start();this.activeTweens.push(i)}}},i.showMissEffect=function(){var t=this;if(this.node){this.isHit=!0,this.stopAllTweens(),this.glowSprite&&(this.glowSprite.color=this.missColor,this.glowSprite.node.active=!0);var e=new g(this.node.position.x,this.node.position.y-50,this.node.position.z),i=v(this.node).to(this.missAnimDuration,{position:e,scale:new g(.7*this.originalScale.x,.7*this.originalScale.y,this.originalScale.z)},{easing:"quadIn"}).call((function(){t.node.active=!1})).start();if(this.activeTweens.push(i),this.opacity){var n=v(this.opacity).to(this.missAnimDuration,{opacity:0}).start();this.activeTweens.push(n)}}},i.reset=function(){this.stopAllTweens(),this.node.setScale(this.originalScale),this.node.setRotation(0,0,0,1),this.opacity&&(this.opacity.opacity=255),this.glowSprite&&(this.glowSprite.node.active=!1),this.isHit=!1},e}(o)).prototype,"noteSprite",[Gm],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),tv=Mt(Qm.prototype,"glowSprite",[Wm],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ev=Mt(Qm.prototype,"opacity",[qm],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),iv=Mt(Qm.prototype,"pulseSpeed",[Ev],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),nv=Mt(Qm.prototype,"pulseIntensity",[Ev],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.2}}),rv=Mt(Qm.prototype,"leftNoteColor",[Zm],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new X(79,195,247)}}),ov=Mt(Qm.prototype,"rightNoteColor",[Ym],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new X(255,112,67)}}),av=Mt(Qm.prototype,"perfectColor",[jm],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new X(120,255,120)}}),sv=Mt(Qm.prototype,"goodColor",[Km],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new X(255,193,7)}}),lv=Mt(Qm.prototype,"missColor",[Xm],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new X(211,47,47)}}),Jm=Qm))||Jm);t._RF.pop(),t._RF.push({},"d703e2K9thB05Xmm4wf/DzN","AuditionAudioManager",void 0);var Cv,Pv,Mv,Iv,Nv,Lv,Ov,Rv,xv,Fv=e.ccclass,Dv=e.property,zv=(hv=Fv("AuditionAudioManager"),pv=Dv(N),dv=Dv(N),fv=Dv({range:[0,1]}),gv=Dv({range:[0,1]}),hv((yv=Mt((vv=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return e=t.call.apply(t,[this].concat(n))||this,Nt(e,"musicSource",yv,Lt(e)),Nt(e,"sfxSource",bv,Lt(e)),Nt(e,"audioOffset",_v,Lt(e)),Nt(e,"musicVolume",Sv,Lt(e)),Nt(e,"sfxVolume",wv,Lt(e)),e.soundEffects=new Map,e.startTime=0,e.isPaused=!1,e.pauseTime=0,e}It(e,t);var i=e.prototype;return i.onLoad=function(){this.musicSource||(this.musicSource=this.node.addComponent(N),this.musicSource.loop=!0,this.musicSource.volume=this.musicVolume),this.sfxSource||(this.sfxSource=this.node.addComponent(N),this.sfxSource.loop=!1,this.sfxSource.volume=this.sfxVolume),this.loadSoundEffects()},i.loadSoundEffects=function(){var t=this;["good","miss","s_ready","s_go"].forEach((function(e){Qe.loadRes("audition/audio/sfx/"+e,L,(function(i,n){i?console.error("Failed to load sound effect: "+e,i):(t.soundEffects.set(e,n),console.log("Sound effect loaded: "+e))}))}));for(var e=function(){var e=1===i?"perfect":"perfect"+i;Qe.loadRes("audition/audio/sfx/"+e,L,(function(i,n){i?console.error("Failed to load perfect sound effect: "+e,i):(t.soundEffects.set(e,n),console.log("Perfect sound effect loaded: "+e))}))},i=1;i<=5;i++)e()},i.loadSong=function(t){var e=this;return new Promise((function(i,n){console.log("Loading song: "+t),Qe.loadRes(t,L,(function(r,o){if(r)return console.error("Failed to load song: "+t,r),void n(r);e.musicSource.clip=o,console.log("Song loaded: "+t),i()}))}))},i.playSong=function(t){void 0===t&&(t=0),this.musicSource.clip?(this.musicSource.currentTime=t/1e3,this.startTime=Date.now()-t,this.isPaused=!1,this.musicSource.play(),console.log("Playing song from "+t+"ms")):console.error("No song loaded")},i.pauseSong=function(){this.musicSource.playing&&(this.musicSource.pause(),this.isPaused=!0,this.pauseTime=this.getCurrentTime(),console.log("Song paused at "+this.pauseTime+"ms"))},i.resumeSong=function(){this.isPaused&&(this.musicSource.play(),this.startTime=Date.now()-this.pauseTime,this.isPaused=!1,console.log("Song resumed from "+this.pauseTime+"ms"))},i.stopSong=function(){this.musicSource.stop(),this.isPaused=!1,console.log("Song stopped")},i.getCurrentTime=function(){return this.isPaused?this.pauseTime:1e3*this.musicSource.currentTime},i.getDuration=function(){return 1e3*this.musicSource.clip.getDuration()},i.playSound=function(t){var e=this.soundEffects.get(t);e?this.sfxSource.playOneShot(e):console.warn("Sound effect not found: "+t)},i.setMusicVolume=function(t){this.musicVolume=Math.max(0,Math.min(1,t)),this.musicSource.volume=this.musicVolume},i.setSfxVolume=function(t){this.sfxVolume=Math.max(0,Math.min(1,t)),this.sfxSource.volume=this.sfxVolume},i.getMusicVolume=function(){return this.musicVolume},i.getSfxVolume=function(){return this.sfxVolume},i.setAudioOffset=function(t){this.audioOffset=t,console.log("Audio offset set to "+t+"ms")},i.getAudioOffset=function(){return this.audioOffset},i.calibrateAudioOffset=function(){console.log("Audio calibration initiated"),this.audioOffset=-50,console.log("Audio calibrated with offset: "+this.audioOffset+"ms")},e}(o)).prototype,"musicSource",[pv],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),bv=Mt(vv.prototype,"sfxSource",[dv],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_v=Mt(vv.prototype,"audioOffset",[Dv],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Sv=Mt(vv.prototype,"musicVolume",[fv],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.7}}),wv=Mt(vv.prototype,"sfxVolume",[gv],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),mv=vv))||mv);t._RF.pop(),t._RF.push({},"3e57c37p+BC+q4zA+47ifrI","AuditionInputHandler",void 0);var kv,Vv,Bv,Hv,Uv,Gv,Wv,qv,Zv,Yv=e.ccclass,jv=e.property,Kv=function(t){return t[t.LEFT=0]="LEFT",t[t.RIGHT=1]="RIGHT",t[t.SPACE=2]="SPACE",t}({}),Xv=(Cv=Yv("AuditionInputHandler"),Pv=jv(c),Mv=jv(c),Iv=jv(c),Cv((Ov=Mt((Lv=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return e=t.call.apply(t,[this].concat(n))||this,Nt(e,"leftInputArea",Ov,Lt(e)),Nt(e,"rightInputArea",Rv,Lt(e)),Nt(e,"spaceInputArea",xv,Lt(e)),e.isInputEnabled=!0,e.inputCallbacks=new Map,e.lastInputTime=new Map,e.inputDebounceTime=100,e}It(e,t);var i=e.prototype;return i.onLoad=function(){this.initialize()},i.initialize=function(){this.inputCallbacks.set(Kv.LEFT,[]),this.inputCallbacks.set(Kv.RIGHT,[]),this.inputCallbacks.set(Kv.SPACE,[]),this.lastInputTime.set(Kv.LEFT,0),this.lastInputTime.set(Kv.RIGHT,0),this.lastInputTime.set(Kv.SPACE,0),this.registerTouchEvents(),this.registerKeyboardEvents(),console.log("Audition Input Handler initialized")},i.registerTouchEvents=function(){var t=this;this.leftInputArea&&this.leftInputArea.on(z.EventType.TOUCH_START,(function(e){t.isInputEnabled&&t.handleInput(Kv.LEFT)})),this.rightInputArea&&this.rightInputArea.on(z.EventType.TOUCH_START,(function(e){t.isInputEnabled&&t.handleInput(Kv.RIGHT)})),this.spaceInputArea&&this.spaceInputArea.on(z.EventType.TOUCH_START,(function(e){t.isInputEnabled&&t.handleInput(Kv.SPACE)}))},i.registerKeyboardEvents=function(){var t=this;D.on(z.EventType.KEY_DOWN,(function(e){if(t.isInputEnabled)switch(e.keyCode){case R.ARROW_LEFT:case R.KEY_A:t.handleInput(Kv.LEFT);break;case R.ARROW_RIGHT:case R.KEY_D:t.handleInput(Kv.RIGHT);break;case R.SPACE:t.handleInput(Kv.SPACE)}}))},i.handleInput=function(t){var e=Date.now(),i=this.lastInputTime.get(t);if(!(e-i<this.inputDebounceTime)){this.lastInputTime.set(t,e);var n=this.inputCallbacks.get(t);n&&n.forEach((function(t){return t(e)})),console.log("Input detected: "+Kv[t])}},i.registerInputCallback=function(t,e){var i=this.inputCallbacks.get(t);i&&i.push(e)},i.unregisterInputCallback=function(t,e){var i=this.inputCallbacks.get(t);if(i){var n=i.indexOf(e);-1!==n&&i.splice(n,1)}},i.setInputEnabled=function(t){this.isInputEnabled=t,console.log("Input "+(t?"enabled":"disabled"))},i.getInputEnabled=function(){return this.isInputEnabled},i.setInputDebounceTime=function(t){this.inputDebounceTime=t},i.getInputDebounceTime=function(){return this.inputDebounceTime},i.simulateInput=function(t,e){this.lastInputTime.set(t,e);var i=this.inputCallbacks.get(t);i&&i.forEach((function(t){return t(e)})),console.log("Simulated input: "+Kv[t])},e}(o)).prototype,"leftInputArea",[Pv],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Rv=Mt(Lv.prototype,"rightInputArea",[Mv],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),xv=Mt(Lv.prototype,"spaceInputArea",[Iv],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Nv=Lv))||Nv);t._RF.pop(),t._RF.push({},"dcf6eWvaXRMR72esUo9n+2S","AuditionNotePool",void 0);var Jv,Qv,$v,ty,ey,iy=e.ccclass,ny=e.property,ry=function(t){return t[t.LEFT=0]="LEFT",t[t.RIGHT=1]="RIGHT",t}({}),oy=(kv=iy("AuditionNotePool"),Vv=ny(l),Bv=ny(l),kv((Gv=Mt((Uv=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return e=t.call.apply(t,[this].concat(n))||this,Nt(e,"leftNotePrefab",Gv,Lt(e)),Nt(e,"rightNotePrefab",Wv,Lt(e)),Nt(e,"initialPoolSize",qv,Lt(e)),Nt(e,"expandPoolAmount",Zv,Lt(e)),e.leftNotePool=[],e.rightNotePool=[],e.activeNotes=new Map,e.nextNoteId=0,e}It(e,t);var i=e.prototype;return i.onLoad=function(){this.initializePools()},i.initializePools=function(){this.leftNotePrefab&&this.createPool(ry.LEFT,this.initialPoolSize),this.rightNotePrefab&&this.createPool(ry.RIGHT,this.initialPoolSize)},i.createPool=function(t,e){var i=this.getPoolForType(t),n=this.getPrefabForType(t);if(n){for(var r=0;r<e;r++){var o=A(n);o.parent=this.node,o.active=!1,i.push(o)}console.log("Created pool for note type "+t+" with "+e+" notes")}else console.error("No prefab defined for note type: "+t)},i.getNote=function(t){var e=this.getPoolForType(t);0===e.length&&this.expandPool(t);var i=e.pop();if(!i)return console.error("Failed to get note of type "+t+" from pool"),null;i.active=!0;var n=this.nextNoteId++;return this.activeNotes.set(n,i),{id:n,node:i}},i.recycleNote=function(t){var e=this.activeNotes.get(t);if(e){e.active=!1,e.setPosition(0,0,0),e.setScale(1,1,1);var i=this.getNoteTypeFromNode(e);this.getPoolForType(i).push(e),this.activeNotes.delete(t)}else console.warn("Note with ID "+t+" not found in active notes")},i.recycleAllNotes=function(){var t=this;Array.from(this.activeNotes.keys()).forEach((function(e){return t.recycleNote(e)}))},i.expandPool=function(t){console.log("Expanding pool for note type "+t+" with "+this.expandPoolAmount+" more notes"),this.createPool(t,this.expandPoolAmount)},i.getPoolForType=function(t){switch(t){case ry.LEFT:return this.leftNotePool;case ry.RIGHT:return this.rightNotePool;default:return console.error("Unknown note type: "+t),null}},i.getPrefabForType=function(t){switch(t){case ry.LEFT:return this.leftNotePrefab;case ry.RIGHT:return this.rightNotePrefab;default:return console.error("Unknown note type: "+t),null}},i.getNoteTypeFromNode=function(t){return t.name.toLowerCase().includes("left")?ry.LEFT:ry.RIGHT},i.getActiveNoteCount=function(){return this.activeNotes.size},i.getAvailableNoteCount=function(t){var e=this.getPoolForType(t);return e?e.length:0},e}(o)).prototype,"leftNotePrefab",[Vv],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Wv=Mt(Uv.prototype,"rightNotePrefab",[Bv],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),qv=Mt(Uv.prototype,"initialPoolSize",[ny],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 20}}),Zv=Mt(Uv.prototype,"expandPoolAmount",[ny],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 10}}),Hv=Uv))||Hv);t._RF.pop(),t._RF.push({},"b06301HH+lNDJwPFjxXjoas","AuditionNote",void 0);var ay,sy,ly,cy,uy,hy,py,dy,fy,gy,my,vy,yy,by,_y,Sy,wy,Ty,Ey,Ay,Cy,Py,My,Iy,Ny,Ly,Oy,Ry,xy,Fy,Dy,zy,ky,Vy,By,Hy,Uy,Gy=e.ccclass,Wy=e.property,qy=(Jv=Gy("AuditionNote"),Qv=Wy(Av),Jv((ey=Mt((ty=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return e=t.call.apply(t,[this].concat(n))||this,Nt(e,"noteVisual",ey,Lt(e)),e.noteType=ry.LEFT,e.beatTime=0,e.targetY=0,e.startY=0,e.isMoving=!1,e.noteId=-1,e}It(e,t);var i=e.prototype;return i.initialize=function(t,e,i){switch(this.noteType=t,this.beatTime=e,this.noteId=i,this.noteVisual?this.noteVisual.initialize():console.warn("Note visual component is not assigned!"),this.noteType){case ry.LEFT:this.node.name="LeftNote";break;case ry.RIGHT:this.node.name="RightNote"}},i.playHitEffect=function(t){this.isMoving=!1,this.noteVisual&&this.noteVisual.showHitEffect()},i.playMissEffect=function(){this.isMoving=!1,this.noteVisual&&this.noteVisual.showMissEffect()},i.reset=function(){this.isMoving=!1,this.noteVisual&&this.noteVisual.reset(),this.node.active=!0},i.matchesInput=function(t){return this.noteType===t},i.getNoteId=function(){return this.noteId},i.getNoteType=function(){return this.noteType},e}(o)).prototype,"noteVisual",[Qv],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),$v=ty))||$v);t._RF.pop(),t._RF.push({},"e8f01vW2ehGAbebHt2Bdk2+","AuditionBeatSystem",void 0);var Zy,Yy=e.ccclass,jy=e.property,Ky=function(t){return t[t.PERFECT=0]="PERFECT",t[t.GOOD=1]="GOOD",t[t.MISS=2]="MISS",t}({}),Xy=function(t){return t.OFF="off",t.LEVEL="lv",t.FINISH="finish",t}({}),Jy=(ay=Yy("AuditionBeatSystem"),sy=jy({type:c,group:{name:"Visual Elements",id:"visual"}}),ly=jy({type:c,group:{name:"Visual Elements",id:"visual"}}),cy=jy({type:c,group:{name:"Visual Elements",id:"visual"}}),uy=jy({type:c,group:{name:"Visual Elements",id:"visual"}}),hy=jy({type:f,group:{name:"Visual Elements",id:"visual"}}),py=jy({type:b,group:{name:"Visual Elements",id:"visual"}}),dy=jy({type:y,group:{name:"Visual Elements",id:"visual"}}),fy=jy({type:zv,group:{name:"Visual Elements",id:"visual"}}),gy=jy({type:Xv,group:{name:"Input",id:"input"}}),my=jy({group:{name:"Beat Settings",id:"beat"}}),vy=jy({group:{name:"Beat Settings",id:"beat"}}),yy=jy({group:{name:"Timing Windows",id:"timing"}}),by=jy({group:{name:"Timing Windows",id:"timing"}}),_y=jy({group:{name:"Timing Windows",id:"timing"}}),Sy=jy({type:oy,group:{name:"Note Settings",id:"notes"}}),wy=jy({type:c,group:{name:"Note Settings",id:"notes"}}),Ty=jy({type:ot,group:{name:"Note Settings",id:"notes"}}),ay((Cy=Mt((Ay=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return e=t.call.apply(t,[this].concat(n))||this,Nt(e,"movingBeatNote",Cy,Lt(e)),Nt(e,"targetZone",Py,Lt(e)),Nt(e,"startNode",My,Lt(e)),Nt(e,"endNode",Iy,Lt(e)),Nt(e,"heartBeatSprite",Ny,Lt(e)),Nt(e,"opacityGameplay",Ly,Lt(e)),Nt(e,"levelLabel",Oy,Lt(e)),Nt(e,"audioManager",Ry,Lt(e)),Nt(e,"inputHandler",xy,Lt(e)),Nt(e,"bpm",Fy,Lt(e)),Nt(e,"beatsPerLoop",Dy,Lt(e)),Nt(e,"perfectWindow",zy,Lt(e)),Nt(e,"goodWindow",ky,Lt(e)),Nt(e,"missWindow",Vy,Lt(e)),Nt(e,"notePool",By,Lt(e)),Nt(e,"nodeContainer",Hy,Lt(e)),Nt(e,"nodeDistance",Uy,Lt(e)),e.isPlaying=!1,e.timingWindows=new Map,e.currentLoop=0,e.lastBeatTime=0,e.songDuration=0,e.isAutoPlay=!1,e.scoringCallback=null,e.readyCallback=null,e.levelChangedCallback=null,e.startX=-500,e.endX=500,e.targetX=0,e.noteSpeed=0,e.noteDelay=0,e.currentLevel=0,e.currentLevelLoop=0,e.requiredNotes=0,e.currentNotes=0,e.isInDelay=!1,e.delayLoops=0,e.levelSequences=[],e.currentSequenceIndex=0,e.penaltyPatternLoops=0,e.activeNoteIds=[],e.noteSequence=[],e.currentSequenceNotes=[],e}It(e,t);var i=e.prototype;return i.onLoad=function(){this.timingWindows.set(Ky.PERFECT,this.perfectWindow),this.timingWindows.set(Ky.GOOD,this.goodWindow),this.timingWindows.set(Ky.MISS,this.missWindow),this.startX=this.startNode.position.x,this.endX=this.endNode.position.x,this.targetX=this.targetZone.position.x,this.updateSpeed(),this.movingBeatNote?(this.movingBeatNote.position=new g(this.startX,this.startNode.position.y,this.startNode.position.z),this.heartBeatSprite&&(this.heartBeatSprite.node.scale=new g(1,1,1))):console.error("No note assigned to AuditionBeatSystem!")},i.updateSpeed=function(){var t=this.endX-this.startX,e=6e4/this.bpm/1e3*this.beatsPerLoop;this.noteSpeed=t/e;var i=this.endX-this.targetX;this.noteDelay=i/t*e},i.getCurrentTime=function(){return this.audioManager.getCurrentTime()},i.update=function(t){if(this.isPlaying&&this.movingBeatNote&&this.audioManager){var e=this.getCurrentTime(),i=6e4/this.bpm,n=i*this.beatsPerLoop;e-this.lastBeatTime>=n+this.missWindow&&(this.lastBeatTime=Math.round(e/n)*n,this.currentLoop++,this.updateLevelSystem()),this.updateBeatNoteMoving(e),this.updateHeartBeatEffect(e,i,n),this.handleAutoPlay()}},i.initializeLevelSequences=function(){this.levelSequences=[{type:Xy.OFF,loop:3,notes:0},{type:Xy.LEVEL,loop:1,notes:1},{type:Xy.LEVEL,loop:1,notes:2},{type:Xy.LEVEL,loop:1,notes:3},{type:Xy.LEVEL,loop:1,notes:4},{type:Xy.LEVEL,loop:1,notes:5},{type:Xy.LEVEL,loop:4,notes:6,delay:1},{type:Xy.LEVEL,loop:4,notes:7,delay:1},{type:Xy.LEVEL,loop:4,notes:8,delay:1},{type:Xy.LEVEL,loop:4,notes:9,delay:1},{type:Xy.FINISH,loop:1,notes:9}]},i.startBeatSystem=function(t,e,i){var n=this;if(this.movingBeatNote&&(this.bpm=t,this.updateSpeed(),this.isPlaying=!0,this.songDuration=e,this.initializeLevelSequences(),this.currentSequenceIndex=0,this.currentLevel=0,this.currentNotes=0,this.penaltyPatternLoops=0,this.activeNoteIds=[],this.noteSequence=[],this.audioManager)){this.lastBeatTime=this.audioManager.getCurrentTime(),this.currentLoop=0,this.inputHandler&&(this.inputHandler.registerInputCallback(Kv.SPACE,(function(t){return n.evaluateInput(t)})),this.inputHandler.registerInputCallback(Kv.LEFT,(function(t){return n.handleNoteInput(ry.LEFT,t)})),this.inputHandler.registerInputCallback(Kv.RIGHT,(function(t){return n.handleNoteInput(ry.RIGHT,t)}))),console.log("Beat system started with level sequences"),this.isInDelay=!1,this.delayLoops=0,this.currentLevelLoop=0,this.updateGameplayInteractableVisualize();var r=6e4/this.bpm/1e3*this.beatsPerLoop*4,o=Math.max(0,r-1);this.scheduleOnce((function(){n.readyCallback&&(n.readyCallback(),n.readyCallback=null)}),o)}},i.updateLevelSystem=function(){var t=this;if(this.noteSequence.length>0&&this.handleMiss(),this.clearLastNotes(),this.isInDelay)return this.delayLoops--,void(this.delayLoops<=0&&(this.isInDelay=!1));var e=function(e){t.isInPenalty&&t.penaltyPatternLoops--,t.startNextPattern(),e.delay&&(t.delayLoops=e.delay,t.isInDelay=!0)},i=this.levelSequences[this.currentSequenceIndex];if(this.currentLevelLoop>=i.loop){this.currentSequenceIndex++,this.currentSequenceIndex>=this.levelSequences.length&&(this.currentSequenceIndex=0,this.penaltyPatternLoops=0);var n=this.levelSequences[this.currentSequenceIndex];n.type===Xy.OFF?(this.delayLoops=n.loop,this.currentLevelLoop=n.loop,this.isInDelay=!0):n.type===Xy.LEVEL?(this.currentLevel=n.notes,this.currentLevelLoop=1,this.updateLevelTextNormal(this.currentLevel),this.levelChangedCallback&&this.levelChangedCallback(this.currentLevel,n.type),e(n)):n.type===Xy.FINISH&&(this.currentLevelLoop=1,e(n),this.updateLevelTextFinish())}else this.currentLevelLoop++,i.type===Xy.LEVEL&&e(i)},i.startNextPattern=function(){var t=this.levelSequences[this.currentSequenceIndex];this.requiredNotes=t.notes,this.currentNotes=0,this.noteSequence=[],this.currentSequenceNotes=[];for(var e=-this.nodeDistance*this.requiredNotes/2+this.nodeDistance/2,i=0;i<this.requiredNotes;i++){var n=Math.random()<.5?ry.LEFT:ry.RIGHT;this.noteSequence.push(n);var r=this.notePool.getNote(n),o=r.id,a=r.node;if(a.parent=this.nodeContainer,a){this.activeNoteIds.push(o);var s=a.getComponent(qy);s.initialize(n,this.lastBeatTime,o),this.currentSequenceNotes.push(s),a.setPosition(new g(e+i*this.nodeDistance,0,0))}}this.updateGameplayInteractableVisualize()},i.updateLevelTextNormal=function(t){this.levelLabel&&(this.levelLabel.string="Level "+t.toString(),this.levelLabel.shadowColor=t<=3?new X(0,0,0,255):t<=6?new X(0,0,128,255):t<=9?new X(128,0,128,255):new X(178,34,34,255)),this.levelLabel&&(it.stopAllByTarget(this.levelLabel.node),this.levelLabel.node.setScale(new g(1.5,1.5,1)),v(this.levelLabel.node).to(.3,{scale:new g(1,1,1)},{easing:"bounceOut"}).start())},i.updateLevelTextFinish=function(){this.levelLabel&&(this.levelLabel.string="Finish Move",this.levelLabel.shadowColor=new X(255,165,0,255),it.stopAllByTarget(this.levelLabel.node),this.levelLabel.node.setScale(new g(1,1,1)),v(this.levelLabel.node).to(.5,{scale:new g(1.2,1.2,1)}).to(.5,{scale:new g(1,1,1)}).union().repeatForever().start())},i.handleNoteInput=function(t,e){this.isPlaying&&!this.isInPenalty&&(this.currentNotes>=this.noteSequence.length||(this.currentNotes<this.noteSequence.length&&this.noteSequence[this.currentNotes]===t?(this.currentSequenceNotes[this.currentNotes].playHitEffect(Ky.PERFECT),this.currentNotes++):(this.currentNotes=0,this.currentSequenceNotes.forEach((function(t){return t.reset()})))))},i.evaluateInput=function(t){if(this.isPlaying&&!this.isInPenalty&&0!=this.noteSequence.length&&this.audioManager){var e,i=this.getCurrentTime(),n=6e4/this.bpm*this.beatsPerLoop,r=(i-this.lastBeatTime)/n,o=Math.abs(1-r);e=o<=this.timingWindows.get(Ky.PERFECT)/n?Ky.PERFECT:o<=this.timingWindows.get(Ky.GOOD)/n?Ky.GOOD:Ky.MISS,this.isMiss()||e==Ky.MISS?this.handleMiss():this.handleScored(e)}},i.handleAutoPlay=function(){if(this.isAutoPlay&&this.isPlaying&&!this.isInPenalty){var t=this.getCurrentTime(),e=6e4/this.bpm*this.beatsPerLoop,i=(t-this.lastBeatTime)/e,n=Math.abs(1-i);if(this.noteSequence.length>0&&this.currentNotes<this.noteSequence.length&&this.inputHandler){var r=this.noteSequence[this.currentNotes];r===ry.LEFT?this.inputHandler.simulateInput(Kv.LEFT,t):r===ry.RIGHT&&this.inputHandler.simulateInput(Kv.RIGHT,t)}n<=this.timingWindows.get(Ky.PERFECT)/e&&this.inputHandler&&this.inputHandler.simulateInput(Kv.SPACE,t)}},i.clearLastNotes=function(){var t=this;this.activeNoteIds.forEach((function(e){return t.notePool.recycleNote(e)})),this.activeNoteIds=[],this.noteSequence=[],this.currentNotes=0},i.handleMiss=function(){this.isInPenalty||(this.penaltyPatternLoops=2,this.scoringCallback&&this.scoringCallback(Ky.MISS),this.updateGameplayInteractableVisualize())},i.handleScored=function(t){this.clearLastNotes(),this.scoringCallback&&this.scoringCallback(t)},i.isMiss=function(){return this.currentNotes<this.requiredNotes},i.updateBeatNoteMoving=function(t){var e=(t-this.lastBeatTime)/1e3-this.noteDelay,i=this.startX;i=e>0?this.startX+this.noteSpeed*e:this.endX+this.noteSpeed*e,this.movingBeatNote.position=new g(i,this.movingBeatNote.position.y,this.movingBeatNote.position.z)},i.updateHeartBeatEffect=function(t,e,i){if(this.heartBeatSprite){var n=t-this.lastBeatTime,r=t%e,o=n>i-.5*e&&n<i+.5*e?Math.max(1,2*(1-r/e)):1;this.heartBeatSprite.node.setScale(new g(o,1,1));var a=Math.max(.5,1-r/e),s=this.heartBeatSprite.color.clone();s.a=255*a,this.heartBeatSprite.color=s}},i.updateGameplayInteractableVisualize=function(){if(this.opacityGameplay){var t=!this.isInPenalty&&this.isPlaying;this.opacityGameplay.opacity=t?255:50}},i.stopBeatSystem=function(){var t=this;this.isPlaying=!1,this.isAutoPlay=!1,this.inputHandler&&(this.inputHandler.unregisterInputCallback(Kv.SPACE,(function(e){return t.evaluateInput(e)})),this.inputHandler.unregisterInputCallback(Kv.LEFT,(function(e){return t.handleNoteInput(ry.LEFT,e)})),this.inputHandler.unregisterInputCallback(Kv.RIGHT,(function(e){return t.handleNoteInput(ry.RIGHT,e)}))),console.log("Beat system stopped")},i.setScoreCallback=function(t){this.scoringCallback=t},i.setReadyCallback=function(t){this.readyCallback=t},i.setLevelChangedCallback=function(t){this.levelChangedCallback=t},i.getBPM=function(){return this.bpm},i.setBPM=function(t){this.bpm=Math.max(60,Math.min(200,t)),console.log("BPM set to "+this.bpm)},i.getBeatsPerLoop=function(){return this.beatsPerLoop},i.setBeatsPerLoop=function(t){this.beatsPerLoop=Math.max(1,Math.min(8,t)),console.log("Beats per loop set to "+this.beatsPerLoop)},i.setAutoPlay=function(t){this.isAutoPlay=t,console.log("Auto-play "+(t?"enabled":"disabled"))},i.isAutoPlayEnabled=function(){return this.isAutoPlay},xt(e,[{key:"isInPenalty",get:function(){return this.penaltyPatternLoops>0}}]),e}(o)).prototype,"movingBeatNote",[sy],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Py=Mt(Ay.prototype,"targetZone",[ly],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),My=Mt(Ay.prototype,"startNode",[cy],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Iy=Mt(Ay.prototype,"endNode",[uy],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ny=Mt(Ay.prototype,"heartBeatSprite",[hy],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ly=Mt(Ay.prototype,"opacityGameplay",[py],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Oy=Mt(Ay.prototype,"levelLabel",[dy],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Ry=Mt(Ay.prototype,"audioManager",[fy],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),xy=Mt(Ay.prototype,"inputHandler",[gy],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Fy=Mt(Ay.prototype,"bpm",[my],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 120}}),Dy=Mt(Ay.prototype,"beatsPerLoop",[vy],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 4}}),zy=Mt(Ay.prototype,"perfectWindow",[yy],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 50}}),ky=Mt(Ay.prototype,"goodWindow",[by],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 100}}),Vy=Mt(Ay.prototype,"missWindow",[_y],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 200}}),By=Mt(Ay.prototype,"notePool",[Sy],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Hy=Mt(Ay.prototype,"nodeContainer",[wy],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Uy=Mt(Ay.prototype,"nodeDistance",[Ty],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 65}}),Ey=Ay))||Ey);t._RF.pop(),t._RF.push({},"b36e0MayvRDhqtAvXGvTrjp","AuditionBeatmap",void 0);var Qy,$y,tb=e.ccclass;e.property,tb("AuditionBeatmap")(Zy=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).currentBeatmap=null,e}It(e,t);var i=e.prototype;return i.generateBeatmap=function(t,e,i,n){var r=this;return new Promise((function(o){for(var a=[],s=6e4/e*n,l=1e3,c=i-2e3;l<c;)a.push({time:l,type:2}),l+=s;var u={songId:t,bpm:e,offset:0,notes:a,difficulty:2,creator:"System",version:"1.0"};r.currentBeatmap=u,console.log("Beatmap generated successfully: "+u.songId),o(u)}))},i.getCurrentBeatmap=function(){return this.currentBeatmap},i.getNotesInTimeRange=function(t,e){return this.currentBeatmap&&this.currentBeatmap.notes?this.currentBeatmap.notes.filter((function(i){return i.time>=t&&i.time<=e})):[]},i.getNotesToSpawn=function(t,e){return this.getNotesInTimeRange(t,t+e)},i.getTotalNoteCount=function(){var t;return(null==(t=this.currentBeatmap)||null==(t=t.notes)?void 0:t.length)||0},e}(o));t._RF.pop(),t._RF.push({},"5d9e2TkgsBGdK4Et+YVimdr","AuditionCharacterAnimationData",void 0);var eb,ib,nb,rb,ob,ab=e.ccclass,sb=(e.property,function(t){return t.FIRST_STAND="first_stand",t.LAST_STAND="last_stand",t.BOY_START="boy_start",t.GIRL_START="girl_start",t.DANCE_START="dance_start",t.DANCE_END="dance_end",t.BOY_WIN="boy_win",t.BOY_LOSE="boy_lose",t.GIRL_WIN="girl_win",t.GIRL_LOSE="girl_lose",t.END1="end1",t.END2="end2",t.END3="end3",t.END4="end4",t.MISS="miss",t}({})),lb=ab("AuditionCharacterAnimationData")((($y=function(){function t(){}return t.initialize=function(){this.specialStates.clear(),this.danceStates.clear(),this.currentSequence=[],this.initializeSpecialStates()},t.initializeSpecialStates=function(){this.specialStates.set(sb.FIRST_STAND,{speed:1,motion:"first_stand",transitions:[{srcState:"first_stand",destState:"boy_start",transitionDuration:.2,transitionOffset:0,exitTime:.9}],isLooping:!1}),this.specialStates.set(sb.LAST_STAND,{speed:1,motion:"last_stand",transitions:[],isLooping:!0}),this.specialStates.set(sb.BOY_START,{speed:1,motion:"boy_start",transitions:[{srcState:"boy_start",destState:"dance_start",transitionDuration:.2,transitionOffset:0,exitTime:.9}],isLooping:!1}),this.specialStates.set(sb.GIRL_START,{speed:1,motion:"girl_start",transitions:[{srcState:"girl_start",destState:"dance_start",transitionDuration:.2,transitionOffset:0,exitTime:.9}],isLooping:!1}),this.specialStates.set(sb.DANCE_START,{speed:1,motion:"dance_start",transitions:[{srcState:"dance_start",destState:"default_dance",transitionDuration:.2,transitionOffset:0,exitTime:.9}],isLooping:!1}),this.specialStates.set(sb.DANCE_END,{speed:1,motion:"dance_end",transitions:[],isLooping:!1}),this.specialStates.set(sb.BOY_WIN,{speed:1,motion:"boy_win",transitions:[{srcState:"boy_win",destState:"last_stand",transitionDuration:.2,transitionOffset:0,exitTime:.9}],isLooping:!1}),this.specialStates.set(sb.BOY_LOSE,{speed:1,motion:"boy_lose",transitions:[{srcState:"boy_lose",destState:"last_stand",transitionDuration:.2,transitionOffset:0,exitTime:.9}],isLooping:!1}),this.specialStates.set(sb.GIRL_WIN,{speed:1,motion:"girl_win",transitions:[{srcState:"girl_win",destState:"last_stand",transitionDuration:.2,transitionOffset:0,exitTime:.9}],isLooping:!1}),this.specialStates.set(sb.GIRL_LOSE,{speed:1,motion:"girl_lose",transitions:[{srcState:"girl_lose",destState:"last_stand",transitionDuration:.2,transitionOffset:0,exitTime:.9}],isLooping:!1}),this.specialStates.set(sb.MISS,{speed:1,motion:"miss",transitions:[],isLooping:!1})},t.loadDanceData=function(t){var e=this;return new Promise((function(i,n){Qe.loadRes("audition/dances/"+t,at,(function(t,r){if(t)return console.error("Failed to load dance data:",t),void n(t);e.parseDanceData(r.text),i()}))}))},t.parseDanceData=function(t){var e=this,i=t.split("\n"),n="",r=[];this.beginDanceState="";for(var o=0;o<i.length;o++){var a=i[o].trim();if(a)if(a.startsWith("DefaultState:"))this.defaultState=a.split(":")[1].trim();else if(a.startsWith("[")&&a.endsWith("]")){var s=Array.from(this.specialStates.keys()).some((function(t){return e.specialStates.get(t).motion===n}));n&&!s&&(this.saveState(n,r),r=[]),n=a.slice(1,-1).trim()}else if(n){var l=Array.from(this.specialStates.keys()).some((function(t){return e.specialStates.get(t).motion===n}));if(a.startsWith("Speed:")){var c=parseFloat(a.split(":")[1].trim());l?this.updateSpecialStateSpeed(n,c):this.updateStateSpeed(n,c)}else if(a.startsWith("Motion:")){var u=a.split(":")[1].trim();l?this.updateSpecialStateMotion(n,u):(this.updateStateMotion(n,u),this.beginDanceState||this.specialStates.has(u)||(this.beginDanceState=n))}else if(a.startsWith("Transition:")){var h=this.parseTransition(i,o);h&&(l?this.updateSpecialStateTransitions(n,h):r.push(h))}else if(a.startsWith("IsLooping:")){var p="true"===a.split(":")[1].trim().toLowerCase();l?this.updateSpecialStateLooping(n,p):this.updateStateLooping(n,p)}else if(a.startsWith("NextState:")){var d=a.split(":")[1].trim();l||this.updateStateNext(n,d)}}}this.buildDanceSequence(),console.log("Loaded "+this.danceStates.size+" dance states")},t.buildDanceSequence=function(){this.currentSequence=[];for(var t=this.defaultState;t;){this.currentSequence.push(t);var e=this.danceStates.get(t);if(!e||!e.nextState)break;t=e.nextState}},t.getAllDanceStates=function(){return Array.from(this.danceStates.values())},t.parseTransition=function(t,e){for(var i={srcState:"",destState:"",transitionDuration:0,transitionOffset:0,exitTime:0},n=e+1;n<t.length&&t[n].startsWith("\t");){var r=t[n].trim();if(r.startsWith("SrcState:"))i.srcState=r.split(":")[1].trim();else if(r.startsWith("DestState:"))i.destState=r.split(":")[1].trim();else if(r.startsWith("TransitionDuration:"))i.transitionDuration=parseFloat(r.split(":")[1].trim());else if(r.startsWith("TransitionOffset:"))i.transitionOffset=parseFloat(r.split(":")[1].trim());else if(r.startsWith("ExitTime:"))i.exitTime=parseFloat(r.split(":")[1].trim());else if(r.startsWith("Condition:")){var o=r.split(":")[1].trim();i.condition=this.parseCondition(o)}n++}return i},t.parseCondition=function(t){return new Function("combo","accuracy","return "+t)},t.saveState=function(t,e){var i=this.danceStates.get(t)||{speed:1,motion:t,transitions:[],isLooping:!1};i.transitions=e,this.danceStates.set(t,i)},t.updateStateSpeed=function(t,e){var i=this.danceStates.get(t)||{speed:1,motion:t,transitions:[],isLooping:!1};i.speed=e,this.danceStates.set(t,i)},t.updateStateMotion=function(t,e){var i=this.danceStates.get(t)||{speed:1,motion:t,transitions:[],isLooping:!1};i.motion=e,this.danceStates.set(t,i)},t.updateStateLooping=function(t,e){var i=this.danceStates.get(t)||{speed:1,motion:t,transitions:[],isLooping:!1};i.isLooping=e,this.danceStates.set(t,i)},t.updateStateNext=function(t,e){var i=this.danceStates.get(t)||{speed:1,motion:t,transitions:[],isLooping:!1};i.nextState=e,this.danceStates.set(t,i)},t.getDanceState=function(t){return this.danceStates.get(t)||null},t.getDefaultState=function(){return this.defaultState},t.getBeginDanceState=function(){return this.beginDanceState},t.getSpecialState=function(t){return this.specialStates.get(t)||null},t.getDanceSequence=function(){return[].concat(this.currentSequence)},t.getAllAnimationNames=function(){var t=Array.from(this.danceStates.keys()),e=Array.from(this.specialStates.values()).map((function(t){return t.motion}));return t.concat(e)},t.updateSpecialStateSpeed=function(t,e){for(var i,n=Ft(this.specialStates.entries());!(i=n()).done;){var r=i.value,o=r[0],a=r[1];if(a.motion===t){a.speed=e,this.specialStates.set(o,a);break}}},t.updateSpecialStateMotion=function(t,e){for(var i,n=Ft(this.specialStates.entries());!(i=n()).done;){var r=i.value,o=r[0],a=r[1];if(a.motion===t){a.motion=e,this.specialStates.set(o,a);break}}},t.updateSpecialStateTransitions=function(t,e){for(var i,n=Ft(this.specialStates.entries());!(i=n()).done;){var r=i.value,o=r[0],a=r[1];if(a.motion===t){a.transitions.push(e),this.specialStates.set(o,a);break}}},t.updateSpecialStateLooping=function(t,e){for(var i,n=Ft(this.specialStates.entries());!(i=n()).done;){var r=i.value,o=r[0],a=r[1];if(a.motion===t){a.isLooping=e,this.specialStates.set(o,a);break}}},t}()).specialStates=new Map,$y.danceStates=new Map,$y.defaultState="",$y.beginDanceState="",$y.currentSequence=[],Qy=$y))||Qy;t._RF.pop(),t._RF.push({},"e50e6LGYARIrKzmtafJs/JO","Character",void 0);var cb=e.ccclass,ub=e.property,hb=(eb=cb("Character"),ib=ub(st),eb((ob=Mt((rb=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return e=t.call.apply(t,[this].concat(n))||this,Nt(e,"skeletalAnimation",ob,Lt(e)),e.characterId="",e.isLoaded=!1,e.characterNode=null,e}It(e,t);var i=e.prototype;return i.init=function(){var t=Ot(Rt().mark((function t(e,i){return Rt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.characterId=i,t.next=3,this.loadCharacterPrefab();case 3:case 4:case"end":return t.stop()}}),t,this)})));return function(e,i){return t.apply(this,arguments)}}(),i.loadCharacterPrefab=function(){var t=this;return new Promise((function(e,i){Qe.loadRes("prefab/character/"+t.characterId,l,(function(n,r){return n?(console.error("Failed to load character prefab: "+t.characterId,n),void i(n)):(t.characterNode=A(r),t.node.addChild(t.characterNode),t.skeletalAnimation=t.characterNode.getComponent(st),t.skeletalAnimation?(t.isLoaded=!0,void e()):(console.error("No SkeletalAnimation component found in character: "+t.characterId),void i(new Error("Missing SkeletalAnimation component"))))}))}))},i.getSkeletalAnimation=function(){return this.skeletalAnimation},i.setSkins=function(){var t=Ot(Rt().mark((function t(e){var i,n,r;return Rt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.isLoaded){t.next=3;break}return console.error("Character not loaded yet"),t.abrupt("return");case 3:i=Rt().mark((function t(){var e;return Rt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return e=r.value,t.next=3,new Promise((function(t,i){Qe.loadRes("prefab/skins/"+e.prefab,l,(function(n,r){if(n)return console.error("Failed to load skin: "+e.prefab,n),void i(n);console.log("Applying skin: "+e.skinType+" with prefab: "+e.prefab),t()}))}));case 3:case"end":return t.stop()}}),t)})),n=Ft(e);case 5:if((r=n()).done){t.next=9;break}return t.delegateYield(i(),"t0",7);case 7:t.next=5;break;case 9:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}(),i.playAnimation=function(t,e){void 0===e&&(e=.3),this.isLoaded&&this.skeletalAnimation?this.skeletalAnimation.crossFade(t,e):console.error("Character or animation component not loaded")},i.createState=function(t,e){this.skeletalAnimation.createState(t,e)},i.getState=function(t){return this.skeletalAnimation.getState(t)},e}(o)).prototype,"skeletalAnimation",[ib],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),nb=rb))||nb);t._RF.pop(),t._RF.push({},"2b49dMP2tlJoJ/QmweV0mD+","CharacterAnimationUtils",void 0);var pb=function(){function t(){this.animationCache=new Map}t.getInstance=function(){return t.instance||(t.instance=new t),t.instance};var e=t.prototype;return e.loadAnimationClip=function(){var t=Ot(Rt().mark((function t(e){var i=this;return Rt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.animationCache.has(e)){t.next=2;break}return t.abrupt("return",this.animationCache.get(e));case 2:return t.abrupt("return",new Promise((function(t,n){Qe.loadRes("animations/"+e,l,(function(r,o){if(r)return console.error("Failed to load animation prefab:",e),void n(r);try{var a=A(o),s=a.getComponent(st);if(!s||!s.clips.length)return a.destroy(),void n(new Error("No valid animation found in prefab: "+e));var l=s.clips[0];l.name=e,i.animationCache.set(e,l),a.destroy(),t(l)}catch(t){console.error("Error processing animation prefab:",t),n(t)}}))})));case 3:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}(),e.loadMultipleAnimations=function(){var t=Ot(Rt().mark((function t(e){var i,n=this;return Rt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=e.map((function(t){return n.loadAnimationClip(t)})),t.abrupt("return",Promise.all(i));case 2:case"end":return t.stop()}}),t)})));return function(e){return t.apply(this,arguments)}}(),e.applyAnimationsToCharacter=function(){var t=Ot(Rt().mark((function t(e,i){var n,r,o;return Rt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e&&e.getSkeletalAnimation()){t.next=2;break}throw new Error("Invalid character or missing SkeletalAnimation component");case 2:for(n=Ft(i);!(r=n()).done;)o=r.value,e.createState(o,o.name);case 3:case"end":return t.stop()}}),t)})));return function(e,i){return t.apply(this,arguments)}}(),e.playAnimation=function(t,e,i){void 0===i&&(i=.3),t?t.playAnimation(e,i):console.error("Invalid character provided")},e.clearCache=function(){this.animationCache.clear()},e.removeFromCache=function(t){this.animationCache.delete(t)},t}();pb.instance=null;var db,fb,gb,mb,vb,yb,bb,_b;pb.getInstance();t._RF.pop(),t._RF.push({},"1e7b6TmLYNOJqHH2ZZSRUXY","AuditionCharacterAnimation",void 0);var Sb,wb,Tb,Eb,Ab,Cb,Pb,Mb,Ib,Nb,Lb,Ob,Rb,xb,Fb,Db=e.ccclass,zb=e.property,kb=(db=Db("AuditionCharacterAnimation"),fb=zb(hb),db((vb=Mt((mb=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return e=t.call.apply(t,[this].concat(n))||this,Nt(e,"character",vb,Lt(e)),Nt(e,"transitionDuration",yb,Lt(e)),Nt(e,"comboThreshold",bb,Lt(e)),Nt(e,"inputHistorySize",_b,Lt(e)),e.currentCombo=0,e.inputHistory=[],e.isMale=!0,e.animMap=new Map,e.animNames=[],e.allDanceStates=[],e.currentDanceIndex=0,e.musicSpeed=1,e}It(e,t);var i=e.prototype;return i.loadDanceData=function(t){var e=this;return new Promise((function(i,n){lb.initialize();var r=t+"_Dance";Promise.all([e.character.init(null,xr.instance.characterId),lb.loadDanceData(r)]).then((function(){return e.animNames=lb.getAllAnimationNames(),console.log("Animation names to be loaded:"),e.animNames.forEach((function(t,e){console.log(e+1+". "+t)})),console.log("Loading "+e.animNames.length+" dance animations for song: "+t),pb.getInstance().loadMultipleAnimations(e.animNames)})).then((function(t){console.log("Successfully loaded "+t.length+" dance animations"),e.setClips(t,e.animNames),e.allDanceStates=lb.getAllDanceStates(),e.currentDanceIndex=-1,e.playSpecialAnimation(sb.FIRST_STAND),i("success")})).catch((function(t){console.error("Failed to load dance: "+t),n(t)}))}))},i.setClips=function(t,e){for(var i=0;i<t.length;i++){var n=t[i],r=e[i];this.character.createState(n,r)}},i.setGender=function(t){this.isMale=t},i.reactToInput=function(t,e){if(console.log("reactToInput: "+t+" "+e),this.currentCombo=e,this.recordInput(t),t===Ky.MISS)return this.playMissAnimation(),void this.nextDanceState();this.playNextDanceState()},i.nextDanceState=function(){this.currentDanceIndex=++this.currentDanceIndex%this.allDanceStates.length},i.playNextDanceState=function(){this.nextDanceState();var t=this.allDanceStates[this.currentDanceIndex].transitions[0].srcState;this.playAnimation(t,this.allDanceStates[this.currentDanceIndex],1)},i.playSpecialAnimation=function(t,e){var i=lb.getSpecialState(t);i?this.playAnimation(i.motion,i,i.speed,e):console.error("Special animation state not found: "+t)},i.playMissAnimation=function(){var t=lb.getSpecialState(sb.MISS);this.playAnimation(t.motion,t,t.speed)},i.setMusicSpeed=function(t){this.musicSpeed=t/100},i.playAnimation=function(t,e,i,n){if(void 0===i&&(i=1),this.character){var r=this.character.getState(t);if(r){if(r.speed=i*this.musicSpeed,e&&e.transitions&&e.transitions.length>0){var o=e.transitions[0].exitTime||.95;this.character.playAnimation(t,o)}else this.character.playAnimation(t,.3);n&&r.on("finished",n,this)}else console.error("Animation state not found: "+t)}},i.recordInput=function(t){this.inputHistory.push({accuracyRating:t,timestamp:Date.now()}),this.inputHistory.length>this.inputHistorySize&&this.inputHistory.shift()},i.endDanceSequence=function(t){var e,i=this;e=this.isMale?t?sb.END2:sb.END1:t?sb.END4:sb.END3,this.playSpecialAnimation(e,(function(){i.playSpecialAnimation(sb.LAST_STAND)}))},i.resetToIdle=function(){this.currentCombo=0,this.inputHistory=[],this.playSpecialAnimation(sb.FIRST_STAND)},e}(o)).prototype,"character",[fb],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),yb=Mt(mb.prototype,"transitionDuration",[zb],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.2}}),bb=Mt(mb.prototype,"comboThreshold",[zb],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 10}}),_b=Mt(mb.prototype,"inputHistorySize",[zb],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 20}}),gb=mb))||gb);t._RF.pop(),t._RF.push({},"2ce00HNOcFEMZsuE2WXEEkB","AuditionScoringSystem",void 0);var Vb,Bb,Hb,Ub,Gb,Wb,qb,Zb,Yb,jb,Kb,Xb,Jb,Qb,$b,t_,e_,i_,n_,r_,o_,a_,s_,l_,c_,u_,h_,p_,d_,f_,g_,m_,v_,y_,b_,__,S_,w_,T_,E_,A_,C_,P_,M_=e.ccclass,I_=e.property,N_=(Sb=M_("AuditionScoringSystem"),wb=I_(zv),Sb((Ab=Mt((Eb=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return e=t.call.apply(t,[this].concat(n))||this,Nt(e,"perfectScore",Ab,Lt(e)),Nt(e,"goodScore",Cb,Lt(e)),Nt(e,"missScore",Pb,Lt(e)),Nt(e,"comboMultiplierIncrement",Mb,Lt(e)),Nt(e,"maxComboMultiplier",Ib,Lt(e)),Nt(e,"comboBreakPenalty",Nb,Lt(e)),Nt(e,"patternComplexityMultiplier",Lb,Lt(e)),Nt(e,"consecutivePatternBonus",Ob,Lt(e)),Nt(e,"finishMoveMultiplier",Rb,Lt(e)),Nt(e,"patternSkipPenalty",xb,Lt(e)),Nt(e,"audioManager",Fb,Lt(e)),e.patternsCompleted=0,e.consecutivePatterns=0,e.finishMovesCompleted=0,e.patternsSkipped=0,e.totalScore=0,e.currentCombo=0,e.maxCombo=0,e.patternMultiplier=1,e.accuracyStats={perfect:0,good:0,miss:0,total:0},e.onScoreUpdateCallback=null,e.onComboUpdateCallback=null,e.onPatternMultiplierUpdateCallback=null,e}It(e,t);var i=e.prototype;return i.reset=function(){this.totalScore=0,this.currentCombo=0,this.maxCombo=0,this.patternMultiplier=1,this.patternsCompleted=0,this.consecutivePatterns=0,this.finishMovesCompleted=0,this.patternsSkipped=0,this.accuracyStats={perfect:0,good:0,miss:0,total:0},this.onScoreUpdateCallback&&this.onScoreUpdateCallback(this.totalScore),this.onComboUpdateCallback&&this.onComboUpdateCallback(this.currentCombo),this.onPatternMultiplierUpdateCallback&&this.onPatternMultiplierUpdateCallback(this.patternMultiplier),console.log("Scoring system reset")},i.processNoteResult=function(t,e){this.accuracyStats.total++;var i=0;switch(t){case Ky.PERFECT:this.accuracyStats.perfect++,i=this.perfectScore,this.updateCombo(!0);var n=1===this.currentCombo?"perfect":"perfect"+Math.min(this.currentCombo,5);this.audioManager.playSound(n);break;case Ky.GOOD:this.accuracyStats.good++,i=this.goodScore,this.updateCombo(!1),this.audioManager.playSound("good");break;case Ky.MISS:this.accuracyStats.miss++,i=this.missScore,this.updateCombo(!1),this.audioManager.playSound("miss")}var r=1+Math.min(this.maxComboMultiplier-1,this.comboMultiplierIncrement*(this.currentCombo-1)),o=t===Ky.MISS?i:Math.floor(i*r);this.totalScore+=o,this.onScoreUpdateCallback&&this.onScoreUpdateCallback(this.totalScore),console.log("Note result: "+Ky[t]+", Score: "+this.totalScore+", Combo: "+this.currentCombo+", Points earned: "+o)},i.processPatternResult=function(t,e,i){if(t===Ky.MISS)return this.patternsSkipped++,this.consecutivePatterns=0,this.resetPatternMultiplier(),this.totalScore=Math.max(0,this.totalScore-this.patternSkipPenalty),void console.log("Pattern missed! Score: "+this.totalScore+", Skipped: "+this.patternsSkipped);var n=50*e;t===Ky.PERFECT&&(n*=1.5);var r=Math.floor(n*this.patternMultiplier);if(this.patternsCompleted++,this.consecutivePatterns++,i){this.finishMovesCompleted++;var o=Math.floor(r*(this.finishMoveMultiplier-1));this.totalScore+=r+o,console.log("Finish move completed! Base: "+r+", Bonus: "+o)}else if(this.totalScore+=r,this.consecutivePatterns>1){var a=this.consecutivePatternBonus*(this.consecutivePatterns-1);this.totalScore+=a,console.log("Consecutive pattern bonus: +"+a)}this.increasePatternMultiplier(),this.onScoreUpdateCallback&&this.onScoreUpdateCallback(this.totalScore),console.log("Pattern completed! Complexity: "+e+", Score added: "+r+", Total: "+this.totalScore+", Pattern multiplier: "+this.patternMultiplier.toFixed(1)+"x")},i.updateCombo=function(t){t?(this.currentCombo++,this.currentCombo>this.maxCombo&&(this.maxCombo=this.currentCombo)):(this.comboBreakPenalty>0&&(this.totalScore=Math.max(0,this.totalScore-this.comboBreakPenalty)),this.currentCombo=0),this.onComboUpdateCallback&&this.onComboUpdateCallback(this.currentCombo)},i.onScoreUpdate=function(t){this.onScoreUpdateCallback=t},i.onComboUpdate=function(t){this.onComboUpdateCallback=t},i.onPatternMultiplierUpdate=function(t){this.onPatternMultiplierUpdateCallback=t},i.increasePatternMultiplier=function(){this.patternMultiplier+=.1,this.onPatternMultiplierUpdateCallback&&this.onPatternMultiplierUpdateCallback(this.patternMultiplier)},i.resetPatternMultiplier=function(){this.patternMultiplier=1,this.onPatternMultiplierUpdateCallback&&this.onPatternMultiplierUpdateCallback(this.patternMultiplier)},i.handlePatternBreak=function(){this.consecutivePatterns=0,this.resetPatternMultiplier(),this.updateCombo(!1)},i.getScore=function(){return this.totalScore},i.getCombo=function(){return this.currentCombo},i.getMaxCombo=function(){return this.maxCombo},i.getAccuracyStats=function(){return Dt({},this.accuracyStats)},i.getAccuracyPercentage=function(){return 0===this.accuracyStats.total?0:(1*this.accuracyStats.perfect+.5*this.accuracyStats.good+0*this.accuracyStats.miss)/this.accuracyStats.total*100},i.getGrade=function(){var t=this.getAccuracyPercentage();return t>=95?"S":t>=90?"A":t>=80?"B":t>=70?"C":t>=60?"D":"F"},i.calculateExperiencePoints=function(){return Math.floor(this.totalScore/100)+Math.floor(this.getAccuracyPercentage()/10)+Math.floor(this.maxCombo/10)+2*this.patternsCompleted+10*this.finishMovesCompleted},i.getPatternStats=function(){return{completed:this.patternsCompleted,skipped:this.patternsSkipped,finishMoves:this.finishMovesCompleted}},e}(o)).prototype,"perfectScore",[I_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 100}}),Cb=Mt(Eb.prototype,"goodScore",[I_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 50}}),Pb=Mt(Eb.prototype,"missScore",[I_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Mb=Mt(Eb.prototype,"comboMultiplierIncrement",[I_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.1}}),Ib=Mt(Eb.prototype,"maxComboMultiplier",[I_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 3}}),Nb=Mt(Eb.prototype,"comboBreakPenalty",[I_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),Lb=Mt(Eb.prototype,"patternComplexityMultiplier",[I_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.2}}),Ob=Mt(Eb.prototype,"consecutivePatternBonus",[I_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 50}}),Rb=Mt(Eb.prototype,"finishMoveMultiplier",[I_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 2}}),xb=Mt(Eb.prototype,"patternSkipPenalty",[I_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 100}}),Fb=Mt(Eb.prototype,"audioManager",[wb],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Tb=Eb))||Tb);t._RF.pop(),t._RF.push({},"04144GbENxMebPIzsW6q1M6","AuditionUIManager",void 0);var L_,O_,R_,x_,F_,D_,z_,k_,V_,B_,H_,U_,G_,W_,q_,Z_,Y_,j_,K_,X_,J_,Q_,$_,tS,eS,iS=e.ccclass,nS=e.property,rS=function(t){return t[t.MAIN_MENU=0]="MAIN_MENU",t[t.SONG_SELECTION=1]="SONG_SELECTION",t[t.GAMEPLAY=2]="GAMEPLAY",t[t.RESULTS=3]="RESULTS",t[t.SETTINGS=4]="SETTINGS",t}(rS||{}),oS=function(t){return t[t.PERFECT=0]="PERFECT",t[t.GREAT=1]="GREAT",t[t.COOL=2]="COOL",t[t.MISS=3]="MISS",t}({}),aS=(Vb=iS("AuditionUIManager"),Bb=nS({type:zv,group:{name:"Audio Manager",id:"audioManager"}}),Hb=nS({type:c,group:{name:"UI Screens",id:"screens"}}),Ub=nS({type:c,group:{name:"UI Screens",id:"screens"}}),Gb=nS({type:c,group:{name:"UI Screens",id:"screens"}}),Wb=nS({type:c,group:{name:"UI Screens",id:"screens"}}),qb=nS({type:c,group:{name:"UI Screens",id:"screens"}}),Zb=nS({type:y,group:{name:"Gameplay UI",id:"gameplay"}}),Yb=nS({type:y,group:{name:"Gameplay UI",id:"gameplay"}}),jb=nS({type:f,group:{name:"Gameplay UI",id:"gameplay"}}),Kb=nS({type:lt,group:{name:"Gameplay UI",id:"gameplay"}}),Xb=nS({type:y,group:{name:"Results UI",id:"results"}}),Jb=nS({type:y,group:{name:"Results UI",id:"results"}}),Qb=nS({type:y,group:{name:"Results UI",id:"results"}}),$b=nS({type:y,group:{name:"Results UI",id:"results"}}),t_=nS({type:y,group:{name:"Song Info",id:"songInfo"}}),e_=nS({type:y,group:{name:"Song Info",id:"songInfo"}}),i_=nS({type:y,group:{name:"Song Info",id:"songInfo"}}),n_=nS({type:[c],tooltip:"Feedback animation nodes in order: perfect, good, cool, miss"}),r_=nS(ct),o_=nS({type:lt,group:{name:"Feedback",id:"feedback"}}),Vb((l_=Mt((s_=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return e=t.call.apply(t,[this].concat(n))||this,Nt(e,"audioManager",l_,Lt(e)),Nt(e,"mainMenuScreen",c_,Lt(e)),Nt(e,"songSelectionScreen",u_,Lt(e)),Nt(e,"gameplayScreen",h_,Lt(e)),Nt(e,"resultsScreen",p_,Lt(e)),Nt(e,"settingsScreen",d_,Lt(e)),Nt(e,"scoreLabel",f_,Lt(e)),Nt(e,"comboCountLabel",g_,Lt(e)),Nt(e,"progressBar",m_,Lt(e)),Nt(e,"readyGoAnimation",v_,Lt(e)),Nt(e,"finalScoreLabel",y_,Lt(e)),Nt(e,"accuracyLabel",b_,Lt(e)),Nt(e,"maxComboLabel",__,Lt(e)),Nt(e,"gradeLabel",S_,Lt(e)),Nt(e,"songNameLabel",w_,Lt(e)),Nt(e,"artistNameLabel",T_,Lt(e)),Nt(e,"bpmLabel",E_,Lt(e)),Nt(e,"feedbackNodes",A_,Lt(e)),Nt(e,"particleSystemPerfectFragments",C_,Lt(e)),Nt(e,"animScoreFeedBacks",P_,Lt(e)),e.currentUIState=rS.MAIN_MENU,e.feedbackTween=null,e.comboTween=null,e.feedbackAnimNames=["perfect","great","cool","miss"],e}It(e,t);var i=e.prototype;return i.showMainMenu=function(){this.hideAllScreens(),this.mainMenuScreen&&(this.mainMenuScreen.active=!0,this.currentUIState=rS.MAIN_MENU),console.log("Showing main menu")},i.showSongSelection=function(){this.hideAllScreens(),this.songSelectionScreen&&(this.songSelectionScreen.active=!0,this.currentUIState=rS.SONG_SELECTION),console.log("Showing song selection")},i.showGameplay=function(t){this.hideAllScreens(),this.gameplayScreen&&(this.gameplayScreen.active=!0,this.currentUIState=rS.GAMEPLAY),console.log("Showing gameplay"),this.songNameLabel&&(this.songNameLabel.string=t.title),this.artistNameLabel&&(this.artistNameLabel.string=t.artist),this.bpmLabel&&(this.bpmLabel.string=t.bpm.toString()+" BPM")},i.showResults=function(){this.hideAllScreens(),this.resultsScreen&&(this.resultsScreen.active=!0,this.currentUIState=rS.RESULTS),console.log("Showing results")},i.showSettings=function(){this.hideAllScreens(),this.settingsScreen&&(this.settingsScreen.active=!0,this.currentUIState=rS.SETTINGS),console.log("Showing settings")},i.hideAllScreens=function(){this.mainMenuScreen&&(this.mainMenuScreen.active=!1),this.songSelectionScreen&&(this.songSelectionScreen.active=!1),this.gameplayScreen&&(this.gameplayScreen.active=!1),this.resultsScreen&&(this.resultsScreen.active=!1),this.settingsScreen&&(this.settingsScreen.active=!1)},i.updateScore=function(t){this.scoreLabel&&(this.scoreLabel.string=this.formatNumberWithZeros(t,8))},i.updateCombo=function(t){this.comboCountLabel&&(this.comboCountLabel.string="x"+t.toString(),this.comboCountLabel.node.active=t>1)},i.updateProgress=function(t){this.progressBar&&(this.progressBar.fillRange=Math.max(0,Math.min(1,t)))},i.playReadyGoAnimation=function(){var t=this;this.readyGoAnimation.node.active=!0,this.readyGoAnimation.play(),this.audioManager.playSound("s_ready"),this.scheduleOnce((function(){t.audioManager.playSound("s_go")}),1)},i.updateResults=function(t,e,i,n){this.finalScoreLabel&&(this.finalScoreLabel.string=this.formatNumberWithZeros(t,8)),this.accuracyLabel&&(this.accuracyLabel.string=e.toFixed(2)+"%"),this.maxComboLabel&&(this.maxComboLabel.string=""+i),this.gradeLabel&&(this.gradeLabel.string=n,this.setGradeColor(n))},i.setGradeColor=function(t){switch(t){case"S":this.gradeLabel.color=new X(255,215,0,255);break;case"A":this.gradeLabel.color=new X(0,191,255,255);break;case"B":this.gradeLabel.color=new X(50,205,50,255);break;case"C":this.gradeLabel.color=new X(255,165,0,255);break;case"D":this.gradeLabel.color=new X(255,69,0,255);break;case"F":this.gradeLabel.color=new X(128,128,128,255)}},i.formatNumberWithZeros=function(t,e){for(var i=t.toString();i.length<e;)i="0"+i;return i},i.getCurrentUIState=function(){return this.currentUIState},i.showFeedback=function(t){for(var e,i=Ft(this.feedbackNodes);!(e=i()).done;){e.value.active=!1}this.feedbackNodes[t]&&(this.feedbackNodes[t].active=!0);var n=this.feedbackAnimNames[t];this.animScoreFeedBacks.play(n)},xt(e,[{key:"perfectAnimNode",get:function(){return this.feedbackNodes[0]}},{key:"goodNode",get:function(){return this.feedbackNodes[1]}},{key:"coolNode",get:function(){return this.feedbackNodes[2]}},{key:"missNode",get:function(){return this.feedbackNodes[3]}}]),e}(o)).prototype,"audioManager",[Bb],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),c_=Mt(s_.prototype,"mainMenuScreen",[Hb],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),u_=Mt(s_.prototype,"songSelectionScreen",[Ub],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),h_=Mt(s_.prototype,"gameplayScreen",[Gb],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),p_=Mt(s_.prototype,"resultsScreen",[Wb],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),d_=Mt(s_.prototype,"settingsScreen",[qb],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),f_=Mt(s_.prototype,"scoreLabel",[Zb],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),g_=Mt(s_.prototype,"comboCountLabel",[Yb],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),m_=Mt(s_.prototype,"progressBar",[jb],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),v_=Mt(s_.prototype,"readyGoAnimation",[Kb],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),y_=Mt(s_.prototype,"finalScoreLabel",[Xb],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),b_=Mt(s_.prototype,"accuracyLabel",[Jb],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),__=Mt(s_.prototype,"maxComboLabel",[Qb],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),S_=Mt(s_.prototype,"gradeLabel",[$b],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),w_=Mt(s_.prototype,"songNameLabel",[t_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),T_=Mt(s_.prototype,"artistNameLabel",[e_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),E_=Mt(s_.prototype,"bpmLabel",[i_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),A_=Mt(s_.prototype,"feedbackNodes",[n_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),C_=Mt(s_.prototype,"particleSystemPerfectFragments",[r_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),P_=Mt(s_.prototype,"animScoreFeedBacks",[o_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),a_=s_))||a_);t._RF.pop(),t._RF.push({},"88430rgcWxFCqXyHcVl7nDY","AuditionGameplayController",void 0);var sS,lS,cS,uS,hS,pS,dS,fS,gS,mS,vS,yS,bS,_S,SS,wS,TS,ES,AS,CS,PS,MS,IS,NS,LS,OS,RS,xS,FS,DS,zS,kS,VS,BS,HS,US,GS,WS,qS,ZS,YS,jS,KS,XS=function(t){return t[t.INIT=0]="INIT",t[t.PLAYING=1]="PLAYING",t[t.PAUSED=2]="PAUSED",t[t.GAME_OVER=3]="GAME_OVER",t}(XS||{}),JS=e.ccclass,QS=e.property;L_=JS("AuditionGameplayController"),O_=QS(Jy),R_=QS(N_),x_=QS(kb),F_=QS(x),D_=QS(c),z_=QS(x),k_=QS(x),V_=QS(x),B_=QS(ut),H_=QS(zv),U_=QS(aS),L_((q_=Mt((W_=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return e=t.call.apply(t,[this].concat(n))||this,Nt(e,"beatSystem",q_,Lt(e)),Nt(e,"scoringSystem",Z_,Lt(e)),Nt(e,"characterAnimation",Y_,Lt(e)),Nt(e,"pauseButton",j_,Lt(e)),Nt(e,"pauseMenu",K_,Lt(e)),Nt(e,"resumeButton",X_,Lt(e)),Nt(e,"restartButton",J_,Lt(e)),Nt(e,"quitButton",Q_,Lt(e)),Nt(e,"songProgressBar",$_,Lt(e)),Nt(e,"audioManager",tS,Lt(e)),Nt(e,"uimanager",eS,Lt(e)),e.gameState=XS.INIT,e.songStartTime=0,e.songDuration=0,e.notesProcessed=0,e.currentSong=null,e.availableSongs=[{id:"DauCoLoiLam_ATVNCG_Full",title:"Đâu Có Lỗi Lầm",artist:"ATVNCG",difficulty:1,bpm:128,musicPath:"DauCoLoiLam_ATVNCG_Full",previewStart:35e3,previewEnd:5e4},{id:"TrongCom_ATVNCG",title:"Trống Cơm",artist:"ATVNCG",difficulty:2,bpm:86,musicPath:"TrongCom_ATVNCG",previewStart:35e3,previewEnd:5e4}],e}It(e,t);var i=e.prototype;return i.getAvailableSongs=function(){return this.availableSongs},i.getUnlockedSongs=function(){return this.availableSongs},i.getHighScore=function(t){return 0},i.isSongUnlocked=function(t){return!0},i.start=function(){if(this.setupButtonEvents(),this.scoringSystem&&(this.scoringSystem.reset(),this.scoringSystem.onScoreUpdate(this.updateScoreDisplay.bind(this)),this.scoringSystem.onComboUpdate(this.updateComboDisplay.bind(this)),this.beatSystem.setScoreCallback(this.onScoringProcessed.bind(this))),this.characterAnimation&&this.characterAnimation.resetToIdle(),this.availableSongs&&this.availableSongs.length>0){var t=Math.floor(Math.random()*this.availableSongs.length),e=this.availableSongs[t];this.startSong(e.id),console.log("Starting random song: "+e.id)}else console.error("No available songs found")},i.startSong=function(t){this.gameState=XS.INIT,console.log("Starting song: "+t);var e=this.availableSongs.find((function(e){return e.id===t}));e?(this.currentSong=e,this.initGameplay(),this.uimanager.showGameplay(this.currentSong)):console.error("Song with id "+t+" not found")},i.initGameplay=function(){var t=this;this.audioManager&&this.beatSystem?this.currentSong?Promise.all([this.audioManager.loadSong(Hm.getMusicPath(this.currentSong)),this.characterAnimation.loadDanceData(this.currentSong.id)]).then((function(e){e[0],e[1];return console.log("Song and dance data loaded successfully"),t.songDuration=t.audioManager.getDuration(),t.characterAnimation.setMusicSpeed(t.currentSong.bpm),t.startGameplay(),t.songDuration})).catch((function(t){throw console.error("Failed to load song or dance data:",t),t})):console.error("No song selected"):console.error("Required components not found")},i.startGameplay=function(){var t=this;this.beatSystem.setReadyCallback((function(){t.uimanager.playReadyGoAnimation()})),this.songStartTime=Date.now(),this.audioManager.playSong(),this.beatSystem.startBeatSystem(this.currentSong.bpm,this.songDuration),this.gameState=XS.PLAYING,console.log("Gameplay started")},i.setupButtonEvents=function(){this.pauseButton&&this.pauseButton.node.on(x.EventType.CLICK,this.onPauseButtonClicked,this),this.resumeButton&&this.resumeButton.node.on(x.EventType.CLICK,this.onResumeButtonClicked,this),this.restartButton&&this.restartButton.node.on(x.EventType.CLICK,this.onRestartButtonClicked,this),this.quitButton&&this.quitButton.node.on(x.EventType.CLICK,this.onQuitButtonClicked,this),this.pauseMenu&&(this.pauseMenu.active=!1)},i.update=function(t){this.gameState===XS.PLAYING&&(this.updateProgressBar(),this.audioManager&&this.audioManager.getCurrentTime()>=this.songDuration&&this.songStartTime>0&&this.endGameplay())},i.updateProgressBar=function(){if(this.songProgressBar&&!(this.songDuration<=0)&&this.audioManager){var t=this.audioManager.getCurrentTime(),e=.9*Math.min(1,t/this.songDuration);this.songProgressBar.progress=e+.1,this.uimanager.updateProgress(e)}},i.onScoringProcessed=function(t,e){var i;switch(this.notesProcessed++,this.scoringSystem.processNoteResult(t,e),this.characterAnimation.reactToInput(t,this.scoringSystem.getCombo()),t){case Ky.PERFECT:i=oS.PERFECT;break;case Ky.GOOD:i=oS.GREAT;break;case Ky.MISS:i=oS.MISS;break;default:i=oS.MISS}this.uimanager.showFeedback(i)},i.updateScoreDisplay=function(t){this.uimanager.updateScore(t)},i.updateComboDisplay=function(t){this.uimanager.updateCombo(t)},i.endGameplay=function(){if(this.gameState=XS.GAME_OVER,this.audioManager){this.audioManager.stopSong(),this.beatSystem.stopBeatSystem();var t=this.scoringSystem.getScore(),e=this.scoringSystem.getMaxCombo(),i=this.scoringSystem.getAccuracyPercentage(),n=this.scoringSystem.getGrade();this.uimanager.showResults(),this.uimanager.updateResults(t,i,e,n),console.log("Gameplay ended. Score: "+t+", Accuracy: "+i.toFixed(2)+"%, Max Combo: "+e+", Grade: "+n)}},i.onPauseButtonClicked=function(){this.pauseGame()},i.onResumeButtonClicked=function(){this.resumeGame()},i.onRestartButtonClicked=function(){this.pauseMenu&&(this.pauseMenu.active=!1),this.audioManager&&(this.audioManager.stopSong(),this.beatSystem.stopBeatSystem(),this.gameState=XS.INIT,M.loadScene(M.getScene().name))},i.onQuitButtonClicked=function(){this.audioManager&&(this.audioManager.stopSong(),this.beatSystem.stopBeatSystem(),this.gameState=XS.INIT)},i.pauseGame=function(){this.gameState===XS.PLAYING&&(this.gameState=XS.PAUSED,this.audioManager&&(this.audioManager.pauseSong(),this.pauseMenu&&(this.pauseMenu.active=!0)))},i.resumeGame=function(){this.gameState===XS.PAUSED&&(this.gameState=XS.PLAYING,this.audioManager&&(this.audioManager.resumeSong(),this.pauseMenu&&(this.pauseMenu.active=!1)))},e}(o)).prototype,"beatSystem",[O_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Z_=Mt(W_.prototype,"scoringSystem",[R_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Y_=Mt(W_.prototype,"characterAnimation",[x_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),j_=Mt(W_.prototype,"pauseButton",[F_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),K_=Mt(W_.prototype,"pauseMenu",[D_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),X_=Mt(W_.prototype,"resumeButton",[z_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),J_=Mt(W_.prototype,"restartButton",[k_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Q_=Mt(W_.prototype,"quitButton",[V_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),$_=Mt(W_.prototype,"songProgressBar",[B_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),tS=Mt(W_.prototype,"audioManager",[H_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),eS=Mt(W_.prototype,"uimanager",[U_],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),G_=W_));t._RF.pop(),t._RF.push({},"13564WRJ8BHHoVT5R2hp2xb","AuditionGameplayUI",void 0);var $S,tw,ew,iw,nw,rw,ow,aw,sw,lw,cw,uw,hw,pw,dw,fw,gw,mw,vw,yw,bw=e.ccclass,_w=e.property;sS=bw("AuditionGameplayUI"),lS=_w(y),cS=_w(y),uS=_w(y),hS=_w(c),pS=_w(y),dS=_w(c),fS=_w([c]),gS=_w(c),mS=_w(c),vS=_w(c),yS=_w(y),bS=_w(c),_S=_w(c),SS=_w(c),wS=_w(X),TS=_w(X),ES=_w(X),AS=_w(X),CS=_w(X),PS=_w(X),sS((NS=Mt((IS=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return e=t.call.apply(t,[this].concat(n))||this,Nt(e,"scoreLabel",NS,Lt(e)),Nt(e,"comboLabel",LS,Lt(e)),Nt(e,"multiplierLabel",OS,Lt(e)),Nt(e,"accuracyFeedbackNode",RS,Lt(e)),Nt(e,"accuracyLabel",xS,Lt(e)),Nt(e,"patternDisplay",FS,Lt(e)),Nt(e,"patternDots",DS,Lt(e)),Nt(e,"patternProgressBar",zS,Lt(e)),Nt(e,"syncPointIndicator",kS,Lt(e)),Nt(e,"finishMoveIndicator",VS,Lt(e)),Nt(e,"finishMoveLabel",BS,Lt(e)),Nt(e,"leftButton",HS,Lt(e)),Nt(e,"rightButton",US,Lt(e)),Nt(e,"spaceButton",GS,Lt(e)),Nt(e,"leftButtonColor",WS,Lt(e)),Nt(e,"rightButtonColor",qS,Lt(e)),Nt(e,"spaceButtonColor",ZS,Lt(e)),Nt(e,"perfectColor",YS,Lt(e)),Nt(e,"goodColor",jS,Lt(e)),Nt(e,"missColor",KS,Lt(e)),e.currentSequence=[],e.currentProgress=0,e.activeFeedbackAnimation=null,e}It(e,t);var i=e.prototype;return i.onLoad=function(){this.resetUI()},i.resetUI=function(){this.updateScore(0),this.updateCombo(0),this.updateMultiplier(1),this.accuracyFeedbackNode&&(this.accuracyFeedbackNode.active=!1),this.clearPatternDisplay(),this.finishMoveIndicator&&(this.finishMoveIndicator.active=!1),this.resetButtons()},i.updateScore=function(t){this.scoreLabel&&(this.scoreLabel.string=t.toString())},i.updateCombo=function(t){this.comboLabel&&(t>0?(this.comboLabel.node.active=!0,this.comboLabel.string="Combo: "+t,this.pulseNode(this.comboLabel.node)):this.comboLabel.node.active=!1)},i.updateMultiplier=function(t){this.multiplierLabel&&(this.multiplierLabel.string="x"+t.toFixed(1),this.multiplierLabel.color=t>2?this.perfectColor:t>1.5?this.goodColor:X.WHITE)},i.showAccuracyFeedback=function(t){var e=this;if(this.accuracyFeedbackNode&&this.accuracyLabel){var i,n;switch(this.activeFeedbackAnimation&&this.activeFeedbackAnimation.stop(),t){case Ky.PERFECT:i="PERFECT",n=this.perfectColor;break;case Ky.GOOD:i="GOOD",n=this.goodColor;break;case Ky.MISS:i="MISS",n=this.missColor}this.accuracyLabel.string=i,this.accuracyLabel.color=n,this.accuracyFeedbackNode.active=!0;var r=this.accuracyFeedbackNode.scale.clone();this.accuracyFeedbackNode.setScale(0,0,1);var o=this.accuracyFeedbackNode.getComponent(b)||this.accuracyFeedbackNode.addComponent(b);o.opacity=255,this.activeFeedbackAnimation=v(this.accuracyFeedbackNode).to(.2,{scale:new g(1.2,1.2,1)}).to(.1,{scale:r}).delay(.5).to(.3,{scale:new g(.8,.8,1)}).parallel(v(o).to(.3,{opacity:0})).call((function(){e.accuracyFeedbackNode.active=!1,e.accuracyFeedbackNode.setScale(r)})).start()}},i.updatePatternDisplay=function(t){var e=this;if(this.patternDisplay){if(this.patternDisplay.active=!0,this.currentSequence=t,this.currentProgress=0,this.patternDots.forEach((function(i,n){var r=i.getComponent(f);n<t.length?(r.color=e.getColorForInput(t[n]),i.active=!0):i.active=!1})),this.syncPointIndicator&&(this.syncPointIndicator.active=!0,t.length>0&&t.length<=this.patternDots.length)){var i=this.patternDots[t.length-1].position;this.syncPointIndicator.setPosition(i.x+60,i.y,i.z)}this.updatePatternProgress(0,t.length)}},i.updatePatternProgress=function(t,e){if(this.patternProgressBar){this.currentProgress=t;var i=e>0?t/e:0,n=this.patternProgressBar.getComponent(f);n&&(n.fillRange=i);for(var r=0;r<this.patternDots.length;r++)if(r<this.currentSequence.length){var o=this.patternDots[r].getComponent(f);o.color=r<t?this.perfectColor:this.getColorForInput(this.currentSequence[r])}if(t===e&&this.syncPointIndicator){var a=this.syncPointIndicator.getComponent(f);a&&(a.color=this.perfectColor,this.pulseNode(this.syncPointIndicator))}}},i.clearPatternDisplay=function(){this.currentSequence=[],this.currentProgress=0,this.patternDisplay&&(this.patternDisplay.active=!1),this.syncPointIndicator&&(this.syncPointIndicator.active=!1),this.patternDots.forEach((function(t){t.active=!1}))},i.showButtonPress=function(t,e){var i=null;switch(t){case Kv.LEFT:i=this.leftButton;break;case Kv.RIGHT:i=this.rightButton;break;case Kv.SPACE:i=this.spaceButton}if(i){var n=i.getComponent(f);if(n){var r=n.color.clone();n.color=e?this.perfectColor:this.missColor;var o=i.scale.clone();v(i).to(.05,{scale:new g(.9*o.x,.9*o.y,o.z)}).to(.1,{scale:o}).call((function(){n.color=r})).start()}}},i.resetButtons=function(){if(this.leftButton){this.leftButton.setScale(1,1,1);var t=this.leftButton.getComponent(f);t&&(t.color=this.leftButtonColor)}if(this.rightButton){this.rightButton.setScale(1,1,1);var e=this.rightButton.getComponent(f);e&&(e.color=this.rightButtonColor)}if(this.spaceButton){this.spaceButton.setScale(1,1,1);var i=this.spaceButton.getComponent(f);i&&(i.color=this.spaceButtonColor)}},i.showFinishMoveEffect=function(){var t=this;if(this.finishMoveIndicator&&this.finishMoveLabel){this.finishMoveIndicator.active=!0,this.finishMoveLabel.string="FINISH MOVE!";var e=this.finishMoveIndicator.getComponent(lt);e?e.play("finish_move_flash"):(this.pulseNode(this.finishMoveIndicator,1.5,.5),setTimeout((function(){t.finishMoveIndicator.active=!1}),3e3))}},i.getColorForInput=function(t){switch(t){case Kv.LEFT:return this.leftButtonColor;case Kv.RIGHT:return this.rightButtonColor;case Kv.SPACE:return this.spaceButtonColor;default:return X.WHITE}},i.pulseNode=function(t,e,i){if(void 0===e&&(e=1.2),void 0===i&&(i=.3),t){var n=t.scale.clone();v(t).to(i/2,{scale:new g(n.x*e,n.y*e,n.z)}).to(i/2,{scale:n}).start()}},i.showPatternSkipEffect=function(){var t=this;if(this.patternDisplay){var e=this.patternDisplay.getComponent(b)||this.patternDisplay.addComponent(b);e.opacity=255;var i=this.patternDisplay.position.clone();v(this.patternDisplay).to(.1,{position:new g(i.x+20,i.y,i.z)}).to(.1,{position:new g(i.x-200,i.y,i.z)}).parallel(v(e).to(.2,{opacity:0})).call((function(){t.patternDisplay.setPosition(i),t.patternDisplay.active=!1})).start()}},i.showPatternCompleteEffect=function(t){var e=this;if(void 0===t&&(t=!1),this.patternDisplay){t&&this.showFinishMoveEffect();var i=this.patternDisplay.getComponent(b)||this.patternDisplay.addComponent(b);i.opacity=255,v(i).to(.5,{opacity:0}).call((function(){e.patternDisplay.active=!1})).start()}},e}(o)).prototype,"scoreLabel",[lS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),LS=Mt(IS.prototype,"comboLabel",[cS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),OS=Mt(IS.prototype,"multiplierLabel",[uS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),RS=Mt(IS.prototype,"accuracyFeedbackNode",[hS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),xS=Mt(IS.prototype,"accuracyLabel",[pS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),FS=Mt(IS.prototype,"patternDisplay",[dS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),DS=Mt(IS.prototype,"patternDots",[fS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),zS=Mt(IS.prototype,"patternProgressBar",[gS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),kS=Mt(IS.prototype,"syncPointIndicator",[mS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),VS=Mt(IS.prototype,"finishMoveIndicator",[vS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),BS=Mt(IS.prototype,"finishMoveLabel",[yS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),HS=Mt(IS.prototype,"leftButton",[bS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),US=Mt(IS.prototype,"rightButton",[_S],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),GS=Mt(IS.prototype,"spaceButton",[SS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),WS=Mt(IS.prototype,"leftButtonColor",[wS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new X(79,195,247)}}),qS=Mt(IS.prototype,"rightButtonColor",[TS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new X(255,112,67)}}),ZS=Mt(IS.prototype,"spaceButtonColor",[ES],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new X(255,235,59)}}),YS=Mt(IS.prototype,"perfectColor",[AS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new X(120,255,120)}}),jS=Mt(IS.prototype,"goodColor",[CS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new X(255,193,7)}}),KS=Mt(IS.prototype,"missColor",[PS],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new X(211,47,47)}}),MS=IS));t._RF.pop(),t._RF.push({},"89cd9G0+vdPI7ElDHJDudjd","AuditionMainMenuController",void 0);var Sw,ww,Tw,Ew,Aw,Cw=e.ccclass,Pw=e.property;$S=Cw("AuditionMainMenuController"),tw=Pw(x),ew=Pw(x),iw=Pw(x),nw=Pw(x),rw=Pw(c),ow=Pw(y),aw=Pw(y),$S((cw=Mt((lw=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return e=t.call.apply(t,[this].concat(n))||this,Nt(e,"playButton",cw,Lt(e)),Nt(e,"customizeButton",uw,Lt(e)),Nt(e,"optionsButton",hw,Lt(e)),Nt(e,"exitButton",pw,Lt(e)),Nt(e,"logoNode",dw,Lt(e)),Nt(e,"playerLevelLabel",fw,Lt(e)),Nt(e,"versionLabel",gw,Lt(e)),Nt(e,"backgroundMusicPath",mw,Lt(e)),Nt(e,"buttonSound",vw,Lt(e)),Nt(e,"animateElements",yw,Lt(e)),e}It(e,t);var i=e.prototype;return i.onLoad=function(){this.setupButtonEvents(),this.animateElements&&this.initializeAnimations(),this.versionLabel&&(this.versionLabel.string="v0.1.0 Alpha")},i.start=function(){this.playBackgroundMusic()},i.setupButtonEvents=function(){this.playButton&&this.playButton.node.on(x.EventType.CLICK,this.onPlayButtonClicked,this),this.customizeButton&&this.customizeButton.node.on(x.EventType.CLICK,this.onCustomizeButtonClicked,this),this.optionsButton&&this.optionsButton.node.on(x.EventType.CLICK,this.onOptionsButtonClicked,this),this.exitButton&&this.exitButton.node.on(x.EventType.CLICK,this.onExitButtonClicked,this)},i.initializeAnimations=function(){this.logoNode&&(this.logoNode.scale=new g(1.2,1.2,1),v(this.logoNode).to(2,{scale:new g(1.1,1.1,1)}).to(2,{scale:new g(1.2,1.2,1)}).union().repeatForever().start()),[this.playButton,this.customizeButton,this.optionsButton,this.exitButton].forEach((function(t,e){if(t){var i=t.node.scale.clone();t.node.on(c.EventType.MOUSE_ENTER,(function(){v(t.node).to(.2,{scale:new g(1.1*i.x,1.1*i.y,1)}).start()})),t.node.on(c.EventType.MOUSE_LEAVE,(function(){v(t.node).to(.2,{scale:i}).start()})),t.node.setPosition(t.node.position.x,t.node.position.y-50);var n=t.node.getComponent(b);n||(n=t.node.addComponent(b)),n.opacity=0,v(t.node).delay(.2+.1*e).to(.5,{position:new g(t.node.position.x,t.node.position.y+50,0)},{easing:"backOut"}).start(),v(n).delay(.2+.1*e).to(.5,{opacity:255}).start()}}))},i.playBackgroundMusic=function(){},i.onPlayButtonClicked=function(){},i.onCustomizeButtonClicked=function(){console.log("Customize button clicked - Feature coming soon")},i.onOptionsButtonClicked=function(){console.log("Options button clicked - Feature coming soon")},i.onExitButtonClicked=function(){console.log("Exit button clicked")},i.onDestroy=function(){},e}(o)).prototype,"playButton",[tw],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),uw=Mt(lw.prototype,"customizeButton",[ew],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),hw=Mt(lw.prototype,"optionsButton",[iw],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),pw=Mt(lw.prototype,"exitButton",[nw],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),dw=Mt(lw.prototype,"logoNode",[rw],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),fw=Mt(lw.prototype,"playerLevelLabel",[ow],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),gw=Mt(lw.prototype,"versionLabel",[aw],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),mw=Mt(lw.prototype,"backgroundMusicPath",[Pw],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"audition/audio/menu_music"}}),vw=Mt(lw.prototype,"buttonSound",[Pw],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"click"}}),yw=Mt(lw.prototype,"animateElements",[Pw],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),sw=lw));t._RF.pop(),t._RF.push({},"9c847FTTeVHTLgt1NPmkCyR","AuditionRandomBackground",void 0);var Mw,Iw,Nw,Lw,Ow,Rw,xw,Fw,Dw,zw,kw,Vw,Bw,Hw,Uw,Gw,Ww,qw,Zw=e.ccclass,Yw=e.property;Sw=Zw("AuditionRandomBackground"),ww=Yw([i]),Sw((Aw=Mt((Ew=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return e=t.call.apply(t,[this].concat(n))||this,Nt(e,"backgroundFrames",Aw,Lt(e)),e.meshRenderer=null,e}It(e,t);var i=e.prototype;return i.onLoad=function(){if(this.meshRenderer=this.getComponent(ht),this.meshRenderer){if(this.backgroundFrames.length>0){var t=r(0,this.backgroundFrames.length),e=this.backgroundFrames[t];this.meshRenderer.material&&this.meshRenderer.material.setProperty("mainTexture",e.texture)}}else console.error("MeshRenderer component not found on AuditionRandomBackground")},i.update=function(t){},e}(o)).prototype,"backgroundFrames",[ww],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Tw=Ew));t._RF.pop(),t._RF.push({},"2c315k/8UpN5rJQH/P/zdLe","AuditionResultsController",void 0);var jw,Kw,Xw,Jw,Qw,$w,tT,eT,iT,nT,rT,oT,aT,sT,lT,cT,uT,hT=e.ccclass,pT=e.property;Mw=hT("AuditionResultsController"),Iw=pT(x),Nw=pT(x),Lw=pT(x),Ow=pT(c),Rw=pT(c),xw=pT(y),Mw((zw=Mt((Dw=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return e=t.call.apply(t,[this].concat(n))||this,Nt(e,"retryButton",zw,Lt(e)),Nt(e,"nextButton",kw,Lt(e)),Nt(e,"mainMenuButton",Vw,Lt(e)),Nt(e,"resultsContent",Bw,Lt(e)),Nt(e,"expGainDisplay",Hw,Lt(e)),Nt(e,"expGainLabel",Uw,Lt(e)),Nt(e,"backgroundMusicPath",Gw,Lt(e)),Nt(e,"buttonClickSound",Ww,Lt(e)),Nt(e,"resultsSound",qw,Lt(e)),e.isAnimatingResults=!1,e}It(e,t);var i=e.prototype;return i.onLoad=function(){if(aS.instance.showResults(),this.setupButtonEvents(),this.resultsContent){this.resultsContent.scale=new g(.8,.8,1);var t=this.resultsContent.getComponent(b);t||(t=this.resultsContent.addComponent(b)),t.opacity=0}this.expGainDisplay&&(this.expGainDisplay.active=!1)},i.start=function(){var t=this;this.playBackgroundMusic(),this.scheduleOnce((function(){t.animateResults()}),.5)},i.setupButtonEvents=function(){this.retryButton&&(this.retryButton.node.on(x.EventType.CLICK,this.onRetryButtonClicked,this),this.retryButton.interactable=!1),this.nextButton&&(this.nextButton.node.on(x.EventType.CLICK,this.onNextButtonClicked,this),this.nextButton.interactable=!1),this.mainMenuButton&&(this.mainMenuButton.node.on(x.EventType.CLICK,this.onMainMenuButtonClicked,this),this.mainMenuButton.interactable=!1)},i.playBackgroundMusic=function(){},i.animateResults=function(){var t=this;if(this.resultsContent){this.isAnimatingResults=!0,this.resultsContent.active=!0,v(this.resultsContent).to(.5,{scale:new g(1,1,1)}).start();var e=this.resultsContent.getComponent(b)||this.resultsContent.addComponent(b);e&&v(e).to(.5,{opacity:255}).call((function(){t.scheduleOnce((function(){t.showExperienceGain()}),1)})).start()}},i.showExperienceGain=function(){var t=this;if(this.expGainDisplay&&this.expGainLabel){this.expGainLabel&&(this.expGainLabel.string="+100 EXP"),this.expGainDisplay.active=!0,this.expGainDisplay.scale=new g(.5,.5,1),v(this.expGainDisplay).to(.3,{scale:new g(1.2,1.2,1)}).to(.2,{scale:new g(1,1,1)}).call((function(){t.enableButtons(),t.isAnimatingResults=!1})).start()}},i.enableButtons=function(){this.retryButton&&(this.retryButton.interactable=!0),this.nextButton&&(this.nextButton.interactable=!0),this.mainMenuButton&&(this.mainMenuButton.interactable=!0)},i.onRetryButtonClicked=function(){},i.onNextButtonClicked=function(){},i.onMainMenuButtonClicked=function(){},i.onDestroy=function(){},e}(o)).prototype,"retryButton",[Iw],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),kw=Mt(Dw.prototype,"nextButton",[Nw],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Vw=Mt(Dw.prototype,"mainMenuButton",[Lw],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Bw=Mt(Dw.prototype,"resultsContent",[Ow],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Hw=Mt(Dw.prototype,"expGainDisplay",[Rw],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Uw=Mt(Dw.prototype,"expGainLabel",[xw],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Gw=Mt(Dw.prototype,"backgroundMusicPath",[pT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"audition/audio/results_music"}}),Ww=Mt(Dw.prototype,"buttonClickSound",[pT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"click"}}),qw=Mt(Dw.prototype,"resultsSound",[pT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"results"}}),Fw=Dw));t._RF.pop(),t._RF.push({},"6a29cIl249M9qUzgX5Tgjl0","AuditionSongItemComponent",void 0);var dT,fT,gT,mT,vT,yT,bT,_T,ST,wT,TT,ET,AT,CT,PT,MT,IT,NT,LT,OT,RT,xT,FT,DT,zT,kT,VT,BT,HT=e.ccclass,UT=e.property;jw=HT("AuditionSongItemComponent"),Kw=UT(y),Xw=UT(y),Jw=UT(y),Qw=UT(y),$w=UT(f),tT=UT(x),eT=UT(c),jw((rT=Mt((nT=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return e=t.call.apply(t,[this].concat(n))||this,Nt(e,"titleLabel",rT,Lt(e)),Nt(e,"artistLabel",oT,Lt(e)),Nt(e,"difficultyLabel",aT,Lt(e)),Nt(e,"highScoreLabel",sT,Lt(e)),Nt(e,"lockIcon",lT,Lt(e)),Nt(e,"selectButton",cT,Lt(e)),Nt(e,"selectedIndicator",uT,Lt(e)),e.songId="",e.unlocked=!1,e.onSelect=null,e}It(e,t);var i=e.prototype;return i.setup=function(t){if(this.songId=t.id,this.unlocked=t.unlocked,this.titleLabel&&(this.titleLabel.string=t.title),this.artistLabel&&(this.artistLabel.string=t.artist),this.difficultyLabel){for(var e="",i=0;i<t.difficulty;i++)e+="★";this.difficultyLabel.string=e}this.highScoreLabel&&(this.highScoreLabel.string=t.highScore>0?t.highScore.toString():"-"),this.lockIcon&&(this.lockIcon.node.active=!t.unlocked),this.selectButton&&(this.selectButton.interactable=t.unlocked,this.selectButton.node.on(x.EventType.CLICK,this.onButtonClicked,this)),this.selectedIndicator&&(this.selectedIndicator.active=!1)},i.onButtonClicked=function(){this.unlocked&&(this.onSelect&&this.onSelect(this.songId),this.selectedIndicator&&(this.selectedIndicator.active=!0))},i.setSelected=function(t){this.selectedIndicator&&(this.selectedIndicator.active=t)},e}(o)).prototype,"titleLabel",[Kw],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),oT=Mt(nT.prototype,"artistLabel",[Xw],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),aT=Mt(nT.prototype,"difficultyLabel",[Jw],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),sT=Mt(nT.prototype,"highScoreLabel",[Qw],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),lT=Mt(nT.prototype,"lockIcon",[$w],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),cT=Mt(nT.prototype,"selectButton",[tT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),uT=Mt(nT.prototype,"selectedIndicator",[eT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),iT=nT));t._RF.pop(),t._RF.push({},"1e799boHRpGq74bdTFaeFfD","AuditionSongSelectionController",void 0);var GT,WT,qT,ZT,YT,jT=e.ccclass,KT=e.property;dT=jT("AuditionSongSelectionController"),fT=KT(x),gT=KT(pt),mT=KT(c),vT=KT(l),yT=KT(y),bT=KT(y),_T=KT(y),ST=KT(y),wT=KT(y),TT=KT(x),ET=KT(zv),dT((PT=Mt((CT=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return e=t.call.apply(t,[this].concat(n))||this,Nt(e,"backButton",PT,Lt(e)),Nt(e,"songListScrollView",MT,Lt(e)),Nt(e,"songListContent",IT,Lt(e)),Nt(e,"songItemPrefab",NT,Lt(e)),Nt(e,"songTitleLabel",LT,Lt(e)),Nt(e,"artistLabel",OT,Lt(e)),Nt(e,"difficultyLabel",RT,Lt(e)),Nt(e,"bpmLabel",xT,Lt(e)),Nt(e,"highScoreLabel",FT,Lt(e)),Nt(e,"playButton",DT,Lt(e)),Nt(e,"backgroundMusicPath",zT,Lt(e)),Nt(e,"previewVolume",kT,Lt(e)),Nt(e,"buttonSound",VT,Lt(e)),Nt(e,"audioManager",BT,Lt(e)),e.selectedSongId=null,e.previewTimer=null,e}It(e,t);var i=e.prototype;return i.onLoad=function(){this.setupButtonEvents(),this.playBackgroundMusic()},i.start=function(){this.populateSongList(),this.clearSongSelection()},i.setupButtonEvents=function(){this.backButton&&this.backButton.node.on(x.EventType.CLICK,this.onBackButtonClicked,this),this.playButton&&(this.playButton.node.on(x.EventType.CLICK,this.onPlayButtonClicked,this),this.playButton.interactable=!1)},i.playBackgroundMusic=function(){},i.populateSongList=function(){var t=this;this.songListContent&&this.songListContent.removeAllChildren();[].forEach((function(e){if(t.songItemPrefab){var i,n=A(t.songItemPrefab),r=null==(i=n.getChildByName("SongName"))?void 0:i.getComponent(y);r&&(r.string=e.title);var o=n.getChildByName("Difficulty");if(o)for(var a=o.children,s=0;s<a.length;s++)a[s].active=s<e.difficulty;t.songListContent.addChild(n)}}));var e=this.songListContent.getComponent($);e&&e.updateLayout()},i.onSongSelected=function(t){this.selectedSongId=t;var e={id:t,title:"Song Title",artist:"Artist Name",difficulty:1,bpm:120,musicPath:"audition/audio/song.mp3",previewStart:0,previewEnd:100};if(e){if(this.songTitleLabel&&(this.songTitleLabel.string=e.title),this.artistLabel&&(this.artistLabel.string=e.artist),this.difficultyLabel&&(this.difficultyLabel.string="Difficulty: "+e.difficulty),this.bpmLabel&&(this.bpmLabel.string="BPM: "+e.bpm),this.highScoreLabel){this.highScoreLabel.string="No records yet"}this.playButton&&(this.playButton.interactable=!0),this.playPreview(e)}},i.playPreview=function(t){var e=this;this.audioManager&&(this.stopPreview(),this.audioManager.loadSong(t.audioPath).then((function(){e.audioManager.setMusicVolume(e.previewVolume),e.audioManager.playSong(t.previewStart);var i=t.previewEnd-t.previewStart;e.previewTimer=setTimeout((function(){e.stopPreview(),e.playBackgroundMusic()}),i)})).catch((function(t){console.error("Failed to play song preview:",t)})))},i.stopPreview=function(){this.previewTimer&&(clearTimeout(this.previewTimer),this.previewTimer=null),this.audioManager&&this.audioManager.stopSong()},i.clearSongSelection=function(){this.selectedSongId=null,this.songTitleLabel&&(this.songTitleLabel.string="Select a Song"),this.artistLabel&&(this.artistLabel.string=""),this.difficultyLabel&&(this.difficultyLabel.string=""),this.bpmLabel&&(this.bpmLabel.string=""),this.highScoreLabel&&(this.highScoreLabel.string=""),this.playButton&&(this.playButton.interactable=!1)},i.onBackButtonClicked=function(){},i.onPlayButtonClicked=function(){this.selectedSongId},i.onDestroy=function(){},e}(o)).prototype,"backButton",[fT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),MT=Mt(CT.prototype,"songListScrollView",[gT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),IT=Mt(CT.prototype,"songListContent",[mT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),NT=Mt(CT.prototype,"songItemPrefab",[vT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),LT=Mt(CT.prototype,"songTitleLabel",[yT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),OT=Mt(CT.prototype,"artistLabel",[bT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),RT=Mt(CT.prototype,"difficultyLabel",[_T],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),xT=Mt(CT.prototype,"bpmLabel",[ST],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),FT=Mt(CT.prototype,"highScoreLabel",[wT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),DT=Mt(CT.prototype,"playButton",[TT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),zT=Mt(CT.prototype,"backgroundMusicPath",[KT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"audition/audio/selection_music"}}),kT=Mt(CT.prototype,"previewVolume",[KT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),VT=Mt(CT.prototype,"buttonSound",[KT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"click"}}),BT=Mt(CT.prototype,"audioManager",[ET],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),AT=CT));t._RF.pop(),t._RF.push({},"9470cSQRxtAIYqQT5Sm+ZX6","AnimationGraph",void 0);var XT,JT=e.ccclass,QT=e.property,$T=(GT=JT("AnimationGraph"),WT=QT(U),GT((YT=Mt((ZT=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this)._graph=void 0,Nt(e,"isPose",YT,Lt(e)),e}It(e,t);var i=e.prototype;return i.start=function(){if(this._graph=this.getComponent(dt.AnimationController),void 0===this._graph||null===this._graph)throw new Error(this.node.name+" can not find AnimationController")},i.play=function(t,e){this.setValue(t,e)},i.setValue=function(t,e){var i;this.isPose?this._graph.setValue_experimental(t,e):null==(i=this._graph)||i.setValue(t,e)},i.setLayer=function(t,e){this._graph.setLayerWeight(t,e)},i.update=function(t){},e}(o)).prototype,"isPose",[WT],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),qT=ZT))||qT);t._RF.pop(),t._RF.push({},"61dcf57FUBJ8oXIVFbL/HTv","AnimationGraphGroup",void 0);var tE,eE=e.ccclass;e.property,eE("AnimationGraphGroup")(XT=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this)._groups=void 0,e.curActiveKey="",e}It(e,t);var i=e.prototype;return i.__preload=function(){if(this._groups=this.getComponentsInChildren($T),void 0===this._groups||null===this._groups)throw new Error(this.node.name+" node not find AnimationGraph")},i.play=function(t,e){if(this.curActiveKey!==t){this.curActiveKey=t;try{for(var i=0;i<this._groups.length;i++)this._groups[i].play(t,e)}catch(t){ve.LOG&&console.log(t)}}},i.setLayer=function(t,e){for(var i=0;i<this._groups.length;i++)this._groups[i].setLayer(t,e)},e}(o));t._RF.pop(),t._RF.push({},"2d25eUq/olFcqr07UVxslCs","AnimatorController",void 0);var iE,nE=e.ccclass;e.property,nE("AnimatorController")(tE=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this)._anim=Object.create(null),e._data=Object.create(null),e}It(e,t);var i=e.prototype;return i.init=function(t){this._data=t,this._anim=this.getComponent(st)},i.play=function(t){var e=this._data[t];this._anim.play(e[0])},e}(o));t._RF.pop(),t._RF.push({},"d570fjSILJE1p55LwtRI8Hp","ButtonBackToHome",void 0);var rE,oE,aE,sE=e.ccclass;e.property,sE("ButtonBackToHome")(iE=function(t){function e(){return t.apply(this,arguments)||this}return It(e,t),e.prototype.onTouch_Home=function(){M.loadScene(Am)},e}(o));t._RF.pop(),t._RF.push({},"4a695abDKBOU7c/73mimyQe","EffectBase",void 0);var lE,cE,uE,hE,pE,dE,fE=e.ccclass,gE=e.property,mE=fE("EffectBase")((aE=Mt((oE=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).define="",e.recycleMe=null,Nt(e,"sound",aE,Lt(e)),e}It(e,t);var i=e.prototype;return i.init=function(t,e,i){this.define=t,this.recycleMe=e,this.sound&&Yi.instance.playSound(this.sound)},i.putToPool=function(){var t;null==this||null==(t=this.recycleMe)||t.call(this,this)},e}(o)).prototype,"sound",[gE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),rE=oE))||rE;t._RF.pop(),t._RF.push({},"f1faaHNgYdAgqUp6WWlyLaO","EffectController",void 0);var vE,yE,bE,_E,SE,wE,TE,EE,AE=e.ccclass,CE=e.property,PE=(lE=AE("EffectController"),cE=CE(c),lE(((dE=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).preloadPrefabNames=[],Nt(e,"uiEffectContainer",pE,Lt(e)),e.effectPoolMap=new Map,e}It(e,t);var i=e.prototype;return i.onLoad=function(){e.instance=this,this.initPool(),this.preloadEffects()},i.onDestroy=function(){e.instance=null},i.start=function(){this.initPool()},i.preloadEffects=function(){var t=this;this.preloadPrefabNames.forEach((function(e){0==t.effectPoolMap.has(e)&&Qe.loadEffectRes(e).then((function(i){t.effectPoolMap.set(e,t.createPool(i,t.uiEffectContainer,mE))})).catch((function(t){ve.LOG&&console.error(t,e)}))}))},i.initPool=function(){},i.createPool=function(t,e,i,n){if(void 0===n&&(n=1),!t||!e)return null;var r=new ee((function(){var e=A(t).getComponent(i);return e||(console.warn("Component of the specified class not found in prefab."),null)}),e);return r.init(n),r},i.putEffects=function(t,e){var i;null==(i=this.effectPoolMap.get(e))||i.putAll(t)},i.spawnResourceEffectAt=function(t,e,i,n,r){var o=this;void 0===i&&(i=null),void 0===n&&(n=null),void 0===r&&(r=function(){});var a=function(){var a,s=null==(a=o.effectPoolMap)||null==(a=a.get(e))?void 0:a.get(),l=e;null!=i&&(s.node.parent=i),s.node.setWorldPosition(t),setTimeout((function(){s.init(l,(function(t){var e;null==(e=o.effectPoolMap)||null==(e=e.get(l))||e.put(t)}),n),null==r||r(s)}))};0==this.effectPoolMap.has(e)?Qe.loadEffectRes(e).then((function(t){o.effectPoolMap.set(e,o.createPool(t,o.uiEffectContainer,mE)),a()})).catch((function(t){ve.LOG&&console.error(t,e),null==r||r(null,"could not find the effect prefab")})):a()},e}(o)).instance=null,pE=Mt((hE=dE).prototype,"uiEffectContainer",[cE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),uE=hE))||uE);t._RF.pop(),t._RF.push({},"b11edLPNrlIvrzI4yYh6uVF","EffectTime",void 0);var ME,IE,NE,LE,OE,RE,xE,FE=e.ccclass,DE=e.property,zE=(vE=FE("EffectTime"),yE=DE(ft),bE=DE([ct]),vE((wE=Mt((SE=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return e=t.call.apply(t,[this].concat(n))||this,Nt(e,"delayKillTime",wE,Lt(e)),Nt(e,"particleSystems",TE,Lt(e)),Nt(e,"particleSystem2ds",EE,Lt(e)),e}return It(e,t),e.prototype.init=function(e,i,n){var r,o,a=this;t.prototype.init.call(this,e,i,n),null==(r=this.particleSystems)||r.forEach((function(t){null==t||t.play()})),null==(o=this.particleSystem2ds)||o.forEach((function(t){t.resetSystem()})),this.scheduleOnce((function(){a.putToPool()}),this.delayKillTime)},e}(mE)).prototype,"delayKillTime",[DE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),TE=Mt(SE.prototype,"particleSystems",[yE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),EE=Mt(SE.prototype,"particleSystem2ds",[bE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),_E=SE))||_E);t._RF.pop(),t._RF.push({},"8ca3fmen/FAube9ooAPgxCz","EffectAnimation",void 0);var kE,VE,BE,HE,UE,GE,WE,qE,ZE,YE=e.ccclass,jE=e.property;ME=YE("EffectAnimation"),IE=jE(lt),ME((OE=Mt((LE=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return e=t.call.apply(t,[this].concat(n))||this,Nt(e,"animMain",OE,Lt(e)),Nt(e,"animName",RE,Lt(e)),Nt(e,"delay",xE,Lt(e)),e}It(e,t);var i=e.prototype;return i.onLoad=function(){this.animMain.node.active=!1},i.init=function(e,i,n){var r=this;t.prototype.init.call(this,e,i,n),this.scheduleOnce((function(){r.animMain.play(r.animName)}),this.delay)},e}(zE)).prototype,"animMain",[IE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),RE=Mt(LE.prototype,"animName",[jE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),xE=Mt(LE.prototype,"delay",[jE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),NE=LE));t._RF.pop(),t._RF.push({},"4dd0e4qDG1PXZh+cEHXUaeh","EffectMovingObject",void 0);var KE,XE,JE,QE,$E,tA,eA=e.ccclass,iA=e.property,nA=(kE=eA("EffectMovingObject"),VE=iA(f),BE=iA(y),HE=iA(c),kE((WE=Mt((GE=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return e=t.call.apply(t,[this].concat(n))||this,Nt(e,"sprtMain",WE,Lt(e)),Nt(e,"lbMain",qE,Lt(e)),Nt(e,"nodeFollow",ZE,Lt(e)),e.data=null,e.movingValue={value:0},e.tweenValue=null,e.startPoint=null,e.endPoint=null,e.controlPoint1=null,e.controlPoint2=null,e.scaleTime=.05,e.holdTime=.15,e.movingTime=.23,e.finalScale=.5,e}It(e,t);var i=e.prototype;return i.onDisable=function(){var t;null==(t=this.tweenValue)||t.stop()},i.init=function(e,i,n){var o,a,s=this;t.prototype.init.call(this,e,i,n),this.data=n,this.movingValue.value=0;var l=function(t,e){void 0===e&&(e=1),s.lbMain&&(s.lbMain.string=null!=t?t:"",s.lbMain.node.scale=m(1.5*e,1.5*e),v(s.lbMain.node).to(.2,{scale:m(e,e)}).start())};this.sprtMain&&this.data.spriteFrame&&(this.sprtMain.spriteFrame=this.data.spriteFrame),this.startPoint=this.node.worldPosition.clone(),this.endPoint=this.data.destination.clone();var c=this.calculateControlPoints(this.startPoint,this.endPoint,r(100,250)*(gt()>=.5?1:-1));this.controlPoint1=c[0],this.controlPoint2=c[1],l(null!=(o=null==(a=this.data)?void 0:a.text)?o:""),this.data.text2&&this.scheduleOnce((function(){l(s.data.text2,1.5)}),this.scaleTime+this.holdTime/2),this.doEffectSpriteMain(),this.doEffectMoving()},i.getTotalTime=function(){return this.scaleTime+this.holdTime+this.movingTime},i.setActive=function(t){this.node.active=t,this.nodeFollow&&(this.nodeFollow.active=!1)},i.setParentForFollowNode=function(t){this.nodeFollow&&(this.nodeFollow.parent=t,this.nodeFollow.setSiblingIndex(99))},i.doEffectSpriteMain=function(){this.node.scale=g.ZERO,v(this.node).to(this.scaleTime,{scale:m(1.5,1.5,1.5)},{easing:_.backOut}).delay(this.holdTime).to(this.movingTime,{scale:m(this.finalScale,this.finalScale,this.finalScale)},{easing:_.quartIn}).start()},i.doEffectFade=function(){},i.doEffectMoving=function(){var t=this;this.tweenValue=v(this.movingValue).delay(this.scaleTime+this.holdTime).call((function(){t.nodeFollow&&(t.nodeFollow.active=!0)})).to(this.movingTime,{value:1},{easing:_.quartIn}).call((function(){t.movingValue.value=1,t.tweenValue=null,null==t.data.onEnd||t.data.onEnd(),t.putToPool()})).start()},i.update=function(t){this.updatePosition()},i.updatePosition=function(){this.tweenValue&&(this.node.worldPosition=this.cubicBezierPoint(this.startPoint,this.controlPoint1,this.controlPoint2,this.endPoint,this.movingValue.value),this.nodeFollow&&(this.nodeFollow.worldPosition=this.node.worldPosition))},i.cubicBezierPoint=function(t,e,i,n,r){var o=1-r,a=r*r,s=o*o,l=s*o,c=a*r,u=new g;return u.set(l*t.x+3*s*r*e.x+3*o*a*i.x+c*n.x,l*t.y+3*s*r*e.y+3*o*a*i.y+c*n.y,l*t.z+3*s*r*e.z+3*o*a*i.z+c*n.z),u},i.calculateControlPoints=function(t,e,i){var n=e.clone().subtract(t).normalize(),r=new g(-n.y,n.x);return[t.clone().add(r.clone().multiplyScalar(i)),e.clone().add(r.clone().multiplyScalar(i))]},e}(mE)).prototype,"sprtMain",[VE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),qE=Mt(GE.prototype,"lbMain",[BE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ZE=Mt(GE.prototype,"nodeFollow",[HE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),UE=GE))||UE);t._RF.pop(),t._RF.push({},"79538OeyiNCXKnP2hHWrfF9","EffectMultiMovingObject",void 0);var rA,oA,aA,sA,lA,cA=e.ccclass,uA=e.property;KE=cA("EffectMultiMovingObject"),XE=uA([nA]),KE(($E=Mt((QE=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return e=t.call.apply(t,[this].concat(n))||this,Nt(e,"childs",$E,Lt(e)),Nt(e,"soundEachEmitterReached",tA,Lt(e)),e.data=null,e.isInited=!1,e}return It(e,t),e.prototype.init=function(e,i,n){var r=this;t.prototype.init.call(this,e,i,n),this.data=n,n.randomDuration||(n.randomDuration=0),this.isInited||(this.isInited=!0,this.childs.length<=0&&(this.childs=this.node.getComponentsInChildren(nA),this.childs.forEach((function(t){return t.setParentForFollowNode(r.node)}))));for(var o=function(){var t=a<n.number,e=mt(.3,.65),i=mt(.1,.3),o=1-e-i;if(r.childs[a].setActive(t),t){var s=r.childs[a],l=mt(n.duration-n.randomDuration,n.duration+n.randomDuration);s.movingTime=e*l,s.scaleTime=i*l;var c=o*l;s.holdTime=0,n.spreadDistance<=0&&(s.movingTime+=c,s.movingTime+=s.scaleTime,s.scaleTime=0,c=0),s.finalScale=0,s.sprtMain&&(s.sprtMain.node.active=!0,r.data.isRandomRotation&&(s.sprtMain.node.angle=mt(0,360))),n.spriteFrame&&s.sprtMain&&(s.sprtMain.spriteFrame=n.spriteFrame),s.node.position=g.ZERO,v(s.node).to(c,{position:m(mt(-n.spreadDistance,n.spreadDistance),mt(-n.spreadDistance,n.spreadDistance))}).call((function(){s.init("",null,{onEnd:function(){s.sprtMain&&(s.sprtMain.node.active=!1),null==n.onEachObject||n.onEachObject(s),r.soundEachEmitterReached&&Yi.instance.playSound(r.soundEachEmitterReached)},destination:n.end,spriteFrame:n.spriteFrame,text:"",text2:""})})).start()}},a=0;a<this.childs.length;a++)o();this.scheduleOnce((function(){null==n.onEnd||n.onEnd()}),n.duration+n.randomDuration),this.scheduleOnce((function(){r.putToPool()}),1.5*(n.duration+n.randomDuration))},e}(mE)).prototype,"childs",[XE],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),tA=Mt(QE.prototype,"soundEachEmitterReached",[uA],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),JE=QE));t._RF.pop(),t._RF.push({},"52b3dLzk9pE2JwkxnQV/APT","EffectParticle",void 0);var hA,pA=e.ccclass,dA=e.property;rA=pA("EffectParticle"),oA=dA(ft),rA((lA=Mt((sA=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return e=t.call.apply(t,[this].concat(n))||this,Nt(e,"particleSystems",lA,Lt(e)),e}It(e,t);var i=e.prototype;return i.init=function(e,i,n){var r;t.prototype.init.call(this,e,i,n),null==(r=this.particleSystems)||r.forEach((function(t){null==t||t.play()}))},i.stopParticle=function(t){var e,i=this;void 0===t&&(t=4),null==(e=this.particleSystems)||e.forEach((function(t){null==t||t.stopEmitting()})),this.scheduleOnce((function(){i.putToPool()}),t)},e}(mE)).prototype,"particleSystems",[oA],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),aA=sA));t._RF.pop(),t._RF.push({},"c2301FhRClBM7qSV+ZoQLbZ","EffectPoints",void 0);var fA,gA,mA,vA,yA,bA,_A,SA=e.ccclass;e.property,SA("EffectMovingObject")(hA=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).data=null,e.movingValue={value:0},e.tweenValue=null,e.startPoint=null,e.endPoint=null,e.controlPoint1=null,e.controlPoint2=null,e}It(e,t);var i=e.prototype;return i.onDisable=function(){var t;null==(t=this.tweenValue)||t.stop()},i.init=function(e,i,n){var r=this;t.prototype.init.call(this,e,i,n),this.data=n,this.startPoint=this.node.worldPosition.clone(),this.endPoint=this.data.destination.clone();var o=this.calculateControlPoints(this.startPoint,this.endPoint,500);this.controlPoint1=o[0],this.controlPoint2=o[1],this.node.scale=g.ZERO;v(this.node).to(.25,{scale:m(1.5,1.5,1.5)},{easing:_.backOut}).delay(.5).to(.75,{scale:m(.5,.5,.5)},{easing:_.quartIn}).start(),this.tweenValue=v(this.movingValue).delay(.75).to(.75,{value:1},{easing:_.quartIn}).call((function(){r.movingValue.value=1,r.tweenValue=null,null==r.data.onEnd||r.data.onEnd(),r.putToPool()})).start()},i.update=function(t){this.updatePosition()},i.updatePosition=function(){this.tweenValue&&(this.node.worldPosition=this.cubicBezierPoint(this.startPoint,this.controlPoint1,this.controlPoint2,this.endPoint,this.movingValue.value))},i.cubicBezierPoint=function(t,e,i,n,r){var o=1-r,a=r*r,s=o*o,l=s*o,c=a*r,u=new g;return u.set(l*t.x+3*s*r*e.x+3*o*a*i.x+c*n.x,l*t.y+3*s*r*e.y+3*o*a*i.y+c*n.y,l*t.z+3*s*r*e.z+3*o*a*i.z+c*n.z),u},i.calculateControlPoints=function(t,e,i){var n=e.clone().subtract(t).normalize(),r=new g(-n.y,n.x);return[t.clone().add(r.clone().multiplyScalar(i)),e.clone().add(r.clone().multiplyScalar(i))]},e}(mE));t._RF.pop(),t._RF.push({},"4bb4ddfy3ZF7IT9EWgZoUId","EffectText",void 0);var wA,TA,EA,AA,CA,PA,MA,IA=e.ccclass,NA=e.property;fA=IA("EffectText"),gA=NA(y),mA=NA(b),fA((bA=Mt((yA=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return e=t.call.apply(t,[this].concat(n))||this,Nt(e,"lbMain",bA,Lt(e)),Nt(e,"opMain",_A,Lt(e)),e}return It(e,t),e.prototype.init=function(e,i,n){t.prototype.init.call(this,e,i,n);var r=n.text,o=n.color,a=n.time,s=n.size,l=n.distance;this.lbMain.string=null!=r?r:"NULL",this.lbMain.color=null!=o?o:X.WHITE,this.lbMain.fontSize=null!=s?s:60,this.node.scale=m(1.2,1.2),this.opMain.opacity=255;var c=null!=a?a:.5,u=null!=l?l:100;v(this.node).to(c,{scale:g.ONE},{easing:_.quadIn}).start(),v(this.node).by(c,{worldPosition:m(0,u,0)},{easing:_.quadIn}).start(),v(this.opMain).to(c,{opacity:0},{easing:_.quartIn}).start()},e}(zE)).prototype,"lbMain",[gA],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_A=Mt(yA.prototype,"opMain",[mA],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),vA=yA));t._RF.pop(),t._RF.push({},"6e75aYdfoVM5bOfW6DB+f+a","FacialEmotionController",void 0);var LA,OA,RA,xA,FA,DA,zA,kA,VA=e.ccclass,BA=e.property,HA=function(t){return t.NEUTRAL="neutral",t.HAPPY="happy",t.SAD="sad",t.ANGRY="angry",t.SURPRISED="surprised",t.FEAR="fear",t.DISGUST="disgust",t}({}),UA=(wA=VA("FacialEmotionController"),TA=BA({type:vt}),EA=BA({tooltip:"Define emotions with blend shape weights"}),wA((PA=Mt((CA=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return e=t.call.apply(t,[this].concat(n))||this,Nt(e,"faceRenderer",PA,Lt(e)),Nt(e,"emotions",MA,Lt(e)),e.currentEmotion=HA.NEUTRAL,e.isTransitioning=!1,e.transitionTime=0,e.transitionDuration=.5,e.fromWeights=new Map,e.toWeights=new Map,e.blendShapeNames=[],e.faceMaterial=null,e}It(e,t);var i=e.prototype;return i.start=function(){this.faceRenderer?(this.faceRenderer.material&&(this.faceMaterial=this.faceRenderer.material),this.blendShapeNames=this.getBlendShapeNames(),this.setEmotion(HA.NEUTRAL)):console.error("Face renderer not assigned!")},i.getBlendShapeNames=function(){return["eyeBrowUp","eyeBrowDown","eyeClose","mouthOpen","mouthSmile","mouthFrown"]},i.update=function(t){if(this.isTransitioning&&this.faceMaterial){this.transitionTime+=t;for(var e,i=Math.min(this.transitionTime/this.transitionDuration,1),n=Ft(this.blendShapeNames);!(e=n()).done;){var r=e.value,o=this.fromWeights.get(r)||0,a=this.toWeights.get(r)||0,s=this.lerp(o,a,this.easeInOutQuad(i));this.applyBlendShapeWeight(r,s)}this.transitionTime>=this.transitionDuration&&(this.isTransitioning=!1)}},i.applyBlendShapeWeight=function(t,e){if(this.faceMaterial){var i="blendShape_"+t;this.faceMaterial.setProperty(i,e)}},i.setEmotion=function(t,e){if(void 0===e&&(e=.5),this.faceMaterial){var i=this.emotions.find((function(e){return e.name===t}));if(i){if(e>0){this.fromWeights.clear();for(var n,r=Ft(this.blendShapeNames);!(n=r()).done;){var o=n.value,a=this.getCurrentBlendShapeWeight(o);this.fromWeights.set(o,a)}this.toWeights.clear();for(var s,l=Ft(i.blendShapes);!(s=l()).done;){var c=s.value;this.toWeights.set(c.name,c.weight)}this.isTransitioning=!0,this.transitionTime=0,this.transitionDuration=e}else{for(var u,h=Ft(this.blendShapeNames);!(u=h()).done;){var p=u.value;this.applyBlendShapeWeight(p,0)}for(var d,f=Ft(i.blendShapes);!(d=f()).done;){var g=d.value;this.applyBlendShapeWeight(g.name,g.weight)}}this.currentEmotion=t}else console.warn('Emotion "'+t+'" not found')}},i.getCurrentBlendShapeWeight=function(t){if(!this.faceMaterial)return 0;var e="blendShape_"+t;try{var i=this.faceMaterial.getProperty(e);return"number"==typeof i?i:0}catch(t){return 0}},i.getCurrentEmotion=function(){return this.currentEmotion},i.lerp=function(t,e,i){return t+(e-t)*i},i.easeInOutQuad=function(t){return t<.5?2*t*t:1-Math.pow(-2*t+2,2)/2},e}(o)).prototype,"faceRenderer",[TA],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),MA=Mt(CA.prototype,"emotions",[EA],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),AA=CA))||AA);t._RF.pop(),t._RF.push({},"72db6UNpkhFOa4J9jHDXQ/n","FacialEmotionDemo",void 0);var GA,WA,qA,ZA,YA,jA,KA,XA,JA,QA,$A,tC,eC,iC,nC=e.ccclass,rC=e.property;LA=nC("FacialEmotionDemo"),OA=rC(UA),RA=rC(c),LA((DA=Mt((FA=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return e=t.call.apply(t,[this].concat(n))||this,Nt(e,"faceController",DA,Lt(e)),Nt(e,"emotionButtonsContainer",zA,Lt(e)),Nt(e,"transitionDuration",kA,Lt(e)),e.emotionButtons=new Map,e}It(e,t);var i=e.prototype;return i.start=function(){this.faceController?(this.emotionButtonsContainer&&this.setupEmotionButtons(),this.setEmotion(HA.NEUTRAL)):console.error("Face controller not assigned!")},i.setupEmotionButtons=function(){var t=this;if(this.emotionButtonsContainer)for(var e,i=this.emotionButtonsContainer.getComponentsInChildren(x),n=function(){var i=e.value,n=i.node.name.toLowerCase(),r=[HA.NEUTRAL,HA.HAPPY,HA.SAD,HA.ANGRY,HA.SURPRISED,HA.FEAR,HA.DISGUST].find((function(t){return n.includes(t.toLowerCase())}));if(r){t.emotionButtons.set(r,i);var o=new F;o.target=t.node,o.component="FacialEmotionDemo",o.handler="onEmotionButtonClicked",o.customEventData=r,i.clickEvents.push(o)}},r=Ft(i);!(e=r()).done;)n()},i.onEmotionButtonClicked=function(t,e){this.setEmotion(e)},i.setEmotion=function(t){this.faceController&&(console.log("Setting emotion: "+t),this.faceController.setEmotion(t,this.transitionDuration),this.updateButtonStates(t))},i.updateButtonStates=function(t){this.emotionButtons.forEach((function(e,i){e.interactable=i!==t;var n=i===t?1.2:1;e.node.setScale(new g(n,n,n))}))},i.triggerEmotionBasedOnEvent=function(t){switch(t){case"victory":this.setEmotion(HA.HAPPY);break;case"defeat":this.setEmotion(HA.SAD);break;case"damage":this.setEmotion(HA.ANGRY);break;case"surprise":this.setEmotion(HA.SURPRISED);break;case"scary":this.setEmotion(HA.FEAR);break;case"disgust":this.setEmotion(HA.DISGUST);break;default:this.setEmotion(HA.NEUTRAL)}},i.playEmotionSequence=function(){var t=this,e=[{emotion:HA.SURPRISED,duration:1},{emotion:HA.HAPPY,duration:2},{emotion:HA.NEUTRAL,duration:1}],i=0;e.forEach((function(e){t.scheduleOnce((function(){t.setEmotion(e.emotion)}),i),i+=e.duration}))},e}(o)).prototype,"faceController",[OA],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),zA=Mt(FA.prototype,"emotionButtonsContainer",[RA],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),kA=Mt(FA.prototype,"transitionDuration",[rC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),xA=FA));t._RF.pop(),t._RF.push({},"58916U7dudCXZ4FreIgnM5F","GameEnviromentSetter",void 0);var oC,aC,sC,lC,cC,uC=e.ccclass,hC=e.property;GA=uC("GameEnviromentSetter"),WA=hC(c),qA=hC(f),ZA=hC(sr),YA=hC(y),GA((XA=Mt((KA=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return e=t.call.apply(t,[this].concat(n))||this,Nt(e,"API",XA,Lt(e)),Nt(e,"LOG",JA,Lt(e)),Nt(e,"FAKEDATA",QA,Lt(e)),Nt(e,"sckContainer",$A,Lt(e)),Nt(e,"sprtProcessBar",tC,Lt(e)),Nt(e,"popupError",eC,Lt(e)),Nt(e,"lbError",iC,Lt(e)),e.sceneName=Am,e.retryCount=0,e}It(e,t);var i=e.prototype;return i.onLoad=function(){var t;t={API:this.API,LOG:this.LOG},ve=t,this.init(),this.initGameProcess()},i.init=function(){var t;t=ve.API,xm.setBaseURL(t)},i.initGameProcess=function(){var t=this;Promise.all([this.step_ProcessData(),this.step_ProcessPreloadSceneAssets()]).then((function(e){t.loadGame()})).catch((function(e){t.showError(e)}))},i.retry=function(){++this.retryCount>3?this.lbError.string="Please try again later!":(this.popupError.doHide(),this.initGameProcess())},i.showError=function(t){this.lbError.string=t,this.popupError.doShow()},i.step_ProcessData=function(){var t=this;return new Promise((function(e,i){t.step_initManagers().then((function(t){e("success")})).catch((function(t){i(t)}))}))},i.step_initManagers=function(){return new Promise((function(t,e){Yi.instance=new Yi,or.instance=new or,PE.instance=new PE,t("success")}))},i.step_ProcessPreloadSceneAssets=function(){var t=this;return new Promise((function(e,i){M.preloadScene(t.sceneName,(function(e,i,n){t.sprtProcessBar&&(t.sprtProcessBar.fillRange=e/i*.95)}),(function(n,r){if(n)return ve.LOG&&console.error("Failed to preload scene "+t.sceneName+":",n),void i("Failed to load assets. Please retry. If retrying doesn't help, please clear the cache and try again.");e("loaded assets done")}))}))},i.loadGame=function(){var t=this;this.sprtProcessBar.fillRange=1,ve.LOG&&console.log("doneLoadAssets"),M.loadScene(this.sceneName,(function(){ve.LOG&&console.log("Scene "+t.sceneName+" loaded successfully")}))},i.onTouch_Retry=function(){this.retry()},e}(o)).prototype,"API",[hC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),JA=Mt(KA.prototype,"LOG",[hC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),QA=Mt(KA.prototype,"FAKEDATA",[hC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),$A=Mt(KA.prototype,"sckContainer",[WA],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),tC=Mt(KA.prototype,"sprtProcessBar",[qA],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),eC=Mt(KA.prototype,"popupError",[ZA],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),iC=Mt(KA.prototype,"lbError",[YA],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),jA=KA));t._RF.pop(),t._RF.push({},"af638cDGFlB4L/26jmCHP0n","PitchBase",void 0);var pC,dC,fC,gC,mC,vC,yC,bC,_C,SC,wC,TC,EC,AC,CC,PC,MC,IC=e.ccclass,NC=e.property,LC=(oC=IC("PitchBase"),aC=NC({range:[0,1],slide:!0,tooltip:"Minimum volume level to detect pitch",group:{name:"Detection Settings",id:"detection"}}),oC((cC=Mt((lC=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).eventTarget=new yt,e.audioContext=null,e.analyzer=null,e.microphone=null,e.microphoneStream=null,e.analyzerBuffer=null,e.bufferSize=2048,e.isDetecting=!1,e.detectionInterval=null,e.detectionIntervalMs=50,e.smoothingFactor=.6,e.lastFrequency=0,Nt(e,"volumeThreshold",cC,Lt(e)),e}It(e,t);var i=e.prototype;return i.on=function(t,e,i){var n;null==(n=this.eventTarget)||n.on(t,e,i)},i.off=function(t,e,i){var n;null==(n=this.eventTarget)||n.off(t,e,i)},i.emit=function(t,e,i,n,r,o){var a;null==(a=this.eventTarget)||a.emit(t,e,i,n,r,o)},i.onDestroy=function(){this.stopDetection(),this.microphoneStream&&(this.microphoneStream.getTracks().forEach((function(t){return t.stop()})),this.microphoneStream=null),this.audioContext&&(this.audioContext.close(),this.audioContext=null)},i.initialize=function(){var t=Ot(Rt().mark((function t(){var e;return Rt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(t.prev=0,window.AudioContext||window.webkitAudioContext){t.next=4;break}return console.error("AudioContext is not supported in this browser"),t.abrupt("return",!1);case 4:return e=window.AudioContext||window.webkitAudioContext,this.audioContext=new e,this.analyzer=this.audioContext.createAnalyser(),this.analyzer.fftSize=this.bufferSize,this.analyzer.smoothingTimeConstant=.8,this.analyzerBuffer=new Float32Array(this.analyzer.frequencyBinCount),console.log("Pitch detection system initialized"),t.abrupt("return",!0);case 14:return t.prev=14,t.t0=t.catch(0),console.error("Failed to initialize pitch detection system:",t.t0),t.abrupt("return",!1);case 18:case"end":return t.stop()}}),t,this,[[0,14]])})));return function(){return t.apply(this,arguments)}}(),i.requestMicrophoneAccess=function(){var t=this;return new Promise(Ot(Rt().mark((function e(i,n){var r,o,a;return Rt().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(e.prev=0,navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?r=navigator.mediaDevices.getUserMedia.bind(navigator.mediaDevices):(o=navigator.getUserMedia||navigator.webkitGetUserMedia||navigator.mozGetUserMedia||navigator.msGetUserMedia)&&(r=function(t){return new Promise((function(e,i){o(t,e,i)}))}),r){e.next=6;break}return console.error("getUserMedia is not supported in this browser"),i(!1),e.abrupt("return");case 6:return a={audio:{echoCancellation:!0,noiseSuppression:!0,autoGainControl:!1}},e.next=9,r(a);case 9:if(t.microphoneStream=e.sent,!t.audioContext||"suspended"!==t.audioContext.state){e.next=13;break}return e.next=13,t.audioContext.resume();case 13:t.microphone=t.audioContext.createMediaStreamSource(t.microphoneStream),t.microphone.connect(t.analyzer),console.log("Microphone access granted"),i(!0),e.next=23;break;case 19:e.prev=19,e.t0=e.catch(0),console.error("Failed to access microphone:",e.t0),i(!1);case 23:case"end":return e.stop()}}),e,null,[[0,19]])}))))},i.startDetection=function(){var t=this;this.isDetecting||(this.audioContext&&"suspended"===this.audioContext.state&&this.audioContext.resume(),this.isDetecting=!0,this.detectionInterval=setInterval((function(){t.detectPitch()}),this.detectionIntervalMs),console.log("Pitch detection started"))},i.stopDetection=function(){this.isDetecting&&(this.isDetecting=!1,null!==this.detectionInterval&&(clearInterval(this.detectionInterval),this.detectionInterval=null),console.log("Pitch detection stopped"))},i.detectPitch=function(){},i.detectPitchAutocorrelation=function(){for(var t=this.analyzerBuffer,e=t.length,i=0,n=0;n<e;n++)i+=t[n]*t[n];if((i=Math.sqrt(i/e))<this.volumeThreshold)return console.log("Autocorrelation RMS below threshold"),0;for(var r=new Float32Array(e),o=0;o<e;o++){r[o]=0;for(var a=0;a<e-o;a++)r[o]+=t[a]*t[a+o]}for(var s=-1,l=1;l<e/2;l++)if(r[l]<r[l-1]&&r[l]<r[l+1]){s=l;break}s<=1&&(s=1);for(var c=s,u=s+1;u<e/2;u++)r[u]>r[c]&&(c=u);if(r[c]<=0||0===c)return 0;var h=c;if(c>0&&c<e-1){var p=r[c],d=r[c-1],f=r[c+1],g=.5*(d-f)/(d-2*p+f);isFinite(g)&&(h+=g)}var m=0;return h>0?m=this.audioContext.sampleRate/h:console.log("Autocorrelation: Refined peak is zero or negative."),m},i.getVolumeLevel=function(){if(!this.analyzer)return 0;this.analyzer.getFloatTimeDomainData(this.analyzerBuffer);for(var t=0,e=0;e<this.analyzerBuffer.length;e++)t+=this.analyzerBuffer[e]*this.analyzerBuffer[e];return Math.sqrt(t/this.analyzerBuffer.length)},i.getAnalyzerData=function(){if(!this.analyzer||!this.analyzerBuffer)return null;this.analyzer.getFloatFrequencyData(this.analyzerBuffer);for(var t=new Float32Array(this.analyzerBuffer.length),e=0;e<this.analyzerBuffer.length;e++)t[e]=(this.analyzerBuffer[e]+100)/100;return t},i.setVolumeThreshold=function(t){this.volumeThreshold=Math.max(0,Math.min(1,t))},i.getVolumeThreshold=function(){return this.volumeThreshold},e}(o)).prototype,"volumeThreshold",[aC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.005}}),sC=lC))||sC);t._RF.pop(),t._RF.push({},"ad490byc41ARIRcM3dgPh7C","PitchWaveform",void 0);var OC,RC=e.ccclass,xC=e.property,FC=(pC=RC("PitchWaveform"),dC=xC({type:[c],group:{name:"Visualization",id:"visualization"}}),fC=xC({type:Number,group:{name:"Visualization",id:"visualization"}}),gC=xC({type:Number,group:{name:"Visualization",id:"visualization"}}),mC=xC({type:Number,group:{name:"Visualization",id:"visualization"}}),vC=xC({type:Number,group:{name:"Visualization",id:"visualization"}}),yC=xC({type:l,group:{name:"Visualization",id:"visualization"}}),bC=xC({type:c,group:{name:"Visualization",id:"visualization"}}),pC((wC=Mt((SC=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return e=t.call.apply(t,[this].concat(n))||this,Nt(e,"waveformLines",wC,Lt(e)),Nt(e,"numVisualizerLines",TC,Lt(e)),Nt(e,"visualizerRadius",EC,Lt(e)),Nt(e,"visualizerMinScale",AC,Lt(e)),Nt(e,"visualizerMaxScale",CC,Lt(e)),Nt(e,"waveformLinePrefab",PC,Lt(e)),Nt(e,"microphoneNode",MC,Lt(e)),e.lineTweens=[],e.previousScales=[],e.SCALE_CHANGE_THRESHOLD=.01,e.TWEEN_DURATION=.1,e}It(e,t);var i=e.prototype;return i.initialize=function(t){if(void 0===t&&(t=null),t&&(this.microphoneNode=t),this.microphoneNode&&this.waveformLinePrefab){this.clearWaveformVisualization();for(var e=0;e<this.numVisualizerLines;e++){var i=A(this.waveformLinePrefab);if(i){var n=e/this.numVisualizerLines*Math.PI*2,r=Math.cos(n)*this.visualizerRadius,o=Math.sin(n)*this.visualizerRadius;i.setPosition(new g(r,o,0)),i.setRotationFromEuler(0,0,n*(180/Math.PI)),i.setScale(new g(0,1,1)),this.microphoneNode.addChild(i),i.setSiblingIndex(0),this.waveformLines.push(i),this.previousScales[e]=this.visualizerMinScale,this.lineTweens[e]=null}}}},i.clearWaveformVisualization=function(){this.lineTweens.forEach((function(t){t&&t.stop()})),this.lineTweens=[],this.previousScales=[],this.waveformLines.forEach((function(t){t&&t.destroy()})),this.waveformLines=[]},i.updateWaveformVisualization=function(t,e,i){if(this.microphoneNode&&0!==this.waveformLines.length){var n=i.getAnalyzerData();if(n)for(var r=Math.floor(n.length/this.numVisualizerLines),o=0;o<this.waveformLines.length;o++){var a=this.waveformLines[o];if(a){for(var s=Math.min(o*r,n.length-1),l=0,c=0;c<3;c++){l+=n[Math.min(s+c,n.length-1)]}l/=3;var u=this.visualizerMinScale+l*(this.visualizerMaxScale-this.visualizerMinScale)*Math.max(.3,Math.min(1,2*t));Math.abs(u-this.previousScales[o])>this.SCALE_CHANGE_THRESHOLD&&(this.lineTweens[o]&&this.lineTweens[o].stop(),this.lineTweens[o]=v(a).to(this.TWEEN_DURATION,{scale:new g(u,1,1)},{easing:"quadOut"}).start(),this.previousScales[o]=u)}}}},e}(o)).prototype,"waveformLines",[dC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),TC=Mt(SC.prototype,"numVisualizerLines",[fC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 64}}),EC=Mt(SC.prototype,"visualizerRadius",[gC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 100}}),AC=Mt(SC.prototype,"visualizerMinScale",[mC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.3}}),CC=Mt(SC.prototype,"visualizerMaxScale",[vC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1.5}}),PC=Mt(SC.prototype,"waveformLinePrefab",[yC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),MC=Mt(SC.prototype,"microphoneNode",[bC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_C=SC))||_C);t._RF.pop(),t._RF.push({},"7be4edEMP9G4o2PKnJZVUkm","HomeController",void 0);var DC,zC=e.ccclass;e.property,zC("HomeController")(OC=function(t){function e(){return t.apply(this,arguments)||this}It(e,t);var i=e.prototype;return i.start=function(){},i.update=function(t){},i.onPitchGameClicked=function(){M.loadScene(Mm)},i.onKaraokeGameClicked=function(){M.loadScene(Im)},i.onMagicTilesGameClicked=function(){M.loadScene(Pm)},i.onAuditionGameClicked=function(){M.loadScene(Cm)},e}(o));t._RF.pop(),t._RF.push({},"4776ep8HUxF9pASRzyMkIdg","InventoryController",void 0);var kC=e.ccclass;e.property,kC("InventoryController")(DC=function(t){function e(){return t.apply(this,arguments)||this}It(e,t);var i=e.prototype;return i.start=function(){},i.update=function(t){},e}(o));t._RF.pop(),t._RF.push({},"0c271suebVCeo75bOBDa20C","KaraokeConstants",void 0);var VC,BC,HC,UC,GC,WC,qC,ZC,YC,jC,KC,XC=function(t){return t[t.INIT=0]="INIT",t[t.LOADING=1]="LOADING",t[t.READY=2]="READY",t[t.PLAYING=3]="PLAYING",t[t.PAUSED=4]="PAUSED",t[t.FINISHED=5]="FINISHED",t}({}),JC=function(t){return t[t.MISS=0]="MISS",t[t.GOOD=1]="GOOD",t[t.PERFECT=2]="PERFECT",t}({}),QC=function(){};QC.ANIMATION_IDLE="idle",QC.ANIMATION_SINGING="singing",QC.ANIMATION_TRANSITION_TIME=.3,QC.PITCH_DETECTION_INTERVAL_MS=50,QC.ACCURACY_THRESHOLDS={PERFECT:5,GOOD:15},QC.MAX_SCORE=100,QC.EVENTS={PITCH_DETECTED:"karaoke_pitch_detected",LYRICS_UPDATED:"karaoke_lyrics_updated",SCORE_UPDATED:"karaoke_score_updated",SONG_LOADED:"karaoke_song_loaded",SONG_ENDED:"karaoke_song_ended",SONG_STARTED:"karaoke_song_started",STATE_CHANGED:"karaoke_state_changed"},QC.SUPPORTED_AUDIO_FORMATS=["mp3","wav","ogg"],t._RF.pop(),t._RF.push({},"3935b3+6EJPYKeh0BN4/l9C","KaraokeAudioManager",void 0);var $C,tP,eP,iP,nP,rP,oP,aP,sP,lP,cP,uP=e.ccclass,hP=e.property,pP=(VC=uP("KaraokeAudioManager"),BC=hP({type:N,tooltip:"Audio source for music playback",group:{name:"Audio",id:"audio"}}),HC=hP({tooltip:"Volume for music playback (0-1)",range:[0,1],slide:!0,group:{name:"Audio",id:"audio"}}),UC=hP({tooltip:"Fade in duration in seconds",group:{name:"Audio",id:"audio"}}),GC=hP({tooltip:"Fade out duration in seconds",group:{name:"Audio",id:"audio"}}),VC((ZC=Mt((qC=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).eventTarget=new yt,Nt(e,"musicSource",ZC,Lt(e)),Nt(e,"musicVolume",YC,Lt(e)),Nt(e,"fadeInDuration",jC,Lt(e)),Nt(e,"fadeOutDuration",KC,Lt(e)),e.currentAudioClip=null,e.isPlaying=!1,e.isPaused=!1,e.currentTime=0,e.duration=0,e.fadeInterval=null,e}It(e,t);var i=e.prototype;return i.onLoad=function(){this.musicSource||(this.musicSource=this.addComponent(N)),this.musicSource.volume=this.musicVolume},i.update=function(t){this.isPlaying&&!this.isPaused&&(this.currentTime=this.musicSource.currentTime,this.isPlaying&&!this.isPaused&&(this.duration>0&&this.currentTime>this.duration-.5||0==this.musicSource.playing)&&this.handlePlaybackEnd())},i.onDestroy=function(){this.stopPlayback(),this.clearFadeInterval()},i.loadAudio=function(t){var e=this;return new Promise((function(i){e.stopPlayback(),Qe.loadRes(t,L,(function(n,r){if(n)return console.error("Failed to load audio: "+t,n),void i(!1);e.currentAudioClip=r,e.musicSource.clip=r,void 0!==e.musicSource.duration?e.duration=e.musicSource.duration:(console.warn("Could not determine duration for "+t+", using estimate"),e.duration=180),console.log("Loaded audio: "+t+", duration: "+e.duration+"s"),e.emit(QC.EVENTS.SONG_LOADED,{path:t,duration:e.duration}),i(!0)}))}))},i.startPlayback=function(t){void 0===t&&(t=!1),this.isPlaying&&!this.isPaused||(this.currentAudioClip?(this.isPaused?(this.musicSource.play(),this.isPaused=!1):(this.currentTime=0,this.musicSource.currentTime=0,t?(this.musicSource.volume=0,this.fadeIn()):this.musicSource.volume=this.musicVolume,this.musicSource.play()),this.isPlaying=!0,console.log("Audio playback started"),this.emit(QC.EVENTS.SONG_STARTED)):console.warn("No audio loaded"))},i.stopPlayback=function(t){var e=this;void 0===t&&(t=!0),this.isPlaying&&(t?this.fadeOut((function(){e.musicSource.stop(),e.finishStopPlayback()})):(this.musicSource.stop(),this.finishStopPlayback()))},i.pausePlayback=function(){this.isPlaying&&!this.isPaused&&(this.musicSource.pause(),this.isPaused=!0,console.log("Audio playback paused"))},i.resumePlayback=function(){this.isPaused&&(this.musicSource.play(),this.isPaused=!1,console.log("Audio playback resumed"))},i.seekTo=function(t){this.currentAudioClip&&(t=Math.max(0,Math.min(t,this.duration)),this.currentTime=t,this.musicSource.currentTime=t,console.log("Seeked to "+t+"s"))},i.getCurrentTime=function(){return this.musicSource.currentTime},i.getDuration=function(){return this.duration},i.setVolume=function(t){this.musicVolume=Math.max(0,Math.min(1,t)),this.musicSource.volume=this.musicVolume},i.getVolume=function(){return this.musicVolume},i.isAudioPlaying=function(){return this.isPlaying&&!this.isPaused},i.isAudioPaused=function(){return this.isPaused},i.clearFadeInterval=function(){this.fadeInterval&&(clearInterval(this.fadeInterval),this.fadeInterval=null)},i.handlePlaybackEnd=function(){this.isPlaying&&(console.log("Audio playback ended"),this.isPlaying=!1,this.isPaused=!1,this.emit(QC.EVENTS.SONG_ENDED))},i.finishStopPlayback=function(){this.clearFadeInterval(),this.isPlaying=!1,this.isPaused=!1,this.currentTime=0,console.log("Audio playback stopped")},i.fadeIn=function(){var t=this;this.fadeInterval&&clearInterval(this.fadeInterval);var e=0,i=this.musicVolume/(10*this.fadeInDuration);console.log("Fade in starting with step: "+i+", target volume: "+this.musicVolume+", duration: "+this.fadeInDuration),this.fadeInterval=setInterval((function(){e+=i,console.log("Fade in: current volume="+e.toFixed(2)),e>=t.musicVolume&&(e=t.musicVolume,clearInterval(t.fadeInterval),t.fadeInterval=null,console.log("Fade in completed")),t.musicSource.volume=e}),100)},i.fadeOut=function(t){var e=this;this.fadeInterval&&clearInterval(this.fadeInterval);var i=this.musicSource.volume,n=i/(10*this.fadeOutDuration);this.fadeInterval=setInterval((function(){(i-=n)<=0&&(i=0,clearInterval(e.fadeInterval),e.fadeInterval=null,t&&t()),e.musicSource.volume=i}),100)},i.on=function(t,e,i){var n;null==(n=this.eventTarget)||n.on(t,e,i)},i.off=function(t,e,i){var n;null==(n=this.eventTarget)||n.off(t,e,i)},i.emit=function(t,e,i,n,r,o){var a;null==(a=this.eventTarget)||a.emit(t,e,i,n,r,o)},e}(o)).prototype,"musicSource",[BC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),YC=Mt(qC.prototype,"musicVolume",[HC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.7}}),jC=Mt(qC.prototype,"fadeInDuration",[UC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),KC=Mt(qC.prototype,"fadeOutDuration",[GC],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),WC=qC))||WC);t._RF.pop(),t._RF.push({},"25fe0RiSF5NqKgyxyLlEbpj","KaraokeCharacterAnimator",void 0);var dP,fP=e.ccclass,gP=e.property,mP=($C=fP("KaraokeCharacterAnimator"),tP=gP({type:hb,tooltip:"Character model node",group:{name:"Character",id:"character"}}),eP=gP({tooltip:"Transition time between animations in seconds",group:{name:"Animation",id:"animation"}}),iP=gP({tooltip:"Name of the idle animation",group:{name:"Animation",id:"animation"}}),nP=gP({tooltip:"Name of the singing animation",group:{name:"Animation",id:"animation"}}),$C((aP=Mt((oP=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return e=t.call.apply(t,[this].concat(n))||this,Nt(e,"character",aP,Lt(e)),Nt(e,"transitionDuration",sP,Lt(e)),Nt(e,"idleAnimationName",lP,Lt(e)),Nt(e,"singingAnimationName",cP,Lt(e)),e.currentAnimation="",e.isTransitioning=!1,e}It(e,t);var i=e.prototype;return i.onLoad=function(){this.initialize()},i.start=function(){this.playAnimation(this.idleAnimationName)},i.onDestroy=function(){},i.initialize=function(){var t=this;this.character?this.character.init(null,xr.instance.characterId).then((function(){return pb.getInstance().loadMultipleAnimations([t.idleAnimationName,t.singingAnimationName])})).then((function(e){return pb.getInstance().applyAnimationsToCharacter(t.character,e)})).then((function(){console.log("Initialized animations for character")})).catch((function(t){console.error("Failed to initialize character animations: "+t)})):console.error("Animation component not found")},i.playIdle=function(){this.playAnimation(this.idleAnimationName)},i.playSinging=function(){this.playAnimation(this.singingAnimationName)},i.playAnimation=function(t,e){var i,n=this;if(this.character&&(this.currentAnimation!==t||this.isTransitioning)){this.currentAnimation=t;var r=null!=(i=null==e?void 0:e.transitionTime)?i:this.transitionDuration;this.isTransitioning=!0,this.character.playAnimation(t,r),!1!==(null==e?void 0:e.loop)&&this.character.playAnimation(t,r),setTimeout((function(){n.isTransitioning=!1}),1e3*r)}},i.isAnimationPlaying=function(t){return this.currentAnimation===t&&!this.isTransitioning},e}(o)).prototype,"character",[tP],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),sP=Mt(oP.prototype,"transitionDuration",[eP],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return QC.ANIMATION_TRANSITION_TIME}}),lP=Mt(oP.prototype,"idleAnimationName",[iP],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return QC.ANIMATION_IDLE}}),cP=Mt(oP.prototype,"singingAnimationName",[nP],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return QC.ANIMATION_SINGING}}),rP=oP))||rP);t._RF.pop(),t._RF.push({},"b03016mcKVCqoyFHAN44X+M","KaraokePitchDetectionSystem",void 0);var vP,yP=e.ccclass,bP=(e.property,yP("KaraokePitchDetectionSystem")(dP=function(t){function e(){return t.apply(this,arguments)||this}It(e,t);var i=e.prototype;return i.onLoad=function(){this.detectionIntervalMs=QC.PITCH_DETECTION_INTERVAL_MS},i.detectPitch=function(){if(this.analyzer&&this.isDetecting){var t=this.getVolumeLevel();t<this.volumeThreshold?this.emitPitchDetected(0,!1,JC.MISS,t):this.emitPitchDetected(0,!0,1,t)}},i.calculateAccuracy=function(t){return t>0?JC.GOOD:JC.MISS},i.emitPitchDetected=function(t,e,i,n){var r={frequency:t,detected:e,accuracy:i,volume:n};this.emit(QC.EVENTS.PITCH_DETECTED,r)},i.getAnalyzerData=function(){if(!this.analyzer||!this.analyzerBuffer)return null;this.analyzer.getFloatFrequencyData(this.analyzerBuffer);for(var t=new Float32Array(this.analyzerBuffer.length),e=0;e<this.analyzerBuffer.length;e++)t[e]=(this.analyzerBuffer[e]+100)/100;return t},i.setVolumeThreshold=function(t){this.volumeThreshold=Math.max(0,Math.min(1,t))},i.getVolumeThreshold=function(){return this.volumeThreshold},e}(LC))||dP);t._RF.pop(),t._RF.push({},"138ba6c4ppO4b8IaeAlyk0V","KaraokeLyricsManager",void 0);var _P,SP=e.ccclass,wP=(e.property,SP("KaraokeLyricsManager")(vP=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).eventTarget=new yt,e.lyrics=[],e.currentLyricIndex=-1,e.lyricUpdateInterval=null,e.currentTime=0,e.isPlaying=!1,e}It(e,t);var i=e.prototype;return i.onLoad=function(){},i.onDestroy=function(){this.stopLyricUpdates()},i.loadLyrics=function(t){var e=this;return new Promise((function(i,n){if(!t||!t.lyricPath)return console.error("Song or lyricPath is missing"),void n(new Error("Song or lyricPath is missing"));var r=zm.getLyricPath(t);Qe.loadRes(r,bt,(function(o,a){if(o)return console.error("Failed to load lyrics from path: "+r,o),void n(o);try{var s=a.json,l=s.segments.map((function(t){return{text:t.text,startTime:t.start,endTime:t.end,completed:!1}}));e.lyrics=l||[],e.resetLyrics();var c=Dt({},t,{lyrics:l,duration:s.duration||t.duration});console.log("Loaded "+e.lyrics.length+" lyric segments"),i(c)}catch(t){console.error("Error parsing lyrics JSON:",t),n(t)}}))}))},i.setLyrics=function(t){this.lyrics=t||[],this.resetLyrics(),console.log("Set "+this.lyrics.length+" lyric segments")},i.startPlayback=function(){var t=this;this.isPlaying||(this.isPlaying=!0,this.currentTime=0,this.currentLyricIndex=-1,this.lyricUpdateInterval=setInterval((function(){t.updateLyrics()}),100),console.log("Lyrics playback started"))},i.stopPlayback=function(){this.isPlaying&&(this.isPlaying=!1,this.stopLyricUpdates(),this.resetLyrics(),console.log("Lyrics playback stopped"))},i.pausePlayback=function(){this.isPlaying&&(this.isPlaying=!1,this.stopLyricUpdates(),console.log("Lyrics playback paused"))},i.resumePlayback=function(){this.isPlaying||(this.isPlaying=!0,console.log("Lyrics playback resumed"))},i.updateTime=function(t){this.currentTime=t,this.lyricUpdateInterval||this.updateLyrics()},i.getCurrentLyric=function(){return this.currentLyricIndex<0||this.currentLyricIndex>=this.lyrics.length?null:this.lyrics[this.currentLyricIndex]},i.getNextLyric=function(){var t=this.currentLyricIndex+1;return t>=this.lyrics.length?null:this.lyrics[t]},i.isLyricActive=function(){var t=this.getCurrentLyric();return!!t&&(this.currentTime>=t.startTime&&this.currentTime<=t.endTime)},i.updateLyrics=function(){if(this.isPlaying&&0!==this.lyrics.length){var t=this.findLyricIndexAtTime(this.currentTime);if(t!==this.currentLyricIndex){var e=this.currentLyricIndex;this.currentLyricIndex=t,e>=0&&e<this.lyrics.length&&t>e&&(this.lyrics[e].completed=!0),this.emitLyricUpdated()}this.lyricUpdateInterval&&(this.currentTime+=.1)}},i.findLyricIndexAtTime=function(t){if(0===this.lyrics.length)return-1;if(t<this.lyrics[0].startTime)return-1;for(var e=0;e<this.lyrics.length;e++){var i=this.lyrics[e];if(t>=i.startTime&&t<=i.endTime)return e}if(t>this.lyrics[this.lyrics.length-1].endTime)return this.lyrics.length-1;for(var n=0;n<this.lyrics.length-1;n++)if(t>this.lyrics[n].endTime&&t<this.lyrics[n+1].startTime)return n;return-1},i.stopLyricUpdates=function(){this.lyricUpdateInterval&&(clearInterval(this.lyricUpdateInterval),this.lyricUpdateInterval=null)},i.resetLyrics=function(){this.currentLyricIndex=-1,this.currentTime=0,this.lyrics.forEach((function(t){t.completed=!1}))},i.emitLyricUpdated=function(){var t=this.getCurrentLyric(),e=this.getNextLyric();this.emit(QC.EVENTS.LYRICS_UPDATED,{currentLyric:t,nextLyric:e,currentLyricIndex:this.currentLyricIndex,totalLyrics:this.lyrics.length})},i.on=function(t,e,i){var n;null==(n=this.eventTarget)||n.on(t,e,i)},i.off=function(t,e,i){var n;null==(n=this.eventTarget)||n.off(t,e,i)},i.emit=function(t,e,i,n,r,o){var a;null==(a=this.eventTarget)||a.emit(t,e,i,n,r,o)},e}(o))||vP);t._RF.pop(),t._RF.push({},"6638fPOlQNMEYIE+ff0PAqW","KaraokeScoringSystem",void 0);var TP,EP,AP,CP,PP,MP,IP,NP,LP,OP,RP,xP,FP,DP,zP,kP,VP,BP,HP,UP,GP,WP,qP,ZP,YP,jP,KP,XP,JP,QP,$P,tM,eM,iM,nM,rM,oM,aM,sM,lM,cM,uM,hM,pM,dM,fM=e.ccclass,gM=(e.property,fM("KaraokeScoringSystem")(_P=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).eventTarget=new yt,e.validDuration=0,e.totalInteractionDuration=0,e.isRecording=!1,e.isPitchDetected=!1,e.isLyricActive=!1,e}It(e,t);var i=e.prototype;return i.onDestroy=function(){},i.startScoring=function(){this.isRecording||(this.isRecording=!0,this.resetScore(),console.log("Score recording started"))},i.stopScoring=function(){this.isRecording&&(this.isRecording=!1,this.emitScoreUpdated(),console.log("Score recording stopped"))},i.updateTime=function(t){},i.updatePitchDetection=function(t){this.isRecording&&(this.isPitchDetected=t.detected,this.isPitchDetected&&this.isLyricActive&&(this.validDuration+=QC.PITCH_DETECTION_INTERVAL_MS/1e3*1.3,console.log("valid duration: "+this.validDuration)))},i.updateLyricStatus=function(t){this.isLyricActive=t},i.resetScore=function(){this.validDuration=0,this.emitScoreUpdated()},i.getScore=function(){return{validDuration:this.validDuration,totalInteractionDuration:this.totalInteractionDuration,score:this.calculateScore()}},i.getScorePercentage=function(){return this.calculateScore()},i.setTotalLyricsDuration=function(t){this.totalInteractionDuration=t},i.calculateScore=function(){return Math.round(100*Math.min(this.validDuration/this.totalInteractionDuration,1))-r(0,10)},i.emitScoreUpdated=function(){var t=this.getScore();this.emit(QC.EVENTS.SCORE_UPDATED,{score:t})},i.on=function(t,e,i){var n;null==(n=this.eventTarget)||n.on(t,e,i)},i.off=function(t,e,i){var n;null==(n=this.eventTarget)||n.off(t,e,i)},i.emit=function(t,e,i,n,r,o){var a;null==(a=this.eventTarget)||a.emit(t,e,i,n,r,o)},e}(o))||_P);t._RF.pop(),t._RF.push({},"60dfd1+5blL1J3Dxf5ZMKYQ","KaraokeUIManager",void 0);var mM,vM,yM,bM,_M,SM,wM,TM,EM,AM,CM,PM,MM,IM,NM,LM,OM,RM,xM,FM=e.ccclass,DM=e.property,zM=(TP=FM("KaraokeUIManager"),EP=DM({type:y,tooltip:"Label component to display the countdown time",group:{name:"Timer",id:"timer"}}),AP=DM({tooltip:"Format to display timer (s = seconds only, mm:ss = minutes and seconds)",group:{name:"Timer",id:"timer"}}),CP=DM({type:c,tooltip:"Container node for lyric labels",group:{name:"Lyrics",id:"lyrics"}}),PP=DM({type:l,tooltip:"Prefab for lyric items",group:{name:"Lyrics",id:"lyrics"}}),MP=DM({tooltip:"Maximum characters per line",group:{name:"Lyrics",id:"lyrics"}}),IP=DM({tooltip:"Maximum lines per segment",group:{name:"Lyrics",id:"lyrics"}}),NP=DM({tooltip:"Scroll speed multiplier",group:{name:"Lyrics",id:"lyrics"}}),LP=DM({tooltip:"Number of preloaded lyric items for pooling",group:{name:"Lyrics",id:"lyrics"}}),OP=DM({tooltip:"Viewport height for recycling lyrics",group:{name:"Lyrics",id:"lyrics"}}),RP=DM({type:c,tooltip:"Microphone icon node",group:{name:"Microphone",id:"mic"}}),xP=DM({type:c,tooltip:"Sound wave container node",group:{name:"Microphone",id:"mic"}}),FP=DM({type:[c],tooltip:"Wave bar nodes",group:{name:"Microphone",id:"mic"}}),DP=DM({tooltip:"Color when microphone is active",group:{name:"Microphone",id:"mic"}}),zP=DM({tooltip:"Color when microphone is inactive",group:{name:"Microphone",id:"mic"}}),kP=DM({tooltip:"Animation speed for wave bars",group:{name:"Microphone",id:"mic"}}),VP=DM({tooltip:"Volume threshold for activity",group:{name:"Microphone",id:"mic"}}),BP=DM({type:FC,tooltip:"Node containing PitchWaveform component",group:{name:"Microphone",id:"mic"}}),HP=DM({type:y,tooltip:"Label component to display the countdown time",group:{name:"UI",id:"ui"}}),UP=DM({type:y,tooltip:"Label component to display the countdown time",group:{name:"UI",id:"ui"}}),GP=DM({type:y,tooltip:"Label component to display the score",group:{name:"UI",id:"ui"}}),WP=DM({type:$i,tooltip:"Animation panel viewEndGame",group:{name:"UI",id:"ui"}}),TP((YP=Mt((ZP=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return e=t.call.apply(t,[this].concat(n))||this,Nt(e,"timeLabel",YP,Lt(e)),Nt(e,"timerFormat",jP,Lt(e)),Nt(e,"lyricsContainer",KP,Lt(e)),Nt(e,"lyricPrefab",XP,Lt(e)),Nt(e,"maxCharsPerLine",JP,Lt(e)),Nt(e,"maxLinesPerSegment",QP,Lt(e)),Nt(e,"scrollSpeedMultiplier",$P,Lt(e)),Nt(e,"poolSize",tM,Lt(e)),Nt(e,"viewportHeight",eM,Lt(e)),Nt(e,"micIcon",iM,Lt(e)),Nt(e,"waveContainer",nM,Lt(e)),Nt(e,"waveBars",rM,Lt(e)),Nt(e,"activeColor",oM,Lt(e)),Nt(e,"inactiveColor",aM,Lt(e)),Nt(e,"animationSpeed",sM,Lt(e)),Nt(e,"volumeThreshold",lM,Lt(e)),Nt(e,"waveformVisualizer",cM,Lt(e)),Nt(e,"lbCountdown",uM,Lt(e)),Nt(e,"lbPressButton",hM,Lt(e)),Nt(e,"lbScore",pM,Lt(e)),Nt(e,"animationpanelViewEndGame",dM,Lt(e)),e.totalDuration=0,e.remainingTime=0,e.isTimerActive=!1,e.lyricPool=[],e.activeLyrics=[],e.currentLyricIndex=-1,e.targetScrollPosition=0,e.isScrolling=!1,e.lastScrollPosition=0,e.allLyrics=[],e.lastCreatedLyricIndex=-1,e.initialLyricCount=5,e.yOffsetForNewLyrics=0,e.isMicActive=!1,e.currentAnimations=[],e}It(e,t);var i=e.prototype;return i.start=function(){this.setupUIElements(),this.updateTimerDisplay(0),this.initLyricPool(),this.setMicActiveState(!1),this.waveformVisualizer&&this.waveformVisualizer.initialize(this.micIcon)},i.update=function(t){this.updateLyricsScrolling(t)},i.onDestroy=function(){this.stopAllAnimations(),this.clearLyricLabels(),this.lyricPool=[]},i.setupUIElements=function(){},i.showLoadingState=function(t){},i.showReadyState=function(){this.lbPressButton&&(this.lbPressButton.node.active=!0)},i.showPlayingState=function(){this.lbPressButton&&(this.lbPressButton.node.active=!1)},i.showPausedState=function(){},i.showFinishedState=function(t){var e=this;this.animationpanelViewEndGame.show((function(){})),this.lbScore.node.active=!0;var i=t||0,n=0;this.lbScore.string="0";var r=Math.min(2,.5+i/100*1.5);v(this.lbScore.node).call((function(){v(e.lbScore.node).to(.2,{scale:new g(1.2,1.2,1.2)}).to(.2,{scale:new g(1,1,1)}).start()})).to(r,{},{onUpdate:function(t,r){n=Math.floor(i*r),e.lbScore.string=n.toString()}}).call((function(){e.lbScore.string=i.toString(),v(e.lbScore.node).to(.1,{scale:new g(1.3,1.3,1.3)}).to(.2,{scale:new g(1,1,1)}).start()})).start()},i.startCountdown=function(t){var e=this;if(this.lbCountdown){this.lbCountdown.node.active=!0,this.lbPressButton&&(this.lbPressButton.node.active=!1);var i=[3,2,1,"Bắt đầu"],n=0;!function r(){if(n<i.length){e.lbCountdown.string=i[n].toString();var o=e.lbCountdown.node;v(o).to(.1,{scale:new g(2,2,2)}).to(.3,{scale:new g(1,1,1)}).call((function(){++n<i.length?r():setTimeout((function(){e.lbCountdown.node.active=!1,t()}),600)})).start()}}()}else t()},i.updateTimer=function(t,e){this.isTimerActive&&(this.remainingTime=Math.max(0,this.totalDuration-e),this.updateTimerDisplay(this.remainingTime),this.remainingTime<=0&&(this.isTimerActive=!1))},i.formatTime=function(t){if(t=Math.floor(t),"s"===this.timerFormat)return t+"s";var e=Math.floor(t/60),i=t%60;return(e<10?"0"+e:""+e)+":"+(i<10?"0"+i:""+i)},i.startTimer=function(t){this.totalDuration=t,this.remainingTime=t,this.isTimerActive=!0,this.updateTimerDisplay(this.remainingTime)},i.stopTimer=function(){this.isTimerActive=!1},i.pauseTimer=function(){this.isTimerActive=!1},i.resumeTimer=function(){this.isTimerActive=!0},i.updateTimerDisplay=function(t){this.timeLabel&&(this.timeLabel.string=this.formatTime(t))},i.initLyricPool=function(){if(this.lyricPrefab&&this.lyricsContainer){var t=new c("LyricPool");t.active=!1,this.node.addChild(t);for(var e=0;e<this.poolSize;e++){var i=A(this.lyricPrefab),n=i.getComponent("KaraokeUILyric");i.active=!1,t.addChild(i),n&&this.lyricPool.push(n)}}},i.getLyricFromPool=function(){for(var t,e=Ft(this.lyricPool);!(t=e()).done;){var i=t.value;if(!i.isInUse())return i.node.active=!0,i}var n=A(this.lyricPrefab);n.active=!0;var r=n.getComponent("KaraokeUILyric");return r?(this.lyricPool.push(r),r):null},i.updateLyricsScrolling=function(t){if(this.isScrolling&&this.lyricsContainer){var e=this.lyricsContainer.position,i=this.lerpValue(e.y,this.targetScrollPosition,5*t*this.scrollSpeedMultiplier);this.lastScrollPosition=e.y,this.lyricsContainer.setPosition(new g(e.x,i,e.z)),Math.abs(i-this.targetScrollPosition)<.1&&(this.isScrolling=!1)}},i.lerpValue=function(t,e,i){return t+(e-t)*Math.min(1,i)},i.updateLyrics=function(t){t!==this.currentLyricIndex&&(this.currentLyricIndex=t,this.highlightCurrentLyric(t))},i.createLyricLabels=function(t){this.lyricsContainer&&this.lyricPrefab&&(this.clearLyricLabels(),this.lyricsContainer.setPosition(new g(0,0,0)),this.targetScrollPosition=0,this.isScrolling=!1,this.lastScrollPosition=0,this.allLyrics=t,this.lastCreatedLyricIndex=-1,this.yOffsetForNewLyrics=0,this.createInitialLyrics())},i.createInitialLyrics=function(){for(var t=0,e=0;t<this.initialLyricCount&&this.lastCreatedLyricIndex+1<this.allLyrics.length;){var i=this.lastCreatedLyricIndex+1,n=this.allLyrics[i],r=this.processLyricText(n.text),o=this.createLyricLabel(r,i);if(o){var a=o.getHeight();o.node.setPosition(new g(0,e,0)),this.lyricsContainer.addChild(o.node),this.activeLyrics.push(o),e-=a+20,this.lastCreatedLyricIndex=i,t++}}this.yOffsetForNewLyrics=e},i.createNextLyric=function(){if(this.lastCreatedLyricIndex+1>=this.allLyrics.length)return!1;var t=this.lastCreatedLyricIndex+1,e=this.allLyrics[t],i=this.processLyricText(e.text),n=this.createLyricLabel(i,t);if(!n)return!1;var r=n.getHeight();return n.node.setPosition(new g(0,this.yOffsetForNewLyrics,0)),this.lyricsContainer.addChild(n.node),this.activeLyrics.push(n),this.yOffsetForNewLyrics-=r+20,this.lastCreatedLyricIndex=t,!0},i.processLyricText=function(t){for(var e,i=t.split(" "),n=[],r="",o=Ft(i);!(e=o()).done;){var a=e.value;if((r+" "+a).length>this.maxCharsPerLine&&r.length>0){if(n.push(r),r=a,n.length>=this.maxLinesPerSegment)break}else r=0===r.length?a:r+" "+a}return r.length>0&&n.length<this.maxLinesPerSegment&&n.push(r),n.join("\n")},i.createLyricLabel=function(t,e){var i=this.getLyricFromPool();return i?(i.init(t,e),e===this.currentLyricIndex?i.setHighlightState("current"):e<this.currentLyricIndex?i.setHighlightState("past"):i.setHighlightState("future"),i):null},i.clearLyricLabels=function(){this.activeLyrics.forEach((function(t){t&&t.isInUse()&&(t.recycle(),t.node.active=!1,t.node.removeFromParent())})),this.activeLyrics=[],this.currentLyricIndex=-1},i.highlightCurrentLyric=function(t){var e=this;if(!(t<0)){if(!this.activeLyrics.some((function(e){return e.getIndex()===t}))&&this.lastCreatedLyricIndex<this.allLyrics.length-1)for(;this.createNextLyric()&&!this.activeLyrics.some((function(e){return e.getIndex()===t})););if(this.activeLyrics.forEach((function(i){if(i&&i.isInUse()){var n=i.getIndex();n===t?i.setHighlightState("current"):n<t?(i.setHighlightState("past"),e.scheduleLyricRecycling(i)):i.setHighlightState("future")}})),this.lyricsContainer){var i=this.activeLyrics.find((function(e){return e.getIndex()===t}));i&&(this.targetScrollPosition=-i.node.position.y,this.isScrolling=!0)}}},i.scheduleLyricRecycling=function(t){var e=this;t&&t.isInUse()&&t.fadeOut((function(){var i=e.activeLyrics.indexOf(t);-1!==i&&(e.activeLyrics.splice(i,1),t.recycle(),t.node.active=!1,t.node.removeFromParent(),e.createNextLyric())}))},i.hideLyricHighlight=function(){var t=this;this.activeLyrics.forEach((function(e){e&&e.isInUse()&&(e.getIndex()===t.currentLyricIndex&&e.setHighlightState("future"))}))},i.updateMicVisualization=function(t,e){var i=t.detected&&t.volume>this.volumeThreshold;this.setMicActiveState(i),i&&this.animateWaveBars(t.volume),this.waveformVisualizer&&this.waveformVisualizer.updateWaveformVisualization(t.volume,t.frequency,e)},i.setMicActiveState=function(t){if(this.isMicActive!==t){if(this.isMicActive=t,this.micIcon){var e=this.micIcon.getComponent(f);e&&(e.color=t?this.activeColor:this.inactiveColor)}this.waveContainer&&(this.waveContainer.active=t),t||this.stopAllAnimations()}},i.animateWaveBars=function(t){var e=this;if(this.waveBars&&0!==this.waveBars.length){this.stopAllAnimations();var i=Math.min(1,2*t);this.waveBars.forEach((function(t,n){if(t){var r=.5+i*Math.random()*.5,o=e.animationSpeed+.2*Math.random(),a=.05*n,s=v(t).delay(a).to(o,{scale:new g(1,r,1)}).to(o,{scale:new g(1,.5,1)}).union().repeat(3).start();e.currentAnimations.push(s)}}))}},i.stopAllAnimations=function(){this.currentAnimations.forEach((function(t){t&&t.stop()})),this.currentAnimations=[],this.waveBars.forEach((function(t){t&&t.setScale(new g(1,.5,1))}))},e}(o)).prototype,"timeLabel",[EP],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),jP=Mt(ZP.prototype,"timerFormat",[AP],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"s"}}),KP=Mt(ZP.prototype,"lyricsContainer",[CP],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),XP=Mt(ZP.prototype,"lyricPrefab",[PP],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),JP=Mt(ZP.prototype,"maxCharsPerLine",[MP],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 90}}),QP=Mt(ZP.prototype,"maxLinesPerSegment",[IP],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 2}}),$P=Mt(ZP.prototype,"scrollSpeedMultiplier",[NP],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1}}),tM=Mt(ZP.prototype,"poolSize",[LP],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 20}}),eM=Mt(ZP.prototype,"viewportHeight",[OP],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 600}}),iM=Mt(ZP.prototype,"micIcon",[RP],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),nM=Mt(ZP.prototype,"waveContainer",[xP],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),rM=Mt(ZP.prototype,"waveBars",[FP],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),oM=Mt(ZP.prototype,"activeColor",[DP],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new X(255,0,255,255)}}),aM=Mt(ZP.prototype,"inactiveColor",[zP],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new X(150,150,150,255)}}),sM=Mt(ZP.prototype,"animationSpeed",[kP],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.3}}),lM=Mt(ZP.prototype,"volumeThreshold",[VP],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.01}}),cM=Mt(ZP.prototype,"waveformVisualizer",[BP],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),uM=Mt(ZP.prototype,"lbCountdown",[HP],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),hM=Mt(ZP.prototype,"lbPressButton",[UP],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),pM=Mt(ZP.prototype,"lbScore",[GP],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),dM=Mt(ZP.prototype,"animationpanelViewEndGame",[WP],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),qP=ZP))||qP);t._RF.pop(),t._RF.push({},"45a40DVOmVEmZ1gYYVdrIOV","KaraokeGameplayController",void 0);var kM,VM,BM,HM,UM,GM,WM,qM,ZM,YM,jM,KM,XM,JM=e.ccclass,QM=e.property;mM=JM("KaraokeGameplayController"),vM=QM({type:bP,tooltip:"Node containing KaraokePitchDetectionSystem component",group:{name:"Systems",id:"systems"}}),yM=QM({type:wP,tooltip:"Node containing KaraokeLyricsManager component",group:{name:"Systems",id:"systems"}}),bM=QM({type:pP,tooltip:"Node containing KaraokeAudioManager component",group:{name:"Systems",id:"systems"}}),_M=QM({type:mP,tooltip:"Node containing KaraokeCharacterAnimator component",group:{name:"Systems",id:"systems"}}),SM=QM({type:gM,tooltip:"Node containing KaraokeScoringSystem component",group:{name:"Systems",id:"systems"}}),wM=QM({type:zM,tooltip:"Node containing KaraokeUIManager component",group:{name:"Systems",id:"systems"}}),TM=QM({tooltip:"Whether to autostart microphone access on initialization",group:{name:"Config",id:"config"}}),EM=QM({tooltip:"Path to default song to load (can be empty)",group:{name:"Config",id:"config"}}),mM((PM=Mt((CM=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return e=t.call.apply(t,[this].concat(n))||this,Nt(e,"pitchDetection",PM,Lt(e)),Nt(e,"lyricsManager",MM,Lt(e)),Nt(e,"audioManager",IM,Lt(e)),Nt(e,"characterAnimator",NM,Lt(e)),Nt(e,"scoringSystem",LM,Lt(e)),Nt(e,"uiManager",OM,Lt(e)),Nt(e,"autoInitMicrophone",RM,Lt(e)),Nt(e,"defaultSongPath",xM,Lt(e)),e.state=XC.INIT,e.currentSong=null,e.microphoneInitialized=!1,e.isLyricActive=!1,e.availableSongs=[{id:"TrongCom_ATVNCG",title:"Trống Cơm",artist:"ATVNCG",bpm:86,musicPath:"TrongCom_ATVNCG",lyricPath:"trongcom",lyrics:[],duration:254,difficulty:1,previewStart:0,previewEnd:1e4}],e}It(e,t);var i=e.prototype;return i.onLoad=function(){var t=Ot(Rt().mark((function t(){return Rt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.initializeSubsystems(),this.setupEventListeners(),this.changeState(XC.INIT),!this.autoInitMicrophone){t.next=6;break}return t.next=6,this.initializeMicrophone();case 6:case"end":return t.stop()}}),t,this)})));return function(){return t.apply(this,arguments)}}(),i.start=function(){this.loadSong(this.availableSongs[0])},i.onDestroy=function(){this.removeEventListeners()},i.update=function(t){if(this.audioManager&&this.state===XC.PLAYING){var e=this.audioManager.getCurrentTime();this.lyricsManager&&this.lyricsManager.updateTime(e),this.scoringSystem&&this.scoringSystem.updateTime(e),this.uiManager&&this.uiManager.updateTimer(e,this.getCurrentPlaybackTime())}},i.initializeMicrophone=function(){var t=Ot(Rt().mark((function t(){return Rt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.microphoneInitialized){t.next=2;break}return t.abrupt("return",!0);case 2:if(this.pitchDetection){t.next=5;break}return console.error("Pitch detection system not found"),t.abrupt("return",!1);case 5:return t.prev=5,t.next=8,this.pitchDetection.initialize();case 8:if(t.sent){t.next=12;break}return console.error("Failed to initialize pitch detection"),t.abrupt("return",!1);case 12:return t.next=14,this.pitchDetection.requestMicrophoneAccess();case 14:if(t.sent){t.next=18;break}return console.error("Failed to access microphone"),t.abrupt("return",!1);case 18:return this.microphoneInitialized=!0,t.abrupt("return",!0);case 22:return t.prev=22,t.t0=t.catch(5),console.error("Error initializing microphone:",t.t0),t.abrupt("return",!1);case 26:case"end":return t.stop()}}),t,this,[[5,22]])})));return function(){return t.apply(this,arguments)}}(),i.loadSong=function(){var t=Ot(Rt().mark((function t(e){var i,n,r,o,a,s;return Rt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.changeState(XC.LOADING),t.prev=1,i=e){t.next=6;break}return this.changeState(XC.INIT),t.abrupt("return",!1);case 6:return t.prev=6,t.next=9,this.lyricsManager.loadLyrics(i);case 9:if(n=t.sent,this.currentSong=n,r=0,n.lyrics&&n.lyrics.length>0)for(o=Ft(n.lyrics);!(a=o()).done;)s=a.value,r+=s.endTime-s.startTime;return this.scoringSystem&&this.scoringSystem.setTotalLyricsDuration(r),console.log("Total lyrics interaction duration: "+r.toFixed(2)+" seconds"),t.next=17,this.audioManager.loadAudio(zm.getBeatmapPath(n));case 17:return this.uiManager&&this.uiManager.createLyricLabels(n.lyrics),this.changeState(XC.READY),t.abrupt("return",!0);case 22:return t.prev=22,t.t0=t.catch(6),console.error("Error loading lyrics:",t.t0),this.currentSong=i,this.lyricsManager.setLyrics([]),t.next=29,this.audioManager.loadAudio(zm.getBeatmapPath(i));case 29:return this.changeState(XC.READY),t.abrupt("return",!0);case 31:t.next=38;break;case 33:return t.prev=33,t.t1=t.catch(1),console.error("Error loading song:",t.t1),this.changeState(XC.INIT),t.abrupt("return",!1);case 38:case"end":return t.stop()}}),t,this,[[1,33],[6,22]])})));return function(e){return t.apply(this,arguments)}}(),i.startPlayback=function(){var t=this;this.state===XC.READY||this.state===XC.PAUSED?this.microphoneInitialized?this.uiManager&&this.state===XC.READY?this.uiManager.startCountdown((function(){t.actuallyStartPlayback()})):this.actuallyStartPlayback():console.warn("Microphone not initialized, cannot start playback"):console.warn("Cannot start playback in current state")},i.actuallyStartPlayback=function(){this.pitchDetection.startDetection(),this.audioManager.startPlayback(),this.lyricsManager.startPlayback(),this.scoringSystem.startScoring(),this.uiManager&&this.currentSong&&this.uiManager.startTimer(this.currentSong.duration),this.changeState(XC.PLAYING)},i.pausePlayback=function(){this.state===XC.PLAYING?(this.audioManager.pausePlayback(),this.lyricsManager.pausePlayback(),this.changeState(XC.PAUSED)):console.warn("Cannot pause playback in current state")},i.resumePlayback=function(){this.state===XC.PAUSED?(this.audioManager.resumePlayback(),this.lyricsManager.resumePlayback(),this.changeState(XC.PLAYING)):console.warn("Cannot resume playback in current state")},i.stopPlayback=function(){this.state===XC.PLAYING||this.state===XC.PAUSED?(this.pitchDetection.stopDetection(),this.audioManager.stopPlayback(),this.lyricsManager.stopPlayback(),this.scoringSystem.stopScoring(),this.characterAnimator.playIdle(),this.uiManager&&this.uiManager.stopTimer(),this.changeState(XC.READY)):console.warn("Cannot stop playback in current state")},i.getState=function(){return this.state},i.getCurrentSong=function(){return this.currentSong},i.getCurrentPlaybackTime=function(){return!this.audioManager||this.state!==XC.PLAYING&&this.state!==XC.PAUSED?0:this.audioManager.getCurrentTime()},i.handleExitRequest=function(){this.state!==XC.PLAYING&&this.state!==XC.PAUSED||this.stopPlayback(),console.log("Exiting karaoke mode")},i.initializeSubsystems=function(){this.pitchDetection||console.warn("Pitch detection system not found"),this.lyricsManager||console.warn("Lyrics manager not found"),this.audioManager||console.warn("Audio manager not found"),this.characterAnimator||console.warn("Character animator not found"),this.scoringSystem||console.warn("Scoring system not found"),this.uiManager||console.warn("UI manager not found")},i.setupEventListeners=function(){this.pitchDetection.on(QC.EVENTS.PITCH_DETECTED,this.onPitchDetected,this),this.lyricsManager.on(QC.EVENTS.LYRICS_UPDATED,this.onLyricsUpdated,this),this.audioManager.on(QC.EVENTS.SONG_ENDED,this.onSongEnded,this)},i.removeEventListeners=function(){this.pitchDetection.off(QC.EVENTS.PITCH_DETECTED,this.onPitchDetected,this),this.lyricsManager.off(QC.EVENTS.LYRICS_UPDATED,this.onLyricsUpdated,this),this.audioManager.off(QC.EVENTS.SONG_ENDED,this.onSongEnded,this)},i.changeState=function(t){if(t!==this.state&&(console.log("Karaoke state changed: "+XC[this.state]+" -> "+XC[t]),this.state=t,this.uiManager))switch(t){case XC.INIT:case XC.LOADING:this.uiManager.showLoadingState(!0);break;case XC.READY:this.uiManager.showLoadingState(!1),this.uiManager.showReadyState(),this.uiManager.stopTimer();break;case XC.PLAYING:this.uiManager.showPlayingState(),this.uiManager.resumeTimer();break;case XC.PAUSED:this.uiManager.showPausedState(),this.uiManager.pauseTimer();break;case XC.FINISHED:this.uiManager.showFinishedState(this.scoringSystem.getScore().score),this.uiManager.stopTimer()}},i.onPitchDetected=function(t){this.scoringSystem&&this.scoringSystem.updatePitchDetection(t),this.characterAnimator&&(t.detected?this.characterAnimator.playSinging():this.characterAnimator.playIdle()),this.uiManager&&this.uiManager.updateMicVisualization(t,this.pitchDetection)},i.onLyricsUpdated=function(t){var e=t.currentLyric,i=t.currentLyricIndex;this.isLyricActive=null!==e&&this.lyricsManager.isLyricActive(),this.scoringSystem&&this.scoringSystem.updateLyricStatus(this.isLyricActive),this.uiManager&&(this.isLyricActive?this.uiManager.updateLyrics(i):this.uiManager.hideLyricHighlight())},i.onSongEnded=function(){this.pitchDetection.stopDetection(),this.lyricsManager.stopPlayback(),this.scoringSystem.stopScoring(),this.characterAnimator.playIdle(),this.uiManager&&this.uiManager.stopTimer(),this.changeState(XC.FINISHED)},e}(o)).prototype,"pitchDetection",[vM],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),MM=Mt(CM.prototype,"lyricsManager",[yM],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),IM=Mt(CM.prototype,"audioManager",[bM],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),NM=Mt(CM.prototype,"characterAnimator",[_M],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),LM=Mt(CM.prototype,"scoringSystem",[SM],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),OM=Mt(CM.prototype,"uiManager",[wM],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),RM=Mt(CM.prototype,"autoInitMicrophone",[TM],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),xM=Mt(CM.prototype,"defaultSongPath",[EM],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return""}}),AM=CM));t._RF.pop(),t._RF.push({},"b6ce0GHy0pHfJFBAfxbueVI","KaraokeUILyric",void 0);var $M,tI,eI,iI,nI,rI,oI,aI,sI,lI,cI,uI,hI,pI=e.ccclass,dI=e.property;kM=pI("KaraokeUILyric"),VM=dI({type:y,tooltip:"Label component for the lyric"}),BM=dI({tooltip:"Duration of fade out animation in seconds"}),HM=dI({tooltip:"Color for current lyric"}),UM=dI({tooltip:"Color for past lyric"}),GM=dI({tooltip:"Color for future lyric"}),kM((ZM=Mt((qM=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return e=t.call.apply(t,[this].concat(n))||this,Nt(e,"label",ZM,Lt(e)),Nt(e,"fadeOutDuration",YM,Lt(e)),Nt(e,"currentColor",jM,Lt(e)),Nt(e,"pastColor",KM,Lt(e)),Nt(e,"futureColor",XM,Lt(e)),e._index=-1,e._isInUse=!1,e._currentTween=null,e._uiOpacity=null,e}It(e,t);var i=e.prototype;return i.onLoad=function(){this._uiOpacity=this.getComponent(b),this._uiOpacity||(this._uiOpacity=this.addComponent(b))},i.init=function(t,e){this._index=e,this._isInUse=!0,this.stopFadeAnimation(),this._uiOpacity&&(this._uiOpacity.opacity=255),this.label&&(this.label.string=t)},i.setHighlightState=function(t){if(this.label)switch(t){case"current":this.label.color=this.currentColor,this.label.isBold=!0;break;case"past":this.label.color=this.pastColor,this.label.isBold=!1;break;case"future":this.label.color=this.futureColor,this.label.isBold=!1}},i.fadeOut=function(t){var e=this;this.stopFadeAnimation(),this._uiOpacity||(this._uiOpacity=this.getComponent(b),this._uiOpacity||(this._uiOpacity=this.addComponent(b))),this._currentTween=v(this._uiOpacity).to(this.fadeOutDuration,{opacity:0}).call((function(){e._currentTween=null,t&&t()})).start()},i.stopFadeAnimation=function(){this._currentTween&&(this._currentTween.stop(),this._currentTween=null)},i.getHeight=function(){return this.getAccurateHeight()},i.getAccurateHeight=function(){this.label&&this.label.updateRenderData(!0);var t=this.getComponent(B);return t?t.height:50},i.getIndex=function(){return this._index},i.isInUse=function(){return this._isInUse},i.recycle=function(){this.stopFadeAnimation(),this._uiOpacity&&(this._uiOpacity.opacity=255),this._isInUse=!1,this._index=-1},i.getHeightNextFrame=function(t){var e=this;this.scheduleOnce((function(){var i=e.getComponent(B),n=i?i.height:50;t(n)}),0)},e}(o)).prototype,"label",[VM],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),YM=Mt(qM.prototype,"fadeOutDuration",[BM],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.5}}),jM=Mt(qM.prototype,"currentColor",[HM],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new X(255,255,255,255)}}),KM=Mt(qM.prototype,"pastColor",[UM],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new X(136,136,136,255)}}),XM=Mt(qM.prototype,"futureColor",[GM],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new X(204,204,204,255)}}),WM=qM));t._RF.pop(),t._RF.push({},"dd74eu3S4NEpap53qs6fEO1","MTItemSong",void 0);var fI,gI,mI=e.ccclass,vI=e.property,yI=($M=mI("MTItemSong"),tI=vI(y),eI=vI(y),iI=vI(y),nI=vI(x),rI=vI(f),$M((sI=Mt((aI=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return e=t.call.apply(t,[this].concat(n))||this,Nt(e,"songNameLabel",sI,Lt(e)),Nt(e,"artistLabel",lI,Lt(e)),Nt(e,"difficultyLabel",cI,Lt(e)),Nt(e,"selectButton",uI,Lt(e)),Nt(e,"coverSprite",hI,Lt(e)),e.songData=null,e.selectionCallback=null,e}It(e,t);var i=e.prototype;return i.start=function(){this.selectButton&&this.selectButton.node.on("click",this.onSongSelected,this)},i.setSongData=function(t,e){this.songData=t,this.selectionCallback=e,this.songNameLabel&&(this.songNameLabel.string=t.title||"Unknown Title"),this.artistLabel&&(this.artistLabel.string=t.artist||"Unknown Artist"),this.difficultyLabel&&(this.difficultyLabel.string="Difficulty: 'Medium'"),this.coverSprite&&t.thumbnail},i.onSongSelected=function(){this.selectionCallback&&this.songData&&this.selectionCallback(this.songData)},i.update=function(t){},e}(o)).prototype,"songNameLabel",[tI],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),lI=Mt(aI.prototype,"artistLabel",[eI],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),cI=Mt(aI.prototype,"difficultyLabel",[iI],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),uI=Mt(aI.prototype,"selectButton",[nI],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),hI=Mt(aI.prototype,"coverSprite",[rI],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),oI=aI))||oI);t._RF.pop(),t._RF.push({},"f80292EF6FHTqlNZTog+XHg","MTAudioManager",void 0);var bI,_I,SI=e.ccclass,wI=(e.property,SI("MTAudioManager")(((gI=function(){function t(){this.commonAudioManager=Yi.instance,this._beatmapAudioSource=null,this._currentBeatmap=null,this._beatCallbacks=[],this._isBuffering=!1,this._playbackTimer=0,this.audioTimeEstimation=0,this.lastSystemTime=0,this._timeCheckCounter=0,this._timeCheckInterval=30,this.init()}var e=t.prototype;return e.init=function(){var t=new c("beatmap-audio");M.getScene().addChild(t),this._beatmapAudioSource=t.addComponent(N)},e.loadBeatmapAudioData=function(){var t=Ot(Rt().mark((function t(e,i,n){var r,o,a;return Rt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return void 0===n&&(n=1),this._isBuffering=!0,t.prev=2,t.next=5,Promise.all([this.loadAudioClip(e),pe(i,n)]);case 5:return r=t.sent,o=r[0],a=r[1],this._currentBeatmap={clip:o,trackInfo:a,totalDuration:o.getDuration(),currentTime:0,isPlaying:!1,isPaused:!1},this._beatmapAudioSource.clip=o,this._beatmapAudioSource.volume=1,this._isBuffering=!1,t.abrupt("return",this._currentBeatmap);case 15:return t.prev=15,t.t0=t.catch(2),console.error("Failed to load beatmap audio:",t.t0),this._isBuffering=!1,t.abrupt("return",null);case 20:case"end":return t.stop()}}),t,this,[[2,15]])})));return function(e,i,n){return t.apply(this,arguments)}}(),e.setCurrentBeatmap=function(t){this._currentBeatmap=t,this._beatmapAudioSource.clip=t.clip,this._beatmapAudioSource.volume=1,this._isBuffering=!1},e.loadAudioClip=function(t){return new Promise((function(e,i){Qe.loadRes(t,L,(function(t,n){t?i(t):e(n)}))}))},e.playBeatmapAudio=function(t){void 0===t&&(t=0),this._currentBeatmap&&!this._isBuffering?(this._currentBeatmap.currentTime=t,this._currentBeatmap.isPlaying=!0,this._currentBeatmap.isPaused=!1,this._beatmapAudioSource.currentTime=t,this._beatmapAudioSource.play()):console.warn("No beatmap loaded or still buffering")},e.getEstimatedAudioTime=function(){var t=Date.now()/1e3;if(!this.lastSystemTime)return this.lastSystemTime=t,this.audioTimeEstimation=this._beatmapAudioSource.currentTime,this.audioTimeEstimation;var e=t-this.lastSystemTime;if(this.audioTimeEstimation+=e,this._timeCheckCounter++%this._timeCheckInterval==0){var i=this._beatmapAudioSource.currentTime;this.audioTimeEstimation=.95*this.audioTimeEstimation+.05*i}return this.lastSystemTime=t,this.audioTimeEstimation},e.getAudioTime=function(){return this._beatmapAudioSource.currentTime},e.pauseBeatmapAudio=function(){this._currentBeatmap&&this._currentBeatmap.isPlaying&&(this._beatmapAudioSource.pause(),this._currentBeatmap.isPaused=!0,this._currentBeatmap.isPlaying=!1)},e.resumeBeatmapAudio=function(){this._currentBeatmap&&this._currentBeatmap.isPaused&&(this._beatmapAudioSource.play(),this._currentBeatmap.isPaused=!1,this._currentBeatmap.isPlaying=!0)},e.stopBeatmapAudio=function(){this._currentBeatmap&&(this._beatmapAudioSource.stop(),this._currentBeatmap.isPlaying=!1,this._currentBeatmap.isPaused=!1,this._currentBeatmap.currentTime=0)},e.getCurrentTime=function(){return this._currentBeatmap?this._beatmapAudioSource.currentTime:0},e.getTotalDuration=function(){return this._currentBeatmap?this._currentBeatmap.totalDuration:0},e.onBeat=function(t){this._beatCallbacks.push(t)},e.offBeat=function(t){var e=this._beatCallbacks.indexOf(t);-1!==e&&this._beatCallbacks.splice(e,1)},e.startBeatTracking=function(){var t=this;if(this._currentBeatmap&&this._currentBeatmap.trackInfo.notes){this.stopBeatTracking();var e=this._currentBeatmap.trackInfo.notes,i=0;requestAnimationFrame((function n(){if(t._currentBeatmap&&t._currentBeatmap.isPlaying){for(var r=t._beatmapAudioSource.currentTime;i<e.length&&e[i].time<=r;)t._beatCallbacks.forEach((function(t){t(e[i])})),i++;requestAnimationFrame(n)}}))}},e.stopBeatTracking=function(){this._currentBeatmap&&(this._currentBeatmap.isPlaying=!1)},e.setMusicVolume=function(t){this._beatmapAudioSource.volume=t},e.getMusicVolume=function(){return this._beatmapAudioSource.volume},e.isBuffering=function(){return this._isBuffering},e.isPlaying=function(){return!!this._currentBeatmap&&this._currentBeatmap.isPlaying},e.isPaused=function(){return!!this._currentBeatmap&&this._currentBeatmap.isPaused},e.playSound=function(t,e){var i;return void 0===e&&(e=1),null==(i=this.commonAudioManager)?void 0:i.playSound(t,e)},e.createBeatmapAudioDataFromAssets=function(){var t=Ot(Rt().mark((function t(e,i){return Rt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this._isBuffering=!0,t.prev=1,this._currentBeatmap={clip:e,trackInfo:i,totalDuration:e.getDuration(),currentTime:0,isPlaying:!1,isPaused:!1},this._beatmapAudioSource.clip=e,this._beatmapAudioSource.volume=1,this._isBuffering=!1,t.abrupt("return",this._currentBeatmap);case 9:return t.prev=9,t.t0=t.catch(1),console.error("Failed to create beatmap audio from assets:",t.t0),this._isBuffering=!1,t.abrupt("return",null);case 14:case"end":return t.stop()}}),t,this,[[1,9]])})));return function(e,i){return t.apply(this,arguments)}}(),e.deinit=function(){this._beatmapAudioSource&&this._beatmapAudioSource.stop(),this._currentBeatmap=null,this._beatCallbacks=[],this._isBuffering=!1,this._playbackTimer=0,this.audioTimeEstimation=0,this.lastSystemTime=0,this._timeCheckCounter=0,t._instance=null},xt(t,null,[{key:"instance",get:function(){return this._instance||(this._instance=new t),this._instance}}]),t}())._instance=null,fI=gI))||fI);t._RF.pop(),t._RF.push({},"f0997PWuMBCn4LtP5qegoPj","BeatmapManager",void 0);var TI,EI,AI,CI,PI,MI,II,NI,LI,OI,RI,xI,FI,DI,zI,kI,VI,BI,HI,UI,GI,WI,qI,ZI,YI=e.ccclass,jI=(e.property,YI("BeatmapManager")(((_I=function(){function t(){this.audioManager=wI.instance,this.beatmaps=new Map,this.activeBeatmap=null,this.beatmapDirectory="magic_tiles/beatmaps",this.maxLanes=4,this.init()}var e=t.prototype;return e.init=function(){console.log("BeatmapManager initialized")},e.loadSong=function(){var t=Ot(Rt().mark((function t(e){var i;return Rt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.beatmaps.has(e.id)){t.next=3;break}return this.activeBeatmap=this.beatmaps.get(e.id),t.abrupt("return",this.activeBeatmap);case 3:return t.prev=3,i=this.validateBeatmap(e),this.beatmaps.set(e.id,i),this.activeBeatmap=i,t.abrupt("return",i);case 10:return t.prev=10,t.t0=t.catch(3),console.error("Failed to load beatmap "+e.id+":",t.t0),t.abrupt("return",null);case 14:case"end":return t.stop()}}),t,this,[[3,10]])})));return function(e){return t.apply(this,arguments)}}(),e.validateBeatmap=function(t){return{song:t,notes:[]}},e.updateNotes=function(t,e){if(this.beatmaps.has(t)){var i=this.beatmaps.get(t);return i.notes=this.convertNotes(e,i.notes),this.beatmaps.set(t,i),i}return null},e.convertNotes=function(t,e){void 0===e&&(e=[]);var i,n=t.length;if(e.length>=n){for(var r=0;r<n;r++){var o=t[r];e[r].midi=o.midi,e[r].time=o.time,e[r].lane=this.getLandById(o.midi),e[r].duration=o.duration,e[r].durationTicks=o.durationTicks,e[r].velocity=o.velocity,e[r].type=this.getNoteType(o)}e.length>n&&(e.length=n),i=e}else{i=new Array(n);for(var a=0;a<n;a++){var s=t[a];a<e.length?(i[a]=e[a],i[a].midi=s.midi,i[a].time=s.time,i[a].lane=this.getLandById(s.midi),i[a].duration=s.duration,i[a].durationTicks=s.durationTicks,i[a].velocity=s.velocity,i[a].type=this.getNoteType(s)):i[a]={midi:s.midi,time:s.time,lane:this.getLandById(s.midi),duration:s.duration,durationTicks:s.durationTicks,velocity:s.velocity,type:this.getNoteType(s)}}}i.sort((function(t,e){return t.time-e.time}));for(var l=0;l<i.length-1;l++){var c=i[l],u=i[l+1];u.time===c.time&&l+2<i.length&&(u=i[l+2]),c.type!==uv.HOLD&&(c.duration=Math.min(u.time-c.time,.23))}if(i.length>0){var h=i[i.length-1];h.type!==uv.HOLD&&h.duration<=0&&(h.duration=.2)}return i},e.getLandById=function(t){return t-96},e.getNoteType=function(t){return t.duration>.3?uv.HOLD:uv.TAP},e.loadJsonAsset=function(t){return new Promise((function(e,i){Qe.loadRes(t,bt,(function(n,r){n?i(n):r?e(r.json):i(new Error("JSON asset not found at path: "+t))}))}))},e.loadBeatmapAudioData=function(){var t=Ot(Rt().mark((function t(){var e;return Rt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.activeBeatmap){t.next=3;break}return console.error("No active beatmap to load audio for"),t.abrupt("return",null);case 3:return t.prev=3,e=this.activeBeatmap.song,t.next=7,this.audioManager.loadBeatmapAudioData(Hm.getMusicPath(e),Bm.getMidiPath(e));case 7:return t.abrupt("return",t.sent);case 10:return t.prev=10,t.t0=t.catch(3),console.error("Failed to load beatmap audio:",t.t0),t.abrupt("return",null);case 14:case"end":return t.stop()}}),t,this,[[3,10]])})));return function(){return t.apply(this,arguments)}}(),e.getActiveBeatmap=function(){return this.activeBeatmap},e.getNotes=function(){return this.activeBeatmap?this.activeBeatmap.notes:[]},e.calculateDifficulty=function(t){var e=t.notes;if(!e.length)return 1;for(var i=e[e.length-1].time-e[0].time,n=e.length/(i||1),r=e.filter((function(t){return t.type!==uv.TAP})).length/e.length,o=0,a=1;a<e.length;a++)e[a].lane!==e[a-1].lane&&o++;for(var s=o/(e.length-1),l=0,c=1;c<e.length;c++){e[c].time-e[c-1].time<.3&&l++}var u=1+.5*n+2*r+2*s+3*(l/(e.length-1));return Math.min(Math.round(10*u)/10,10)},e.getBeatmapPreview=function(t){var e=this.beatmaps.get(t);if(!e)return[];var i=e.song,n=i.previewStart,r=i.previewEnd;return e.notes.filter((function(t){return t.time>=n&&t.time<=r}))},e.validateCustomBeatmap=function(t){try{return this.validateBeatmap(t)}catch(t){return console.error("Invalid custom beatmap format:",t),null}},e.addTempBeatmap=function(t,e){return this.beatmaps.set(t,e),this.activeBeatmap=e,e},e.deinit=function(){this.beatmaps.clear(),this.activeBeatmap=null,console.log("BeatmapManager deinitializing..."),t._instance=null},xt(t,null,[{key:"instance",get:function(){return this._instance||(this._instance=new t),this._instance}}]),t}())._instance=null,bI=_I))||bI);t._RF.pop(),t._RF.push({},"0693cAdL+JB3Jn4GXrhDvzS","Tile",void 0);var KI,XI,JI,QI,$I,tN,eN,iN,nN,rN,oN,aN,sN,lN,cN,uN,hN,pN,dN,fN,gN,mN,vN,yN,bN,_N,SN,wN,TN,EN,AN,CN,PN,MN,IN,NN,LN,ON,RN,xN,FN,DN,zN,kN,VN,BN,HN,UN,GN,WN,qN,ZN,YN=e.ccclass,jN=e.property,KN=function(t){return t[t.WAITING=0]="WAITING",t[t.ACTIVE=1]="ACTIVE",t[t.HOLDING=2]="HOLDING",t[t.HIT=3]="HIT",t[t.MISSED=4]="MISSED",t[t.EXPIRED=5]="EXPIRED",t}({}),XN=function(t){return t[t.PERFECT=0]="PERFECT",t[t.GREAT=1]="GREAT",t[t.COOL=2]="COOL",t[t.MISS=3]="MISS",t}({}),JN=(TI=YN("Tile"),EI=jN(f),AI=jN(B),CI=jN(b),PI=jN(c),MI=jN({type:c,group:{name:"Long Press"}}),II=jN({type:c,group:{name:"Long Press"}}),NI=jN({type:B,group:{name:"Long Press"}}),TI(((ZI=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return e=t.call.apply(t,[this].concat(n))||this,Nt(e,"background",RI,Lt(e)),Nt(e,"transform",xI,Lt(e)),Nt(e,"opacity",FI,Lt(e)),Nt(e,"bufferHeight",DI,Lt(e)),Nt(e,"nodeBeginning",zI,Lt(e)),Nt(e,"nodeLongPress",kI,Lt(e)),Nt(e,"nodeHoldEffect",VI,Lt(e)),Nt(e,"holdEffectTransform",BI,Lt(e)),Nt(e,"normalColor",HI,Lt(e)),Nt(e,"holdColor",UI,Lt(e)),Nt(e,"slideColor",GI,Lt(e)),Nt(e,"hitColor",WI,Lt(e)),Nt(e,"missColor",qI,Lt(e)),e.noteData=null,e.status=KN.WAITING,e.startY=0,e.targetY=0,e.lane=0,e.scrollSpeed=0,e.spawnTime=0,e.hitTime=0,e.touchStartTime=0,e.touchEndTime=0,e.isTouching=!1,e.isLongPress=!1,e.isSliding=!1,e.moveTween=null,e.scaleTween=null,e.opacityTween=null,e.holdRating=XN.MISS,e.movementStartTime=0,e.movementDuration=0,e.movementStartY=0,e.movementTargetY=0,e.isMovementActive=!1,e.tempVec3=new g,e.updatePriority=0,e.frameCounter=0,e.holdRange=0,e}It(e,t);var i=e.prototype;return i.onLoad=function(){this.background||(this.background=this.getComponent(f)),this.transform||(this.transform=this.getComponent(B)),this.opacity||(this.opacity=this.getComponent(b)),this.nodeHoldEffect&&!this.holdEffectTransform&&(this.holdEffectTransform=this.nodeHoldEffect.getComponent(B))},i.init=function(t,e,i,n,r,o,a){this.noteData=t,this.lane=e,this.startY=i,this.targetY=n,this.scrollSpeed=o,this.status=KN.WAITING,this.holdRange=0,this.isTouching=!1,this.touchStartTime=0,this.touchEndTime=0,this.node.position=new g(0,i,0),this.moveTween&&(this.moveTween.stop(),this.moveTween=null),this.scaleTween&&(this.scaleTween.stop(),this.scaleTween=null),this.opacityTween&&(this.opacityTween.stop(),this.opacityTween=null),this.background.color=this.normalColor,this.opacity.opacity=255;var s=t.duration*o;this.transform.contentSize=new tt(r,Math.max(s,a)),this.transform.node.position=new g(0,-this.bufferHeight,0),this.nodeBeginning.active=!1,t.type===uv.HOLD&&t.duration>0?(this.isLongPress=!0,this.setLongPressNodeActive(!0),this.nodeHoldEffect&&(this.nodeHoldEffect.active=!1),this.holdEffectTransform&&(this.holdEffectTransform.height=0)):(this.isLongPress=!1,this.setLongPressNodeActive(!1)),t.type===uv.SLIDE?this.isSliding=!0:this.isSliding=!1,this.node.active=!0},i.setBeginningNodeActive=function(t){this.nodeBeginning.active=t},i.setLongPressNodeActive=function(t){this.nodeLongPress.active=t},i.getTileHeight=function(){return this.transform.contentSize.height},i.setBufferHeight=function(t){this.bufferHeight=t,this.transform.node.position=new g(0,-this.bufferHeight,0)},i.startMovement=function(t,e){this.status=KN.ACTIVE,this.spawnTime=Date.now()/1e3;var i=this.targetY-(t*this.scrollSpeed-(this.startY-this.targetY));this.movementStartTime=e,this.movementDuration=t,this.movementStartY=this.node.position.y,this.movementTargetY=i,this.isMovementActive=!0,this.moveTween&&(this.moveTween.stop(),this.moveTween=null)},i.setUpdatePriority=function(t){this.updatePriority=t},i.update=function(t){this.updatePriority>0&&(this.frameCounter=(this.frameCounter+1)%(this.updatePriority+1),0!==this.frameCounter)||(this.isMovementActive&&this.updateTileMovement(),this.status===KN.HOLDING&&this.isLongPress&&this.nodeHoldEffect&&this.updateHoldEffect(t))},i.updateTileMovement=function(){var t=this.calculateCurrentTime()-this.movementStartTime,e=Math.min(1,t/this.movementDuration),i=this.movementStartY+(this.movementTargetY-this.movementStartY)*e;return this.tempVec3.set(0,i,0),this.node.position=this.tempVec3,e>=1&&(this.isMovementActive=!1),i},i.calculateCurrentTime=function(){return Date.now()/1e3-this.spawnTime+this.movementStartTime},i.tap=function(t){if(!this.noteData||this.status!==KN.ACTIVE)return XN.MISS;this.touchStartTime=t,this.isTouching=!0;var e,i=this.noteData.time,n=Math.abs(t-i),r=I.deltaTime,o=Math.min(Math.max(r/(1/60),1),3),a=.3*o,s=.5*o;return e=n<.1*o?XN.PERFECT:n<a?XN.GREAT:n<s?XN.COOL:XN.MISS,this.noteData.type===uv.TAP?this.completeHit(e):this.noteData.type===uv.HOLD&&this.triggerLongPress(e),e},i.release=function(t){if(!this.isTouching||!this.isLongPress||!this.noteData)return XN.MISS;if(this.touchEndTime=t,this.isTouching=!1,this.noteData.type===uv.HOLD){var e=this.noteData.duration,i=this.touchEndTime-this.touchStartTime,n=I.deltaTime,r=Math.min(Math.max(n/(1/60),1),2),o=XN.COOL,a=i/e,s=.8/r;return a>=.95/r?o=XN.PERFECT:a>=s&&(o=XN.GREAT),this.completeHit(o),o}return XN.MISS},i.completeHit=function(t){t!==XN.MISS?(this.status=KN.HIT,this.playHitAnimation()):this.miss()},i.triggerLongPress=function(t){if(t!==XN.MISS){if(this.status=KN.HOLDING,this.holdRating=t,this.holdRange=Math.abs(this.node.position.y-this.targetY),this.nodeHoldEffect&&(this.nodeHoldEffect.active=!0,this.holdEffectTransform)){var e=this.holdEffectTransform.contentSize;this.holdEffectTransform.contentSize=new tt(e.width,0)}this.background.color=this.holdColor}else this.miss()},i.playHitAnimation=function(){this.background.color=this.normalColor,this.opacity.opacity=100},i.miss=function(){this.status=KN.MISSED,e.missCount++,this.background.color=this.missColor,this.opacityTween=v(this.opacity).to(.3,{opacity:100}).start()},i.getNote=function(){return this.noteData},i.getStatus=function(){return this.status},i.getLane=function(){return this.lane},i.isLongPressType=function(){return this.isLongPress},i.isSlideType=function(){return this.isSliding},i.recycle=function(){this.moveTween&&(this.moveTween.stop(),this.moveTween=null),this.scaleTween&&(this.scaleTween.stop(),this.scaleTween=null),this.opacityTween&&(this.opacityTween.stop(),this.opacityTween=null),this.status=KN.WAITING,this.noteData=null,this.isTouching=!1,this.isLongPress=!1,this.isSliding=!1,this.holdRange=0,this.nodeHoldEffect&&(this.nodeHoldEffect.active=!1),this.isMovementActive=!1,this.node.active=!1},i.updateHoldEffect=function(t){if(this.isTouching){this.holdRange=Math.min(this.holdRange+this.scrollSpeed*t,this.transform.contentSize.height-this.bufferHeight),this.nodeHoldEffect.active||(this.nodeHoldEffect.active=!0);var e=this.nodeHoldEffect.position,i=this.holdRange+this.bufferHeight;if(this.nodeHoldEffect.position=new g(e.x,i,e.z),this.holdEffectTransform){var n=this.holdEffectTransform.contentSize;this.holdEffectTransform.contentSize=new tt(n.width,i)}}},e}(o)).missCount=0,RI=Mt((OI=ZI).prototype,"background",[EI],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),xI=Mt(OI.prototype,"transform",[AI],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),FI=Mt(OI.prototype,"opacity",[CI],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),DI=Mt(OI.prototype,"bufferHeight",[jN],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 200}}),zI=Mt(OI.prototype,"nodeBeginning",[PI],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),kI=Mt(OI.prototype,"nodeLongPress",[MI],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),VI=Mt(OI.prototype,"nodeHoldEffect",[II],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),BI=Mt(OI.prototype,"holdEffectTransform",[NI],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),HI=Mt(OI.prototype,"normalColor",[jN],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new X(0,0,0,255)}}),UI=Mt(OI.prototype,"holdColor",[jN],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new X(50,50,200,255)}}),GI=Mt(OI.prototype,"slideColor",[jN],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new X(50,200,50,255)}}),WI=Mt(OI.prototype,"hitColor",[jN],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new X(200,200,200,255)}}),qI=Mt(OI.prototype,"missColor",[jN],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return new X(200,50,50,255)}}),LI=OI))||LI);t._RF.pop(),t._RF.push({},"974fdPppslMoKLXs565FEx6","MTUIManager",void 0);var QN,$N,tL,eL,iL,nL,rL,oL,aL,sL,lL,cL,uL,hL,pL,dL,fL,gL,mL,vL,yL,bL,_L,SL,wL,TL=e.ccclass,EL=e.property,AL=function(t){return t[t.NONE=0]="NONE",t[t.MAIN_MENU=1]="MAIN_MENU",t[t.SONG_SELECT=2]="SONG_SELECT",t[t.GAMEPLAY=3]="GAMEPLAY",t[t.PAUSE_MENU=4]="PAUSE_MENU",t[t.RESULTS=5]="RESULTS",t[t.SETTINGS=6]="SETTINGS",t[t.TUTORIAL=7]="TUTORIAL",t[t.SHOP=8]="SHOP",t}({}),CL=(KI=TL("MTUIManager"),XI=EL(c),JI=EL(c),QI=EL(c),$I=EL(c),tN=EL(c),eN=EL(c),iN=EL(c),nN=EL(c),rN=EL(c),oN=EL(y),aN=EL(y),sN=EL(y),lN=EL(ut),cN=EL(f),uN=EL(y),hN=EL(y),pN=EL(y),dN=EL(y),fN=EL(y),gN=EL(y),mN=EL(y),vN=EL(y),yN=EL(y),KI(((ZN=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return e=t.call.apply(t,[this].concat(n))||this,Nt(e,"mainMenuScreen",SN,Lt(e)),Nt(e,"songSelectScreen",wN,Lt(e)),Nt(e,"gameplayScreen",TN,Lt(e)),Nt(e,"pauseMenuScreen",EN,Lt(e)),Nt(e,"resultsScreen",AN,Lt(e)),Nt(e,"settingsScreen",CN,Lt(e)),Nt(e,"tutorialScreen",PN,Lt(e)),Nt(e,"shopScreen",MN,Lt(e)),Nt(e,"loadingScreen",IN,Lt(e)),Nt(e,"scoreLabel",NN,Lt(e)),Nt(e,"songTimeLabel",LN,Lt(e)),Nt(e,"comboLabel",ON,Lt(e)),Nt(e,"progressBar",RN,Lt(e)),Nt(e,"healthBar",xN,Lt(e)),Nt(e,"songTitleLabel",FN,Lt(e)),Nt(e,"songArtistLabel",DN,Lt(e)),Nt(e,"finalScoreLabel",zN,Lt(e)),Nt(e,"accuracyLabel",kN,Lt(e)),Nt(e,"maxComboLabel",VN,Lt(e)),Nt(e,"perfectCountLabel",BN,Lt(e)),Nt(e,"goodCountLabel",HN,Lt(e)),Nt(e,"okCountLabel",UN,Lt(e)),Nt(e,"missCountLabel",GN,Lt(e)),Nt(e,"transitionDuration",WN,Lt(e)),Nt(e,"popupScaleDuration",qN,Lt(e)),e.currentUIState=AL.NONE,e.previousUIState=AL.NONE,e.isTransitioning=!1,e.audioManager=null,e.screenWidth=0,e.screenHeight=0,e.safeAreaTop=0,e.safeAreaBottom=0,e.isPortrait=!0,e}It(e,t);var i=e.prototype;return i.onLoad=function(){e._instance=this,this.audioManager=wI.instance,this.initializeUI(),Y.on("design-resolution-changed",this.onScreenResize,this),Y.on("canvas-resize",this.onScreenResize,this),this.onScreenResize()},i.onDestroy=function(){Y.off("design-resolution-changed",this.onScreenResize,this),Y.off("canvas-resize",this.onScreenResize,this),e._instance===this&&(e._instance=null)},i.initializeUI=function(){this.hideAllScreens(),this.changeUIState(AL.MAIN_MENU)},i.onScreenResize=function(){var t=Y.getVisibleSize();if(this.screenWidth=t.width,this.screenHeight=t.height,this.isPortrait=this.screenHeight>this.screenWidth,S.platform===S.Platform.MOBILE_BROWSER||S.platform===S.Platform.IOS||S.platform===S.Platform.ANDROID){var e=S.getSafeAreaRect();this.safeAreaTop=e.y,this.safeAreaBottom=t.height-(e.y+e.height)}this.adjustLayoutForScreenSize()},i.adjustLayoutForScreenSize=function(){this.updateWidgetsInNode(this.node),this.isPortrait?this.applyPortraitLayout():this.applyLandscapeLayout()},i.applyPortraitLayout=function(){if(this.scoreLabel&&(this.scoreLabel.node.position=new g(0,.4*this.screenHeight,0)),this.comboLabel&&(this.comboLabel.node.position=new g(0,.3*this.screenHeight,0)),this.progressBar){var t=this.progressBar.getComponent(B);t&&(t.width=.8*this.screenWidth)}console.log("Applied portrait layout")},i.applyLandscapeLayout=function(){if(this.scoreLabel&&(this.scoreLabel.node.position=new g(.3*this.screenWidth,.4*this.screenHeight,0)),this.comboLabel&&(this.comboLabel.node.position=new g(.3*this.screenWidth,.3*this.screenHeight,0)),this.progressBar){var t=this.progressBar.getComponent(B);t&&(t.width=.6*this.screenWidth)}console.log("Applied landscape layout")},i.updateWidgetsInNode=function(t){var e=t.getComponent(Z);e&&e.updateAlignment();for(var i=0;i<t.children.length;i++)this.updateWidgetsInNode(t.children[i])},i.changeUIState=function(t){var e=this;if(!this.isTransitioning&&t!==this.currentUIState){this.isTransitioning=!0,this.previousUIState=this.currentUIState,this.currentUIState=t;var i=this.getScreenForState(this.previousUIState);if(i)v(i).to(this.transitionDuration/2,{scale:new g(.9,.9,1)}).call((function(){i.active=!1;var n=e.getScreenForState(t);n?(n.active=!0,n.scale=new g(.9,.9,1),v(n).to(e.transitionDuration/2,{scale:new g(1,1,1)}).call((function(){e.isTransitioning=!1,e.onUIStateChanged(t)})).start()):e.isTransitioning=!1})).start();else{var n=this.getScreenForState(t);n?(n.active=!0,n.scale=new g(.9,.9,1),v(n).to(this.transitionDuration/2,{scale:new g(1,1,1)}).call((function(){e.isTransitioning=!1,e.onUIStateChanged(t)})).start()):this.isTransitioning=!1}}},i.getScreenForState=function(t){switch(t){case AL.MAIN_MENU:return this.mainMenuScreen;case AL.SONG_SELECT:return this.songSelectScreen;case AL.GAMEPLAY:return this.gameplayScreen;case AL.PAUSE_MENU:return this.pauseMenuScreen;case AL.RESULTS:return this.resultsScreen;case AL.SETTINGS:return this.settingsScreen;case AL.TUTORIAL:return this.tutorialScreen;case AL.SHOP:return this.shopScreen;default:return null}},i.onUIStateChanged=function(t){switch(t){case AL.MAIN_MENU:this.audioManager.playSound("menu_music");break;case AL.SONG_SELECT:break;case AL.GAMEPLAY:this.updateGameplayUI();break;case AL.RESULTS:}},i.hideAllScreens=function(){this.mainMenuScreen&&(this.mainMenuScreen.active=!1),this.songSelectScreen&&(this.songSelectScreen.active=!1),this.gameplayScreen&&(this.gameplayScreen.active=!1),this.pauseMenuScreen&&(this.pauseMenuScreen.active=!1),this.resultsScreen&&(this.resultsScreen.active=!1),this.settingsScreen&&(this.settingsScreen.active=!1),this.tutorialScreen&&(this.tutorialScreen.active=!1),this.shopScreen&&(this.shopScreen.active=!1),this.loadingScreen&&(this.loadingScreen.active=!1)},i.showLoadingScreen=function(t){this.loadingScreen&&(this.loadingScreen.active=t)},i.updateGameplayUI=function(){},i.updateScoreDisplay=function(t){this.scoreLabel&&(this.scoreLabel.string=t.toLocaleString())},i.updateSongTimeDisplay=function(t){this.songTimeLabel&&(this.songTimeLabel.string=this.formatTime(t))},i.formatTime=function(t){var e=Math.floor(t/60),i=Math.floor(t%60);return e+":"+(i<10?"0"+i:i)},i.updateComboDisplay=function(t){this.comboLabel&&(t>1?(this.comboLabel.string=t+"x",this.comboLabel.node.active=!0,v(this.comboLabel.node).to(.1,{scale:new g(1.2,1.2,1)}).to(.1,{scale:new g(1,1,1)}).start()):(this.comboLabel.string="",this.comboLabel.node.active=!1))},i.updateProgressBar=function(t){this.progressBar&&(this.progressBar.progress=t)},i.updateHealthBar=function(t){},i.prepareResultsScreen=function(t,e,i,n){if(void 0===t&&(t=0),void 0===e&&(e=0),void 0===i&&(i=0),void 0===n&&(n={perfect:0,good:0,ok:0,miss:0}),this.resultsScreen){this.finalScoreLabel&&(this.finalScoreLabel.string=t.toLocaleString()),this.accuracyLabel&&(this.accuracyLabel.string=e.toFixed(2)+"%"),this.maxComboLabel&&(this.maxComboLabel.string=i+"x"),this.perfectCountLabel&&(this.perfectCountLabel.string=n.perfect.toString()),this.goodCountLabel&&(this.goodCountLabel.string=n.good.toString()),this.okCountLabel&&(this.okCountLabel.string=n.ok.toString()),this.missCountLabel&&(this.missCountLabel.string=n.miss.toString());var r=this.resultsScreen.getChildByName("HighScoreLabel");r&&(r.active=!1)}},i.showPopup=function(t,e,i){var n,r,o,a;void 0===e&&(e=""),void 0===i&&(i="OK");var s=this.node.getChildByName("PopupTemplate");if(s){var l=A(s);l.parent=this.node,l.active=!0;var c=null==(n=l.getChildByName("Title"))?void 0:n.getComponent(y),u=null==(r=l.getChildByName("Message"))?void 0:r.getComponent(y),h=null==(o=l.getChildByName("OkButton"))?void 0:o.getComponent(x),p=null==h||null==(a=h.node.getChildByName("Label"))?void 0:a.getComponent(y);if(c&&(c.string=e,c.node.active=e.length>0),u&&(u.string=t),p&&(p.string=i),h){var d=new F;d.target=l,d.component="UIManager",d.handler="onPopupButtonClicked",h.clickEvents.push(d)}return l.scale=new g(.8,.8,1),v(l).to(this.popupScaleDuration,{scale:new g(1,1,1)}).start(),l}},i.closePopup=function(t){v(t).to(this.popupScaleDuration,{scale:new g(.8,.8,1)}).call((function(){t.destroy()})).start()},i.onPopupButtonClicked=function(t,e){var i=t.target;if(i){var n=i.parent;n&&this.closePopup(n)}},i.navigateToMainMenu=function(){this.changeUIState(AL.MAIN_MENU)},i.navigateToSongSelect=function(){this.changeUIState(AL.SONG_SELECT)},i.navigateToSettings=function(){this.changeUIState(AL.SETTINGS)},i.navigateToTutorial=function(){this.changeUIState(AL.TUTORIAL)},i.navigateToShop=function(){this.changeUIState(AL.SHOP)},i.handleBackNavigation=function(){switch(this.currentUIState){case AL.SONG_SELECT:case AL.SETTINGS:case AL.TUTORIAL:case AL.SHOP:this.navigateToMainMenu();break;case AL.GAMEPLAY:case AL.PAUSE_MENU:break;case AL.RESULTS:this.navigateToSongSelect()}},xt(e,null,[{key:"instance",get:function(){return e._instance?e._instance:null}}]),e}(o))._instance=null,SN=Mt((_N=ZN).prototype,"mainMenuScreen",[XI],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),wN=Mt(_N.prototype,"songSelectScreen",[JI],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),TN=Mt(_N.prototype,"gameplayScreen",[QI],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),EN=Mt(_N.prototype,"pauseMenuScreen",[$I],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),AN=Mt(_N.prototype,"resultsScreen",[tN],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),CN=Mt(_N.prototype,"settingsScreen",[eN],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),PN=Mt(_N.prototype,"tutorialScreen",[iN],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),MN=Mt(_N.prototype,"shopScreen",[nN],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),IN=Mt(_N.prototype,"loadingScreen",[rN],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),NN=Mt(_N.prototype,"scoreLabel",[oN],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),LN=Mt(_N.prototype,"songTimeLabel",[aN],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ON=Mt(_N.prototype,"comboLabel",[sN],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),RN=Mt(_N.prototype,"progressBar",[lN],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),xN=Mt(_N.prototype,"healthBar",[cN],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),FN=Mt(_N.prototype,"songTitleLabel",[uN],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),DN=Mt(_N.prototype,"songArtistLabel",[hN],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),zN=Mt(_N.prototype,"finalScoreLabel",[pN],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),kN=Mt(_N.prototype,"accuracyLabel",[dN],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),VN=Mt(_N.prototype,"maxComboLabel",[fN],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),BN=Mt(_N.prototype,"perfectCountLabel",[gN],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),HN=Mt(_N.prototype,"goodCountLabel",[mN],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),UN=Mt(_N.prototype,"okCountLabel",[vN],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),GN=Mt(_N.prototype,"missCountLabel",[yN],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),WN=Mt(_N.prototype,"transitionDuration",[EL],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.3}}),qN=Mt(_N.prototype,"popupScaleDuration",[EL],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.2}}),bN=_N))||bN);t._RF.pop(),t._RF.push({},"bf871T6LV9LXZ2T/yZkKnKK","TileManager",void 0);var PL,ML,IL,NL,LL,OL,RL=e.ccclass,xL=e.property,FL=(QN=RL("TileManager"),$N=xL({type:l,tooltip:"Reference to the tile prefab",group:{name:"References",id:"1"}}),tL=xL({type:[c],tooltip:"Lane container nodes",group:{name:"References",id:"1"}}),eL=xL({tooltip:"Tile spawn position (Y coordinate)",group:{name:"Position Settings",id:"2"}}),iL=xL({tooltip:"Tile target position (Y coordinate - the hit zone)",group:{name:"Position Settings",id:"2"}}),nL=xL({tooltip:"Position where tiles should be recycled",group:{name:"Position Settings",id:"2"}}),rL=xL({tooltip:"Position threshold for missed tiles",group:{name:"Position Settings",id:"2"}}),oL=xL({tooltip:"How many seconds ahead to spawn tiles",group:{name:"Gameplay Settings",id:"3"}}),aL=xL({tooltip:"Default scroll speed (pixels per second)",group:{name:"Gameplay Settings",id:"3"}}),sL=xL({tooltip:"Width of a lane",group:{name:"Gameplay Settings",id:"3"}}),lL=xL({tooltip:"Maximum number of tiles to pool",group:{name:"Gameplay Settings",id:"3"}}),cL=xL({tooltip:"Enable autoplay mode",group:{name:"Gameplay Settings",id:"3"}}),QN((pL=Mt((hL=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return e=t.call.apply(t,[this].concat(n))||this,Nt(e,"tilePrefab",pL,Lt(e)),Nt(e,"laneContainers",dL,Lt(e)),Nt(e,"spawnPositionY",fL,Lt(e)),Nt(e,"targetPositionY",gL,Lt(e)),Nt(e,"recyclePositionY",mL,Lt(e)),Nt(e,"missThreshold",vL,Lt(e)),Nt(e,"lookAheadTime",yL,Lt(e)),Nt(e,"defaultScrollSpeed",bL,Lt(e)),Nt(e,"laneWidth",_L,Lt(e)),Nt(e,"maxPoolSize",SL,Lt(e)),Nt(e,"isAutoplay",wL,Lt(e)),e.scrollSpeed=600,e.beatmapManager=null,e.audioManager=null,e.tilePool=[],e.activeTiles=[],e.nextNoteIndex=0,e.gameTime=0,e.gameState="stopped",e._updateScheduled=!1,e.touchedTiles=new Map,e.minTileHeight=300,e.tempVec3=new g,e.lanePositionVec3=new g,e.tilePositionsY=null,e.tileIndices=new Map,e.nextTileIndex=0,e}It(e,t);var i=e.prototype;return i.onLoad=function(){this.beatmapManager||(this.beatmapManager=jI.instance),this.audioManager||(this.audioManager=wI.instance),this.initTilePool()},i.start=function(){this.ensureLaneContainers()},i.update=function(t){"playing"===this.gameState&&(this.gameTime=this.audioManager.getEstimatedAudioTime(),Math.random()<.03&&CL.instance.updateSongTimeDisplay(this.gameTime),this.spawnTiles(),this.balancedUpdateActiveTiles())},i.initialize=function(t,e){this.beatmapManager=t,this.audioManager=e,this.initTilePool()},i.initTilePool=function(){var t;this.tilePool=[];var e=null==(t=this.beatmapManager)?void 0:t.getNotes();if(e&&e.length>0){var i=this.spawnPositionY-this.recyclePositionY,n=e[e.length-1].time-e[0].time,r=this.scrollSpeed||this.defaultScrollSpeed,o=Math.ceil(e.length*(i/(r*Math.max(.1,n))));this.maxPoolSize=Math.max(this.maxPoolSize,o+10),console.log("Dynamic pool size calculated: "+this.maxPoolSize+" (estimated visible: "+o+")")}for(var a=0;a<this.maxPoolSize;a++){var s=A(this.tilePrefab),l=s.getComponent(JN);s.active=!1,this.tilePool.push(l)}this.tilePositionsY=new Float32Array(this.maxPoolSize),this.tileIndices=new Map,this.nextTileIndex=0},i.ensureLaneContainers=function(){if(this.laneContainers.length<4){console.warn("TileManager needs 4 lane containers, but only "+this.laneContainers.length+" were provided.");for(var t=this.laneContainers.length;t<4;t++){var e=new c("Lane_"+t);e.parent=this.node,this.lanePositionVec3.set((t-2+.5)*this.laneWidth,0,0),e.position=this.lanePositionVec3,this.laneContainers.push(e)}}this.laneWidth=this.laneContainers[0].getComponent(B).width},i.initGame=function(){this.clearActiveTiles(),this.nextNoteIndex=0,this.gameTime=0,this.activeTiles=[],this.touchedTiles.clear(),this.calculateDynamicScrollSpeed()},i.startGame=function(){this.gameState="playing",this._updateScheduled||(M.getScheduler().schedule(this.update,this,0),this._updateScheduled=!0)},i.stopGame=function(){this.gameState="stopped",this._updateScheduled&&(M.getScheduler().unschedule(this.update,this),this._updateScheduled=!1),this.clearActiveTiles()},i.pauseGame=function(){this.gameState="paused"},i.resumeGame=function(){this.gameState="playing",this._updateScheduled||(M.getScheduler().schedule(this.update,this,0),this._updateScheduled=!0)},i.spawnTiles=function(){var t=this.beatmapManager.getNotes();if(t.length)for(var e=this.gameTime+this.lookAheadTime;this.nextNoteIndex<t.length&&t[this.nextNoteIndex].time<=e;)this.spawnTile(t[this.nextNoteIndex]),this.nextNoteIndex++},i.updateTilePosition=function(t,e){this.tempVec3.set(0,e,0),t.node.position=this.tempVec3},i.spawnTile=function(t){var e=this.getTileFromPool();if(e){var i=t.lane;if(i<0||i>=this.laneContainers.length)console.error("Invalid lane "+i+" for note "+t.midi);else{var n=this.laneContainers[i];e.node.parent=n,e.init(t,i,this.spawnPositionY,this.targetPositionY,this.laneWidth,this.scrollSpeed,this.minTileHeight),e.setBufferHeight(this.minTileHeight/2);var r=this.nextTileIndex%this.maxPoolSize;this.tileIndices.set(e,r),this.tilePositionsY[r]=this.spawnPositionY,this.nextTileIndex++,this.updateTilePosition(e,this.spawnPositionY);var o=this.spawnPositionY-this.recyclePositionY+e.getTileHeight()+500,a=(this.spawnPositionY-this.targetPositionY)/this.scrollSpeed,s=o/this.scrollSpeed,l=t.time-a;if(l<=this.gameTime)e.startMovement(s,l);else{var c=l-this.gameTime;this.scheduleOnce((function(){e.node.active&&e.startMovement(s,l)}),c)}this.activeTiles.push(e)}}else console.warn("Tile pool exhausted, cannot spawn more tiles")},i.balancedUpdateActiveTiles=function(){this.isAutoplay&&this.handleAutoplay();for(var t=0;t<this.activeTiles.length;){var e=this.activeTiles[t];if(e.getStatus()===KN.ACTIVE&&e.node.position.y<=this.missThreshold&&e.miss(),e.node.position.y+e.getTileHeight()<=this.recyclePositionY){e.getStatus()===KN.HOLDING&&e.isLongPressType()&&e.release(this.gameTime),this.returnTileToPool(e),this.activeTiles[t]=this.activeTiles[this.activeTiles.length-1],this.activeTiles.pop();break}t++}},i.handleAutoplay=function(){var t=this;if(this.isAutoplay){for(var e,i=this.activeTiles.filter((function(e){if(e.getStatus()!==KN.ACTIVE)return!1;var i=e.getNote();return!!i&&i.time-t.gameTime<=.05})),n=Ft(i);!(e=n()).done;){var r=e.value,o=r.getLane();if(r.getNote())if(r.isLongPressType()){if(!this.touchedTiles.has(o))r.tap(this.gameTime)!==XN.MISS&&this.touchedTiles.set(o,r)}else r.tap(this.gameTime)}this.touchedTiles.forEach((function(e,i){var n=e.getNote();n&&e.getStatus()===KN.HOLDING?n.time+n.duration<=t.gameTime&&(e.release(t.gameTime),t.touchedTiles.delete(i)):t.touchedTiles.delete(i)}))}},i.toggleAutoplay=function(t){this.isAutoplay=void 0!==t?t:!this.isAutoplay,console.log("Autoplay "+(this.isAutoplay?"enabled":"disabled"))},i.isAutoplayEnabled=function(){return this.isAutoplay},i.clearActiveTiles=function(){for(var t,e=Ft(this.activeTiles);!(t=e()).done;){var i=t.value;this.returnTileToPool(i)}this.activeTiles=[]},i.getTileFromPool=function(){if(0===this.tilePool.length)return this.activeTiles.length<this.maxPoolSize?A(this.tilePrefab).getComponent(JN):null;var t=this.tilePool.pop();return t.node.active=!0,t},i.returnTileToPool=function(t){var e=t.getLane();this.touchedTiles.has(e)&&this.touchedTiles.get(e)===t&&(t.getStatus()===KN.HOLDING&&t.release(this.gameTime),this.touchedTiles.delete(e)),t.recycle(),this.tilePool.push(t),this.tileIndices.delete(t)},i.handleLaneTouch=function(t,e){var i=this;if(!e){var n=this.touchedTiles.get(t);if(n&&n.isLongPressType())return this.touchedTiles.delete(t),n.release(this.gameTime)}var r=this.activeTiles.filter((function(e){return e.getLane()===t&&e.getStatus()===KN.ACTIVE}));if(r.sort((function(t,e){var n=t.getNote(),r=e.getNote();return n&&r?Math.abs(n.time-i.gameTime)-Math.abs(r.time-i.gameTime):0})),0===r.length)return XN.MISS;var o=r[0];if(e){var a=o.tap(this.gameTime);return o.isLongPressType()&&a!==XN.MISS&&this.touchedTiles.set(t,o),a}return XN.MISS},i.setScrollSpeed=function(t){this.scrollSpeed;this.scrollSpeed=t},i.getScrollSpeed=function(){return this.scrollSpeed},i.calculateDynamicScrollSpeed=function(){var t=this.beatmapManager.getNotes();if(!t||t.length<2)this.scrollSpeed=this.defaultScrollSpeed;else{for(var e=.5*this.defaultScrollSpeed,i=1.5*this.defaultScrollSpeed,n=!0,r=1;r<t.length;r++)if(t[r].time<t[r-1].time){n=!1;break}for(var o=n?t:[].concat(t).sort((function(t,e){return t.time-e.time})),a=Number.MAX_VALUE,s=0,l=0,c=0,u=1;u<o.length;u++){var h=o[u].time-o[u-1].time;h>0&&(h<a&&(a=h),s+=h,l++);var p=o[u].duration;p>c&&(c=p)}var d=l>0?s/l:1;a===Number.MAX_VALUE&&(a=1);var f=Math.min(1,.7*a+.3),g=Math.min(1,.5*d+.5),m=1;c>0&&(m=Math.max(.7,1-.1*c));var v=e+(i-e)*(.6*f+.25*g+.15*m);this.setScrollSpeed(2.5*v)}},i.setupBeginningTile=function(){this.clearActiveTiles(),this.gameState="paused";var t=Math.min(Math.floor(this.laneContainers.length/2),this.laneContainers.length-1);this.createBeginningTile(t)},i.createBeginningTile=function(t){var e=this.getTileFromPool();if(e){var i={midi:60,time:0,lane:t,type:0,duration:.3,durationTicks:0,velocity:100},n=this.laneContainers[t];e.node.parent=n;var r=this.targetPositionY;e.init(i,t,r,r,this.laneWidth,this.scrollSpeed,this.minTileHeight),e.setBufferHeight(this.minTileHeight/2),e.setBeginningNodeActive(!0),e.node.name="beginning_tile",this.activeTiles.push(e)}else console.error("Failed to create beginning tile - pool empty")},i.checkBeginningTileTap=function(t){for(var e=0;e<this.activeTiles.length;e++){var i=this.activeTiles[e];if("beginning_tile"===i.node.name&&i.getLane()===t)return i.startMovement(1,this.gameTime),!0}return!1},i.getActiveTileCount=function(){return this.activeTiles.length},i.getGameTime=function(){return this.gameTime},i.setGameTime=function(t){this.gameTime=t},i.removeTile=function(t){var e=this.activeTiles.indexOf(t);e>=0&&this.activeTiles.splice(e,1),this.returnTileToPool(t)},e}(o)).prototype,"tilePrefab",[$N],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),dL=Mt(hL.prototype,"laneContainers",[tL],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),fL=Mt(hL.prototype,"spawnPositionY",[eL],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1200}}),gL=Mt(hL.prototype,"targetPositionY",[iL],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-400}}),mL=Mt(hL.prototype,"recyclePositionY",[nL],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-1500}}),vL=Mt(hL.prototype,"missThreshold",[rL],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-450}}),yL=Mt(hL.prototype,"lookAheadTime",[oL],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 4}}),bL=Mt(hL.prototype,"defaultScrollSpeed",[aL],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 600}}),_L=Mt(hL.prototype,"laneWidth",[sL],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 160}}),SL=Mt(hL.prototype,"maxPoolSize",[lL],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 50}}),wL=Mt(hL.prototype,"isAutoplay",[cL],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),uL=hL))||uL);t._RF.pop(),t._RF.push({},"7032aoU25dAwZKrnbS2Peig","TapValidator",void 0);var DL,zL,kL,VL,BL,HL,UL,GL,WL,qL,ZL,YL,jL,KL,XL,JL,QL,$L,tO=e.ccclass,eO=e.property,iO=tO("TapValidator")((IL=Mt((ML=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return e=t.call.apply(t,[this].concat(n))||this,Nt(e,"audioOffset",IL,Lt(e)),Nt(e,"perfectWindow",NL,Lt(e)),Nt(e,"goodWindow",LL,Lt(e)),Nt(e,"okWindow",OL,Lt(e)),e.beatmapManager=null,e.combo={count:0,maxCount:0,lastRating:XN.MISS,perfectCount:0,goodCount:0,okCount:0,missCount:0},e.onComboChangeCallbacks=[],e.onRatingCallbacks=[],e}It(e,t);var i=e.prototype;return i.onLoad=function(){this.resetCombo(),this.beatmapManager=jI.instance},i.validateTap=function(t,e,i){return this.updateCombo(i),this.onRatingCallbacks.forEach((function(e){return e(t,i)})),i},i.updateCombo=function(t){var e=this;switch(t){case XN.PERFECT:this.combo.perfectCount++,this.combo.count++;break;case XN.GREAT:this.combo.goodCount++,this.combo.count=0;break;case XN.COOL:this.combo.okCount++,this.combo.count=0;break;case XN.MISS:this.combo.missCount++,this.combo.count=0}this.combo.count>this.combo.maxCount&&(this.combo.maxCount=this.combo.count),this.combo.lastRating=t,this.onComboChangeCallbacks.forEach((function(t){return t(e.combo.count)}))},i.resetCombo=function(){this.combo={count:0,maxCount:0,lastRating:XN.MISS,perfectCount:0,goodCount:0,okCount:0,missCount:0},this.onComboChangeCallbacks.forEach((function(t){return t(0)}))},i.getCombo=function(){return this.combo.count},i.getMaxCombo=function(){return this.combo.maxCount},i.getAccuracy=function(){var t=this.combo.perfectCount+this.combo.goodCount+this.combo.okCount+this.combo.missCount;if(0===t)return 100;var e=100*this.combo.perfectCount+80*this.combo.goodCount+50*this.combo.okCount;return Math.round(e/(100*t)*100)},i.getRatingCounts=function(){return{perfect:this.combo.perfectCount,good:this.combo.goodCount,ok:this.combo.okCount,miss:this.combo.missCount}},i.getTotalNotes=function(){return this.combo.perfectCount+this.combo.goodCount+this.combo.okCount+this.combo.missCount},i.onComboChange=function(t){this.onComboChangeCallbacks.push(t)},i.offComboChange=function(t){var e=this.onComboChangeCallbacks.indexOf(t);-1!==e&&this.onComboChangeCallbacks.splice(e,1)},i.onRating=function(t){this.onRatingCallbacks.push(t)},i.offRating=function(t){var e=this.onRatingCallbacks.indexOf(t);-1!==e&&this.onRatingCallbacks.splice(e,1)},i.setAudioOffset=function(t){this.audioOffset=t},i.getAudioOffset=function(){return this.audioOffset},i.setHitWindows=function(t,e,i){this.perfectWindow=t,this.goodWindow=e,this.okWindow=i},i.isComboMilestone=function(t){return this.combo.count===t},i.calculateScore=function(){var t=Math.min(this.combo.maxCount/10,100),e=this.getAccuracy(),i=1e3*this.combo.perfectCount+500*this.combo.goodCount+100*this.combo.okCount;return Math.round(i*(1+t/100+e/100))},e}(o)).prototype,"audioOffset",[eO],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),NL=Mt(ML.prototype,"perfectWindow",[eO],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.05}}),LL=Mt(ML.prototype,"goodWindow",[eO],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.1}}),OL=Mt(ML.prototype,"okWindow",[eO],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.15}}),PL=ML))||PL;t._RF.pop(),t._RF.push({},"19aa5JfAPNMBLEL5AtzqFm7","InputManager",void 0);var nO,rO,oO,aO,sO,lO,cO,uO,hO,pO,dO,fO,gO,mO,vO,yO,bO,_O,SO,wO,TO,EO,AO,CO,PO,MO,IO,NO,LO=e.ccclass,OO=e.property,RO=(DL=LO("InputManager"),zL=OO([c]),kL=OO(c),VL=OO(c),BL=OO(FL),HL=OO(iO),UL=OO(B),GL=OO(_t),DL((ZL=Mt((qL=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return e=t.call.apply(t,[this].concat(n))||this,Nt(e,"tapFeedbackNodes",ZL,Lt(e)),Nt(e,"hitLineNode",YL,Lt(e)),Nt(e,"laneContainer",jL,Lt(e)),Nt(e,"tileManager",KL,Lt(e)),Nt(e,"tapValidator",XL,Lt(e)),Nt(e,"canvasTransform",JL,Lt(e)),Nt(e,"camera",QL,Lt(e)),Nt(e,"tapFeedbackDuration",$L,Lt(e)),e.isEnabled=!0,e.laneWidth=0,e.laneCount=4,e.laneStartX=0,e.activeTouches=new Map,e.nodeOpacities=[],e._laneTapCallback=null,e.activeKeyLanes=new Map,e.transNode=null,e}It(e,t);var i=e.prototype;return i.onLoad=function(){this.initTapFeedback(),this.transNode=this.node.getComponent(B),this.registerEvents()},i.start=function(){this.initLaneInfo()},i.initLaneInfo=function(){if(this.laneContainer){var t=this.laneContainer.getComponent(B);t?(this.laneCount=4,this.laneWidth=t.width/this.laneCount,this.laneStartX=this.canvasTransform.width/2-t.width/2):console.error("Lane container doesn't have a UITransform component")}else console.error("Lane container is not assigned to InputManager")},i.initTapFeedback=function(){if(this.tapFeedbackNodes.length<this.laneCount){console.warn("Need "+this.laneCount+" tap feedback nodes, but only "+this.tapFeedbackNodes.length+" were provided.");for(var t=this.tapFeedbackNodes.length;t<this.laneCount;t++){var e=new c("TapFeedback_"+t);e.parent=this.node,e.addComponent(f).color=new X(255,255,255,120);var i=e.addComponent(b);i.opacity=0,this.nodeOpacities.push(i),this.tapFeedbackNodes.push(e)}}for(var n=0;n<this.laneCount;n++){var r=this.tapFeedbackNodes[n],o=r.getComponent(B)||r.addComponent(B);o.width=.9*this.laneWidth,o.height=100;var a=this.laneStartX+(n+.5)*this.laneWidth,s=this.hitLineNode?this.hitLineNode.position.y:0;r.position=new g(a,s,0)}},i.registerEvents=function(){D.on(z.EventType.TOUCH_START,this.onTouchStart,this),D.on(z.EventType.TOUCH_MOVE,this.onTouchMove,this),D.on(z.EventType.TOUCH_END,this.onTouchEnd,this),D.on(z.EventType.TOUCH_CANCEL,this.onTouchCancel,this),D.on(z.EventType.KEY_DOWN,this.onKeyDown,this),D.on(z.EventType.KEY_UP,this.onKeyUp,this)},i.onDestroy=function(){D.off(z.EventType.TOUCH_START,this.onTouchStart,this),D.off(z.EventType.TOUCH_MOVE,this.onTouchMove,this),D.off(z.EventType.TOUCH_END,this.onTouchEnd,this),D.off(z.EventType.TOUCH_CANCEL,this.onTouchCancel,this),D.off(z.EventType.KEY_DOWN,this.onKeyDown,this),D.off(z.EventType.KEY_UP,this.onKeyUp,this)},i.onTouchStart=function(t){if(this.isEnabled)for(var e,i=t.getTouches(),n=Ft(i);!(e=n()).done;){var r=e.value,o=r.getLocation(),a=this.convertToWorldSpace(o.x,o.y),s=this.getLaneFromPosition(a.x);if(s>=0){var l={id:r.getID(),lane:s,startTime:Date.now()/1e3,position:a,active:!0,node:this.tapFeedbackNodes[s]};this.activeTouches.set(r.getID(),l),this.showTapFeedback(s),this._laneTapCallback&&this._laneTapCallback(s);var c=this.tileManager.getGameTime(),u=this.tileManager.handleLaneTouch(s,!0);this.tapValidator.validateTap(s,c,u)}}},i.onTouchMove=function(t){this.isEnabled},i.onTouchEnd=function(t){if(this.isEnabled)for(var e,i=t.getTouches(),n=Ft(i);!(e=n()).done;){var r=e.value.getID();if(this.activeTouches.has(r)){var o=this.activeTouches.get(r);this.tileManager.getGameTime(),this.tileManager.handleLaneTouch(o.lane,!1);this.hideTapFeedback(o.lane),this.activeTouches.delete(r)}}},i.onTouchCancel=function(t){this.onTouchEnd(t)},i.onMouseDown=function(t){if(this.isEnabled){var e=t.getLocation(),i=this.convertToWorldSpace(e.x,e.y),n=this.getLaneFromPosition(i.x);if(n>=0){var r={id:0,lane:n,startTime:Date.now()/1e3,position:i,active:!0,node:this.tapFeedbackNodes[n]};this.activeTouches.set(0,r),this.showTapFeedback(n);var o=this.tileManager.getGameTime(),a=this.tileManager.handleLaneTouch(n,!0);this.tapValidator.validateTap(n,o,a)}}},i.onMouseMove=function(t){if(this.isEnabled&&this.activeTouches.has(0)){var e=this.activeTouches.get(0),i=t.getLocation(),n=this.convertToWorldSpace(i.x,i.y);e.position=n;var r=this.getLaneFromPosition(n.x);if(r>=0&&r!==e.lane){this.tileManager.handleLaneTouch(e.lane,!1),this.hideTapFeedback(e.lane),e.lane=r,e.node=this.tapFeedbackNodes[r],this.showTapFeedback(r);var o=this.tileManager.getGameTime(),a=this.tileManager.handleLaneTouch(r,!0);this.tapValidator.validateTap(r,o,a)}}},i.onMouseUp=function(t){if(this.isEnabled&&this.activeTouches.has(0)){var e=this.activeTouches.get(0);this.tileManager.getGameTime(),this.tileManager.handleLaneTouch(e.lane,!1);this.hideTapFeedback(e.lane),this.activeTouches.delete(0)}},i.showTapFeedback=function(t){var e=this;if(!(t<0||t>=this.tapFeedbackNodes.length)){var i=this.nodeOpacities[t];i&&(i.opacity=255,this.scheduleOnce((function(){e.hideTapFeedback(t)}),this.tapFeedbackDuration))}},i.hideTapFeedback=function(t){if(!(t<0||t>=this.tapFeedbackNodes.length)){var e=this.nodeOpacities[t];e&&(e.opacity=0)}},i.convertToWorldSpace=function(t,e){var i=this.camera;if(!i){var n=this.transNode.width,r=this.transNode.height;return new g(t-n/2,e-r/2,0)}var o=new g(t,e,0);return i.screenToWorld(o)},i.getLaneFromPosition=function(t){var e=t-this.laneStartX;return e<0||e>=this.laneWidth*this.laneCount?-1:Math.floor(e/this.laneWidth)},i.setEnabled=function(t){if(this.isEnabled=t,!t){this.activeTouches.clear();for(var e=0;e<this.tapFeedbackNodes.length;e++)this.hideTapFeedback(e)}},i.isInputEnabled=function(){return this.isEnabled},i.getActiveTouchInLane=function(t){for(var e,i=Ft(this.activeTouches);!(e=i()).done;){var n=e.value,r=(n[0],n[1]);if(r.lane===t)return r}return null},i.getActiveTouchCount=function(){return this.activeTouches.size},i.onLaneTap=function(t){this._laneTapCallback=t},i.removeOnLaneTap=function(t){this._laneTapCallback===t&&(this._laneTapCallback=null)},i.onKeyDown=function(t){if(this.isEnabled){var e=-1;switch(t.keyCode){case R.KEY_A:e=0;break;case R.KEY_S:e=1;break;case R.KEY_D:e=2;break;case R.KEY_F:e=3}if(e>=0&&e<this.laneCount){this.activeKeyLanes.set(t.keyCode,e),this.showTapFeedback(e),this._laneTapCallback&&this._laneTapCallback(e);var i=this.tileManager.getGameTime(),n=this.tileManager.handleLaneTouch(e,!0);this.tapValidator.validateTap(e,i,n)}}},i.onKeyUp=function(t){if(this.isEnabled&&this.activeKeyLanes.has(t.keyCode)){var e=this.activeKeyLanes.get(t.keyCode);this.tileManager.getGameTime(),this.tileManager.handleLaneTouch(e,!1);this.hideTapFeedback(e),this.activeKeyLanes.delete(t.keyCode)}},e}(o)).prototype,"tapFeedbackNodes",[zL],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),YL=Mt(qL.prototype,"hitLineNode",[kL],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),jL=Mt(qL.prototype,"laneContainer",[VL],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),KL=Mt(qL.prototype,"tileManager",[BL],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),XL=Mt(qL.prototype,"tapValidator",[HL],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),JL=Mt(qL.prototype,"canvasTransform",[UL],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),QL=Mt(qL.prototype,"camera",[GL],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),$L=Mt(qL.prototype,"tapFeedbackDuration",[OO],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.2}}),WL=qL))||WL);t._RF.pop(),t._RF.push({},"38482d0oyNDQos3rad3oDFt","FeedbackManager",void 0);var xO,FO,DO,zO,kO,VO,BO,HO,UO,GO,WO,qO,ZO,YO,jO,KO=e.ccclass,XO=e.property,JO=function(t){return t[t.PERFECT=0]="PERFECT",t[t.GREAT=1]="GREAT",t[t.COOL=2]="COOL",t[t.MISS=3]="MISS",t}(JO||{}),QO=(nO=KO("FeedbackManager"),rO=XO(lt),oO=XO({type:[c],tooltip:"Feedback animation nodes in order: perfect, good, cool, miss"}),aO=XO(ct),sO=XO(y),lO=XO(_t),cO=XO(c),uO=XO(y),hO=XO(b),pO=XO([Number]),nO((gO=Mt((fO=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return e=t.call.apply(t,[this].concat(n))||this,Nt(e,"animScoreFeedBacks",gO,Lt(e)),Nt(e,"feedbackNodes",mO,Lt(e)),Nt(e,"particleSystemPerfectFragments",vO,Lt(e)),Nt(e,"comboLabel",yO,Lt(e)),Nt(e,"gameCamera",bO,Lt(e)),Nt(e,"cameraShakeNode",_O,Lt(e)),Nt(e,"lbMessage",SO,Lt(e)),Nt(e,"opacityMessage",wO,Lt(e)),e.audioManager=null,Nt(e,"perfectSoundEffect",TO,Lt(e)),Nt(e,"greatSoundEffect",EO,Lt(e)),Nt(e,"coolSoundEffect",AO,Lt(e)),Nt(e,"missSoundEffect",CO,Lt(e)),Nt(e,"comboSoundEffect",PO,Lt(e)),Nt(e,"comboMilestones",MO,Lt(e)),e.lanePositions=[],Nt(e,"feedbackDuration",IO,Lt(e)),Nt(e,"feedbackScaleMultiplier",NO,Lt(e)),e.feedbackAnimNames=["perfect","great","cool","miss"],e._scorePopupPool=[],e._messagePopupPool=[],e._scorePopupTemplate=null,e._messagePopupTemplate=null,e._poolRoot=null,e.comboTween=null,e._messageTween=null,e}It(e,t);var i=e.prototype;return i.onLoad=function(){this.audioManager=wI.instance,this.comboLabel&&(this.comboLabel.string="",this.comboLabel.node.active=!1)},i.setLanePositions=function(t){this.lanePositions=t},i.showRatingFeedback=function(t,e){this.getLanePosition(t);var i="";switch(e){case XN.PERFECT:i=this.perfectSoundEffect,this.showFeedback(JO.PERFECT),this.particleSystemPerfectFragments.resetSystem();break;case XN.GREAT:i=this.greatSoundEffect,this.showFeedback(JO.GREAT);break;case XN.COOL:i=this.coolSoundEffect,this.showFeedback(JO.COOL);break;case XN.MISS:i=this.missSoundEffect,this.showFeedback(JO.MISS)}i&&this.audioManager.playSound(i)},i.updateCombo=function(t){this.comboLabel&&(t>1?(this.comboLabel.string="x"+t,this.comboLabel.node.active=!0,this.comboTween&&this.comboTween.stop(),this.comboLabel.node.scale=new g(0,0,0),this.comboTween=v(this.comboLabel.node).to(.1,{scale:new g(1.2,1.2,1)}).delay(.5).to(.35,{scale:g.ZERO},{easing:_.backIn}).start(),this.isComboMilestone(t)&&this.showComboMilestone(t)):(this.comboLabel.string="",this.comboLabel.node.active=!1))},i.isComboMilestone=function(t){return this.comboMilestones.indexOf(t)>=0},i.showComboMilestone=function(t){this.audioManager.playSound(this.comboSoundEffect)},i.shakeCamera=function(t,e){if(void 0===e&&(e=.5),this.gameCamera||this.cameraShakeNode){if(this.cameraShakeNode){var i=this.cameraShakeNode.getComponent(lt);if(i)return i.play(),void this.scheduleOnce((function(){i.stop()}),t)}for(var n=this.cameraShakeNode||this.gameCamera.node,r=n.position.clone(),o=10*e,a=Math.floor(t/.05),s=v(n),l=0;l<a;l++){var c=(2*Math.random()-1)*o,u=(2*Math.random()-1)*o;s=s.to(.05,{position:new g(r.x+c,r.y+u,r.z)})}s.to(.1,{position:r}).start()}},i.showScorePopup=function(t,e){void 0===e&&(e=new g(0,0,0))},i.getLanePosition=function(t){return t>=0&&t<this.lanePositions.length?this.lanePositions[t]:new g(0,0,0)},i.showMessage=function(t,e,i){var n=this;void 0===e&&(e=2),void 0===i&&(i=80),this.lbMessage.string=t,this.lbMessage.node.active=!0,this.lbMessage.fontSize=i,this.opacityMessage.opacity=255,this._messageTween&&this._messageTween.stop();var r=e/3/2;this._messageTween=v(this.opacityMessage).to(r,{opacity:255},{easing:"smooth"}).to(r,{opacity:100},{easing:"smooth"}).to(r,{opacity:255},{easing:"smooth"}).to(r,{opacity:100},{easing:"smooth"}).to(r,{opacity:255},{easing:"smooth"}).to(r,{opacity:100},{easing:"smooth"}).to(r,{opacity:0},{easing:"smooth"}).call((function(){n.lbMessage.node.active=!1})).start()},i.playHapticFeedback=function(t){if(void 0===t&&(t=.5),"navigator"in globalThis&&"vibrate"in navigator){var e=Math.floor(10+90*t);navigator.vibrate(e)}},i.showFeedback=function(t){for(var e,i=Ft(this.feedbackNodes);!(e=i()).done;){e.value.active=!1}this.feedbackNodes[t]&&(this.feedbackNodes[t].active=!0);var n=this.feedbackAnimNames[t];this.animScoreFeedBacks.play(n)},i.showPerfect=function(){this.showFeedback(JO.PERFECT)},i.showGood=function(){this.showFeedback(JO.GREAT)},i.showCool=function(){this.showFeedback(JO.COOL)},i.showMiss=function(){this.showFeedback(JO.MISS)},i.onDestroy=function(){this._scorePopupPool&&(this._scorePopupPool.forEach((function(t){t&&t.isValid&&t.destroy()})),this._scorePopupPool=[]),this._messagePopupPool&&(this._messagePopupPool.forEach((function(t){t&&t.isValid&&t.destroy()})),this._messagePopupPool=[]),this._scorePopupTemplate&&this._scorePopupTemplate.isValid&&(this._scorePopupTemplate.destroy(),this._scorePopupTemplate=null),this._messagePopupTemplate&&this._messagePopupTemplate.isValid&&(this._messagePopupTemplate.destroy(),this._messagePopupTemplate=null),this._poolRoot&&this._poolRoot.isValid&&(this._poolRoot.destroy(),this._poolRoot=null)},xt(e,[{key:"perfectAnimNode",get:function(){return this.feedbackNodes[0]}},{key:"goodNode",get:function(){return this.feedbackNodes[1]}},{key:"coolNode",get:function(){return this.feedbackNodes[2]}},{key:"missNode",get:function(){return this.feedbackNodes[3]}}]),e}(o)).prototype,"animScoreFeedBacks",[rO],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),mO=Mt(fO.prototype,"feedbackNodes",[oO],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),vO=Mt(fO.prototype,"particleSystemPerfectFragments",[aO],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),yO=Mt(fO.prototype,"comboLabel",[sO],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),bO=Mt(fO.prototype,"gameCamera",[lO],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_O=Mt(fO.prototype,"cameraShakeNode",[cO],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),SO=Mt(fO.prototype,"lbMessage",[uO],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),wO=Mt(fO.prototype,"opacityMessage",[hO],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),TO=Mt(fO.prototype,"perfectSoundEffect",[XO],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"perfect"}}),EO=Mt(fO.prototype,"greatSoundEffect",[XO],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"good"}}),AO=Mt(fO.prototype,"coolSoundEffect",[XO],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"ok"}}),CO=Mt(fO.prototype,"missSoundEffect",[XO],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"miss"}}),PO=Mt(fO.prototype,"comboSoundEffect",[XO],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"combo"}}),MO=Mt(fO.prototype,"comboMilestones",[pO],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[50,100,200,300,500]}}),IO=Mt(fO.prototype,"feedbackDuration",[XO],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.7}}),NO=Mt(fO.prototype,"feedbackScaleMultiplier",[XO],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1.5}}),dO=fO))||dO);t._RF.pop(),t._RF.push({},"9daf9azaSJIKJ3U9ri2+dcr","ScoreManager",void 0);var $O,tR,eR,iR,nR,rR,oR,aR,sR,lR,cR,uR,hR,pR,dR,fR,gR,mR,vR,yR,bR,_R=e.ccclass,SR=e.property,wR=(xO=_R("ScoreManager"),FO=SR(iO),DO=SR(y),zO=SR(y),xO((BO=Mt((VO=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return e=t.call.apply(t,[this].concat(n))||this,Nt(e,"tapValidator",BO,Lt(e)),Nt(e,"scoreLabel",HO,Lt(e)),Nt(e,"accuracyLabel",UO,Lt(e)),Nt(e,"perfectScore",GO,Lt(e)),Nt(e,"goodScore",WO,Lt(e)),Nt(e,"okScore",qO,Lt(e)),Nt(e,"missScore",ZO,Lt(e)),Nt(e,"maxComboBonus",YO,Lt(e)),Nt(e,"accuracyBonus",jO,Lt(e)),e.currentScore=0,e.finalScore=0,e.isTracking=!1,e.highScores=new Map,e.onScoreChangedCallback=null,e}It(e,t);var i=e.prototype;return i.onLoad=function(){this.updateScoreDisplay(),this.tapValidator&&this.tapValidator.onRating(this.onRatingEvent.bind(this))},i.startTracking=function(){this.resetScore(),this.isTracking=!0},i.pauseTracking=function(){this.isTracking=!1},i.resumeTracking=function(){this.isTracking=!0},i.stopTracking=function(){this.isTracking=!1,this.finalizeScore()},i.resetScore=function(){this.currentScore=0,this.finalScore=0,this.updateScoreDisplay()},i.onRatingEvent=function(t,e){if(this.isTracking){var i=0;switch(e){case XN.PERFECT:i=this.perfectScore;break;case XN.GREAT:i=this.goodScore;break;case XN.COOL:i=this.okScore;break;case XN.MISS:i=this.missScore}var n=this.tapValidator.getCombo();if(n>1){var r=1+Math.min(n/100,.5);i=Math.round(i*r)}this.addScore(i)}},i.addScore=function(t){this.isTracking&&(this.currentScore+=t,this.updateScoreDisplay(),this.onScoreChangedCallback&&this.onScoreChangedCallback(this.currentScore))},i.updateScoreDisplay=function(){if(this.scoreLabel&&(this.scoreLabel.string=this.formatScore(this.currentScore)),this.accuracyLabel&&this.tapValidator){var t=this.tapValidator.getAccuracy();this.accuracyLabel.string=t+"%"}},i.formatScore=function(t){return t.toLocaleString()},i.finalizeScore=function(){if(this.tapValidator){var t=this.tapValidator.getAccuracy(),e=this.tapValidator.getMaxCombo(),i=(this.tapValidator.getRatingCounts(),this.tapValidator.getTotalNotes()),n=this.currentScore,r=i>0?e/i:0,o=Math.round(this.maxComboBonus*r),a=Math.round(this.accuracyBonus*(t/100));this.finalScore=n+o+a,console.log("Score Breakdown:"),console.log("Base Score: "+n),console.log("Combo Bonus ("+e+"x): "+o),console.log("Accuracy Bonus ("+t+"%): "+a),console.log("Final Score: "+this.finalScore),this.checkHighScore()}else this.finalScore=this.currentScore},i.checkHighScore=function(){var t="current";return(!this.highScores.has(t)||this.finalScore>this.highScores.get(t))&&(this.highScores.set(t,this.finalScore),!0)},i.getCurrentScore=function(){return this.currentScore},i.getFinalScore=function(){return this.finalScore},i.onScoreChanged=function(t){this.onScoreChangedCallback=t},i.getHighScore=function(t){return this.highScores.get(t)||0},i.saveHighScores=function(){var t={};this.highScores.forEach((function(e,i){t[i]=e}));var e=JSON.stringify(t);localStorage.setItem("magicTilesHighScores",e)},i.loadHighScores=function(){var t=localStorage.getItem("magicTilesHighScores");if(t)try{var e=JSON.parse(t);for(var i in this.highScores.clear(),e)Object.prototype.hasOwnProperty.call(e,i)&&this.highScores.set(i,e[i])}catch(t){console.error("Failed to parse high scores:",t)}},e}(o)).prototype,"tapValidator",[FO],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),HO=Mt(VO.prototype,"scoreLabel",[DO],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),UO=Mt(VO.prototype,"accuracyLabel",[zO],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),GO=Mt(VO.prototype,"perfectScore",[SR],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1e3}}),WO=Mt(VO.prototype,"goodScore",[SR],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 500}}),qO=Mt(VO.prototype,"okScore",[SR],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 100}}),ZO=Mt(VO.prototype,"missScore",[SR],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 0}}),YO=Mt(VO.prototype,"maxComboBonus",[SR],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1e4}}),jO=Mt(VO.prototype,"accuracyBonus",[SR],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 1e4}}),kO=VO))||kO);t._RF.pop(),t._RF.push({},"b4fc9FZUXxGj6ZQ8DWe5h2y","MTGameplayManager",void 0);var TR,ER,AR,CR,PR,MR,IR,NR=e.ccclass,LR=e.property,OR=function(t){return t[t.NONE=0]="NONE",t[t.LOADING=1]="LOADING",t[t.WAITING_FOR_START=2]="WAITING_FOR_START",t[t.PLAYING=3]="PLAYING",t[t.PAUSED=4]="PAUSED",t[t.COMPLETED=5]="COMPLETED",t[t.FAILED=6]="FAILED",t}({}),RR=($O=NR("MTGameplayManager"),tR=LR(FL),eR=LR(RO),iR=LR(QO),nR=LR(iO),rR=LR(wR),oR=LR(k),$O((lR=Mt((sR=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).gameState=OR.NONE,Nt(e,"tileManager",lR,Lt(e)),Nt(e,"inputManager",cR,Lt(e)),Nt(e,"feedbackManager",uR,Lt(e)),Nt(e,"tapValidator",hR,Lt(e)),Nt(e,"scoreManager",pR,Lt(e)),Nt(e,"toggleAutoPlay",dR,Lt(e)),Nt(e,"countdownDuration",fR,Lt(e)),Nt(e,"minSurvivalHP",gR,Lt(e)),Nt(e,"maxSurvivalHP",mR,Lt(e)),Nt(e,"missHPPenalty",vR,Lt(e)),Nt(e,"badHitHPPenalty",yR,Lt(e)),Nt(e,"perfectHPRecovery",bR,Lt(e)),e.survivalHP=100,e.currentSong=null,e.elapsedTime=0,e.notesPassed=0,e.totalNotes=0,e.autoPlay=!1,e.isPaused=!1,e.onGameStateChangedCallback=null,e.onSurvivalHPChangedCallback=null,e.audioManager=null,e.beatmapManager=null,e}It(e,t);var i=e.prototype;return i.onLoad=function(){this.audioManager||(this.audioManager=wI.instance),this.beatmapManager||(this.beatmapManager=jI.instance),this.tapValidator&&this.tapValidator.onRating(this.onRatingEvent.bind(this))},i.loadSong=function(){var t=Ot(Rt().mark((function t(e){var i,n,r;return Rt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return this.resetGameState(),this.currentSong=e,this.setGameState(OR.LOADING),t.prev=3,t.next=6,this.beatmapManager.loadSong(e);case 6:if(i=t.sent){t.next=10;break}return console.error("Failed to load beatmap: "+e),t.abrupt("return",!1);case 10:return t.next=12,this.beatmapManager.loadBeatmapAudioData();case 12:if(n=t.sent){t.next=16;break}return console.error("Failed to load beatmap audio"),t.abrupt("return",!1);case 16:return null==i.notes||0==i.notes.length?(r=this.beatmapManager.updateNotes(e.id,n.trackInfo.notes),this.totalNotes=r.notes.length):this.totalNotes=i.notes.length,this.tileManager.initGame(),this.createBeginningTile(),t.abrupt("return",!0);case 22:return t.prev=22,t.t0=t.catch(3),console.error("Error starting game:",t.t0),t.abrupt("return",!1);case 26:case"end":return t.stop()}}),t,this,[[3,22]])})));return function(e){return t.apply(this,arguments)}}(),i.startPlaying=function(){this.setAutoPlay(this.toggleAutoPlay.isChecked),this.tapValidator.resetCombo(),this.scoreManager.resetScore(),this.scoreManager.startTracking(),this.inputManager.setEnabled(!0),this.tileManager.startGame(),this.audioManager.playBeatmapAudio(),this.setGameState(OR.PLAYING),this.schedule(this.gameUpdate,0)},i.pauseGame=function(){this.gameState===OR.PLAYING&&(this.audioManager.pauseBeatmapAudio(),this.tileManager.pauseGame(),this.inputManager.setEnabled(!1),this.scoreManager.pauseTracking(),this.isPaused=!0,this.setGameState(OR.PAUSED),this.unschedule(this.gameUpdate))},i.resumeGame=function(){this.gameState===OR.PAUSED&&(this.audioManager.resumeBeatmapAudio(),this.tileManager.resumeGame(),this.inputManager.setEnabled(!0),this.scoreManager.resumeTracking(),this.isPaused=!1,this.setGameState(OR.PLAYING),this.schedule(this.gameUpdate,0))},i.gameUpdate=function(t){if(this.elapsedTime+=t,this.audioManager.isPlaying()){var e=this.audioManager.getCurrentTime();this.tileManager.setGameTime(e)}this.survivalHP<=0?this.failGame():this.notesPassed>=this.totalNotes&&0===this.tileManager.getActiveTileCount()&&this.completeGame()},i.onRatingEvent=function(t,e){switch(this.feedbackManager.showRatingFeedback(t,e),this.feedbackManager.updateCombo(this.tapValidator.getCombo()),this.notesPassed++,e){case XN.PERFECT:this.changeSurvivalHP(this.perfectHPRecovery);break;case XN.GREAT:break;case XN.COOL:this.changeSurvivalHP(-this.badHitHPPenalty);break;case XN.MISS:this.changeSurvivalHP(-this.missHPPenalty)}},i.changeSurvivalHP=function(t){this.survivalHP=Math.max(0,Math.min(this.maxSurvivalHP,this.survivalHP+t)),this.onSurvivalHPChangedCallback&&this.onSurvivalHPChangedCallback(this.survivalHP)},i.completeGame=function(){this.stopGameplay(),this.setGameState(OR.COMPLETED),this.feedbackManager.showMessage("LEVEL COMPLETE!");var t=this.scoreManager.getFinalScore(),e=this.tapValidator.getAccuracy(),i=this.tapValidator.getMaxCombo();console.log("Game completed! Score: "+t+", Accuracy: "+e+"%, Max Combo: "+i),this.scheduleOnce((function(){console.log("Show results screen")}),2)},i.failGame=function(){this.stopGameplay(),this.setGameState(OR.FAILED),this.feedbackManager.showMessage("GAME OVER"),this.feedbackManager.shakeCamera(.3,.8),this.scheduleOnce((function(){console.log("Show fail screen")}),2)},i.stopGameplay=function(){this.audioManager.stopBeatmapAudio(),this.tileManager.stopGame(),this.inputManager.setEnabled(!1),this.scoreManager.stopTracking(),this.unschedule(this.gameUpdate)},i.resetGameState=function(){this.gameState=OR.NONE,this.survivalHP=this.maxSurvivalHP,this.elapsedTime=0,this.notesPassed=0,this.totalNotes=0,this.isPaused=!1},i.setGameState=function(t){this.gameState=t,this.onGameStateChangedCallback&&this.onGameStateChangedCallback(t)},i.onGameStateChanged=function(t){this.onGameStateChangedCallback=t},i.onSurvivalHPChanged=function(t){this.onSurvivalHPChangedCallback=t},i.getGameState=function(){return this.gameState},i.getSurvivalHP=function(){return this.survivalHP},i.getProgress=function(){return 0===this.totalNotes?0:this.notesPassed/this.totalNotes},i.setAutoPlay=function(t){this.autoPlay=t,this.tileManager.toggleAutoplay(t)},i.isAutoPlayEnabled=function(){return this.autoPlay},i.togglePause=function(){this.isPaused?this.resumeGame():this.pauseGame()},i.restartGame=function(){this.currentSong&&this.loadSong(this.currentSong)},i.exitGame=function(){this.stopGameplay(),this.resetGameState(),console.log("Exit to menu")},i.createBeginningTile=function(){this.setGameState(OR.WAITING_FOR_START),this.tileManager&&this.tileManager.setupBeginningTile(),this.inputManager.setEnabled(!0),this.inputManager.onLaneTap(this.onBeginningTileTap.bind(this))},i.onBeginningTileTap=function(t){this.gameState===OR.WAITING_FOR_START&&(this.tileManager.checkBeginningTileTap(t)&&(this.inputManager.removeOnLaneTap(this.onBeginningTileTap.bind(this)),this.startPlaying()))},i.onDestroy=function(){this.unscheduleAllCallbacks(),this.audioManager&&this.audioManager.deinit(),this.beatmapManager&&this.beatmapManager.deinit()},e}(o)).prototype,"tileManager",[tR],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),cR=Mt(sR.prototype,"inputManager",[eR],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),uR=Mt(sR.prototype,"feedbackManager",[iR],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),hR=Mt(sR.prototype,"tapValidator",[nR],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),pR=Mt(sR.prototype,"scoreManager",[rR],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),dR=Mt(sR.prototype,"toggleAutoPlay",[oR],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),fR=Mt(sR.prototype,"countdownDuration",[LR],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 3}}),gR=Mt(sR.prototype,"minSurvivalHP",[LR],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 40}}),mR=Mt(sR.prototype,"maxSurvivalHP",[LR],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 100}}),vR=Mt(sR.prototype,"missHPPenalty",[LR],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 10}}),yR=Mt(sR.prototype,"badHitHPPenalty",[LR],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 5}}),bR=Mt(sR.prototype,"perfectHPRecovery",[LR],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 2}}),aR=sR))||aR);t._RF.pop(),t._RF.push({},"3828eDIEe1G/rr9u6tsVC3f","PopupMTSongSelection",void 0);var xR,FR,DR,zR,kR,VR,BR,HR=e.ccclass,UR=e.property;TR=HR("PopupMTSongSelection"),ER=UR(c),AR=UR(c),TR((MR=Mt((PR=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return e=t.call.apply(t,[this].concat(n))||this,Nt(e,"contentNode",MR,Lt(e)),Nt(e,"itemSongPrefab",IR,Lt(e)),e.gameplayManager=null,e.songs=[{id:"DauCoLoiLam",title:"Dẫu có lỗi lầm - bestcut",artist:"ATVNCG",bpm:95,difficulty:3,level:5,previewStart:6e4,previewEnd:9e4,musicPath:"DauCoLoiLam_ATVNCG_bestcut",midiPath:"DauCoLoiLam_ATVNCG_bestcut",backgroundImage:"magic_tiles/images/Perfect_EdSheeran_background",thumbnail:"magic_tiles/images/Perfect_EdSheeran_cover"},{id:"Lang",title:"Lặng",artist:"Rhymastic",bpm:85,difficulty:3,level:5,previewStart:6e4,previewEnd:9e4,musicPath:"Lang_Rhymastic_ATVNCG",midiPath:"Lang_Rhymastic_ATVNCG",backgroundImage:"magic_tiles/images/Lang_background",thumbnail:"magic_tiles/images/Lang_cover"},{id:"DauCoLoiLamFull",title:"Đâu Có Lỗi Lầm",artist:"ATVNCG",bpm:95,difficulty:3,level:5,previewStart:6e4,previewEnd:9e4,musicPath:"DauCoLoiLam_ATVNCG_Full",midiPath:"DauCoLoiLam_ATVNCG_Full",backgroundImage:"magic_tiles/images/DauCoLoiLam_background",thumbnail:"magic_tiles/images/DauCoLoiLam_cover"},{id:"TrongCom",title:"Trống Cơm",artist:"ATVNCG",bpm:100,difficulty:4,level:6,previewStart:6e4,previewEnd:9e4,musicPath:"TrongCom_ATVNCG",midiPath:"TrongCom_ATVNCG",backgroundImage:"magic_tiles/images/TrongCom_background",thumbnail:"magic_tiles/images/TrongCom_cover"},{id:"GiaNhu",title:"Giá Như",artist:"SOOBIN",bpm:90,difficulty:2,level:4,previewStart:6e4,previewEnd:9e4,musicPath:"GiaNhu_SOOBIN_ATVNCG",midiPath:"GiaNhu_SOOBIN_ATVNCG",backgroundImage:"magic_tiles/images/GiaNhu_background",thumbnail:"magic_tiles/images/GiaNhu_cover"}],e}It(e,t);var i=e.prototype;return i.start=function(){this.gameplayManager=M.getScene().getComponentInChildren(RR),this.createSongItems(this.songs)},i.createSongItems=function(t){var e=this;this.contentNode.removeAllChildren(),t.forEach((function(t){var i=A(e.itemSongPrefab);i.active=!0;var n=i.getComponent(yI);n&&(n.setSongData(t,e.onSongSelected.bind(e)),e.contentNode.addChild(i))}))},i.onSongSelected=function(t){var e=this;this.gameplayManager?this.gameplayManager.loadSong(t).then((function(i){i?e.hide():console.error("Failed to load beatmap: "+t.id)})):console.error("GameplayManager not found")},e}(sr)).prototype,"contentNode",[ER],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),IR=Mt(PR.prototype,"itemSongPrefab",[AR],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),CR=PR));t._RF.pop(),t._RF.push({},"04c89d3uFxCxYqeuP2zDazt","MTDragAndDropTool",void 0);var GR,WR=e.ccclass,qR=e.property;xR=WR("MTDragAndDropTool"),FR=qR(c),DR=qR(y),xR((VR=Mt((kR=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return e=t.call.apply(t,[this].concat(n))||this,Nt(e,"notificationNode",VR,Lt(e)),Nt(e,"notificationLabel",BR,Lt(e)),e._midiFile=null,e._audioFile=null,e._tempBeatmapId=null,e._tempAssets=null,e._dropOverlay=null,e}It(e,t);var i=e.prototype;return i.onLoad=function(){this.createDragOverlay(),this.initialize()},i.onDestroy=function(){this._dropOverlay&&this._dropOverlay.parentNode&&this._dropOverlay.parentNode.removeChild(this._dropOverlay)},i.createDragOverlay=function(){if(S.isBrowser){var t=document.createElement("div");t.style.position="fixed",t.style.top="0",t.style.left="0",t.style.width="100%",t.style.height="100%",t.style.backgroundColor="rgba(0, 100, 255, 0.3)",t.style.display="none",t.style.zIndex="9999",t.style.justifyContent="center",t.style.alignItems="center",t.style.fontSize="24px",t.style.color="white",t.style.textShadow="0 0 5px black",t.innerHTML='<div style="background: rgba(0,0,0,0.7); padding: 20px; border-radius: 10px;">Drop MIDI and Audio files here<br><small>(Need both files to start)</small></div>',document.body.appendChild(t),this._dropOverlay=t}},i.initialize=function(){var t=this;if(S.isBrowser){var e=document.body;e.addEventListener("dragover",(function(e){e.preventDefault(),e.stopPropagation(),t._dropOverlay&&(t._dropOverlay.style.display="flex")})),e.addEventListener("dragleave",(function(i){i.preventDefault(),i.stopPropagation();var n=e.getBoundingClientRect();(i.clientX<=n.left||i.clientX>=n.right||i.clientY<=n.top||i.clientY>=n.bottom)&&t._dropOverlay&&(t._dropOverlay.style.display="none")})),e.addEventListener("drop",(function(e){e.preventDefault(),e.stopPropagation(),t._dropOverlay&&(t._dropOverlay.style.display="none"),t.handleFileDrop(e.dataTransfer.files)})),console.log("MTDragAndDropTool: Initialized drag and drop handlers")}else console.warn("MTDragAndDropTool: Drag and drop is only supported in browser environments")},i.handleFileDrop=function(t){var e=this;if(t&&0!==t.length){for(var i=!1,n=0;n<t.length;n++){var r=t[n];if(r.name.toLowerCase().endsWith(".mid")||r.name.toLowerCase().endsWith(".midi")){this._midiFile=r,i=!0,console.log("MTDragAndDropTool: MIDI file dropped:",r.name);break}}i?(this.notifyNextStep("MIDI file received! Processing..."),this.scheduleOnce((function(){e.processFiles()}),0)):this.notifyNextStep("Please drop a MIDI file (.mid/.midi).")}},i.processFiles=function(){var t=Ot(Rt().mark((function t(){var e,i,n,r,o,a,s,l,c,u,h;return Rt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,this.notifyNextStep("Processing files..."),this._tempBeatmapId="temp_"+Date.now(),e=this._midiFile.name.replace(/\.(mid|midi)$/i,""),i="magic_tiles/audios/"+e,console.log("Attempting to load audio from resources: "+i),t.prev=6,t.next=9,this.loadAudioFromResources(i);case 9:n=t.sent,console.log("Successfully loaded audio from resources:",n.name),t.next=19;break;case 13:return t.prev=13,t.t0=t.catch(6),console.error("Failed to load audio resource at "+i+":",t.t0),this.notifyNextStep('Could not find matching audio file in resources. Please ensure audio file "'+e+'.mp3" exists in magic_tiles/audios folder.'),this.resetFiles(),t.abrupt("return");case 19:return r=URL.createObjectURL(this._midiFile),t.next=22,de(r);case 22:if(o=t.sent,a={id:this._tempBeatmapId,title:e,artist:"Unknown Artist",bpm:o.tempo||120,difficulty:3,level:5,previewStart:0,previewEnd:30,musicPath:null,midiPath:null,backgroundImage:"magic_tiles/images/default_background",thumbnail:"magic_tiles/images/default_cover"},s={song:a,notes:[]},!o||!o.notes){t.next=32;break}l=[],l=jI.instance.convertNotes(o.notes,l),s.notes=l,console.log("Processed "+s.notes.length+" notes from MIDI data"),t.next=36;break;case 32:return console.warn("No valid MIDI tracks found in the file"),this.notifyNextStep("MIDI file doesn't contain valid note data. Please try another file."),this.resetFiles(),t.abrupt("return");case 36:c=jI.instance,u=wI.instance,console.log("AudioClip details:",{name:n.name,duration:n.getDuration(),isValid:n.loaded,type:typeof n._nativeAsset}),h={clip:n,trackInfo:o,totalDuration:n.getDuration()||180,currentTime:0,isPlaying:!1,isPaused:!1},u.setCurrentBeatmap(h),c.addTempBeatmap(this._tempBeatmapId,s),this.startGame(),t.next=50;break;case 45:t.prev=45,t.t1=t.catch(0),console.error("MTDragAndDropTool: Error processing files:",t.t1),this.notifyNextStep("Error processing files: "+t.t1.message),this.resetFiles();case 50:case"end":return t.stop()}}),t,this,[[0,45],[6,13]])})));return function(){return t.apply(this,arguments)}}(),i.startGame=function(){var t=this.findGameplayManager();if(!t)return console.error("MTDragAndDropTool: GameplayManager not found"),void this.notifyNextStep("Cannot start game. Please try loading files from the game menu.");this.notifyNextStep("Starting game..."),t.resetGameState(),t.setGameState(OR.LOADING),t.tileManager.initGame(),t.createBeginningTile(),this.resetFiles()},i.findGameplayManager=function(){return M.getScene().getComponentInChildren(RR)},i.loadAudioFromResources=function(t){return new Promise((function(e,i){Qe.loadRes(t,L,(function(t,n){if(t)return console.error("Failed to load audio from resources:",t),void i(t);n&&n instanceof L?(console.log("Successfully loaded AudioClip from resources:",n),e(n)):(console.error("Invalid AudioClip received:",n),i("Invalid AudioClip received"))}))}))},i.resetFiles=function(){this._midiFile&&URL.revokeObjectURL(URL.createObjectURL(this._midiFile)),this._midiFile=null,this._tempBeatmapId=null,this._tempAssets=null},i.notifyNextStep=function(t){var e=this;console.log("MTDragAndDropTool: "+t),this.notificationNode&&this.notificationLabel?(this.notificationNode.active=!0,this.notificationLabel.string=t,this.scheduleOnce((function(){e.notificationNode.active=!1}),3)):this.showTemporaryNotification(t)},i.showTemporaryNotification=function(t){if(S.isBrowser){var e=document.createElement("div");e.style.position="fixed",e.style.bottom="20px",e.style.left="50%",e.style.transform="translateX(-50%)",e.style.backgroundColor="rgba(0, 0, 0, 0.7)",e.style.color="white",e.style.padding="10px 20px",e.style.borderRadius="5px",e.style.zIndex="10000",e.innerText=t,document.body.appendChild(e),setTimeout((function(){e.parentNode&&e.parentNode.removeChild(e)}),3e3)}},e}(o)).prototype,"notificationNode",[FR],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),BR=Mt(kR.prototype,"notificationLabel",[DR],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),zR=kR));t._RF.pop(),t._RF.push({},"d1150kIEY9PuYumOVd3REwu","OnboardingController",void 0);var ZR,YR,jR,KR,XR,JR=e.ccclass;e.property,JR("OnboardingController")(GR=function(t){function e(){return t.apply(this,arguments)||this}It(e,t);var i=e.prototype;return i.start=function(){},i.update=function(t){},e}(o));t._RF.pop(),t._RF.push({},"60fa6arq75JzaMOMyrnUyBF","PitchConstants",void 0);var QR=function(t){return t[t.DO=0]="DO",t[t.RE=1]="RE",t[t.MI=2]="MI",t[t.FA=3]="FA",t[t.SOL=4]="SOL",t[t.LA=5]="LA",t[t.SI=6]="SI",t}({}),$R=function(t){return t[t.INIT=0]="INIT",t[t.CALIBRATING=1]="CALIBRATING",t[t.WAIT_FOR_FIRST_NOTE=2]="WAIT_FOR_FIRST_NOTE",t[t.PLAYING=3]="PLAYING",t[t.PAUSED=4]="PAUSED",t[t.GAME_OVER=5]="GAME_OVER",t}({}),tx=function(t){return t[t.MISS=0]="MISS",t[t.GOOD=1]="GOOD",t[t.PERFECT=2]="PERFECT",t}({}),ex=function(t){return t[t.PERFECT=0]="PERFECT",t[t.GOOD=1]="GOOD",t[t.MISS=2]="MISS",t[t.TIME_WARNING=3]="TIME_WARNING",t}({}),ix=function(){};ix.GAME_DURATION=60,ix.WARNING_TIME_1=30,ix.WARNING_TIME_2=10,ix.NOTE_FREQUENCIES=((ZR={})[QR.DO]=[251.63,271.63],ZR[QR.RE]=[283.66,303.66],ZR[QR.MI]=[319.63,339.63],ZR[QR.FA]=[339.23,359.23],ZR[QR.SOL]=[382,402],ZR[QR.LA]=[430,450],ZR[QR.SI]=[483.88,503.88],ZR),ix.NOTE_NAMES=["Do","Re","Mi","Fa","Sol","La","Si"],ix.CENTER_FREQUENCIES=((YR={})[QR.DO]=261.63,YR[QR.RE]=293.66,YR[QR.MI]=329.63,YR[QR.FA]=349.23,YR[QR.SOL]=392,YR[QR.LA]=440,YR[QR.SI]=493.88,YR),ix.FREQUENCY_RANGES=((jR={})[QR.DO]=[247.22,277.18],jR[QR.RE]=[277.18,311.13],jR[QR.MI]=[311.13,349.23],jR[QR.FA]=[329.63,369.99],jR[QR.SOL]=[369.99,415.3],jR[QR.LA]=[415.3,466.16],jR[QR.SI]=[466.16,523.25],jR),ix.ANIMATIONS=((KR={})[QR.DO]="do_animation",KR[QR.RE]="re_animation",KR[QR.MI]="mi_animation",KR[QR.FA]="fa_animation",KR[QR.SOL]="sol_animation",KR[QR.LA]="la_animation",KR[QR.SI]="si_animation",KR),ix.NOTE_ANIMATIONS=((XR={})[QR.DO]="do_animation",XR[QR.RE]="re_animation",XR[QR.MI]="mi_animation",XR[QR.FA]="fa_animation",XR[QR.SOL]="sol_animation",XR[QR.LA]="la_animation",XR[QR.SI]="si_animation",XR),ix.EVENTS={PITCH_DETECTED:"pitch_detected",TIME_WARNING:"time_warning",GAME_OVER:"game_over",NOTE_MATCHED:"note_matched",SEQUENCE_COMPLETE:"sequence_complete"},ix.ACCURACY_THRESHOLDS={PERFECT:3,GOOD:7},t._RF.pop(),t._RF.push({},"dfe631CLPRPBowoQTyI/2P8","PitchNoteSequence",void 0);var nx,rx,ox,ax,sx,lx,cx,ux,hx,px=function(){function t(t,e,i,n){this.id=void 0,this.name=void 0,this.difficulty=void 0,this.notes=void 0,this.id=t,this.name=e,this.difficulty=i,this.notes=n}var e=t.prototype;return e.getTotalDuration=function(){return this.notes.reduce((function(t,e){return t+e.duration}),0)},e.getNoteCount=function(){return this.notes.length},t}(),dx=function(){function t(){}return t.initialize=function(){this.addSequence(new px("sequence_1","Basic Scale",1,[{note:QR.DO,duration:1.5},{note:QR.RE,duration:1},{note:QR.MI,duration:1.5},{note:QR.FA,duration:1},{note:QR.SOL,duration:2},{note:QR.LA,duration:1.5},{note:QR.SI,duration:1},{note:QR.DO,duration:2},{note:QR.SI,duration:1},{note:QR.LA,duration:1.5},{note:QR.SOL,duration:1},{note:QR.FA,duration:1.5},{note:QR.MI,duration:1},{note:QR.RE,duration:1.5},{note:QR.DO,duration:2}])),this.addSequence(new px("sequence_2","Simple Melody",2,[{note:QR.DO,duration:1},{note:QR.MI,duration:1},{note:QR.SOL,duration:1},{note:QR.MI,duration:1},{note:QR.DO,duration:2}])),this.addSequence(new px("sequence_3","Advanced Pattern",3,[{note:QR.DO,duration:1},{note:QR.MI,duration:1},{note:QR.SOL,duration:1},{note:QR.SI,duration:1},{note:QR.LA,duration:1},{note:QR.FA,duration:1},{note:QR.RE,duration:1},{note:QR.DO,duration:2}])),this.addSequence(new px("sequence_4","Expert Challenge",5,[{note:QR.DO,duration:.5},{note:QR.RE,duration:.5},{note:QR.MI,duration:.5},{note:QR.FA,duration:.5},{note:QR.SOL,duration:.5},{note:QR.LA,duration:.5},{note:QR.SI,duration:.5},{note:QR.LA,duration:.5},{note:QR.SOL,duration:.5},{note:QR.FA,duration:.5},{note:QR.MI,duration:.5},{note:QR.RE,duration:.5},{note:QR.DO,duration:1}]))},t.addSequence=function(t){this.sequences.set(t.id,t)},t.getSequenceById=function(t){return this.sequences.get(t)||null},t.getAllSequences=function(){return Array.from(this.sequences.values())},t.getSequencesByDifficulty=function(t){return Array.from(this.sequences.values()).filter((function(e){return e.difficulty===t}))},t}();dx.sequences=new Map,t._RF.pop(),t._RF.push({},"2e7c57Ev6lF8Ih44/MNJsG1","PitchCharacterAnimator",void 0);var fx,gx=e.ccclass,mx=e.property,vx=(nx=gx("PitchCharacterAnimator"),rx=mx({type:hb,tooltip:"Character component",group:{name:"Character",id:"character"}}),ox=mx({tooltip:"Transition time between animations in seconds",group:{name:"Animation",id:"animation"}}),ax=mx({tooltip:"Name of the idle animation",group:{name:"Animation",id:"animation"}}),nx((cx=Mt((lx=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return e=t.call.apply(t,[this].concat(n))||this,Nt(e,"character",cx,Lt(e)),Nt(e,"transitionDuration",ux,Lt(e)),Nt(e,"idleAnimationName",hx,Lt(e)),e.currentNote=null,e.isAnimating=!1,e.isInitialized=!1,e}It(e,t);var i=e.prototype;return i.onLoad=function(){this.initialize()},i.initialize=function(){var t=Ot(Rt().mark((function t(){var e,i;return Rt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(this.character){t.next=3;break}return console.error("Character component not found"),t.abrupt("return");case 3:return t.prev=3,t.next=6,this.character.init(null,xr.instance.characterId);case 6:return e=[this.idleAnimationName].concat(Object.keys(ix.NOTE_ANIMATIONS).map((function(t){return ix.NOTE_ANIMATIONS[t]}))),t.next=9,pb.getInstance().loadMultipleAnimations(e);case 9:return i=t.sent,t.next=12,pb.getInstance().applyAnimationsToCharacter(this.character,i);case 12:this.isInitialized=!0,console.log("Pitch character animations initialized"),this.playIdleAnimation(),t.next=20;break;case 17:t.prev=17,t.t0=t.catch(3),console.error("Failed to initialize pitch character animations:",t.t0);case 20:case"end":return t.stop()}}),t,this,[[3,17]])})));return function(){return t.apply(this,arguments)}}(),i.playNoteAnimation=function(t,e){var i=this;if(this.isInitialized&&this.character){var n=ix.NOTE_ANIMATIONS[t];if(n){if(this.currentNote!==t||!this.isAnimating){this.currentNote=t,this.isAnimating=!0,this.character.playAnimation(n,this.transitionDuration),console.log("Playing animation for note "+ix.NOTE_NAMES[t]);var r=this.character.getState(n);r&&r.once("finished",(function(){i.isAnimating=!1,i.playIdleAnimation()}))}}else console.warn("Animation not found for note "+ix.NOTE_NAMES[t])}},i.playIdleAnimation=function(){this.isInitialized&&this.character&&(this.currentNote=null,this.isAnimating=!1,this.character.playAnimation(this.idleAnimationName,this.transitionDuration),console.log("Playing idle animation"))},i.playSpecialAnimation=function(){var t=Ot(Rt().mark((function t(e,i,n){var r,o,a=this;return Rt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(void 0===i&&(i=!1),this.isInitialized&&this.character){t.next=3;break}return t.abrupt("return");case 3:return t.prev=3,t.next=6,pb.getInstance().loadAnimationClip(e);case 6:return r=t.sent,t.next=9,pb.getInstance().applyAnimationsToCharacter(this.character,[r]);case 9:this.currentNote=null,this.isAnimating=!0,this.character.playAnimation(e,this.transitionDuration),console.log("Playing special animation: "+e),(o=this.character.getState(e))&&!i&&o.once("finished",(function(){a.isAnimating=!1,n&&n(),a.playIdleAnimation()})),t.next=21;break;case 17:t.prev=17,t.t0=t.catch(3),console.error("Failed to play special animation "+e+":",t.t0),this.playIdleAnimation();case 21:case"end":return t.stop()}}),t,this,[[3,17]])})));return function(e,i,n){return t.apply(this,arguments)}}(),i.stopAllAnimations=function(){this.isInitialized&&this.character&&(this.isAnimating=!1,this.currentNote=null,this.playIdleAnimation(),console.log("All animations stopped"))},i.isAnimationPlaying=function(){return this.isAnimating},i.getCurrentNote=function(){return this.currentNote},e}(o)).prototype,"character",[rx],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ux=Mt(lx.prototype,"transitionDuration",[ox],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.3}}),hx=Mt(lx.prototype,"idleAnimationName",[ax],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"idle"}}),sx=lx))||sx);t._RF.pop(),t._RF.push({},"f8ec1Ju28VBfoeISSQmPsrE","PitchDetectionSystem",void 0);var yx,bx,_x,Sx,wx,Tx=e.ccclass,Ex=(e.property,Tx("PitchDetectionSystem")(fx=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).noteStabilityCounter=new Map,e.noteStabilityThreshold=2,e.isCalibrating=!1,e.calibrationCallback=null,e}It(e,t);var i=e.prototype;return i.onLoad=function(){for(var t=0;t<7;t++)this.noteStabilityCounter.set(t,0)},i.detectPitch=function(){if(this.analyzer&&this.isDetecting){this.analyzer.getFloatTimeDomainData(this.analyzerBuffer);for(var t=0,e=0;e<this.analyzerBuffer.length;e++)t+=this.analyzerBuffer[e]*this.analyzerBuffer[e];var i=Math.sqrt(t/this.analyzerBuffer.length);if(Math.random()<.1&&console.log("Current volume:",i.toFixed(4),"Threshold:",this.volumeThreshold),i<this.volumeThreshold)return this.resetNoteStability(),void this.emitPitchDetected(0,null,tx.MISS,i);var n=this.detectPitchAutocorrelation(),r=this.smoothingFactor*this.lastFrequency+(1-this.smoothingFactor)*n;this.lastFrequency=r,Math.random()<.1&&console.log("Smoothed frequency:",r.toFixed(2),"Hz");var o=this.mapFrequencyToNote(r),a=o.note,s=o.accuracy;null!==a?(this.updateNoteStability(a),Math.random()<.1&&console.log("Note stability counter:",{note:ix.NOTE_NAMES[a],count:this.noteStabilityCounter.get(a),threshold:this.noteStabilityThreshold}),this.noteStabilityCounter.get(a)>=this.noteStabilityThreshold&&this.emitPitchDetected(r,a,s,i)):(this.resetNoteStability(),this.emitPitchDetected(r,null,tx.MISS,i))}},i.detectPitchAutocorrelation=function(){for(var t=this.analyzerBuffer,e=t.length,i=0,n=0;n<e;n++)i+=t[n]*t[n];if((i=Math.sqrt(i/e))<this.volumeThreshold)return console.log("Autocorrelation RMS below threshold"),0;for(var r=new Float32Array(e),o=0;o<e;o++){r[o]=0;for(var a=0;a<e-o;a++)r[o]+=t[a]*t[a+o]}for(var s=-1,l=1;l<e/2;l++)if(r[l]<r[l-1]&&r[l]<r[l+1]){s=l;break}s<=1&&(s=1);for(var c=s,u=s+1;u<e/2;u++)r[u]>r[c]&&(c=u);if(r[c]<=0||0===c)return 0;var h=c;if(c>0&&c<e-1){var p=r[c],d=r[c-1],f=r[c+1],g=.5*(d-f)/(d-2*p+f);isFinite(g)&&(h+=g)}var m=0;return h>0&&(m=this.audioContext.sampleRate/h),m},i.mapFrequencyToNote=function(t){if(t<=0)return console.log("Invalid frequency detected:",t),{note:null,accuracy:tx.MISS};console.log("Detected frequency:",t.toFixed(2),"Hz");for(var e=0;e<7;e++){var i=e,n=ix.FREQUENCY_RANGES[i],r=n[0],o=n[1],a=ix.CENTER_FREQUENCIES[i];if(t>=r&&t<=o){var s=Math.abs(t-a),l=s/a*100;console.log("Note "+ix.NOTE_NAMES[i]+" detected:",{frequency:t.toFixed(2),centerFreq:a.toFixed(2),diffFromCenter:s.toFixed(2),percentDiff:l.toFixed(2)+"%",range:"["+r.toFixed(2)+", "+o.toFixed(2)+"]"});return{note:i,accuracy:l<=1?tx.PERFECT:l<=2.5?tx.GOOD:tx.MISS}}}return{note:null,accuracy:tx.MISS}},i.updateNoteStability=function(t){for(var e=0;e<7;e++)e!==t&&this.noteStabilityCounter.set(e,0);var i=this.noteStabilityCounter.get(t)||0;this.noteStabilityCounter.set(t,i+1)},i.resetNoteStability=function(){for(var t=0;t<7;t++)this.noteStabilityCounter.set(t,0)},i.emitPitchDetected=function(t,e,i,n){var r={frequency:t,note:e,accuracy:i,volume:n};this.emit(ix.EVENTS.PITCH_DETECTED,r)},i.startCalibration=function(t){var e=this;this.isCalibrating||(this.isCalibrating=!0,this.calibrationCallback=t,setTimeout((function(){e.isCalibrating=!1,e.calibrationCallback&&(e.calibrationCallback(!0),e.calibrationCallback=null)}),2e3),console.log("Calibration started"))},e}(LC))||fx);t._RF.pop(),t._RF.push({},"34dfdy0Mg9MWooFmqWcRhjg","PitchTimer",void 0);var Ax,Cx,Px,Mx,Ix,Nx,Lx,Ox,Rx,xx,Fx,Dx,zx,kx,Vx,Bx,Hx,Ux,Gx,Wx,qx,Zx,Yx,jx,Kx,Xx,Jx,Qx,$x,tF,eF,iF,nF,rF=e.ccclass,oF=e.property,aF=rF("PitchTimer")((_x=Mt((bx=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).eventTarget=new yt,Nt(e,"duration",_x,Lt(e)),Nt(e,"warningTime1",Sx,Lt(e)),Nt(e,"warningTime2",wx,Lt(e)),e.isRunning=!1,e.isPaused=!1,e.startTime=0,e.pauseTime=0,e.pausedDuration=0,e.remainingTime=0,e.warningEmitted1=!1,e.warningEmitted2=!1,e}It(e,t);var i=e.prototype;return i.startTimer=function(t){this.isRunning||(void 0!==t&&(this.duration=t),this.isRunning=!0,this.isPaused=!1,this.startTime=Date.now(),this.pausedDuration=0,this.remainingTime=this.duration,this.warningEmitted1=!1,this.warningEmitted2=!1,console.log("Timer started with duration: "+this.duration+"s"))},i.pauseTimer=function(){this.isRunning&&!this.isPaused&&(this.isPaused=!0,this.pauseTime=Date.now(),console.log("Timer paused"))},i.resumeTimer=function(){this.isRunning&&this.isPaused&&(this.isPaused=!1,this.pausedDuration+=Date.now()-this.pauseTime,console.log("Timer resumed"))},i.stopTimer=function(){this.isRunning&&(this.isRunning=!1,this.isPaused=!1,console.log("Timer stopped"))},i.resetTimer=function(){this.isRunning=!1,this.isPaused=!1,this.startTime=0,this.pauseTime=0,this.pausedDuration=0,this.remainingTime=this.duration,this.warningEmitted1=!1,this.warningEmitted2=!1,console.log("Timer reset")},i.getRemainingTime=function(){return this.remainingTime},i.getElapsedTime=function(){return this.duration-this.remainingTime},i.getProgress=function(){return 1-this.remainingTime/this.duration},i.setDuration=function(t){this.isRunning?console.warn("Cannot change duration while timer is running"):(this.duration=t,this.remainingTime=t)},i.addTime=function(t){this.isRunning&&(this.remainingTime+=t,this.remainingTime>this.warningTime1&&(this.warningEmitted1=!1),this.remainingTime>this.warningTime2&&(this.warningEmitted2=!1),console.log("Added "+t+"s to timer. Remaining time: "+this.remainingTime.toFixed(1)+"s"))},i.update=function(t){if(this.isRunning&&!this.isPaused){var e=(Date.now()-this.startTime-this.pausedDuration)/1e3;this.remainingTime=Math.max(0,this.duration-e),!this.warningEmitted1&&this.remainingTime<=this.warningTime1&&(this.warningEmitted1=!0,this.emit(ix.EVENTS.TIME_WARNING,this.remainingTime),console.log("Time warning 1: "+this.remainingTime.toFixed(1)+"s remaining")),!this.warningEmitted2&&this.remainingTime<=this.warningTime2&&(this.warningEmitted2=!0,this.emit(ix.EVENTS.TIME_WARNING,this.remainingTime),console.log("Time warning 2: "+this.remainingTime.toFixed(1)+"s remaining")),this.remainingTime<=0&&(this.isRunning=!1,this.emit(ix.EVENTS.GAME_OVER),console.log("Time's up!"))}},i.on=function(t,e,i){this.eventTarget.on(t,e,i)},i.off=function(t,e,i){var n;null==(n=this.eventTarget)||n.off(t,e,i)},i.emit=function(t,e,i,n,r,o){var a;null==(a=this.eventTarget)||a.emit(t,e,i,n,r,o)},e}(o)).prototype,"duration",[oF],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return ix.GAME_DURATION}}),Sx=Mt(bx.prototype,"warningTime1",[oF],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return ix.WARNING_TIME_1}}),wx=Mt(bx.prototype,"warningTime2",[oF],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return ix.WARNING_TIME_2}}),yx=bx))||yx;t._RF.pop(),t._RF.push({},"eaf8ab4I6VMYr2n+WmMAYid","PitchUIManager",void 0);var sF,lF,cF,uF,hF,pF,dF,fF,gF,mF,vF,yF=e.ccclass,bF=e.property,_F=(Ax=yF("PitchUIManager"),Cx=bF({type:c,group:{name:"UI Screens",id:"screens"}}),Px=bF({type:c,group:{name:"UI Screens",id:"screens"}}),Mx=bF({type:c,group:{name:"UI Screens",id:"screens"}}),Ix=bF({type:c,group:{name:"UI Screens",id:"screens"}}),Nx=bF({type:c,group:{name:"Gameplay UI",id:"gameplay"}}),Lx=bF({type:y,group:{name:"Gameplay UI",id:"gameplay"}}),Ox=bF({type:y,group:{name:"Gameplay UI",id:"gameplay"}}),Rx=bF({type:y,group:{name:"Gameplay UI",id:"gameplay"}}),xx=bF({type:[c],group:{name:"Feedback",id:"feedback"}}),Fx=bF({type:lt,group:{name:"Feedback",id:"feedback"}}),Dx=bF({type:y,group:{name:"Results UI",id:"results"}}),zx=bF({type:y,group:{name:"Results UI",id:"results"}}),kx=bF({type:y,group:{name:"Results UI",id:"results"}}),Vx=bF({type:x,group:{name:"Results UI",id:"results"}}),Bx=bF({type:x,group:{name:"Results UI",id:"results"}}),Ax((Gx=Mt((Ux=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return e=t.call.apply(t,[this].concat(n))||this,Nt(e,"mainMenuScreen",Gx,Lt(e)),Nt(e,"gameplayScreen",Wx,Lt(e)),Nt(e,"resultsScreen",qx,Lt(e)),Nt(e,"calibrationScreen",Zx,Lt(e)),Nt(e,"progressLine",Yx,Lt(e)),Nt(e,"timerLabel",jx,Lt(e)),Nt(e,"currentNoteLabel",Kx,Lt(e)),Nt(e,"targetNoteLabel",Xx,Lt(e)),Nt(e,"feedbackNodes",Jx,Lt(e)),Nt(e,"feedbackAnimation",Qx,Lt(e)),Nt(e,"resultsTitleLabel",$x,Lt(e)),Nt(e,"resultsTimeLabel",tF,Lt(e)),Nt(e,"resultsAccuracyLabel",eF,Lt(e)),Nt(e,"retryButton",iF,Lt(e)),Nt(e,"mainMenuButton",nF,Lt(e)),e.PROGRESS_LINE_MOVE_DURATION=.5,e.currentGameState=$R.INIT,e}It(e,t);var i=e.prototype;return i.hideAllScreens=function(){this.mainMenuScreen&&(this.mainMenuScreen.active=!1),this.gameplayScreen&&(this.gameplayScreen.active=!1),this.resultsScreen&&(this.resultsScreen.active=!1),this.calibrationScreen&&(this.calibrationScreen.active=!1)},i.showMainMenu=function(){this.hideAllScreens(),this.mainMenuScreen&&(this.mainMenuScreen.active=!0,this.currentGameState=$R.INIT)},i.showGameplay=function(t){this.hideAllScreens(),this.gameplayScreen&&(this.gameplayScreen.active=!0,this.currentGameState=$R.PLAYING,this.initializeGameplayUI())},i.showCalibration=function(){this.hideAllScreens(),this.calibrationScreen&&(this.calibrationScreen.active=!0,this.currentGameState=$R.CALIBRATING)},i.showResults=function(t,e,i){this.hideAllScreens(),this.resultsScreen&&(this.resultsScreen.active=!0,this.currentGameState=$R.GAME_OVER,this.resultsTitleLabel&&(this.resultsTitleLabel.string=t?"Success!":"Time's Up!"),this.resultsTimeLabel&&(this.resultsTimeLabel.string="Time: "+e.toFixed(1)+"s remaining"),this.resultsAccuracyLabel&&(this.resultsAccuracyLabel.string="Accuracy: "+i.toFixed(1)+"%"))},i.initializeGameplayUI=function(){this.progressLine&&this.progressLine.setPosition(new g(-200,0,0)),this.currentNoteLabel&&(this.currentNoteLabel.string=""),this.timerLabel&&(this.timerLabel.string=ix.GAME_DURATION+"s")},i.updateTargetNoteLabel=function(t){if(this.targetNoteLabel)if(null!==t){var e=ix.NOTE_NAMES[t];this.targetNoteLabel.string="Target: "+e}else this.targetNoteLabel.string=""},i.updateCurrentNoteLabel=function(t){if(this.currentNoteLabel)if(null!==t){var e=ix.NOTE_NAMES[t];this.currentNoteLabel.string="Current: "+e}else this.currentNoteLabel.string="Current: -"},i.updateTimer=function(t){this.timerLabel&&(this.timerLabel.string=Math.ceil(t)+"s",this.timerLabel.color=t<=ix.WARNING_TIME_2?new X(255,0,0,255):t<=ix.WARNING_TIME_1?new X(255,165,0,255):new X(255,255,255,255))},i.showFeedback=function(t){if(this.feedbackNodes&&this.feedbackAnimation){for(var e,i=Ft(this.feedbackNodes);!(e=i()).done;){e.value.active=!1}t>=0&&t<this.feedbackNodes.length&&(this.feedbackNodes[t].active=!0);var n=["perfect","good","miss","timeWarning"][t];this.feedbackAnimation.play(n)}},i.showTimeWarning=function(t){this.timerLabel&&this.timerLabel.node&&v(this.timerLabel.node).to(.2,{scale:new g(1.5,1.5,1.5)}).to(.2,{scale:new g(1,1,1)}).repeat(2).start(),this.showFeedback(ex.TIME_WARNING)},i.getGameState=function(){return this.currentGameState},e}(o)).prototype,"mainMenuScreen",[Cx],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Wx=Mt(Ux.prototype,"gameplayScreen",[Px],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),qx=Mt(Ux.prototype,"resultsScreen",[Mx],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Zx=Mt(Ux.prototype,"calibrationScreen",[Ix],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Yx=Mt(Ux.prototype,"progressLine",[Nx],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),jx=Mt(Ux.prototype,"timerLabel",[Lx],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Kx=Mt(Ux.prototype,"currentNoteLabel",[Ox],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Xx=Mt(Ux.prototype,"targetNoteLabel",[Rx],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Jx=Mt(Ux.prototype,"feedbackNodes",[xx],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Qx=Mt(Ux.prototype,"feedbackAnimation",[Fx],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),$x=Mt(Ux.prototype,"resultsTitleLabel",[Dx],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),tF=Mt(Ux.prototype,"resultsTimeLabel",[zx],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),eF=Mt(Ux.prototype,"resultsAccuracyLabel",[kx],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),iF=Mt(Ux.prototype,"retryButton",[Vx],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),nF=Mt(Ux.prototype,"mainMenuButton",[Bx],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Hx=Ux))||Hx);t._RF.pop(),t._RF.push({},"2f22b6bD+5Kq6ollwy3qJJ9","PitchTile",void 0);var SF,wF,TF,EF,AF,CF,PF,MF,IF,NF,LF,OF,RF,xF,FF,DF,zF,kF,VF,BF,HF,UF,GF,WF,qF,ZF,YF,jF,KF,XF,JF,QF,$F,tD,eD,iD=e.ccclass,nD=e.property,rD=(sF=iD("PitchTile"),lF=nD(f),cF=nD(B),uF=nD(f),hF=nD(B),sF((fF=Mt((dF=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return e=t.call.apply(t,[this].concat(n))||this,Nt(e,"sprite",fF,Lt(e)),Nt(e,"transform",gF,Lt(e)),Nt(e,"progressSprite",mF,Lt(e)),Nt(e,"progressTransform",vF,Lt(e)),e.note=null,e.duration=0,e.scrollSpeed=0,e.currentProgress=0,e.isActive=!1,e.gradientColors=[new X(0,255,0,150),new X(255,255,0,150),new X(0,0,0,150)],e.gradientStops=[0,.8,1],e}It(e,t);var i=e.prototype;return i.initialize=function(t,e,i){this.note=t,this.duration=e,this.scrollSpeed=i,this.currentProgress=0,this.isActive=!1;var n=e*i;this.transform&&this.transform.setContentSize(n,this.transform.height),this.updateDurationProgress(0)},i.setActive=function(t){this.isActive=t,this.progressSprite&&(this.progressSprite.color=t?this.gradientColors[2]:this.gradientColors[0])},i.getGradientColor=function(t){for(var e=0,i=0,n=0,r=0;r<this.gradientStops.length-1;r++)if(t>=this.gradientStops[r]&&t<=this.gradientStops[r+1]){e=r,i=r+1,n=(t-this.gradientStops[r])/(this.gradientStops[r+1]-this.gradientStops[r]);break}var o=this.gradientColors[e],a=this.gradientColors[i];return new X(o.r+(a.r-o.r)*n,o.g+(a.g-o.g)*n,o.b+(a.b-o.b)*n,255)},i.getProgress=function(){return this.currentProgress},i.isComplete=function(){return this.currentProgress>=1},i.getNote=function(){return this.note},i.getDuration=function(){return this.duration},i.updateDurationProgress=function(t){if(t=1-t,this.progressTransform&&this.transform){var e=this.transform.width*t;this.progressTransform.setContentSize(e,this.progressTransform.height),this.progressSprite&&(this.progressSprite.color=this.getGradientColor(t))}},e}(o)).prototype,"sprite",[lF],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),gF=Mt(dF.prototype,"transform",[cF],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),mF=Mt(dF.prototype,"progressSprite",[uF],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),vF=Mt(dF.prototype,"progressTransform",[hF],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),pF=dF))||pF);t._RF.pop(),t._RF.push({},"ed6fbHqK/JJv6q+lwtbCqxi","PitchGameplayController",void 0);var oD,aD,sD,lD,cD,uD,hD,pD,dD,fD,gD,mD=e.ccclass,vD=e.property;SF=mD("PitchGameplayController"),wF=vD(Ex),TF=vD(vx),EF=vD(aF),AF=vD(FC),CF=vD({type:c,group:{name:"Gameplay UI",id:"gameplay"}}),PF=vD({type:[c],group:{name:"Gameplay UI",id:"gameplay"}}),MF=vD({type:c,group:{name:"Gameplay UI",id:"gameplay"}}),IF=vD({type:c,group:{name:"Gameplay UI",id:"gameplay"}}),NF=vD({type:_F,group:{name:"Gameplay UI",id:"gameplay"}}),LF=vD({type:c,group:{name:"Gameplay UI",id:"gameplay"}}),OF=vD({type:c,group:{name:"Gameplay UI",id:"gameplay"}}),RF=vD({type:ct,group:{name:"Feedback",id:"feedback"}}),xF=vD({type:l,group:{name:"Scrolling",id:"scrolling"}}),FF=vD({type:c,group:{name:"Scrolling",id:"scrolling"}}),DF=vD({type:Number,group:{name:"Scrolling",id:"scrolling"}}),zF=vD({type:Number,group:{name:"Scrolling",id:"scrolling"}}),SF((BF=Mt((VF=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return e=t.call.apply(t,[this].concat(n))||this,Nt(e,"detectionSystem",BF,Lt(e)),Nt(e,"characterAnimator",HF,Lt(e)),Nt(e,"timer",UF,Lt(e)),Nt(e,"waveformVisualizer",GF,Lt(e)),Nt(e,"musicalStaff",WF,Lt(e)),Nt(e,"noteIndicators",qF,Lt(e)),Nt(e,"progressLine",ZF,Lt(e)),Nt(e,"microphone",YF,Lt(e)),Nt(e,"pitchUIManager",jF,Lt(e)),e.gameState=$R.INIT,e.currentSequence=null,e.totalNotesMatched=0,e.totalAccuracy=0,e.currentNoteIndex=0,e.currentNoteStartTime=0,e.currentNoteDuration=0,e.PERFECT_DURATION_THRESHOLD=.8,e.PROGRESS_LINE_MOVE_DURATION=.5,Nt(e,"butterfly",KF,Lt(e)),Nt(e,"butterflyCamera",XF,Lt(e)),Nt(e,"butterflyParticles",JF,Lt(e)),e.BUTTERFLY_MOVE_DURATION=1,e.BUTTERFLY_CAMERA_SPEED=300,e.butterflyTween=null,e.butterflyTargetY=-150,e.isFirstNoteCorrect=!1,e.transNotes=[],e.noteYPositions=[],Nt(e,"pitchTilePrefab",QF,Lt(e)),Nt(e,"scrollingContainer",$F,Lt(e)),Nt(e,"scrollSpeed",tD,Lt(e)),Nt(e,"tileStartX",eD,Lt(e)),e.activeTiles=[],e.tilePositions=[],e.containerPosition=0,e.targetScrollingPositionX=0,e.isScrolling=!1,e.noteIndexToTileMap=new Map,e.SCROLL_SMOOTHING_FACTOR=.1,e}It(e,t);var i=e.prototype;return i.onLoad=function(){var t=this;this.waveformVisualizer&&this.waveformVisualizer.initialize(this.microphone),dx.initialize(),this.transNotes=this.noteIndicators.map((function(t){return t.getComponent(B)}));var e=this.transNotes[0].height;this.noteYPositions=this.noteIndicators.map((function(i){return i.position.y+t.musicalStaff.position.y+e/2}))},i.start=function(){this.setupEventListeners(),this.startGame("sequence_1")},i.setupEventListeners=function(){this.detectionSystem.on(ix.EVENTS.PITCH_DETECTED,this.onPitchDetected,this),this.timer.on(ix.EVENTS.TIME_WARNING,this.onTimeWarning,this),this.timer.on(ix.EVENTS.GAME_OVER,this.onTimeUp,this)},i.extendSequenceToFillDuration=function(t){var e=ix.GAME_DURATION,i=t.getTotalDuration();if(i>=e)return t;for(var n=[].concat(t.notes),r=i;r<e;){var o=Math.floor(7*Math.random()),a=1+Math.random();n.push({note:o,duration:a}),r+=a}return new px(t.id+"_extended",t.name+" (Extended)",t.difficulty,n)},i.startGame=function(t){var e=this,i=dx.getSequenceById(t);i?(this.currentSequence=this.extendSequenceToFillDuration(i),this.totalNotesMatched=0,this.totalAccuracy=0,this.currentNoteIndex=0,this.isScrolling=!1,this.containerPosition=0,this.pitchUIManager.showGameplay(this.currentSequence),this.setupNoteIndicators(),this.initializeScrolling(),this.detectionSystem.initialize().then((function(){return e.detectionSystem.requestMicrophoneAccess()})).then((function(t){t?(e.gameState=$R.WAIT_FOR_FIRST_NOTE,e.detectionSystem.startDetection(),console.log("Game started, waiting for first note")):console.error("Failed to access microphone")})).catch((function(t){console.error("Error starting game:",t)}))):console.error("Sequence with ID "+t+" not found")},i.pauseGame=function(){this.gameState===$R.PLAYING&&(this.gameState=$R.PAUSED,this.timer.pauseTimer(),this.detectionSystem.stopDetection(),this.isScrolling=!1,console.log("Game paused"))},i.resumeGame=function(){this.gameState===$R.PAUSED&&(this.gameState=$R.PLAYING,this.timer.resumeTimer(),this.detectionSystem.startDetection(),this.isScrolling=!0,console.log("Game resumed"))},i.endGame=function(t){this.gameState=$R.GAME_OVER,this.timer.stopTimer(),this.detectionSystem.stopDetection(),this.stopScrolling();var e=this.totalNotesMatched>0?this.totalAccuracy/this.totalNotesMatched*100:0;this.pitchUIManager.showResults(t,this.timer.getRemainingTime(),e),console.log("Game ended. Success: "+t+", Accuracy: "+e.toFixed(2)+"%")},i.startCalibration=function(){var t=this;this.gameState=$R.CALIBRATING,this.pitchUIManager.showCalibration(),this.detectionSystem.initialize().then((function(){return t.detectionSystem.requestMicrophoneAccess()})).then((function(e){e?t.detectionSystem.startCalibration((function(e){e?(console.log("Calibration completed successfully"),t.pitchUIManager.showMainMenu(),t.gameState=$R.INIT):console.error("Calibration failed")})):console.error("Failed to access microphone")})).catch((function(t){console.error("Error starting calibration:",t)}))},i.onPitchDetected=function(t){if(this.gameState===$R.PLAYING||this.gameState===$R.WAIT_FOR_FIRST_NOTE){this.waveformVisualizer&&this.waveformVisualizer.updateWaveformVisualization(t.volume,t.frequency,this.detectionSystem),this.pitchUIManager.updateCurrentNoteLabel(t.note),this.moveButterfly(t.note,t.volume,t.frequency);var e=this.getCurrentTargetNote();if(null!==e&&t.note===e){var i;this.gameState===$R.WAIT_FOR_FIRST_NOTE&&(this.transitionToPlaying(),console.log("First note matched, starting timer"));var n=I.totalTime/1e3-this.currentNoteStartTime;this.currentNoteStartTime=I.totalTime/1e3,this.currentNoteDuration+=n;var r=this.currentSequence.notes[this.currentNoteIndex].duration,o=this.currentNoteDuration/r,a=(null==(i=this.tilePositions[this.currentNoteIndex])?void 0:i.x)||0,s=r*this.scrollSpeed*o;this.targetScrollingPositionX=-a-s,this.currentNoteDuration>=r?(this.updateDurationProgress(1),this.currentNoteDuration=0,this.onNoteMatched(t.note,this.calculateDurationAccuracy(r))):this.updateDurationProgress(this.currentNoteDuration/r)}else this.currentNoteStartTime=I.totalTime/1e3,this.targetScrollingPositionX=this.containerPosition}},i.calculateDurationAccuracy=function(t){return this.currentNoteDuration/t>=this.PERFECT_DURATION_THRESHOLD?tx.PERFECT:tx.GOOD},i.updateDurationProgress=function(t){var e=this.noteIndexToTileMap.get(this.currentNoteIndex);e&&e.updateDurationProgress(t)},i.onNoteMatched=function(t,e){var i;switch(this.characterAnimator.playNoteAnimation(t,e),e){case tx.PERFECT:i=ex.PERFECT;break;case tx.GOOD:i=ex.GOOD;break;default:i=ex.MISS}this.pitchUIManager.showFeedback(i),this.totalNotesMatched++,this.totalAccuracy+=e===tx.PERFECT?1:e===tx.GOOD?.7:.3,this.advanceProgressLine(),this.advanceToNextNote()||this.endGame(!0)},i.transitionToPlaying=function(){this.gameState=$R.PLAYING,this.timer.startTimer(),this.isScrolling=!0,this.activeTiles.length>0&&this.activeTiles[0].setActive(!0)},i.checkNoteDuration=function(t){if(!this.currentSequence||this.currentNoteIndex>=this.currentSequence.notes.length)return!1;var e=this.currentSequence.notes[this.currentNoteIndex];return e.note===t&&this.currentNoteDuration>=e.duration},i.onTimeWarning=function(t){this.gameState===$R.PLAYING&&this.pitchUIManager.showTimeWarning(t)},i.onTimeUp=function(){this.gameState===$R.PLAYING&&this.endGame(!1)},i.update=function(t){if(this.gameState===$R.PLAYING){if(this.pitchUIManager.updateTimer(this.timer.getRemainingTime()),this.updateScrolling(t),this.isFirstNoteCorrect&&this.butterflyCamera){var e=this.butterflyCamera.position;this.butterflyCamera.setPosition(new g(e.x+this.BUTTERFLY_CAMERA_SPEED*t,e.y,e.z))}if(this.butterfly){var i=this.butterfly.position,n=i.y+(this.butterflyTargetY-i.y)*t*2;this.butterfly.setPosition(new g(i.x,n,i.z))}}},i.returnToMainMenu=function(){this.gameState!==$R.PLAYING&&this.gameState!==$R.PAUSED||(this.timer.stopTimer(),this.detectionSystem.stopDetection(),this.stopScrolling()),this.gameState=$R.INIT,this.currentSequence=null,this.currentNoteIndex=0,this.totalNotesMatched=0,this.totalAccuracy=0,this.pitchUIManager.showMainMenu()},i.restartGame=function(){this.currentSequence&&(this.gameState!==$R.PLAYING&&this.gameState!==$R.PAUSED||(this.timer.stopTimer(),this.detectionSystem.stopDetection(),this.stopScrolling()),this.startGame(this.currentSequence.id))},i.onDestroy=function(){this.detectionSystem.off(ix.EVENTS.PITCH_DETECTED,this.onPitchDetected,this),this.timer.off(ix.EVENTS.TIME_WARNING,this.onTimeWarning,this),this.timer.off(ix.EVENTS.GAME_OVER,this.onTimeUp,this)},i.moveButterfly=function(t,e,i){if(void 0===i&&(i=0),this.butterfly&&this.noteIndicators&&this.butterflyCamera){this.butterflyTween&&(this.butterflyTween.stop(),this.butterflyTween=null);var n=-150;if(null!==t){if(t>=0&&t<this.noteIndicators.length){var r=this.noteIndicators[t];r&&r.active&&(n=this.noteYPositions[t])}this.butterflyParticles&&(this.butterflyParticles.enabled=!0,this.butterflyParticles.emissionRate=100*e)}else{if(this.noteIndicators[0]&&this.noteIndicators[6]){var o=this.noteYPositions[0]-100,a=247.22;n=o+(this.noteYPositions[6]+100-o)*Math.max(0,Math.min(1,(i-a)/276.03))}this.butterflyParticles&&(this.butterflyParticles.enabled=!1)}this.butterflyTargetY=n,this.isFirstNoteCorrect||t!==this.getCurrentTargetNote()||(this.isFirstNoteCorrect=!0,v(this.butterfly).to(this.BUTTERFLY_MOVE_DURATION,{position:new g(0,n,-20)},{easing:"cubicOut"}).start())}},i.initializeScrolling=function(){if(this.currentSequence&&this.scrollingContainer){this.clearTiles(),this.containerPosition=0,this.scrollingContainer.setPosition(new g(0,0,0));for(var t=this.currentSequence.notes,e=0;e<t.length;e++)this.createTile(t[e],e);this.isScrolling=!1,this.currentNoteStartTime=0}},i.createTile=function(t,e){if(this.pitchTilePrefab&&this.scrollingContainer){var i=A(this.pitchTilePrefab);this.scrollingContainer.addChild(i);var n=i.getComponent(rD);if(n){n.initialize(t.note,t.duration,this.scrollSpeed);var r=this.tileStartX;if(e>0&&this.tilePositions.length>0){var o=this.activeTiles[e-1];r=this.tilePositions[e-1].x+o.getDuration()*this.scrollSpeed}var a=this.noteIndicators[t.note].position.y;this.tilePositions.push({x:r,y:a}),i.setPosition(new g(r,a,0)),this.activeTiles.push(n),this.noteIndexToTileMap.set(e,n)}}},i.clearTiles=function(){for(var t,e=Ft(this.activeTiles);!(t=e()).done;){var i=t.value;i&&i.node&&i.node.destroy()}this.activeTiles=[],this.tilePositions=[],this.noteIndexToTileMap.clear()},i.updateScrolling=function(t){this.isScrolling&&this.scrollingContainer&&(this.containerPosition+=(this.targetScrollingPositionX-this.containerPosition)*this.SCROLL_SMOOTHING_FACTOR,this.scrollingContainer.setPosition(new g(this.containerPosition,0,0)))},i.stopScrolling=function(){this.isScrolling=!1;for(var t,e=Ft(this.activeTiles);!(t=e()).done;){var i=t.value;i&&i.setActive(!1)}},i.advanceToNextNote=function(){if(!this.currentSequence)return!1;if(this.currentNoteIndex++,this.currentNoteIndex<this.currentSequence.notes.length){this.pitchUIManager.updateTargetNoteLabel(this.getCurrentTargetNote()),this.highlightNoteIndicator(this.currentSequence.notes[this.currentNoteIndex].note);var t=this.noteIndexToTileMap.get(this.currentNoteIndex);return t&&t.setActive(!0),!0}return this.stopScrolling(),!1},i.advanceProgressLine=function(){if(this.progressLine&&this.currentSequence){var t=this.currentSequence.notes.length,e=400*((this.currentNoteIndex+1)/t)-200,i=this.progressLine.position;v(this.progressLine).to(this.PROGRESS_LINE_MOVE_DURATION,{position:new g(e,i.y,i.z)},{easing:"cubicOut"}).start()}},i.getCurrentTargetNote=function(){return!this.currentSequence||this.currentNoteIndex>=this.currentSequence.notes.length?null:this.currentSequence.notes[this.currentNoteIndex].note},i.getCurrentSequence=function(){return this.currentSequence},i.getGameState=function(){return this.gameState},i.getCurrentNoteIndex=function(){return this.currentNoteIndex},i.getTotalNotes=function(){return this.currentSequence?this.currentSequence.notes.length:0},i.setupNoteIndicators=function(){if(this.noteIndicators){var t=this.getCurrentSequence();if(t){for(var e,i=Ft(this.noteIndicators);!(e=i()).done;){e.value.active=!1}for(var n=t.notes,r=0;r<n.length&&r<this.noteIndicators.length;r++){var o=n[r].note;o>=0&&o<this.noteIndicators.length&&(this.noteIndicators[o].active=!0)}this.highlightNoteIndicator(n[0].note)}}},i.highlightNoteIndicator=function(t){if(this.noteIndicators){for(var e=0;e<this.noteIndicators.length;e++){var i=this.noteIndicators[e];if(i&&i.active){var n=i.getComponent(f);n&&(n.color=new X(255,255,255,0))}}if(t>=0&&t<this.noteIndicators.length){var r=this.noteIndicators[t];if(r&&r.active){var o=r.getComponent(f);o&&(o.color=new X(255,255,0,125))}}}},e}(o)).prototype,"detectionSystem",[wF],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),HF=Mt(VF.prototype,"characterAnimator",[TF],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),UF=Mt(VF.prototype,"timer",[EF],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),GF=Mt(VF.prototype,"waveformVisualizer",[AF],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),WF=Mt(VF.prototype,"musicalStaff",[CF],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),qF=Mt(VF.prototype,"noteIndicators",[PF],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),ZF=Mt(VF.prototype,"progressLine",[MF],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),YF=Mt(VF.prototype,"microphone",[IF],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),jF=Mt(VF.prototype,"pitchUIManager",[NF],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),KF=Mt(VF.prototype,"butterfly",[LF],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),XF=Mt(VF.prototype,"butterflyCamera",[OF],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),JF=Mt(VF.prototype,"butterflyParticles",[RF],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),QF=Mt(VF.prototype,"pitchTilePrefab",[xF],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),$F=Mt(VF.prototype,"scrollingContainer",[FF],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),tD=Mt(VF.prototype,"scrollSpeed",[DF],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 100}}),eD=Mt(VF.prototype,"tileStartX",[zF],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 200}}),kF=VF));t._RF.pop(),t._RF.push({},"f3079BkmKNBuLm4QMfLooBF","PopupConfirm",void 0);var yD,bD,_D,SD,wD,TD=e.ccclass,ED=e.property;oD=TD("PopupConfirm"),aD=ED(y),sD=ED(y),lD=ED(y),cD=ED(y),oD((pD=Mt((hD=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return e=t.call.apply(t,[this].concat(n))||this,Nt(e,"lbContent",pD,Lt(e)),Nt(e,"lbTitle",dD,Lt(e)),Nt(e,"lbButtonText",fD,Lt(e)),Nt(e,"lbButtonText2",gD,Lt(e)),e.callback1=null,e.callback2=null,e}It(e,t);var i=e.prototype;return i.show=function(e,i){var n,r,o;t.prototype.show.call(this,e,i),e&&(this.callback1=e.callback1,this.callback2=e.callback2,this.lbContent.string=e.message,this.lbTitle.string=null!=(n=e.title)?n:"",this.lbButtonText.string=null!=(r=e.buttonText1)?r:"Yes",this.lbButtonText2.string=null!=(o=e.buttonText2)?o:"No")},i.onTouch_One=function(){var t;null==(t=this.callback1)||t.call(this),this.doUImanagerHide()},i.onTouch_Two=function(){var t;null==(t=this.callback2)||t.call(this),this.doUImanagerHide()},e}(sr)).prototype,"lbContent",[aD],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),dD=Mt(hD.prototype,"lbTitle",[sD],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),fD=Mt(hD.prototype,"lbButtonText",[lD],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),gD=Mt(hD.prototype,"lbButtonText2",[cD],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),uD=hD));t._RF.pop(),t._RF.push({},"f3854cZ+7tJvbx0v7anFQPX","PopupLoading",void 0);var AD,CD,PD,MD,ID,ND,LD,OD,RD,xD=e.ccclass,FD=e.property;yD=xD("PopupLoading"),bD=FD(y),yD((wD=Mt((SD=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return e=t.call.apply(t,[this].concat(n))||this,Nt(e,"lbDetail",wD,Lt(e)),e}It(e,t);var i=e.prototype;return i.show=function(e,i){var n;t.prototype.show.call(this,e,i);var r=null!=(n=e)?n:"";this.lbDetail.string=r},i.setLoadingDetail=function(t){this.lbDetail.string=t},e}(sr)).prototype,"lbDetail",[bD],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),_D=SD));t._RF.pop(),t._RF.push({},"7cf33btXkBJaJszpFBOgTb7","PopupMessage",void 0);var DD,zD=e.ccclass,kD=e.property;AD=zD("PopupMessage"),CD=kD(y),PD=kD(y),MD=kD(y),AD((LD=Mt((ND=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return e=t.call.apply(t,[this].concat(n))||this,Nt(e,"lbContent",LD,Lt(e)),Nt(e,"lbTitle",OD,Lt(e)),Nt(e,"lbButtonText",RD,Lt(e)),e.confirmCallback=null,e}It(e,t);var i=e.prototype;return i.show=function(e,i){var n,r;t.prototype.show.call(this,e,i),e&&(this.confirmCallback=e.buttonCallback,this.lbContent.string=e.message,this.lbTitle.string=null!=(n=e.title)?n:"",this.lbButtonText.string=null!=(r=e.buttonText)?r:"OK")},i.onTouch_Confirm=function(){var t;null==(t=this.confirmCallback)||t.call(this),this.doUImanagerHide()},e}(sr)).prototype,"lbContent",[CD],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),OD=Mt(ND.prototype,"lbTitle",[PD],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),RD=Mt(ND.prototype,"lbButtonText",[MD],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ID=ND));t._RF.pop(),t._RF.push({},"5dbfcHQoVlExKN0FBFCoDEW","PopupShouldLogin",void 0);var VD,BD=e.ccclass;e.property,BD("PopupShouldLogin")(DD=function(t){function e(){return t.apply(this,arguments)||this}It(e,t);var i=e.prototype;return i.onTouch_PlayNow=function(){this.doUImanagerHide()},i.onTouch_Login=function(){this.doUImanagerHide()},e}(sr));t._RF.pop(),t._RF.push({},"be613BiyadMYYQcjSzr/JtE","Bullet",void 0);var HD=e.ccclass,UD=(e.property,HD("Bullet")(VD=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).gravity=-18,e.elapsedTime=0,e.initialVelocity=new g(0,0,0),e.initialPosition=new g,e}It(e,t);var i=e.prototype;return i.shootWithVelocity=function(t){this.gravity=-me.GAME.PHYSIC_GRAVITY,this.elapsedTime=0,this.initialVelocity=t,this.initialPosition.set(this.node.position)},i.stop=function(){this.initialVelocity=g.ZERO.clone()},i.update=function(t){this.elapsedTime+=t;var e=this.calculatePosition(this.elapsedTime);this.node.setPosition(e)},i.calculatePosition=function(t){var e=new g;return e.x=this.initialPosition.x+this.initialVelocity.x*t,e.y=this.initialPosition.y+this.initialVelocity.y*t+.5*this.gravity*t*t,e.z=this.initialPosition.z+this.initialVelocity.z*t,e},e}(o))||VD);t._RF.pop(),t._RF.push({},"ac60c1uuSNLz566NcMsAduq","MathUtil",void 0);var GD,WD,qD,ZD,YD,jD,KD,XD,JD,QD,$D,tz,ez,iz,nz,rz,oz,az=180/Math.PI,sz=Math.PI/180,lz=function(){function t(){}return t.radiansToDegrees=function(t){return t*az},t.degreesToRadians=function(t){return t*sz},t.clamp=function(t,e,i){return t<e?e:t>i?i:t},t.clamp01=function(e){return t.clamp(e,0,1)},t.lerp=function(e,i,n){return e+(i-e)*t.clamp01(n)},t.step=function(t,e){return e<t?0:1},t.smoothStep=function(e,i,n){return i*(n=-2*(n=t.clamp01(n))*n*n+3*n*n)+e*(1-n)},t.smoothDamp=function(e,i,n,r,o,a){o=null!=o?o:Number.POSITIVE_INFINITY,a=null!=a?a:I.deltaTime;var s=2/(r=Math.max(1e-4,r)),l=s*a,c=1/(1+l+.47999998927116394*l*l+.23499999940395355*l*l*l),u=e-i,h=i,p=o*r,d=t.clamp(u,-p,p),f=(n+s*d)*a,g=(n-s*f)*c,m=(i=e-d)+(d+f)*c;return h-e>0==m>h&&(g=((m=h)-h)/a),{value:m,velocity:g}},xt(t,null,[{key:"rad2Deg",get:function(){return az}},{key:"deg2Rad",get:function(){return sz}}]),t}();t._RF.pop(),t._RF.push({},"ee594FJk7xOGo9n2U0Qsd54","CameraController",void 0);var cz=e.ccclass,uz=e.property;GD=cz("CameraController"),WD=uz({type:c,displayName:"摄像机节点"}),qD=uz({type:c,displayName:"目标节点"}),ZD=uz({displayName:"最小距离"}),YD=uz({displayName:"最大距离"}),jD=uz({displayName:"平滑时间"}),KD=uz({displayName:"鼠标滚轮敏感度"}),XD=uz({displayName:"双指触摸敏感度"}),GD(($D=Mt((QD=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return e=t.call.apply(t,[this].concat(n))||this,Nt(e,"cameraNode",$D,Lt(e)),Nt(e,"targetNode",tz,Lt(e)),Nt(e,"minDistance",ez,Lt(e)),Nt(e,"maxDistance",iz,Lt(e)),Nt(e,"smoothTime",nz,Lt(e)),Nt(e,"mouseSensitivity",rz,Lt(e)),Nt(e,"touchSensitivity",oz,Lt(e)),e.currentValue=0,e.targetValue=0,e.currentVelocity=0,e.lastTouchesDistance=null,e.tempVec3=new g,e}It(e,t);var i=e.prototype;return i.onLoad=function(){this.init(),this.registerEvent()},i.onDestroy=function(){this.unregisterEvent()},i.registerEvent=function(){S.platform===S.Platform.MOBILE_BROWSER?(D.on(z.EventType.TOUCH_MOVE,this.onTouchMove,this),D.on(z.EventType.TOUCH_END,this.onTouchEnd,this)):D.on(z.EventType.MOUSE_WHEEL,this.onMouseWheel,this)},i.unregisterEvent=function(){S.platform===S.Platform.MOBILE_BROWSER?(D.off(z.EventType.TOUCH_MOVE,this.onTouchMove,this),D.off(z.EventType.TOUCH_END,this.onTouchEnd,this)):D.off(z.EventType.MOUSE_WHEEL,this.onMouseWheel,this)},i.init=function(){var t;this.cameraNode.lookAt(this.targetNode.getWorldPosition()),t=S.platform===S.Platform.MOBILE_BROWSER?15:8,this.setTarget(t)},i.onMouseWheel=function(t){var e=t.getScrollY()*this.mouseSensitivity;this.setTarget(this.targetValue-e)},i.onTouchMove=function(t){var e=t.getAllTouches();if(!(e.length<2)){var i=K.distance(e[0].getLocation(),e[1].getLocation());if(null!==this.lastTouchesDistance){var n=(i-this.lastTouchesDistance)*this.touchSensitivity;this.setTarget(this.targetValue-n)}this.lastTouchesDistance=i}},i.onTouchEnd=function(t){this.lastTouchesDistance=null},i.update=function(t){if(this.currentValue!==this.targetValue){var e=lz.smoothDamp(this.currentValue,this.targetValue,this.currentVelocity,this.smoothTime);this.currentVelocity=e.velocity,this.setCurrent(e.value)}},i.setCurrent=function(t){var e=g.subtract(this.tempVec3,this.cameraNode.getWorldPosition(),this.targetNode.getWorldPosition());e.normalize().multiplyScalar(t),this.cameraNode.setWorldPosition(e),this.currentValue=t},i.setTarget=function(t){this.targetValue=lz.clamp(t,this.minDistance,this.maxDistance)},e}(o)).prototype,"cameraNode",[WD],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),tz=Mt(QD.prototype,"targetNode",[qD],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ez=Mt(QD.prototype,"minDistance",[ZD],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 5}}),iz=Mt(QD.prototype,"maxDistance",[YD],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 50}}),nz=Mt(QD.prototype,"smoothTime",[jD],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.1}}),rz=Mt(QD.prototype,"mouseSensitivity",[KD],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.05}}),oz=Mt(QD.prototype,"touchSensitivity",[XD],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return.05}}),JD=QD));t._RF.pop(),t._RF.push({},"cc22b8mSmVF0q6lb6/6cNhf","ProjectileMath",void 0);var hz=180/Math.PI,pz=Math.PI/180,dz=function(){function t(){}return t.calculateTotalTime=function(t,e,i){var n=e*pz;return t/(i*Math.cos(n))},t.calculateAngleAtMoment=function(e,i,n,r){void 0===r&&(r=!1);var o=t.gravity,a=e*pz,s=i*Math.cos(a),l=i*Math.sin(a)-o*n,c=Math.atan(l/s);return r?c:c*hz},t.calculateDisplacementAtMoment=function(e,i,n){var r=t.gravity,o=e*pz;return{x:i*Math.cos(o)*n,y:i*Math.sin(o)*n-.5*r*Math.pow(n,2)}},t.calculateWithAngle=function(t,e,i){var n=me.GAME.PHYSIC_GRAVITY,r=i*pz,o=2*t*Math.sin(r)*Math.cos(r)-2*e*Math.pow(Math.cos(r),2);return o<0?NaN:Math.sqrt(n*Math.pow(t,2)/o)},t.calculateWithVelocity=function(e,i,n){var r=t.gravity,o=n,a=Math.pow(o,2),s=Math.pow(o,4)-r*(r*Math.pow(e,2)+2*i*a);if(s<0)return{angle1:NaN,angle2:NaN};var l=Math.sqrt(s),c=Math.atan((-a+l)/(-r*e)),u=Math.atan((-a-l)/(-r*e));return{angle1:c*hz,angle2:u*hz}},t.calculateWithMaxHeight=function(e,i,n){var r=t.gravity,o=n;if(o<0||o-i<0)return{angle:NaN,velocity:NaN,time:NaN};var a=Math.sqrt(2*r*o),s=Math.sqrt(2*r*(o-i)),l=(-a+s)/-r,c=(-a-s)/-r,u=Math.max(l,c),h=Math.atan(a*u/e),p=a/Math.sin(h);return{angle:h*hz,velocity:p,time:u}},xt(t,null,[{key:"gravity",get:function(){return me.GAME.PHYSIC_GRAVITY}}]),t}();t._RF.pop(),t._RF.push({},"59f54A7NwlOiY/boc9L5zON","VectorUtil",void 0);var fz,gz,mz,vz,yz,bz,_z,Sz,wz,Tz=180/Math.PI,Ez=new g,Az=function(){function t(){}return t.projectOnPlane=function(t,e){var i=g.dot(t,e),n=Ez.set(e).multiplyScalar(i);return g.subtract(new g,t,n)},t.signedAngle=function(e,i,n){var r=t.projectOnPlane(e,n),o=t.projectOnPlane(i,n),a=r.normalize(),s=o.normalize(),l=g.cross(new g,a,s).normalize(),c=g.dot(l,n);return Math.acos(g.dot(a,s))*c*Tz},t}();t._RF.pop(),t._RF.push({},"01c94oOie9EDZDjFFfzDe9j","TrajectoryDrawer",void 0);var Cz,Pz,Mz,Iz,Nz,Lz,Oz,Rz,xz,Fz,Dz,zz,kz,Vz,Bz,Hz,Uz,Gz,Wz,qz,Zz,Yz,jz,Kz,Xz,Jz,Qz,$z=e.ccclass,tk=e.property,ek=(fz=$z("TrajectoryDrawer"),gz=tk({type:l,displayName:"prefab"}),mz=tk({displayName:"fixedQuantity"}),vz=tk({visible:function(){return this.fixedQuantity},displayName:"quantity"}),fz((_z=Mt((bz=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return e=t.call.apply(t,[this].concat(n))||this,Nt(e,"prefab",_z,Lt(e)),Nt(e,"fixedQuantity",Sz,Lt(e)),Nt(e,"quantity",wz,Lt(e)),e.points=[],e.nodePool=new nt,e.tempVec3=new g,e.tempQuat=new St,e}It(e,t);var i=e.prototype;return i.draw=function(t,e,i,n,r,o){var a,s=g.subtract(new g,e,t),l=Az.projectOnPlane(s,g.UP),c=null!=r?r:l.length(),u=dz.calculateTotalTime(c,i,n)/(a=this.fixedQuantity?Math.ceil(this.quantity):Math.max(8,Math.ceil(3*c)));this.producePoints(a);for(var h=l.normalize(),p=this.points,d=this.tempVec3,f=this.tempQuat,m=0;m<a;m++){var v=p[m];v.active=!0;var y=(m+1)*u,b=dz.calculateDisplacementAtMoment(i,n,y),_=b.x,S=b.y,w=t.clone();w.add(d.set(h).multiplyScalar(_)),w.add(d.set(g.UP).multiplyScalar(S)),v.setWorldPosition(w);var T=St.fromViewUp(f,h,g.UP),E=-dz.calculateAngleAtMoment(i,n,y,!0);St.rotateX(T,T,E),v.setWorldRotation(T)}},i.clear=function(){this.producePoints(0)},i.setColor=function(t){var e=this.prefab.data.getComponent(ht);e||(e=this.prefab.data.getComponentInChildren(ht)),e&&e.sharedMaterial.setProperty("mainColor",t)},i.producePoints=function(t){var e=this.points;if(e.length<t)for(var i=t-e.length;i>0;)e.push(this.getPoint()),i--;else if(e.length>t)for(var n=e.length-t;n>0;)this.putPoint(e.pop()),n--},i.getPoint=function(){var t;return(t=this.nodePool.size()>0?this.nodePool.get():A(this.prefab)).setParent(this.node),t},i.putPoint=function(t){this.nodePool.size()<50?this.nodePool.put(t):t.destroy()},e}(o)).prototype,"prefab",[gz],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Sz=Mt(bz.prototype,"fixedQuantity",[mz],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),wz=Mt(bz.prototype,"quantity",[vz],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 20}}),yz=bz))||yz);t._RF.pop(),t._RF.push({},"af3dac0xL5BLrK8YABTwvI2","Cannon",void 0);var ik,nk,rk,ok,ak,sk,lk,ck=e.ccclass,uk=e.property,hk=function(t){return t[t.FIXED_ALL=1]="FIXED_ALL",t[t.FIXED_PITCH_ANGLE=2]="FIXED_PITCH_ANGLE",t[t.FIXED_VELOCITY=3]="FIXED_VELOCITY",t[t.UNFIXED=4]="UNFIXED",t}(hk||{}),pk=(Cz=ck("Cannon"),Pz=uk({type:c,displayName:"yawAxis",group:{name:"Configs",id:"1"}}),Mz=uk({type:c,displayName:"pitchAxis",group:{name:"Configs",id:"1"}}),Iz=uk({type:c,displayName:"firePoint",group:{name:"Configs",id:"1"}}),Nz=uk({type:l,displayName:"bulletPrefab",group:{name:"model",id:"2"}}),Lz=uk({type:c,group:{name:"model",id:"2"}}),Oz=uk({type:O(hk),displayName:"mode",group:{name:"settings",id:"3"}}),Rz=uk({displayName:"fixedPitchAngle",visible:function(){return this.mode===hk.FIXED_PITCH_ANGLE||this.mode===hk.FIXED_ALL},group:{name:"settings",id:"3"}}),xz=uk({displayName:"fixedVelocity",visible:function(){return this.mode===hk.FIXED_VELOCITY||this.mode===hk.FIXED_ALL},group:{name:"settings",id:"3"}}),Fz=uk({displayName:"useSmallPitchAngle",visible:function(){return this.mode===hk.FIXED_VELOCITY},group:{name:"settings",id:"3"}}),Dz=uk({type:ek,displayName:"trajectoryDrawer",group:{name:"trajectory",id:"4"}}),zz=uk({displayName:"showTrajectory",visible:function(){return null!=this.trajectoryDrawer},group:{name:"trajectory",id:"4"}}),kz=uk({type:[st],group:{name:"Animation",id:"5"}}),Cz((Hz=Mt((Bz=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return e=t.call.apply(t,[this].concat(n))||this,Nt(e,"yawAxis",Hz,Lt(e)),Nt(e,"pitchAxis",Uz,Lt(e)),Nt(e,"firePoint",Gz,Lt(e)),Nt(e,"bulletPrefab",Wz,Lt(e)),Nt(e,"bulletContainer",qz,Lt(e)),Nt(e,"mode",Zz,Lt(e)),Nt(e,"fixedPitchAngle",Yz,Lt(e)),Nt(e,"fixedVelocity",jz,Lt(e)),Nt(e,"useSmallPitchAngle",Kz,Lt(e)),Nt(e,"trajectoryDrawer",Xz,Lt(e)),Nt(e,"_showTrajectory",Jz,Lt(e)),e.velocity=0,e.curTargetPos=new g(0,.753,-7.671),Nt(e,"shootAnimations",Qz,Lt(e)),e.shootAnimationState=[],e}It(e,t);var i=e.prototype;return i.rotateTo=function(t,e){this.pitch=t,this.yaw=e},i.aim=function(t){this.curTargetPos.set(t);var e=g.subtract(new g,t,this.mainPosition),i=-Az.signedAngle(e,this.mainForward,this.mainUp),n=NaN,r=NaN,o=NaN,a=!1;switch(this.mode){case hk.FIXED_ALL:n=this.fixedPitchAngle,o=this.fixedVelocity,a=!0;break;case hk.FIXED_PITCH_ANGLE:n=this.fixedPitchAngle,o=this.calculateVelocity(t,-n);break;case hk.FIXED_VELOCITY:o=this.fixedVelocity;var s=this.calculateAngle(t,o),l=s.angle1,c=s.angle2;isNaN(l)||isNaN(c)?a=!0:n=this.useSmallPitchAngle?-Math.min(l,c):-Math.max(l,c);break;case hk.UNFIXED:var u=this.calculateWithMaxHeight(t);n=-u.angle,o=u.velocity,r=u.time}return isNaN(n)&&(n=this.pitch),this.rotateTo(n,i),isNaN(o)||(this.velocity=o),this.trajectoryDrawer&&this.drawTrajectory(t,-this.pitch,this.velocity,a),{time:r,velocity:o,pitchAngle:n}},i.fire=function(t){var e=0;t&&(e=this.aim(t).time);var i=this.shoot(this.velocity);return v(this.yawAxis).to(.1,{position:m(0,-.1,.035)}).to(.35,{position:m(0,0,0)},{easing:_.quartOut}).start(),{flyTime:e,bullet:i}},i.shoot=function(t){var e=this.generateBullet(),i=e.forward.negative();i.multiplyScalar(t);var n=e.getComponent(UD);return n.shootWithVelocity(i),n},i.drawTrajectory=function(t,e,i,n){var r=this.firePoint.getWorldPosition();if(n){var o=dz.calculateDisplacementAtMoment(e,i,2).x;this.trajectoryDrawer.draw(r,t,e,i,o)}else this.trajectoryDrawer.draw(r,t,e,i)},i.generateBullet=function(){var t=A(this.bulletPrefab);return M.getScene().addChild(t),t.setWorldPosition(this.firePoint.getWorldPosition()),t.setWorldRotation(this.firePoint.getWorldRotation()),t},i.calculateDisplacement=function(t){var e=this.firePoint.getWorldPosition(),i=g.subtract(new g,t,e),n=i.y;return{horizontal:Az.projectOnPlane(i,g.UP).length(),vertical:n}},i.calculateVelocity=function(t,e){var i=this.calculateDisplacement(t),n=i.horizontal,r=i.vertical;return dz.calculateWithAngle(n,r,e)},i.calculateAngle=function(t,e){var i=this.calculateDisplacement(t),n=i.horizontal,r=i.vertical;return dz.calculateWithVelocity(n,r,e)},i.calculateWithMaxHeight=function(t){var e=this.calculateDisplacement(t),i=e.horizontal,n=e.vertical,r=Math.max(.5,n+.3*i);return dz.calculateWithMaxHeight(i,n,r)},i.fireWithAnimation=function(t,e){var i=this;this.shootAnimationState=[],this.shootAnimations.forEach((function(t){var e=t.getState("Shoot");e.speed=1,e.time=0,e.play(),i.shootAnimationState.push(e)})),this.scheduleOnce((function(){var n=i.fire(t),r=n.flyTime,o=n.bullet;i.scheduleOnce((function(){null==e||e(o)}),r),Yi.instance.playSound("sfx_CannonWars_Shoot")}),.6)},xt(e,[{key:"showTrajectory",get:function(){return this._showTrajectory},set:function(t){this._showTrajectory=t,this.trajectoryDrawer&&(t?this.curTargetPos&&this.aim(this.curTargetPos):this.trajectoryDrawer.clear())}},{key:"pitch",get:function(){return this.pitchAxis.eulerAngles.x},set:function(t){this.pitchAxis.setRotationFromEuler(t,0,0)}},{key:"yaw",get:function(){return this.yawAxis.eulerAngles.y},set:function(t){this.yawAxis.setRotationFromEuler(0,t,0)}},{key:"mainPosition",get:function(){return this.yawAxis.getWorldPosition()}},{key:"mainForward",get:function(){return this.yawAxis.parent.forward.negative()}},{key:"mainUp",get:function(){return this.yawAxis.up}}],[{key:"Mode",get:function(){return hk}}]),e}(o)).prototype,"yawAxis",[Pz],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Uz=Mt(Bz.prototype,"pitchAxis",[Mz],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Gz=Mt(Bz.prototype,"firePoint",[Iz],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Wz=Mt(Bz.prototype,"bulletPrefab",[Nz],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),qz=Mt(Bz.prototype,"bulletContainer",[Lz],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Zz=Mt(Bz.prototype,"mode",[Oz],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return hk.FIXED_PITCH_ANGLE}}),Yz=Mt(Bz.prototype,"fixedPitchAngle",[Rz],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return-45}}),jz=Mt(Bz.prototype,"fixedVelocity",[xz],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return 5}}),Kz=Mt(Bz.prototype,"useSmallPitchAngle",[Fz],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Xz=Mt(Bz.prototype,"trajectoryDrawer",[Dz],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Jz=Mt(Bz.prototype,"_showTrajectory",[uk],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),Mt(Bz.prototype,"showTrajectory",[zz],Object.getOwnPropertyDescriptor(Bz.prototype,"showTrajectory"),Bz.prototype),Qz=Mt(Bz.prototype,"shootAnimations",[kz],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return[]}}),Vz=Bz))||Vz);t._RF.pop(),t._RF.push({},"3e784wgXb5FD6qDmQMPWi5v","Cursor",void 0);var dk,fk,gk,mk,vk,yk,bk,_k=e.ccclass,Sk=e.property,wk=(ik=_k("Cursor"),nk=Sk({displayName:"adaptToSurface"}),rk=Sk({type:c,displayName:"referNode",visible:function(){return this.adaptToSurface}}),ik((sk=Mt((ak=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return e=t.call.apply(t,[this].concat(n))||this,Nt(e,"_adaptToSurface",sk,Lt(e)),Nt(e,"referNode",lk,Lt(e)),e.tempVec3=new g,e.tempQuat=new St,e}return It(e,t),e.prototype.set=function(t,e){if(this.node.setWorldPosition(t),this.adaptToSurface&&e){var i,n,r=null!=(i=null==(n=this.referNode)?void 0:n.getWorldPosition())?i:g.ZERO,o=g.subtract(this.tempVec3,t,r),a=Az.projectOnPlane(o,e).normalize(),s=St.fromViewUp(this.tempQuat,a,e);this.node.setWorldRotation(s)}},xt(e,[{key:"adaptToSurface",get:function(){return this._adaptToSurface},set:function(t){this._adaptToSurface=t,t||this.node.setWorldRotation(St.fromEuler(new St,0,0,0))}}]),e}(o)).prototype,"_adaptToSurface",[Sk],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!1}}),Mt(ak.prototype,"adaptToSurface",[nk],Object.getOwnPropertyDescriptor(ak.prototype,"adaptToSurface"),ak.prototype),lk=Mt(ak.prototype,"referNode",[rk],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),ok=ak))||ok);t._RF.pop(),t._RF.push({},"b1385xAyyhPB6TsvEBSW4MY","EffectManger",void 0);var Tk,Ek,Ak,Ck,Pk,Mk,Ik,Nk,Lk,Ok=e.ccclass,Rk=e.property,xk=e.executionOrder;dk=Ok("EffectManger"),fk=xk(-1),gk=Rk({type:l,displayName:"炮弹爆炸效果预制体"}),dk(mk=fk(((bk=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return e=t.call.apply(t,[this].concat(n))||this,Nt(e,"bulletExplosionPrefab",yk,Lt(e)),e}It(e,t);var i=e.prototype;return i.onLoad=function(){e._instance=this},i.onDestroy=function(){e._instance===this&&(e._instance=null)},i.playBulletExplosion=function(t){var e=A(this.bulletExplosionPrefab);M.getScene().addChild(e),e.setWorldPosition(t),this.scheduleOnce((function(){return e.destroy()}),1)},xt(e,null,[{key:"instance",get:function(){return this._instance}}]),e}(o))._instance=null,yk=Mt((vk=bk).prototype,"bulletExplosionPrefab",[gk],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),mk=vk))||mk);t._RF.pop(),t._RF.push({},"065763s9dBIZrOHBYD+VlHO","ProjectileController",void 0);var Fk,Dk,zk,kk,Vk,Bk,Hk,Uk=e.ccclass,Gk=e.property;Tk=Uk("ProjectileController"),Ek=Gk({type:_t}),Ak=Gk({type:pk}),Ck=Gk({type:wk}),Tk((Ik=Mt((Mk=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return e=t.call.apply(t,[this].concat(n))||this,Nt(e,"camera",Ik,Lt(e)),Nt(e,"cannon",Nk,Lt(e)),Nt(e,"cursor",Lk,Lt(e)),e.isActive=!1,e.aimValue={value:0},e.tweenAim=null,e.beginAimPosition=null,e.targetAimPosition=null,e}It(e,t);var i=e.prototype;return i.onLoad=function(){},i.onDestroy=function(){},i.update=function(t){this.updateAimPosition(t)},i.registerEvent=function(){S.platform===S.Platform.MOBILE_BROWSER?(D.on(z.EventType.TOUCH_START,this.onTouchStart,this),D.on(z.EventType.TOUCH_MOVE,this.onTouchMove,this),D.on(z.EventType.TOUCH_END,this.onTouchEnd,this)):(D.on(z.EventType.MOUSE_DOWN,this.onMouseDown,this),D.on(z.EventType.MOUSE_MOVE,this.onMouseMove,this),D.on(z.EventType.MOUSE_UP,this.onMouseUp,this))},i.unregisterEvent=function(){S.platform===S.Platform.MOBILE_BROWSER?(D.off(z.EventType.TOUCH_START,this.onTouchStart,this),D.off(z.EventType.TOUCH_MOVE,this.onTouchMove,this),D.off(z.EventType.TOUCH_END,this.onTouchEnd,this)):(D.off(z.EventType.MOUSE_DOWN,this.onMouseDown,this),D.off(z.EventType.MOUSE_MOVE,this.onMouseMove,this),D.off(z.EventType.MOUSE_UP,this.onMouseUp,this))},i.onTouchStart=function(t){t.getAllTouches().length>1||this.aimWithScreenPos(t.getLocation())},i.onTouchMove=function(t){t.getAllTouches().length>1||this.aimWithScreenPos(t.getLocation())},i.onTouchEnd=function(t){t.getAllTouches().length>0||(this.aimWithScreenPos(t.getLocation()),this.fire())},i.onMouseDown=function(t){this.aimWithScreenPos(t.getLocation())},i.onMouseMove=function(t){this.aimWithScreenPos(t.getLocation())},i.onMouseUp=function(t){this.fire()},i.aimWithScreenPos=function(t){if(this.isActive){var e=this.camera.screenPointToRay(t.x,t.y);if(wt.instance.raycastClosest(e)){var i=wt.instance.raycastClosestResult,n=i.hitPoint,r=i.hitNormal;this.cannon.aim(n),this.cursor.set(n,r)}}},i.aimToPosition=function(t,e,i){var n,r=this;if(void 0===e&&(e=0),void 0===i&&(i=null),e<=0)return this.cannon.aim(t),void this.cursor.set(t,g.FORWARD);this.aimValue.value=0,this.beginAimPosition=this.cannon.curTargetPos.clone(),this.targetAimPosition=t.clone(),null==(n=this.tweenAim)||n.stop(),this.tweenAim=v(this.aimValue).to(e,{value:1}).call((function(){r.tweenAim=null,r.cannon.aim(r.targetAimPosition),r.cursor.set(r.targetAimPosition,g.FORWARD),null==i||i()})).start()},i.updateAimPosition=function(t){if(null!==this.tweenAim){var e=g.lerp(new g,this.beginAimPosition,this.targetAimPosition,this.aimValue.value);this.cannon.aim(e),this.cursor.set(e,g.FORWARD)}},i.fire=function(){this.cannon.fire()},e}(o)).prototype,"camera",[Ek],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Nk=Mt(Mk.prototype,"cannon",[Ak],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Lk=Mt(Mk.prototype,"cursor",[Ck],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),Pk=Mk));t._RF.pop(),t._RF.push({},"a48dbUuDTJPDp+LzPEDK4rA","ClickToLoadUrl",void 0);var Wk,qk,Zk,Yk,jk,Kk,Xk,Jk,Qk,$k,tV,eV,iV,nV,rV,oV,aV,sV,lV,cV,uV,hV,pV,dV=e.ccclass,fV=e.property;Fk=dV("ClickToLoadUrl"),Dk=fV({multiline:!0}),zk=fV({tooltip:"是否使用新窗口打开"}),Fk((Bk=Mt((Vk=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return e=t.call.apply(t,[this].concat(n))||this,Nt(e,"url",Bk,Lt(e)),Nt(e,"openInNewTap",Hk,Lt(e)),e}It(e,t);var i=e.prototype;return i.onLoad=function(){this.registerEvent()},i.onDestroy=function(){this.unregisterEvent()},i.registerEvent=function(){this.node.on(c.EventType.TOUCH_END,this.onClick,this)},i.unregisterEvent=function(){this.node.off(c.EventType.TOUCH_END,this.onClick,this)},i.onClick=function(){var t=this.url;t&&""!==t&&(this.openInNewTap?window.open(t):window.location.href=t)},e}(o)).prototype,"url",[Dk],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return"https://gitee.com/ifaswind"}}),Hk=Mt(Vk.prototype,"openInNewTap",[zk],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return!0}}),kk=Vk));t._RF.pop(),t._RF.push({},"1b4097H5s5E1YZkd5DJRPR9","HUD_Options",void 0);var gV,mV,vV,yV,bV,_V=e.ccclass,SV=e.property;Wk=_V("HUD_Options"),qk=SV({type:c}),Zk=SV({type:c}),Yk=SV({type:Tt}),jk=SV({type:et}),Kk=SV({type:et}),Xk=SV({type:k}),Jk=SV({type:k}),Qk=SV({type:k}),$k=SV({type:pk}),tV=SV({type:wk}),Wk((nV=Mt((iV=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return e=t.call.apply(t,[this].concat(n))||this,Nt(e,"content",nV,Lt(e)),Nt(e,"arrow",rV,Lt(e)),Nt(e,"cannonModeToggleContainer",oV,Lt(e)),Nt(e,"cannonAngleEditBox",aV,Lt(e)),Nt(e,"cannonVelocityEditBox",sV,Lt(e)),Nt(e,"cannonTrajectoryToggle",lV,Lt(e)),Nt(e,"bulletExplodeToggle",cV,Lt(e)),Nt(e,"cursorAdaptToggle",uV,Lt(e)),Nt(e,"cannon",hV,Lt(e)),Nt(e,"cursor",pV,Lt(e)),e}It(e,t);var i=e.prototype;return i.onLoad=function(){this.init(),this.registerEvent()},i.onDestroy=function(){this.unregisterEvent()},i.registerEvent=function(){this.node.on(c.EventType.TOUCH_END,this.onTouchEnd,this)},i.unregisterEvent=function(){this.node.off(c.EventType.TOUCH_END,this.onTouchEnd,this)},i.onTouchEnd=function(t){this.changeState(!this.content.active)},i.init=function(){S.platform===S.Platform.MOBILE_BROWSER?this.node.setScale(new g(2,2,1)):this.node.setScale(new g(1,1,1)),this.changeState(!0);for(var t=pk.Mode[this.cannon.mode],e=this.cannonModeToggleContainer.toggleItems,i=0;i<e.length;i++)e[i].node.name===t&&(e[i].isChecked=!0);this.cannonAngleEditBox.string=this.cannon.fixedPitchAngle.toString(),this.cannonAngleEditBox.placeholder=this.cannon.fixedPitchAngle.toString(),this.cannonVelocityEditBox.string=this.cannon.fixedVelocity.toString(),this.cannonVelocityEditBox.placeholder=this.cannon.fixedVelocity.toString(),this.cannonTrajectoryToggle.isChecked=this.cannon.showTrajectory,this.bulletExplodeToggle.isChecked=UD.triggerExplode,this.cursorAdaptToggle.isChecked=this.cursor.adaptToSurface,this.changeState(!1)},i.changeState=function(t){this.content.active=t,this.arrow.angle=t?180:0},i.onCannonModeToggleChanged=function(t){switch(this.cannonModeToggleContainer.activeToggles()[0].node.name){case"FIXED_ALL":this.cannon.mode=pk.Mode.FIXED_ALL,this.cannonAngleEditBox.node.parent.active=!0,this.cannonVelocityEditBox.node.parent.active=!0;break;case"FIXED_PITCH_ANGLE":this.cannon.mode=pk.Mode.FIXED_PITCH_ANGLE,this.cannonAngleEditBox.node.parent.active=!0,this.cannonVelocityEditBox.node.parent.active=!1;break;case"FIXED_VELOCITY":this.cannon.mode=pk.Mode.FIXED_VELOCITY,this.cannonAngleEditBox.node.parent.active=!1,this.cannonVelocityEditBox.node.parent.active=!0;break;case"UNFIXED":this.cannon.mode=pk.Mode.UNFIXED,this.cannonAngleEditBox.node.parent.active=!1,this.cannonVelocityEditBox.node.parent.active=!1}},i.onCannonAngleEditBoxChanged=function(t){var e=Number(this.cannonAngleEditBox.string);isNaN(e)||e>0?this.cannonAngleEditBox.string=this.cannon.fixedPitchAngle.toString():this.cannon.fixedPitchAngle=e},i.onCannonVelocityEditBoxChanged=function(t){var e=Number(this.cannonVelocityEditBox.string);isNaN(e)||e<=0?this.cannonVelocityEditBox.string=this.cannon.fixedVelocity.toString():this.cannon.fixedVelocity=e},i.onCannonTrajectoryToggleChanged=function(t){var e=this.cannonTrajectoryToggle.isChecked;this.cannon.showTrajectory=e},i.onBulletExplodeToggleChanged=function(t){var e=this.bulletExplodeToggle.isChecked;UD.triggerExplode=e},i.onCursorAdaptToggleChanged=function(t){var e=this.cursorAdaptToggle.isChecked;this.cursor.adaptToSurface=e},e}(o)).prototype,"content",[qk],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),rV=Mt(iV.prototype,"arrow",[Zk],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),oV=Mt(iV.prototype,"cannonModeToggleContainer",[Yk],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),aV=Mt(iV.prototype,"cannonAngleEditBox",[jk],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),sV=Mt(iV.prototype,"cannonVelocityEditBox",[Kk],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),lV=Mt(iV.prototype,"cannonTrajectoryToggle",[Xk],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),cV=Mt(iV.prototype,"bulletExplodeToggle",[Jk],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),uV=Mt(iV.prototype,"cursorAdaptToggle",[Qk],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),hV=Mt(iV.prototype,"cannon",[$k],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),pV=Mt(iV.prototype,"cursor",[tV],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),eV=iV));t._RF.pop(),t._RF.push({},"8d90ax9dDlNL5GpGoJYpjmB","HUD_Tips",void 0);var wV=e.ccclass,TV=e.property;gV=wV("HUD_Tips"),mV=TV({type:y}),gV((bV=Mt((yV=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return e=t.call.apply(t,[this].concat(n))||this,Nt(e,"label",bV,Lt(e)),e}It(e,t);var i=e.prototype;return i.onLoad=function(){this.init()},i.init=function(){S.platform===S.Platform.MOBILE_BROWSER?(this.node.setScale(new g(1.5,1.5,1)),this.label.string="双指滑动可以调整摄像机距离"):(this.node.setScale(new g(1,1,1)),this.label.string="鼠标滚轮可以调整摄像机距离")},e}(o)).prototype,"label",[mV],{configurable:!0,enumerable:!0,writable:!0,initializer:function(){return null}}),vV=yV));t._RF.pop(),t._RF.push({},"298c3IQrZBP6Lx7XE+N393z","type",void 0);var EV=function(t){return t[t.Min=0]="Min",t[t.Max=1]="Max",t[t.Fixed=2]="Fixed",t[t.Texture=3]="Texture",t}({});EV._name="ConcretePrecisionType";var AV=function(t){return t[t.Texture2D=100]="Texture2D",t[t.TextureCube=101]="TextureCube",t}({});AV._name="TextureConcretePrecision";var CV=function(t){return t[t.Local=0]="Local",t[t.View=1]="View",t[t.World=2]="World",t}({});CV._name="PositionSpace";var PV=function(t){return t[t.Local=0]="Local",t[t.View=1]="View",t[t.World=2]="World",t}({});PV._name="NormalSpace";var MV=function(t){return t[t.Local=0]="Local",t[t.View=1]="View",t[t.World=2]="World",t}({});MV._name="ViewDirSpace",t._RF.pop(),t._RF.push({},"7ceabXBz/tABa7CTXDAMxJn","utils",void 0);var IV=globalThis.electron,NV=IV&&globalThis.require("fs-extra"),LV=IV&&globalThis.require("path");function OV(t){if("number"!=typeof t)return t;var e=t+"";return e.includes(".")||(e+="."),e}var RV=["x","y","z","w"],xV=["r","g","b","a"],FV=["e00","e01","e02","e03"];function DV(t,e){return OV(function(t,e){return"number"==typeof t?t:(void 0!==t.x?i=RV:void 0!==t.r?i=xV:void 0!==t.e00&&(i=FV),t[i[e]]||0);var i}(t,e))}function zV(t){var e=1;return"object"==typeof t&&(void 0!==t.w||void 0!==t.a?e=4:void 0!==t.z||void 0!==t.b?e=3:void 0!==t.y||void 0!==t.g?e=2:void 0!==t.m_SerializedTexture?e=AV.Texture2D:void 0!==t.m_SerializedCubemap&&(e=AV.TextureCube)),e}function kV(t,e){var i="";return"boolean"===e?i="bool":1===t?i="float":2===t?i="vec2":3===t?i="vec3":4===t?i="vec4":t===AV.Texture2D?i="sampler2D":t===AV.TextureCube&&(i="samplerCube"),i}function VV(t,e,i,n,r){void 0===r&&(r={});var o={display:t,default:e,type:i,connectType:n};return Object.assign(o,r),o}function BV(t,e,i,n){void 0===n&&(n={});var r={display:t,default:e,type:i};return Object.assign(r,n),r}function HV(t,e){return("CC_"+t._name.replace("Space","")+"_"+t[e]).toUpperCase()}function UV(t,e){return"#define "+HV(t,e)+" 1"}function GV(t,e){var i,n;return(i=t,n=Object.getOwnPropertyNames(i),n.filter((function(t){return Number.isNaN(Number.parseFloat(t))&&"_name"!==t}))).forEach((function(i){var n=HV(t,t[i]);e.includes(n)||(e+="#define "+n+" 0\n")})),e}t._RF.pop(),t._RF.push({},"b05a8ea74hDTb7wArT51Kxn","property",void 0);var WV=function(t){return t.Float="Float",t.Boolean="Boolean",t.Vector2="Vector2",t.Vector3="Vector3",t.Vector4="Vector4",t.Color="Color",t.Texture2D="Texture2D",t.TextureCube="TextureCube",t}({}),qV=function(){function t(t){this.details={menu:"",style:{headerColor:"#ec7063"}},this.name="",this.type=WV.Float,this.value=0,this.outputs=[],this.type="string"==typeof t?WV[t]:t,this.name=WV[t],this.details.menu=this.name,this.updateDefaultValue()}var e=t.prototype;return e.setValue=function(t){this.value instanceof Et?this.value.set(t):this.type===WV.Texture2D||this.type===WV.TextureCube?this.value._uuid=t.uuid:this.value=t},e.updateDefaultValue=function(){switch(this.type){case WV.Float:this.value=0,this.outputs=[VV("Out",this.value,"float","vector")];break;case WV.Boolean:this.value=!1,this.outputs=[VV("Out",this.value,"boolean","boolean")];break;case WV.Vector2:this.value=new K,this.outputs=[VV("Out",this.value,"vec2","vector")];break;case WV.Vector3:this.value=new g,this.outputs=[VV("Out",this.value,"vec3","vector")];break;case WV.Vector4:this.value=new Ct,this.outputs=[VV("Out",this.value,"vec4","vector")];break;case WV.Color:this.value=new X,this.outputs=[VV("Out",this.value,"color","vector")];break;case WV.Texture2D:this.value=new p,this.outputs=[VV("Out",this.value,"texture2D","texture2D")];break;case WV.TextureCube:this.value=new At,this.outputs=[VV("Out",this.value,"textureCube","textureCube")]}},e.isTexture=function(){switch(this.type){case WV.Texture2D:case WV.TextureCube:return!0}return!1},xt(t,[{key:"concretePrecision",get:function(){return zV(this.value)}}]),t}();t._RF.pop(),t._RF.push({},"663baRF6QZFi6zhc8Qt66NF","register",void 0);var ZV=new Map,YV=new Map,jV=new Map;function KV(t){return function(e){var i=new e,n=Object.getPrototypeOf(i.constructor).name,r={type:i.type,extend:n,details:t,node:i.data};"PropertyNode"===i.type&&function(t){for(var e in YV.clear(),WV){var i=WV[e];if("string"==typeof i){var n=new qV(i);n.type=i,YV.set(i,{type:i,declareType:t,name:n.name,outputs:n.outputs,default:n.value,details:n.details})}}}(i.type),jV.set(i.type,e),ZV.set(i.type,r)}}t._RF.pop(),t._RF.push({},"ca808INO7FLGrJCNKRU+Sjn","index",void 0),t._RF.pop(),t._RF.push({},"130e0LrRvNOq7GOFf5/5IGV","context",void 0);var XV=new(function(){function t(){this.shaderTemplatesDir=void 0,this.allNodes=[],this.properties=[],this.localVars=[],this.getLocalVars=[]}return t.prototype.reset=function(){this.allNodes.length=0,this.properties.length=0,this.localVars.length=0,this.getLocalVars.length=0},t}());t._RF.pop(),t._RF.push({},"37bc8lcJkpAuZFrukwcAg+H","slot",void 0);var JV=0,QV=function(t){return t[t.Input=0]="Input",t[t.Output=1]="Output",t}({}),$V=function(){function t(t,e){this.data=void 0,this.globalID=0,this.id=0,this.displayName="",this.type=QV.Input,this.defaultValue=void 0,this.value=void 0,this.connectSlots=[],this.node=void 0,this._concretePrecision=-1,this.displayName=t.display,this.defaultValue=t.default,t.default instanceof Et?this.value=t.default.clone():this.value=t.default,this.data=t,this.node=e,this.globalID=JV++}return xt(t,[{key:"connectSlot",get:function(){var t=this.connectSlots[0];return t&&XV.getLocalVars.includes(t.node)?XV.localVars.find((function(e){return e.name===t.node.name})).inputs[0].connectSlot:this.connectSlots[0]},set:function(t){this.connectSlots.length=0,t&&(this.connectSlots[0]=t)}},{key:"connectNode",get:function(){return this.connectSlot&&this.connectSlot.node}},{key:"varName",get:function(){var t;return null!=(t=this.node)&&t.isPropertyNode?this.node.name:"var_"+this.globalID}},{key:"varDefine",get:function(){var t=kV(this.concretePrecision,this.data.type);return t&&(t+=" "),t+this.varName}},{key:"precisionName",get:function(){return kV(this.concretePrecision,this.data.type)}},{key:"isVector",get:function(){return"vector"===this.data.connectType}},{key:"slotValue",get:function(){var t=this.defaultConcretePrecision,e=this.concretePrecision,i="";if(this.connectSlot){if(t=this.connectSlot.concretePrecision,i=this.connectSlot.varName,this.isVector&&e!==t)if(e<t)1===e?i+=".x":2===e?i+=".xy":3===e&&(i+=".xyz");else if(1!==t){for(var n=e-t,r=[],o=0;o<n;o++)r.push("0.");i+=", "+r.join(", ")}}else{var a=this.value;if(this.isVector){var s=DV(a,0),l=DV(a,1),c=DV(a,2),u=DV(a,3);"object"!=typeof a&&(s=OV(a)),t=zV(a);for(var h=[s,l,c,u],p=[],d=0;d<e;d++)p.push(void 0===h[d]?0:h[d]);i=p.join(", ")}else i=a}var f=""+i;return this.isVector&&(2===e?f="vec2("+i+")":3===e?f="vec3("+i+")":4===e&&(f="vec4("+i+")")),f}},{key:"defaultConcretePrecision",get:function(){var t=1,e=this.defaultValue;return"object"==typeof e&&(void 0!==e.w?t=4:void 0!==e.z?t=3:void 0!==e.y&&(t=2)),t}},{key:"concretePrecision",get:function(){if(-1===this._concretePrecision){var t,e=this.defaultValue;if(void 0===e)null!=(t=this.node)&&t.isPropertyNode&&(e=this.node.property.value);void 0===e&&console.error("Slot Value is undefined, concrete precision maybe wrong."),this._concretePrecision=zV(e)}return this._concretePrecision}}]),t}();t._RF.pop(),t._RF.push({},"d0751arZzVMdrvnQr4rAMJC","base",void 0);var tB,eB=function(t,e){this.value=void 0,this.data=void 0,this.value=t instanceof Et?t.clone():t,this.data=e},iB=function(){function t(){this.priority=0,this.uuid="",this.slots=[],this.depChunks=[],this.defines=[],this.isMasterNode=!1,this.isPropertyNode=!1,this.concretePrecisionType=EV.Min,this.fixedConcretePrecision=0,this.inputs=[],this.outputs=[],this.props=new Map,this.data={}}var e=t.prototype;return e.init=function(){var t=this;this.slots.length=0,this.inputs.length=0,this.outputs.length=0,this.data.inputs&&this.data.inputs.forEach((function(e){var i=new $V(e,t);t.inputs.push(i),t.slots.push(i)})),this.data.outputs&&this.data.outputs.forEach((function(e){var i=new $V(e,t);t.outputs.push(i),t.slots.push(i)})),this.data.props&&this.data.props.forEach((function(e){var i=new eB(e.default,e);t.props.set(e.display,i)}))},e.beforeGenreateCode=function(){},e.addDependency=function(t){t!==this&&(this.deps.includes(t)||this.deps.push(t))},e.calcConcretePrecision=function(){var t=this;if(this.fixedConcretePrecision>0&&this.slots.forEach((function(e){e._concretePrecision=t.fixedConcretePrecision})),this.concretePrecisionType!==EV.Fixed){var e=1;this.concretePrecisionType===EV.Min?(e=999,this.inputs.forEach((function(t){var i=t.concretePrecision;t.connectSlot&&(i=t.connectSlot.concretePrecision),e=Math.min(e,i)}))):this.concretePrecisionType===EV.Max?(e=-999,this.inputs.forEach((function(t){var i=t.concretePrecision;t.connectSlot&&(i=t.connectSlot.concretePrecision),e=Math.max(e,i)}))):this.concretePrecisionType===EV.Texture?e=AV.Texture2D:console.error("Not supported ConcretePrecisionType : "+this.concretePrecisionType),this.slots.forEach((function(t){t._concretePrecision=e}))}},e.setPriority=function(t){this.priority=Math.max(t,this.priority);for(var e=0;e<this.deps.length;e++)this.deps[e].setPriority(this.priority+1)},e.getPropWithName=function(t){var e;return this.props&&(e=this.props.get(t)),e||new eB(null,null)},e.getSlotWithSlotName=function(t){return this.slots.find((function(e){return e.displayName===t}))},e.getOutputSlotWithSlotName=function(t){return this.outputs.find((function(e){return e.displayName===t}))},e.getOutputVarName=function(t){return this.outputs[t].varName},e.getOutputVarDefine=function(t){return this.outputs[t].varDefine},e.getInputValue=function(t){return this.inputs[t].slotValue},e.generateCode=function(){return""},xt(t,[{key:"type",get:function(){return this.constructor.name}},{key:"deps",get:function(){var t=[];return this.inputs.forEach((function(e){e.connectSlot&&t.push(e.connectSlot.node)})),t}}]),t}();t._RF.pop(),t._RF.push({},"21fbes9bMJN6oBb3TRVMZZ3","boolean",void 0);var nB;KV({menu:"Input/Basic/Boolean",title:"Boolean"})(tB=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).concretePrecisionType=EV.Fixed,e.data={inputs:[VV("In",0,"float","vector")],outputs:[VV("Out",0,"float","vector")]},e}It(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0);return"\n            "+this.getOutputVarDefine(0)+" = "+t+";\n        "},e}(iB));t._RF.pop(),t._RF.push({},"68e4bUVUSRHKo5B3bmMbsMV","float",void 0);var rB;KV({menu:"Input/Basic/Float",title:"Float"})(nB=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).concretePrecisionType=EV.Fixed,e.data={inputs:[VV("In",0,"float","vector")],outputs:[VV("Out",0,"float","vector")]},e}It(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0);return"\n            "+this.getOutputVarDefine(0)+" = "+t+";\n        "},e}(iB));t._RF.pop(),t._RF.push({},"263a8VilSVCp4Eyo8YtLJnX","slider",void 0);var oB;KV({menu:"Input/Basic/Slider",title:"Slider"})(rB=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).concretePrecisionType=EV.Fixed,e.data={inputs:[VV("In",0,"float","vector")],outputs:[VV("Out",0,"float","vector")]},e}It(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0);return"\n            "+this.getOutputVarDefine(0)+" = "+t+";\n        "},xt(e,[{key:"type",get:function(){return"Slider"}}]),e}(iB));t._RF.pop(),t._RF.push({},"7f058nmp+ZIQ6FPIyLJ3wpK","vector2",void 0);var aB;KV({menu:"Input/Basic/Vector2",title:"Vector2"})(oB=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).concretePrecisionType=EV.Fixed,e.data={inputs:[VV("X",0,"float","vector"),VV("Y",0,"float","vector")],outputs:[VV("Out",K.ZERO,"vec2","vector")]},e}It(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0),e=this.getInputValue(1);return"\n            "+this.getOutputVarDefine(0)+" = vec2("+t+", "+e+");\n        "},e}(iB));t._RF.pop(),t._RF.push({},"99486WpmApIPoULZGXK9dCS","vector3",void 0);var sB;KV({menu:"Input/Basic/Vector3",title:"Vector3"})(aB=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).concretePrecisionType=EV.Fixed,e.data={inputs:[VV("X",0,"float","vector"),VV("Y",0,"float","vector"),VV("Z",0,"float","vector")],outputs:[VV("Out",g.ZERO,"vec3","vector")]},e}It(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0),e=this.getInputValue(1),i=this.getInputValue(2);return"\n            "+this.getOutputVarDefine(0)+" = vec3("+t+", "+e+", "+i+");\n        "},e}(iB));t._RF.pop(),t._RF.push({},"4e4e9VghSdMAohxS4AJDF0m","vector4",void 0);var lB;KV({menu:"Input/Basic/Vector4",title:"Vector4"})(sB=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).concretePrecisionType=EV.Fixed,e.data={inputs:[VV("X",0,"float","vector"),VV("Y",0,"float","vector"),VV("Z",0,"float","vector"),VV("W",0,"float","vector")],outputs:[VV("Out",Ct.ZERO,"vec4","vector")]},e}It(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0),e=this.getInputValue(1),i=this.getInputValue(2),n=this.getInputValue(3);return"\n            "+this.getOutputVarDefine(0)+" = vec4("+t+", "+e+", "+i+", "+n+");\n        "},e}(iB));t._RF.pop(),t._RF.push({},"bf087/OgI9HIaIKP+ZWp/tU","absolute",void 0);var cB;KV({menu:"Math/Advanced/Absolute",title:"Absolute"})(lB=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[VV("In",Ct.ZERO,"vec4","vector")],outputs:[VV("Out",Ct.ZERO,"vec4","vector")]},e}It(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0);return"\n            "+this.getOutputVarDefine(0)+" = abs("+t+");\n        "},e}(iB));t._RF.pop(),t._RF.push({},"5c4913KTCJGjqbcTxcC/UmQ","exponential",void 0);var uB;KV({menu:"Math/Advanced/Exponential",title:"Exponential"})(cB=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[VV("In",Ct.ZERO,"vec4","vector")],outputs:[VV("Out",Ct.ZERO,"vec4","vector")]},e}It(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0);return"\n            "+this.getOutputVarDefine(0)+" = exp("+t+");\n        "},e}(iB));t._RF.pop(),t._RF.push({},"d16658ODu5NPKUU74aU5bA5","length",void 0);var hB;KV({menu:"Math/Advanced/Length",title:"Length"})(uB=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[VV("In",Ct.ZERO,"vec4","vector")],outputs:[VV("Out",Ct.ZERO,"vec4","vector")]},e}It(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0);return"\n            "+this.getOutputVarDefine(0)+" = length("+t+");\n        "},e}(iB));t._RF.pop(),t._RF.push({},"40ca6yOjaJE8J+qRdu62/Jd","log",void 0);var pB;KV({menu:"Math/Advanced/Log",title:"Log"})(hB=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[VV("In",Ct.ZERO,"vec4","vector")],outputs:[VV("Out",Ct.ZERO,"vec4","vector")]},e}It(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0);return"\n            "+this.getOutputVarDefine(0)+" = log("+t+");\n        "},e}(iB));t._RF.pop(),t._RF.push({},"20807G1bipGRriFOGyGJxbW","modulo",void 0);var dB;KV({menu:"Math/Advanced/Modulo",title:"Modulo"})(pB=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[VV("A",Ct.ZERO,"vec4","vector"),VV("B",Ct.ZERO,"vec4","vector")],outputs:[VV("Out",Ct.ZERO,"vec4","vector")]},e}It(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0),e=this.getInputValue(1);return"\n            "+this.getOutputVarDefine(0)+" = mod("+t+", "+e+");\n        "},e}(iB));t._RF.pop(),t._RF.push({},"1b741yPEQlEVL911xSY0qGi","negate",void 0);var fB;KV({menu:"Math/Advanced/Negate",title:"Negate"})(dB=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[VV("In",Ct.ZERO,"vec4","vector")],outputs:[VV("Out",Ct.ZERO,"vec4","vector")]},e}It(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0);return"\n            "+this.getOutputVarDefine(0)+" = -"+t+";\n        "},e}(iB));t._RF.pop(),t._RF.push({},"00775HyBCRKYqjtgTFMEtIo","normalize",void 0);var gB;KV({menu:"Math/Advanced/Normalize",title:"Normalize"})(fB=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[VV("In",Ct.ZERO,"vec4","vector")],outputs:[VV("Out",Ct.ZERO,"vec4","vector")]},e}It(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0);return"\n            "+this.getOutputVarDefine(0)+" = normalize("+t+");\n        "},e}(iB));t._RF.pop(),t._RF.push({},"83ac4Oj/INHY7tCCfwuaa6d","posterize",void 0);var mB;KV({menu:"Math/Advanced/Posterize",title:"Posterize"})(gB=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[VV("In",Ct.ZERO,"vec4","vector"),VV("Steps",Ct.ZERO,"vec4","vector")],outputs:[VV("Out",Ct.ZERO,"vec4","vector")]},e}It(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0),e=this.getInputValue(1);return"\n            "+this.getOutputVarDefine(0)+" = floor("+t+" / (1. / "+e+")) * (1. / "+e+");\n        "},e}(iB));t._RF.pop(),t._RF.push({},"eae1erXirxEXq46sl0FpxV0","reciprocal-square",void 0);var vB;KV({menu:"Math/Advanced/ReciprocalSquare",title:"ReciprocalSquare"})(mB=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[VV("In",Ct.ZERO,"vec4","vector")],outputs:[VV("Out",Ct.ZERO,"vec4","vector")]},e}It(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0);return"\n            "+this.getOutputVarDefine(0)+" = 1. / ("+t+" * "+t+");\n        "},e}(iB));t._RF.pop(),t._RF.push({},"5e330r2wGBAfouLL0jpsqul","reciprocal",void 0);var yB;KV({menu:"Math/Advanced/Reciprocal",title:"Reciprocal"})(vB=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[VV("In",Ct.ZERO,"vec4","vector")],outputs:[VV("Out",Ct.ZERO,"vec4","vector")]},e}It(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0);return"\n            "+this.getOutputVarDefine(0)+" = 1. / "+t+";\n        "},e}(iB));t._RF.pop(),t._RF.push({},"37762nev7BLgIRh9U7rJXkP","add",void 0);var bB;KV({menu:"Math/Basic/Add",title:"Add"})(yB=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).concretePrecisionType=EV.Max,e.data={inputs:[VV("A",Ct.ZERO,"vec4","vector"),VV("B",Ct.ZERO,"vec4","vector")],outputs:[VV("Out",Ct.ZERO,"vec4","vector")]},e}It(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0),e=this.getInputValue(1);return"\n            "+this.getOutputVarDefine(0)+" = "+t+" + "+e+";\n        "},e}(iB));t._RF.pop(),t._RF.push({},"027926d68NB7rx2YRTbh0wu","divide",void 0);var _B;KV({menu:"Math/Basic/Divide",title:"Divide"})(bB=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).concretePrecisionType=EV.Max,e.data={inputs:[VV("A",Ct.ZERO,"vec4","vector"),VV("B",Ct.ZERO,"vec4","vector")],outputs:[VV("Out",Ct.ZERO,"vec4","vector")]},e}It(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0),e=this.getInputValue(1);return"\n            "+this.getOutputVarDefine(0)+" = "+t+" / "+e+";\n        "},e}(iB));t._RF.pop(),t._RF.push({},"eb609R33glDfpL2KytmHUQe","multiply",void 0);var SB;KV({menu:"Math/Basic/Multiply",title:"Multiply"})(_B=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).concretePrecisionType=EV.Max,e.data={inputs:[VV("A",Ct.ZERO,"vec4","vector"),VV("B",Ct.ZERO,"vec4","vector")],outputs:[VV("Out",Ct.ZERO,"vec4","vector")]},e}It(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0),e=this.getInputValue(1);return"\n            "+this.getOutputVarDefine(0)+" = "+t+" * "+e+";\n        "},e}(iB));t._RF.pop(),t._RF.push({},"94eaaC4omdHcaTHrDX60+tq","power",void 0);var wB;KV({menu:"Math/Basic/Power",title:"Power"})(SB=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).concretePrecisionType=EV.Fixed,e.data={inputs:[VV("A",Ct.ZERO,"vec4","vector"),VV("B",Ct.ZERO,"vec4","vector")],outputs:[VV("Out",Ct.ZERO,"vec4","vector")]},e}It(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0),e=this.getInputValue(1);return"\n            "+this.getOutputVarDefine(0)+" = pow("+t+", "+e+");\n        "},e}(iB));t._RF.pop(),t._RF.push({},"861eejAxE9Kk5MHkzbOdXlI","square",void 0);var TB;KV({menu:"Math/Basic/Square",title:"Square"})(wB=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[VV("A",Ct.ZERO,"vec4","vector")],outputs:[VV("Out",Ct.ZERO,"vec4","vector")]},e}It(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0);return"\n            "+this.getOutputVarDefine(0)+" = sqrt("+t+");\n        "},e}(iB));t._RF.pop(),t._RF.push({},"5fbb9DNFjJODZFHdbDe+csv","substract",void 0);var EB;KV({menu:"Math/Basic/Substract",title:"Substract"})(TB=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).concretePrecisionType=EV.Max,e.data={inputs:[VV("A",Ct.ZERO,"vec4","vector"),VV("B",Ct.ZERO,"vec4","vector")],outputs:[VV("Out",Ct.ZERO,"vec4","vector")]},e}It(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0),e=this.getInputValue(1);return"\n            "+this.getOutputVarDefine(0)+" = "+t+" - "+e+";\n        "},e}(iB));t._RF.pop(),t._RF.push({},"a9e8cu/8AxJgqL6Mn6GY7sg","ddx",void 0);var AB;KV({menu:"Math/Derivative/DDX",title:"DDX"})(EB=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[VV("In",Ct.ZERO,"vec4","vector")],outputs:[VV("Out",Ct.ZERO,"vec4","vector")]},e}It(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0);return"\n            "+this.getOutputVarDefine(0)+" = dFdx("+t+");\n        "},e}(iB));t._RF.pop(),t._RF.push({},"ec1afn79wpEi5T7OYFN+OIo","ddxy",void 0);var CB;KV({menu:"Math/Derivative/DDXY",title:"DDXY"})(AB=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[VV("In",Ct.ZERO,"vec4","vector")],outputs:[VV("Out",Ct.ZERO,"vec4","vector")]},e}It(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0);return"\n            "+this.getOutputVarDefine(0)+" = abs(dFdx("+t+")) + abs(dFdy("+t+"));\n        "},e}(iB));t._RF.pop(),t._RF.push({},"8231cetsI5JAKl/k454/49j","ddy",void 0);var PB;KV({menu:"Math/Derivative/DDY",title:"DDY"})(CB=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[VV("In",Ct.ZERO,"vec4","vector")],outputs:[VV("Out",Ct.ZERO,"vec4","vector")]},e}It(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0);return"\n            "+this.getOutputVarDefine(0)+" = dFdy("+t+");\n        "},e}(iB));t._RF.pop(),t._RF.push({},"c589fRsjwlOb5Fzx0G64yl/","inverse-lerp",void 0);var MB;KV({menu:"Math/Interpolation/InverseLerp",title:"InverseLerp"})(PB=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[VV("A",Ct.ZERO,"vec4","vector"),VV("B",Ct.ZERO,"vec4","vector"),VV("T",Ct.ZERO,"vec4","vector")],outputs:[VV("Out",Ct.ZERO,"vec4","vector")]},e}It(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0),e=this.getInputValue(1),i=this.getInputValue(2);return"\n            "+this.getOutputVarDefine(0)+" = ("+i+" - "+t+") / ("+e+" - "+t+");\n        "},e}(iB));t._RF.pop(),t._RF.push({},"0583aaFcfFDfr3SugrLLX4t","lerp",void 0);var IB;KV({menu:"Math/Interpolation/Lerp",title:"Lerp"})(MB=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).concretePrecisionType=EV.Max,e.data={inputs:[VV("A",Ct.ZERO,"vec4","vector"),VV("B",Ct.ZERO,"vec4","vector"),VV("T",Ct.ZERO,"vec4","vector")],outputs:[VV("Out",Ct.ZERO,"vec4","vector")]},e}It(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0),e=this.getInputValue(1),i=this.getInputValue(2);return"\n            "+this.getOutputVarDefine(0)+" = mix("+t+", "+e+", "+i+");\n        "},e}(iB));t._RF.pop(),t._RF.push({},"d4d9cMuNpBHKICVJVXTyXRO","smoothstep",void 0);var NB;KV({menu:"Math/Interpolation/Smoothstep",title:"Smoothstep"})(IB=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[VV("Edge1",Ct.ZERO,"vec4","vector"),VV("Edge2",Ct.ZERO,"vec4","vector"),VV("In",Ct.ZERO,"vec4","vector")],outputs:[VV("Out",Ct.ZERO,"vec4","vector")]},e}It(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0),e=this.getInputValue(1),i=this.getInputValue(2);return"\n            "+this.getOutputVarDefine(0)+" = smoothstep("+t+", "+e+", "+i+");\n        "},e}(iB));t._RF.pop(),t._RF.push({},"4637audjsFPEKaBJvnUsO5t","clamp",void 0);var LB;KV({menu:"Math/Range/Clamp",title:"Clamp"})(NB=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[VV("In",Ct.ZERO,"vec4","vector"),VV("Min",Ct.ZERO,"vec4","vector"),VV("Max",Ct.ZERO,"vec4","vector")],outputs:[VV("Out",Ct.ZERO,"vec4","vector")]},e}It(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0),e=this.getInputValue(1),i=this.getInputValue(2);return"\n            "+this.getOutputVarDefine(0)+" = clamp("+t+", "+e+", "+i+");\n        "},e}(iB));t._RF.pop(),t._RF.push({},"1be9a5SW39Pr7Ypuq6zuC9D","fraction",void 0);var OB;KV({menu:"Math/Range/Fraction",title:"Fraction"})(LB=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[VV("In",Ct.ZERO,"vec4","vector")],outputs:[VV("Out",Ct.ZERO,"vec4","vector")]},e}It(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0);return"\n            "+this.getOutputVarDefine(0)+" = fract("+t+");\n        "},e}(iB));t._RF.pop(),t._RF.push({},"6e8a0vJMJZHLaTkO3zIBxfl","max",void 0);var RB;KV({menu:"Math/Range/Max",title:"Max"})(OB=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[VV("A",Ct.ZERO,"vec4","vector"),VV("B",Ct.ZERO,"vec4","vector")],outputs:[VV("Out",Ct.ZERO,"vec4","vector")]},e}It(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0),e=this.getInputValue(1);return"\n            "+this.getOutputVarDefine(0)+" = max("+t+", "+e+");\n        "},e}(iB));t._RF.pop(),t._RF.push({},"65629wgX7ZFlosarXfPMufw","min",void 0);var xB;KV({menu:"Math/Range/Min",title:"Min"})(RB=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[VV("A",Ct.ZERO,"vec4","vector"),VV("B",Ct.ZERO,"vec4","vector")],outputs:[VV("Out",Ct.ZERO,"vec4","vector")]},e}It(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0),e=this.getInputValue(1);return"\n            "+this.getOutputVarDefine(0)+" = min("+t+", "+e+");\n        "},e}(iB));t._RF.pop(),t._RF.push({},"cd61fVd7UJBB6ngXO+30nVS","one-minus",void 0);var FB;KV({menu:"Math/Range/OneMinus",title:"OneMinus"})(xB=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[VV("In",Ct.ZERO,"vec4","vector")],outputs:[VV("Out",Ct.ZERO,"vec4","vector")]},e}It(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0);return"\n            "+this.getOutputVarDefine(0)+" = 1. - "+t+";\n        "},e}(iB));t._RF.pop(),t._RF.push({},"33710RUTT1JXZDzqyhgRRxS","random-range",void 0);var DB;KV({menu:"Math/Range/RandomRange",title:"RandomRange"})(FB=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).concretePrecisionType=EV.Fixed,e.depChunks=["range"],e.data={inputs:[VV("seed",K.ZERO,"vec2","vector"),VV("minv",0,"float","vector"),VV("maxv",0,"float","vector")],outputs:[VV("Out",0,"float","vector")]},e}It(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0),e=this.getInputValue(1),i=this.getInputValue(2);return this.getOutputVarDefine(0)+" = RandomRange("+t+", "+e+", "+i+");"},e}(iB));t._RF.pop(),t._RF.push({},"c8987U3zUlCXZn8OW+mTz8j","remap",void 0);var zB;KV({menu:"Math/Range/Remap",title:"Remap"})(DB=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).concretePrecisionType=EV.Max,e.data={inputs:[VV("In",Ct.ZERO,"vec4","vector"),VV("InMinMax",K.ZERO,"vec2","vector"),VV("OutMinMax",K.ZERO,"vec2","vector")],outputs:[VV("Out",Ct.ZERO,"vec4","vector")]},e}It(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0),e=this.getInputValue(1),i=this.getInputValue(2);return"\n            "+this.getOutputVarDefine(0)+" = "+i+".x + ("+t+" - "+e+".x) * ("+i+".y - "+i+".x) / ("+e+".y - "+e+".x);\n        "},e}(iB));t._RF.pop(),t._RF.push({},"28c0baw9D1DwrDezfnwuGKN","saturate",void 0);var kB;KV({menu:"Math/Range/Saturate",title:"Saturate"})(zB=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[VV("In",Ct.ZERO,"vec4","vector")],outputs:[VV("Out",Ct.ZERO,"vec4","vector")]},e}It(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0);return"\n            "+this.getOutputVarDefine(0)+" = saturate("+t+");\n        "},e}(iB));t._RF.pop(),t._RF.push({},"9c519gjpitF6YbEaQTLOEve","ceil",void 0);var VB;KV({menu:"Math/Round/Ceil",title:"Ceil"})(kB=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[VV("In",Ct.ZERO,"vec4","vector")],outputs:[VV("Out",Ct.ZERO,"vec4","vector")]},e}It(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0);return"\n            "+this.getOutputVarDefine(0)+" = ceil("+t+");\n        "},e}(iB));t._RF.pop(),t._RF.push({},"ee049iD/ZRMAqYgcXswPl0X","floor",void 0);var BB;KV({menu:"Math/Round/Floor",title:"Floor"})(VB=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[VV("In",Ct.ZERO,"vec4","vector")],outputs:[VV("Out",Ct.ZERO,"vec4","vector")]},e}It(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0);return"\n            "+this.getOutputVarDefine(0)+" = floor("+t+");\n        "},e}(iB));t._RF.pop(),t._RF.push({},"62b43+zJdRCqaCEyKSYFKtF","round",void 0);var HB;KV({menu:"Math/Round/Round",title:"Round"})(BB=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[VV("In",Ct.ZERO,"vec4","vector")],outputs:[VV("Out",Ct.ZERO,"vec4","vector")]},e}It(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0);return"\n            "+this.getOutputVarDefine(0)+" = floor("+t+" + 0.5);\n        "},e}(iB));t._RF.pop(),t._RF.push({},"48af6KxjgJDrLG+h1577MoC","sign",void 0);var UB;KV({menu:"Math/Round/Sign",title:"Sign"})(HB=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[VV("In",Ct.ZERO,"vec4","vector")],outputs:[VV("Out",Ct.ZERO,"vec4","vector")]},e}It(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0);return"\n            "+this.getOutputVarDefine(0)+" = sign("+t+");\n        "},e}(iB));t._RF.pop(),t._RF.push({},"2b4cb9lBRBMqrQTPqc1e+XN","step",void 0);var GB;KV({menu:"Math/Round/Step",title:"Step"})(UB=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[VV("Edge",Ct.ZERO,"vec4","vector"),VV("In",Ct.ZERO,"vec4","vector")],outputs:[VV("Out",Ct.ZERO,"vec4","vector")]},e}It(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0),e=this.getInputValue(1);return"\n            "+this.getOutputVarDefine(0)+" = step("+t+", "+e+");\n        "},e}(iB));t._RF.pop(),t._RF.push({},"96ddfY+NwRNKa+F0/nHJXIw","truncate",void 0);var WB;KV({menu:"Math/Round/Truncate",title:"Truncate"})(GB=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[VV("In",Ct.ZERO,"vec4","vector")],outputs:[VV("Out",Ct.ZERO,"vec4","vector")]},e}It(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0);return"\n            "+this.getOutputVarDefine(0)+" = trunc("+t+");\n        "},e}(iB));t._RF.pop(),t._RF.push({},"d296eo8ejhAz4SJ+Afh3Ceo","arccosine",void 0);var qB;KV({menu:"Math/Trigonometry/Arccosine",title:"Arccosine"})(WB=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[VV("In",Ct.ZERO,"vec4","vector")],outputs:[VV("Out",Ct.ZERO,"vec4","vector")]},e}It(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0);return"\n            "+this.getOutputVarDefine(0)+" = acos("+t+");\n        "},e}(iB));t._RF.pop(),t._RF.push({},"63135dmizRJ4Jf8BpVKF+Wm","arcsine",void 0);var ZB;KV({menu:"Math/Trigonometry/Arcsine",title:"Arcsine"})(qB=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[VV("In",Ct.ZERO,"vec4","vector")],outputs:[VV("Out",Ct.ZERO,"vec4","vector")]},e}It(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0);return"\n            "+this.getOutputVarDefine(0)+" = asin("+t+");\n        "},e}(iB));t._RF.pop(),t._RF.push({},"2986999N5lOG433MyYF3lBY","arctangent",void 0);var YB;KV({menu:"Math/Trigonometry/Arctangent",title:"Arctangent"})(ZB=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[VV("In",Ct.ZERO,"vec4","vector")],outputs:[VV("Out",Ct.ZERO,"vec4","vector")]},e}It(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0);return"\n            "+this.getOutputVarDefine(0)+" = atan("+t+");\n        "},e}(iB));t._RF.pop(),t._RF.push({},"2a9c8rn4+VHWa4BXpsUBf1R","arctangent2",void 0);var jB;KV({menu:"Math/Trigonometry/Arctangent2",title:"Arctangent2"})(YB=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[VV("A",Ct.ZERO,"vec4","vector"),VV("B",Ct.ZERO,"vec4","vector")],outputs:[VV("Out",Ct.ZERO,"vec4","vector")]},e}It(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0),e=this.getInputValue(1);return"\n            "+this.getOutputVarDefine(0)+" = atan2("+t+", "+e+");\n        "},e}(iB));t._RF.pop(),t._RF.push({},"2e9b7mUik5Cj7/HtwG5GjOg","cosine",void 0);var KB;KV({menu:"Math/Trigonometry/Cosine",title:"Cosine"})(jB=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[VV("In",Ct.ZERO,"vec4","vector")],outputs:[VV("Out",Ct.ZERO,"vec4","vector")]},e}It(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0);return"\n            "+this.getOutputVarDefine(0)+" = cos("+t+");\n        "},e}(iB));t._RF.pop(),t._RF.push({},"54cccLnyalN+rGU9RVdf0Ob","degrees-to-radians",void 0);var XB;KV({menu:"Math/Trigonometry/DegreesToRadians",title:"DegreesToRadians"})(KB=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[VV("In",Ct.ZERO,"vec4","vector")],outputs:[VV("Out",Ct.ZERO,"vec4","vector")]},e}It(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0);return"\n            "+this.getOutputVarDefine(0)+" = radians("+t+");\n        "},e}(iB));t._RF.pop(),t._RF.push({},"d1158zUxl5K7KSvlL2F7+wS","hyperbolic-cosine",void 0);var JB;KV({menu:"Math/Trigonometry/HyperbolicCosine",title:"HyperbolicCosine"})(XB=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[VV("In",Ct.ZERO,"vec4","vector")],outputs:[VV("Out",Ct.ZERO,"vec4","vector")]},e}It(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0);return"\n            "+this.getOutputVarDefine(0)+" = cosh("+t+");\n        "},e}(iB));t._RF.pop(),t._RF.push({},"d0e30ycExdAl4oLI765JfTS","hyperbolic-sine",void 0);var QB;KV({menu:"Math/Trigonometry/HyperbolicSine",title:"HyperbolicSine"})(JB=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[VV("In",Ct.ZERO,"vec4","vector")],outputs:[VV("Out",Ct.ZERO,"vec4","vector")]},e}It(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0);return"\n            "+this.getOutputVarDefine(0)+" = sinh("+t+");\n        "},e}(iB));t._RF.pop(),t._RF.push({},"b180bsrU6dCOKdx5slTh5p9","hyperbolic",void 0);var $B;KV({menu:"Math/Trigonometry/Hyperbolic",title:"Hyperbolic"})(QB=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[VV("In",Ct.ZERO,"vec4","vector")],outputs:[VV("Out",Ct.ZERO,"vec4","vector")]},e}It(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0);return"\n            "+this.getOutputVarDefine(0)+" = tanh("+t+");\n        "},e}(iB));t._RF.pop(),t._RF.push({},"122290sL5ZBopCyAP2bpg8T","radians-to-degrees",void 0);var tH;KV({menu:"Math/Trigonometry/RadiansToDegrees",title:"RadiansToDegrees"})($B=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[VV("In",Ct.ZERO,"vec4","vector")],outputs:[VV("Out",Ct.ZERO,"vec4","vector")]},e}It(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0);return"\n            "+this.getOutputVarDefine(0)+" = degrees("+t+");\n        "},e}(iB));t._RF.pop(),t._RF.push({},"203ea3iMklAUK9FzJeavWJF","sine",void 0);var eH;KV({menu:"Math/Trigonometry/Sine",title:"Sine"})(tH=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[VV("In",Ct.ZERO,"vec4","vector")],outputs:[VV("Out",Ct.ZERO,"vec4","vector")]},e}It(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0);return"\n            "+this.getOutputVarDefine(0)+" = sin("+t+");\n        "},e}(iB));t._RF.pop(),t._RF.push({},"adcb4trf/1C6627yz7YeTXn","tangent",void 0);var iH;KV({menu:"Math/Trigonometry/Tangent",title:"Tangent"})(eH=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[VV("In",Ct.ZERO,"vec4","vector")],outputs:[VV("Out",Ct.ZERO,"vec4","vector")]},e}It(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0);return"\n            "+this.getOutputVarDefine(0)+" = tan("+t+");\n        "},e}(iB));t._RF.pop(),t._RF.push({},"13009pA4vlKI5jSuhV9uAJV","cross-product",void 0);var nH;KV({menu:"Math/Vector/CrossProduct",title:"CrossProduct"})(iH=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[VV("A",Ct.ZERO,"vec4","vector"),VV("B",Ct.ZERO,"vec4","vector")],outputs:[VV("Out",Ct.ZERO,"vec4","vector")]},e}It(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0),e=this.getInputValue(1);return"\n            "+this.getOutputVarDefine(0)+" = cross("+t+", "+e+");\n        "},e}(iB));t._RF.pop(),t._RF.push({},"1d67fgjFt5PYIIoSIE7uP03","distance",void 0);var rH;KV({menu:"Math/Vector/Distance",title:"Distance"})(nH=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).concretePrecisionType=EV.Fixed,e.data={inputs:[VV("A",Ct.ZERO,"vec4","vector"),VV("B",Ct.ZERO,"vec4","vector")],outputs:[VV("Out",0,"float","vector")]},e}It(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0),e=this.getInputValue(1);return"\n            "+this.getOutputVarDefine(0)+" = distance("+t+", "+e+");\n        "},e}(iB));t._RF.pop(),t._RF.push({},"fe81frs65tLqqp2QPfF1tCJ","dot-product",void 0);var oH;KV({menu:"Math/Vector/DotProduct",title:"DotProduct"})(rH=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).concretePrecisionType=EV.Fixed,e.data={inputs:[VV("A",Ct.ZERO,"vec4","vector"),VV("B",Ct.ZERO,"vec4","vector")],outputs:[VV("Out",0,"float","vector")]},e}It(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0),e=this.getInputValue(1);return"\n            "+this.getOutputVarDefine(0)+" = dot("+t+", "+e+");\n        "},e}(iB));t._RF.pop(),t._RF.push({},"861c8JYxalKB66ptbnD6WdM","fresnel",void 0);var aH;KV({menu:"Math/Vector/Fresnel",title:"Fresnel"})(oH=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).concretePrecisionType=EV.Fixed,e.data={inputs:[VV("Normal",g.ZERO,"vec3","vector"),VV("ViewDir",g.ZERO,"vec3","vector"),VV("Power",0,"float","vector")],outputs:[VV("Out",0,"float","vector")]},e}It(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0),e=this.getInputValue(1),i=this.getInputValue(2);return"\n            "+this.getOutputVarDefine(0)+" = pow((1.0 - saturate(dot(normalize("+t+"), normalize("+e+")))), "+i+");\n        "},e}(iB));t._RF.pop(),t._RF.push({},"76ce8feSIBML7x6UxKZ/iDJ","projection",void 0);var sH;KV({menu:"Math/Vector/Projection",title:"Projection"})(aH=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[VV("A",Ct.ZERO,"vec4","vector"),VV("B",Ct.ZERO,"vec4","vector")],outputs:[VV("Out",Ct.ZERO,"vec4","vector")]},e}It(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0),e=this.getInputValue(1);return"\n            "+this.getOutputVarDefine(0)+" = "+e+" * dot("+t+", "+e+") / dot("+e+", "+e+");\n        "},e}(iB));t._RF.pop(),t._RF.push({},"83264s8H2BKlb81PIs6fbLm","reflection",void 0);var lH;KV({menu:"Math/Vector/Reflection",title:"Reflection"})(sH=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[VV("In",Ct.ZERO,"vec4","vector"),VV("Normal",Ct.ZERO,"vec4","vector")],outputs:[VV("Out",Ct.ZERO,"vec4","vector")]},e}It(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0),e=this.getInputValue(1);return"\n            "+this.getOutputVarDefine(0)+" = reflect("+t+", "+e+");\n        "},e}(iB));t._RF.pop(),t._RF.push({},"36176dcQhhIm7tg8pihGhm0","rejection",void 0);var cH;KV({menu:"Math/Vector/Rejection",title:"Rejection"})(lH=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[VV("A",Ct.ZERO,"vec4","vector"),VV("B",Ct.ZERO,"vec4","vector")],outputs:[VV("Out",Ct.ZERO,"vec4","vector")]},e}It(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0),e=this.getInputValue(1);return"\n            "+this.getOutputVarDefine(0)+" = "+t+" - ("+e+" * dot("+t+", "+e+") / dot("+e+", "+e+"))\n        "},e}(iB));t._RF.pop(),t._RF.push({},"2fd4cAU0iRIFbD4p8meWHjx","sphere-mask",void 0);var uH;KV({menu:"Math/Vector/SphereMask",title:"SphereMask"})(cH=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[VV("Coords",Ct.ZERO,"vec4","vector"),VV("Center",Ct.ZERO,"vec4","vector"),VV("Radius",0,"float","vector"),VV("Hardness",0,"float","vector")],outputs:[VV("Out",Ct.ZERO,"vec4","vector")]},e}It(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0),e=this.getInputValue(1),i=this.getInputValue(2),n=this.getInputValue(3);return"\n            "+this.getOutputVarDefine(0)+" = 1 - saturate((distance("+t+", "+e+") - "+i+") / (1 - "+n+"));\n        "},e}(iB));t._RF.pop(),t._RF.push({},"fdd3afGjspKIb7t04FDpYVl","noise-sine-wave",void 0);var hH;KV({menu:"Math/Wave/NoiseSineWave",title:"NoiseSineWave"})(uH=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[VV("In",Ct.ZERO,"vec4","vector"),VV("MinMax",K.ZERO,"vec2","vector")],outputs:[VV("Out",Ct.ZERO,"vec4","vector")]},e}It(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0),e=this.getInputValue(1);return"\n            float sinIn = sin("+t+");\n            float sinInOffset = sin("+t+" + 1.0);\n            float randomno =  frac(sin((sinIn - sinInOffset) * (12.9898 + 78.233))*43758.5453);\n            float noise = lerp("+e+".x, "+e+".y, randomno);\n            "+this.getOutputVarDefine(0)+" = sinIn + noise;\n        "},e}(iB));t._RF.pop(),t._RF.push({},"00c7bwAaf9HZYpgf9WzhbZa","sawtooth-wave",void 0);var pH;KV({menu:"Math/Wave/SawtoothWave",title:"SawtoothWave"})(hH=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[VV("In",Ct.ZERO,"vec4","vector")],outputs:[VV("Out",Ct.ZERO,"vec4","vector")]},e}It(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0);return"\n            "+this.getOutputVarDefine(0)+" = 2 * ("+t+" - floor(0.5 + "+t+"));\n        "},e}(iB));t._RF.pop(),t._RF.push({},"d9905hEvfVIh6Iwo+//rZfV","square-wave",void 0);var dH;KV({menu:"Math/Wave/SquareWave",title:"SquareWave"})(pH=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[VV("In",Ct.ZERO,"vec4","vector")],outputs:[VV("Out",Ct.ZERO,"vec4","vector")]},e}It(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0);return"\n            "+this.getOutputVarDefine(0)+" = 1.0 - 2.0 * round(frac("+t+"));\n        "},e}(iB));t._RF.pop(),t._RF.push({},"92a3eZPGhZGbpxgWBNEKAGs","triangle-wave",void 0);var fH;KV({menu:"Math/Wave/TriangleWave",title:"TriangleWave"})(dH=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[VV("In",Ct.ZERO,"vec4","vector")],outputs:[VV("Out",Ct.ZERO,"vec4","vector")]},e}It(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0);return"\n            "+this.getOutputVarDefine(0)+" = 2.0 * abs( 2 * ("+t+" - floor(0.5 + "+t+")) ) - 1.0;\n        "},e}(iB));t._RF.pop(),t._RF.push({},"5ccd4lVn2JLsKN+1DWNpIFz","gradient-noise",void 0);var gH;KV({menu:"Procedural/Noise/GradientNoise",title:"GradientNoise"})(fH=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).concretePrecisionType=EV.Fixed,e.depChunks=["noise"],e.data={inputs:[VV("uv",K.ZERO,"vec2","vector"),VV("scale",0,"float","vector")],outputs:[VV("Out",0,"float","vector")]},e}It(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0);this.inputs[0].connectSlot||(t="v_uv.xy");var e=this.getInputValue(1);return this.getOutputVarDefine(0)+" = GradientNoise("+t+", "+e+");"},e}(iB));t._RF.pop(),t._RF.push({},"35746vutFFE/Y01CS8ARMHq","simple-noise",void 0);var mH;KV({menu:"Procedural/Noise/SimpleNoise",title:"SimpleNoise"})(gH=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).concretePrecisionType=EV.Fixed,e.depChunks=["noise"],e.data={inputs:[VV("uv",K.ZERO,"vec2","vector"),VV("scale",0,"float","vector")],outputs:[VV("Out",0,"float","vector")]},e}It(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0);this.inputs[0].connectSlot||(t="v_uv.xy");var e=this.getInputValue(1);return this.getOutputVarDefine(0)+" = SimpleNoise("+t+", "+e+");"},e}(iB));t._RF.pop(),t._RF.push({},"71cb8o0v7xEvJDEaB1PCHhM","ellipse",void 0);var vH;KV({menu:"Procedural/Shape/Ellipse",title:"Ellipse"})(mH=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).concretePrecisionType=EV.Fixed,e.depChunks=["shape"],e.data={inputs:[VV("uv",K.ZERO,"vec2","vector"),VV("width",.5,"float","vector"),VV("height",.5,"float","vector")],outputs:[VV("Out",0,"float","vector")]},e}It(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0);this.inputs[0].connectSlot||(t="v_uv.xy");var e=this.getInputValue(1),i=this.getInputValue(2);return this.getOutputVarDefine(0)+" = Ellipse("+t+", "+e+", "+i+");"},e}(iB));t._RF.pop(),t._RF.push({},"c5bfexyH39Fw4zoC+a2iqVE","rectangle",void 0);var yH;KV({menu:"Procedural/Shape/Rectangle",title:"Rectangle"})(vH=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).concretePrecisionType=EV.Fixed,e.depChunks=["shape"],e.data={inputs:[VV("uv",K.ZERO,"vec2","vector"),VV("width",.5,"float","vector")],outputs:[VV("Out",0,"float","vector")]},e}It(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0);this.inputs[0].connectSlot||(t="v_uv.xy");var e=this.getInputValue(1);return this.getOutputVarDefine(0)+" = Rectangle("+t+", "+e+");"},e}(iB));t._RF.pop(),t._RF.push({},"ce89b57LA5CTpEIa3CV7imi","round-rectangle",void 0);var bH;KV({menu:"Procedural/Shape/RoundRectangle",title:"RoundRectangle"})(yH=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).concretePrecisionType=EV.Fixed,e.depChunks=["shape"],e.data={inputs:[VV("uv",K.ZERO,"vec2","vector"),VV("width",.5,"float","vector"),VV("radius",.1,"float","vector")],outputs:[VV("Out",0,"float","vector")]},e}It(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0);this.inputs[0].connectSlot||(t="v_uv.xy");var e=this.getInputValue(1),i=this.getInputValue(2);return this.getOutputVarDefine(0)+" = RoundRectangle("+t+", "+e+", "+i+");"},e}(iB));t._RF.pop(),t._RF.push({},"db427Xs0q5CMbRASs8quHqY","polar-coordinates",void 0);var _H;KV({menu:"Uv/PolarCoordinates",title:"PolarCoordinates"})(bH=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).concretePrecisionType=EV.Fixed,e.depChunks=["uv"],e.data={inputs:[VV("uv",K.ZERO,"vec2","vector"),VV("center",K.ZERO,"vec2","vector"),VV("radialScale",0,"float","vector"),VV("lengthScale",0,"float","vector")],outputs:[VV("Out",K.ZERO,"vec2","vector")]},e}It(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0);this.inputs[0].connectSlot||(t="v_uv.xy");var e=this.getInputValue(1),i=this.getInputValue(2),n=this.getInputValue(3);return this.getOutputVarDefine(0)+" = PolarCoordinates("+t+", "+e+", "+i+", "+n+");"},e}(iB));t._RF.pop(),t._RF.push({},"d6912eLcHVBjrq4U/b1qppk","rotate-coordinates",void 0);var SH;KV({menu:"Uv/RotateCoordinates",title:"RotateCoordinates"})(_H=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).concretePrecisionType=EV.Fixed,e.depChunks=["uv"],e.data={inputs:[VV("uv",K.ZERO,"vec2","vector"),VV("center",K.ZERO,"vec2","vector"),VV("rotation",0,"float","vector")],outputs:[VV("Out",K.ZERO,"vec2","vector")]},e}It(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0);this.inputs[0].connectSlot||(t="v_uv.xy");var e=this.getInputValue(1),i=this.getInputValue(2);return this.getOutputVarDefine(0)+" = RotateCoordinates("+t+", "+e+", "+i+");"},e}(iB));t._RF.pop(),t._RF.push({},"5f40e+RWa9OQYJs/kAgd0eT","tilling-and-offset",void 0);var wH;KV({menu:"Uv/TillingAndOffset",title:"TillingAndOffset"})(SH=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).concretePrecisionType=EV.Fixed,e.depChunks=["uv"],e.data={inputs:[VV("uv",K.ZERO,"vec2","vector"),VV("tilling",K.ZERO,"vec2","vector"),VV("offset",K.ZERO,"vec2","vector")],outputs:[VV("Out",K.ZERO,"vec2","vector")]},e}It(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0);this.inputs[0].connectSlot||(t="v_uv.xy");var e=this.getInputValue(1),i=this.getInputValue(2);return"\n            "+this.getOutputVarDefine(0)+" = "+t+" * "+e+" + "+i+";\n        "},e}(iB));t._RF.pop(),t._RF.push({},"ce045mF1/xFUKqKc7YUTgo5","index",void 0),t._RF.pop(),t._RF.push({},"c9cd7cUxzJGfqrBxyo6i9Gm","combine",void 0);var TH;KV({menu:"Channel/Combine",title:"Combine"})(wH=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).concretePrecisionType=EV.Fixed,e.data={inputs:[VV("R",0,"float","vector"),VV("G",0,"float","vector"),VV("B",0,"float","vector"),VV("A",0,"float","vector")],outputs:[VV("RGBA",Ct.ZERO,"vec4","vector"),VV("RGB",g.ZERO,"vec3","vector"),VV("RG",K.ZERO,"vec2","vector")]},e}return It(e,t),e.prototype.generateCode=function(){var t=this.getSlotWithSlotName("R"),e=this.getSlotWithSlotName("G"),i=this.getSlotWithSlotName("B"),n=this.getSlotWithSlotName("A"),r=this.getSlotWithSlotName("RGBA"),o=this.getSlotWithSlotName("RGB"),a=this.getSlotWithSlotName("RG"),s="";return r&&r.connectSlot&&(s+=(null==r?void 0:r.varDefine)+" = vec4("+(null==t?void 0:t.slotValue)+", "+(null==e?void 0:e.slotValue)+", "+(null==i?void 0:i.slotValue)+", "+(null==n?void 0:n.slotValue)+");\n"),o&&o.connectSlot&&(s+=(null==o?void 0:o.varDefine)+" = vec3("+(null==t?void 0:t.slotValue)+", "+(null==e?void 0:e.slotValue)+", "+(null==i?void 0:i.slotValue)+");\n"),a&&a.connectSlot&&(s+=(null==a?void 0:a.varDefine)+" = vec2("+(null==t?void 0:t.slotValue)+", "+(null==e?void 0:e.slotValue)+");\n"),s},e}(iB));t._RF.pop(),t._RF.push({},"3da06y4hU1Ow4fHMuaVh9Ox","split",void 0);KV({menu:"Channel/Split",title:"Split"})(TH=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).concretePrecisionType=EV.Fixed,e.data={inputs:[VV("Vector",new Ct,"vec4","vector")],outputs:[VV("R",0,"float","vector"),VV("G",0,"float","vector"),VV("B",0,"float","vector"),VV("A",0,"float","vector")]},e}return It(e,t),e.prototype.generateCode=function(){var t=this,e=this.getInputValue(0),i=[];return this.data.outputs.forEach((function(n){var r=t.getOutputSlotWithSlotName(n.display);r&&r.connectSlot&&i.push("float "+(null==r?void 0:r.varName)+" = "+e+"."+n.display.toLowerCase()+";")})),i.join("\n")},e}(iB));t._RF.pop(),t._RF.push({},"fcee9eMBvJBt5SDLbWEpbbO","input-node",void 0);var EH,AH=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).concretePrecisionType=EV.Fixed,e}return It(e,t),e}(iB);t._RF.pop(),t._RF.push({},"93194csMENJ+oWCPxFCx+9c","property-node",void 0);var CH;KV({style:{headerColor:"#ec7063"}})(EH=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).concretePrecisionType=EV.Fixed,e.property=null,e.name="",e.data={outputs:[VV("Out",{},"any","any")]},e.isPropertyNode=!0,e}It(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){var t=this,e=0;switch(XV.properties.find((function(e){return e.name===t.name})).type){case WV.Float:case WV.Boolean:e=1;break;case WV.Vector2:e=2;break;case WV.Vector3:e=4;break;case WV.Vector4:case WV.Color:e=4}this.slots[0]._concretePrecision=e},i.generateCode=function(){return""},e}(iB));t._RF.pop(),t._RF.push({},"08b1ekFRoNLQ5UDBj6YtBOO","all",void 0);var PH;KV({menu:"Logic/All",title:"All"})(CH=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).concretePrecisionType=EV.Min,e.data={inputs:[VV("In",Ct.ZERO,"vec4","vector")],outputs:[VV("Out",!1,"boolean","boolean")]},e}It(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){for(var t=this.getInputValue(0),e=this.getOutputVarDefine(0),i=["x","y","z","w"],n=[],r=this.slots[0].concretePrecision,o=0;o<r;o++)n.push("("+t+"."+i[o]+" > 0.)");return"\n            "+e+" = ("+n.join(" && ")+");\n        "},e}(iB));t._RF.pop(),t._RF.push({},"ad796qaJ35K1pVtAoiLAQwn","and",void 0);var MH;KV({menu:"Logic/And",title:"And"})(PH=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).concretePrecisionType=EV.Max,e.data={inputs:[VV("A",!1,"boolean","boolean"),VV("B",!1,"boolean","boolean")],outputs:[VV("Out",!1,"boolean","boolean")]},e}It(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0),e=this.getInputValue(1);return"\n            "+this.getOutputVarDefine(0)+" = ("+t+" && "+e+");\n        "},e}(iB));t._RF.pop(),t._RF.push({},"c213eN4ql1Fo5ECkorGOGam","any",void 0);var IH;KV({menu:"Logic/Any",title:"Any"})(MH=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).concretePrecisionType=EV.Min,e.data={inputs:[VV("In",Ct.ZERO,"vec4","vector")],outputs:[VV("Out",!1,"boolean","boolean")]},e}It(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){for(var t=this.getInputValue(0),e=this.getOutputVarDefine(0),i=["x","y","z","w"],n=[],r=this.slots[0].concretePrecision,o=0;o<r;o++)n.push("("+t+"."+i[o]+" > 0.)");return"\n            "+e+" = ("+n.join(" || ")+");\n        "},e}(iB));t._RF.pop(),t._RF.push({},"2f31f/lK6hGfInMVVNdS8Sy","branch",void 0);var NH;KV({menu:"Logic/Branch",title:"Branch"})(IH=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).concretePrecisionType=EV.Max,e.data={inputs:[VV("Predicate",!1,"boolean","boolean"),VV("True",Ct.ZERO,"vec4","vector"),VV("False",Ct.ZERO,"vec4","vector")],outputs:[VV("Out",Ct.ZERO,"vec4","vector")]},e}It(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0),e=this.getInputValue(1),i=this.getInputValue(2);return"\n            "+this.getOutputVarDefine(0)+" = ("+t+") ? ("+e+") : ("+i+");\n        "},e}(iB));t._RF.pop(),t._RF.push({},"29cf0dWHHJIo4dVJcv8q6Ik","comparison",void 0);var LH,OH=function(t){return t[t.Equal=0]="Equal",t[t.NotEqual=1]="NotEqual",t[t.Less=2]="Less",t[t.LessOrEqual=3]="LessOrEqual",t[t.Greater=4]="Greater",t[t.GreaterOrEqual=5]="GreaterOrEqual",t}(OH||{});KV({menu:"Logic/Comparison",title:"Comparison"})(NH=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).concretePrecisionType=EV.Fixed,e.fixedConcretePrecision=1,e.data={props:[BV("Type",OH.Equal,"enum",{enum:OH})],inputs:[VV("A",0,"float","vector"),VV("B",0,"float","vector")],outputs:[VV("Out",0,"boolean","boolean")]},e}It(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0),e=this.getInputValue(1),i=this.getOutputVarDefine(0),n="";switch(this.getPropWithName("Type").value){case OH.Equal:n="("+t+" == "+e+")";break;case OH.NotEqual:n="("+t+" != "+e+")";break;case OH.Less:n="("+t+" < "+e+")";break;case OH.LessOrEqual:n="("+t+" <= "+e+")";break;case OH.Greater:n="("+t+" > "+e+")";break;case OH.GreaterOrEqual:n="("+t+" >= "+e+")"}return"\n            "+i+" = "+n+";\n        "},e}(iB));t._RF.pop(),t._RF.push({},"c8ed6hsGT1HOKJ9Qr9y8+aM","is-nan",void 0);var RH;KV({menu:"Logic/IsNan",title:"IsNan"})(LH=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).concretePrecisionType=EV.Fixed,e.fixedConcretePrecision=1,e.data={inputs:[VV("In",0,"float","vector")],outputs:[VV("Out",!1,"boolean","boolean")]},e}It(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0);return"\n            "+this.getOutputVarDefine(0)+" = isnan("+t+");\n        "},e}(iB));t._RF.pop(),t._RF.push({},"aad29jVDvZJX7eHgVCkzuSx","not",void 0);var xH;KV({menu:"Logic/Not",title:"Not"})(RH=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).concretePrecisionType=EV.Max,e.data={inputs:[VV("In",!1,"boolean","boolean")],outputs:[VV("Out",!1,"boolean","boolean")]},e}It(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0);return"\n            "+this.getOutputVarDefine(0)+" = (!"+t+");\n        "},e}(iB));t._RF.pop(),t._RF.push({},"a2b3fR0/g9EC7haT+6NqTEL","or",void 0);KV({menu:"Logic/Or",title:"Or"})(xH=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).concretePrecisionType=EV.Max,e.data={inputs:[VV("A",!1,"boolean","boolean"),VV("B",!1,"boolean","boolean")],outputs:[VV("Out",!1,"boolean","boolean")]},e}It(e,t);var i=e.prototype;return i.calcConcretePrecision=function(){t.prototype.calcConcretePrecision.call(this)},i.generateCode=function(){var t=this.getInputValue(0),e=this.getInputValue(1);return"\n            "+this.getOutputVarDefine(0)+" = ("+t+" || "+e+");\n        "},e}(iB));t._RF.pop(),t._RF.push({},"1eab7ptCA1KiK+C6tmMVON/","MasterNode",void 0);var FH=function(t){return t[t.Vertex=0]="Vertex",t[t.Fragment=1]="Fragment",t}({});function DH(t,e){if(t.connectSlot){var i=t.connectNode;if(i){if(e.includes(i))return;i.inputs.forEach((function(t){DH(t,e)})),e.push(i)}}}var zH,kH=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).isMasterNode=!0,e.concretePrecisionType=EV.Fixed,e.properties=[],e.data={inputs:[]},e}It(e,t);var i=e.prototype;return i.getConnectNodes=function(t){var e=[];return t.forEach((function(t){DH(t,e)})),e.sort((function(t,e){return e.priority-t.priority})),e},i.generatePropertiesCode=function(){var t="\n",e="\n",i="",n=XV.properties;n.sort((function(t,e){return e.concretePrecision-t.concretePrecision}));var r=0;return n.forEach((function(n){var o="",a="",s=n.value,l=n.type===WV.Color,c=s.x,u=s.y,h=s.z,p=s.w;if(n.type===WV.Texture2D)o="sampler2D",a="white";else if(n.type===WV.TextureCube)o="samplerCube",a="white";else{var d=n.concretePrecision;1===d?(o="float",a=""+s):2===d?(o="vec2",a="["+c+", "+u+"]"):3===d?(o="vec4",a="["+c+", "+u+", "+h+", 0]"):4===d&&(o="vec4",a="["+c+", "+u+", "+h+",  "+p+"]")}var f=l?", editor: { type: color }":"";n.isTexture()?i+="  uniform "+o+" "+n.name+";\n":(t+="    "+o+" "+n.name+";\n",r++),e+="        "+n.name+": { value: "+a+" "+f+"}\n"})),0===r&&(t+="    vec4 empty_value;\n"),{uniform:t,uniformSampler:i,mtl:e}},i.replaceChunks=function(t){var e=["common"];XV.allNodes.forEach((function(t){for(var i=0;i<t.depChunks.length;i++)e.includes(t.depChunks[i])||e.push(t.depChunks[i])}));var i="\n",n="\n";return e.forEach((function(t){var e=LV.join(XV.shaderTemplatesDir,"chunks/"+t+".chunk"),r=NV.readFileSync(e,"utf-8");r?(n+=r+"\n",i+="  #include <shader_graph_"+t+">\n"):console.error("Can not find chunk with path ["+e+"]")})),t=(t=(t=t.replace("{{chunks}}",n)).replace("{{vs_chunks}}",i)).replace("{{fs_chunks}}",i)},i.generateDefines=function(t){var e=[];XV.allNodes.forEach((function(t){t.defines.forEach((function(t){e.includes(t)||e.push(t)}))}));var i="";e.forEach((function(t){i+=t+"\n"})),i=GV(PV,i),i=GV(CV,i);var n=(i=GV(MV,i)).split("\n");return n=n.map((function(t){return"  "+t})),i=n.join("\n"),t.replace(/{{defines}}/g,i)},i.generateSlotsCode=function(t){var e=["\n"];return this.getConnectNodes(t).forEach((function(t){t.calcConcretePrecision(),t.generateCode().split("\n").forEach((function(i){i&&(i+=" // "+t.constructor.name,e.push("    "+i))}))})),e.join("\n")},i.generateCodeChunk=function(t){var e=this,i=[];return this.inputs.forEach((function(t){var e=t.data;i[e.codeChunk]||(i[e.codeChunk]=[]),i[e.codeChunk].push(t)})),i.forEach((function(i,n){var r=e.generateSlotsCode(i);t=t.replace("{{code_chunk_"+n+"}}",r)})),t},i.generateCode=function(){var t=NV.readFileSync(this.templatePath,"utf-8");t=this.generateCodeChunk(t),t=this.generateDefines(t),t=this.replaceChunks(t),XV.properties&&0!==XV.properties.length||(t=(t=t.replace(/properties: &props/g,"")).replace(/properties: \*props/g,""));var e=this.generatePropertiesCode();t=(t=(t=t.replace("{{properties}}",e.uniform)).replace("{{properties_sampler}}",e.uniformSampler)).replace("{{properties_mtl}}",e.mtl);var i=["Vertex Position","Vertex Normal","Vertex Tangent","Position"];return this.inputs.forEach((function(e){var n,r="slot_"+e.displayName.replace(/ /g,"_");i.includes(e.displayName)||"Normal"===e.displayName?e.connectSlot&&(n=e.slotValue):n=e.slotValue;var o=new RegExp("{{"+r+" *= *(.*)}}","g");if(void 0===n){var a=o.exec(t);a&&(n=a[1])}t=t.replace(o,n)})),t},i.createMaterial=function(){var t=Ot(Rt().mark((function t(e){var i,n,r,o;return Rt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return i=this.generateCode(),n=new Pt,"shader-graph-preview.effect",t.next=5,e("shader-graph-preview.effect",i);case 5:return r=t.sent,o=new cc.EffectAsset,Object.assign(o,r),o.onLoaded(),n.initialize({effectAsset:r}),t.next=12,Promise.all(XV.properties.map(Ot(Rt().mark((function t(e){var i;return Rt().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.type!==WV.Texture2D&&e.type!==WV.TextureCube){t.next=3;break}return i=e.value.uuid,t.abrupt("return",new Promise((function(t){u.loadAny(i,(function(i,r){if(i)return console.error(i),t(null);n.setProperty(e.name,r),t(null)}))})));case 3:case"end":return t.stop()}}),t)})))));case 12:return t.abrupt("return",n);case 13:case"end":return t.stop()}}),t,this)})));return function(e){return t.apply(this,arguments)}}(),xt(e,[{key:"templatePath",get:function(){return""}}]),e}(iB);t._RF.pop(),t._RF.push({},"3dc0bllbkxAsKzvUgvzcrgb","SurfaceMasterNode",void 0);var VH;KV({title:"Surface",master:!0})(zH=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[VV("Vertex Position",g.ZERO,"vec3","vector",{slotType:FH.Vertex,codeChunk:0}),VV("Vertex Normal",g.ZERO,"vec3","vector",{slotType:FH.Vertex,codeChunk:0}),VV("Vertex Tangent",g.ZERO,"vec3","vector",{slotType:FH.Vertex,codeChunk:0}),VV("Albedo",new Ct(.5,.5,.5,.5),"color","vector",{slotType:FH.Fragment,codeChunk:3}),VV("Normal",g.ZERO,"vec3","vector",{slotType:FH.Fragment,codeChunk:3}),VV("Emission",g.ZERO,"vec3","vector",{slotType:FH.Fragment,codeChunk:3}),VV("Metallic",.6,"float","vector",{slotType:FH.Fragment,codeChunk:3}),VV("Roughness",.5,"float","vector",{slotType:FH.Fragment,codeChunk:3}),VV("Occlusion",1,"float","vector",{slotType:FH.Fragment,codeChunk:3}),VV("SpecularIntensity",.5,"float","vector",{slotType:FH.Fragment,codeChunk:3}),VV("Alpha",1,"float","vector",{slotType:FH.Fragment,codeChunk:3}),VV("AlphaClipThreshold",.5,"float","vector",{slotType:FH.Fragment,codeChunk:3}),VV("AnisotropyRotation",0,"float","vector",{slotType:FH.Fragment,codeChunk:3}),VV("AnisotropyShape",1,"float","vector",{slotType:FH.Fragment,codeChunk:3})]},e}return It(e,t),e.prototype.generateCode=function(){var e,i;null==(e=this.getSlotWithSlotName("AnisotropyRotation"))||e.connectSlot,null==(i=this.getSlotWithSlotName("AnisotropyShape"))||i.connectSlot;return t.prototype.generateCode.call(this)},xt(e,[{key:"templatePath",get:function(){return LV.join(XV.shaderTemplatesDir,"master/SurfaceMasterNode.effect")}}]),e}(kH));t._RF.pop(),t._RF.push({},"f3fa2kI6ulBJKyUfbfTCT2P","UnlitMasterNode",void 0);var BH;KV({title:"Unlit",master:!0})(VH=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[VV("Vertex Position",g.ZERO,"vec3","vector",{slotType:FH.Vertex,codeChunk:0}),VV("Vertex Normal",g.ZERO,"vec3","vector",{slotType:FH.Vertex,codeChunk:0}),VV("Vertex Tangent",g.ZERO,"vec3","vector",{slotType:FH.Vertex,codeChunk:0}),VV("BaseColor",new Ct(.5,.5,.5,.5),"color","vector",{slotType:FH.Fragment,codeChunk:3}),VV("Alpha",1,"float","vector",{slotType:FH.Fragment,codeChunk:3}),VV("AlphaClipThreshold",0,"float","vector",{slotType:FH.Fragment,codeChunk:3})]},e}return It(e,t),e.generatePreviewCode=function(t){var i=new e;i.init();var n=i.getSlotWithSlotName("BaseColor");return n&&(n.connectSlots[0]=t.outputs[0]),i.generateCode()},xt(e,[{key:"templatePath",get:function(){return LV.join(XV.shaderTemplatesDir,"master/UnlitMasterNode.effect")}}]),e}(kH));t._RF.pop(),t._RF.push({},"159abqfjclCYp0gqjzKIy69","SubGraphNode",void 0);var HH;KV({style:{headerColor:"#757575"}})(BH=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[VV("In",0,"any","any")],outputs:[VV("Out",0,"any","any")]},e}return It(e,t),e}(iB));t._RF.pop(),t._RF.push({},"a7a1dWl92NFI7N6B5WUHBcO","SubGraphOutputNode",void 0);var UH;KV({title:"Output",master:!0,style:{headerColor:"#81ff2f"}})(HH=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).data={inputs:[VV("Out",0,"any","any")]},e}return It(e,t),e}(iB));t._RF.pop(),t._RF.push({},"f8b0fdliVNBereLRNhLivTf","PreviewNode",void 0),t._RF.pop(),t._RF.push({},"e3d34kNDmBJC7P5ldMA5yga","color",void 0);var GH;KV({menu:"Input/Basic/Color",title:"Color"})(UH=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).fixedConcretePrecision=4,e.data={props:[BV("Color",new Ct,"color")],outputs:[VV("Out",new Ct,"vec4","vector")]},e}return It(e,t),e.prototype.generateCode=function(){var t=this.getPropWithName("Color").value;return"vec4 "+this.getOutputVarName(0)+" = vec4("+t.x+", "+t.y+", "+t.z+", "+t.w+");"},e}(AH));t._RF.pop(),t._RF.push({},"d78e7iowiJHXbVo2J+jhSXo","time",void 0);var WH;KV({menu:"Input/Basic/Time",title:"Time"})(GH=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).data={outputs:[VV("Time",0,"float","vector"),VV("Sine Time",0,"float","vector"),VV("Cosine Time",0,"float","vector"),VV("Delta Time",0,"float","vector"),VV("Smooth Delta",0,"float","vector")]},e}return It(e,t),e.prototype.generateCode=function(){var t=this.getOutputSlotWithSlotName("Time"),e=this.getOutputSlotWithSlotName("Sine Time"),i=this.getOutputSlotWithSlotName("Cosine Time"),n=this.getOutputSlotWithSlotName("Delta Time"),r=this.getOutputSlotWithSlotName("Smooth Delta"),o="";return null!=t&&t.connectSlot&&(o+="float "+t.varName+" = cc_time.x;"),null!=e&&e.connectSlot&&(o+="float "+e.varName+" = sin(cc_time.x);"),null!=i&&i.connectSlot&&(o+="float "+i.varName+" = cos(cc_time.x);"),null!=n&&n.connectSlot&&(o+="float "+n.varName+" = cc_time.y;"),null!=r&&r.connectSlot&&(console.warn("Not support smooth delta time"),o+="float "+r.varName+" = cc_time.y;"),o},e}(AH));t._RF.pop(),t._RF.push({},"f4d52tjGCZK1JsKsZ4QUDNC","normal-vector",void 0);var qH;KV({menu:"Input/Geometry/NormalVector",title:"NormalVector"})(WH=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).concretePrecisionType=EV.Fixed,e.fixedConcretePrecision=3,e.data={props:[BV("Space",PV.World,"enum",{enum:PV})],outputs:[VV("Normal",g.ZERO,"vec3","vector")]},e}return It(e,t),e.prototype.generateCode=function(){var t=this.getPropWithName("Space"),e="normal";return t.value===PV.Local?e="normal":t.value===PV.View?e="viewNormal":t.value===PV.World&&(e="worldNormal"),this.defines=[UV(PV,t.value)],this.getOutputVarDefine(0)+" = "+e+";"},e}(iB));t._RF.pop(),t._RF.push({},"c4117F5YClIWKQl+GltCNqQ","position",void 0);var ZH;KV({menu:"Input/Geometry/Position",title:"Position"})(qH=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).concretePrecisionType=EV.Fixed,e.fixedConcretePrecision=3,e.data={props:[BV("Space",CV.World,"enum",{enum:CV})],outputs:[VV("Position",new g,"vec3","vector")]},e}return It(e,t),e.prototype.generateCode=function(){var t=this.getPropWithName("Space"),e="position";return t.value===CV.Local?e="position":t.value===CV.View?e="viewPos":t.value===CV.World&&(e="worldPos"),this.defines=[UV(CV,t.value)],this.getOutputVarDefine(0)+" = "+e+".xyz;"},e}(iB));t._RF.pop(),t._RF.push({},"95b7bSNki1Ba5Pk4AQXXcG5","uv",void 0);var YH;KV({menu:"Input/Geometry/UV",title:"UV"})(ZH=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).concretePrecisionType=EV.Fixed,e.fixedConcretePrecision=2,e.data={props:[BV("Channel",0,"float")],outputs:[VV("UV",new K,"vec2","vector")]},e}return It(e,t),e.prototype.generateCode=function(){var t=this.getPropWithName("Channel");if(!t)return console.warn("UV Node generate code undefined"),"";var e="v_uv"+(t.value>0?t.value:"");return this.getOutputVarDefine(0)+" = "+e+";"},e}(iB));t._RF.pop(),t._RF.push({},"57f73xnQclNJoH/LZDbCo8N","vertex-color",void 0);var jH;KV({menu:"Input/Geometry/VertexColor",title:"VertexColor"})(YH=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).concretePrecisionType=EV.Fixed,e.fixedConcretePrecision=4,e.data={outputs:[VV("Out",new Ct,"vec4","vector")]},e}return It(e,t),e.prototype.generateCode=function(){return this.getOutputVarDefine(0)+" = FSInput_vertexColor;"},e}(iB));t._RF.pop(),t._RF.push({},"fbe73AP6NxBTqOrL07ng2zD","view-direction",void 0);var KH;KV({menu:"Input/Geometry/ViewDirection",title:"ViewDirection"})(jH=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).concretePrecisionType=EV.Fixed,e.fixedConcretePrecision=3,e.data={props:[BV("Space",MV.World,"enum",{enum:MV})],outputs:[VV("ViewDirection",new g,"vec3","vector")]},e}return It(e,t),e.prototype.generateCode=function(){var t=this.getPropWithName("Space"),e="view";return t.value===MV.Local?e="view":t.value===MV.View?e="viewView":t.value===MV.World&&(e="worldView"),this.defines=[UV(MV,t.value)],this.getOutputVarDefine(0)+" = "+e+";"},xt(e,[{key:"type",get:function(){return"ViewDirection"}}]),e}(iB));t._RF.pop(),t._RF.push({},"ae6c5dYR/dM3qMNrhlBY9Hs","texture-asset",void 0),t._RF.pop(),t._RF.push({},"f593b68ejRHboYTcPDL7dZe","cubemap-asset",void 0),t._RF.pop(),t._RF.push({},"6f28a7ED/hGlLSDg1Rd/nOf","sample-cubemap",void 0),t._RF.pop(),t._RF.push({},"5895aMpjJJED5bYGNm0JmUq","sample-texture2d",void 0);var XH,JH=function(t){return t[t.Default=0]="Default",t[t.Normal=1]="Normal",t}(JH||{}),QH=function(t){return t[t.Tangent=0]="Tangent",t[t.Object=1]="Object",t}(QH||{});KV({menu:"Input/Texture/SampleTexture2D",title:"SampleTexture2D"})(KH=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).data={props:[BV("TextureType",JH.Default,"enum",{enum:JH}),BV("NormalSpace",QH.Tangent,"enum",{enum:QH})],inputs:[VV("Texture",new p,"texture2D","texture2D"),VV("UV",K.ZERO,"vec2","vector")],outputs:[VV("RGBA",Ct.ZERO,"vec4","vector"),VV("R",0,"float","vector"),VV("G",0,"float","vector"),VV("B",0,"float","vector"),VV("A",0,"float","vector")]},e}return It(e,t),e.prototype.generateCode=function(){var t,e,i=this.getSlotWithSlotName("Texture"),n=this.getSlotWithSlotName("UV"),r=this.getSlotWithSlotName("RGBA"),o=null==r?void 0:r.varName;null!=i&&i.connectSlot?(e=n.connectSlot?n.slotValue:"v_uv",t="vec4 "+o+" = texture("+(null==i?void 0:i.connectSlot.varName)+", "+e+");\n"):t="vec4 "+o+" = vec4(1.);\n";var a=this.getPropWithName("TextureType"),s=this.getPropWithName("NormalSpace");a.value===JH.Normal&&s.value===QH.Tangent&&(t+=o+".xyz -= vec3(0.5);\n",t+=o+".xyz = \n",t+="  "+o+".x * normalize(worldTangent) +\n",t+="  "+o+".y * normalize(worldBinormal) +\n",t+="  "+o+".z * normalize(worldNormal);\n",this.defines.push("CC_SURFACES_USE_TANGENT_SPACE"));var l=this.getSlotWithSlotName("R");l&&l.connectSlot&&(t+="float "+l.varName+" = "+o+".r;\n");var c=this.getSlotWithSlotName("G");c&&c.connectSlot&&(t+="float "+c.varName+" = "+o+".g;\n");var u=this.getSlotWithSlotName("B");u&&u.connectSlot&&(t+="float "+u.varName+" = "+o+".b;\n");var h=this.getSlotWithSlotName("A");return h&&h.connectSlot&&(t+="float "+h.varName+" = "+o+".a;\n"),t},e}(AH));t._RF.pop(),t._RF.push({},"1e7d5h/dpNKOKPycPdVfiDZ","texture2d-asset",void 0),t._RF.pop(),t._RF.push({},"30feaYkdKtOs5doShMcgDKA","get-local-var",void 0);var $H;KV({menu:"Input/Variable/GetLocalVar",title:"GetLocalVar"})(XH=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).data={props:[BV("Name","local_var","dynamicEnum",{registerEnum:{type:"RegisterLocalVarName",property:"Name"}})],outputs:[VV("Out",Ct.ZERO,"vec4","vector")]},e}return It(e,t),e.prototype.generateCode=function(){return this.inputs[0].connectSlot.precisionName+" "+this.name+"= "+this.getInputValue(0)+";"},xt(e,[{key:"name",get:function(){var t=this.getPropWithName("Name");return t&&t.value},set:function(t){this.getPropWithName("Name").value=t}}]),e}(iB));t._RF.pop(),t._RF.push({},"b61a9DvFcxESK2/fNFtqY0h","register-local-var",void 0);KV({menu:"Input/Variable/RegisterLocalVar",title:"RegisterLocalVar"})($H=function(t){function e(){for(var e,i=arguments.length,n=new Array(i),r=0;r<i;r++)n[r]=arguments[r];return(e=t.call.apply(t,[this].concat(n))||this).isRegisterLocalVar=!0,e.data={props:[BV("Name","local_var","string",{registerEnumType:"RegisterLocalVarName"})],inputs:[VV("In",Ct.ZERO,"vec4","vector")]},e}return It(e,t),e.prototype.generateCode=function(){return""},xt(e,[{key:"name",get:function(){return this.getPropWithName("Name").value},set:function(t){this.getPropWithName("Name").value=t}}]),e}(iB));t._RF.pop(),t._RF.push({},"00450ydLIRBS6bzTCNNRjmm","index",void 0),t._RF.pop(),t._RF.push({},"c03d0yZbI5CPJyIvpnia5dO","shadergraph",void 0),t._RF.pop()}}}));

(function(r) {
  r('virtual:///prerequisite-imports/main', 'chunks:///main.js'); 
})(function(mid, cid) {
    System.register(mid, [cid], function (_export, _context) {
    return {
        setters: [function(_m) {
            var _exportObj = {};

            for (var _key in _m) {
              if (_key !== "default" && _key !== "__esModule") _exportObj[_key] = _m[_key];
            }
      
            _export(_exportObj);
        }],
        execute: function () { }
    };
    });
});